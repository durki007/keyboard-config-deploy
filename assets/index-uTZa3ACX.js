var QD=Object.defineProperty;var HD=(o,e,t)=>e in o?QD(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t;var ki=(o,e,t)=>HD(o,typeof e!="symbol"?e+"":e,t);function WD(o,e){for(var t=0;t<e.length;t++){const n=e[t];if(typeof n!="string"&&!Array.isArray(n)){for(const r in n)if(r!=="default"&&!(r in o)){const a=Object.getOwnPropertyDescriptor(n,r);a&&Object.defineProperty(o,r,a.get?a:{enumerable:!0,get:()=>n[r]})}}}return Object.freeze(Object.defineProperty(o,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const a of r)if(a.type==="childList")for(const i of a.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&n(i)}).observe(document,{childList:!0,subtree:!0});function t(r){const a={};return r.integrity&&(a.integrity=r.integrity),r.referrerPolicy&&(a.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?a.credentials="include":r.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function n(r){if(r.ep)return;r.ep=!0;const a=t(r);fetch(r.href,a)}})();function cR(o){return o&&o.__esModule&&Object.prototype.hasOwnProperty.call(o,"default")?o.default:o}var F_={exports:{}},Rf={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var kC;function YD(){if(kC)return Rf;kC=1;var o=Symbol.for("react.transitional.element"),e=Symbol.for("react.fragment");function t(n,r,a){var i=null;if(a!==void 0&&(i=""+a),r.key!==void 0&&(i=""+r.key),"key"in r){a={};for(var s in r)s!=="key"&&(a[s]=r[s])}else a=r;return r=a.ref,{$$typeof:o,type:n,key:i,ref:r!==void 0?r:null,props:a}}return Rf.Fragment=e,Rf.jsx=t,Rf.jsxs=t,Rf}var GC;function jD(){return GC||(GC=1,F_.exports=YD()),F_.exports}var ue=jD(),U_={exports:{}},Bt={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var QC;function XD(){if(QC)return Bt;QC=1;var o=Symbol.for("react.transitional.element"),e=Symbol.for("react.portal"),t=Symbol.for("react.fragment"),n=Symbol.for("react.strict_mode"),r=Symbol.for("react.profiler"),a=Symbol.for("react.consumer"),i=Symbol.for("react.context"),s=Symbol.for("react.forward_ref"),c=Symbol.for("react.suspense"),u=Symbol.for("react.memo"),h=Symbol.for("react.lazy"),f=Symbol.iterator;function m(U){return U===null||typeof U!="object"?null:(U=f&&U[f]||U["@@iterator"],typeof U=="function"?U:null)}var g={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},A=Object.assign,_={};function x(U,k,J){this.props=U,this.context=k,this.refs=_,this.updater=J||g}x.prototype.isReactComponent={},x.prototype.setState=function(U,k){if(typeof U!="object"&&typeof U!="function"&&U!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,U,k,"setState")},x.prototype.forceUpdate=function(U){this.updater.enqueueForceUpdate(this,U,"forceUpdate")};function C(){}C.prototype=x.prototype;function b(U,k,J){this.props=U,this.context=k,this.refs=_,this.updater=J||g}var y=b.prototype=new C;y.constructor=b,A(y,x.prototype),y.isPureReactComponent=!0;var M=Array.isArray,R={H:null,A:null,T:null,S:null},T=Object.prototype.hasOwnProperty;function w(U,k,J,de,te,le){return J=le.ref,{$$typeof:o,type:U,key:k,ref:J!==void 0?J:null,props:le}}function D(U,k){return w(U.type,k,void 0,void 0,void 0,U.props)}function z(U){return typeof U=="object"&&U!==null&&U.$$typeof===o}function F(U){var k={"=":"=0",":":"=2"};return"$"+U.replace(/[=:]/g,function(J){return k[J]})}var O=/\/+/g;function q(U,k){return typeof U=="object"&&U!==null&&U.key!=null?F(""+U.key):k.toString(36)}function ne(){}function $(U){switch(U.status){case"fulfilled":return U.value;case"rejected":throw U.reason;default:switch(typeof U.status=="string"?U.then(ne,ne):(U.status="pending",U.then(function(k){U.status==="pending"&&(U.status="fulfilled",U.value=k)},function(k){U.status==="pending"&&(U.status="rejected",U.reason=k)})),U.status){case"fulfilled":return U.value;case"rejected":throw U.reason}}throw U}function he(U,k,J,de,te){var le=typeof U;(le==="undefined"||le==="boolean")&&(U=null);var V=!1;if(U===null)V=!0;else switch(le){case"bigint":case"string":case"number":V=!0;break;case"object":switch(U.$$typeof){case o:case e:V=!0;break;case h:return V=U._init,he(V(U._payload),k,J,de,te)}}if(V)return te=te(U),V=de===""?"."+q(U,0):de,M(te)?(J="",V!=null&&(J=V.replace(O,"$&/")+"/"),he(te,k,J,"",function(X){return X})):te!=null&&(z(te)&&(te=D(te,J+(te.key==null||U&&U.key===te.key?"":(""+te.key).replace(O,"$&/")+"/")+V)),k.push(te)),1;V=0;var G=de===""?".":de+":";if(M(U))for(var ee=0;ee<U.length;ee++)de=U[ee],le=G+q(de,ee),V+=he(de,k,J,le,te);else if(ee=m(U),typeof ee=="function")for(U=ee.call(U),ee=0;!(de=U.next()).done;)de=de.value,le=G+q(de,ee++),V+=he(de,k,J,le,te);else if(le==="object"){if(typeof U.then=="function")return he($(U),k,J,de,te);throw k=String(U),Error("Objects are not valid as a React child (found: "+(k==="[object Object]"?"object with keys {"+Object.keys(U).join(", ")+"}":k)+"). If you meant to render a collection of children, use an array instead.")}return V}function K(U,k,J){if(U==null)return U;var de=[],te=0;return he(U,de,"","",function(le){return k.call(J,le,te++)}),de}function oe(U){if(U._status===-1){var k=U._result;k=k(),k.then(function(J){(U._status===0||U._status===-1)&&(U._status=1,U._result=J)},function(J){(U._status===0||U._status===-1)&&(U._status=2,U._result=J)}),U._status===-1&&(U._status=0,U._result=k)}if(U._status===1)return U._result.default;throw U._result}var ie=typeof reportError=="function"?reportError:function(U){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var k=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof U=="object"&&U!==null&&typeof U.message=="string"?String(U.message):String(U),error:U});if(!window.dispatchEvent(k))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",U);return}console.error(U)};function L(){}return Bt.Children={map:K,forEach:function(U,k,J){K(U,function(){k.apply(this,arguments)},J)},count:function(U){var k=0;return K(U,function(){k++}),k},toArray:function(U){return K(U,function(k){return k})||[]},only:function(U){if(!z(U))throw Error("React.Children.only expected to receive a single React element child.");return U}},Bt.Component=x,Bt.Fragment=t,Bt.Profiler=r,Bt.PureComponent=b,Bt.StrictMode=n,Bt.Suspense=c,Bt.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=R,Bt.act=function(){throw Error("act(...) is not supported in production builds of React.")},Bt.cache=function(U){return function(){return U.apply(null,arguments)}},Bt.cloneElement=function(U,k,J){if(U==null)throw Error("The argument must be a React element, but you passed "+U+".");var de=A({},U.props),te=U.key,le=void 0;if(k!=null)for(V in k.ref!==void 0&&(le=void 0),k.key!==void 0&&(te=""+k.key),k)!T.call(k,V)||V==="key"||V==="__self"||V==="__source"||V==="ref"&&k.ref===void 0||(de[V]=k[V]);var V=arguments.length-2;if(V===1)de.children=J;else if(1<V){for(var G=Array(V),ee=0;ee<V;ee++)G[ee]=arguments[ee+2];de.children=G}return w(U.type,te,void 0,void 0,le,de)},Bt.createContext=function(U){return U={$$typeof:i,_currentValue:U,_currentValue2:U,_threadCount:0,Provider:null,Consumer:null},U.Provider=U,U.Consumer={$$typeof:a,_context:U},U},Bt.createElement=function(U,k,J){var de,te={},le=null;if(k!=null)for(de in k.key!==void 0&&(le=""+k.key),k)T.call(k,de)&&de!=="key"&&de!=="__self"&&de!=="__source"&&(te[de]=k[de]);var V=arguments.length-2;if(V===1)te.children=J;else if(1<V){for(var G=Array(V),ee=0;ee<V;ee++)G[ee]=arguments[ee+2];te.children=G}if(U&&U.defaultProps)for(de in V=U.defaultProps,V)te[de]===void 0&&(te[de]=V[de]);return w(U,le,void 0,void 0,null,te)},Bt.createRef=function(){return{current:null}},Bt.forwardRef=function(U){return{$$typeof:s,render:U}},Bt.isValidElement=z,Bt.lazy=function(U){return{$$typeof:h,_payload:{_status:-1,_result:U},_init:oe}},Bt.memo=function(U,k){return{$$typeof:u,type:U,compare:k===void 0?null:k}},Bt.startTransition=function(U){var k=R.T,J={};R.T=J;try{var de=U(),te=R.S;te!==null&&te(J,de),typeof de=="object"&&de!==null&&typeof de.then=="function"&&de.then(L,ie)}catch(le){ie(le)}finally{R.T=k}},Bt.unstable_useCacheRefresh=function(){return R.H.useCacheRefresh()},Bt.use=function(U){return R.H.use(U)},Bt.useActionState=function(U,k,J){return R.H.useActionState(U,k,J)},Bt.useCallback=function(U,k){return R.H.useCallback(U,k)},Bt.useContext=function(U){return R.H.useContext(U)},Bt.useDebugValue=function(){},Bt.useDeferredValue=function(U,k){return R.H.useDeferredValue(U,k)},Bt.useEffect=function(U,k){return R.H.useEffect(U,k)},Bt.useId=function(){return R.H.useId()},Bt.useImperativeHandle=function(U,k,J){return R.H.useImperativeHandle(U,k,J)},Bt.useInsertionEffect=function(U,k){return R.H.useInsertionEffect(U,k)},Bt.useLayoutEffect=function(U,k){return R.H.useLayoutEffect(U,k)},Bt.useMemo=function(U,k){return R.H.useMemo(U,k)},Bt.useOptimistic=function(U,k){return R.H.useOptimistic(U,k)},Bt.useReducer=function(U,k,J){return R.H.useReducer(U,k,J)},Bt.useRef=function(U){return R.H.useRef(U)},Bt.useState=function(U){return R.H.useState(U)},Bt.useSyncExternalStore=function(U,k,J){return R.H.useSyncExternalStore(U,k,J)},Bt.useTransition=function(){return R.H.useTransition()},Bt.version="19.0.0",Bt}var HC;function ny(){return HC||(HC=1,U_.exports=XD()),U_.exports}var j=ny();const nt=cR(j),ry=WD({__proto__:null,default:nt},[j]);var z_={exports:{}},If={},V_={exports:{}},k_={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var WC;function qD(){return WC||(WC=1,function(o){function e(K,oe){var ie=K.length;K.push(oe);e:for(;0<ie;){var L=ie-1>>>1,U=K[L];if(0<r(U,oe))K[L]=oe,K[ie]=U,ie=L;else break e}}function t(K){return K.length===0?null:K[0]}function n(K){if(K.length===0)return null;var oe=K[0],ie=K.pop();if(ie!==oe){K[0]=ie;e:for(var L=0,U=K.length,k=U>>>1;L<k;){var J=2*(L+1)-1,de=K[J],te=J+1,le=K[te];if(0>r(de,ie))te<U&&0>r(le,de)?(K[L]=le,K[te]=ie,L=te):(K[L]=de,K[J]=ie,L=J);else if(te<U&&0>r(le,ie))K[L]=le,K[te]=ie,L=te;else break e}}return oe}function r(K,oe){var ie=K.sortIndex-oe.sortIndex;return ie!==0?ie:K.id-oe.id}if(o.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var a=performance;o.unstable_now=function(){return a.now()}}else{var i=Date,s=i.now();o.unstable_now=function(){return i.now()-s}}var c=[],u=[],h=1,f=null,m=3,g=!1,A=!1,_=!1,x=typeof setTimeout=="function"?setTimeout:null,C=typeof clearTimeout=="function"?clearTimeout:null,b=typeof setImmediate<"u"?setImmediate:null;function y(K){for(var oe=t(u);oe!==null;){if(oe.callback===null)n(u);else if(oe.startTime<=K)n(u),oe.sortIndex=oe.expirationTime,e(c,oe);else break;oe=t(u)}}function M(K){if(_=!1,y(K),!A)if(t(c)!==null)A=!0,$();else{var oe=t(u);oe!==null&&he(M,oe.startTime-K)}}var R=!1,T=-1,w=5,D=-1;function z(){return!(o.unstable_now()-D<w)}function F(){if(R){var K=o.unstable_now();D=K;var oe=!0;try{e:{A=!1,_&&(_=!1,C(T),T=-1),g=!0;var ie=m;try{t:{for(y(K),f=t(c);f!==null&&!(f.expirationTime>K&&z());){var L=f.callback;if(typeof L=="function"){f.callback=null,m=f.priorityLevel;var U=L(f.expirationTime<=K);if(K=o.unstable_now(),typeof U=="function"){f.callback=U,y(K),oe=!0;break t}f===t(c)&&n(c),y(K)}else n(c);f=t(c)}if(f!==null)oe=!0;else{var k=t(u);k!==null&&he(M,k.startTime-K),oe=!1}}break e}finally{f=null,m=ie,g=!1}oe=void 0}}finally{oe?O():R=!1}}}var O;if(typeof b=="function")O=function(){b(F)};else if(typeof MessageChannel<"u"){var q=new MessageChannel,ne=q.port2;q.port1.onmessage=F,O=function(){ne.postMessage(null)}}else O=function(){x(F,0)};function $(){R||(R=!0,O())}function he(K,oe){T=x(function(){K(o.unstable_now())},oe)}o.unstable_IdlePriority=5,o.unstable_ImmediatePriority=1,o.unstable_LowPriority=4,o.unstable_NormalPriority=3,o.unstable_Profiling=null,o.unstable_UserBlockingPriority=2,o.unstable_cancelCallback=function(K){K.callback=null},o.unstable_continueExecution=function(){A||g||(A=!0,$())},o.unstable_forceFrameRate=function(K){0>K||125<K?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):w=0<K?Math.floor(1e3/K):5},o.unstable_getCurrentPriorityLevel=function(){return m},o.unstable_getFirstCallbackNode=function(){return t(c)},o.unstable_next=function(K){switch(m){case 1:case 2:case 3:var oe=3;break;default:oe=m}var ie=m;m=oe;try{return K()}finally{m=ie}},o.unstable_pauseExecution=function(){},o.unstable_requestPaint=function(){},o.unstable_runWithPriority=function(K,oe){switch(K){case 1:case 2:case 3:case 4:case 5:break;default:K=3}var ie=m;m=K;try{return oe()}finally{m=ie}},o.unstable_scheduleCallback=function(K,oe,ie){var L=o.unstable_now();switch(typeof ie=="object"&&ie!==null?(ie=ie.delay,ie=typeof ie=="number"&&0<ie?L+ie:L):ie=L,K){case 1:var U=-1;break;case 2:U=250;break;case 5:U=1073741823;break;case 4:U=1e4;break;default:U=5e3}return U=ie+U,K={id:h++,callback:oe,priorityLevel:K,startTime:ie,expirationTime:U,sortIndex:-1},ie>L?(K.sortIndex=ie,e(u,K),t(c)===null&&K===t(u)&&(_?(C(T),T=-1):_=!0,he(M,ie-L))):(K.sortIndex=U,e(c,K),A||g||(A=!0,$())),K},o.unstable_shouldYield=z,o.unstable_wrapCallback=function(K){var oe=m;return function(){var ie=m;m=oe;try{return K.apply(this,arguments)}finally{m=ie}}}}(k_)),k_}var YC;function ZD(){return YC||(YC=1,V_.exports=qD()),V_.exports}var G_={exports:{}},zr={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var jC;function KD(){if(jC)return zr;jC=1;var o=ny();function e(c){var u="https://react.dev/errors/"+c;if(1<arguments.length){u+="?args[]="+encodeURIComponent(arguments[1]);for(var h=2;h<arguments.length;h++)u+="&args[]="+encodeURIComponent(arguments[h])}return"Minified React error #"+c+"; visit "+u+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function t(){}var n={d:{f:t,r:function(){throw Error(e(522))},D:t,C:t,L:t,m:t,X:t,S:t,M:t},p:0,findDOMNode:null},r=Symbol.for("react.portal");function a(c,u,h){var f=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:r,key:f==null?null:""+f,children:c,containerInfo:u,implementation:h}}var i=o.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function s(c,u){if(c==="font")return"";if(typeof u=="string")return u==="use-credentials"?u:""}return zr.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=n,zr.createPortal=function(c,u){var h=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!u||u.nodeType!==1&&u.nodeType!==9&&u.nodeType!==11)throw Error(e(299));return a(c,u,null,h)},zr.flushSync=function(c){var u=i.T,h=n.p;try{if(i.T=null,n.p=2,c)return c()}finally{i.T=u,n.p=h,n.d.f()}},zr.preconnect=function(c,u){typeof c=="string"&&(u?(u=u.crossOrigin,u=typeof u=="string"?u==="use-credentials"?u:"":void 0):u=null,n.d.C(c,u))},zr.prefetchDNS=function(c){typeof c=="string"&&n.d.D(c)},zr.preinit=function(c,u){if(typeof c=="string"&&u&&typeof u.as=="string"){var h=u.as,f=s(h,u.crossOrigin),m=typeof u.integrity=="string"?u.integrity:void 0,g=typeof u.fetchPriority=="string"?u.fetchPriority:void 0;h==="style"?n.d.S(c,typeof u.precedence=="string"?u.precedence:void 0,{crossOrigin:f,integrity:m,fetchPriority:g}):h==="script"&&n.d.X(c,{crossOrigin:f,integrity:m,fetchPriority:g,nonce:typeof u.nonce=="string"?u.nonce:void 0})}},zr.preinitModule=function(c,u){if(typeof c=="string")if(typeof u=="object"&&u!==null){if(u.as==null||u.as==="script"){var h=s(u.as,u.crossOrigin);n.d.M(c,{crossOrigin:h,integrity:typeof u.integrity=="string"?u.integrity:void 0,nonce:typeof u.nonce=="string"?u.nonce:void 0})}}else u==null&&n.d.M(c)},zr.preload=function(c,u){if(typeof c=="string"&&typeof u=="object"&&u!==null&&typeof u.as=="string"){var h=u.as,f=s(h,u.crossOrigin);n.d.L(c,h,{crossOrigin:f,integrity:typeof u.integrity=="string"?u.integrity:void 0,nonce:typeof u.nonce=="string"?u.nonce:void 0,type:typeof u.type=="string"?u.type:void 0,fetchPriority:typeof u.fetchPriority=="string"?u.fetchPriority:void 0,referrerPolicy:typeof u.referrerPolicy=="string"?u.referrerPolicy:void 0,imageSrcSet:typeof u.imageSrcSet=="string"?u.imageSrcSet:void 0,imageSizes:typeof u.imageSizes=="string"?u.imageSizes:void 0,media:typeof u.media=="string"?u.media:void 0})}},zr.preloadModule=function(c,u){if(typeof c=="string")if(u){var h=s(u.as,u.crossOrigin);n.d.m(c,{as:typeof u.as=="string"&&u.as!=="script"?u.as:void 0,crossOrigin:h,integrity:typeof u.integrity=="string"?u.integrity:void 0})}else n.d.m(c)},zr.requestFormReset=function(c){n.d.r(c)},zr.unstable_batchedUpdates=function(c,u){return c(u)},zr.useFormState=function(c,u,h){return i.H.useFormState(c,u,h)},zr.useFormStatus=function(){return i.H.useHostTransitionStatus()},zr.version="19.0.0",zr}var XC;function uR(){if(XC)return G_.exports;XC=1;function o(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(o)}catch(e){console.error(e)}}return o(),G_.exports=KD(),G_.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var qC;function $D(){if(qC)return If;qC=1;var o=ZD(),e=ny(),t=uR();function n(l){var d="https://react.dev/errors/"+l;if(1<arguments.length){d+="?args[]="+encodeURIComponent(arguments[1]);for(var p=2;p<arguments.length;p++)d+="&args[]="+encodeURIComponent(arguments[p])}return"Minified React error #"+l+"; visit "+d+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function r(l){return!(!l||l.nodeType!==1&&l.nodeType!==9&&l.nodeType!==11)}var a=Symbol.for("react.element"),i=Symbol.for("react.transitional.element"),s=Symbol.for("react.portal"),c=Symbol.for("react.fragment"),u=Symbol.for("react.strict_mode"),h=Symbol.for("react.profiler"),f=Symbol.for("react.provider"),m=Symbol.for("react.consumer"),g=Symbol.for("react.context"),A=Symbol.for("react.forward_ref"),_=Symbol.for("react.suspense"),x=Symbol.for("react.suspense_list"),C=Symbol.for("react.memo"),b=Symbol.for("react.lazy"),y=Symbol.for("react.offscreen"),M=Symbol.for("react.memo_cache_sentinel"),R=Symbol.iterator;function T(l){return l===null||typeof l!="object"?null:(l=R&&l[R]||l["@@iterator"],typeof l=="function"?l:null)}var w=Symbol.for("react.client.reference");function D(l){if(l==null)return null;if(typeof l=="function")return l.$$typeof===w?null:l.displayName||l.name||null;if(typeof l=="string")return l;switch(l){case c:return"Fragment";case s:return"Portal";case h:return"Profiler";case u:return"StrictMode";case _:return"Suspense";case x:return"SuspenseList"}if(typeof l=="object")switch(l.$$typeof){case g:return(l.displayName||"Context")+".Provider";case m:return(l._context.displayName||"Context")+".Consumer";case A:var d=l.render;return l=l.displayName,l||(l=d.displayName||d.name||"",l=l!==""?"ForwardRef("+l+")":"ForwardRef"),l;case C:return d=l.displayName||null,d!==null?d:D(l.type)||"Memo";case b:d=l._payload,l=l._init;try{return D(l(d))}catch{}}return null}var z=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,F=Object.assign,O,q;function ne(l){if(O===void 0)try{throw Error()}catch(p){var d=p.stack.trim().match(/\n( *(at )?)/);O=d&&d[1]||"",q=-1<p.stack.indexOf(`
    at`)?" (<anonymous>)":-1<p.stack.indexOf("@")?"@unknown:0:0":""}return`
`+O+l+q}var $=!1;function he(l,d){if(!l||$)return"";$=!0;var p=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var v={DetermineComponentFrameRoot:function(){try{if(d){var ke=function(){throw Error()};if(Object.defineProperty(ke.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(ke,[])}catch(Oe){var Be=Oe}Reflect.construct(l,[],ke)}else{try{ke.call()}catch(Oe){Be=Oe}l.call(ke.prototype)}}else{try{throw Error()}catch(Oe){Be=Oe}(ke=l())&&typeof ke.catch=="function"&&ke.catch(function(){})}}catch(Oe){if(Oe&&Be&&typeof Oe.stack=="string")return[Oe.stack,Be.stack]}return[null,null]}};v.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var S=Object.getOwnPropertyDescriptor(v.DetermineComponentFrameRoot,"name");S&&S.configurable&&Object.defineProperty(v.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var E=v.DetermineComponentFrameRoot(),H=E[0],ae=E[1];if(H&&ae){var ge=H.split(`
`),Se=ae.split(`
`);for(S=v=0;v<ge.length&&!ge[v].includes("DetermineComponentFrameRoot");)v++;for(;S<Se.length&&!Se[S].includes("DetermineComponentFrameRoot");)S++;if(v===ge.length||S===Se.length)for(v=ge.length-1,S=Se.length-1;1<=v&&0<=S&&ge[v]!==Se[S];)S--;for(;1<=v&&0<=S;v--,S--)if(ge[v]!==Se[S]){if(v!==1||S!==1)do if(v--,S--,0>S||ge[v]!==Se[S]){var Fe=`
`+ge[v].replace(" at new "," at ");return l.displayName&&Fe.includes("<anonymous>")&&(Fe=Fe.replace("<anonymous>",l.displayName)),Fe}while(1<=v&&0<=S);break}}}finally{$=!1,Error.prepareStackTrace=p}return(p=l?l.displayName||l.name:"")?ne(p):""}function K(l){switch(l.tag){case 26:case 27:case 5:return ne(l.type);case 16:return ne("Lazy");case 13:return ne("Suspense");case 19:return ne("SuspenseList");case 0:case 15:return l=he(l.type,!1),l;case 11:return l=he(l.type.render,!1),l;case 1:return l=he(l.type,!0),l;default:return""}}function oe(l){try{var d="";do d+=K(l),l=l.return;while(l);return d}catch(p){return`
Error generating stack: `+p.message+`
`+p.stack}}function ie(l){var d=l,p=l;if(l.alternate)for(;d.return;)d=d.return;else{l=d;do d=l,(d.flags&4098)!==0&&(p=d.return),l=d.return;while(l)}return d.tag===3?p:null}function L(l){if(l.tag===13){var d=l.memoizedState;if(d===null&&(l=l.alternate,l!==null&&(d=l.memoizedState)),d!==null)return d.dehydrated}return null}function U(l){if(ie(l)!==l)throw Error(n(188))}function k(l){var d=l.alternate;if(!d){if(d=ie(l),d===null)throw Error(n(188));return d!==l?null:l}for(var p=l,v=d;;){var S=p.return;if(S===null)break;var E=S.alternate;if(E===null){if(v=S.return,v!==null){p=v;continue}break}if(S.child===E.child){for(E=S.child;E;){if(E===p)return U(S),l;if(E===v)return U(S),d;E=E.sibling}throw Error(n(188))}if(p.return!==v.return)p=S,v=E;else{for(var H=!1,ae=S.child;ae;){if(ae===p){H=!0,p=S,v=E;break}if(ae===v){H=!0,v=S,p=E;break}ae=ae.sibling}if(!H){for(ae=E.child;ae;){if(ae===p){H=!0,p=E,v=S;break}if(ae===v){H=!0,v=E,p=S;break}ae=ae.sibling}if(!H)throw Error(n(189))}}if(p.alternate!==v)throw Error(n(190))}if(p.tag!==3)throw Error(n(188));return p.stateNode.current===p?l:d}function J(l){var d=l.tag;if(d===5||d===26||d===27||d===6)return l;for(l=l.child;l!==null;){if(d=J(l),d!==null)return d;l=l.sibling}return null}var de=Array.isArray,te=t.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,le={pending:!1,data:null,method:null,action:null},V=[],G=-1;function ee(l){return{current:l}}function X(l){0>G||(l.current=V[G],V[G]=null,G--)}function W(l,d){G++,V[G]=l.current,l.current=d}var Y=ee(null),P=ee(null),Q=ee(null),I=ee(null);function N(l,d){switch(W(Q,d),W(P,l),W(Y,null),l=d.nodeType,l){case 9:case 11:d=(d=d.documentElement)&&(d=d.namespaceURI)?gC(d):0;break;default:if(l=l===8?d.parentNode:d,d=l.tagName,l=l.namespaceURI)l=gC(l),d=vC(l,d);else switch(d){case"svg":d=1;break;case"math":d=2;break;default:d=0}}X(Y),W(Y,d)}function se(){X(Y),X(P),X(Q)}function ce(l){l.memoizedState!==null&&W(I,l);var d=Y.current,p=vC(d,l.type);d!==p&&(W(P,l),W(Y,p))}function fe(l){P.current===l&&(X(Y),X(P)),I.current===l&&(X(I),Cf._currentValue=le)}var ve=Object.prototype.hasOwnProperty,xe=o.unstable_scheduleCallback,Ie=o.unstable_cancelCallback,re=o.unstable_shouldYield,me=o.unstable_requestPaint,pe=o.unstable_now,Ce=o.unstable_getCurrentPriorityLevel,we=o.unstable_ImmediatePriority,be=o.unstable_UserBlockingPriority,Pe=o.unstable_NormalPriority,Ge=o.unstable_LowPriority,tt=o.unstable_IdlePriority,ot=o.log,Pt=o.unstable_setDisableYieldValue,$t=null,St=null;function De(l){if(St&&typeof St.onCommitFiberRoot=="function")try{St.onCommitFiberRoot($t,l,void 0,(l.current.flags&128)===128)}catch{}}function Un(l){if(typeof ot=="function"&&Pt(l),St&&typeof St.setStrictMode=="function")try{St.setStrictMode($t,l)}catch{}}var dn=Math.clz32?Math.clz32:Bn,Nt=Math.log,rn=Math.LN2;function Bn(l){return l>>>=0,l===0?32:31-(Nt(l)/rn|0)|0}var io=128,Mr=4194304;function Xn(l){var d=l&42;if(d!==0)return d;switch(l&-l){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return l&4194176;case 4194304:case 8388608:case 16777216:case 33554432:return l&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return l}}function gn(l,d){var p=l.pendingLanes;if(p===0)return 0;var v=0,S=l.suspendedLanes,E=l.pingedLanes,H=l.warmLanes;l=l.finishedLanes!==0;var ae=p&134217727;return ae!==0?(p=ae&~S,p!==0?v=Xn(p):(E&=ae,E!==0?v=Xn(E):l||(H=ae&~H,H!==0&&(v=Xn(H))))):(ae=p&~S,ae!==0?v=Xn(ae):E!==0?v=Xn(E):l||(H=p&~H,H!==0&&(v=Xn(H)))),v===0?0:d!==0&&d!==v&&(d&S)===0&&(S=v&-v,H=d&-d,S>=H||S===32&&(H&4194176)!==0)?d:v}function Wa(l,d){return(l.pendingLanes&~(l.suspendedLanes&~l.pingedLanes)&d)===0}function ga(l,d){switch(l){case 1:case 2:case 4:case 8:return d+250;case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return d+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function xl(){var l=io;return io<<=1,(io&4194176)===0&&(io=128),l}function So(){var l=Mr;return Mr<<=1,(Mr&62914560)===0&&(Mr=4194304),l}function Co(l){for(var d=[],p=0;31>p;p++)d.push(l);return d}function Si(l,d){l.pendingLanes|=d,d!==268435456&&(l.suspendedLanes=0,l.pingedLanes=0,l.warmLanes=0)}function Ci(l,d,p,v,S,E){var H=l.pendingLanes;l.pendingLanes=p,l.suspendedLanes=0,l.pingedLanes=0,l.warmLanes=0,l.expiredLanes&=p,l.entangledLanes&=p,l.errorRecoveryDisabledLanes&=p,l.shellSuspendCounter=0;var ae=l.entanglements,ge=l.expirationTimes,Se=l.hiddenUpdates;for(p=H&~p;0<p;){var Fe=31-dn(p),ke=1<<Fe;ae[Fe]=0,ge[Fe]=-1;var Be=Se[Fe];if(Be!==null)for(Se[Fe]=null,Fe=0;Fe<Be.length;Fe++){var Oe=Be[Fe];Oe!==null&&(Oe.lane&=-536870913)}p&=~ke}v!==0&&yl(l,v,0),E!==0&&S===0&&l.tag!==0&&(l.suspendedLanes|=E&~(H&~d))}function yl(l,d,p){l.pendingLanes|=d,l.suspendedLanes&=~d;var v=31-dn(d);l.entangledLanes|=d,l.entanglements[v]=l.entanglements[v]|1073741824|p&4194218}function bl(l,d){var p=l.entangledLanes|=d;for(l=l.entanglements;p;){var v=31-dn(p),S=1<<v;S&d|l[v]&d&&(l[v]|=d),p&=~S}}function Eo(l){return l&=-l,2<l?8<l?(l&134217727)!==0?32:268435456:8:2}function Z(){var l=te.p;return l!==0?l:(l=window.event,l===void 0?32:DC(l.type))}function Te(l,d){var p=te.p;try{return te.p=l,d()}finally{te.p=p}}var Le=Math.random().toString(36).slice(2),Ue="__reactFiber$"+Le,Ne="__reactProps$"+Le,We="__reactContainer$"+Le,gt="__reactEvents$"+Le,vt="__reactListeners$"+Le,Rt="__reactHandles$"+Le,Lt="__reactResources$"+Le,zt="__reactMarker$"+Le;function Sn(l){delete l[Ue],delete l[Ne],delete l[gt],delete l[vt],delete l[Rt]}function Dt(l){var d=l[Ue];if(d)return d;for(var p=l.parentNode;p;){if(d=p[We]||p[Ue]){if(p=d.alternate,d.child!==null||p!==null&&p.child!==null)for(l=xC(l);l!==null;){if(p=l[Ue])return p;l=xC(l)}return d}l=p,p=l.parentNode}return null}function ht(l){if(l=l[Ue]||l[We]){var d=l.tag;if(d===5||d===6||d===13||d===26||d===27||d===3)return l}return null}function on(l){var d=l.tag;if(d===5||d===26||d===27||d===6)return l.stateNode;throw Error(n(33))}function so(l){var d=l[Lt];return d||(d=l[Lt]={hoistableStyles:new Map,hoistableScripts:new Map}),d}function Ot(l){l[zt]=!0}var Pn=new Set,Mo={};function Cn(l,d){qe(l,d),qe(l+"Capture",d)}function qe(l,d){for(Mo[l]=d,l=0;l<d.length;l++)Pn.add(d[l])}var Wt=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Nd=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),vp={},_p={};function Uv(l){return ve.call(_p,l)?!0:ve.call(vp,l)?!1:Nd.test(l)?_p[l]=!0:(vp[l]=!0,!1)}function Nc(l,d,p){if(Uv(d))if(p===null)l.removeAttribute(d);else{switch(typeof p){case"undefined":case"function":case"symbol":l.removeAttribute(d);return;case"boolean":var v=d.toLowerCase().slice(0,5);if(v!=="data-"&&v!=="aria-"){l.removeAttribute(d);return}}l.setAttribute(d,""+p)}}function Dc(l,d,p){if(p===null)l.removeAttribute(d);else{switch(typeof p){case"undefined":case"function":case"symbol":case"boolean":l.removeAttribute(d);return}l.setAttribute(d,""+p)}}function va(l,d,p,v){if(v===null)l.removeAttribute(p);else{switch(typeof v){case"undefined":case"function":case"symbol":case"boolean":l.removeAttribute(p);return}l.setAttributeNS(d,p,""+v)}}function lo(l){switch(typeof l){case"bigint":case"boolean":case"number":case"string":case"undefined":return l;case"object":return l;default:return""}}function Ap(l){var d=l.type;return(l=l.nodeName)&&l.toLowerCase()==="input"&&(d==="checkbox"||d==="radio")}function zv(l){var d=Ap(l)?"checked":"value",p=Object.getOwnPropertyDescriptor(l.constructor.prototype,d),v=""+l[d];if(!l.hasOwnProperty(d)&&typeof p<"u"&&typeof p.get=="function"&&typeof p.set=="function"){var S=p.get,E=p.set;return Object.defineProperty(l,d,{configurable:!0,get:function(){return S.call(this)},set:function(H){v=""+H,E.call(this,H)}}),Object.defineProperty(l,d,{enumerable:p.enumerable}),{getValue:function(){return v},setValue:function(H){v=""+H},stopTracking:function(){l._valueTracker=null,delete l[d]}}}}function Sl(l){l._valueTracker||(l._valueTracker=zv(l))}function xp(l){if(!l)return!1;var d=l._valueTracker;if(!d)return!0;var p=d.getValue(),v="";return l&&(v=Ap(l)?l.checked?"true":"false":l.value),l=v,l!==p?(d.setValue(l),!0):!1}function Oc(l){if(l=l||(typeof document<"u"?document:void 0),typeof l>"u")return null;try{return l.activeElement||l.body}catch{return l.body}}var jt=/[\n"\\]/g;function co(l){return l.replace(jt,function(d){return"\\"+d.charCodeAt(0).toString(16)+" "})}function Cl(l,d,p,v,S,E,H,ae){l.name="",H!=null&&typeof H!="function"&&typeof H!="symbol"&&typeof H!="boolean"?l.type=H:l.removeAttribute("type"),d!=null?H==="number"?(d===0&&l.value===""||l.value!=d)&&(l.value=""+lo(d)):l.value!==""+lo(d)&&(l.value=""+lo(d)):H!=="submit"&&H!=="reset"||l.removeAttribute("value"),d!=null?uo(l,H,lo(d)):p!=null?uo(l,H,lo(p)):v!=null&&l.removeAttribute("value"),S==null&&E!=null&&(l.defaultChecked=!!E),S!=null&&(l.checked=S&&typeof S!="function"&&typeof S!="symbol"),ae!=null&&typeof ae!="function"&&typeof ae!="symbol"&&typeof ae!="boolean"?l.name=""+lo(ae):l.removeAttribute("name")}function yp(l,d,p,v,S,E,H,ae){if(E!=null&&typeof E!="function"&&typeof E!="symbol"&&typeof E!="boolean"&&(l.type=E),d!=null||p!=null){if(!(E!=="submit"&&E!=="reset"||d!=null))return;p=p!=null?""+lo(p):"",d=d!=null?""+lo(d):p,ae||d===l.value||(l.value=d),l.defaultValue=d}v=v??S,v=typeof v!="function"&&typeof v!="symbol"&&!!v,l.checked=ae?l.checked:!!v,l.defaultChecked=!!v,H!=null&&typeof H!="function"&&typeof H!="symbol"&&typeof H!="boolean"&&(l.name=H)}function uo(l,d,p){d==="number"&&Oc(l.ownerDocument)===l||l.defaultValue===""+p||(l.defaultValue=""+p)}function Ei(l,d,p,v){if(l=l.options,d){d={};for(var S=0;S<p.length;S++)d["$"+p[S]]=!0;for(p=0;p<l.length;p++)S=d.hasOwnProperty("$"+l[p].value),l[p].selected!==S&&(l[p].selected=S),S&&v&&(l[p].defaultSelected=!0)}else{for(p=""+lo(p),d=null,S=0;S<l.length;S++){if(l[S].value===p){l[S].selected=!0,v&&(l[S].defaultSelected=!0);return}d!==null||l[S].disabled||(d=l[S])}d!==null&&(d.selected=!0)}}function Ya(l,d,p){if(d!=null&&(d=""+lo(d),d!==l.value&&(l.value=d),p==null)){l.defaultValue!==d&&(l.defaultValue=d);return}l.defaultValue=p!=null?""+lo(p):""}function Dd(l,d,p,v){if(d==null){if(v!=null){if(p!=null)throw Error(n(92));if(de(v)){if(1<v.length)throw Error(n(93));v=v[0]}p=v}p==null&&(p=""),d=p}p=lo(d),l.defaultValue=p,v=l.textContent,v===p&&v!==""&&v!==null&&(l.value=v)}function wo(l,d){if(d){var p=l.firstChild;if(p&&p===l.lastChild&&p.nodeType===3){p.nodeValue=d;return}}l.textContent=d}var Od=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function At(l,d,p){var v=d.indexOf("--")===0;p==null||typeof p=="boolean"||p===""?v?l.setProperty(d,""):d==="float"?l.cssFloat="":l[d]="":v?l.setProperty(d,p):typeof p!="number"||p===0||Od.has(d)?d==="float"?l.cssFloat=p:l[d]=(""+p).trim():l[d]=p+"px"}function ja(l,d,p){if(d!=null&&typeof d!="object")throw Error(n(62));if(l=l.style,p!=null){for(var v in p)!p.hasOwnProperty(v)||d!=null&&d.hasOwnProperty(v)||(v.indexOf("--")===0?l.setProperty(v,""):v==="float"?l.cssFloat="":l[v]="");for(var S in d)v=d[S],d.hasOwnProperty(S)&&p[S]!==v&&At(l,S,v)}else for(var E in d)d.hasOwnProperty(E)&&At(l,E,d[E])}function El(l){if(l.indexOf("-")===-1)return!1;switch(l){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var fo=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),jr=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Ml(l){return jr.test(""+l)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":l}var Jt=null;function En(l){return l=l.target||l.srcElement||window,l.correspondingUseElement&&(l=l.correspondingUseElement),l.nodeType===3?l.parentNode:l}var _a=null,Aa=null;function Mb(l){var d=ht(l);if(d&&(l=d.stateNode)){var p=l[Ne]||null;e:switch(l=d.stateNode,d.type){case"input":if(Cl(l,p.value,p.defaultValue,p.defaultValue,p.checked,p.defaultChecked,p.type,p.name),d=p.name,p.type==="radio"&&d!=null){for(p=l;p.parentNode;)p=p.parentNode;for(p=p.querySelectorAll('input[name="'+co(""+d)+'"][type="radio"]'),d=0;d<p.length;d++){var v=p[d];if(v!==l&&v.form===l.form){var S=v[Ne]||null;if(!S)throw Error(n(90));Cl(v,S.value,S.defaultValue,S.defaultValue,S.checked,S.defaultChecked,S.type,S.name)}}for(d=0;d<p.length;d++)v=p[d],v.form===l.form&&xp(v)}break e;case"textarea":Ya(l,p.value,p.defaultValue);break e;case"select":d=p.value,d!=null&&Ei(l,!!p.multiple,d,!1)}}}var Vv=!1;function wb(l,d,p){if(Vv)return l(d,p);Vv=!0;try{var v=l(d);return v}finally{if(Vv=!1,(_a!==null||Aa!==null)&&(om(),_a&&(d=_a,l=Aa,Aa=_a=null,Mb(d),l)))for(d=0;d<l.length;d++)Mb(l[d])}}function Fd(l,d){var p=l.stateNode;if(p===null)return null;var v=p[Ne]||null;if(v===null)return null;p=v[d];e:switch(d){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(v=!v.disabled)||(l=l.type,v=!(l==="button"||l==="input"||l==="select"||l==="textarea")),l=!v;break e;default:l=!1}if(l)return null;if(p&&typeof p!="function")throw Error(n(231,d,typeof p));return p}var kv=!1;if(Wt)try{var Ud={};Object.defineProperty(Ud,"passive",{get:function(){kv=!0}}),window.addEventListener("test",Ud,Ud),window.removeEventListener("test",Ud,Ud)}catch{kv=!1}var gs=null,Gv=null,bp=null;function Tb(){if(bp)return bp;var l,d=Gv,p=d.length,v,S="value"in gs?gs.value:gs.textContent,E=S.length;for(l=0;l<p&&d[l]===S[l];l++);var H=p-l;for(v=1;v<=H&&d[p-v]===S[E-v];v++);return bp=S.slice(l,1<v?1-v:void 0)}function Sp(l){var d=l.keyCode;return"charCode"in l?(l=l.charCode,l===0&&d===13&&(l=13)):l=d,l===10&&(l=13),32<=l||l===13?l:0}function Cp(){return!0}function Rb(){return!1}function ho(l){function d(p,v,S,E,H){this._reactName=p,this._targetInst=S,this.type=v,this.nativeEvent=E,this.target=H,this.currentTarget=null;for(var ae in l)l.hasOwnProperty(ae)&&(p=l[ae],this[ae]=p?p(E):E[ae]);return this.isDefaultPrevented=(E.defaultPrevented!=null?E.defaultPrevented:E.returnValue===!1)?Cp:Rb,this.isPropagationStopped=Rb,this}return F(d.prototype,{preventDefault:function(){this.defaultPrevented=!0;var p=this.nativeEvent;p&&(p.preventDefault?p.preventDefault():typeof p.returnValue!="unknown"&&(p.returnValue=!1),this.isDefaultPrevented=Cp)},stopPropagation:function(){var p=this.nativeEvent;p&&(p.stopPropagation?p.stopPropagation():typeof p.cancelBubble!="unknown"&&(p.cancelBubble=!0),this.isPropagationStopped=Cp)},persist:function(){},isPersistent:Cp}),d}var wl={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(l){return l.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Ep=ho(wl),zd=F({},wl,{view:0,detail:0}),QP=ho(zd),Qv,Hv,Vd,Mp=F({},zd,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Yv,button:0,buttons:0,relatedTarget:function(l){return l.relatedTarget===void 0?l.fromElement===l.srcElement?l.toElement:l.fromElement:l.relatedTarget},movementX:function(l){return"movementX"in l?l.movementX:(l!==Vd&&(Vd&&l.type==="mousemove"?(Qv=l.screenX-Vd.screenX,Hv=l.screenY-Vd.screenY):Hv=Qv=0,Vd=l),Qv)},movementY:function(l){return"movementY"in l?l.movementY:Hv}}),Ib=ho(Mp),HP=F({},Mp,{dataTransfer:0}),WP=ho(HP),YP=F({},zd,{relatedTarget:0}),Wv=ho(YP),jP=F({},wl,{animationName:0,elapsedTime:0,pseudoElement:0}),XP=ho(jP),qP=F({},wl,{clipboardData:function(l){return"clipboardData"in l?l.clipboardData:window.clipboardData}}),ZP=ho(qP),KP=F({},wl,{data:0}),Lb=ho(KP),$P={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},JP={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},eN={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function tN(l){var d=this.nativeEvent;return d.getModifierState?d.getModifierState(l):(l=eN[l])?!!d[l]:!1}function Yv(){return tN}var nN=F({},zd,{key:function(l){if(l.key){var d=$P[l.key]||l.key;if(d!=="Unidentified")return d}return l.type==="keypress"?(l=Sp(l),l===13?"Enter":String.fromCharCode(l)):l.type==="keydown"||l.type==="keyup"?JP[l.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Yv,charCode:function(l){return l.type==="keypress"?Sp(l):0},keyCode:function(l){return l.type==="keydown"||l.type==="keyup"?l.keyCode:0},which:function(l){return l.type==="keypress"?Sp(l):l.type==="keydown"||l.type==="keyup"?l.keyCode:0}}),rN=ho(nN),oN=F({},Mp,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Bb=ho(oN),aN=F({},zd,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Yv}),iN=ho(aN),sN=F({},wl,{propertyName:0,elapsedTime:0,pseudoElement:0}),lN=ho(sN),cN=F({},Mp,{deltaX:function(l){return"deltaX"in l?l.deltaX:"wheelDeltaX"in l?-l.wheelDeltaX:0},deltaY:function(l){return"deltaY"in l?l.deltaY:"wheelDeltaY"in l?-l.wheelDeltaY:"wheelDelta"in l?-l.wheelDelta:0},deltaZ:0,deltaMode:0}),uN=ho(cN),dN=F({},wl,{newState:0,oldState:0}),fN=ho(dN),hN=[9,13,27,32],jv=Wt&&"CompositionEvent"in window,kd=null;Wt&&"documentMode"in document&&(kd=document.documentMode);var pN=Wt&&"TextEvent"in window&&!kd,Pb=Wt&&(!jv||kd&&8<kd&&11>=kd),Nb=" ",Db=!1;function Ob(l,d){switch(l){case"keyup":return hN.indexOf(d.keyCode)!==-1;case"keydown":return d.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Fb(l){return l=l.detail,typeof l=="object"&&"data"in l?l.data:null}var Fc=!1;function mN(l,d){switch(l){case"compositionend":return Fb(d);case"keypress":return d.which!==32?null:(Db=!0,Nb);case"textInput":return l=d.data,l===Nb&&Db?null:l;default:return null}}function gN(l,d){if(Fc)return l==="compositionend"||!jv&&Ob(l,d)?(l=Tb(),bp=Gv=gs=null,Fc=!1,l):null;switch(l){case"paste":return null;case"keypress":if(!(d.ctrlKey||d.altKey||d.metaKey)||d.ctrlKey&&d.altKey){if(d.char&&1<d.char.length)return d.char;if(d.which)return String.fromCharCode(d.which)}return null;case"compositionend":return Pb&&d.locale!=="ko"?null:d.data;default:return null}}var vN={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Ub(l){var d=l&&l.nodeName&&l.nodeName.toLowerCase();return d==="input"?!!vN[l.type]:d==="textarea"}function zb(l,d,p,v){_a?Aa?Aa.push(v):Aa=[v]:_a=v,d=cm(d,"onChange"),0<d.length&&(p=new Ep("onChange","change",null,p,v),l.push({event:p,listeners:d}))}var Gd=null,Qd=null;function _N(l){dC(l,0)}function wp(l){var d=on(l);if(xp(d))return l}function Vb(l,d){if(l==="change")return d}var kb=!1;if(Wt){var Xv;if(Wt){var qv="oninput"in document;if(!qv){var Gb=document.createElement("div");Gb.setAttribute("oninput","return;"),qv=typeof Gb.oninput=="function"}Xv=qv}else Xv=!1;kb=Xv&&(!document.documentMode||9<document.documentMode)}function Qb(){Gd&&(Gd.detachEvent("onpropertychange",Hb),Qd=Gd=null)}function Hb(l){if(l.propertyName==="value"&&wp(Qd)){var d=[];zb(d,Qd,l,En(l)),wb(_N,d)}}function AN(l,d,p){l==="focusin"?(Qb(),Gd=d,Qd=p,Gd.attachEvent("onpropertychange",Hb)):l==="focusout"&&Qb()}function xN(l){if(l==="selectionchange"||l==="keyup"||l==="keydown")return wp(Qd)}function yN(l,d){if(l==="click")return wp(d)}function bN(l,d){if(l==="input"||l==="change")return wp(d)}function SN(l,d){return l===d&&(l!==0||1/l===1/d)||l!==l&&d!==d}var To=typeof Object.is=="function"?Object.is:SN;function Hd(l,d){if(To(l,d))return!0;if(typeof l!="object"||l===null||typeof d!="object"||d===null)return!1;var p=Object.keys(l),v=Object.keys(d);if(p.length!==v.length)return!1;for(v=0;v<p.length;v++){var S=p[v];if(!ve.call(d,S)||!To(l[S],d[S]))return!1}return!0}function Wb(l){for(;l&&l.firstChild;)l=l.firstChild;return l}function Yb(l,d){var p=Wb(l);l=0;for(var v;p;){if(p.nodeType===3){if(v=l+p.textContent.length,l<=d&&v>=d)return{node:p,offset:d-l};l=v}e:{for(;p;){if(p.nextSibling){p=p.nextSibling;break e}p=p.parentNode}p=void 0}p=Wb(p)}}function jb(l,d){return l&&d?l===d?!0:l&&l.nodeType===3?!1:d&&d.nodeType===3?jb(l,d.parentNode):"contains"in l?l.contains(d):l.compareDocumentPosition?!!(l.compareDocumentPosition(d)&16):!1:!1}function Xb(l){l=l!=null&&l.ownerDocument!=null&&l.ownerDocument.defaultView!=null?l.ownerDocument.defaultView:window;for(var d=Oc(l.document);d instanceof l.HTMLIFrameElement;){try{var p=typeof d.contentWindow.location.href=="string"}catch{p=!1}if(p)l=d.contentWindow;else break;d=Oc(l.document)}return d}function Zv(l){var d=l&&l.nodeName&&l.nodeName.toLowerCase();return d&&(d==="input"&&(l.type==="text"||l.type==="search"||l.type==="tel"||l.type==="url"||l.type==="password")||d==="textarea"||l.contentEditable==="true")}function CN(l,d){var p=Xb(d);d=l.focusedElem;var v=l.selectionRange;if(p!==d&&d&&d.ownerDocument&&jb(d.ownerDocument.documentElement,d)){if(v!==null&&Zv(d)){if(l=v.start,p=v.end,p===void 0&&(p=l),"selectionStart"in d)d.selectionStart=l,d.selectionEnd=Math.min(p,d.value.length);else if(p=(l=d.ownerDocument||document)&&l.defaultView||window,p.getSelection){p=p.getSelection();var S=d.textContent.length,E=Math.min(v.start,S);v=v.end===void 0?E:Math.min(v.end,S),!p.extend&&E>v&&(S=v,v=E,E=S),S=Yb(d,E);var H=Yb(d,v);S&&H&&(p.rangeCount!==1||p.anchorNode!==S.node||p.anchorOffset!==S.offset||p.focusNode!==H.node||p.focusOffset!==H.offset)&&(l=l.createRange(),l.setStart(S.node,S.offset),p.removeAllRanges(),E>v?(p.addRange(l),p.extend(H.node,H.offset)):(l.setEnd(H.node,H.offset),p.addRange(l)))}}for(l=[],p=d;p=p.parentNode;)p.nodeType===1&&l.push({element:p,left:p.scrollLeft,top:p.scrollTop});for(typeof d.focus=="function"&&d.focus(),d=0;d<l.length;d++)p=l[d],p.element.scrollLeft=p.left,p.element.scrollTop=p.top}}var EN=Wt&&"documentMode"in document&&11>=document.documentMode,Uc=null,Kv=null,Wd=null,$v=!1;function qb(l,d,p){var v=p.window===p?p.document:p.nodeType===9?p:p.ownerDocument;$v||Uc==null||Uc!==Oc(v)||(v=Uc,"selectionStart"in v&&Zv(v)?v={start:v.selectionStart,end:v.selectionEnd}:(v=(v.ownerDocument&&v.ownerDocument.defaultView||window).getSelection(),v={anchorNode:v.anchorNode,anchorOffset:v.anchorOffset,focusNode:v.focusNode,focusOffset:v.focusOffset}),Wd&&Hd(Wd,v)||(Wd=v,v=cm(Kv,"onSelect"),0<v.length&&(d=new Ep("onSelect","select",null,d,p),l.push({event:d,listeners:v}),d.target=Uc)))}function Tl(l,d){var p={};return p[l.toLowerCase()]=d.toLowerCase(),p["Webkit"+l]="webkit"+d,p["Moz"+l]="moz"+d,p}var zc={animationend:Tl("Animation","AnimationEnd"),animationiteration:Tl("Animation","AnimationIteration"),animationstart:Tl("Animation","AnimationStart"),transitionrun:Tl("Transition","TransitionRun"),transitionstart:Tl("Transition","TransitionStart"),transitioncancel:Tl("Transition","TransitionCancel"),transitionend:Tl("Transition","TransitionEnd")},Jv={},Zb={};Wt&&(Zb=document.createElement("div").style,"AnimationEvent"in window||(delete zc.animationend.animation,delete zc.animationiteration.animation,delete zc.animationstart.animation),"TransitionEvent"in window||delete zc.transitionend.transition);function Rl(l){if(Jv[l])return Jv[l];if(!zc[l])return l;var d=zc[l],p;for(p in d)if(d.hasOwnProperty(p)&&p in Zb)return Jv[l]=d[p];return l}var Kb=Rl("animationend"),$b=Rl("animationiteration"),Jb=Rl("animationstart"),MN=Rl("transitionrun"),wN=Rl("transitionstart"),TN=Rl("transitioncancel"),e3=Rl("transitionend"),t3=new Map,n3="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll scrollEnd toggle touchMove waiting wheel".split(" ");function xa(l,d){t3.set(l,d),Cn(d,[l])}var Xo=[],Vc=0,e1=0;function Tp(){for(var l=Vc,d=e1=Vc=0;d<l;){var p=Xo[d];Xo[d++]=null;var v=Xo[d];Xo[d++]=null;var S=Xo[d];Xo[d++]=null;var E=Xo[d];if(Xo[d++]=null,v!==null&&S!==null){var H=v.pending;H===null?S.next=S:(S.next=H.next,H.next=S),v.pending=S}E!==0&&r3(p,S,E)}}function Rp(l,d,p,v){Xo[Vc++]=l,Xo[Vc++]=d,Xo[Vc++]=p,Xo[Vc++]=v,e1|=v,l.lanes|=v,l=l.alternate,l!==null&&(l.lanes|=v)}function t1(l,d,p,v){return Rp(l,d,p,v),Ip(l)}function vs(l,d){return Rp(l,null,null,d),Ip(l)}function r3(l,d,p){l.lanes|=p;var v=l.alternate;v!==null&&(v.lanes|=p);for(var S=!1,E=l.return;E!==null;)E.childLanes|=p,v=E.alternate,v!==null&&(v.childLanes|=p),E.tag===22&&(l=E.stateNode,l===null||l._visibility&1||(S=!0)),l=E,E=E.return;S&&d!==null&&l.tag===3&&(E=l.stateNode,S=31-dn(p),E=E.hiddenUpdates,l=E[S],l===null?E[S]=[d]:l.push(d),d.lane=p|536870912)}function Ip(l){if(50<vf)throw vf=0,s_=null,Error(n(185));for(var d=l.return;d!==null;)l=d,d=l.return;return l.tag===3?l.stateNode:null}var kc={},o3=new WeakMap;function qo(l,d){if(typeof l=="object"&&l!==null){var p=o3.get(l);return p!==void 0?p:(d={value:l,source:d,stack:oe(d)},o3.set(l,d),d)}return{value:l,source:d,stack:oe(d)}}var Gc=[],Qc=0,Lp=null,Bp=0,Zo=[],Ko=0,Il=null,Mi=1,wi="";function Ll(l,d){Gc[Qc++]=Bp,Gc[Qc++]=Lp,Lp=l,Bp=d}function a3(l,d,p){Zo[Ko++]=Mi,Zo[Ko++]=wi,Zo[Ko++]=Il,Il=l;var v=Mi;l=wi;var S=32-dn(v)-1;v&=~(1<<S),p+=1;var E=32-dn(d)+S;if(30<E){var H=S-S%5;E=(v&(1<<H)-1).toString(32),v>>=H,S-=H,Mi=1<<32-dn(d)+S|p<<S|v,wi=E+l}else Mi=1<<E|p<<S|v,wi=l}function n1(l){l.return!==null&&(Ll(l,1),a3(l,1,0))}function r1(l){for(;l===Lp;)Lp=Gc[--Qc],Gc[Qc]=null,Bp=Gc[--Qc],Gc[Qc]=null;for(;l===Il;)Il=Zo[--Ko],Zo[Ko]=null,wi=Zo[--Ko],Zo[Ko]=null,Mi=Zo[--Ko],Zo[Ko]=null}var Xr=null,wr=null,en=!1,ya=null,Xa=!1,o1=Error(n(519));function Bl(l){var d=Error(n(418,""));throw Xd(qo(d,l)),o1}function i3(l){var d=l.stateNode,p=l.type,v=l.memoizedProps;switch(d[Ue]=l,d[Ne]=v,p){case"dialog":Xt("cancel",d),Xt("close",d);break;case"iframe":case"object":case"embed":Xt("load",d);break;case"video":case"audio":for(p=0;p<Af.length;p++)Xt(Af[p],d);break;case"source":Xt("error",d);break;case"img":case"image":case"link":Xt("error",d),Xt("load",d);break;case"details":Xt("toggle",d);break;case"input":Xt("invalid",d),yp(d,v.value,v.defaultValue,v.checked,v.defaultChecked,v.type,v.name,!0),Sl(d);break;case"select":Xt("invalid",d);break;case"textarea":Xt("invalid",d),Dd(d,v.value,v.defaultValue,v.children),Sl(d)}p=v.children,typeof p!="string"&&typeof p!="number"&&typeof p!="bigint"||d.textContent===""+p||v.suppressHydrationWarning===!0||mC(d.textContent,p)?(v.popover!=null&&(Xt("beforetoggle",d),Xt("toggle",d)),v.onScroll!=null&&Xt("scroll",d),v.onScrollEnd!=null&&Xt("scrollend",d),v.onClick!=null&&(d.onclick=um),d=!0):d=!1,d||Bl(l)}function s3(l){for(Xr=l.return;Xr;)switch(Xr.tag){case 3:case 27:Xa=!0;return;case 5:case 13:Xa=!1;return;default:Xr=Xr.return}}function Yd(l){if(l!==Xr)return!1;if(!en)return s3(l),en=!0,!1;var d=!1,p;if((p=l.tag!==3&&l.tag!==27)&&((p=l.tag===5)&&(p=l.type,p=!(p!=="form"&&p!=="button")||C_(l.type,l.memoizedProps)),p=!p),p&&(d=!0),d&&wr&&Bl(l),s3(l),l.tag===13){if(l=l.memoizedState,l=l!==null?l.dehydrated:null,!l)throw Error(n(317));e:{for(l=l.nextSibling,d=0;l;){if(l.nodeType===8)if(p=l.data,p==="/$"){if(d===0){wr=Sa(l.nextSibling);break e}d--}else p!=="$"&&p!=="$!"&&p!=="$?"||d++;l=l.nextSibling}wr=null}}else wr=Xr?Sa(l.stateNode.nextSibling):null;return!0}function jd(){wr=Xr=null,en=!1}function Xd(l){ya===null?ya=[l]:ya.push(l)}var qd=Error(n(460)),l3=Error(n(474)),a1={then:function(){}};function c3(l){return l=l.status,l==="fulfilled"||l==="rejected"}function Pp(){}function u3(l,d,p){switch(p=l[p],p===void 0?l.push(d):p!==d&&(d.then(Pp,Pp),d=p),d.status){case"fulfilled":return d.value;case"rejected":throw l=d.reason,l===qd?Error(n(483)):l;default:if(typeof d.status=="string")d.then(Pp,Pp);else{if(l=xn,l!==null&&100<l.shellSuspendCounter)throw Error(n(482));l=d,l.status="pending",l.then(function(v){if(d.status==="pending"){var S=d;S.status="fulfilled",S.value=v}},function(v){if(d.status==="pending"){var S=d;S.status="rejected",S.reason=v}})}switch(d.status){case"fulfilled":return d.value;case"rejected":throw l=d.reason,l===qd?Error(n(483)):l}throw Zd=d,qd}}var Zd=null;function d3(){if(Zd===null)throw Error(n(459));var l=Zd;return Zd=null,l}var Hc=null,Kd=0;function Np(l){var d=Kd;return Kd+=1,Hc===null&&(Hc=[]),u3(Hc,l,d)}function $d(l,d){d=d.props.ref,l.ref=d!==void 0?d:null}function Dp(l,d){throw d.$$typeof===a?Error(n(525)):(l=Object.prototype.toString.call(d),Error(n(31,l==="[object Object]"?"object with keys {"+Object.keys(d).join(", ")+"}":l)))}function f3(l){var d=l._init;return d(l._payload)}function h3(l){function d(Me,ye){if(l){var Re=Me.deletions;Re===null?(Me.deletions=[ye],Me.flags|=16):Re.push(ye)}}function p(Me,ye){if(!l)return null;for(;ye!==null;)d(Me,ye),ye=ye.sibling;return null}function v(Me){for(var ye=new Map;Me!==null;)Me.key!==null?ye.set(Me.key,Me):ye.set(Me.index,Me),Me=Me.sibling;return ye}function S(Me,ye){return Me=Rs(Me,ye),Me.index=0,Me.sibling=null,Me}function E(Me,ye,Re){return Me.index=Re,l?(Re=Me.alternate,Re!==null?(Re=Re.index,Re<ye?(Me.flags|=33554434,ye):Re):(Me.flags|=33554434,ye)):(Me.flags|=1048576,ye)}function H(Me){return l&&Me.alternate===null&&(Me.flags|=33554434),Me}function ae(Me,ye,Re,ze){return ye===null||ye.tag!==6?(ye=J1(Re,Me.mode,ze),ye.return=Me,ye):(ye=S(ye,Re),ye.return=Me,ye)}function ge(Me,ye,Re,ze){var rt=Re.type;return rt===c?Fe(Me,ye,Re.props.children,ze,Re.key):ye!==null&&(ye.elementType===rt||typeof rt=="object"&&rt!==null&&rt.$$typeof===b&&f3(rt)===ye.type)?(ye=S(ye,Re.props),$d(ye,Re),ye.return=Me,ye):(ye=Jp(Re.type,Re.key,Re.props,null,Me.mode,ze),$d(ye,Re),ye.return=Me,ye)}function Se(Me,ye,Re,ze){return ye===null||ye.tag!==4||ye.stateNode.containerInfo!==Re.containerInfo||ye.stateNode.implementation!==Re.implementation?(ye=e_(Re,Me.mode,ze),ye.return=Me,ye):(ye=S(ye,Re.children||[]),ye.return=Me,ye)}function Fe(Me,ye,Re,ze,rt){return ye===null||ye.tag!==7?(ye=Gl(Re,Me.mode,ze,rt),ye.return=Me,ye):(ye=S(ye,Re),ye.return=Me,ye)}function ke(Me,ye,Re){if(typeof ye=="string"&&ye!==""||typeof ye=="number"||typeof ye=="bigint")return ye=J1(""+ye,Me.mode,Re),ye.return=Me,ye;if(typeof ye=="object"&&ye!==null){switch(ye.$$typeof){case i:return Re=Jp(ye.type,ye.key,ye.props,null,Me.mode,Re),$d(Re,ye),Re.return=Me,Re;case s:return ye=e_(ye,Me.mode,Re),ye.return=Me,ye;case b:var ze=ye._init;return ye=ze(ye._payload),ke(Me,ye,Re)}if(de(ye)||T(ye))return ye=Gl(ye,Me.mode,Re,null),ye.return=Me,ye;if(typeof ye.then=="function")return ke(Me,Np(ye),Re);if(ye.$$typeof===g)return ke(Me,Zp(Me,ye),Re);Dp(Me,ye)}return null}function Be(Me,ye,Re,ze){var rt=ye!==null?ye.key:null;if(typeof Re=="string"&&Re!==""||typeof Re=="number"||typeof Re=="bigint")return rt!==null?null:ae(Me,ye,""+Re,ze);if(typeof Re=="object"&&Re!==null){switch(Re.$$typeof){case i:return Re.key===rt?ge(Me,ye,Re,ze):null;case s:return Re.key===rt?Se(Me,ye,Re,ze):null;case b:return rt=Re._init,Re=rt(Re._payload),Be(Me,ye,Re,ze)}if(de(Re)||T(Re))return rt!==null?null:Fe(Me,ye,Re,ze,null);if(typeof Re.then=="function")return Be(Me,ye,Np(Re),ze);if(Re.$$typeof===g)return Be(Me,ye,Zp(Me,Re),ze);Dp(Me,Re)}return null}function Oe(Me,ye,Re,ze,rt){if(typeof ze=="string"&&ze!==""||typeof ze=="number"||typeof ze=="bigint")return Me=Me.get(Re)||null,ae(ye,Me,""+ze,rt);if(typeof ze=="object"&&ze!==null){switch(ze.$$typeof){case i:return Me=Me.get(ze.key===null?Re:ze.key)||null,ge(ye,Me,ze,rt);case s:return Me=Me.get(ze.key===null?Re:ze.key)||null,Se(ye,Me,ze,rt);case b:var Gt=ze._init;return ze=Gt(ze._payload),Oe(Me,ye,Re,ze,rt)}if(de(ze)||T(ze))return Me=Me.get(Re)||null,Fe(ye,Me,ze,rt,null);if(typeof ze.then=="function")return Oe(Me,ye,Re,Np(ze),rt);if(ze.$$typeof===g)return Oe(Me,ye,Re,Zp(ye,ze),rt);Dp(ye,ze)}return null}function dt(Me,ye,Re,ze){for(var rt=null,Gt=null,ft=ye,_t=ye=0,Ar=null;ft!==null&&_t<Re.length;_t++){ft.index>_t?(Ar=ft,ft=null):Ar=ft.sibling;var tn=Be(Me,ft,Re[_t],ze);if(tn===null){ft===null&&(ft=Ar);break}l&&ft&&tn.alternate===null&&d(Me,ft),ye=E(tn,ye,_t),Gt===null?rt=tn:Gt.sibling=tn,Gt=tn,ft=Ar}if(_t===Re.length)return p(Me,ft),en&&Ll(Me,_t),rt;if(ft===null){for(;_t<Re.length;_t++)ft=ke(Me,Re[_t],ze),ft!==null&&(ye=E(ft,ye,_t),Gt===null?rt=ft:Gt.sibling=ft,Gt=ft);return en&&Ll(Me,_t),rt}for(ft=v(ft);_t<Re.length;_t++)Ar=Oe(ft,Me,_t,Re[_t],ze),Ar!==null&&(l&&Ar.alternate!==null&&ft.delete(Ar.key===null?_t:Ar.key),ye=E(Ar,ye,_t),Gt===null?rt=Ar:Gt.sibling=Ar,Gt=Ar);return l&&ft.forEach(function(Os){return d(Me,Os)}),en&&Ll(Me,_t),rt}function wt(Me,ye,Re,ze){if(Re==null)throw Error(n(151));for(var rt=null,Gt=null,ft=ye,_t=ye=0,Ar=null,tn=Re.next();ft!==null&&!tn.done;_t++,tn=Re.next()){ft.index>_t?(Ar=ft,ft=null):Ar=ft.sibling;var Os=Be(Me,ft,tn.value,ze);if(Os===null){ft===null&&(ft=Ar);break}l&&ft&&Os.alternate===null&&d(Me,ft),ye=E(Os,ye,_t),Gt===null?rt=Os:Gt.sibling=Os,Gt=Os,ft=Ar}if(tn.done)return p(Me,ft),en&&Ll(Me,_t),rt;if(ft===null){for(;!tn.done;_t++,tn=Re.next())tn=ke(Me,tn.value,ze),tn!==null&&(ye=E(tn,ye,_t),Gt===null?rt=tn:Gt.sibling=tn,Gt=tn);return en&&Ll(Me,_t),rt}for(ft=v(ft);!tn.done;_t++,tn=Re.next())tn=Oe(ft,Me,_t,tn.value,ze),tn!==null&&(l&&tn.alternate!==null&&ft.delete(tn.key===null?_t:tn.key),ye=E(tn,ye,_t),Gt===null?rt=tn:Gt.sibling=tn,Gt=tn);return l&&ft.forEach(function(GD){return d(Me,GD)}),en&&Ll(Me,_t),rt}function kn(Me,ye,Re,ze){if(typeof Re=="object"&&Re!==null&&Re.type===c&&Re.key===null&&(Re=Re.props.children),typeof Re=="object"&&Re!==null){switch(Re.$$typeof){case i:e:{for(var rt=Re.key;ye!==null;){if(ye.key===rt){if(rt=Re.type,rt===c){if(ye.tag===7){p(Me,ye.sibling),ze=S(ye,Re.props.children),ze.return=Me,Me=ze;break e}}else if(ye.elementType===rt||typeof rt=="object"&&rt!==null&&rt.$$typeof===b&&f3(rt)===ye.type){p(Me,ye.sibling),ze=S(ye,Re.props),$d(ze,Re),ze.return=Me,Me=ze;break e}p(Me,ye);break}else d(Me,ye);ye=ye.sibling}Re.type===c?(ze=Gl(Re.props.children,Me.mode,ze,Re.key),ze.return=Me,Me=ze):(ze=Jp(Re.type,Re.key,Re.props,null,Me.mode,ze),$d(ze,Re),ze.return=Me,Me=ze)}return H(Me);case s:e:{for(rt=Re.key;ye!==null;){if(ye.key===rt)if(ye.tag===4&&ye.stateNode.containerInfo===Re.containerInfo&&ye.stateNode.implementation===Re.implementation){p(Me,ye.sibling),ze=S(ye,Re.children||[]),ze.return=Me,Me=ze;break e}else{p(Me,ye);break}else d(Me,ye);ye=ye.sibling}ze=e_(Re,Me.mode,ze),ze.return=Me,Me=ze}return H(Me);case b:return rt=Re._init,Re=rt(Re._payload),kn(Me,ye,Re,ze)}if(de(Re))return dt(Me,ye,Re,ze);if(T(Re)){if(rt=T(Re),typeof rt!="function")throw Error(n(150));return Re=rt.call(Re),wt(Me,ye,Re,ze)}if(typeof Re.then=="function")return kn(Me,ye,Np(Re),ze);if(Re.$$typeof===g)return kn(Me,ye,Zp(Me,Re),ze);Dp(Me,Re)}return typeof Re=="string"&&Re!==""||typeof Re=="number"||typeof Re=="bigint"?(Re=""+Re,ye!==null&&ye.tag===6?(p(Me,ye.sibling),ze=S(ye,Re),ze.return=Me,Me=ze):(p(Me,ye),ze=J1(Re,Me.mode,ze),ze.return=Me,Me=ze),H(Me)):p(Me,ye)}return function(Me,ye,Re,ze){try{Kd=0;var rt=kn(Me,ye,Re,ze);return Hc=null,rt}catch(ft){if(ft===qd)throw ft;var Gt=ta(29,ft,null,Me.mode);return Gt.lanes=ze,Gt.return=Me,Gt}finally{}}}var Pl=h3(!0),p3=h3(!1),Wc=ee(null),Op=ee(0);function m3(l,d){l=Ui,W(Op,l),W(Wc,d),Ui=l|d.baseLanes}function i1(){W(Op,Ui),W(Wc,Wc.current)}function s1(){Ui=Op.current,X(Wc),X(Op)}var $o=ee(null),qa=null;function _s(l){var d=l.alternate;W(lr,lr.current&1),W($o,l),qa===null&&(d===null||Wc.current!==null||d.memoizedState!==null)&&(qa=l)}function g3(l){if(l.tag===22){if(W(lr,lr.current),W($o,l),qa===null){var d=l.alternate;d!==null&&d.memoizedState!==null&&(qa=l)}}else As()}function As(){W(lr,lr.current),W($o,$o.current)}function Ti(l){X($o),qa===l&&(qa=null),X(lr)}var lr=ee(0);function Fp(l){for(var d=l;d!==null;){if(d.tag===13){var p=d.memoizedState;if(p!==null&&(p=p.dehydrated,p===null||p.data==="$?"||p.data==="$!"))return d}else if(d.tag===19&&d.memoizedProps.revealOrder!==void 0){if((d.flags&128)!==0)return d}else if(d.child!==null){d.child.return=d,d=d.child;continue}if(d===l)break;for(;d.sibling===null;){if(d.return===null||d.return===l)return null;d=d.return}d.sibling.return=d.return,d=d.sibling}return null}var RN=typeof AbortController<"u"?AbortController:function(){var l=[],d=this.signal={aborted:!1,addEventListener:function(p,v){l.push(v)}};this.abort=function(){d.aborted=!0,l.forEach(function(p){return p()})}},IN=o.unstable_scheduleCallback,LN=o.unstable_NormalPriority,cr={$$typeof:g,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function l1(){return{controller:new RN,data:new Map,refCount:0}}function Jd(l){l.refCount--,l.refCount===0&&IN(LN,function(){l.controller.abort()})}var ef=null,c1=0,Yc=0,jc=null;function BN(l,d){if(ef===null){var p=ef=[];c1=0,Yc=m_(),jc={status:"pending",value:void 0,then:function(v){p.push(v)}}}return c1++,d.then(v3,v3),d}function v3(){if(--c1===0&&ef!==null){jc!==null&&(jc.status="fulfilled");var l=ef;ef=null,Yc=0,jc=null;for(var d=0;d<l.length;d++)(0,l[d])()}}function PN(l,d){var p=[],v={status:"pending",value:null,reason:null,then:function(S){p.push(S)}};return l.then(function(){v.status="fulfilled",v.value=d;for(var S=0;S<p.length;S++)(0,p[S])(d)},function(S){for(v.status="rejected",v.reason=S,S=0;S<p.length;S++)(0,p[S])(void 0)}),v}var _3=z.S;z.S=function(l,d){typeof d=="object"&&d!==null&&typeof d.then=="function"&&BN(l,d),_3!==null&&_3(l,d)};var Nl=ee(null);function u1(){var l=Nl.current;return l!==null?l:xn.pooledCache}function Up(l,d){d===null?W(Nl,Nl.current):W(Nl,d.pool)}function A3(){var l=u1();return l===null?null:{parent:cr._currentValue,pool:l}}var xs=0,Vt=null,fn=null,tr=null,zp=!1,Xc=!1,Dl=!1,Vp=0,tf=0,qc=null,NN=0;function qn(){throw Error(n(321))}function d1(l,d){if(d===null)return!1;for(var p=0;p<d.length&&p<l.length;p++)if(!To(l[p],d[p]))return!1;return!0}function f1(l,d,p,v,S,E){return xs=E,Vt=d,d.memoizedState=null,d.updateQueue=null,d.lanes=0,z.H=l===null||l.memoizedState===null?Ol:ys,Dl=!1,E=p(v,S),Dl=!1,Xc&&(E=y3(d,p,v,S)),x3(l),E}function x3(l){z.H=Za;var d=fn!==null&&fn.next!==null;if(xs=0,tr=fn=Vt=null,zp=!1,tf=0,qc=null,d)throw Error(n(300));l===null||vr||(l=l.dependencies,l!==null&&qp(l)&&(vr=!0))}function y3(l,d,p,v){Vt=l;var S=0;do{if(Xc&&(qc=null),tf=0,Xc=!1,25<=S)throw Error(n(301));if(S+=1,tr=fn=null,l.updateQueue!=null){var E=l.updateQueue;E.lastEffect=null,E.events=null,E.stores=null,E.memoCache!=null&&(E.memoCache.index=0)}z.H=Fl,E=d(p,v)}while(Xc);return E}function DN(){var l=z.H,d=l.useState()[0];return d=typeof d.then=="function"?nf(d):d,l=l.useState()[0],(fn!==null?fn.memoizedState:null)!==l&&(Vt.flags|=1024),d}function h1(){var l=Vp!==0;return Vp=0,l}function p1(l,d,p){d.updateQueue=l.updateQueue,d.flags&=-2053,l.lanes&=~p}function m1(l){if(zp){for(l=l.memoizedState;l!==null;){var d=l.queue;d!==null&&(d.pending=null),l=l.next}zp=!1}xs=0,tr=fn=Vt=null,Xc=!1,tf=Vp=0,qc=null}function po(){var l={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return tr===null?Vt.memoizedState=tr=l:tr=tr.next=l,tr}function nr(){if(fn===null){var l=Vt.alternate;l=l!==null?l.memoizedState:null}else l=fn.next;var d=tr===null?Vt.memoizedState:tr.next;if(d!==null)tr=d,fn=l;else{if(l===null)throw Vt.alternate===null?Error(n(467)):Error(n(310));fn=l,l={memoizedState:fn.memoizedState,baseState:fn.baseState,baseQueue:fn.baseQueue,queue:fn.queue,next:null},tr===null?Vt.memoizedState=tr=l:tr=tr.next=l}return tr}var kp;kp=function(){return{lastEffect:null,events:null,stores:null,memoCache:null}};function nf(l){var d=tf;return tf+=1,qc===null&&(qc=[]),l=u3(qc,l,d),d=Vt,(tr===null?d.memoizedState:tr.next)===null&&(d=d.alternate,z.H=d===null||d.memoizedState===null?Ol:ys),l}function Gp(l){if(l!==null&&typeof l=="object"){if(typeof l.then=="function")return nf(l);if(l.$$typeof===g)return Ur(l)}throw Error(n(438,String(l)))}function g1(l){var d=null,p=Vt.updateQueue;if(p!==null&&(d=p.memoCache),d==null){var v=Vt.alternate;v!==null&&(v=v.updateQueue,v!==null&&(v=v.memoCache,v!=null&&(d={data:v.data.map(function(S){return S.slice()}),index:0})))}if(d==null&&(d={data:[],index:0}),p===null&&(p=kp(),Vt.updateQueue=p),p.memoCache=d,p=d.data[d.index],p===void 0)for(p=d.data[d.index]=Array(l),v=0;v<l;v++)p[v]=M;return d.index++,p}function Ri(l,d){return typeof d=="function"?d(l):d}function Qp(l){var d=nr();return v1(d,fn,l)}function v1(l,d,p){var v=l.queue;if(v===null)throw Error(n(311));v.lastRenderedReducer=p;var S=l.baseQueue,E=v.pending;if(E!==null){if(S!==null){var H=S.next;S.next=E.next,E.next=H}d.baseQueue=S=E,v.pending=null}if(E=l.baseState,S===null)l.memoizedState=E;else{d=S.next;var ae=H=null,ge=null,Se=d,Fe=!1;do{var ke=Se.lane&-536870913;if(ke!==Se.lane?(Zt&ke)===ke:(xs&ke)===ke){var Be=Se.revertLane;if(Be===0)ge!==null&&(ge=ge.next={lane:0,revertLane:0,action:Se.action,hasEagerState:Se.hasEagerState,eagerState:Se.eagerState,next:null}),ke===Yc&&(Fe=!0);else if((xs&Be)===Be){Se=Se.next,Be===Yc&&(Fe=!0);continue}else ke={lane:0,revertLane:Se.revertLane,action:Se.action,hasEagerState:Se.hasEagerState,eagerState:Se.eagerState,next:null},ge===null?(ae=ge=ke,H=E):ge=ge.next=ke,Vt.lanes|=Be,Is|=Be;ke=Se.action,Dl&&p(E,ke),E=Se.hasEagerState?Se.eagerState:p(E,ke)}else Be={lane:ke,revertLane:Se.revertLane,action:Se.action,hasEagerState:Se.hasEagerState,eagerState:Se.eagerState,next:null},ge===null?(ae=ge=Be,H=E):ge=ge.next=Be,Vt.lanes|=ke,Is|=ke;Se=Se.next}while(Se!==null&&Se!==d);if(ge===null?H=E:ge.next=ae,!To(E,l.memoizedState)&&(vr=!0,Fe&&(p=jc,p!==null)))throw p;l.memoizedState=E,l.baseState=H,l.baseQueue=ge,v.lastRenderedState=E}return S===null&&(v.lanes=0),[l.memoizedState,v.dispatch]}function _1(l){var d=nr(),p=d.queue;if(p===null)throw Error(n(311));p.lastRenderedReducer=l;var v=p.dispatch,S=p.pending,E=d.memoizedState;if(S!==null){p.pending=null;var H=S=S.next;do E=l(E,H.action),H=H.next;while(H!==S);To(E,d.memoizedState)||(vr=!0),d.memoizedState=E,d.baseQueue===null&&(d.baseState=E),p.lastRenderedState=E}return[E,v]}function b3(l,d,p){var v=Vt,S=nr(),E=en;if(E){if(p===void 0)throw Error(n(407));p=p()}else p=d();var H=!To((fn||S).memoizedState,p);if(H&&(S.memoizedState=p,vr=!0),S=S.queue,y1(E3.bind(null,v,S,l),[l]),S.getSnapshot!==d||H||tr!==null&&tr.memoizedState.tag&1){if(v.flags|=2048,Zc(9,C3.bind(null,v,S,p,d),{destroy:void 0},null),xn===null)throw Error(n(349));E||(xs&60)!==0||S3(v,d,p)}return p}function S3(l,d,p){l.flags|=16384,l={getSnapshot:d,value:p},d=Vt.updateQueue,d===null?(d=kp(),Vt.updateQueue=d,d.stores=[l]):(p=d.stores,p===null?d.stores=[l]:p.push(l))}function C3(l,d,p,v){d.value=p,d.getSnapshot=v,M3(d)&&w3(l)}function E3(l,d,p){return p(function(){M3(d)&&w3(l)})}function M3(l){var d=l.getSnapshot;l=l.value;try{var p=d();return!To(l,p)}catch{return!0}}function w3(l){var d=vs(l,2);d!==null&&qr(d,l,2)}function A1(l){var d=po();if(typeof l=="function"){var p=l;if(l=p(),Dl){Un(!0);try{p()}finally{Un(!1)}}}return d.memoizedState=d.baseState=l,d.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ri,lastRenderedState:l},d}function T3(l,d,p,v){return l.baseState=p,v1(l,fn,typeof v=="function"?v:Ri)}function ON(l,d,p,v,S){if(Yp(l))throw Error(n(485));if(l=d.action,l!==null){var E={payload:S,action:l,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(H){E.listeners.push(H)}};z.T!==null?p(!0):E.isTransition=!1,v(E),p=d.pending,p===null?(E.next=d.pending=E,R3(d,E)):(E.next=p.next,d.pending=p.next=E)}}function R3(l,d){var p=d.action,v=d.payload,S=l.state;if(d.isTransition){var E=z.T,H={};z.T=H;try{var ae=p(S,v),ge=z.S;ge!==null&&ge(H,ae),I3(l,d,ae)}catch(Se){x1(l,d,Se)}finally{z.T=E}}else try{E=p(S,v),I3(l,d,E)}catch(Se){x1(l,d,Se)}}function I3(l,d,p){p!==null&&typeof p=="object"&&typeof p.then=="function"?p.then(function(v){L3(l,d,v)},function(v){return x1(l,d,v)}):L3(l,d,p)}function L3(l,d,p){d.status="fulfilled",d.value=p,B3(d),l.state=p,d=l.pending,d!==null&&(p=d.next,p===d?l.pending=null:(p=p.next,d.next=p,R3(l,p)))}function x1(l,d,p){var v=l.pending;if(l.pending=null,v!==null){v=v.next;do d.status="rejected",d.reason=p,B3(d),d=d.next;while(d!==v)}l.action=null}function B3(l){l=l.listeners;for(var d=0;d<l.length;d++)(0,l[d])()}function P3(l,d){return d}function N3(l,d){if(en){var p=xn.formState;if(p!==null){e:{var v=Vt;if(en){if(wr){t:{for(var S=wr,E=Xa;S.nodeType!==8;){if(!E){S=null;break t}if(S=Sa(S.nextSibling),S===null){S=null;break t}}E=S.data,S=E==="F!"||E==="F"?S:null}if(S){wr=Sa(S.nextSibling),v=S.data==="F!";break e}}Bl(v)}v=!1}v&&(d=p[0])}}return p=po(),p.memoizedState=p.baseState=d,v={pending:null,lanes:0,dispatch:null,lastRenderedReducer:P3,lastRenderedState:d},p.queue=v,p=$3.bind(null,Vt,v),v.dispatch=p,v=A1(!1),E=M1.bind(null,Vt,!1,v.queue),v=po(),S={state:d,dispatch:null,action:l,pending:null},v.queue=S,p=ON.bind(null,Vt,S,E,p),S.dispatch=p,v.memoizedState=l,[d,p,!1]}function D3(l){var d=nr();return O3(d,fn,l)}function O3(l,d,p){d=v1(l,d,P3)[0],l=Qp(Ri)[0],d=typeof d=="object"&&d!==null&&typeof d.then=="function"?nf(d):d;var v=nr(),S=v.queue,E=S.dispatch;return p!==v.memoizedState&&(Vt.flags|=2048,Zc(9,FN.bind(null,S,p),{destroy:void 0},null)),[d,E,l]}function FN(l,d){l.action=d}function F3(l){var d=nr(),p=fn;if(p!==null)return O3(d,p,l);nr(),d=d.memoizedState,p=nr();var v=p.queue.dispatch;return p.memoizedState=l,[d,v,!1]}function Zc(l,d,p,v){return l={tag:l,create:d,inst:p,deps:v,next:null},d=Vt.updateQueue,d===null&&(d=kp(),Vt.updateQueue=d),p=d.lastEffect,p===null?d.lastEffect=l.next=l:(v=p.next,p.next=l,l.next=v,d.lastEffect=l),l}function U3(){return nr().memoizedState}function Hp(l,d,p,v){var S=po();Vt.flags|=l,S.memoizedState=Zc(1|d,p,{destroy:void 0},v===void 0?null:v)}function Wp(l,d,p,v){var S=nr();v=v===void 0?null:v;var E=S.memoizedState.inst;fn!==null&&v!==null&&d1(v,fn.memoizedState.deps)?S.memoizedState=Zc(d,p,E,v):(Vt.flags|=l,S.memoizedState=Zc(1|d,p,E,v))}function z3(l,d){Hp(8390656,8,l,d)}function y1(l,d){Wp(2048,8,l,d)}function V3(l,d){return Wp(4,2,l,d)}function k3(l,d){return Wp(4,4,l,d)}function G3(l,d){if(typeof d=="function"){l=l();var p=d(l);return function(){typeof p=="function"?p():d(null)}}if(d!=null)return l=l(),d.current=l,function(){d.current=null}}function Q3(l,d,p){p=p!=null?p.concat([l]):null,Wp(4,4,G3.bind(null,d,l),p)}function b1(){}function H3(l,d){var p=nr();d=d===void 0?null:d;var v=p.memoizedState;return d!==null&&d1(d,v[1])?v[0]:(p.memoizedState=[l,d],l)}function W3(l,d){var p=nr();d=d===void 0?null:d;var v=p.memoizedState;if(d!==null&&d1(d,v[1]))return v[0];if(v=l(),Dl){Un(!0);try{l()}finally{Un(!1)}}return p.memoizedState=[v,d],v}function S1(l,d,p){return p===void 0||(xs&1073741824)!==0?l.memoizedState=d:(l.memoizedState=p,l=jS(),Vt.lanes|=l,Is|=l,p)}function Y3(l,d,p,v){return To(p,d)?p:Wc.current!==null?(l=S1(l,p,v),To(l,d)||(vr=!0),l):(xs&42)===0?(vr=!0,l.memoizedState=p):(l=jS(),Vt.lanes|=l,Is|=l,d)}function j3(l,d,p,v,S){var E=te.p;te.p=E!==0&&8>E?E:8;var H=z.T,ae={};z.T=ae,M1(l,!1,d,p);try{var ge=S(),Se=z.S;if(Se!==null&&Se(ae,ge),ge!==null&&typeof ge=="object"&&typeof ge.then=="function"){var Fe=PN(ge,v);rf(l,d,Fe,Bo(l))}else rf(l,d,v,Bo(l))}catch(ke){rf(l,d,{then:function(){},status:"rejected",reason:ke},Bo())}finally{te.p=E,z.T=H}}function UN(){}function C1(l,d,p,v){if(l.tag!==5)throw Error(n(476));var S=X3(l).queue;j3(l,S,d,le,p===null?UN:function(){return q3(l),p(v)})}function X3(l){var d=l.memoizedState;if(d!==null)return d;d={memoizedState:le,baseState:le,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ri,lastRenderedState:le},next:null};var p={};return d.next={memoizedState:p,baseState:p,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ri,lastRenderedState:p},next:null},l.memoizedState=d,l=l.alternate,l!==null&&(l.memoizedState=d),d}function q3(l){var d=X3(l).next.queue;rf(l,d,{},Bo())}function E1(){return Ur(Cf)}function Z3(){return nr().memoizedState}function K3(){return nr().memoizedState}function zN(l){for(var d=l.return;d!==null;){switch(d.tag){case 24:case 3:var p=Bo();l=Cs(p);var v=Es(d,l,p);v!==null&&(qr(v,d,p),sf(v,d,p)),d={cache:l1()},l.payload=d;return}d=d.return}}function VN(l,d,p){var v=Bo();p={lane:v,revertLane:0,action:p,hasEagerState:!1,eagerState:null,next:null},Yp(l)?J3(d,p):(p=t1(l,d,p,v),p!==null&&(qr(p,l,v),eS(p,d,v)))}function $3(l,d,p){var v=Bo();rf(l,d,p,v)}function rf(l,d,p,v){var S={lane:v,revertLane:0,action:p,hasEagerState:!1,eagerState:null,next:null};if(Yp(l))J3(d,S);else{var E=l.alternate;if(l.lanes===0&&(E===null||E.lanes===0)&&(E=d.lastRenderedReducer,E!==null))try{var H=d.lastRenderedState,ae=E(H,p);if(S.hasEagerState=!0,S.eagerState=ae,To(ae,H))return Rp(l,d,S,0),xn===null&&Tp(),!1}catch{}finally{}if(p=t1(l,d,S,v),p!==null)return qr(p,l,v),eS(p,d,v),!0}return!1}function M1(l,d,p,v){if(v={lane:2,revertLane:m_(),action:v,hasEagerState:!1,eagerState:null,next:null},Yp(l)){if(d)throw Error(n(479))}else d=t1(l,p,v,2),d!==null&&qr(d,l,2)}function Yp(l){var d=l.alternate;return l===Vt||d!==null&&d===Vt}function J3(l,d){Xc=zp=!0;var p=l.pending;p===null?d.next=d:(d.next=p.next,p.next=d),l.pending=d}function eS(l,d,p){if((p&4194176)!==0){var v=d.lanes;v&=l.pendingLanes,p|=v,d.lanes=p,bl(l,p)}}var Za={readContext:Ur,use:Gp,useCallback:qn,useContext:qn,useEffect:qn,useImperativeHandle:qn,useLayoutEffect:qn,useInsertionEffect:qn,useMemo:qn,useReducer:qn,useRef:qn,useState:qn,useDebugValue:qn,useDeferredValue:qn,useTransition:qn,useSyncExternalStore:qn,useId:qn};Za.useCacheRefresh=qn,Za.useMemoCache=qn,Za.useHostTransitionStatus=qn,Za.useFormState=qn,Za.useActionState=qn,Za.useOptimistic=qn;var Ol={readContext:Ur,use:Gp,useCallback:function(l,d){return po().memoizedState=[l,d===void 0?null:d],l},useContext:Ur,useEffect:z3,useImperativeHandle:function(l,d,p){p=p!=null?p.concat([l]):null,Hp(4194308,4,G3.bind(null,d,l),p)},useLayoutEffect:function(l,d){return Hp(4194308,4,l,d)},useInsertionEffect:function(l,d){Hp(4,2,l,d)},useMemo:function(l,d){var p=po();d=d===void 0?null:d;var v=l();if(Dl){Un(!0);try{l()}finally{Un(!1)}}return p.memoizedState=[v,d],v},useReducer:function(l,d,p){var v=po();if(p!==void 0){var S=p(d);if(Dl){Un(!0);try{p(d)}finally{Un(!1)}}}else S=d;return v.memoizedState=v.baseState=S,l={pending:null,lanes:0,dispatch:null,lastRenderedReducer:l,lastRenderedState:S},v.queue=l,l=l.dispatch=VN.bind(null,Vt,l),[v.memoizedState,l]},useRef:function(l){var d=po();return l={current:l},d.memoizedState=l},useState:function(l){l=A1(l);var d=l.queue,p=$3.bind(null,Vt,d);return d.dispatch=p,[l.memoizedState,p]},useDebugValue:b1,useDeferredValue:function(l,d){var p=po();return S1(p,l,d)},useTransition:function(){var l=A1(!1);return l=j3.bind(null,Vt,l.queue,!0,!1),po().memoizedState=l,[!1,l]},useSyncExternalStore:function(l,d,p){var v=Vt,S=po();if(en){if(p===void 0)throw Error(n(407));p=p()}else{if(p=d(),xn===null)throw Error(n(349));(Zt&60)!==0||S3(v,d,p)}S.memoizedState=p;var E={value:p,getSnapshot:d};return S.queue=E,z3(E3.bind(null,v,E,l),[l]),v.flags|=2048,Zc(9,C3.bind(null,v,E,p,d),{destroy:void 0},null),p},useId:function(){var l=po(),d=xn.identifierPrefix;if(en){var p=wi,v=Mi;p=(v&~(1<<32-dn(v)-1)).toString(32)+p,d=":"+d+"R"+p,p=Vp++,0<p&&(d+="H"+p.toString(32)),d+=":"}else p=NN++,d=":"+d+"r"+p.toString(32)+":";return l.memoizedState=d},useCacheRefresh:function(){return po().memoizedState=zN.bind(null,Vt)}};Ol.useMemoCache=g1,Ol.useHostTransitionStatus=E1,Ol.useFormState=N3,Ol.useActionState=N3,Ol.useOptimistic=function(l){var d=po();d.memoizedState=d.baseState=l;var p={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return d.queue=p,d=M1.bind(null,Vt,!0,p),p.dispatch=d,[l,d]};var ys={readContext:Ur,use:Gp,useCallback:H3,useContext:Ur,useEffect:y1,useImperativeHandle:Q3,useInsertionEffect:V3,useLayoutEffect:k3,useMemo:W3,useReducer:Qp,useRef:U3,useState:function(){return Qp(Ri)},useDebugValue:b1,useDeferredValue:function(l,d){var p=nr();return Y3(p,fn.memoizedState,l,d)},useTransition:function(){var l=Qp(Ri)[0],d=nr().memoizedState;return[typeof l=="boolean"?l:nf(l),d]},useSyncExternalStore:b3,useId:Z3};ys.useCacheRefresh=K3,ys.useMemoCache=g1,ys.useHostTransitionStatus=E1,ys.useFormState=D3,ys.useActionState=D3,ys.useOptimistic=function(l,d){var p=nr();return T3(p,fn,l,d)};var Fl={readContext:Ur,use:Gp,useCallback:H3,useContext:Ur,useEffect:y1,useImperativeHandle:Q3,useInsertionEffect:V3,useLayoutEffect:k3,useMemo:W3,useReducer:_1,useRef:U3,useState:function(){return _1(Ri)},useDebugValue:b1,useDeferredValue:function(l,d){var p=nr();return fn===null?S1(p,l,d):Y3(p,fn.memoizedState,l,d)},useTransition:function(){var l=_1(Ri)[0],d=nr().memoizedState;return[typeof l=="boolean"?l:nf(l),d]},useSyncExternalStore:b3,useId:Z3};Fl.useCacheRefresh=K3,Fl.useMemoCache=g1,Fl.useHostTransitionStatus=E1,Fl.useFormState=F3,Fl.useActionState=F3,Fl.useOptimistic=function(l,d){var p=nr();return fn!==null?T3(p,fn,l,d):(p.baseState=l,[l,p.queue.dispatch])};function w1(l,d,p,v){d=l.memoizedState,p=p(v,d),p=p==null?d:F({},d,p),l.memoizedState=p,l.lanes===0&&(l.updateQueue.baseState=p)}var T1={isMounted:function(l){return(l=l._reactInternals)?ie(l)===l:!1},enqueueSetState:function(l,d,p){l=l._reactInternals;var v=Bo(),S=Cs(v);S.payload=d,p!=null&&(S.callback=p),d=Es(l,S,v),d!==null&&(qr(d,l,v),sf(d,l,v))},enqueueReplaceState:function(l,d,p){l=l._reactInternals;var v=Bo(),S=Cs(v);S.tag=1,S.payload=d,p!=null&&(S.callback=p),d=Es(l,S,v),d!==null&&(qr(d,l,v),sf(d,l,v))},enqueueForceUpdate:function(l,d){l=l._reactInternals;var p=Bo(),v=Cs(p);v.tag=2,d!=null&&(v.callback=d),d=Es(l,v,p),d!==null&&(qr(d,l,p),sf(d,l,p))}};function tS(l,d,p,v,S,E,H){return l=l.stateNode,typeof l.shouldComponentUpdate=="function"?l.shouldComponentUpdate(v,E,H):d.prototype&&d.prototype.isPureReactComponent?!Hd(p,v)||!Hd(S,E):!0}function nS(l,d,p,v){l=d.state,typeof d.componentWillReceiveProps=="function"&&d.componentWillReceiveProps(p,v),typeof d.UNSAFE_componentWillReceiveProps=="function"&&d.UNSAFE_componentWillReceiveProps(p,v),d.state!==l&&T1.enqueueReplaceState(d,d.state,null)}function Ul(l,d){var p=d;if("ref"in d){p={};for(var v in d)v!=="ref"&&(p[v]=d[v])}if(l=l.defaultProps){p===d&&(p=F({},p));for(var S in l)p[S]===void 0&&(p[S]=l[S])}return p}var jp=typeof reportError=="function"?reportError:function(l){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var d=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof l=="object"&&l!==null&&typeof l.message=="string"?String(l.message):String(l),error:l});if(!window.dispatchEvent(d))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",l);return}console.error(l)};function rS(l){jp(l)}function oS(l){console.error(l)}function aS(l){jp(l)}function Xp(l,d){try{var p=l.onUncaughtError;p(d.value,{componentStack:d.stack})}catch(v){setTimeout(function(){throw v})}}function iS(l,d,p){try{var v=l.onCaughtError;v(p.value,{componentStack:p.stack,errorBoundary:d.tag===1?d.stateNode:null})}catch(S){setTimeout(function(){throw S})}}function R1(l,d,p){return p=Cs(p),p.tag=3,p.payload={element:null},p.callback=function(){Xp(l,d)},p}function sS(l){return l=Cs(l),l.tag=3,l}function lS(l,d,p,v){var S=p.type.getDerivedStateFromError;if(typeof S=="function"){var E=v.value;l.payload=function(){return S(E)},l.callback=function(){iS(d,p,v)}}var H=p.stateNode;H!==null&&typeof H.componentDidCatch=="function"&&(l.callback=function(){iS(d,p,v),typeof S!="function"&&(Ls===null?Ls=new Set([this]):Ls.add(this));var ae=v.stack;this.componentDidCatch(v.value,{componentStack:ae!==null?ae:""})})}function kN(l,d,p,v,S){if(p.flags|=32768,v!==null&&typeof v=="object"&&typeof v.then=="function"){if(d=p.alternate,d!==null&&af(d,p,S,!0),p=$o.current,p!==null){switch(p.tag){case 13:return qa===null?u_():p.alternate===null&&Vn===0&&(Vn=3),p.flags&=-257,p.flags|=65536,p.lanes=S,v===a1?p.flags|=16384:(d=p.updateQueue,d===null?p.updateQueue=new Set([v]):d.add(v),f_(l,v,S)),!1;case 22:return p.flags|=65536,v===a1?p.flags|=16384:(d=p.updateQueue,d===null?(d={transitions:null,markerInstances:null,retryQueue:new Set([v])},p.updateQueue=d):(p=d.retryQueue,p===null?d.retryQueue=new Set([v]):p.add(v)),f_(l,v,S)),!1}throw Error(n(435,p.tag))}return f_(l,v,S),u_(),!1}if(en)return d=$o.current,d!==null?((d.flags&65536)===0&&(d.flags|=256),d.flags|=65536,d.lanes=S,v!==o1&&(l=Error(n(422),{cause:v}),Xd(qo(l,p)))):(v!==o1&&(d=Error(n(423),{cause:v}),Xd(qo(d,p))),l=l.current.alternate,l.flags|=65536,S&=-S,l.lanes|=S,v=qo(v,p),S=R1(l.stateNode,v,S),H1(l,S),Vn!==4&&(Vn=2)),!1;var E=Error(n(520),{cause:v});if(E=qo(E,p),mf===null?mf=[E]:mf.push(E),Vn!==4&&(Vn=2),d===null)return!0;v=qo(v,p),p=d;do{switch(p.tag){case 3:return p.flags|=65536,l=S&-S,p.lanes|=l,l=R1(p.stateNode,v,l),H1(p,l),!1;case 1:if(d=p.type,E=p.stateNode,(p.flags&128)===0&&(typeof d.getDerivedStateFromError=="function"||E!==null&&typeof E.componentDidCatch=="function"&&(Ls===null||!Ls.has(E))))return p.flags|=65536,S&=-S,p.lanes|=S,S=sS(S),lS(S,l,p,v),H1(p,S),!1}p=p.return}while(p!==null);return!1}var cS=Error(n(461)),vr=!1;function Tr(l,d,p,v){d.child=l===null?p3(d,null,p,v):Pl(d,l.child,p,v)}function uS(l,d,p,v,S){p=p.render;var E=d.ref;if("ref"in v){var H={};for(var ae in v)ae!=="ref"&&(H[ae]=v[ae])}else H=v;return Vl(d),v=f1(l,d,p,H,E,S),ae=h1(),l!==null&&!vr?(p1(l,d,S),Ii(l,d,S)):(en&&ae&&n1(d),d.flags|=1,Tr(l,d,v,S),d.child)}function dS(l,d,p,v,S){if(l===null){var E=p.type;return typeof E=="function"&&!$1(E)&&E.defaultProps===void 0&&p.compare===null?(d.tag=15,d.type=E,fS(l,d,E,v,S)):(l=Jp(p.type,null,v,d,d.mode,S),l.ref=d.ref,l.return=d,d.child=l)}if(E=l.child,!U1(l,S)){var H=E.memoizedProps;if(p=p.compare,p=p!==null?p:Hd,p(H,v)&&l.ref===d.ref)return Ii(l,d,S)}return d.flags|=1,l=Rs(E,v),l.ref=d.ref,l.return=d,d.child=l}function fS(l,d,p,v,S){if(l!==null){var E=l.memoizedProps;if(Hd(E,v)&&l.ref===d.ref)if(vr=!1,d.pendingProps=v=E,U1(l,S))(l.flags&131072)!==0&&(vr=!0);else return d.lanes=l.lanes,Ii(l,d,S)}return I1(l,d,p,v,S)}function hS(l,d,p){var v=d.pendingProps,S=v.children,E=(d.stateNode._pendingVisibility&2)!==0,H=l!==null?l.memoizedState:null;if(of(l,d),v.mode==="hidden"||E){if((d.flags&128)!==0){if(v=H!==null?H.baseLanes|p:p,l!==null){for(S=d.child=l.child,E=0;S!==null;)E=E|S.lanes|S.childLanes,S=S.sibling;d.childLanes=E&~v}else d.childLanes=0,d.child=null;return pS(l,d,v,p)}if((p&536870912)!==0)d.memoizedState={baseLanes:0,cachePool:null},l!==null&&Up(d,H!==null?H.cachePool:null),H!==null?m3(d,H):i1(),g3(d);else return d.lanes=d.childLanes=536870912,pS(l,d,H!==null?H.baseLanes|p:p,p)}else H!==null?(Up(d,H.cachePool),m3(d,H),As(),d.memoizedState=null):(l!==null&&Up(d,null),i1(),As());return Tr(l,d,S,p),d.child}function pS(l,d,p,v){var S=u1();return S=S===null?null:{parent:cr._currentValue,pool:S},d.memoizedState={baseLanes:p,cachePool:S},l!==null&&Up(d,null),i1(),g3(d),l!==null&&af(l,d,v,!0),null}function of(l,d){var p=d.ref;if(p===null)l!==null&&l.ref!==null&&(d.flags|=2097664);else{if(typeof p!="function"&&typeof p!="object")throw Error(n(284));(l===null||l.ref!==p)&&(d.flags|=2097664)}}function I1(l,d,p,v,S){return Vl(d),p=f1(l,d,p,v,void 0,S),v=h1(),l!==null&&!vr?(p1(l,d,S),Ii(l,d,S)):(en&&v&&n1(d),d.flags|=1,Tr(l,d,p,S),d.child)}function mS(l,d,p,v,S,E){return Vl(d),d.updateQueue=null,p=y3(d,v,p,S),x3(l),v=h1(),l!==null&&!vr?(p1(l,d,E),Ii(l,d,E)):(en&&v&&n1(d),d.flags|=1,Tr(l,d,p,E),d.child)}function gS(l,d,p,v,S){if(Vl(d),d.stateNode===null){var E=kc,H=p.contextType;typeof H=="object"&&H!==null&&(E=Ur(H)),E=new p(v,E),d.memoizedState=E.state!==null&&E.state!==void 0?E.state:null,E.updater=T1,d.stateNode=E,E._reactInternals=d,E=d.stateNode,E.props=v,E.state=d.memoizedState,E.refs={},G1(d),H=p.contextType,E.context=typeof H=="object"&&H!==null?Ur(H):kc,E.state=d.memoizedState,H=p.getDerivedStateFromProps,typeof H=="function"&&(w1(d,p,H,v),E.state=d.memoizedState),typeof p.getDerivedStateFromProps=="function"||typeof E.getSnapshotBeforeUpdate=="function"||typeof E.UNSAFE_componentWillMount!="function"&&typeof E.componentWillMount!="function"||(H=E.state,typeof E.componentWillMount=="function"&&E.componentWillMount(),typeof E.UNSAFE_componentWillMount=="function"&&E.UNSAFE_componentWillMount(),H!==E.state&&T1.enqueueReplaceState(E,E.state,null),cf(d,v,E,S),lf(),E.state=d.memoizedState),typeof E.componentDidMount=="function"&&(d.flags|=4194308),v=!0}else if(l===null){E=d.stateNode;var ae=d.memoizedProps,ge=Ul(p,ae);E.props=ge;var Se=E.context,Fe=p.contextType;H=kc,typeof Fe=="object"&&Fe!==null&&(H=Ur(Fe));var ke=p.getDerivedStateFromProps;Fe=typeof ke=="function"||typeof E.getSnapshotBeforeUpdate=="function",ae=d.pendingProps!==ae,Fe||typeof E.UNSAFE_componentWillReceiveProps!="function"&&typeof E.componentWillReceiveProps!="function"||(ae||Se!==H)&&nS(d,E,v,H),Ss=!1;var Be=d.memoizedState;E.state=Be,cf(d,v,E,S),lf(),Se=d.memoizedState,ae||Be!==Se||Ss?(typeof ke=="function"&&(w1(d,p,ke,v),Se=d.memoizedState),(ge=Ss||tS(d,p,ge,v,Be,Se,H))?(Fe||typeof E.UNSAFE_componentWillMount!="function"&&typeof E.componentWillMount!="function"||(typeof E.componentWillMount=="function"&&E.componentWillMount(),typeof E.UNSAFE_componentWillMount=="function"&&E.UNSAFE_componentWillMount()),typeof E.componentDidMount=="function"&&(d.flags|=4194308)):(typeof E.componentDidMount=="function"&&(d.flags|=4194308),d.memoizedProps=v,d.memoizedState=Se),E.props=v,E.state=Se,E.context=H,v=ge):(typeof E.componentDidMount=="function"&&(d.flags|=4194308),v=!1)}else{E=d.stateNode,Q1(l,d),H=d.memoizedProps,Fe=Ul(p,H),E.props=Fe,ke=d.pendingProps,Be=E.context,Se=p.contextType,ge=kc,typeof Se=="object"&&Se!==null&&(ge=Ur(Se)),ae=p.getDerivedStateFromProps,(Se=typeof ae=="function"||typeof E.getSnapshotBeforeUpdate=="function")||typeof E.UNSAFE_componentWillReceiveProps!="function"&&typeof E.componentWillReceiveProps!="function"||(H!==ke||Be!==ge)&&nS(d,E,v,ge),Ss=!1,Be=d.memoizedState,E.state=Be,cf(d,v,E,S),lf();var Oe=d.memoizedState;H!==ke||Be!==Oe||Ss||l!==null&&l.dependencies!==null&&qp(l.dependencies)?(typeof ae=="function"&&(w1(d,p,ae,v),Oe=d.memoizedState),(Fe=Ss||tS(d,p,Fe,v,Be,Oe,ge)||l!==null&&l.dependencies!==null&&qp(l.dependencies))?(Se||typeof E.UNSAFE_componentWillUpdate!="function"&&typeof E.componentWillUpdate!="function"||(typeof E.componentWillUpdate=="function"&&E.componentWillUpdate(v,Oe,ge),typeof E.UNSAFE_componentWillUpdate=="function"&&E.UNSAFE_componentWillUpdate(v,Oe,ge)),typeof E.componentDidUpdate=="function"&&(d.flags|=4),typeof E.getSnapshotBeforeUpdate=="function"&&(d.flags|=1024)):(typeof E.componentDidUpdate!="function"||H===l.memoizedProps&&Be===l.memoizedState||(d.flags|=4),typeof E.getSnapshotBeforeUpdate!="function"||H===l.memoizedProps&&Be===l.memoizedState||(d.flags|=1024),d.memoizedProps=v,d.memoizedState=Oe),E.props=v,E.state=Oe,E.context=ge,v=Fe):(typeof E.componentDidUpdate!="function"||H===l.memoizedProps&&Be===l.memoizedState||(d.flags|=4),typeof E.getSnapshotBeforeUpdate!="function"||H===l.memoizedProps&&Be===l.memoizedState||(d.flags|=1024),v=!1)}return E=v,of(l,d),v=(d.flags&128)!==0,E||v?(E=d.stateNode,p=v&&typeof p.getDerivedStateFromError!="function"?null:E.render(),d.flags|=1,l!==null&&v?(d.child=Pl(d,l.child,null,S),d.child=Pl(d,null,p,S)):Tr(l,d,p,S),d.memoizedState=E.state,l=d.child):l=Ii(l,d,S),l}function vS(l,d,p,v){return jd(),d.flags|=256,Tr(l,d,p,v),d.child}var L1={dehydrated:null,treeContext:null,retryLane:0};function B1(l){return{baseLanes:l,cachePool:A3()}}function P1(l,d,p){return l=l!==null?l.childLanes&~p:0,d&&(l|=na),l}function _S(l,d,p){var v=d.pendingProps,S=!1,E=(d.flags&128)!==0,H;if((H=E)||(H=l!==null&&l.memoizedState===null?!1:(lr.current&2)!==0),H&&(S=!0,d.flags&=-129),H=(d.flags&32)!==0,d.flags&=-33,l===null){if(en){if(S?_s(d):As(),en){var ae=wr,ge;if(ge=ae){e:{for(ge=ae,ae=Xa;ge.nodeType!==8;){if(!ae){ae=null;break e}if(ge=Sa(ge.nextSibling),ge===null){ae=null;break e}}ae=ge}ae!==null?(d.memoizedState={dehydrated:ae,treeContext:Il!==null?{id:Mi,overflow:wi}:null,retryLane:536870912},ge=ta(18,null,null,0),ge.stateNode=ae,ge.return=d,d.child=ge,Xr=d,wr=null,ge=!0):ge=!1}ge||Bl(d)}if(ae=d.memoizedState,ae!==null&&(ae=ae.dehydrated,ae!==null))return ae.data==="$!"?d.lanes=16:d.lanes=536870912,null;Ti(d)}return ae=v.children,v=v.fallback,S?(As(),S=d.mode,ae=D1({mode:"hidden",children:ae},S),v=Gl(v,S,p,null),ae.return=d,v.return=d,ae.sibling=v,d.child=ae,S=d.child,S.memoizedState=B1(p),S.childLanes=P1(l,H,p),d.memoizedState=L1,v):(_s(d),N1(d,ae))}if(ge=l.memoizedState,ge!==null&&(ae=ge.dehydrated,ae!==null)){if(E)d.flags&256?(_s(d),d.flags&=-257,d=O1(l,d,p)):d.memoizedState!==null?(As(),d.child=l.child,d.flags|=128,d=null):(As(),S=v.fallback,ae=d.mode,v=D1({mode:"visible",children:v.children},ae),S=Gl(S,ae,p,null),S.flags|=2,v.return=d,S.return=d,v.sibling=S,d.child=v,Pl(d,l.child,null,p),v=d.child,v.memoizedState=B1(p),v.childLanes=P1(l,H,p),d.memoizedState=L1,d=S);else if(_s(d),ae.data==="$!"){if(H=ae.nextSibling&&ae.nextSibling.dataset,H)var Se=H.dgst;H=Se,v=Error(n(419)),v.stack="",v.digest=H,Xd({value:v,source:null,stack:null}),d=O1(l,d,p)}else if(vr||af(l,d,p,!1),H=(p&l.childLanes)!==0,vr||H){if(H=xn,H!==null){if(v=p&-p,(v&42)!==0)v=1;else switch(v){case 2:v=1;break;case 8:v=4;break;case 32:v=16;break;case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:v=64;break;case 268435456:v=134217728;break;default:v=0}if(v=(v&(H.suspendedLanes|p))!==0?0:v,v!==0&&v!==ge.retryLane)throw ge.retryLane=v,vs(l,v),qr(H,l,v),cS}ae.data==="$?"||u_(),d=O1(l,d,p)}else ae.data==="$?"?(d.flags|=128,d.child=l.child,d=nD.bind(null,l),ae._reactRetry=d,d=null):(l=ge.treeContext,wr=Sa(ae.nextSibling),Xr=d,en=!0,ya=null,Xa=!1,l!==null&&(Zo[Ko++]=Mi,Zo[Ko++]=wi,Zo[Ko++]=Il,Mi=l.id,wi=l.overflow,Il=d),d=N1(d,v.children),d.flags|=4096);return d}return S?(As(),S=v.fallback,ae=d.mode,ge=l.child,Se=ge.sibling,v=Rs(ge,{mode:"hidden",children:v.children}),v.subtreeFlags=ge.subtreeFlags&31457280,Se!==null?S=Rs(Se,S):(S=Gl(S,ae,p,null),S.flags|=2),S.return=d,v.return=d,v.sibling=S,d.child=v,v=S,S=d.child,ae=l.child.memoizedState,ae===null?ae=B1(p):(ge=ae.cachePool,ge!==null?(Se=cr._currentValue,ge=ge.parent!==Se?{parent:Se,pool:Se}:ge):ge=A3(),ae={baseLanes:ae.baseLanes|p,cachePool:ge}),S.memoizedState=ae,S.childLanes=P1(l,H,p),d.memoizedState=L1,v):(_s(d),p=l.child,l=p.sibling,p=Rs(p,{mode:"visible",children:v.children}),p.return=d,p.sibling=null,l!==null&&(H=d.deletions,H===null?(d.deletions=[l],d.flags|=16):H.push(l)),d.child=p,d.memoizedState=null,p)}function N1(l,d){return d=D1({mode:"visible",children:d},l.mode),d.return=l,l.child=d}function D1(l,d){return HS(l,d,0,null)}function O1(l,d,p){return Pl(d,l.child,null,p),l=N1(d,d.pendingProps.children),l.flags|=2,d.memoizedState=null,l}function AS(l,d,p){l.lanes|=d;var v=l.alternate;v!==null&&(v.lanes|=d),V1(l.return,d,p)}function F1(l,d,p,v,S){var E=l.memoizedState;E===null?l.memoizedState={isBackwards:d,rendering:null,renderingStartTime:0,last:v,tail:p,tailMode:S}:(E.isBackwards=d,E.rendering=null,E.renderingStartTime=0,E.last=v,E.tail=p,E.tailMode=S)}function xS(l,d,p){var v=d.pendingProps,S=v.revealOrder,E=v.tail;if(Tr(l,d,v.children,p),v=lr.current,(v&2)!==0)v=v&1|2,d.flags|=128;else{if(l!==null&&(l.flags&128)!==0)e:for(l=d.child;l!==null;){if(l.tag===13)l.memoizedState!==null&&AS(l,p,d);else if(l.tag===19)AS(l,p,d);else if(l.child!==null){l.child.return=l,l=l.child;continue}if(l===d)break e;for(;l.sibling===null;){if(l.return===null||l.return===d)break e;l=l.return}l.sibling.return=l.return,l=l.sibling}v&=1}switch(W(lr,v),S){case"forwards":for(p=d.child,S=null;p!==null;)l=p.alternate,l!==null&&Fp(l)===null&&(S=p),p=p.sibling;p=S,p===null?(S=d.child,d.child=null):(S=p.sibling,p.sibling=null),F1(d,!1,S,p,E);break;case"backwards":for(p=null,S=d.child,d.child=null;S!==null;){if(l=S.alternate,l!==null&&Fp(l)===null){d.child=S;break}l=S.sibling,S.sibling=p,p=S,S=l}F1(d,!0,p,null,E);break;case"together":F1(d,!1,null,null,void 0);break;default:d.memoizedState=null}return d.child}function Ii(l,d,p){if(l!==null&&(d.dependencies=l.dependencies),Is|=d.lanes,(p&d.childLanes)===0)if(l!==null){if(af(l,d,p,!1),(p&d.childLanes)===0)return null}else return null;if(l!==null&&d.child!==l.child)throw Error(n(153));if(d.child!==null){for(l=d.child,p=Rs(l,l.pendingProps),d.child=p,p.return=d;l.sibling!==null;)l=l.sibling,p=p.sibling=Rs(l,l.pendingProps),p.return=d;p.sibling=null}return d.child}function U1(l,d){return(l.lanes&d)!==0?!0:(l=l.dependencies,!!(l!==null&&qp(l)))}function GN(l,d,p){switch(d.tag){case 3:N(d,d.stateNode.containerInfo),bs(d,cr,l.memoizedState.cache),jd();break;case 27:case 5:ce(d);break;case 4:N(d,d.stateNode.containerInfo);break;case 10:bs(d,d.type,d.memoizedProps.value);break;case 13:var v=d.memoizedState;if(v!==null)return v.dehydrated!==null?(_s(d),d.flags|=128,null):(p&d.child.childLanes)!==0?_S(l,d,p):(_s(d),l=Ii(l,d,p),l!==null?l.sibling:null);_s(d);break;case 19:var S=(l.flags&128)!==0;if(v=(p&d.childLanes)!==0,v||(af(l,d,p,!1),v=(p&d.childLanes)!==0),S){if(v)return xS(l,d,p);d.flags|=128}if(S=d.memoizedState,S!==null&&(S.rendering=null,S.tail=null,S.lastEffect=null),W(lr,lr.current),v)break;return null;case 22:case 23:return d.lanes=0,hS(l,d,p);case 24:bs(d,cr,l.memoizedState.cache)}return Ii(l,d,p)}function yS(l,d,p){if(l!==null)if(l.memoizedProps!==d.pendingProps)vr=!0;else{if(!U1(l,p)&&(d.flags&128)===0)return vr=!1,GN(l,d,p);vr=(l.flags&131072)!==0}else vr=!1,en&&(d.flags&1048576)!==0&&a3(d,Bp,d.index);switch(d.lanes=0,d.tag){case 16:e:{l=d.pendingProps;var v=d.elementType,S=v._init;if(v=S(v._payload),d.type=v,typeof v=="function")$1(v)?(l=Ul(v,l),d.tag=1,d=gS(null,d,v,l,p)):(d.tag=0,d=I1(null,d,v,l,p));else{if(v!=null){if(S=v.$$typeof,S===A){d.tag=11,d=uS(null,d,v,l,p);break e}else if(S===C){d.tag=14,d=dS(null,d,v,l,p);break e}}throw d=D(v)||v,Error(n(306,d,""))}}return d;case 0:return I1(l,d,d.type,d.pendingProps,p);case 1:return v=d.type,S=Ul(v,d.pendingProps),gS(l,d,v,S,p);case 3:e:{if(N(d,d.stateNode.containerInfo),l===null)throw Error(n(387));var E=d.pendingProps;S=d.memoizedState,v=S.element,Q1(l,d),cf(d,E,null,p);var H=d.memoizedState;if(E=H.cache,bs(d,cr,E),E!==S.cache&&k1(d,[cr],p,!0),lf(),E=H.element,S.isDehydrated)if(S={element:E,isDehydrated:!1,cache:H.cache},d.updateQueue.baseState=S,d.memoizedState=S,d.flags&256){d=vS(l,d,E,p);break e}else if(E!==v){v=qo(Error(n(424)),d),Xd(v),d=vS(l,d,E,p);break e}else for(wr=Sa(d.stateNode.containerInfo.firstChild),Xr=d,en=!0,ya=null,Xa=!0,p=p3(d,null,E,p),d.child=p;p;)p.flags=p.flags&-3|4096,p=p.sibling;else{if(jd(),E===v){d=Ii(l,d,p);break e}Tr(l,d,E,p)}d=d.child}return d;case 26:return of(l,d),l===null?(p=CC(d.type,null,d.pendingProps,null))?d.memoizedState=p:en||(p=d.type,l=d.pendingProps,v=dm(Q.current).createElement(p),v[Ue]=d,v[Ne]=l,Rr(v,p,l),Ot(v),d.stateNode=v):d.memoizedState=CC(d.type,l.memoizedProps,d.pendingProps,l.memoizedState),null;case 27:return ce(d),l===null&&en&&(v=d.stateNode=yC(d.type,d.pendingProps,Q.current),Xr=d,Xa=!0,wr=Sa(v.firstChild)),v=d.pendingProps.children,l!==null||en?Tr(l,d,v,p):d.child=Pl(d,null,v,p),of(l,d),d.child;case 5:return l===null&&en&&((S=v=wr)&&(v=_D(v,d.type,d.pendingProps,Xa),v!==null?(d.stateNode=v,Xr=d,wr=Sa(v.firstChild),Xa=!1,S=!0):S=!1),S||Bl(d)),ce(d),S=d.type,E=d.pendingProps,H=l!==null?l.memoizedProps:null,v=E.children,C_(S,E)?v=null:H!==null&&C_(S,H)&&(d.flags|=32),d.memoizedState!==null&&(S=f1(l,d,DN,null,null,p),Cf._currentValue=S),of(l,d),Tr(l,d,v,p),d.child;case 6:return l===null&&en&&((l=p=wr)&&(p=AD(p,d.pendingProps,Xa),p!==null?(d.stateNode=p,Xr=d,wr=null,l=!0):l=!1),l||Bl(d)),null;case 13:return _S(l,d,p);case 4:return N(d,d.stateNode.containerInfo),v=d.pendingProps,l===null?d.child=Pl(d,null,v,p):Tr(l,d,v,p),d.child;case 11:return uS(l,d,d.type,d.pendingProps,p);case 7:return Tr(l,d,d.pendingProps,p),d.child;case 8:return Tr(l,d,d.pendingProps.children,p),d.child;case 12:return Tr(l,d,d.pendingProps.children,p),d.child;case 10:return v=d.pendingProps,bs(d,d.type,v.value),Tr(l,d,v.children,p),d.child;case 9:return S=d.type._context,v=d.pendingProps.children,Vl(d),S=Ur(S),v=v(S),d.flags|=1,Tr(l,d,v,p),d.child;case 14:return dS(l,d,d.type,d.pendingProps,p);case 15:return fS(l,d,d.type,d.pendingProps,p);case 19:return xS(l,d,p);case 22:return hS(l,d,p);case 24:return Vl(d),v=Ur(cr),l===null?(S=u1(),S===null&&(S=xn,E=l1(),S.pooledCache=E,E.refCount++,E!==null&&(S.pooledCacheLanes|=p),S=E),d.memoizedState={parent:v,cache:S},G1(d),bs(d,cr,S)):((l.lanes&p)!==0&&(Q1(l,d),cf(d,null,null,p),lf()),S=l.memoizedState,E=d.memoizedState,S.parent!==v?(S={parent:v,cache:v},d.memoizedState=S,d.lanes===0&&(d.memoizedState=d.updateQueue.baseState=S),bs(d,cr,v)):(v=E.cache,bs(d,cr,v),v!==S.cache&&k1(d,[cr],p,!0))),Tr(l,d,d.pendingProps.children,p),d.child;case 29:throw d.pendingProps}throw Error(n(156,d.tag))}var z1=ee(null),zl=null,Li=null;function bs(l,d,p){W(z1,d._currentValue),d._currentValue=p}function Bi(l){l._currentValue=z1.current,X(z1)}function V1(l,d,p){for(;l!==null;){var v=l.alternate;if((l.childLanes&d)!==d?(l.childLanes|=d,v!==null&&(v.childLanes|=d)):v!==null&&(v.childLanes&d)!==d&&(v.childLanes|=d),l===p)break;l=l.return}}function k1(l,d,p,v){var S=l.child;for(S!==null&&(S.return=l);S!==null;){var E=S.dependencies;if(E!==null){var H=S.child;E=E.firstContext;e:for(;E!==null;){var ae=E;E=S;for(var ge=0;ge<d.length;ge++)if(ae.context===d[ge]){E.lanes|=p,ae=E.alternate,ae!==null&&(ae.lanes|=p),V1(E.return,p,l),v||(H=null);break e}E=ae.next}}else if(S.tag===18){if(H=S.return,H===null)throw Error(n(341));H.lanes|=p,E=H.alternate,E!==null&&(E.lanes|=p),V1(H,p,l),H=null}else H=S.child;if(H!==null)H.return=S;else for(H=S;H!==null;){if(H===l){H=null;break}if(S=H.sibling,S!==null){S.return=H.return,H=S;break}H=H.return}S=H}}function af(l,d,p,v){l=null;for(var S=d,E=!1;S!==null;){if(!E){if((S.flags&524288)!==0)E=!0;else if((S.flags&262144)!==0)break}if(S.tag===10){var H=S.alternate;if(H===null)throw Error(n(387));if(H=H.memoizedProps,H!==null){var ae=S.type;To(S.pendingProps.value,H.value)||(l!==null?l.push(ae):l=[ae])}}else if(S===I.current){if(H=S.alternate,H===null)throw Error(n(387));H.memoizedState.memoizedState!==S.memoizedState.memoizedState&&(l!==null?l.push(Cf):l=[Cf])}S=S.return}l!==null&&k1(d,l,p,v),d.flags|=262144}function qp(l){for(l=l.firstContext;l!==null;){if(!To(l.context._currentValue,l.memoizedValue))return!0;l=l.next}return!1}function Vl(l){zl=l,Li=null,l=l.dependencies,l!==null&&(l.firstContext=null)}function Ur(l){return bS(zl,l)}function Zp(l,d){return zl===null&&Vl(l),bS(l,d)}function bS(l,d){var p=d._currentValue;if(d={context:d,memoizedValue:p,next:null},Li===null){if(l===null)throw Error(n(308));Li=d,l.dependencies={lanes:0,firstContext:d},l.flags|=524288}else Li=Li.next=d;return p}var Ss=!1;function G1(l){l.updateQueue={baseState:l.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function Q1(l,d){l=l.updateQueue,d.updateQueue===l&&(d.updateQueue={baseState:l.baseState,firstBaseUpdate:l.firstBaseUpdate,lastBaseUpdate:l.lastBaseUpdate,shared:l.shared,callbacks:null})}function Cs(l){return{lane:l,tag:0,payload:null,callback:null,next:null}}function Es(l,d,p){var v=l.updateQueue;if(v===null)return null;if(v=v.shared,(Dn&2)!==0){var S=v.pending;return S===null?d.next=d:(d.next=S.next,S.next=d),v.pending=d,d=Ip(l),r3(l,null,p),d}return Rp(l,v,d,p),Ip(l)}function sf(l,d,p){if(d=d.updateQueue,d!==null&&(d=d.shared,(p&4194176)!==0)){var v=d.lanes;v&=l.pendingLanes,p|=v,d.lanes=p,bl(l,p)}}function H1(l,d){var p=l.updateQueue,v=l.alternate;if(v!==null&&(v=v.updateQueue,p===v)){var S=null,E=null;if(p=p.firstBaseUpdate,p!==null){do{var H={lane:p.lane,tag:p.tag,payload:p.payload,callback:null,next:null};E===null?S=E=H:E=E.next=H,p=p.next}while(p!==null);E===null?S=E=d:E=E.next=d}else S=E=d;p={baseState:v.baseState,firstBaseUpdate:S,lastBaseUpdate:E,shared:v.shared,callbacks:v.callbacks},l.updateQueue=p;return}l=p.lastBaseUpdate,l===null?p.firstBaseUpdate=d:l.next=d,p.lastBaseUpdate=d}var W1=!1;function lf(){if(W1){var l=jc;if(l!==null)throw l}}function cf(l,d,p,v){W1=!1;var S=l.updateQueue;Ss=!1;var E=S.firstBaseUpdate,H=S.lastBaseUpdate,ae=S.shared.pending;if(ae!==null){S.shared.pending=null;var ge=ae,Se=ge.next;ge.next=null,H===null?E=Se:H.next=Se,H=ge;var Fe=l.alternate;Fe!==null&&(Fe=Fe.updateQueue,ae=Fe.lastBaseUpdate,ae!==H&&(ae===null?Fe.firstBaseUpdate=Se:ae.next=Se,Fe.lastBaseUpdate=ge))}if(E!==null){var ke=S.baseState;H=0,Fe=Se=ge=null,ae=E;do{var Be=ae.lane&-536870913,Oe=Be!==ae.lane;if(Oe?(Zt&Be)===Be:(v&Be)===Be){Be!==0&&Be===Yc&&(W1=!0),Fe!==null&&(Fe=Fe.next={lane:0,tag:ae.tag,payload:ae.payload,callback:null,next:null});e:{var dt=l,wt=ae;Be=d;var kn=p;switch(wt.tag){case 1:if(dt=wt.payload,typeof dt=="function"){ke=dt.call(kn,ke,Be);break e}ke=dt;break e;case 3:dt.flags=dt.flags&-65537|128;case 0:if(dt=wt.payload,Be=typeof dt=="function"?dt.call(kn,ke,Be):dt,Be==null)break e;ke=F({},ke,Be);break e;case 2:Ss=!0}}Be=ae.callback,Be!==null&&(l.flags|=64,Oe&&(l.flags|=8192),Oe=S.callbacks,Oe===null?S.callbacks=[Be]:Oe.push(Be))}else Oe={lane:Be,tag:ae.tag,payload:ae.payload,callback:ae.callback,next:null},Fe===null?(Se=Fe=Oe,ge=ke):Fe=Fe.next=Oe,H|=Be;if(ae=ae.next,ae===null){if(ae=S.shared.pending,ae===null)break;Oe=ae,ae=Oe.next,Oe.next=null,S.lastBaseUpdate=Oe,S.shared.pending=null}}while(!0);Fe===null&&(ge=ke),S.baseState=ge,S.firstBaseUpdate=Se,S.lastBaseUpdate=Fe,E===null&&(S.shared.lanes=0),Is|=H,l.lanes=H,l.memoizedState=ke}}function SS(l,d){if(typeof l!="function")throw Error(n(191,l));l.call(d)}function CS(l,d){var p=l.callbacks;if(p!==null)for(l.callbacks=null,l=0;l<p.length;l++)SS(p[l],d)}function uf(l,d){try{var p=d.updateQueue,v=p!==null?p.lastEffect:null;if(v!==null){var S=v.next;p=S;do{if((p.tag&l)===l){v=void 0;var E=p.create,H=p.inst;v=E(),H.destroy=v}p=p.next}while(p!==S)}}catch(ae){vn(d,d.return,ae)}}function Ms(l,d,p){try{var v=d.updateQueue,S=v!==null?v.lastEffect:null;if(S!==null){var E=S.next;v=E;do{if((v.tag&l)===l){var H=v.inst,ae=H.destroy;if(ae!==void 0){H.destroy=void 0,S=d;var ge=p;try{ae()}catch(Se){vn(S,ge,Se)}}}v=v.next}while(v!==E)}}catch(Se){vn(d,d.return,Se)}}function ES(l){var d=l.updateQueue;if(d!==null){var p=l.stateNode;try{CS(d,p)}catch(v){vn(l,l.return,v)}}}function MS(l,d,p){p.props=Ul(l.type,l.memoizedProps),p.state=l.memoizedState;try{p.componentWillUnmount()}catch(v){vn(l,d,v)}}function kl(l,d){try{var p=l.ref;if(p!==null){var v=l.stateNode;switch(l.tag){case 26:case 27:case 5:var S=v;break;default:S=v}typeof p=="function"?l.refCleanup=p(S):p.current=S}}catch(E){vn(l,d,E)}}function Ro(l,d){var p=l.ref,v=l.refCleanup;if(p!==null)if(typeof v=="function")try{v()}catch(S){vn(l,d,S)}finally{l.refCleanup=null,l=l.alternate,l!=null&&(l.refCleanup=null)}else if(typeof p=="function")try{p(null)}catch(S){vn(l,d,S)}else p.current=null}function wS(l){var d=l.type,p=l.memoizedProps,v=l.stateNode;try{e:switch(d){case"button":case"input":case"select":case"textarea":p.autoFocus&&v.focus();break e;case"img":p.src?v.src=p.src:p.srcSet&&(v.srcset=p.srcSet)}}catch(S){vn(l,l.return,S)}}function TS(l,d,p){try{var v=l.stateNode;hD(v,l.type,p,d),v[Ne]=d}catch(S){vn(l,l.return,S)}}function RS(l){return l.tag===5||l.tag===3||l.tag===26||l.tag===27||l.tag===4}function Y1(l){e:for(;;){for(;l.sibling===null;){if(l.return===null||RS(l.return))return null;l=l.return}for(l.sibling.return=l.return,l=l.sibling;l.tag!==5&&l.tag!==6&&l.tag!==27&&l.tag!==18;){if(l.flags&2||l.child===null||l.tag===4)continue e;l.child.return=l,l=l.child}if(!(l.flags&2))return l.stateNode}}function j1(l,d,p){var v=l.tag;if(v===5||v===6)l=l.stateNode,d?p.nodeType===8?p.parentNode.insertBefore(l,d):p.insertBefore(l,d):(p.nodeType===8?(d=p.parentNode,d.insertBefore(l,p)):(d=p,d.appendChild(l)),p=p._reactRootContainer,p!=null||d.onclick!==null||(d.onclick=um));else if(v!==4&&v!==27&&(l=l.child,l!==null))for(j1(l,d,p),l=l.sibling;l!==null;)j1(l,d,p),l=l.sibling}function Kp(l,d,p){var v=l.tag;if(v===5||v===6)l=l.stateNode,d?p.insertBefore(l,d):p.appendChild(l);else if(v!==4&&v!==27&&(l=l.child,l!==null))for(Kp(l,d,p),l=l.sibling;l!==null;)Kp(l,d,p),l=l.sibling}var Pi=!1,zn=!1,X1=!1,IS=typeof WeakSet=="function"?WeakSet:Set,_r=null,LS=!1;function QN(l,d){if(l=l.containerInfo,b_=vm,l=Xb(l),Zv(l)){if("selectionStart"in l)var p={start:l.selectionStart,end:l.selectionEnd};else e:{p=(p=l.ownerDocument)&&p.defaultView||window;var v=p.getSelection&&p.getSelection();if(v&&v.rangeCount!==0){p=v.anchorNode;var S=v.anchorOffset,E=v.focusNode;v=v.focusOffset;try{p.nodeType,E.nodeType}catch{p=null;break e}var H=0,ae=-1,ge=-1,Se=0,Fe=0,ke=l,Be=null;t:for(;;){for(var Oe;ke!==p||S!==0&&ke.nodeType!==3||(ae=H+S),ke!==E||v!==0&&ke.nodeType!==3||(ge=H+v),ke.nodeType===3&&(H+=ke.nodeValue.length),(Oe=ke.firstChild)!==null;)Be=ke,ke=Oe;for(;;){if(ke===l)break t;if(Be===p&&++Se===S&&(ae=H),Be===E&&++Fe===v&&(ge=H),(Oe=ke.nextSibling)!==null)break;ke=Be,Be=ke.parentNode}ke=Oe}p=ae===-1||ge===-1?null:{start:ae,end:ge}}else p=null}p=p||{start:0,end:0}}else p=null;for(S_={focusedElem:l,selectionRange:p},vm=!1,_r=d;_r!==null;)if(d=_r,l=d.child,(d.subtreeFlags&1028)!==0&&l!==null)l.return=d,_r=l;else for(;_r!==null;){switch(d=_r,E=d.alternate,l=d.flags,d.tag){case 0:break;case 11:case 15:break;case 1:if((l&1024)!==0&&E!==null){l=void 0,p=d,S=E.memoizedProps,E=E.memoizedState,v=p.stateNode;try{var dt=Ul(p.type,S,p.elementType===p.type);l=v.getSnapshotBeforeUpdate(dt,E),v.__reactInternalSnapshotBeforeUpdate=l}catch(wt){vn(p,p.return,wt)}}break;case 3:if((l&1024)!==0){if(l=d.stateNode.containerInfo,p=l.nodeType,p===9)w_(l);else if(p===1)switch(l.nodeName){case"HEAD":case"HTML":case"BODY":w_(l);break;default:l.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((l&1024)!==0)throw Error(n(163))}if(l=d.sibling,l!==null){l.return=d.return,_r=l;break}_r=d.return}return dt=LS,LS=!1,dt}function BS(l,d,p){var v=p.flags;switch(p.tag){case 0:case 11:case 15:Di(l,p),v&4&&uf(5,p);break;case 1:if(Di(l,p),v&4)if(l=p.stateNode,d===null)try{l.componentDidMount()}catch(ae){vn(p,p.return,ae)}else{var S=Ul(p.type,d.memoizedProps);d=d.memoizedState;try{l.componentDidUpdate(S,d,l.__reactInternalSnapshotBeforeUpdate)}catch(ae){vn(p,p.return,ae)}}v&64&&ES(p),v&512&&kl(p,p.return);break;case 3:if(Di(l,p),v&64&&(v=p.updateQueue,v!==null)){if(l=null,p.child!==null)switch(p.child.tag){case 27:case 5:l=p.child.stateNode;break;case 1:l=p.child.stateNode}try{CS(v,l)}catch(ae){vn(p,p.return,ae)}}break;case 26:Di(l,p),v&512&&kl(p,p.return);break;case 27:case 5:Di(l,p),d===null&&v&4&&wS(p),v&512&&kl(p,p.return);break;case 12:Di(l,p);break;case 13:Di(l,p),v&4&&DS(l,p);break;case 22:if(S=p.memoizedState!==null||Pi,!S){d=d!==null&&d.memoizedState!==null||zn;var E=Pi,H=zn;Pi=S,(zn=d)&&!H?ws(l,p,(p.subtreeFlags&8772)!==0):Di(l,p),Pi=E,zn=H}v&512&&(p.memoizedProps.mode==="manual"?kl(p,p.return):Ro(p,p.return));break;default:Di(l,p)}}function PS(l){var d=l.alternate;d!==null&&(l.alternate=null,PS(d)),l.child=null,l.deletions=null,l.sibling=null,l.tag===5&&(d=l.stateNode,d!==null&&Sn(d)),l.stateNode=null,l.return=null,l.dependencies=null,l.memoizedProps=null,l.memoizedState=null,l.pendingProps=null,l.stateNode=null,l.updateQueue=null}var rr=null,Io=!1;function Ni(l,d,p){for(p=p.child;p!==null;)NS(l,d,p),p=p.sibling}function NS(l,d,p){if(St&&typeof St.onCommitFiberUnmount=="function")try{St.onCommitFiberUnmount($t,p)}catch{}switch(p.tag){case 26:zn||Ro(p,d),Ni(l,d,p),p.memoizedState?p.memoizedState.count--:p.stateNode&&(p=p.stateNode,p.parentNode.removeChild(p));break;case 27:zn||Ro(p,d);var v=rr,S=Io;for(rr=p.stateNode,Ni(l,d,p),p=p.stateNode,d=p.attributes;d.length;)p.removeAttributeNode(d[0]);Sn(p),rr=v,Io=S;break;case 5:zn||Ro(p,d);case 6:S=rr;var E=Io;if(rr=null,Ni(l,d,p),rr=S,Io=E,rr!==null)if(Io)try{l=rr,v=p.stateNode,l.nodeType===8?l.parentNode.removeChild(v):l.removeChild(v)}catch(H){vn(p,d,H)}else try{rr.removeChild(p.stateNode)}catch(H){vn(p,d,H)}break;case 18:rr!==null&&(Io?(d=rr,p=p.stateNode,d.nodeType===8?M_(d.parentNode,p):d.nodeType===1&&M_(d,p),Tf(d)):M_(rr,p.stateNode));break;case 4:v=rr,S=Io,rr=p.stateNode.containerInfo,Io=!0,Ni(l,d,p),rr=v,Io=S;break;case 0:case 11:case 14:case 15:zn||Ms(2,p,d),zn||Ms(4,p,d),Ni(l,d,p);break;case 1:zn||(Ro(p,d),v=p.stateNode,typeof v.componentWillUnmount=="function"&&MS(p,d,v)),Ni(l,d,p);break;case 21:Ni(l,d,p);break;case 22:zn||Ro(p,d),zn=(v=zn)||p.memoizedState!==null,Ni(l,d,p),zn=v;break;default:Ni(l,d,p)}}function DS(l,d){if(d.memoizedState===null&&(l=d.alternate,l!==null&&(l=l.memoizedState,l!==null&&(l=l.dehydrated,l!==null))))try{Tf(l)}catch(p){vn(d,d.return,p)}}function HN(l){switch(l.tag){case 13:case 19:var d=l.stateNode;return d===null&&(d=l.stateNode=new IS),d;case 22:return l=l.stateNode,d=l._retryCache,d===null&&(d=l._retryCache=new IS),d;default:throw Error(n(435,l.tag))}}function q1(l,d){var p=HN(l);d.forEach(function(v){var S=rD.bind(null,l,v);p.has(v)||(p.add(v),v.then(S,S))})}function Jo(l,d){var p=d.deletions;if(p!==null)for(var v=0;v<p.length;v++){var S=p[v],E=l,H=d,ae=H;e:for(;ae!==null;){switch(ae.tag){case 27:case 5:rr=ae.stateNode,Io=!1;break e;case 3:rr=ae.stateNode.containerInfo,Io=!0;break e;case 4:rr=ae.stateNode.containerInfo,Io=!0;break e}ae=ae.return}if(rr===null)throw Error(n(160));NS(E,H,S),rr=null,Io=!1,E=S.alternate,E!==null&&(E.return=null),S.return=null}if(d.subtreeFlags&13878)for(d=d.child;d!==null;)OS(d,l),d=d.sibling}var ba=null;function OS(l,d){var p=l.alternate,v=l.flags;switch(l.tag){case 0:case 11:case 14:case 15:Jo(d,l),ea(l),v&4&&(Ms(3,l,l.return),uf(3,l),Ms(5,l,l.return));break;case 1:Jo(d,l),ea(l),v&512&&(zn||p===null||Ro(p,p.return)),v&64&&Pi&&(l=l.updateQueue,l!==null&&(v=l.callbacks,v!==null&&(p=l.shared.hiddenCallbacks,l.shared.hiddenCallbacks=p===null?v:p.concat(v))));break;case 26:var S=ba;if(Jo(d,l),ea(l),v&512&&(zn||p===null||Ro(p,p.return)),v&4){var E=p!==null?p.memoizedState:null;if(v=l.memoizedState,p===null)if(v===null)if(l.stateNode===null){e:{v=l.type,p=l.memoizedProps,S=S.ownerDocument||S;t:switch(v){case"title":E=S.getElementsByTagName("title")[0],(!E||E[zt]||E[Ue]||E.namespaceURI==="http://www.w3.org/2000/svg"||E.hasAttribute("itemprop"))&&(E=S.createElement(v),S.head.insertBefore(E,S.querySelector("head > title"))),Rr(E,v,p),E[Ue]=l,Ot(E),v=E;break e;case"link":var H=wC("link","href",S).get(v+(p.href||""));if(H){for(var ae=0;ae<H.length;ae++)if(E=H[ae],E.getAttribute("href")===(p.href==null?null:p.href)&&E.getAttribute("rel")===(p.rel==null?null:p.rel)&&E.getAttribute("title")===(p.title==null?null:p.title)&&E.getAttribute("crossorigin")===(p.crossOrigin==null?null:p.crossOrigin)){H.splice(ae,1);break t}}E=S.createElement(v),Rr(E,v,p),S.head.appendChild(E);break;case"meta":if(H=wC("meta","content",S).get(v+(p.content||""))){for(ae=0;ae<H.length;ae++)if(E=H[ae],E.getAttribute("content")===(p.content==null?null:""+p.content)&&E.getAttribute("name")===(p.name==null?null:p.name)&&E.getAttribute("property")===(p.property==null?null:p.property)&&E.getAttribute("http-equiv")===(p.httpEquiv==null?null:p.httpEquiv)&&E.getAttribute("charset")===(p.charSet==null?null:p.charSet)){H.splice(ae,1);break t}}E=S.createElement(v),Rr(E,v,p),S.head.appendChild(E);break;default:throw Error(n(468,v))}E[Ue]=l,Ot(E),v=E}l.stateNode=v}else TC(S,l.type,l.stateNode);else l.stateNode=MC(S,v,l.memoizedProps);else E!==v?(E===null?p.stateNode!==null&&(p=p.stateNode,p.parentNode.removeChild(p)):E.count--,v===null?TC(S,l.type,l.stateNode):MC(S,v,l.memoizedProps)):v===null&&l.stateNode!==null&&TS(l,l.memoizedProps,p.memoizedProps)}break;case 27:if(v&4&&l.alternate===null){S=l.stateNode,E=l.memoizedProps;try{for(var ge=S.firstChild;ge;){var Se=ge.nextSibling,Fe=ge.nodeName;ge[zt]||Fe==="HEAD"||Fe==="BODY"||Fe==="SCRIPT"||Fe==="STYLE"||Fe==="LINK"&&ge.rel.toLowerCase()==="stylesheet"||S.removeChild(ge),ge=Se}for(var ke=l.type,Be=S.attributes;Be.length;)S.removeAttributeNode(Be[0]);Rr(S,ke,E),S[Ue]=l,S[Ne]=E}catch(dt){vn(l,l.return,dt)}}case 5:if(Jo(d,l),ea(l),v&512&&(zn||p===null||Ro(p,p.return)),l.flags&32){S=l.stateNode;try{wo(S,"")}catch(dt){vn(l,l.return,dt)}}v&4&&l.stateNode!=null&&(S=l.memoizedProps,TS(l,S,p!==null?p.memoizedProps:S)),v&1024&&(X1=!0);break;case 6:if(Jo(d,l),ea(l),v&4){if(l.stateNode===null)throw Error(n(162));v=l.memoizedProps,p=l.stateNode;try{p.nodeValue=v}catch(dt){vn(l,l.return,dt)}}break;case 3:if(pm=null,S=ba,ba=fm(d.containerInfo),Jo(d,l),ba=S,ea(l),v&4&&p!==null&&p.memoizedState.isDehydrated)try{Tf(d.containerInfo)}catch(dt){vn(l,l.return,dt)}X1&&(X1=!1,FS(l));break;case 4:v=ba,ba=fm(l.stateNode.containerInfo),Jo(d,l),ea(l),ba=v;break;case 12:Jo(d,l),ea(l);break;case 13:Jo(d,l),ea(l),l.child.flags&8192&&l.memoizedState!==null!=(p!==null&&p.memoizedState!==null)&&(o_=pe()),v&4&&(v=l.updateQueue,v!==null&&(l.updateQueue=null,q1(l,v)));break;case 22:if(v&512&&(zn||p===null||Ro(p,p.return)),ge=l.memoizedState!==null,Se=p!==null&&p.memoizedState!==null,Fe=Pi,ke=zn,Pi=Fe||ge,zn=ke||Se,Jo(d,l),zn=ke,Pi=Fe,ea(l),d=l.stateNode,d._current=l,d._visibility&=-3,d._visibility|=d._pendingVisibility&2,v&8192&&(d._visibility=ge?d._visibility&-2:d._visibility|1,ge&&(d=Pi||zn,p===null||Se||d||Kc(l)),l.memoizedProps===null||l.memoizedProps.mode!=="manual"))e:for(p=null,d=l;;){if(d.tag===5||d.tag===26||d.tag===27){if(p===null){Se=p=d;try{if(S=Se.stateNode,ge)E=S.style,typeof E.setProperty=="function"?E.setProperty("display","none","important"):E.display="none";else{H=Se.stateNode,ae=Se.memoizedProps.style;var Oe=ae!=null&&ae.hasOwnProperty("display")?ae.display:null;H.style.display=Oe==null||typeof Oe=="boolean"?"":(""+Oe).trim()}}catch(dt){vn(Se,Se.return,dt)}}}else if(d.tag===6){if(p===null){Se=d;try{Se.stateNode.nodeValue=ge?"":Se.memoizedProps}catch(dt){vn(Se,Se.return,dt)}}}else if((d.tag!==22&&d.tag!==23||d.memoizedState===null||d===l)&&d.child!==null){d.child.return=d,d=d.child;continue}if(d===l)break e;for(;d.sibling===null;){if(d.return===null||d.return===l)break e;p===d&&(p=null),d=d.return}p===d&&(p=null),d.sibling.return=d.return,d=d.sibling}v&4&&(v=l.updateQueue,v!==null&&(p=v.retryQueue,p!==null&&(v.retryQueue=null,q1(l,p))));break;case 19:Jo(d,l),ea(l),v&4&&(v=l.updateQueue,v!==null&&(l.updateQueue=null,q1(l,v)));break;case 21:break;default:Jo(d,l),ea(l)}}function ea(l){var d=l.flags;if(d&2){try{if(l.tag!==27){e:{for(var p=l.return;p!==null;){if(RS(p)){var v=p;break e}p=p.return}throw Error(n(160))}switch(v.tag){case 27:var S=v.stateNode,E=Y1(l);Kp(l,E,S);break;case 5:var H=v.stateNode;v.flags&32&&(wo(H,""),v.flags&=-33);var ae=Y1(l);Kp(l,ae,H);break;case 3:case 4:var ge=v.stateNode.containerInfo,Se=Y1(l);j1(l,Se,ge);break;default:throw Error(n(161))}}}catch(Fe){vn(l,l.return,Fe)}l.flags&=-3}d&4096&&(l.flags&=-4097)}function FS(l){if(l.subtreeFlags&1024)for(l=l.child;l!==null;){var d=l;FS(d),d.tag===5&&d.flags&1024&&d.stateNode.reset(),l=l.sibling}}function Di(l,d){if(d.subtreeFlags&8772)for(d=d.child;d!==null;)BS(l,d.alternate,d),d=d.sibling}function Kc(l){for(l=l.child;l!==null;){var d=l;switch(d.tag){case 0:case 11:case 14:case 15:Ms(4,d,d.return),Kc(d);break;case 1:Ro(d,d.return);var p=d.stateNode;typeof p.componentWillUnmount=="function"&&MS(d,d.return,p),Kc(d);break;case 26:case 27:case 5:Ro(d,d.return),Kc(d);break;case 22:Ro(d,d.return),d.memoizedState===null&&Kc(d);break;default:Kc(d)}l=l.sibling}}function ws(l,d,p){for(p=p&&(d.subtreeFlags&8772)!==0,d=d.child;d!==null;){var v=d.alternate,S=l,E=d,H=E.flags;switch(E.tag){case 0:case 11:case 15:ws(S,E,p),uf(4,E);break;case 1:if(ws(S,E,p),v=E,S=v.stateNode,typeof S.componentDidMount=="function")try{S.componentDidMount()}catch(Se){vn(v,v.return,Se)}if(v=E,S=v.updateQueue,S!==null){var ae=v.stateNode;try{var ge=S.shared.hiddenCallbacks;if(ge!==null)for(S.shared.hiddenCallbacks=null,S=0;S<ge.length;S++)SS(ge[S],ae)}catch(Se){vn(v,v.return,Se)}}p&&H&64&&ES(E),kl(E,E.return);break;case 26:case 27:case 5:ws(S,E,p),p&&v===null&&H&4&&wS(E),kl(E,E.return);break;case 12:ws(S,E,p);break;case 13:ws(S,E,p),p&&H&4&&DS(S,E);break;case 22:E.memoizedState===null&&ws(S,E,p),kl(E,E.return);break;default:ws(S,E,p)}d=d.sibling}}function Z1(l,d){var p=null;l!==null&&l.memoizedState!==null&&l.memoizedState.cachePool!==null&&(p=l.memoizedState.cachePool.pool),l=null,d.memoizedState!==null&&d.memoizedState.cachePool!==null&&(l=d.memoizedState.cachePool.pool),l!==p&&(l!=null&&l.refCount++,p!=null&&Jd(p))}function K1(l,d){l=null,d.alternate!==null&&(l=d.alternate.memoizedState.cache),d=d.memoizedState.cache,d!==l&&(d.refCount++,l!=null&&Jd(l))}function Ts(l,d,p,v){if(d.subtreeFlags&10256)for(d=d.child;d!==null;)US(l,d,p,v),d=d.sibling}function US(l,d,p,v){var S=d.flags;switch(d.tag){case 0:case 11:case 15:Ts(l,d,p,v),S&2048&&uf(9,d);break;case 3:Ts(l,d,p,v),S&2048&&(l=null,d.alternate!==null&&(l=d.alternate.memoizedState.cache),d=d.memoizedState.cache,d!==l&&(d.refCount++,l!=null&&Jd(l)));break;case 12:if(S&2048){Ts(l,d,p,v),l=d.stateNode;try{var E=d.memoizedProps,H=E.id,ae=E.onPostCommit;typeof ae=="function"&&ae(H,d.alternate===null?"mount":"update",l.passiveEffectDuration,-0)}catch(ge){vn(d,d.return,ge)}}else Ts(l,d,p,v);break;case 23:break;case 22:E=d.stateNode,d.memoizedState!==null?E._visibility&4?Ts(l,d,p,v):df(l,d):E._visibility&4?Ts(l,d,p,v):(E._visibility|=4,$c(l,d,p,v,(d.subtreeFlags&10256)!==0)),S&2048&&Z1(d.alternate,d);break;case 24:Ts(l,d,p,v),S&2048&&K1(d.alternate,d);break;default:Ts(l,d,p,v)}}function $c(l,d,p,v,S){for(S=S&&(d.subtreeFlags&10256)!==0,d=d.child;d!==null;){var E=l,H=d,ae=p,ge=v,Se=H.flags;switch(H.tag){case 0:case 11:case 15:$c(E,H,ae,ge,S),uf(8,H);break;case 23:break;case 22:var Fe=H.stateNode;H.memoizedState!==null?Fe._visibility&4?$c(E,H,ae,ge,S):df(E,H):(Fe._visibility|=4,$c(E,H,ae,ge,S)),S&&Se&2048&&Z1(H.alternate,H);break;case 24:$c(E,H,ae,ge,S),S&&Se&2048&&K1(H.alternate,H);break;default:$c(E,H,ae,ge,S)}d=d.sibling}}function df(l,d){if(d.subtreeFlags&10256)for(d=d.child;d!==null;){var p=l,v=d,S=v.flags;switch(v.tag){case 22:df(p,v),S&2048&&Z1(v.alternate,v);break;case 24:df(p,v),S&2048&&K1(v.alternate,v);break;default:df(p,v)}d=d.sibling}}var ff=8192;function Jc(l){if(l.subtreeFlags&ff)for(l=l.child;l!==null;)zS(l),l=l.sibling}function zS(l){switch(l.tag){case 26:Jc(l),l.flags&ff&&l.memoizedState!==null&&BD(ba,l.memoizedState,l.memoizedProps);break;case 5:Jc(l);break;case 3:case 4:var d=ba;ba=fm(l.stateNode.containerInfo),Jc(l),ba=d;break;case 22:l.memoizedState===null&&(d=l.alternate,d!==null&&d.memoizedState!==null?(d=ff,ff=16777216,Jc(l),ff=d):Jc(l));break;default:Jc(l)}}function VS(l){var d=l.alternate;if(d!==null&&(l=d.child,l!==null)){d.child=null;do d=l.sibling,l.sibling=null,l=d;while(l!==null)}}function hf(l){var d=l.deletions;if((l.flags&16)!==0){if(d!==null)for(var p=0;p<d.length;p++){var v=d[p];_r=v,GS(v,l)}VS(l)}if(l.subtreeFlags&10256)for(l=l.child;l!==null;)kS(l),l=l.sibling}function kS(l){switch(l.tag){case 0:case 11:case 15:hf(l),l.flags&2048&&Ms(9,l,l.return);break;case 3:hf(l);break;case 12:hf(l);break;case 22:var d=l.stateNode;l.memoizedState!==null&&d._visibility&4&&(l.return===null||l.return.tag!==13)?(d._visibility&=-5,$p(l)):hf(l);break;default:hf(l)}}function $p(l){var d=l.deletions;if((l.flags&16)!==0){if(d!==null)for(var p=0;p<d.length;p++){var v=d[p];_r=v,GS(v,l)}VS(l)}for(l=l.child;l!==null;){switch(d=l,d.tag){case 0:case 11:case 15:Ms(8,d,d.return),$p(d);break;case 22:p=d.stateNode,p._visibility&4&&(p._visibility&=-5,$p(d));break;default:$p(d)}l=l.sibling}}function GS(l,d){for(;_r!==null;){var p=_r;switch(p.tag){case 0:case 11:case 15:Ms(8,p,d);break;case 23:case 22:if(p.memoizedState!==null&&p.memoizedState.cachePool!==null){var v=p.memoizedState.cachePool.pool;v!=null&&v.refCount++}break;case 24:Jd(p.memoizedState.cache)}if(v=p.child,v!==null)v.return=p,_r=v;else e:for(p=l;_r!==null;){v=_r;var S=v.sibling,E=v.return;if(PS(v),v===p){_r=null;break e}if(S!==null){S.return=E,_r=S;break e}_r=E}}}function WN(l,d,p,v){this.tag=l,this.key=p,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=d,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=v,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function ta(l,d,p,v){return new WN(l,d,p,v)}function $1(l){return l=l.prototype,!(!l||!l.isReactComponent)}function Rs(l,d){var p=l.alternate;return p===null?(p=ta(l.tag,d,l.key,l.mode),p.elementType=l.elementType,p.type=l.type,p.stateNode=l.stateNode,p.alternate=l,l.alternate=p):(p.pendingProps=d,p.type=l.type,p.flags=0,p.subtreeFlags=0,p.deletions=null),p.flags=l.flags&31457280,p.childLanes=l.childLanes,p.lanes=l.lanes,p.child=l.child,p.memoizedProps=l.memoizedProps,p.memoizedState=l.memoizedState,p.updateQueue=l.updateQueue,d=l.dependencies,p.dependencies=d===null?null:{lanes:d.lanes,firstContext:d.firstContext},p.sibling=l.sibling,p.index=l.index,p.ref=l.ref,p.refCleanup=l.refCleanup,p}function QS(l,d){l.flags&=31457282;var p=l.alternate;return p===null?(l.childLanes=0,l.lanes=d,l.child=null,l.subtreeFlags=0,l.memoizedProps=null,l.memoizedState=null,l.updateQueue=null,l.dependencies=null,l.stateNode=null):(l.childLanes=p.childLanes,l.lanes=p.lanes,l.child=p.child,l.subtreeFlags=0,l.deletions=null,l.memoizedProps=p.memoizedProps,l.memoizedState=p.memoizedState,l.updateQueue=p.updateQueue,l.type=p.type,d=p.dependencies,l.dependencies=d===null?null:{lanes:d.lanes,firstContext:d.firstContext}),l}function Jp(l,d,p,v,S,E){var H=0;if(v=l,typeof l=="function")$1(l)&&(H=1);else if(typeof l=="string")H=ID(l,p,Y.current)?26:l==="html"||l==="head"||l==="body"?27:5;else e:switch(l){case c:return Gl(p.children,S,E,d);case u:H=8,S|=24;break;case h:return l=ta(12,p,d,S|2),l.elementType=h,l.lanes=E,l;case _:return l=ta(13,p,d,S),l.elementType=_,l.lanes=E,l;case x:return l=ta(19,p,d,S),l.elementType=x,l.lanes=E,l;case y:return HS(p,S,E,d);default:if(typeof l=="object"&&l!==null)switch(l.$$typeof){case f:case g:H=10;break e;case m:H=9;break e;case A:H=11;break e;case C:H=14;break e;case b:H=16,v=null;break e}H=29,p=Error(n(130,l===null?"null":typeof l,"")),v=null}return d=ta(H,p,d,S),d.elementType=l,d.type=v,d.lanes=E,d}function Gl(l,d,p,v){return l=ta(7,l,v,d),l.lanes=p,l}function HS(l,d,p,v){l=ta(22,l,v,d),l.elementType=y,l.lanes=p;var S={_visibility:1,_pendingVisibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null,_current:null,detach:function(){var E=S._current;if(E===null)throw Error(n(456));if((S._pendingVisibility&2)===0){var H=vs(E,2);H!==null&&(S._pendingVisibility|=2,qr(H,E,2))}},attach:function(){var E=S._current;if(E===null)throw Error(n(456));if((S._pendingVisibility&2)!==0){var H=vs(E,2);H!==null&&(S._pendingVisibility&=-3,qr(H,E,2))}}};return l.stateNode=S,l}function J1(l,d,p){return l=ta(6,l,null,d),l.lanes=p,l}function e_(l,d,p){return d=ta(4,l.children!==null?l.children:[],l.key,d),d.lanes=p,d.stateNode={containerInfo:l.containerInfo,pendingChildren:null,implementation:l.implementation},d}function Oi(l){l.flags|=4}function WS(l,d){if(d.type!=="stylesheet"||(d.state.loading&4)!==0)l.flags&=-16777217;else if(l.flags|=16777216,!RC(d)){if(d=$o.current,d!==null&&((Zt&4194176)===Zt?qa!==null:(Zt&62914560)!==Zt&&(Zt&536870912)===0||d!==qa))throw Zd=a1,l3;l.flags|=8192}}function em(l,d){d!==null&&(l.flags|=4),l.flags&16384&&(d=l.tag!==22?So():536870912,l.lanes|=d,tu|=d)}function pf(l,d){if(!en)switch(l.tailMode){case"hidden":d=l.tail;for(var p=null;d!==null;)d.alternate!==null&&(p=d),d=d.sibling;p===null?l.tail=null:p.sibling=null;break;case"collapsed":p=l.tail;for(var v=null;p!==null;)p.alternate!==null&&(v=p),p=p.sibling;v===null?d||l.tail===null?l.tail=null:l.tail.sibling=null:v.sibling=null}}function Nn(l){var d=l.alternate!==null&&l.alternate.child===l.child,p=0,v=0;if(d)for(var S=l.child;S!==null;)p|=S.lanes|S.childLanes,v|=S.subtreeFlags&31457280,v|=S.flags&31457280,S.return=l,S=S.sibling;else for(S=l.child;S!==null;)p|=S.lanes|S.childLanes,v|=S.subtreeFlags,v|=S.flags,S.return=l,S=S.sibling;return l.subtreeFlags|=v,l.childLanes=p,d}function YN(l,d,p){var v=d.pendingProps;switch(r1(d),d.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Nn(d),null;case 1:return Nn(d),null;case 3:return p=d.stateNode,v=null,l!==null&&(v=l.memoizedState.cache),d.memoizedState.cache!==v&&(d.flags|=2048),Bi(cr),se(),p.pendingContext&&(p.context=p.pendingContext,p.pendingContext=null),(l===null||l.child===null)&&(Yd(d)?Oi(d):l===null||l.memoizedState.isDehydrated&&(d.flags&256)===0||(d.flags|=1024,ya!==null&&(l_(ya),ya=null))),Nn(d),null;case 26:return p=d.memoizedState,l===null?(Oi(d),p!==null?(Nn(d),WS(d,p)):(Nn(d),d.flags&=-16777217)):p?p!==l.memoizedState?(Oi(d),Nn(d),WS(d,p)):(Nn(d),d.flags&=-16777217):(l.memoizedProps!==v&&Oi(d),Nn(d),d.flags&=-16777217),null;case 27:fe(d),p=Q.current;var S=d.type;if(l!==null&&d.stateNode!=null)l.memoizedProps!==v&&Oi(d);else{if(!v){if(d.stateNode===null)throw Error(n(166));return Nn(d),null}l=Y.current,Yd(d)?i3(d):(l=yC(S,v,p),d.stateNode=l,Oi(d))}return Nn(d),null;case 5:if(fe(d),p=d.type,l!==null&&d.stateNode!=null)l.memoizedProps!==v&&Oi(d);else{if(!v){if(d.stateNode===null)throw Error(n(166));return Nn(d),null}if(l=Y.current,Yd(d))i3(d);else{switch(S=dm(Q.current),l){case 1:l=S.createElementNS("http://www.w3.org/2000/svg",p);break;case 2:l=S.createElementNS("http://www.w3.org/1998/Math/MathML",p);break;default:switch(p){case"svg":l=S.createElementNS("http://www.w3.org/2000/svg",p);break;case"math":l=S.createElementNS("http://www.w3.org/1998/Math/MathML",p);break;case"script":l=S.createElement("div"),l.innerHTML="<script><\/script>",l=l.removeChild(l.firstChild);break;case"select":l=typeof v.is=="string"?S.createElement("select",{is:v.is}):S.createElement("select"),v.multiple?l.multiple=!0:v.size&&(l.size=v.size);break;default:l=typeof v.is=="string"?S.createElement(p,{is:v.is}):S.createElement(p)}}l[Ue]=d,l[Ne]=v;e:for(S=d.child;S!==null;){if(S.tag===5||S.tag===6)l.appendChild(S.stateNode);else if(S.tag!==4&&S.tag!==27&&S.child!==null){S.child.return=S,S=S.child;continue}if(S===d)break e;for(;S.sibling===null;){if(S.return===null||S.return===d)break e;S=S.return}S.sibling.return=S.return,S=S.sibling}d.stateNode=l;e:switch(Rr(l,p,v),p){case"button":case"input":case"select":case"textarea":l=!!v.autoFocus;break e;case"img":l=!0;break e;default:l=!1}l&&Oi(d)}}return Nn(d),d.flags&=-16777217,null;case 6:if(l&&d.stateNode!=null)l.memoizedProps!==v&&Oi(d);else{if(typeof v!="string"&&d.stateNode===null)throw Error(n(166));if(l=Q.current,Yd(d)){if(l=d.stateNode,p=d.memoizedProps,v=null,S=Xr,S!==null)switch(S.tag){case 27:case 5:v=S.memoizedProps}l[Ue]=d,l=!!(l.nodeValue===p||v!==null&&v.suppressHydrationWarning===!0||mC(l.nodeValue,p)),l||Bl(d)}else l=dm(l).createTextNode(v),l[Ue]=d,d.stateNode=l}return Nn(d),null;case 13:if(v=d.memoizedState,l===null||l.memoizedState!==null&&l.memoizedState.dehydrated!==null){if(S=Yd(d),v!==null&&v.dehydrated!==null){if(l===null){if(!S)throw Error(n(318));if(S=d.memoizedState,S=S!==null?S.dehydrated:null,!S)throw Error(n(317));S[Ue]=d}else jd(),(d.flags&128)===0&&(d.memoizedState=null),d.flags|=4;Nn(d),S=!1}else ya!==null&&(l_(ya),ya=null),S=!0;if(!S)return d.flags&256?(Ti(d),d):(Ti(d),null)}if(Ti(d),(d.flags&128)!==0)return d.lanes=p,d;if(p=v!==null,l=l!==null&&l.memoizedState!==null,p){v=d.child,S=null,v.alternate!==null&&v.alternate.memoizedState!==null&&v.alternate.memoizedState.cachePool!==null&&(S=v.alternate.memoizedState.cachePool.pool);var E=null;v.memoizedState!==null&&v.memoizedState.cachePool!==null&&(E=v.memoizedState.cachePool.pool),E!==S&&(v.flags|=2048)}return p!==l&&p&&(d.child.flags|=8192),em(d,d.updateQueue),Nn(d),null;case 4:return se(),l===null&&A_(d.stateNode.containerInfo),Nn(d),null;case 10:return Bi(d.type),Nn(d),null;case 19:if(X(lr),S=d.memoizedState,S===null)return Nn(d),null;if(v=(d.flags&128)!==0,E=S.rendering,E===null)if(v)pf(S,!1);else{if(Vn!==0||l!==null&&(l.flags&128)!==0)for(l=d.child;l!==null;){if(E=Fp(l),E!==null){for(d.flags|=128,pf(S,!1),l=E.updateQueue,d.updateQueue=l,em(d,l),d.subtreeFlags=0,l=p,p=d.child;p!==null;)QS(p,l),p=p.sibling;return W(lr,lr.current&1|2),d.child}l=l.sibling}S.tail!==null&&pe()>tm&&(d.flags|=128,v=!0,pf(S,!1),d.lanes=4194304)}else{if(!v)if(l=Fp(E),l!==null){if(d.flags|=128,v=!0,l=l.updateQueue,d.updateQueue=l,em(d,l),pf(S,!0),S.tail===null&&S.tailMode==="hidden"&&!E.alternate&&!en)return Nn(d),null}else 2*pe()-S.renderingStartTime>tm&&p!==536870912&&(d.flags|=128,v=!0,pf(S,!1),d.lanes=4194304);S.isBackwards?(E.sibling=d.child,d.child=E):(l=S.last,l!==null?l.sibling=E:d.child=E,S.last=E)}return S.tail!==null?(d=S.tail,S.rendering=d,S.tail=d.sibling,S.renderingStartTime=pe(),d.sibling=null,l=lr.current,W(lr,v?l&1|2:l&1),d):(Nn(d),null);case 22:case 23:return Ti(d),s1(),v=d.memoizedState!==null,l!==null?l.memoizedState!==null!==v&&(d.flags|=8192):v&&(d.flags|=8192),v?(p&536870912)!==0&&(d.flags&128)===0&&(Nn(d),d.subtreeFlags&6&&(d.flags|=8192)):Nn(d),p=d.updateQueue,p!==null&&em(d,p.retryQueue),p=null,l!==null&&l.memoizedState!==null&&l.memoizedState.cachePool!==null&&(p=l.memoizedState.cachePool.pool),v=null,d.memoizedState!==null&&d.memoizedState.cachePool!==null&&(v=d.memoizedState.cachePool.pool),v!==p&&(d.flags|=2048),l!==null&&X(Nl),null;case 24:return p=null,l!==null&&(p=l.memoizedState.cache),d.memoizedState.cache!==p&&(d.flags|=2048),Bi(cr),Nn(d),null;case 25:return null}throw Error(n(156,d.tag))}function jN(l,d){switch(r1(d),d.tag){case 1:return l=d.flags,l&65536?(d.flags=l&-65537|128,d):null;case 3:return Bi(cr),se(),l=d.flags,(l&65536)!==0&&(l&128)===0?(d.flags=l&-65537|128,d):null;case 26:case 27:case 5:return fe(d),null;case 13:if(Ti(d),l=d.memoizedState,l!==null&&l.dehydrated!==null){if(d.alternate===null)throw Error(n(340));jd()}return l=d.flags,l&65536?(d.flags=l&-65537|128,d):null;case 19:return X(lr),null;case 4:return se(),null;case 10:return Bi(d.type),null;case 22:case 23:return Ti(d),s1(),l!==null&&X(Nl),l=d.flags,l&65536?(d.flags=l&-65537|128,d):null;case 24:return Bi(cr),null;case 25:return null;default:return null}}function YS(l,d){switch(r1(d),d.tag){case 3:Bi(cr),se();break;case 26:case 27:case 5:fe(d);break;case 4:se();break;case 13:Ti(d);break;case 19:X(lr);break;case 10:Bi(d.type);break;case 22:case 23:Ti(d),s1(),l!==null&&X(Nl);break;case 24:Bi(cr)}}var XN={getCacheForType:function(l){var d=Ur(cr),p=d.data.get(l);return p===void 0&&(p=l(),d.data.set(l,p)),p}},qN=typeof WeakMap=="function"?WeakMap:Map,Dn=0,xn=null,Qt=null,Zt=0,yn=0,Lo=null,Fi=!1,eu=!1,t_=!1,Ui=0,Vn=0,Is=0,Ql=0,n_=0,na=0,tu=0,mf=null,Ka=null,r_=!1,o_=0,tm=1/0,nm=null,Ls=null,rm=!1,Hl=null,gf=0,a_=0,i_=null,vf=0,s_=null;function Bo(){if((Dn&2)!==0&&Zt!==0)return Zt&-Zt;if(z.T!==null){var l=Yc;return l!==0?l:m_()}return Z()}function jS(){na===0&&(na=(Zt&536870912)===0||en?xl():536870912);var l=$o.current;return l!==null&&(l.flags|=32),na}function qr(l,d,p){(l===xn&&yn===2||l.cancelPendingCommit!==null)&&(nu(l,0),zi(l,Zt,na,!1)),Si(l,p),((Dn&2)===0||l!==xn)&&(l===xn&&((Dn&2)===0&&(Ql|=p),Vn===4&&zi(l,Zt,na,!1)),$a(l))}function XS(l,d,p){if((Dn&6)!==0)throw Error(n(327));var v=!p&&(d&60)===0&&(d&l.expiredLanes)===0||Wa(l,d),S=v?$N(l,d):d_(l,d,!0),E=v;do{if(S===0){eu&&!v&&zi(l,d,0,!1);break}else if(S===6)zi(l,d,0,!Fi);else{if(p=l.current.alternate,E&&!ZN(p)){S=d_(l,d,!1),E=!1;continue}if(S===2){if(E=d,l.errorRecoveryDisabledLanes&E)var H=0;else H=l.pendingLanes&-536870913,H=H!==0?H:H&536870912?536870912:0;if(H!==0){d=H;e:{var ae=l;S=mf;var ge=ae.current.memoizedState.isDehydrated;if(ge&&(nu(ae,H).flags|=256),H=d_(ae,H,!1),H!==2){if(t_&&!ge){ae.errorRecoveryDisabledLanes|=E,Ql|=E,S=4;break e}E=Ka,Ka=S,E!==null&&l_(E)}S=H}if(E=!1,S!==2)continue}}if(S===1){nu(l,0),zi(l,d,0,!0);break}e:{switch(v=l,S){case 0:case 1:throw Error(n(345));case 4:if((d&4194176)===d){zi(v,d,na,!Fi);break e}break;case 2:Ka=null;break;case 3:case 5:break;default:throw Error(n(329))}if(v.finishedWork=p,v.finishedLanes=d,(d&62914560)===d&&(E=o_+300-pe(),10<E)){if(zi(v,d,na,!Fi),gn(v,0)!==0)break e;v.timeoutHandle=_C(qS.bind(null,v,p,Ka,nm,r_,d,na,Ql,tu,Fi,2,-0,0),E);break e}qS(v,p,Ka,nm,r_,d,na,Ql,tu,Fi,0,-0,0)}}break}while(!0);$a(l)}function l_(l){Ka===null?Ka=l:Ka.push.apply(Ka,l)}function qS(l,d,p,v,S,E,H,ae,ge,Se,Fe,ke,Be){var Oe=d.subtreeFlags;if((Oe&8192||(Oe&16785408)===16785408)&&(Sf={stylesheets:null,count:0,unsuspend:LD},zS(d),d=PD(),d!==null)){l.cancelPendingCommit=d(nC.bind(null,l,p,v,S,H,ae,ge,1,ke,Be)),zi(l,E,H,!Se);return}nC(l,p,v,S,H,ae,ge,Fe,ke,Be)}function ZN(l){for(var d=l;;){var p=d.tag;if((p===0||p===11||p===15)&&d.flags&16384&&(p=d.updateQueue,p!==null&&(p=p.stores,p!==null)))for(var v=0;v<p.length;v++){var S=p[v],E=S.getSnapshot;S=S.value;try{if(!To(E(),S))return!1}catch{return!1}}if(p=d.child,d.subtreeFlags&16384&&p!==null)p.return=d,d=p;else{if(d===l)break;for(;d.sibling===null;){if(d.return===null||d.return===l)return!0;d=d.return}d.sibling.return=d.return,d=d.sibling}}return!0}function zi(l,d,p,v){d&=~n_,d&=~Ql,l.suspendedLanes|=d,l.pingedLanes&=~d,v&&(l.warmLanes|=d),v=l.expirationTimes;for(var S=d;0<S;){var E=31-dn(S),H=1<<E;v[E]=-1,S&=~H}p!==0&&yl(l,p,d)}function om(){return(Dn&6)===0?(_f(0),!1):!0}function c_(){if(Qt!==null){if(yn===0)var l=Qt.return;else l=Qt,Li=zl=null,m1(l),Hc=null,Kd=0,l=Qt;for(;l!==null;)YS(l.alternate,l),l=l.return;Qt=null}}function nu(l,d){l.finishedWork=null,l.finishedLanes=0;var p=l.timeoutHandle;p!==-1&&(l.timeoutHandle=-1,mD(p)),p=l.cancelPendingCommit,p!==null&&(l.cancelPendingCommit=null,p()),c_(),xn=l,Qt=p=Rs(l.current,null),Zt=d,yn=0,Lo=null,Fi=!1,eu=Wa(l,d),t_=!1,tu=na=n_=Ql=Is=Vn=0,Ka=mf=null,r_=!1,(d&8)!==0&&(d|=d&32);var v=l.entangledLanes;if(v!==0)for(l=l.entanglements,v&=d;0<v;){var S=31-dn(v),E=1<<S;d|=l[S],v&=~E}return Ui=d,Tp(),p}function ZS(l,d){Vt=null,z.H=Za,d===qd?(d=d3(),yn=3):d===l3?(d=d3(),yn=4):yn=d===cS?8:d!==null&&typeof d=="object"&&typeof d.then=="function"?6:1,Lo=d,Qt===null&&(Vn=1,Xp(l,qo(d,l.current)))}function KS(){var l=z.H;return z.H=Za,l===null?Za:l}function $S(){var l=z.A;return z.A=XN,l}function u_(){Vn=4,Fi||(Zt&4194176)!==Zt&&$o.current!==null||(eu=!0),(Is&134217727)===0&&(Ql&134217727)===0||xn===null||zi(xn,Zt,na,!1)}function d_(l,d,p){var v=Dn;Dn|=2;var S=KS(),E=$S();(xn!==l||Zt!==d)&&(nm=null,nu(l,d)),d=!1;var H=Vn;e:do try{if(yn!==0&&Qt!==null){var ae=Qt,ge=Lo;switch(yn){case 8:c_(),H=6;break e;case 3:case 2:case 6:$o.current===null&&(d=!0);var Se=yn;if(yn=0,Lo=null,ru(l,ae,ge,Se),p&&eu){H=0;break e}break;default:Se=yn,yn=0,Lo=null,ru(l,ae,ge,Se)}}KN(),H=Vn;break}catch(Fe){ZS(l,Fe)}while(!0);return d&&l.shellSuspendCounter++,Li=zl=null,Dn=v,z.H=S,z.A=E,Qt===null&&(xn=null,Zt=0,Tp()),H}function KN(){for(;Qt!==null;)JS(Qt)}function $N(l,d){var p=Dn;Dn|=2;var v=KS(),S=$S();xn!==l||Zt!==d?(nm=null,tm=pe()+500,nu(l,d)):eu=Wa(l,d);e:do try{if(yn!==0&&Qt!==null){d=Qt;var E=Lo;t:switch(yn){case 1:yn=0,Lo=null,ru(l,d,E,1);break;case 2:if(c3(E)){yn=0,Lo=null,eC(d);break}d=function(){yn===2&&xn===l&&(yn=7),$a(l)},E.then(d,d);break e;case 3:yn=7;break e;case 4:yn=5;break e;case 7:c3(E)?(yn=0,Lo=null,eC(d)):(yn=0,Lo=null,ru(l,d,E,7));break;case 5:var H=null;switch(Qt.tag){case 26:H=Qt.memoizedState;case 5:case 27:var ae=Qt;if(!H||RC(H)){yn=0,Lo=null;var ge=ae.sibling;if(ge!==null)Qt=ge;else{var Se=ae.return;Se!==null?(Qt=Se,am(Se)):Qt=null}break t}}yn=0,Lo=null,ru(l,d,E,5);break;case 6:yn=0,Lo=null,ru(l,d,E,6);break;case 8:c_(),Vn=6;break e;default:throw Error(n(462))}}JN();break}catch(Fe){ZS(l,Fe)}while(!0);return Li=zl=null,z.H=v,z.A=S,Dn=p,Qt!==null?0:(xn=null,Zt=0,Tp(),Vn)}function JN(){for(;Qt!==null&&!re();)JS(Qt)}function JS(l){var d=yS(l.alternate,l,Ui);l.memoizedProps=l.pendingProps,d===null?am(l):Qt=d}function eC(l){var d=l,p=d.alternate;switch(d.tag){case 15:case 0:d=mS(p,d,d.pendingProps,d.type,void 0,Zt);break;case 11:d=mS(p,d,d.pendingProps,d.type.render,d.ref,Zt);break;case 5:m1(d);default:YS(p,d),d=Qt=QS(d,Ui),d=yS(p,d,Ui)}l.memoizedProps=l.pendingProps,d===null?am(l):Qt=d}function ru(l,d,p,v){Li=zl=null,m1(d),Hc=null,Kd=0;var S=d.return;try{if(kN(l,S,d,p,Zt)){Vn=1,Xp(l,qo(p,l.current)),Qt=null;return}}catch(E){if(S!==null)throw Qt=S,E;Vn=1,Xp(l,qo(p,l.current)),Qt=null;return}d.flags&32768?(en||v===1?l=!0:eu||(Zt&536870912)!==0?l=!1:(Fi=l=!0,(v===2||v===3||v===6)&&(v=$o.current,v!==null&&v.tag===13&&(v.flags|=16384))),tC(d,l)):am(d)}function am(l){var d=l;do{if((d.flags&32768)!==0){tC(d,Fi);return}l=d.return;var p=YN(d.alternate,d,Ui);if(p!==null){Qt=p;return}if(d=d.sibling,d!==null){Qt=d;return}Qt=d=l}while(d!==null);Vn===0&&(Vn=5)}function tC(l,d){do{var p=jN(l.alternate,l);if(p!==null){p.flags&=32767,Qt=p;return}if(p=l.return,p!==null&&(p.flags|=32768,p.subtreeFlags=0,p.deletions=null),!d&&(l=l.sibling,l!==null)){Qt=l;return}Qt=l=p}while(l!==null);Vn=6,Qt=null}function nC(l,d,p,v,S,E,H,ae,ge,Se){var Fe=z.T,ke=te.p;try{te.p=2,z.T=null,eD(l,d,p,v,ke,S,E,H,ae,ge,Se)}finally{z.T=Fe,te.p=ke}}function eD(l,d,p,v,S,E,H,ae){do ou();while(Hl!==null);if((Dn&6)!==0)throw Error(n(327));var ge=l.finishedWork;if(v=l.finishedLanes,ge===null)return null;if(l.finishedWork=null,l.finishedLanes=0,ge===l.current)throw Error(n(177));l.callbackNode=null,l.callbackPriority=0,l.cancelPendingCommit=null;var Se=ge.lanes|ge.childLanes;if(Se|=e1,Ci(l,v,Se,E,H,ae),l===xn&&(Qt=xn=null,Zt=0),(ge.subtreeFlags&10256)===0&&(ge.flags&10256)===0||rm||(rm=!0,a_=Se,i_=p,oD(Pe,function(){return ou(),null})),p=(ge.flags&15990)!==0,(ge.subtreeFlags&15990)!==0||p?(p=z.T,z.T=null,E=te.p,te.p=2,H=Dn,Dn|=4,QN(l,ge),OS(ge,l),CN(S_,l.containerInfo),vm=!!b_,S_=b_=null,l.current=ge,BS(l,ge.alternate,ge),me(),Dn=H,te.p=E,z.T=p):l.current=ge,rm?(rm=!1,Hl=l,gf=v):rC(l,Se),Se=l.pendingLanes,Se===0&&(Ls=null),De(ge.stateNode),$a(l),d!==null)for(S=l.onRecoverableError,ge=0;ge<d.length;ge++)Se=d[ge],S(Se.value,{componentStack:Se.stack});return(gf&3)!==0&&ou(),Se=l.pendingLanes,(v&4194218)!==0&&(Se&42)!==0?l===s_?vf++:(vf=0,s_=l):vf=0,_f(0),null}function rC(l,d){(l.pooledCacheLanes&=d)===0&&(d=l.pooledCache,d!=null&&(l.pooledCache=null,Jd(d)))}function ou(){if(Hl!==null){var l=Hl,d=a_;a_=0;var p=Eo(gf),v=z.T,S=te.p;try{if(te.p=32>p?32:p,z.T=null,Hl===null)var E=!1;else{p=i_,i_=null;var H=Hl,ae=gf;if(Hl=null,gf=0,(Dn&6)!==0)throw Error(n(331));var ge=Dn;if(Dn|=4,kS(H.current),US(H,H.current,ae,p),Dn=ge,_f(0,!1),St&&typeof St.onPostCommitFiberRoot=="function")try{St.onPostCommitFiberRoot($t,H)}catch{}E=!0}return E}finally{te.p=S,z.T=v,rC(l,d)}}return!1}function oC(l,d,p){d=qo(p,d),d=R1(l.stateNode,d,2),l=Es(l,d,2),l!==null&&(Si(l,2),$a(l))}function vn(l,d,p){if(l.tag===3)oC(l,l,p);else for(;d!==null;){if(d.tag===3){oC(d,l,p);break}else if(d.tag===1){var v=d.stateNode;if(typeof d.type.getDerivedStateFromError=="function"||typeof v.componentDidCatch=="function"&&(Ls===null||!Ls.has(v))){l=qo(p,l),p=sS(2),v=Es(d,p,2),v!==null&&(lS(p,v,d,l),Si(v,2),$a(v));break}}d=d.return}}function f_(l,d,p){var v=l.pingCache;if(v===null){v=l.pingCache=new qN;var S=new Set;v.set(d,S)}else S=v.get(d),S===void 0&&(S=new Set,v.set(d,S));S.has(p)||(t_=!0,S.add(p),l=tD.bind(null,l,d,p),d.then(l,l))}function tD(l,d,p){var v=l.pingCache;v!==null&&v.delete(d),l.pingedLanes|=l.suspendedLanes&p,l.warmLanes&=~p,xn===l&&(Zt&p)===p&&(Vn===4||Vn===3&&(Zt&62914560)===Zt&&300>pe()-o_?(Dn&2)===0&&nu(l,0):n_|=p,tu===Zt&&(tu=0)),$a(l)}function aC(l,d){d===0&&(d=So()),l=vs(l,d),l!==null&&(Si(l,d),$a(l))}function nD(l){var d=l.memoizedState,p=0;d!==null&&(p=d.retryLane),aC(l,p)}function rD(l,d){var p=0;switch(l.tag){case 13:var v=l.stateNode,S=l.memoizedState;S!==null&&(p=S.retryLane);break;case 19:v=l.stateNode;break;case 22:v=l.stateNode._retryCache;break;default:throw Error(n(314))}v!==null&&v.delete(d),aC(l,p)}function oD(l,d){return xe(l,d)}var im=null,au=null,h_=!1,sm=!1,p_=!1,Wl=0;function $a(l){l!==au&&l.next===null&&(au===null?im=au=l:au=au.next=l),sm=!0,h_||(h_=!0,iD(aD))}function _f(l,d){if(!p_&&sm){p_=!0;do for(var p=!1,v=im;v!==null;){if(l!==0){var S=v.pendingLanes;if(S===0)var E=0;else{var H=v.suspendedLanes,ae=v.pingedLanes;E=(1<<31-dn(42|l)+1)-1,E&=S&~(H&~ae),E=E&201326677?E&201326677|1:E?E|2:0}E!==0&&(p=!0,lC(v,E))}else E=Zt,E=gn(v,v===xn?E:0),(E&3)===0||Wa(v,E)||(p=!0,lC(v,E));v=v.next}while(p);p_=!1}}function aD(){sm=h_=!1;var l=0;Wl!==0&&(pD()&&(l=Wl),Wl=0);for(var d=pe(),p=null,v=im;v!==null;){var S=v.next,E=iC(v,d);E===0?(v.next=null,p===null?im=S:p.next=S,S===null&&(au=p)):(p=v,(l!==0||(E&3)!==0)&&(sm=!0)),v=S}_f(l)}function iC(l,d){for(var p=l.suspendedLanes,v=l.pingedLanes,S=l.expirationTimes,E=l.pendingLanes&-62914561;0<E;){var H=31-dn(E),ae=1<<H,ge=S[H];ge===-1?((ae&p)===0||(ae&v)!==0)&&(S[H]=ga(ae,d)):ge<=d&&(l.expiredLanes|=ae),E&=~ae}if(d=xn,p=Zt,p=gn(l,l===d?p:0),v=l.callbackNode,p===0||l===d&&yn===2||l.cancelPendingCommit!==null)return v!==null&&v!==null&&Ie(v),l.callbackNode=null,l.callbackPriority=0;if((p&3)===0||Wa(l,p)){if(d=p&-p,d===l.callbackPriority)return d;switch(v!==null&&Ie(v),Eo(p)){case 2:case 8:p=be;break;case 32:p=Pe;break;case 268435456:p=tt;break;default:p=Pe}return v=sC.bind(null,l),p=xe(p,v),l.callbackPriority=d,l.callbackNode=p,d}return v!==null&&v!==null&&Ie(v),l.callbackPriority=2,l.callbackNode=null,2}function sC(l,d){var p=l.callbackNode;if(ou()&&l.callbackNode!==p)return null;var v=Zt;return v=gn(l,l===xn?v:0),v===0?null:(XS(l,v,d),iC(l,pe()),l.callbackNode!=null&&l.callbackNode===p?sC.bind(null,l):null)}function lC(l,d){if(ou())return null;XS(l,d,!0)}function iD(l){gD(function(){(Dn&6)!==0?xe(we,l):l()})}function m_(){return Wl===0&&(Wl=xl()),Wl}function cC(l){return l==null||typeof l=="symbol"||typeof l=="boolean"?null:typeof l=="function"?l:Ml(""+l)}function uC(l,d){var p=d.ownerDocument.createElement("input");return p.name=d.name,p.value=d.value,l.id&&p.setAttribute("form",l.id),d.parentNode.insertBefore(p,d),l=new FormData(l),p.parentNode.removeChild(p),l}function sD(l,d,p,v,S){if(d==="submit"&&p&&p.stateNode===S){var E=cC((S[Ne]||null).action),H=v.submitter;H&&(d=(d=H[Ne]||null)?cC(d.formAction):H.getAttribute("formAction"),d!==null&&(E=d,H=null));var ae=new Ep("action","action",null,v,S);l.push({event:ae,listeners:[{instance:null,listener:function(){if(v.defaultPrevented){if(Wl!==0){var ge=H?uC(S,H):new FormData(S);C1(p,{pending:!0,data:ge,method:S.method,action:E},null,ge)}}else typeof E=="function"&&(ae.preventDefault(),ge=H?uC(S,H):new FormData(S),C1(p,{pending:!0,data:ge,method:S.method,action:E},E,ge))},currentTarget:S}]})}}for(var g_=0;g_<n3.length;g_++){var v_=n3[g_],lD=v_.toLowerCase(),cD=v_[0].toUpperCase()+v_.slice(1);xa(lD,"on"+cD)}xa(Kb,"onAnimationEnd"),xa($b,"onAnimationIteration"),xa(Jb,"onAnimationStart"),xa("dblclick","onDoubleClick"),xa("focusin","onFocus"),xa("focusout","onBlur"),xa(MN,"onTransitionRun"),xa(wN,"onTransitionStart"),xa(TN,"onTransitionCancel"),xa(e3,"onTransitionEnd"),qe("onMouseEnter",["mouseout","mouseover"]),qe("onMouseLeave",["mouseout","mouseover"]),qe("onPointerEnter",["pointerout","pointerover"]),qe("onPointerLeave",["pointerout","pointerover"]),Cn("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),Cn("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),Cn("onBeforeInput",["compositionend","keypress","textInput","paste"]),Cn("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),Cn("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),Cn("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Af="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),uD=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Af));function dC(l,d){d=(d&4)!==0;for(var p=0;p<l.length;p++){var v=l[p],S=v.event;v=v.listeners;e:{var E=void 0;if(d)for(var H=v.length-1;0<=H;H--){var ae=v[H],ge=ae.instance,Se=ae.currentTarget;if(ae=ae.listener,ge!==E&&S.isPropagationStopped())break e;E=ae,S.currentTarget=Se;try{E(S)}catch(Fe){jp(Fe)}S.currentTarget=null,E=ge}else for(H=0;H<v.length;H++){if(ae=v[H],ge=ae.instance,Se=ae.currentTarget,ae=ae.listener,ge!==E&&S.isPropagationStopped())break e;E=ae,S.currentTarget=Se;try{E(S)}catch(Fe){jp(Fe)}S.currentTarget=null,E=ge}}}}function Xt(l,d){var p=d[gt];p===void 0&&(p=d[gt]=new Set);var v=l+"__bubble";p.has(v)||(fC(d,l,2,!1),p.add(v))}function __(l,d,p){var v=0;d&&(v|=4),fC(p,l,v,d)}var lm="_reactListening"+Math.random().toString(36).slice(2);function A_(l){if(!l[lm]){l[lm]=!0,Pn.forEach(function(p){p!=="selectionchange"&&(uD.has(p)||__(p,!1,l),__(p,!0,l))});var d=l.nodeType===9?l:l.ownerDocument;d===null||d[lm]||(d[lm]=!0,__("selectionchange",!1,d))}}function fC(l,d,p,v){switch(DC(d)){case 2:var S=OD;break;case 8:S=FD;break;default:S=B_}p=S.bind(null,d,p,l),S=void 0,!kv||d!=="touchstart"&&d!=="touchmove"&&d!=="wheel"||(S=!0),v?S!==void 0?l.addEventListener(d,p,{capture:!0,passive:S}):l.addEventListener(d,p,!0):S!==void 0?l.addEventListener(d,p,{passive:S}):l.addEventListener(d,p,!1)}function x_(l,d,p,v,S){var E=v;if((d&1)===0&&(d&2)===0&&v!==null)e:for(;;){if(v===null)return;var H=v.tag;if(H===3||H===4){var ae=v.stateNode.containerInfo;if(ae===S||ae.nodeType===8&&ae.parentNode===S)break;if(H===4)for(H=v.return;H!==null;){var ge=H.tag;if((ge===3||ge===4)&&(ge=H.stateNode.containerInfo,ge===S||ge.nodeType===8&&ge.parentNode===S))return;H=H.return}for(;ae!==null;){if(H=Dt(ae),H===null)return;if(ge=H.tag,ge===5||ge===6||ge===26||ge===27){v=E=H;continue e}ae=ae.parentNode}}v=v.return}wb(function(){var Se=E,Fe=En(p),ke=[];e:{var Be=t3.get(l);if(Be!==void 0){var Oe=Ep,dt=l;switch(l){case"keypress":if(Sp(p)===0)break e;case"keydown":case"keyup":Oe=rN;break;case"focusin":dt="focus",Oe=Wv;break;case"focusout":dt="blur",Oe=Wv;break;case"beforeblur":case"afterblur":Oe=Wv;break;case"click":if(p.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Oe=Ib;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Oe=WP;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Oe=iN;break;case Kb:case $b:case Jb:Oe=XP;break;case e3:Oe=lN;break;case"scroll":case"scrollend":Oe=QP;break;case"wheel":Oe=uN;break;case"copy":case"cut":case"paste":Oe=ZP;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Oe=Bb;break;case"toggle":case"beforetoggle":Oe=fN}var wt=(d&4)!==0,kn=!wt&&(l==="scroll"||l==="scrollend"),Me=wt?Be!==null?Be+"Capture":null:Be;wt=[];for(var ye=Se,Re;ye!==null;){var ze=ye;if(Re=ze.stateNode,ze=ze.tag,ze!==5&&ze!==26&&ze!==27||Re===null||Me===null||(ze=Fd(ye,Me),ze!=null&&wt.push(xf(ye,ze,Re))),kn)break;ye=ye.return}0<wt.length&&(Be=new Oe(Be,dt,null,p,Fe),ke.push({event:Be,listeners:wt}))}}if((d&7)===0){e:{if(Be=l==="mouseover"||l==="pointerover",Oe=l==="mouseout"||l==="pointerout",Be&&p!==Jt&&(dt=p.relatedTarget||p.fromElement)&&(Dt(dt)||dt[We]))break e;if((Oe||Be)&&(Be=Fe.window===Fe?Fe:(Be=Fe.ownerDocument)?Be.defaultView||Be.parentWindow:window,Oe?(dt=p.relatedTarget||p.toElement,Oe=Se,dt=dt?Dt(dt):null,dt!==null&&(kn=ie(dt),wt=dt.tag,dt!==kn||wt!==5&&wt!==27&&wt!==6)&&(dt=null)):(Oe=null,dt=Se),Oe!==dt)){if(wt=Ib,ze="onMouseLeave",Me="onMouseEnter",ye="mouse",(l==="pointerout"||l==="pointerover")&&(wt=Bb,ze="onPointerLeave",Me="onPointerEnter",ye="pointer"),kn=Oe==null?Be:on(Oe),Re=dt==null?Be:on(dt),Be=new wt(ze,ye+"leave",Oe,p,Fe),Be.target=kn,Be.relatedTarget=Re,ze=null,Dt(Fe)===Se&&(wt=new wt(Me,ye+"enter",dt,p,Fe),wt.target=Re,wt.relatedTarget=kn,ze=wt),kn=ze,Oe&&dt)t:{for(wt=Oe,Me=dt,ye=0,Re=wt;Re;Re=iu(Re))ye++;for(Re=0,ze=Me;ze;ze=iu(ze))Re++;for(;0<ye-Re;)wt=iu(wt),ye--;for(;0<Re-ye;)Me=iu(Me),Re--;for(;ye--;){if(wt===Me||Me!==null&&wt===Me.alternate)break t;wt=iu(wt),Me=iu(Me)}wt=null}else wt=null;Oe!==null&&hC(ke,Be,Oe,wt,!1),dt!==null&&kn!==null&&hC(ke,kn,dt,wt,!0)}}e:{if(Be=Se?on(Se):window,Oe=Be.nodeName&&Be.nodeName.toLowerCase(),Oe==="select"||Oe==="input"&&Be.type==="file")var rt=Vb;else if(Ub(Be))if(kb)rt=bN;else{rt=xN;var Gt=AN}else Oe=Be.nodeName,!Oe||Oe.toLowerCase()!=="input"||Be.type!=="checkbox"&&Be.type!=="radio"?Se&&El(Se.elementType)&&(rt=Vb):rt=yN;if(rt&&(rt=rt(l,Se))){zb(ke,rt,p,Fe);break e}Gt&&Gt(l,Be,Se),l==="focusout"&&Se&&Be.type==="number"&&Se.memoizedProps.value!=null&&uo(Be,"number",Be.value)}switch(Gt=Se?on(Se):window,l){case"focusin":(Ub(Gt)||Gt.contentEditable==="true")&&(Uc=Gt,Kv=Se,Wd=null);break;case"focusout":Wd=Kv=Uc=null;break;case"mousedown":$v=!0;break;case"contextmenu":case"mouseup":case"dragend":$v=!1,qb(ke,p,Fe);break;case"selectionchange":if(EN)break;case"keydown":case"keyup":qb(ke,p,Fe)}var ft;if(jv)e:{switch(l){case"compositionstart":var _t="onCompositionStart";break e;case"compositionend":_t="onCompositionEnd";break e;case"compositionupdate":_t="onCompositionUpdate";break e}_t=void 0}else Fc?Ob(l,p)&&(_t="onCompositionEnd"):l==="keydown"&&p.keyCode===229&&(_t="onCompositionStart");_t&&(Pb&&p.locale!=="ko"&&(Fc||_t!=="onCompositionStart"?_t==="onCompositionEnd"&&Fc&&(ft=Tb()):(gs=Fe,Gv="value"in gs?gs.value:gs.textContent,Fc=!0)),Gt=cm(Se,_t),0<Gt.length&&(_t=new Lb(_t,l,null,p,Fe),ke.push({event:_t,listeners:Gt}),ft?_t.data=ft:(ft=Fb(p),ft!==null&&(_t.data=ft)))),(ft=pN?mN(l,p):gN(l,p))&&(_t=cm(Se,"onBeforeInput"),0<_t.length&&(Gt=new Lb("onBeforeInput","beforeinput",null,p,Fe),ke.push({event:Gt,listeners:_t}),Gt.data=ft)),sD(ke,l,Se,p,Fe)}dC(ke,d)})}function xf(l,d,p){return{instance:l,listener:d,currentTarget:p}}function cm(l,d){for(var p=d+"Capture",v=[];l!==null;){var S=l,E=S.stateNode;S=S.tag,S!==5&&S!==26&&S!==27||E===null||(S=Fd(l,p),S!=null&&v.unshift(xf(l,S,E)),S=Fd(l,d),S!=null&&v.push(xf(l,S,E))),l=l.return}return v}function iu(l){if(l===null)return null;do l=l.return;while(l&&l.tag!==5&&l.tag!==27);return l||null}function hC(l,d,p,v,S){for(var E=d._reactName,H=[];p!==null&&p!==v;){var ae=p,ge=ae.alternate,Se=ae.stateNode;if(ae=ae.tag,ge!==null&&ge===v)break;ae!==5&&ae!==26&&ae!==27||Se===null||(ge=Se,S?(Se=Fd(p,E),Se!=null&&H.unshift(xf(p,Se,ge))):S||(Se=Fd(p,E),Se!=null&&H.push(xf(p,Se,ge)))),p=p.return}H.length!==0&&l.push({event:d,listeners:H})}var dD=/\r\n?/g,fD=/\u0000|\uFFFD/g;function pC(l){return(typeof l=="string"?l:""+l).replace(dD,`
`).replace(fD,"")}function mC(l,d){return d=pC(d),pC(l)===d}function um(){}function hn(l,d,p,v,S,E){switch(p){case"children":typeof v=="string"?d==="body"||d==="textarea"&&v===""||wo(l,v):(typeof v=="number"||typeof v=="bigint")&&d!=="body"&&wo(l,""+v);break;case"className":Dc(l,"class",v);break;case"tabIndex":Dc(l,"tabindex",v);break;case"dir":case"role":case"viewBox":case"width":case"height":Dc(l,p,v);break;case"style":ja(l,v,E);break;case"data":if(d!=="object"){Dc(l,"data",v);break}case"src":case"href":if(v===""&&(d!=="a"||p!=="href")){l.removeAttribute(p);break}if(v==null||typeof v=="function"||typeof v=="symbol"||typeof v=="boolean"){l.removeAttribute(p);break}v=Ml(""+v),l.setAttribute(p,v);break;case"action":case"formAction":if(typeof v=="function"){l.setAttribute(p,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof E=="function"&&(p==="formAction"?(d!=="input"&&hn(l,d,"name",S.name,S,null),hn(l,d,"formEncType",S.formEncType,S,null),hn(l,d,"formMethod",S.formMethod,S,null),hn(l,d,"formTarget",S.formTarget,S,null)):(hn(l,d,"encType",S.encType,S,null),hn(l,d,"method",S.method,S,null),hn(l,d,"target",S.target,S,null)));if(v==null||typeof v=="symbol"||typeof v=="boolean"){l.removeAttribute(p);break}v=Ml(""+v),l.setAttribute(p,v);break;case"onClick":v!=null&&(l.onclick=um);break;case"onScroll":v!=null&&Xt("scroll",l);break;case"onScrollEnd":v!=null&&Xt("scrollend",l);break;case"dangerouslySetInnerHTML":if(v!=null){if(typeof v!="object"||!("__html"in v))throw Error(n(61));if(p=v.__html,p!=null){if(S.children!=null)throw Error(n(60));l.innerHTML=p}}break;case"multiple":l.multiple=v&&typeof v!="function"&&typeof v!="symbol";break;case"muted":l.muted=v&&typeof v!="function"&&typeof v!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(v==null||typeof v=="function"||typeof v=="boolean"||typeof v=="symbol"){l.removeAttribute("xlink:href");break}p=Ml(""+v),l.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",p);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":v!=null&&typeof v!="function"&&typeof v!="symbol"?l.setAttribute(p,""+v):l.removeAttribute(p);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":v&&typeof v!="function"&&typeof v!="symbol"?l.setAttribute(p,""):l.removeAttribute(p);break;case"capture":case"download":v===!0?l.setAttribute(p,""):v!==!1&&v!=null&&typeof v!="function"&&typeof v!="symbol"?l.setAttribute(p,v):l.removeAttribute(p);break;case"cols":case"rows":case"size":case"span":v!=null&&typeof v!="function"&&typeof v!="symbol"&&!isNaN(v)&&1<=v?l.setAttribute(p,v):l.removeAttribute(p);break;case"rowSpan":case"start":v==null||typeof v=="function"||typeof v=="symbol"||isNaN(v)?l.removeAttribute(p):l.setAttribute(p,v);break;case"popover":Xt("beforetoggle",l),Xt("toggle",l),Nc(l,"popover",v);break;case"xlinkActuate":va(l,"http://www.w3.org/1999/xlink","xlink:actuate",v);break;case"xlinkArcrole":va(l,"http://www.w3.org/1999/xlink","xlink:arcrole",v);break;case"xlinkRole":va(l,"http://www.w3.org/1999/xlink","xlink:role",v);break;case"xlinkShow":va(l,"http://www.w3.org/1999/xlink","xlink:show",v);break;case"xlinkTitle":va(l,"http://www.w3.org/1999/xlink","xlink:title",v);break;case"xlinkType":va(l,"http://www.w3.org/1999/xlink","xlink:type",v);break;case"xmlBase":va(l,"http://www.w3.org/XML/1998/namespace","xml:base",v);break;case"xmlLang":va(l,"http://www.w3.org/XML/1998/namespace","xml:lang",v);break;case"xmlSpace":va(l,"http://www.w3.org/XML/1998/namespace","xml:space",v);break;case"is":Nc(l,"is",v);break;case"innerText":case"textContent":break;default:(!(2<p.length)||p[0]!=="o"&&p[0]!=="O"||p[1]!=="n"&&p[1]!=="N")&&(p=fo.get(p)||p,Nc(l,p,v))}}function y_(l,d,p,v,S,E){switch(p){case"style":ja(l,v,E);break;case"dangerouslySetInnerHTML":if(v!=null){if(typeof v!="object"||!("__html"in v))throw Error(n(61));if(p=v.__html,p!=null){if(S.children!=null)throw Error(n(60));l.innerHTML=p}}break;case"children":typeof v=="string"?wo(l,v):(typeof v=="number"||typeof v=="bigint")&&wo(l,""+v);break;case"onScroll":v!=null&&Xt("scroll",l);break;case"onScrollEnd":v!=null&&Xt("scrollend",l);break;case"onClick":v!=null&&(l.onclick=um);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!Mo.hasOwnProperty(p))e:{if(p[0]==="o"&&p[1]==="n"&&(S=p.endsWith("Capture"),d=p.slice(2,S?p.length-7:void 0),E=l[Ne]||null,E=E!=null?E[p]:null,typeof E=="function"&&l.removeEventListener(d,E,S),typeof v=="function")){typeof E!="function"&&E!==null&&(p in l?l[p]=null:l.hasAttribute(p)&&l.removeAttribute(p)),l.addEventListener(d,v,S);break e}p in l?l[p]=v:v===!0?l.setAttribute(p,""):Nc(l,p,v)}}}function Rr(l,d,p){switch(d){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":Xt("error",l),Xt("load",l);var v=!1,S=!1,E;for(E in p)if(p.hasOwnProperty(E)){var H=p[E];if(H!=null)switch(E){case"src":v=!0;break;case"srcSet":S=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(n(137,d));default:hn(l,d,E,H,p,null)}}S&&hn(l,d,"srcSet",p.srcSet,p,null),v&&hn(l,d,"src",p.src,p,null);return;case"input":Xt("invalid",l);var ae=E=H=S=null,ge=null,Se=null;for(v in p)if(p.hasOwnProperty(v)){var Fe=p[v];if(Fe!=null)switch(v){case"name":S=Fe;break;case"type":H=Fe;break;case"checked":ge=Fe;break;case"defaultChecked":Se=Fe;break;case"value":E=Fe;break;case"defaultValue":ae=Fe;break;case"children":case"dangerouslySetInnerHTML":if(Fe!=null)throw Error(n(137,d));break;default:hn(l,d,v,Fe,p,null)}}yp(l,E,ae,ge,Se,H,S,!1),Sl(l);return;case"select":Xt("invalid",l),v=H=E=null;for(S in p)if(p.hasOwnProperty(S)&&(ae=p[S],ae!=null))switch(S){case"value":E=ae;break;case"defaultValue":H=ae;break;case"multiple":v=ae;default:hn(l,d,S,ae,p,null)}d=E,p=H,l.multiple=!!v,d!=null?Ei(l,!!v,d,!1):p!=null&&Ei(l,!!v,p,!0);return;case"textarea":Xt("invalid",l),E=S=v=null;for(H in p)if(p.hasOwnProperty(H)&&(ae=p[H],ae!=null))switch(H){case"value":v=ae;break;case"defaultValue":S=ae;break;case"children":E=ae;break;case"dangerouslySetInnerHTML":if(ae!=null)throw Error(n(91));break;default:hn(l,d,H,ae,p,null)}Dd(l,v,S,E),Sl(l);return;case"option":for(ge in p)if(p.hasOwnProperty(ge)&&(v=p[ge],v!=null))switch(ge){case"selected":l.selected=v&&typeof v!="function"&&typeof v!="symbol";break;default:hn(l,d,ge,v,p,null)}return;case"dialog":Xt("cancel",l),Xt("close",l);break;case"iframe":case"object":Xt("load",l);break;case"video":case"audio":for(v=0;v<Af.length;v++)Xt(Af[v],l);break;case"image":Xt("error",l),Xt("load",l);break;case"details":Xt("toggle",l);break;case"embed":case"source":case"link":Xt("error",l),Xt("load",l);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(Se in p)if(p.hasOwnProperty(Se)&&(v=p[Se],v!=null))switch(Se){case"children":case"dangerouslySetInnerHTML":throw Error(n(137,d));default:hn(l,d,Se,v,p,null)}return;default:if(El(d)){for(Fe in p)p.hasOwnProperty(Fe)&&(v=p[Fe],v!==void 0&&y_(l,d,Fe,v,p,void 0));return}}for(ae in p)p.hasOwnProperty(ae)&&(v=p[ae],v!=null&&hn(l,d,ae,v,p,null))}function hD(l,d,p,v){switch(d){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var S=null,E=null,H=null,ae=null,ge=null,Se=null,Fe=null;for(Oe in p){var ke=p[Oe];if(p.hasOwnProperty(Oe)&&ke!=null)switch(Oe){case"checked":break;case"value":break;case"defaultValue":ge=ke;default:v.hasOwnProperty(Oe)||hn(l,d,Oe,null,v,ke)}}for(var Be in v){var Oe=v[Be];if(ke=p[Be],v.hasOwnProperty(Be)&&(Oe!=null||ke!=null))switch(Be){case"type":E=Oe;break;case"name":S=Oe;break;case"checked":Se=Oe;break;case"defaultChecked":Fe=Oe;break;case"value":H=Oe;break;case"defaultValue":ae=Oe;break;case"children":case"dangerouslySetInnerHTML":if(Oe!=null)throw Error(n(137,d));break;default:Oe!==ke&&hn(l,d,Be,Oe,v,ke)}}Cl(l,H,ae,ge,Se,Fe,E,S);return;case"select":Oe=H=ae=Be=null;for(E in p)if(ge=p[E],p.hasOwnProperty(E)&&ge!=null)switch(E){case"value":break;case"multiple":Oe=ge;default:v.hasOwnProperty(E)||hn(l,d,E,null,v,ge)}for(S in v)if(E=v[S],ge=p[S],v.hasOwnProperty(S)&&(E!=null||ge!=null))switch(S){case"value":Be=E;break;case"defaultValue":ae=E;break;case"multiple":H=E;default:E!==ge&&hn(l,d,S,E,v,ge)}d=ae,p=H,v=Oe,Be!=null?Ei(l,!!p,Be,!1):!!v!=!!p&&(d!=null?Ei(l,!!p,d,!0):Ei(l,!!p,p?[]:"",!1));return;case"textarea":Oe=Be=null;for(ae in p)if(S=p[ae],p.hasOwnProperty(ae)&&S!=null&&!v.hasOwnProperty(ae))switch(ae){case"value":break;case"children":break;default:hn(l,d,ae,null,v,S)}for(H in v)if(S=v[H],E=p[H],v.hasOwnProperty(H)&&(S!=null||E!=null))switch(H){case"value":Be=S;break;case"defaultValue":Oe=S;break;case"children":break;case"dangerouslySetInnerHTML":if(S!=null)throw Error(n(91));break;default:S!==E&&hn(l,d,H,S,v,E)}Ya(l,Be,Oe);return;case"option":for(var dt in p)if(Be=p[dt],p.hasOwnProperty(dt)&&Be!=null&&!v.hasOwnProperty(dt))switch(dt){case"selected":l.selected=!1;break;default:hn(l,d,dt,null,v,Be)}for(ge in v)if(Be=v[ge],Oe=p[ge],v.hasOwnProperty(ge)&&Be!==Oe&&(Be!=null||Oe!=null))switch(ge){case"selected":l.selected=Be&&typeof Be!="function"&&typeof Be!="symbol";break;default:hn(l,d,ge,Be,v,Oe)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var wt in p)Be=p[wt],p.hasOwnProperty(wt)&&Be!=null&&!v.hasOwnProperty(wt)&&hn(l,d,wt,null,v,Be);for(Se in v)if(Be=v[Se],Oe=p[Se],v.hasOwnProperty(Se)&&Be!==Oe&&(Be!=null||Oe!=null))switch(Se){case"children":case"dangerouslySetInnerHTML":if(Be!=null)throw Error(n(137,d));break;default:hn(l,d,Se,Be,v,Oe)}return;default:if(El(d)){for(var kn in p)Be=p[kn],p.hasOwnProperty(kn)&&Be!==void 0&&!v.hasOwnProperty(kn)&&y_(l,d,kn,void 0,v,Be);for(Fe in v)Be=v[Fe],Oe=p[Fe],!v.hasOwnProperty(Fe)||Be===Oe||Be===void 0&&Oe===void 0||y_(l,d,Fe,Be,v,Oe);return}}for(var Me in p)Be=p[Me],p.hasOwnProperty(Me)&&Be!=null&&!v.hasOwnProperty(Me)&&hn(l,d,Me,null,v,Be);for(ke in v)Be=v[ke],Oe=p[ke],!v.hasOwnProperty(ke)||Be===Oe||Be==null&&Oe==null||hn(l,d,ke,Be,v,Oe)}var b_=null,S_=null;function dm(l){return l.nodeType===9?l:l.ownerDocument}function gC(l){switch(l){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function vC(l,d){if(l===0)switch(d){case"svg":return 1;case"math":return 2;default:return 0}return l===1&&d==="foreignObject"?0:l}function C_(l,d){return l==="textarea"||l==="noscript"||typeof d.children=="string"||typeof d.children=="number"||typeof d.children=="bigint"||typeof d.dangerouslySetInnerHTML=="object"&&d.dangerouslySetInnerHTML!==null&&d.dangerouslySetInnerHTML.__html!=null}var E_=null;function pD(){var l=window.event;return l&&l.type==="popstate"?l===E_?!1:(E_=l,!0):(E_=null,!1)}var _C=typeof setTimeout=="function"?setTimeout:void 0,mD=typeof clearTimeout=="function"?clearTimeout:void 0,AC=typeof Promise=="function"?Promise:void 0,gD=typeof queueMicrotask=="function"?queueMicrotask:typeof AC<"u"?function(l){return AC.resolve(null).then(l).catch(vD)}:_C;function vD(l){setTimeout(function(){throw l})}function M_(l,d){var p=d,v=0;do{var S=p.nextSibling;if(l.removeChild(p),S&&S.nodeType===8)if(p=S.data,p==="/$"){if(v===0){l.removeChild(S),Tf(d);return}v--}else p!=="$"&&p!=="$?"&&p!=="$!"||v++;p=S}while(p);Tf(d)}function w_(l){var d=l.firstChild;for(d&&d.nodeType===10&&(d=d.nextSibling);d;){var p=d;switch(d=d.nextSibling,p.nodeName){case"HTML":case"HEAD":case"BODY":w_(p),Sn(p);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(p.rel.toLowerCase()==="stylesheet")continue}l.removeChild(p)}}function _D(l,d,p,v){for(;l.nodeType===1;){var S=p;if(l.nodeName.toLowerCase()!==d.toLowerCase()){if(!v&&(l.nodeName!=="INPUT"||l.type!=="hidden"))break}else if(v){if(!l[zt])switch(d){case"meta":if(!l.hasAttribute("itemprop"))break;return l;case"link":if(E=l.getAttribute("rel"),E==="stylesheet"&&l.hasAttribute("data-precedence"))break;if(E!==S.rel||l.getAttribute("href")!==(S.href==null?null:S.href)||l.getAttribute("crossorigin")!==(S.crossOrigin==null?null:S.crossOrigin)||l.getAttribute("title")!==(S.title==null?null:S.title))break;return l;case"style":if(l.hasAttribute("data-precedence"))break;return l;case"script":if(E=l.getAttribute("src"),(E!==(S.src==null?null:S.src)||l.getAttribute("type")!==(S.type==null?null:S.type)||l.getAttribute("crossorigin")!==(S.crossOrigin==null?null:S.crossOrigin))&&E&&l.hasAttribute("async")&&!l.hasAttribute("itemprop"))break;return l;default:return l}}else if(d==="input"&&l.type==="hidden"){var E=S.name==null?null:""+S.name;if(S.type==="hidden"&&l.getAttribute("name")===E)return l}else return l;if(l=Sa(l.nextSibling),l===null)break}return null}function AD(l,d,p){if(d==="")return null;for(;l.nodeType!==3;)if((l.nodeType!==1||l.nodeName!=="INPUT"||l.type!=="hidden")&&!p||(l=Sa(l.nextSibling),l===null))return null;return l}function Sa(l){for(;l!=null;l=l.nextSibling){var d=l.nodeType;if(d===1||d===3)break;if(d===8){if(d=l.data,d==="$"||d==="$!"||d==="$?"||d==="F!"||d==="F")break;if(d==="/$")return null}}return l}function xC(l){l=l.previousSibling;for(var d=0;l;){if(l.nodeType===8){var p=l.data;if(p==="$"||p==="$!"||p==="$?"){if(d===0)return l;d--}else p==="/$"&&d++}l=l.previousSibling}return null}function yC(l,d,p){switch(d=dm(p),l){case"html":if(l=d.documentElement,!l)throw Error(n(452));return l;case"head":if(l=d.head,!l)throw Error(n(453));return l;case"body":if(l=d.body,!l)throw Error(n(454));return l;default:throw Error(n(451))}}var ra=new Map,bC=new Set;function fm(l){return typeof l.getRootNode=="function"?l.getRootNode():l.ownerDocument}var Vi=te.d;te.d={f:xD,r:yD,D:bD,C:SD,L:CD,m:ED,X:wD,S:MD,M:TD};function xD(){var l=Vi.f(),d=om();return l||d}function yD(l){var d=ht(l);d!==null&&d.tag===5&&d.type==="form"?q3(d):Vi.r(l)}var su=typeof document>"u"?null:document;function SC(l,d,p){var v=su;if(v&&typeof d=="string"&&d){var S=co(d);S='link[rel="'+l+'"][href="'+S+'"]',typeof p=="string"&&(S+='[crossorigin="'+p+'"]'),bC.has(S)||(bC.add(S),l={rel:l,crossOrigin:p,href:d},v.querySelector(S)===null&&(d=v.createElement("link"),Rr(d,"link",l),Ot(d),v.head.appendChild(d)))}}function bD(l){Vi.D(l),SC("dns-prefetch",l,null)}function SD(l,d){Vi.C(l,d),SC("preconnect",l,d)}function CD(l,d,p){Vi.L(l,d,p);var v=su;if(v&&l&&d){var S='link[rel="preload"][as="'+co(d)+'"]';d==="image"&&p&&p.imageSrcSet?(S+='[imagesrcset="'+co(p.imageSrcSet)+'"]',typeof p.imageSizes=="string"&&(S+='[imagesizes="'+co(p.imageSizes)+'"]')):S+='[href="'+co(l)+'"]';var E=S;switch(d){case"style":E=lu(l);break;case"script":E=cu(l)}ra.has(E)||(l=F({rel:"preload",href:d==="image"&&p&&p.imageSrcSet?void 0:l,as:d},p),ra.set(E,l),v.querySelector(S)!==null||d==="style"&&v.querySelector(yf(E))||d==="script"&&v.querySelector(bf(E))||(d=v.createElement("link"),Rr(d,"link",l),Ot(d),v.head.appendChild(d)))}}function ED(l,d){Vi.m(l,d);var p=su;if(p&&l){var v=d&&typeof d.as=="string"?d.as:"script",S='link[rel="modulepreload"][as="'+co(v)+'"][href="'+co(l)+'"]',E=S;switch(v){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":E=cu(l)}if(!ra.has(E)&&(l=F({rel:"modulepreload",href:l},d),ra.set(E,l),p.querySelector(S)===null)){switch(v){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(p.querySelector(bf(E)))return}v=p.createElement("link"),Rr(v,"link",l),Ot(v),p.head.appendChild(v)}}}function MD(l,d,p){Vi.S(l,d,p);var v=su;if(v&&l){var S=so(v).hoistableStyles,E=lu(l);d=d||"default";var H=S.get(E);if(!H){var ae={loading:0,preload:null};if(H=v.querySelector(yf(E)))ae.loading=5;else{l=F({rel:"stylesheet",href:l,"data-precedence":d},p),(p=ra.get(E))&&T_(l,p);var ge=H=v.createElement("link");Ot(ge),Rr(ge,"link",l),ge._p=new Promise(function(Se,Fe){ge.onload=Se,ge.onerror=Fe}),ge.addEventListener("load",function(){ae.loading|=1}),ge.addEventListener("error",function(){ae.loading|=2}),ae.loading|=4,hm(H,d,v)}H={type:"stylesheet",instance:H,count:1,state:ae},S.set(E,H)}}}function wD(l,d){Vi.X(l,d);var p=su;if(p&&l){var v=so(p).hoistableScripts,S=cu(l),E=v.get(S);E||(E=p.querySelector(bf(S)),E||(l=F({src:l,async:!0},d),(d=ra.get(S))&&R_(l,d),E=p.createElement("script"),Ot(E),Rr(E,"link",l),p.head.appendChild(E)),E={type:"script",instance:E,count:1,state:null},v.set(S,E))}}function TD(l,d){Vi.M(l,d);var p=su;if(p&&l){var v=so(p).hoistableScripts,S=cu(l),E=v.get(S);E||(E=p.querySelector(bf(S)),E||(l=F({src:l,async:!0,type:"module"},d),(d=ra.get(S))&&R_(l,d),E=p.createElement("script"),Ot(E),Rr(E,"link",l),p.head.appendChild(E)),E={type:"script",instance:E,count:1,state:null},v.set(S,E))}}function CC(l,d,p,v){var S=(S=Q.current)?fm(S):null;if(!S)throw Error(n(446));switch(l){case"meta":case"title":return null;case"style":return typeof p.precedence=="string"&&typeof p.href=="string"?(d=lu(p.href),p=so(S).hoistableStyles,v=p.get(d),v||(v={type:"style",instance:null,count:0,state:null},p.set(d,v)),v):{type:"void",instance:null,count:0,state:null};case"link":if(p.rel==="stylesheet"&&typeof p.href=="string"&&typeof p.precedence=="string"){l=lu(p.href);var E=so(S).hoistableStyles,H=E.get(l);if(H||(S=S.ownerDocument||S,H={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},E.set(l,H),(E=S.querySelector(yf(l)))&&!E._p&&(H.instance=E,H.state.loading=5),ra.has(l)||(p={rel:"preload",as:"style",href:p.href,crossOrigin:p.crossOrigin,integrity:p.integrity,media:p.media,hrefLang:p.hrefLang,referrerPolicy:p.referrerPolicy},ra.set(l,p),E||RD(S,l,p,H.state))),d&&v===null)throw Error(n(528,""));return H}if(d&&v!==null)throw Error(n(529,""));return null;case"script":return d=p.async,p=p.src,typeof p=="string"&&d&&typeof d!="function"&&typeof d!="symbol"?(d=cu(p),p=so(S).hoistableScripts,v=p.get(d),v||(v={type:"script",instance:null,count:0,state:null},p.set(d,v)),v):{type:"void",instance:null,count:0,state:null};default:throw Error(n(444,l))}}function lu(l){return'href="'+co(l)+'"'}function yf(l){return'link[rel="stylesheet"]['+l+"]"}function EC(l){return F({},l,{"data-precedence":l.precedence,precedence:null})}function RD(l,d,p,v){l.querySelector('link[rel="preload"][as="style"]['+d+"]")?v.loading=1:(d=l.createElement("link"),v.preload=d,d.addEventListener("load",function(){return v.loading|=1}),d.addEventListener("error",function(){return v.loading|=2}),Rr(d,"link",p),Ot(d),l.head.appendChild(d))}function cu(l){return'[src="'+co(l)+'"]'}function bf(l){return"script[async]"+l}function MC(l,d,p){if(d.count++,d.instance===null)switch(d.type){case"style":var v=l.querySelector('style[data-href~="'+co(p.href)+'"]');if(v)return d.instance=v,Ot(v),v;var S=F({},p,{"data-href":p.href,"data-precedence":p.precedence,href:null,precedence:null});return v=(l.ownerDocument||l).createElement("style"),Ot(v),Rr(v,"style",S),hm(v,p.precedence,l),d.instance=v;case"stylesheet":S=lu(p.href);var E=l.querySelector(yf(S));if(E)return d.state.loading|=4,d.instance=E,Ot(E),E;v=EC(p),(S=ra.get(S))&&T_(v,S),E=(l.ownerDocument||l).createElement("link"),Ot(E);var H=E;return H._p=new Promise(function(ae,ge){H.onload=ae,H.onerror=ge}),Rr(E,"link",v),d.state.loading|=4,hm(E,p.precedence,l),d.instance=E;case"script":return E=cu(p.src),(S=l.querySelector(bf(E)))?(d.instance=S,Ot(S),S):(v=p,(S=ra.get(E))&&(v=F({},p),R_(v,S)),l=l.ownerDocument||l,S=l.createElement("script"),Ot(S),Rr(S,"link",v),l.head.appendChild(S),d.instance=S);case"void":return null;default:throw Error(n(443,d.type))}else d.type==="stylesheet"&&(d.state.loading&4)===0&&(v=d.instance,d.state.loading|=4,hm(v,p.precedence,l));return d.instance}function hm(l,d,p){for(var v=p.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),S=v.length?v[v.length-1]:null,E=S,H=0;H<v.length;H++){var ae=v[H];if(ae.dataset.precedence===d)E=ae;else if(E!==S)break}E?E.parentNode.insertBefore(l,E.nextSibling):(d=p.nodeType===9?p.head:p,d.insertBefore(l,d.firstChild))}function T_(l,d){l.crossOrigin==null&&(l.crossOrigin=d.crossOrigin),l.referrerPolicy==null&&(l.referrerPolicy=d.referrerPolicy),l.title==null&&(l.title=d.title)}function R_(l,d){l.crossOrigin==null&&(l.crossOrigin=d.crossOrigin),l.referrerPolicy==null&&(l.referrerPolicy=d.referrerPolicy),l.integrity==null&&(l.integrity=d.integrity)}var pm=null;function wC(l,d,p){if(pm===null){var v=new Map,S=pm=new Map;S.set(p,v)}else S=pm,v=S.get(p),v||(v=new Map,S.set(p,v));if(v.has(l))return v;for(v.set(l,null),p=p.getElementsByTagName(l),S=0;S<p.length;S++){var E=p[S];if(!(E[zt]||E[Ue]||l==="link"&&E.getAttribute("rel")==="stylesheet")&&E.namespaceURI!=="http://www.w3.org/2000/svg"){var H=E.getAttribute(d)||"";H=l+H;var ae=v.get(H);ae?ae.push(E):v.set(H,[E])}}return v}function TC(l,d,p){l=l.ownerDocument||l,l.head.insertBefore(p,d==="title"?l.querySelector("head > title"):null)}function ID(l,d,p){if(p===1||d.itemProp!=null)return!1;switch(l){case"meta":case"title":return!0;case"style":if(typeof d.precedence!="string"||typeof d.href!="string"||d.href==="")break;return!0;case"link":if(typeof d.rel!="string"||typeof d.href!="string"||d.href===""||d.onLoad||d.onError)break;switch(d.rel){case"stylesheet":return l=d.disabled,typeof d.precedence=="string"&&l==null;default:return!0}case"script":if(d.async&&typeof d.async!="function"&&typeof d.async!="symbol"&&!d.onLoad&&!d.onError&&d.src&&typeof d.src=="string")return!0}return!1}function RC(l){return!(l.type==="stylesheet"&&(l.state.loading&3)===0)}var Sf=null;function LD(){}function BD(l,d,p){if(Sf===null)throw Error(n(475));var v=Sf;if(d.type==="stylesheet"&&(typeof p.media!="string"||matchMedia(p.media).matches!==!1)&&(d.state.loading&4)===0){if(d.instance===null){var S=lu(p.href),E=l.querySelector(yf(S));if(E){l=E._p,l!==null&&typeof l=="object"&&typeof l.then=="function"&&(v.count++,v=mm.bind(v),l.then(v,v)),d.state.loading|=4,d.instance=E,Ot(E);return}E=l.ownerDocument||l,p=EC(p),(S=ra.get(S))&&T_(p,S),E=E.createElement("link"),Ot(E);var H=E;H._p=new Promise(function(ae,ge){H.onload=ae,H.onerror=ge}),Rr(E,"link",p),d.instance=E}v.stylesheets===null&&(v.stylesheets=new Map),v.stylesheets.set(d,l),(l=d.state.preload)&&(d.state.loading&3)===0&&(v.count++,d=mm.bind(v),l.addEventListener("load",d),l.addEventListener("error",d))}}function PD(){if(Sf===null)throw Error(n(475));var l=Sf;return l.stylesheets&&l.count===0&&I_(l,l.stylesheets),0<l.count?function(d){var p=setTimeout(function(){if(l.stylesheets&&I_(l,l.stylesheets),l.unsuspend){var v=l.unsuspend;l.unsuspend=null,v()}},6e4);return l.unsuspend=d,function(){l.unsuspend=null,clearTimeout(p)}}:null}function mm(){if(this.count--,this.count===0){if(this.stylesheets)I_(this,this.stylesheets);else if(this.unsuspend){var l=this.unsuspend;this.unsuspend=null,l()}}}var gm=null;function I_(l,d){l.stylesheets=null,l.unsuspend!==null&&(l.count++,gm=new Map,d.forEach(ND,l),gm=null,mm.call(l))}function ND(l,d){if(!(d.state.loading&4)){var p=gm.get(l);if(p)var v=p.get(null);else{p=new Map,gm.set(l,p);for(var S=l.querySelectorAll("link[data-precedence],style[data-precedence]"),E=0;E<S.length;E++){var H=S[E];(H.nodeName==="LINK"||H.getAttribute("media")!=="not all")&&(p.set(H.dataset.precedence,H),v=H)}v&&p.set(null,v)}S=d.instance,H=S.getAttribute("data-precedence"),E=p.get(H)||v,E===v&&p.set(null,S),p.set(H,S),this.count++,v=mm.bind(this),S.addEventListener("load",v),S.addEventListener("error",v),E?E.parentNode.insertBefore(S,E.nextSibling):(l=l.nodeType===9?l.head:l,l.insertBefore(S,l.firstChild)),d.state.loading|=4}}var Cf={$$typeof:g,Provider:null,Consumer:null,_currentValue:le,_currentValue2:le,_threadCount:0};function DD(l,d,p,v,S,E,H,ae){this.tag=1,this.containerInfo=l,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=Co(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.finishedLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Co(0),this.hiddenUpdates=Co(null),this.identifierPrefix=v,this.onUncaughtError=S,this.onCaughtError=E,this.onRecoverableError=H,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=ae,this.incompleteTransitions=new Map}function IC(l,d,p,v,S,E,H,ae,ge,Se,Fe,ke){return l=new DD(l,d,p,H,ae,ge,Se,ke),d=1,E===!0&&(d|=24),E=ta(3,null,null,d),l.current=E,E.stateNode=l,d=l1(),d.refCount++,l.pooledCache=d,d.refCount++,E.memoizedState={element:v,isDehydrated:p,cache:d},G1(E),l}function LC(l){return l?(l=kc,l):kc}function BC(l,d,p,v,S,E){S=LC(S),v.context===null?v.context=S:v.pendingContext=S,v=Cs(d),v.payload={element:p},E=E===void 0?null:E,E!==null&&(v.callback=E),p=Es(l,v,d),p!==null&&(qr(p,l,d),sf(p,l,d))}function PC(l,d){if(l=l.memoizedState,l!==null&&l.dehydrated!==null){var p=l.retryLane;l.retryLane=p!==0&&p<d?p:d}}function L_(l,d){PC(l,d),(l=l.alternate)&&PC(l,d)}function NC(l){if(l.tag===13){var d=vs(l,67108864);d!==null&&qr(d,l,67108864),L_(l,67108864)}}var vm=!0;function OD(l,d,p,v){var S=z.T;z.T=null;var E=te.p;try{te.p=2,B_(l,d,p,v)}finally{te.p=E,z.T=S}}function FD(l,d,p,v){var S=z.T;z.T=null;var E=te.p;try{te.p=8,B_(l,d,p,v)}finally{te.p=E,z.T=S}}function B_(l,d,p,v){if(vm){var S=P_(v);if(S===null)x_(l,d,v,_m,p),OC(l,v);else if(zD(S,l,d,p,v))v.stopPropagation();else if(OC(l,v),d&4&&-1<UD.indexOf(l)){for(;S!==null;){var E=ht(S);if(E!==null)switch(E.tag){case 3:if(E=E.stateNode,E.current.memoizedState.isDehydrated){var H=Xn(E.pendingLanes);if(H!==0){var ae=E;for(ae.pendingLanes|=2,ae.entangledLanes|=2;H;){var ge=1<<31-dn(H);ae.entanglements[1]|=ge,H&=~ge}$a(E),(Dn&6)===0&&(tm=pe()+500,_f(0))}}break;case 13:ae=vs(E,2),ae!==null&&qr(ae,E,2),om(),L_(E,2)}if(E=P_(v),E===null&&x_(l,d,v,_m,p),E===S)break;S=E}S!==null&&v.stopPropagation()}else x_(l,d,v,null,p)}}function P_(l){return l=En(l),N_(l)}var _m=null;function N_(l){if(_m=null,l=Dt(l),l!==null){var d=ie(l);if(d===null)l=null;else{var p=d.tag;if(p===13){if(l=L(d),l!==null)return l;l=null}else if(p===3){if(d.stateNode.current.memoizedState.isDehydrated)return d.tag===3?d.stateNode.containerInfo:null;l=null}else d!==l&&(l=null)}}return _m=l,null}function DC(l){switch(l){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(Ce()){case we:return 2;case be:return 8;case Pe:case Ge:return 32;case tt:return 268435456;default:return 32}default:return 32}}var D_=!1,Bs=null,Ps=null,Ns=null,Ef=new Map,Mf=new Map,Ds=[],UD="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function OC(l,d){switch(l){case"focusin":case"focusout":Bs=null;break;case"dragenter":case"dragleave":Ps=null;break;case"mouseover":case"mouseout":Ns=null;break;case"pointerover":case"pointerout":Ef.delete(d.pointerId);break;case"gotpointercapture":case"lostpointercapture":Mf.delete(d.pointerId)}}function wf(l,d,p,v,S,E){return l===null||l.nativeEvent!==E?(l={blockedOn:d,domEventName:p,eventSystemFlags:v,nativeEvent:E,targetContainers:[S]},d!==null&&(d=ht(d),d!==null&&NC(d)),l):(l.eventSystemFlags|=v,d=l.targetContainers,S!==null&&d.indexOf(S)===-1&&d.push(S),l)}function zD(l,d,p,v,S){switch(d){case"focusin":return Bs=wf(Bs,l,d,p,v,S),!0;case"dragenter":return Ps=wf(Ps,l,d,p,v,S),!0;case"mouseover":return Ns=wf(Ns,l,d,p,v,S),!0;case"pointerover":var E=S.pointerId;return Ef.set(E,wf(Ef.get(E)||null,l,d,p,v,S)),!0;case"gotpointercapture":return E=S.pointerId,Mf.set(E,wf(Mf.get(E)||null,l,d,p,v,S)),!0}return!1}function FC(l){var d=Dt(l.target);if(d!==null){var p=ie(d);if(p!==null){if(d=p.tag,d===13){if(d=L(p),d!==null){l.blockedOn=d,Te(l.priority,function(){if(p.tag===13){var v=Bo(),S=vs(p,v);S!==null&&qr(S,p,v),L_(p,v)}});return}}else if(d===3&&p.stateNode.current.memoizedState.isDehydrated){l.blockedOn=p.tag===3?p.stateNode.containerInfo:null;return}}}l.blockedOn=null}function Am(l){if(l.blockedOn!==null)return!1;for(var d=l.targetContainers;0<d.length;){var p=P_(l.nativeEvent);if(p===null){p=l.nativeEvent;var v=new p.constructor(p.type,p);Jt=v,p.target.dispatchEvent(v),Jt=null}else return d=ht(p),d!==null&&NC(d),l.blockedOn=p,!1;d.shift()}return!0}function UC(l,d,p){Am(l)&&p.delete(d)}function VD(){D_=!1,Bs!==null&&Am(Bs)&&(Bs=null),Ps!==null&&Am(Ps)&&(Ps=null),Ns!==null&&Am(Ns)&&(Ns=null),Ef.forEach(UC),Mf.forEach(UC)}function xm(l,d){l.blockedOn===d&&(l.blockedOn=null,D_||(D_=!0,o.unstable_scheduleCallback(o.unstable_NormalPriority,VD)))}var ym=null;function zC(l){ym!==l&&(ym=l,o.unstable_scheduleCallback(o.unstable_NormalPriority,function(){ym===l&&(ym=null);for(var d=0;d<l.length;d+=3){var p=l[d],v=l[d+1],S=l[d+2];if(typeof v!="function"){if(N_(v||p)===null)continue;break}var E=ht(p);E!==null&&(l.splice(d,3),d-=3,C1(E,{pending:!0,data:S,method:p.method,action:v},v,S))}}))}function Tf(l){function d(ge){return xm(ge,l)}Bs!==null&&xm(Bs,l),Ps!==null&&xm(Ps,l),Ns!==null&&xm(Ns,l),Ef.forEach(d),Mf.forEach(d);for(var p=0;p<Ds.length;p++){var v=Ds[p];v.blockedOn===l&&(v.blockedOn=null)}for(;0<Ds.length&&(p=Ds[0],p.blockedOn===null);)FC(p),p.blockedOn===null&&Ds.shift();if(p=(l.ownerDocument||l).$$reactFormReplay,p!=null)for(v=0;v<p.length;v+=3){var S=p[v],E=p[v+1],H=S[Ne]||null;if(typeof E=="function")H||zC(p);else if(H){var ae=null;if(E&&E.hasAttribute("formAction")){if(S=E,H=E[Ne]||null)ae=H.formAction;else if(N_(S)!==null)continue}else ae=H.action;typeof ae=="function"?p[v+1]=ae:(p.splice(v,3),v-=3),zC(p)}}}function O_(l){this._internalRoot=l}bm.prototype.render=O_.prototype.render=function(l){var d=this._internalRoot;if(d===null)throw Error(n(409));var p=d.current,v=Bo();BC(p,v,l,d,null,null)},bm.prototype.unmount=O_.prototype.unmount=function(){var l=this._internalRoot;if(l!==null){this._internalRoot=null;var d=l.containerInfo;l.tag===0&&ou(),BC(l.current,2,null,l,null,null),om(),d[We]=null}};function bm(l){this._internalRoot=l}bm.prototype.unstable_scheduleHydration=function(l){if(l){var d=Z();l={blockedOn:null,target:l,priority:d};for(var p=0;p<Ds.length&&d!==0&&d<Ds[p].priority;p++);Ds.splice(p,0,l),p===0&&FC(l)}};var VC=e.version;if(VC!=="19.0.0")throw Error(n(527,VC,"19.0.0"));te.findDOMNode=function(l){var d=l._reactInternals;if(d===void 0)throw typeof l.render=="function"?Error(n(188)):(l=Object.keys(l).join(","),Error(n(268,l)));return l=k(d),l=l!==null?J(l):null,l=l===null?null:l.stateNode,l};var kD={bundleType:0,version:"19.0.0",rendererPackageName:"react-dom",currentDispatcherRef:z,findFiberByHostInstance:Dt,reconcilerVersion:"19.0.0"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Sm=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Sm.isDisabled&&Sm.supportsFiber)try{$t=Sm.inject(kD),St=Sm}catch{}}return If.createRoot=function(l,d){if(!r(l))throw Error(n(299));var p=!1,v="",S=rS,E=oS,H=aS,ae=null;return d!=null&&(d.unstable_strictMode===!0&&(p=!0),d.identifierPrefix!==void 0&&(v=d.identifierPrefix),d.onUncaughtError!==void 0&&(S=d.onUncaughtError),d.onCaughtError!==void 0&&(E=d.onCaughtError),d.onRecoverableError!==void 0&&(H=d.onRecoverableError),d.unstable_transitionCallbacks!==void 0&&(ae=d.unstable_transitionCallbacks)),d=IC(l,1,!1,null,null,p,v,S,E,H,ae,null),l[We]=d.current,A_(l.nodeType===8?l.parentNode:l),new O_(d)},If.hydrateRoot=function(l,d,p){if(!r(l))throw Error(n(299));var v=!1,S="",E=rS,H=oS,ae=aS,ge=null,Se=null;return p!=null&&(p.unstable_strictMode===!0&&(v=!0),p.identifierPrefix!==void 0&&(S=p.identifierPrefix),p.onUncaughtError!==void 0&&(E=p.onUncaughtError),p.onCaughtError!==void 0&&(H=p.onCaughtError),p.onRecoverableError!==void 0&&(ae=p.onRecoverableError),p.unstable_transitionCallbacks!==void 0&&(ge=p.unstable_transitionCallbacks),p.formState!==void 0&&(Se=p.formState)),d=IC(l,1,!0,d,p??null,v,S,E,H,ae,ge,Se),d.context=LC(null),p=d.current,v=Bo(),S=Cs(v),S.callback=null,Es(p,S,v),d.current.lanes=v,Si(d,v),$a(d),l[We]=d.current,A_(l),new bm(d)},If.version="19.0.0",If}var ZC;function JD(){if(ZC)return z_.exports;ZC=1;function o(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(o)}catch(e){console.error(e)}}return o(),z_.exports=$D(),z_.exports}var eO=JD();function Or(o,e,{checkForDefaultPrevented:t=!0}={}){return function(r){if(o==null||o(r),t===!1||!r.defaultPrevented)return e==null?void 0:e(r)}}function np(o,e=[]){let t=[];function n(a,i){const s=j.createContext(i),c=t.length;t=[...t,i];const u=f=>{var C;const{scope:m,children:g,...A}=f,_=((C=m==null?void 0:m[o])==null?void 0:C[c])||s,x=j.useMemo(()=>A,Object.values(A));return ue.jsx(_.Provider,{value:x,children:g})};u.displayName=a+"Provider";function h(f,m){var _;const g=((_=m==null?void 0:m[o])==null?void 0:_[c])||s,A=j.useContext(g);if(A)return A;if(i!==void 0)return i;throw new Error(`\`${f}\` must be used within \`${a}\``)}return[u,h]}const r=()=>{const a=t.map(i=>j.createContext(i));return function(s){const c=(s==null?void 0:s[o])||a;return j.useMemo(()=>({[`__scope${o}`]:{...s,[o]:c}}),[s,c])}};return r.scopeName=o,[n,tO(r,...e)]}function tO(...o){const e=o[0];if(o.length===1)return e;const t=()=>{const n=o.map(r=>({useScope:r(),scopeName:r.scopeName}));return function(a){const i=n.reduce((s,{useScope:c,scopeName:u})=>{const f=c(a)[`__scope${u}`];return{...s,...f}},{});return j.useMemo(()=>({[`__scope${e.scopeName}`]:i}),[i])}};return t.scopeName=e.scopeName,t}function KC(o,e){if(typeof o=="function")return o(e);o!=null&&(o.current=e)}function dR(...o){return e=>{let t=!1;const n=o.map(r=>{const a=KC(r,e);return!t&&typeof a=="function"&&(t=!0),a});if(t)return()=>{for(let r=0;r<n.length;r++){const a=n[r];typeof a=="function"?a():KC(o[r],null)}}}}function Fa(...o){return j.useCallback(dR(...o),o)}var cd=j.forwardRef((o,e)=>{const{children:t,...n}=o,r=j.Children.toArray(t),a=r.find(nO);if(a){const i=a.props.children,s=r.map(c=>c===a?j.Children.count(i)>1?j.Children.only(null):j.isValidElement(i)?i.props.children:null:c);return ue.jsx(kx,{...n,ref:e,children:j.isValidElement(i)?j.cloneElement(i,void 0,s):null})}return ue.jsx(kx,{...n,ref:e,children:t})});cd.displayName="Slot";var kx=j.forwardRef((o,e)=>{const{children:t,...n}=o;if(j.isValidElement(t)){const r=oO(t),a=rO(n,t.props);return t.type!==j.Fragment&&(a.ref=e?dR(e,r):r),j.cloneElement(t,a)}return j.Children.count(t)>1?j.Children.only(null):null});kx.displayName="SlotClone";var fR=({children:o})=>ue.jsx(ue.Fragment,{children:o});function nO(o){return j.isValidElement(o)&&o.type===fR}function rO(o,e){const t={...e};for(const n in e){const r=o[n],a=e[n];/^on[A-Z]/.test(n)?r&&a?t[n]=(...s)=>{a(...s),r(...s)}:r&&(t[n]=r):n==="style"?t[n]={...r,...a}:n==="className"&&(t[n]=[r,a].filter(Boolean).join(" "))}return{...o,...t}}function oO(o){var n,r;let e=(n=Object.getOwnPropertyDescriptor(o.props,"ref"))==null?void 0:n.get,t=e&&"isReactWarning"in e&&e.isReactWarning;return t?o.ref:(e=(r=Object.getOwnPropertyDescriptor(o,"ref"))==null?void 0:r.get,t=e&&"isReactWarning"in e&&e.isReactWarning,t?o.props.ref:o.props.ref||o.ref)}function aO(o){const e=o+"CollectionProvider",[t,n]=np(e),[r,a]=t(e,{collectionRef:{current:null},itemMap:new Map}),i=g=>{const{scope:A,children:_}=g,x=nt.useRef(null),C=nt.useRef(new Map).current;return ue.jsx(r,{scope:A,itemMap:C,collectionRef:x,children:_})};i.displayName=e;const s=o+"CollectionSlot",c=nt.forwardRef((g,A)=>{const{scope:_,children:x}=g,C=a(s,_),b=Fa(A,C.collectionRef);return ue.jsx(cd,{ref:b,children:x})});c.displayName=s;const u=o+"CollectionItemSlot",h="data-radix-collection-item",f=nt.forwardRef((g,A)=>{const{scope:_,children:x,...C}=g,b=nt.useRef(null),y=Fa(A,b),M=a(u,_);return nt.useEffect(()=>(M.itemMap.set(b,{ref:b,...C}),()=>void M.itemMap.delete(b))),ue.jsx(cd,{[h]:"",ref:y,children:x})});f.displayName=u;function m(g){const A=a(o+"CollectionConsumer",g);return nt.useCallback(()=>{const x=A.collectionRef.current;if(!x)return[];const C=Array.from(x.querySelectorAll(`[${h}]`));return Array.from(A.itemMap.values()).sort((M,R)=>C.indexOf(M.ref.current)-C.indexOf(R.ref.current))},[A.collectionRef,A.itemMap])}return[{Provider:i,Slot:c,ItemSlot:f},m,n]}var Cc=globalThis!=null&&globalThis.document?j.useLayoutEffect:()=>{},iO=ry.useId||(()=>{}),sO=0;function oy(o){const[e,t]=j.useState(iO());return Cc(()=>{t(n=>n??String(sO++))},[o]),o||(e?`radix-${e}`:"")}var bd=uR();const hR=cR(bd);var lO=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","span","svg","ul"],Yr=lO.reduce((o,e)=>{const t=j.forwardRef((n,r)=>{const{asChild:a,...i}=n,s=a?cd:e;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),ue.jsx(s,{...i,ref:r})});return t.displayName=`Primitive.${e}`,{...o,[e]:t}},{});function cO(o,e){o&&bd.flushSync(()=>o.dispatchEvent(e))}function us(o){const e=j.useRef(o);return j.useEffect(()=>{e.current=o}),j.useMemo(()=>(...t)=>{var n;return(n=e.current)==null?void 0:n.call(e,...t)},[])}function ay({prop:o,defaultProp:e,onChange:t=()=>{}}){const[n,r]=uO({defaultProp:e,onChange:t}),a=o!==void 0,i=a?o:n,s=us(t),c=j.useCallback(u=>{if(a){const f=typeof u=="function"?u(o):u;f!==o&&s(f)}else r(u)},[a,o,r,s]);return[i,c]}function uO({defaultProp:o,onChange:e}){const t=j.useState(o),[n]=t,r=j.useRef(n),a=us(e);return j.useEffect(()=>{r.current!==n&&(a(n),r.current=n)},[n,r,a]),t}var dO=j.createContext(void 0);function pR(o){const e=j.useContext(dO);return o||e||"ltr"}var Q_="rovingFocusGroup.onEntryFocus",fO={bubbles:!1,cancelable:!0},tv="RovingFocusGroup",[Gx,mR,hO]=aO(tv),[pO,gR]=np(tv,[hO]),[mO,gO]=pO(tv),vR=j.forwardRef((o,e)=>ue.jsx(Gx.Provider,{scope:o.__scopeRovingFocusGroup,children:ue.jsx(Gx.Slot,{scope:o.__scopeRovingFocusGroup,children:ue.jsx(vO,{...o,ref:e})})}));vR.displayName=tv;var vO=j.forwardRef((o,e)=>{const{__scopeRovingFocusGroup:t,orientation:n,loop:r=!1,dir:a,currentTabStopId:i,defaultCurrentTabStopId:s,onCurrentTabStopIdChange:c,onEntryFocus:u,preventScrollOnEntryFocus:h=!1,...f}=o,m=j.useRef(null),g=Fa(e,m),A=pR(a),[_=null,x]=ay({prop:i,defaultProp:s,onChange:c}),[C,b]=j.useState(!1),y=us(u),M=mR(t),R=j.useRef(!1),[T,w]=j.useState(0);return j.useEffect(()=>{const D=m.current;if(D)return D.addEventListener(Q_,y),()=>D.removeEventListener(Q_,y)},[y]),ue.jsx(mO,{scope:t,orientation:n,dir:A,loop:r,currentTabStopId:_,onItemFocus:j.useCallback(D=>x(D),[x]),onItemShiftTab:j.useCallback(()=>b(!0),[]),onFocusableItemAdd:j.useCallback(()=>w(D=>D+1),[]),onFocusableItemRemove:j.useCallback(()=>w(D=>D-1),[]),children:ue.jsx(Yr.div,{tabIndex:C||T===0?-1:0,"data-orientation":n,...f,ref:g,style:{outline:"none",...o.style},onMouseDown:Or(o.onMouseDown,()=>{R.current=!0}),onFocus:Or(o.onFocus,D=>{const z=!R.current;if(D.target===D.currentTarget&&z&&!C){const F=new CustomEvent(Q_,fO);if(D.currentTarget.dispatchEvent(F),!F.defaultPrevented){const O=M().filter(K=>K.focusable),q=O.find(K=>K.active),ne=O.find(K=>K.id===_),he=[q,ne,...O].filter(Boolean).map(K=>K.ref.current);xR(he,h)}}R.current=!1}),onBlur:Or(o.onBlur,()=>b(!1))})})}),_R="RovingFocusGroupItem",AR=j.forwardRef((o,e)=>{const{__scopeRovingFocusGroup:t,focusable:n=!0,active:r=!1,tabStopId:a,...i}=o,s=oy(),c=a||s,u=gO(_R,t),h=u.currentTabStopId===c,f=mR(t),{onFocusableItemAdd:m,onFocusableItemRemove:g}=u;return j.useEffect(()=>{if(n)return m(),()=>g()},[n,m,g]),ue.jsx(Gx.ItemSlot,{scope:t,id:c,focusable:n,active:r,children:ue.jsx(Yr.span,{tabIndex:h?0:-1,"data-orientation":u.orientation,...i,ref:e,onMouseDown:Or(o.onMouseDown,A=>{n?u.onItemFocus(c):A.preventDefault()}),onFocus:Or(o.onFocus,()=>u.onItemFocus(c)),onKeyDown:Or(o.onKeyDown,A=>{if(A.key==="Tab"&&A.shiftKey){u.onItemShiftTab();return}if(A.target!==A.currentTarget)return;const _=xO(A,u.orientation,u.dir);if(_!==void 0){if(A.metaKey||A.ctrlKey||A.altKey||A.shiftKey)return;A.preventDefault();let C=f().filter(b=>b.focusable).map(b=>b.ref.current);if(_==="last")C.reverse();else if(_==="prev"||_==="next"){_==="prev"&&C.reverse();const b=C.indexOf(A.currentTarget);C=u.loop?yO(C,b+1):C.slice(b+1)}setTimeout(()=>xR(C))}})})})});AR.displayName=_R;var _O={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function AO(o,e){return e!=="rtl"?o:o==="ArrowLeft"?"ArrowRight":o==="ArrowRight"?"ArrowLeft":o}function xO(o,e,t){const n=AO(o.key,t);if(!(e==="vertical"&&["ArrowLeft","ArrowRight"].includes(n))&&!(e==="horizontal"&&["ArrowUp","ArrowDown"].includes(n)))return _O[n]}function xR(o,e=!1){const t=document.activeElement;for(const n of o)if(n===t||(n.focus({preventScroll:e}),document.activeElement!==t))return}function yO(o,e){return o.map((t,n)=>o[(e+n)%o.length])}var bO=vR,SO=AR;function CO(o,e){return j.useReducer((t,n)=>e[t][n]??t,o)}var nv=o=>{const{present:e,children:t}=o,n=EO(e),r=typeof t=="function"?t({present:n.isPresent}):j.Children.only(t),a=Fa(n.ref,MO(r));return typeof t=="function"||n.isPresent?j.cloneElement(r,{ref:a}):null};nv.displayName="Presence";function EO(o){const[e,t]=j.useState(),n=j.useRef({}),r=j.useRef(o),a=j.useRef("none"),i=o?"mounted":"unmounted",[s,c]=CO(i,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return j.useEffect(()=>{const u=Cm(n.current);a.current=s==="mounted"?u:"none"},[s]),Cc(()=>{const u=n.current,h=r.current;if(h!==o){const m=a.current,g=Cm(u);o?c("MOUNT"):g==="none"||(u==null?void 0:u.display)==="none"?c("UNMOUNT"):c(h&&m!==g?"ANIMATION_OUT":"UNMOUNT"),r.current=o}},[o,c]),Cc(()=>{if(e){let u;const h=e.ownerDocument.defaultView??window,f=g=>{const _=Cm(n.current).includes(g.animationName);if(g.target===e&&_&&(c("ANIMATION_END"),!r.current)){const x=e.style.animationFillMode;e.style.animationFillMode="forwards",u=h.setTimeout(()=>{e.style.animationFillMode==="forwards"&&(e.style.animationFillMode=x)})}},m=g=>{g.target===e&&(a.current=Cm(n.current))};return e.addEventListener("animationstart",m),e.addEventListener("animationcancel",f),e.addEventListener("animationend",f),()=>{h.clearTimeout(u),e.removeEventListener("animationstart",m),e.removeEventListener("animationcancel",f),e.removeEventListener("animationend",f)}}else c("ANIMATION_END")},[e,c]),{isPresent:["mounted","unmountSuspended"].includes(s),ref:j.useCallback(u=>{u&&(n.current=getComputedStyle(u)),t(u)},[])}}function Cm(o){return(o==null?void 0:o.animationName)||"none"}function MO(o){var n,r;let e=(n=Object.getOwnPropertyDescriptor(o.props,"ref"))==null?void 0:n.get,t=e&&"isReactWarning"in e&&e.isReactWarning;return t?o.ref:(e=(r=Object.getOwnPropertyDescriptor(o,"ref"))==null?void 0:r.get,t=e&&"isReactWarning"in e&&e.isReactWarning,t?o.props.ref:o.props.ref||o.ref)}var iy="Tabs",[wO,Vie]=np(iy,[gR]),yR=gR(),[TO,sy]=wO(iy),bR=j.forwardRef((o,e)=>{const{__scopeTabs:t,value:n,onValueChange:r,defaultValue:a,orientation:i="horizontal",dir:s,activationMode:c="automatic",...u}=o,h=pR(s),[f,m]=ay({prop:n,onChange:r,defaultProp:a});return ue.jsx(TO,{scope:t,baseId:oy(),value:f,onValueChange:m,orientation:i,dir:h,activationMode:c,children:ue.jsx(Yr.div,{dir:h,"data-orientation":i,...u,ref:e})})});bR.displayName=iy;var SR="TabsList",CR=j.forwardRef((o,e)=>{const{__scopeTabs:t,loop:n=!0,...r}=o,a=sy(SR,t),i=yR(t);return ue.jsx(bO,{asChild:!0,...i,orientation:a.orientation,dir:a.dir,loop:n,children:ue.jsx(Yr.div,{role:"tablist","aria-orientation":a.orientation,...r,ref:e})})});CR.displayName=SR;var ER="TabsTrigger",MR=j.forwardRef((o,e)=>{const{__scopeTabs:t,value:n,disabled:r=!1,...a}=o,i=sy(ER,t),s=yR(t),c=RR(i.baseId,n),u=IR(i.baseId,n),h=n===i.value;return ue.jsx(SO,{asChild:!0,...s,focusable:!r,active:h,children:ue.jsx(Yr.button,{type:"button",role:"tab","aria-selected":h,"aria-controls":u,"data-state":h?"active":"inactive","data-disabled":r?"":void 0,disabled:r,id:c,...a,ref:e,onMouseDown:Or(o.onMouseDown,f=>{!r&&f.button===0&&f.ctrlKey===!1?i.onValueChange(n):f.preventDefault()}),onKeyDown:Or(o.onKeyDown,f=>{[" ","Enter"].includes(f.key)&&i.onValueChange(n)}),onFocus:Or(o.onFocus,()=>{const f=i.activationMode!=="manual";!h&&!r&&f&&i.onValueChange(n)})})})});MR.displayName=ER;var wR="TabsContent",TR=j.forwardRef((o,e)=>{const{__scopeTabs:t,value:n,forceMount:r,children:a,...i}=o,s=sy(wR,t),c=RR(s.baseId,n),u=IR(s.baseId,n),h=n===s.value,f=j.useRef(h);return j.useEffect(()=>{const m=requestAnimationFrame(()=>f.current=!1);return()=>cancelAnimationFrame(m)},[]),ue.jsx(nv,{present:r||h,children:({present:m})=>ue.jsx(Yr.div,{"data-state":h?"active":"inactive","data-orientation":s.orientation,role:"tabpanel","aria-labelledby":c,hidden:!m,id:u,tabIndex:0,...i,ref:e,style:{...o.style,animationDuration:f.current?"0s":void 0},children:m&&a})})});TR.displayName=wR;function RR(o,e){return`${o}-trigger-${e}`}function IR(o,e){return`${o}-content-${e}`}var RO=bR,IO=CR,LO=MR,BO=TR;function LR(o){var e,t,n="";if(typeof o=="string"||typeof o=="number")n+=o;else if(typeof o=="object")if(Array.isArray(o)){var r=o.length;for(e=0;e<r;e++)o[e]&&(t=LR(o[e]))&&(n&&(n+=" "),n+=t)}else for(t in o)o[t]&&(n&&(n+=" "),n+=t);return n}function BR(){for(var o,e,t=0,n="",r=arguments.length;t<r;t++)(o=arguments[t])&&(e=LR(o))&&(n&&(n+=" "),n+=e);return n}const ly="-",PO=o=>{const e=DO(o),{conflictingClassGroups:t,conflictingClassGroupModifiers:n}=o;return{getClassGroupId:i=>{const s=i.split(ly);return s[0]===""&&s.length!==1&&s.shift(),PR(s,e)||NO(i)},getConflictingClassGroupIds:(i,s)=>{const c=t[i]||[];return s&&n[i]?[...c,...n[i]]:c}}},PR=(o,e)=>{var i;if(o.length===0)return e.classGroupId;const t=o[0],n=e.nextPart.get(t),r=n?PR(o.slice(1),n):void 0;if(r)return r;if(e.validators.length===0)return;const a=o.join(ly);return(i=e.validators.find(({validator:s})=>s(a)))==null?void 0:i.classGroupId},$C=/^\[(.+)\]$/,NO=o=>{if($C.test(o)){const e=$C.exec(o)[1],t=e==null?void 0:e.substring(0,e.indexOf(":"));if(t)return"arbitrary.."+t}},DO=o=>{const{theme:e,classGroups:t}=o,n={nextPart:new Map,validators:[]};for(const r in t)Qx(t[r],n,r,e);return n},Qx=(o,e,t,n)=>{o.forEach(r=>{if(typeof r=="string"){const a=r===""?e:JC(e,r);a.classGroupId=t;return}if(typeof r=="function"){if(OO(r)){Qx(r(n),e,t,n);return}e.validators.push({validator:r,classGroupId:t});return}Object.entries(r).forEach(([a,i])=>{Qx(i,JC(e,a),t,n)})})},JC=(o,e)=>{let t=o;return e.split(ly).forEach(n=>{t.nextPart.has(n)||t.nextPart.set(n,{nextPart:new Map,validators:[]}),t=t.nextPart.get(n)}),t},OO=o=>o.isThemeGetter,FO=o=>{if(o<1)return{get:()=>{},set:()=>{}};let e=0,t=new Map,n=new Map;const r=(a,i)=>{t.set(a,i),e++,e>o&&(e=0,n=t,t=new Map)};return{get(a){let i=t.get(a);if(i!==void 0)return i;if((i=n.get(a))!==void 0)return r(a,i),i},set(a,i){t.has(a)?t.set(a,i):r(a,i)}}},Hx="!",Wx=":",UO=Wx.length,zO=o=>{const{prefix:e,experimentalParseClassName:t}=o;let n=r=>{const a=[];let i=0,s=0,c=0,u;for(let A=0;A<r.length;A++){let _=r[A];if(i===0&&s===0){if(_===Wx){a.push(r.slice(c,A)),c=A+UO;continue}if(_==="/"){u=A;continue}}_==="["?i++:_==="]"?i--:_==="("?s++:_===")"&&s--}const h=a.length===0?r:r.substring(c),f=VO(h),m=f!==h,g=u&&u>c?u-c:void 0;return{modifiers:a,hasImportantModifier:m,baseClassName:f,maybePostfixModifierPosition:g}};if(e){const r=e+Wx,a=n;n=i=>i.startsWith(r)?a(i.substring(r.length)):{isExternal:!0,modifiers:[],hasImportantModifier:!1,baseClassName:i,maybePostfixModifierPosition:void 0}}if(t){const r=n;n=a=>t({className:a,parseClassName:r})}return n},VO=o=>o.endsWith(Hx)?o.substring(0,o.length-1):o.startsWith(Hx)?o.substring(1):o,kO=o=>{const e=Object.fromEntries(o.orderSensitiveModifiers.map(n=>[n,!0]));return n=>{if(n.length<=1)return n;const r=[];let a=[];return n.forEach(i=>{i[0]==="["||e[i]?(r.push(...a.sort(),i),a=[]):a.push(i)}),r.push(...a.sort()),r}},GO=o=>({cache:FO(o.cacheSize),parseClassName:zO(o),sortModifiers:kO(o),...PO(o)}),QO=/\s+/,HO=(o,e)=>{const{parseClassName:t,getClassGroupId:n,getConflictingClassGroupIds:r,sortModifiers:a}=e,i=[],s=o.trim().split(QO);let c="";for(let u=s.length-1;u>=0;u-=1){const h=s[u],{isExternal:f,modifiers:m,hasImportantModifier:g,baseClassName:A,maybePostfixModifierPosition:_}=t(h);if(f){c=h+(c.length>0?" "+c:c);continue}let x=!!_,C=n(x?A.substring(0,_):A);if(!C){if(!x){c=h+(c.length>0?" "+c:c);continue}if(C=n(A),!C){c=h+(c.length>0?" "+c:c);continue}x=!1}const b=a(m).join(":"),y=g?b+Hx:b,M=y+C;if(i.includes(M))continue;i.push(M);const R=r(C,x);for(let T=0;T<R.length;++T){const w=R[T];i.push(y+w)}c=h+(c.length>0?" "+c:c)}return c};function WO(){let o=0,e,t,n="";for(;o<arguments.length;)(e=arguments[o++])&&(t=NR(e))&&(n&&(n+=" "),n+=t);return n}const NR=o=>{if(typeof o=="string")return o;let e,t="";for(let n=0;n<o.length;n++)o[n]&&(e=NR(o[n]))&&(t&&(t+=" "),t+=e);return t};function YO(o,...e){let t,n,r,a=i;function i(c){const u=e.reduce((h,f)=>f(h),o());return t=GO(u),n=t.cache.get,r=t.cache.set,a=s,s(c)}function s(c){const u=n(c);if(u)return u;const h=HO(c,t);return r(c,h),h}return function(){return a(WO.apply(null,arguments))}}const xr=o=>{const e=t=>t[o]||[];return e.isThemeGetter=!0,e},DR=/^\[(?:(\w[\w-]*):)?(.+)\]$/i,OR=/^\((?:(\w[\w-]*):)?(.+)\)$/i,jO=/^\d+\/\d+$/,XO=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,qO=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,ZO=/^(rgba?|hsla?|hwb|(ok)?(lab|lch))\(.+\)$/,KO=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,$O=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,uu=o=>jO.test(o),Yt=o=>!!o&&!Number.isNaN(Number(o)),Yl=o=>!!o&&Number.isInteger(Number(o)),eE=o=>o.endsWith("%")&&Yt(o.slice(0,-1)),Fs=o=>XO.test(o),JO=()=>!0,e6=o=>qO.test(o)&&!ZO.test(o),cy=()=>!1,t6=o=>KO.test(o),n6=o=>$O.test(o),r6=o=>!at(o)&&!it(o),o6=o=>Sd(o,zR,cy),at=o=>DR.test(o),jl=o=>Sd(o,VR,e6),H_=o=>Sd(o,m6,Yt),a6=o=>Sd(o,FR,cy),i6=o=>Sd(o,UR,n6),s6=o=>Sd(o,cy,t6),it=o=>OR.test(o),Em=o=>Cd(o,VR),l6=o=>Cd(o,g6),c6=o=>Cd(o,FR),u6=o=>Cd(o,zR),d6=o=>Cd(o,UR),f6=o=>Cd(o,v6,!0),Sd=(o,e,t)=>{const n=DR.exec(o);return n?n[1]?e(n[1]):t(n[2]):!1},Cd=(o,e,t=!1)=>{const n=OR.exec(o);return n?n[1]?e(n[1]):t:!1},FR=o=>o==="position",h6=new Set(["image","url"]),UR=o=>h6.has(o),p6=new Set(["length","size","percentage"]),zR=o=>p6.has(o),VR=o=>o==="length",m6=o=>o==="number",g6=o=>o==="family-name",v6=o=>o==="shadow",_6=()=>{const o=xr("color"),e=xr("font"),t=xr("text"),n=xr("font-weight"),r=xr("tracking"),a=xr("leading"),i=xr("breakpoint"),s=xr("container"),c=xr("spacing"),u=xr("radius"),h=xr("shadow"),f=xr("inset-shadow"),m=xr("drop-shadow"),g=xr("blur"),A=xr("perspective"),_=xr("aspect"),x=xr("ease"),C=xr("animate"),b=()=>["auto","avoid","all","avoid-page","page","left","right","column"],y=()=>["bottom","center","left","left-bottom","left-top","right","right-bottom","right-top","top"],M=()=>["auto","hidden","clip","visible","scroll"],R=()=>["auto","contain","none"],T=()=>[it,at,c],w=()=>[uu,"full","auto",...T()],D=()=>[Yl,"none","subgrid",it,at],z=()=>["auto",{span:["full",Yl,it,at]},it,at],F=()=>[Yl,"auto",it,at],O=()=>["auto","min","max","fr",it,at],q=()=>["start","end","center","between","around","evenly","stretch","baseline"],ne=()=>["start","end","center","stretch"],$=()=>["auto",...T()],he=()=>[uu,"auto","full","dvw","dvh","lvw","lvh","svw","svh","min","max","fit",...T()],K=()=>[o,it,at],oe=()=>[eE,jl],ie=()=>["","none","full",u,it,at],L=()=>["",Yt,Em,jl],U=()=>["solid","dashed","dotted","double"],k=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],J=()=>["","none",g,it,at],de=()=>["center","top","top-right","right","bottom-right","bottom","bottom-left","left","top-left",it,at],te=()=>["none",Yt,it,at],le=()=>["none",Yt,it,at],V=()=>[Yt,it,at],G=()=>[uu,"full",...T()];return{cacheSize:500,theme:{animate:["spin","ping","pulse","bounce"],aspect:["video"],blur:[Fs],breakpoint:[Fs],color:[JO],container:[Fs],"drop-shadow":[Fs],ease:["in","out","in-out"],font:[r6],"font-weight":["thin","extralight","light","normal","medium","semibold","bold","extrabold","black"],"inset-shadow":[Fs],leading:["none","tight","snug","normal","relaxed","loose"],perspective:["dramatic","near","normal","midrange","distant","none"],radius:[Fs],shadow:[Fs],spacing:["px",Yt],text:[Fs],tracking:["tighter","tight","normal","wide","wider","widest"]},classGroups:{aspect:[{aspect:["auto","square",uu,at,it,_]}],container:["container"],columns:[{columns:[Yt,at,it,s]}],"break-after":[{"break-after":b()}],"break-before":[{"break-before":b()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],sr:["sr-only","not-sr-only"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:[...y(),at,it]}],overflow:[{overflow:M()}],"overflow-x":[{"overflow-x":M()}],"overflow-y":[{"overflow-y":M()}],overscroll:[{overscroll:R()}],"overscroll-x":[{"overscroll-x":R()}],"overscroll-y":[{"overscroll-y":R()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:w()}],"inset-x":[{"inset-x":w()}],"inset-y":[{"inset-y":w()}],start:[{start:w()}],end:[{end:w()}],top:[{top:w()}],right:[{right:w()}],bottom:[{bottom:w()}],left:[{left:w()}],visibility:["visible","invisible","collapse"],z:[{z:[Yl,"auto",it,at]}],basis:[{basis:[uu,"full","auto",s,...T()]}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["nowrap","wrap","wrap-reverse"]}],flex:[{flex:[Yt,uu,"auto","initial","none",at]}],grow:[{grow:["",Yt,it,at]}],shrink:[{shrink:["",Yt,it,at]}],order:[{order:[Yl,"first","last","none",it,at]}],"grid-cols":[{"grid-cols":D()}],"col-start-end":[{col:z()}],"col-start":[{"col-start":F()}],"col-end":[{"col-end":F()}],"grid-rows":[{"grid-rows":D()}],"row-start-end":[{row:z()}],"row-start":[{"row-start":F()}],"row-end":[{"row-end":F()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":O()}],"auto-rows":[{"auto-rows":O()}],gap:[{gap:T()}],"gap-x":[{"gap-x":T()}],"gap-y":[{"gap-y":T()}],"justify-content":[{justify:[...q(),"normal"]}],"justify-items":[{"justify-items":[...ne(),"normal"]}],"justify-self":[{"justify-self":["auto",...ne()]}],"align-content":[{content:["normal",...q()]}],"align-items":[{items:[...ne(),"baseline"]}],"align-self":[{self:["auto",...ne(),"baseline"]}],"place-content":[{"place-content":q()}],"place-items":[{"place-items":[...ne(),"baseline"]}],"place-self":[{"place-self":["auto",...ne()]}],p:[{p:T()}],px:[{px:T()}],py:[{py:T()}],ps:[{ps:T()}],pe:[{pe:T()}],pt:[{pt:T()}],pr:[{pr:T()}],pb:[{pb:T()}],pl:[{pl:T()}],m:[{m:$()}],mx:[{mx:$()}],my:[{my:$()}],ms:[{ms:$()}],me:[{me:$()}],mt:[{mt:$()}],mr:[{mr:$()}],mb:[{mb:$()}],ml:[{ml:$()}],"space-x":[{"space-x":T()}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":T()}],"space-y-reverse":["space-y-reverse"],size:[{size:he()}],w:[{w:[s,"screen",...he()]}],"min-w":[{"min-w":[s,"screen","none",...he()]}],"max-w":[{"max-w":[s,"screen","none","prose",{screen:[i]},...he()]}],h:[{h:["screen",...he()]}],"min-h":[{"min-h":["screen","none",...he()]}],"max-h":[{"max-h":["screen",...he()]}],"font-size":[{text:["base",t,Em,jl]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:[n,it,H_]}],"font-stretch":[{"font-stretch":["ultra-condensed","extra-condensed","condensed","semi-condensed","normal","semi-expanded","expanded","extra-expanded","ultra-expanded",eE,at]}],"font-family":[{font:[l6,at,e]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:[r,it,at]}],"line-clamp":[{"line-clamp":[Yt,"none",it,H_]}],leading:[{leading:[a,...T()]}],"list-image":[{"list-image":["none",it,at]}],"list-style-position":[{list:["inside","outside"]}],"list-style-type":[{list:["disc","decimal","none",it,at]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"placeholder-color":[{placeholder:K()}],"text-color":[{text:K()}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...U(),"wavy"]}],"text-decoration-thickness":[{decoration:[Yt,"from-font","auto",it,jl]}],"text-decoration-color":[{decoration:K()}],"underline-offset":[{"underline-offset":[Yt,"auto",it,at]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:T()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",it,at]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",it,at]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:[...y(),c6,a6]}],"bg-repeat":[{bg:["no-repeat",{repeat:["","x","y","space","round"]}]}],"bg-size":[{bg:["auto","cover","contain",u6,o6]}],"bg-image":[{bg:["none",{linear:[{to:["t","tr","r","br","b","bl","l","tl"]},Yl,it,at],radial:["",it,at],conic:[Yl,it,at]},d6,i6]}],"bg-color":[{bg:K()}],"gradient-from-pos":[{from:oe()}],"gradient-via-pos":[{via:oe()}],"gradient-to-pos":[{to:oe()}],"gradient-from":[{from:K()}],"gradient-via":[{via:K()}],"gradient-to":[{to:K()}],rounded:[{rounded:ie()}],"rounded-s":[{"rounded-s":ie()}],"rounded-e":[{"rounded-e":ie()}],"rounded-t":[{"rounded-t":ie()}],"rounded-r":[{"rounded-r":ie()}],"rounded-b":[{"rounded-b":ie()}],"rounded-l":[{"rounded-l":ie()}],"rounded-ss":[{"rounded-ss":ie()}],"rounded-se":[{"rounded-se":ie()}],"rounded-ee":[{"rounded-ee":ie()}],"rounded-es":[{"rounded-es":ie()}],"rounded-tl":[{"rounded-tl":ie()}],"rounded-tr":[{"rounded-tr":ie()}],"rounded-br":[{"rounded-br":ie()}],"rounded-bl":[{"rounded-bl":ie()}],"border-w":[{border:L()}],"border-w-x":[{"border-x":L()}],"border-w-y":[{"border-y":L()}],"border-w-s":[{"border-s":L()}],"border-w-e":[{"border-e":L()}],"border-w-t":[{"border-t":L()}],"border-w-r":[{"border-r":L()}],"border-w-b":[{"border-b":L()}],"border-w-l":[{"border-l":L()}],"divide-x":[{"divide-x":L()}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":L()}],"divide-y-reverse":["divide-y-reverse"],"border-style":[{border:[...U(),"hidden","none"]}],"divide-style":[{divide:[...U(),"hidden","none"]}],"border-color":[{border:K()}],"border-color-x":[{"border-x":K()}],"border-color-y":[{"border-y":K()}],"border-color-s":[{"border-s":K()}],"border-color-e":[{"border-e":K()}],"border-color-t":[{"border-t":K()}],"border-color-r":[{"border-r":K()}],"border-color-b":[{"border-b":K()}],"border-color-l":[{"border-l":K()}],"divide-color":[{divide:K()}],"outline-style":[{outline:[...U(),"none","hidden"]}],"outline-offset":[{"outline-offset":[Yt,it,at]}],"outline-w":[{outline:["",Yt,Em,jl]}],"outline-color":[{outline:[o]}],shadow:[{shadow:["","none",h,f6,s6]}],"shadow-color":[{shadow:K()}],"inset-shadow":[{"inset-shadow":["none",it,at,f]}],"inset-shadow-color":[{"inset-shadow":K()}],"ring-w":[{ring:L()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:K()}],"ring-offset-w":[{"ring-offset":[Yt,jl]}],"ring-offset-color":[{"ring-offset":K()}],"inset-ring-w":[{"inset-ring":L()}],"inset-ring-color":[{"inset-ring":K()}],opacity:[{opacity:[Yt,it,at]}],"mix-blend":[{"mix-blend":[...k(),"plus-darker","plus-lighter"]}],"bg-blend":[{"bg-blend":k()}],filter:[{filter:["","none",it,at]}],blur:[{blur:J()}],brightness:[{brightness:[Yt,it,at]}],contrast:[{contrast:[Yt,it,at]}],"drop-shadow":[{"drop-shadow":["","none",m,it,at]}],grayscale:[{grayscale:["",Yt,it,at]}],"hue-rotate":[{"hue-rotate":[Yt,it,at]}],invert:[{invert:["",Yt,it,at]}],saturate:[{saturate:[Yt,it,at]}],sepia:[{sepia:["",Yt,it,at]}],"backdrop-filter":[{"backdrop-filter":["","none",it,at]}],"backdrop-blur":[{"backdrop-blur":J()}],"backdrop-brightness":[{"backdrop-brightness":[Yt,it,at]}],"backdrop-contrast":[{"backdrop-contrast":[Yt,it,at]}],"backdrop-grayscale":[{"backdrop-grayscale":["",Yt,it,at]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[Yt,it,at]}],"backdrop-invert":[{"backdrop-invert":["",Yt,it,at]}],"backdrop-opacity":[{"backdrop-opacity":[Yt,it,at]}],"backdrop-saturate":[{"backdrop-saturate":[Yt,it,at]}],"backdrop-sepia":[{"backdrop-sepia":["",Yt,it,at]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":T()}],"border-spacing-x":[{"border-spacing-x":T()}],"border-spacing-y":[{"border-spacing-y":T()}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["","all","colors","opacity","shadow","transform","none",it,at]}],"transition-behavior":[{transition:["normal","discrete"]}],duration:[{duration:[Yt,"initial",it,at]}],ease:[{ease:["linear","initial",x,it,at]}],delay:[{delay:[Yt,it,at]}],animate:[{animate:["none",C,it,at]}],backface:[{backface:["hidden","visible"]}],perspective:[{perspective:[A,it,at]}],"perspective-origin":[{"perspective-origin":de()}],rotate:[{rotate:te()}],"rotate-x":[{"rotate-x":te()}],"rotate-y":[{"rotate-y":te()}],"rotate-z":[{"rotate-z":te()}],scale:[{scale:le()}],"scale-x":[{"scale-x":le()}],"scale-y":[{"scale-y":le()}],"scale-z":[{"scale-z":le()}],"scale-3d":["scale-3d"],skew:[{skew:V()}],"skew-x":[{"skew-x":V()}],"skew-y":[{"skew-y":V()}],transform:[{transform:[it,at,"","none","gpu","cpu"]}],"transform-origin":[{origin:de()}],"transform-style":[{transform:["3d","flat"]}],translate:[{translate:G()}],"translate-x":[{"translate-x":G()}],"translate-y":[{"translate-y":G()}],"translate-z":[{"translate-z":G()}],"translate-none":["translate-none"],accent:[{accent:K()}],appearance:[{appearance:["none","auto"]}],"caret-color":[{caret:K()}],"color-scheme":[{scheme:["normal","dark","light","light-dark","only-dark","only-light"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",it,at]}],"field-sizing":[{"field-sizing":["fixed","content"]}],"pointer-events":[{"pointer-events":["auto","none"]}],resize:[{resize:["none","","y","x"]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":T()}],"scroll-mx":[{"scroll-mx":T()}],"scroll-my":[{"scroll-my":T()}],"scroll-ms":[{"scroll-ms":T()}],"scroll-me":[{"scroll-me":T()}],"scroll-mt":[{"scroll-mt":T()}],"scroll-mr":[{"scroll-mr":T()}],"scroll-mb":[{"scroll-mb":T()}],"scroll-ml":[{"scroll-ml":T()}],"scroll-p":[{"scroll-p":T()}],"scroll-px":[{"scroll-px":T()}],"scroll-py":[{"scroll-py":T()}],"scroll-ps":[{"scroll-ps":T()}],"scroll-pe":[{"scroll-pe":T()}],"scroll-pt":[{"scroll-pt":T()}],"scroll-pr":[{"scroll-pr":T()}],"scroll-pb":[{"scroll-pb":T()}],"scroll-pl":[{"scroll-pl":T()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",it,at]}],fill:[{fill:["none",...K()]}],"stroke-w":[{stroke:[Yt,Em,jl,H_]}],stroke:[{stroke:["none",...K()]}],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],translate:["translate-x","translate-y","translate-none"],"translate-none":["translate","translate-x","translate-y","translate-z"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]},orderSensitiveModifiers:["before","after","placeholder","file","marker","selection","first-line","first-letter","backdrop","*","**"]}},A6=YO(_6);function jn(...o){return A6(BR(o))}function x6({className:o,...e}){return ue.jsx(RO,{"data-slot":"tabs",className:jn("flex flex-col gap-2",o),...e})}function y6({className:o,...e}){return ue.jsx(IO,{"data-slot":"tabs-list",className:jn("bg-muted text-muted-foreground inline-flex h-9 w-fit items-center justify-center rounded-lg p-[3px]",o),...e})}function tE({className:o,...e}){return ue.jsx(LO,{"data-slot":"tabs-trigger",className:jn("data-[state=active]:bg-background dark:data-[state=active]:text-foreground focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:outline-ring dark:data-[state=active]:border-input dark:data-[state=active]:bg-input/30 text-foreground dark:text-muted-foreground inline-flex h-[calc(100%-1px)] flex-1 items-center justify-center gap-1.5 rounded-md border border-transparent px-2 py-1 text-sm font-medium whitespace-nowrap transition-[color,box-shadow] focus-visible:ring-[3px] focus-visible:outline-1 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:shadow-sm [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",o),...e})}function nE({className:o,...e}){return ue.jsx(BO,{"data-slot":"tabs-content",className:jn("flex-1 outline-none",o),...e})}function td({className:o,...e}){return ue.jsx("div",{"data-slot":"card",className:jn("bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm",o),...e})}function hh({className:o,...e}){return ue.jsx("div",{"data-slot":"card-header",className:jn("@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-1.5 px-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6",o),...e})}function ph({className:o,...e}){return ue.jsx("div",{"data-slot":"card-title",className:jn("leading-none font-semibold",o),...e})}function mh({className:o,...e}){return ue.jsx("div",{"data-slot":"card-description",className:jn("text-muted-foreground text-sm",o),...e})}function gh({className:o,...e}){return ue.jsx("div",{"data-slot":"card-content",className:jn("px-6",o),...e})}var b6="Label",kR=j.forwardRef((o,e)=>ue.jsx(Yr.label,{...o,ref:e,onMouseDown:t=>{var r;t.target.closest("button, input, select, textarea")||((r=o.onMouseDown)==null||r.call(o,t),!t.defaultPrevented&&t.detail>1&&t.preventDefault())}}));kR.displayName=b6;var S6=kR;function Xl({className:o,...e}){return ue.jsx(S6,{"data-slot":"label",className:jn("flex items-center gap-2 text-sm leading-none font-medium select-none group-data-[disabled=true]:pointer-events-none group-data-[disabled=true]:opacity-50 peer-disabled:cursor-not-allowed peer-disabled:opacity-50",o),...e})}function rv(){return(rv=Object.assign||function(o){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(o[n]=t[n])}return o}).apply(this,arguments)}function GR(o,e){if(o==null)return{};var t,n,r={},a=Object.keys(o);for(n=0;n<a.length;n++)e.indexOf(t=a[n])>=0||(r[t]=o[t]);return r}function Yx(o){var e=j.useRef(o),t=j.useRef(function(n){e.current&&e.current(n)});return e.current=o,t.current}var Th=function(o,e,t){return e===void 0&&(e=0),t===void 0&&(t=1),o>t?t:o<e?e:o},vh=function(o){return"touches"in o},jx=function(o){return o&&o.ownerDocument.defaultView||self},rE=function(o,e,t){var n=o.getBoundingClientRect(),r=vh(e)?function(a,i){for(var s=0;s<a.length;s++)if(a[s].identifier===i)return a[s];return a[0]}(e.touches,t):e;return{left:Th((r.pageX-(n.left+jx(o).pageXOffset))/n.width),top:Th((r.pageY-(n.top+jx(o).pageYOffset))/n.height)}},oE=function(o){!vh(o)&&o.preventDefault()},QR=nt.memo(function(o){var e=o.onMove,t=o.onKey,n=GR(o,["onMove","onKey"]),r=j.useRef(null),a=Yx(e),i=Yx(t),s=j.useRef(null),c=j.useRef(!1),u=j.useMemo(function(){var g=function(x){oE(x),(vh(x)?x.touches.length>0:x.buttons>0)&&r.current?a(rE(r.current,x,s.current)):_(!1)},A=function(){return _(!1)};function _(x){var C=c.current,b=jx(r.current),y=x?b.addEventListener:b.removeEventListener;y(C?"touchmove":"mousemove",g),y(C?"touchend":"mouseup",A)}return[function(x){var C=x.nativeEvent,b=r.current;if(b&&(oE(C),!function(M,R){return R&&!vh(M)}(C,c.current)&&b)){if(vh(C)){c.current=!0;var y=C.changedTouches||[];y.length&&(s.current=y[0].identifier)}b.focus(),a(rE(b,C,s.current)),_(!0)}},function(x){var C=x.which||x.keyCode;C<37||C>40||(x.preventDefault(),i({left:C===39?.05:C===37?-.05:0,top:C===40?.05:C===38?-.05:0}))},_]},[i,a]),h=u[0],f=u[1],m=u[2];return j.useEffect(function(){return m},[m]),nt.createElement("div",rv({},n,{onTouchStart:h,onMouseDown:h,className:"react-colorful__interactive",ref:r,onKeyDown:f,tabIndex:0,role:"slider"}))}),uy=function(o){return o.filter(Boolean).join(" ")},HR=function(o){var e=o.color,t=o.left,n=o.top,r=n===void 0?.5:n,a=uy(["react-colorful__pointer",o.className]);return nt.createElement("div",{className:a,style:{top:100*r+"%",left:100*t+"%"}},nt.createElement("div",{className:"react-colorful__pointer-fill",style:{backgroundColor:e}}))},Dr=function(o,e,t){return e===void 0&&(e=0),t===void 0&&(t=Math.pow(10,e)),Math.round(t*o)/t},C6=function(o){return R6(Xx(o))},Xx=function(o){return o[0]==="#"&&(o=o.substring(1)),o.length<6?{r:parseInt(o[0]+o[0],16),g:parseInt(o[1]+o[1],16),b:parseInt(o[2]+o[2],16),a:o.length===4?Dr(parseInt(o[3]+o[3],16)/255,2):1}:{r:parseInt(o.substring(0,2),16),g:parseInt(o.substring(2,4),16),b:parseInt(o.substring(4,6),16),a:o.length===8?Dr(parseInt(o.substring(6,8),16)/255,2):1}},E6=function(o){return T6(w6(o))},M6=function(o){var e=o.s,t=o.v,n=o.a,r=(200-e)*t/100;return{h:Dr(o.h),s:Dr(r>0&&r<200?e*t/100/(r<=100?r:200-r)*100:0),l:Dr(r/2),a:Dr(n,2)}},qx=function(o){var e=M6(o);return"hsl("+e.h+", "+e.s+"%, "+e.l+"%)"},w6=function(o){var e=o.h,t=o.s,n=o.v,r=o.a;e=e/360*6,t/=100,n/=100;var a=Math.floor(e),i=n*(1-t),s=n*(1-(e-a)*t),c=n*(1-(1-e+a)*t),u=a%6;return{r:Dr(255*[n,s,i,i,c,n][u]),g:Dr(255*[c,n,n,s,i,i][u]),b:Dr(255*[i,i,c,n,n,s][u]),a:Dr(r,2)}},Mm=function(o){var e=o.toString(16);return e.length<2?"0"+e:e},T6=function(o){var e=o.r,t=o.g,n=o.b,r=o.a,a=r<1?Mm(Dr(255*r)):"";return"#"+Mm(e)+Mm(t)+Mm(n)+a},R6=function(o){var e=o.r,t=o.g,n=o.b,r=o.a,a=Math.max(e,t,n),i=a-Math.min(e,t,n),s=i?a===e?(t-n)/i:a===t?2+(n-e)/i:4+(e-t)/i:0;return{h:Dr(60*(s<0?s+6:s)),s:Dr(a?i/a*100:0),v:Dr(a/255*100),a:r}},I6=nt.memo(function(o){var e=o.hue,t=o.onChange,n=uy(["react-colorful__hue",o.className]);return nt.createElement("div",{className:n},nt.createElement(QR,{onMove:function(r){t({h:360*r.left})},onKey:function(r){t({h:Th(e+360*r.left,0,360)})},"aria-label":"Hue","aria-valuenow":Dr(e),"aria-valuemax":"360","aria-valuemin":"0"},nt.createElement(HR,{className:"react-colorful__hue-pointer",left:e/360,color:qx({h:e,s:100,v:100,a:1})})))}),L6=nt.memo(function(o){var e=o.hsva,t=o.onChange,n={backgroundColor:qx({h:e.h,s:100,v:100,a:1})};return nt.createElement("div",{className:"react-colorful__saturation",style:n},nt.createElement(QR,{onMove:function(r){t({s:100*r.left,v:100-100*r.top})},onKey:function(r){t({s:Th(e.s+100*r.left,0,100),v:Th(e.v-100*r.top,0,100)})},"aria-label":"Color","aria-valuetext":"Saturation "+Dr(e.s)+"%, Brightness "+Dr(e.v)+"%"},nt.createElement(HR,{className:"react-colorful__saturation-pointer",top:1-e.v/100,left:e.s/100,color:qx(e)})))}),WR=function(o,e){if(o===e)return!0;for(var t in o)if(o[t]!==e[t])return!1;return!0},B6=function(o,e){return o.toLowerCase()===e.toLowerCase()||WR(Xx(o),Xx(e))};function P6(o,e,t){var n=Yx(t),r=j.useState(function(){return o.toHsva(e)}),a=r[0],i=r[1],s=j.useRef({color:e,hsva:a});j.useEffect(function(){if(!o.equal(e,s.current.color)){var u=o.toHsva(e);s.current={hsva:u,color:e},i(u)}},[e,o]),j.useEffect(function(){var u;WR(a,s.current.hsva)||o.equal(u=o.fromHsva(a),s.current.color)||(s.current={hsva:a,color:u},n(u))},[a,o,n]);var c=j.useCallback(function(u){i(function(h){return Object.assign({},h,u)})},[]);return[a,c]}var N6=typeof window<"u"?j.useLayoutEffect:j.useEffect,D6=function(){return typeof __webpack_nonce__<"u"?__webpack_nonce__:void 0},aE=new Map,O6=function(o){N6(function(){var e=o.current?o.current.ownerDocument:document;if(e!==void 0&&!aE.has(e)){var t=e.createElement("style");t.innerHTML=`.react-colorful{position:relative;display:flex;flex-direction:column;width:200px;height:200px;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;cursor:default}.react-colorful__saturation{position:relative;flex-grow:1;border-color:transparent;border-bottom:12px solid #000;border-radius:8px 8px 0 0;background-image:linear-gradient(0deg,#000,transparent),linear-gradient(90deg,#fff,hsla(0,0%,100%,0))}.react-colorful__alpha-gradient,.react-colorful__pointer-fill{content:"";position:absolute;left:0;top:0;right:0;bottom:0;pointer-events:none;border-radius:inherit}.react-colorful__alpha-gradient,.react-colorful__saturation{box-shadow:inset 0 0 0 1px rgba(0,0,0,.05)}.react-colorful__alpha,.react-colorful__hue{position:relative;height:24px}.react-colorful__hue{background:linear-gradient(90deg,red 0,#ff0 17%,#0f0 33%,#0ff 50%,#00f 67%,#f0f 83%,red)}.react-colorful__last-control{border-radius:0 0 8px 8px}.react-colorful__interactive{position:absolute;left:0;top:0;right:0;bottom:0;border-radius:inherit;outline:none;touch-action:none}.react-colorful__pointer{position:absolute;z-index:1;box-sizing:border-box;width:28px;height:28px;transform:translate(-50%,-50%);background-color:#fff;border:2px solid #fff;border-radius:50%;box-shadow:0 2px 4px rgba(0,0,0,.2)}.react-colorful__interactive:focus .react-colorful__pointer{transform:translate(-50%,-50%) scale(1.1)}.react-colorful__alpha,.react-colorful__alpha-pointer{background-color:#fff;background-image:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill-opacity=".05"><path d="M8 0h8v8H8zM0 8h8v8H0z"/></svg>')}.react-colorful__saturation-pointer{z-index:3}.react-colorful__hue-pointer{z-index:2}`,aE.set(e,t);var n=D6();n&&t.setAttribute("nonce",n),e.head.appendChild(t)}},[])},F6=function(o){var e=o.className,t=o.colorModel,n=o.color,r=n===void 0?t.defaultColor:n,a=o.onChange,i=GR(o,["className","colorModel","color","onChange"]),s=j.useRef(null);O6(s);var c=P6(t,r,a),u=c[0],h=c[1],f=uy(["react-colorful",e]);return nt.createElement("div",rv({},i,{ref:s,className:f}),nt.createElement(L6,{hsva:u,onChange:h}),nt.createElement(I6,{hue:u.h,onChange:h,className:"react-colorful__last-control"}))},U6={defaultColor:"000",toHsva:C6,fromHsva:function(o){return E6({h:o.h,s:o.s,v:o.v,a:1})},equal:B6},z6=function(o){return nt.createElement(F6,rv({},o,{colorModel:U6}))};function V6(o){const e=j.useRef(null);return j.useEffect(()=>{o&&(typeof o=="function"?o(e.current):o.current=e.current)}),e}const iE=o=>typeof o=="boolean"?`${o}`:o===0?"0":o,sE=BR,k6=(o,e)=>t=>{var n;if((e==null?void 0:e.variants)==null)return sE(o,t==null?void 0:t.class,t==null?void 0:t.className);const{variants:r,defaultVariants:a}=e,i=Object.keys(r).map(u=>{const h=t==null?void 0:t[u],f=a==null?void 0:a[u];if(h===null)return null;const m=iE(h)||iE(f);return r[u][m]}),s=t&&Object.entries(t).reduce((u,h)=>{let[f,m]=h;return m===void 0||(u[f]=m),u},{}),c=e==null||(n=e.compoundVariants)===null||n===void 0?void 0:n.reduce((u,h)=>{let{class:f,className:m,...g}=h;return Object.entries(g).every(A=>{let[_,x]=A;return Array.isArray(x)?x.includes({...a,...s}[_]):{...a,...s}[_]===x})?[...u,f,m]:u},[]);return sE(o,i,c,t==null?void 0:t.class,t==null?void 0:t.className)},G6=k6("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline",expandIcon:"group relative text-primary-foreground bg-primary hover:bg-primary/90",ringHover:"bg-primary text-primary-foreground transition-all duration-300 hover:bg-primary/90 hover:ring-2 hover:ring-primary/90 hover:ring-offset-2",shine:"text-primary-foreground animate-shine bg-gradient-to-r from-primary via-primary/75 to-primary bg-[length:400%_100%] ",gooeyRight:"text-primary-foreground relative bg-primary z-0 overflow-hidden transition-all duration-500 before:absolute before:inset-0 before:-z-10 before:translate-x-[150%] before:translate-y-[150%] before:scale-[2.5] before:rounded-[100%] before:bg-gradient-to-r from-zinc-400 before:transition-transform before:duration-1000  hover:before:translate-x-[0%] hover:before:translate-y-[0%] ",gooeyLeft:"text-primary-foreground relative bg-primary z-0 overflow-hidden transition-all duration-500 after:absolute after:inset-0 after:-z-10 after:translate-x-[-150%] after:translate-y-[150%] after:scale-[2.5] after:rounded-[100%] after:bg-gradient-to-l from-zinc-400 after:transition-transform after:duration-1000  hover:after:translate-x-[0%] hover:after:translate-y-[0%] ",linkHover1:"relative after:absolute after:bg-primary after:bottom-2 after:h-[1px] after:w-2/3 after:origin-bottom-left after:scale-x-100 hover:after:origin-bottom-right hover:after:scale-x-0 after:transition-transform after:ease-in-out after:duration-300",linkHover2:"relative after:absolute after:bg-primary after:bottom-2 after:h-[1px] after:w-2/3 after:origin-bottom-right after:scale-x-0 hover:after:origin-bottom-left hover:after:scale-x-100 after:transition-transform after:ease-in-out after:duration-300"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"p-0 h-8 w-8","input-icon":"p-0 h-10 w-10","no-padding":"p-0"}},defaultVariants:{variant:"default",size:"default"}}),ov=j.forwardRef(({className:o,variant:e,size:t,asChild:n=!1,Icon:r,iconPlacement:a,type:i="button",...s},c)=>{const u=n?cd:"button";return ue.jsxs(u,{className:jn(G6({variant:e,size:t,className:o})),ref:c,type:i,...s,children:[r&&a==="left"?ue.jsx("div",{className:"group-hover:translate-x-100 w-0 translate-x-[0%] pr-0 opacity-0 transition-all duration-200 group-hover:w-5 group-hover:pr-2 group-hover:opacity-100",children:ue.jsx(r,{})}):null,ue.jsx(fR,{children:s.children}),r&&a==="right"?ue.jsx("div",{className:"w-0 translate-x-[100%] pl-0 opacity-0 transition-all duration-200 group-hover:w-5 group-hover:translate-x-0 group-hover:pl-2 group-hover:opacity-100",children:ue.jsx(r,{})}):null]})});ov.displayName="Button";function Q6(o,e=globalThis==null?void 0:globalThis.document){const t=us(o);j.useEffect(()=>{const n=r=>{r.key==="Escape"&&t(r)};return e.addEventListener("keydown",n,{capture:!0}),()=>e.removeEventListener("keydown",n,{capture:!0})},[t,e])}var H6="DismissableLayer",Zx="dismissableLayer.update",W6="dismissableLayer.pointerDownOutside",Y6="dismissableLayer.focusOutside",lE,YR=j.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),jR=j.forwardRef((o,e)=>{const{disableOutsidePointerEvents:t=!1,onEscapeKeyDown:n,onPointerDownOutside:r,onFocusOutside:a,onInteractOutside:i,onDismiss:s,...c}=o,u=j.useContext(YR),[h,f]=j.useState(null),m=(h==null?void 0:h.ownerDocument)??(globalThis==null?void 0:globalThis.document),[,g]=j.useState({}),A=Fa(e,w=>f(w)),_=Array.from(u.layers),[x]=[...u.layersWithOutsidePointerEventsDisabled].slice(-1),C=_.indexOf(x),b=h?_.indexOf(h):-1,y=u.layersWithOutsidePointerEventsDisabled.size>0,M=b>=C,R=q6(w=>{const D=w.target,z=[...u.branches].some(F=>F.contains(D));!M||z||(r==null||r(w),i==null||i(w),w.defaultPrevented||s==null||s())},m),T=Z6(w=>{const D=w.target;[...u.branches].some(F=>F.contains(D))||(a==null||a(w),i==null||i(w),w.defaultPrevented||s==null||s())},m);return Q6(w=>{b===u.layers.size-1&&(n==null||n(w),!w.defaultPrevented&&s&&(w.preventDefault(),s()))},m),j.useEffect(()=>{if(h)return t&&(u.layersWithOutsidePointerEventsDisabled.size===0&&(lE=m.body.style.pointerEvents,m.body.style.pointerEvents="none"),u.layersWithOutsidePointerEventsDisabled.add(h)),u.layers.add(h),cE(),()=>{t&&u.layersWithOutsidePointerEventsDisabled.size===1&&(m.body.style.pointerEvents=lE)}},[h,m,t,u]),j.useEffect(()=>()=>{h&&(u.layers.delete(h),u.layersWithOutsidePointerEventsDisabled.delete(h),cE())},[h,u]),j.useEffect(()=>{const w=()=>g({});return document.addEventListener(Zx,w),()=>document.removeEventListener(Zx,w)},[]),ue.jsx(Yr.div,{...c,ref:A,style:{pointerEvents:y?M?"auto":"none":void 0,...o.style},onFocusCapture:Or(o.onFocusCapture,T.onFocusCapture),onBlurCapture:Or(o.onBlurCapture,T.onBlurCapture),onPointerDownCapture:Or(o.onPointerDownCapture,R.onPointerDownCapture)})});jR.displayName=H6;var j6="DismissableLayerBranch",X6=j.forwardRef((o,e)=>{const t=j.useContext(YR),n=j.useRef(null),r=Fa(e,n);return j.useEffect(()=>{const a=n.current;if(a)return t.branches.add(a),()=>{t.branches.delete(a)}},[t.branches]),ue.jsx(Yr.div,{...o,ref:r})});X6.displayName=j6;function q6(o,e=globalThis==null?void 0:globalThis.document){const t=us(o),n=j.useRef(!1),r=j.useRef(()=>{});return j.useEffect(()=>{const a=s=>{if(s.target&&!n.current){let c=function(){XR(W6,t,u,{discrete:!0})};const u={originalEvent:s};s.pointerType==="touch"?(e.removeEventListener("click",r.current),r.current=c,e.addEventListener("click",r.current,{once:!0})):c()}else e.removeEventListener("click",r.current);n.current=!1},i=window.setTimeout(()=>{e.addEventListener("pointerdown",a)},0);return()=>{window.clearTimeout(i),e.removeEventListener("pointerdown",a),e.removeEventListener("click",r.current)}},[e,t]),{onPointerDownCapture:()=>n.current=!0}}function Z6(o,e=globalThis==null?void 0:globalThis.document){const t=us(o),n=j.useRef(!1);return j.useEffect(()=>{const r=a=>{a.target&&!n.current&&XR(Y6,t,{originalEvent:a},{discrete:!1})};return e.addEventListener("focusin",r),()=>e.removeEventListener("focusin",r)},[e,t]),{onFocusCapture:()=>n.current=!0,onBlurCapture:()=>n.current=!1}}function cE(){const o=new CustomEvent(Zx);document.dispatchEvent(o)}function XR(o,e,t,{discrete:n}){const r=t.originalEvent.target,a=new CustomEvent(o,{bubbles:!1,cancelable:!0,detail:t});e&&r.addEventListener(o,e,{once:!0}),n?cO(r,a):r.dispatchEvent(a)}var W_=0;function K6(){j.useEffect(()=>{const o=document.querySelectorAll("[data-radix-focus-guard]");return document.body.insertAdjacentElement("afterbegin",o[0]??uE()),document.body.insertAdjacentElement("beforeend",o[1]??uE()),W_++,()=>{W_===1&&document.querySelectorAll("[data-radix-focus-guard]").forEach(e=>e.remove()),W_--}},[])}function uE(){const o=document.createElement("span");return o.setAttribute("data-radix-focus-guard",""),o.tabIndex=0,o.style.outline="none",o.style.opacity="0",o.style.position="fixed",o.style.pointerEvents="none",o}var Y_="focusScope.autoFocusOnMount",j_="focusScope.autoFocusOnUnmount",dE={bubbles:!1,cancelable:!0},$6="FocusScope",qR=j.forwardRef((o,e)=>{const{loop:t=!1,trapped:n=!1,onMountAutoFocus:r,onUnmountAutoFocus:a,...i}=o,[s,c]=j.useState(null),u=us(r),h=us(a),f=j.useRef(null),m=Fa(e,_=>c(_)),g=j.useRef({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;j.useEffect(()=>{if(n){let _=function(y){if(g.paused||!s)return;const M=y.target;s.contains(M)?f.current=M:$s(f.current,{select:!0})},x=function(y){if(g.paused||!s)return;const M=y.relatedTarget;M!==null&&(s.contains(M)||$s(f.current,{select:!0}))},C=function(y){if(document.activeElement===document.body)for(const R of y)R.removedNodes.length>0&&$s(s)};document.addEventListener("focusin",_),document.addEventListener("focusout",x);const b=new MutationObserver(C);return s&&b.observe(s,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",_),document.removeEventListener("focusout",x),b.disconnect()}}},[n,s,g.paused]),j.useEffect(()=>{if(s){hE.add(g);const _=document.activeElement;if(!s.contains(_)){const C=new CustomEvent(Y_,dE);s.addEventListener(Y_,u),s.dispatchEvent(C),C.defaultPrevented||(J6(o8(ZR(s)),{select:!0}),document.activeElement===_&&$s(s))}return()=>{s.removeEventListener(Y_,u),setTimeout(()=>{const C=new CustomEvent(j_,dE);s.addEventListener(j_,h),s.dispatchEvent(C),C.defaultPrevented||$s(_??document.body,{select:!0}),s.removeEventListener(j_,h),hE.remove(g)},0)}}},[s,u,h,g]);const A=j.useCallback(_=>{if(!t&&!n||g.paused)return;const x=_.key==="Tab"&&!_.altKey&&!_.ctrlKey&&!_.metaKey,C=document.activeElement;if(x&&C){const b=_.currentTarget,[y,M]=e8(b);y&&M?!_.shiftKey&&C===M?(_.preventDefault(),t&&$s(y,{select:!0})):_.shiftKey&&C===y&&(_.preventDefault(),t&&$s(M,{select:!0})):C===b&&_.preventDefault()}},[t,n,g.paused]);return ue.jsx(Yr.div,{tabIndex:-1,...i,ref:m,onKeyDown:A})});qR.displayName=$6;function J6(o,{select:e=!1}={}){const t=document.activeElement;for(const n of o)if($s(n,{select:e}),document.activeElement!==t)return}function e8(o){const e=ZR(o),t=fE(e,o),n=fE(e.reverse(),o);return[t,n]}function ZR(o){const e=[],t=document.createTreeWalker(o,NodeFilter.SHOW_ELEMENT,{acceptNode:n=>{const r=n.tagName==="INPUT"&&n.type==="hidden";return n.disabled||n.hidden||r?NodeFilter.FILTER_SKIP:n.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;t.nextNode();)e.push(t.currentNode);return e}function fE(o,e){for(const t of o)if(!t8(t,{upTo:e}))return t}function t8(o,{upTo:e}){if(getComputedStyle(o).visibility==="hidden")return!0;for(;o;){if(e!==void 0&&o===e)return!1;if(getComputedStyle(o).display==="none")return!0;o=o.parentElement}return!1}function n8(o){return o instanceof HTMLInputElement&&"select"in o}function $s(o,{select:e=!1}={}){if(o&&o.focus){const t=document.activeElement;o.focus({preventScroll:!0}),o!==t&&n8(o)&&e&&o.select()}}var hE=r8();function r8(){let o=[];return{add(e){const t=o[0];e!==t&&(t==null||t.pause()),o=pE(o,e),o.unshift(e)},remove(e){var t;o=pE(o,e),(t=o[0])==null||t.resume()}}}function pE(o,e){const t=[...o],n=t.indexOf(e);return n!==-1&&t.splice(n,1),t}function o8(o){return o.filter(e=>e.tagName!=="A")}const a8=["top","right","bottom","left"],sl=Math.min,Vo=Math.max,xg=Math.round,wm=Math.floor,li=o=>({x:o,y:o}),i8={left:"right",right:"left",bottom:"top",top:"bottom"},s8={start:"end",end:"start"};function Kx(o,e,t){return Vo(o,sl(e,t))}function ds(o,e){return typeof o=="function"?o(e):o}function fs(o){return o.split("-")[0]}function Ed(o){return o.split("-")[1]}function dy(o){return o==="x"?"y":"x"}function fy(o){return o==="y"?"height":"width"}function ll(o){return["top","bottom"].includes(fs(o))?"y":"x"}function hy(o){return dy(ll(o))}function l8(o,e,t){t===void 0&&(t=!1);const n=Ed(o),r=hy(o),a=fy(r);let i=r==="x"?n===(t?"end":"start")?"right":"left":n==="start"?"bottom":"top";return e.reference[a]>e.floating[a]&&(i=yg(i)),[i,yg(i)]}function c8(o){const e=yg(o);return[$x(o),e,$x(e)]}function $x(o){return o.replace(/start|end/g,e=>s8[e])}function u8(o,e,t){const n=["left","right"],r=["right","left"],a=["top","bottom"],i=["bottom","top"];switch(o){case"top":case"bottom":return t?e?r:n:e?n:r;case"left":case"right":return e?a:i;default:return[]}}function d8(o,e,t,n){const r=Ed(o);let a=u8(fs(o),t==="start",n);return r&&(a=a.map(i=>i+"-"+r),e&&(a=a.concat(a.map($x)))),a}function yg(o){return o.replace(/left|right|bottom|top/g,e=>i8[e])}function f8(o){return{top:0,right:0,bottom:0,left:0,...o}}function KR(o){return typeof o!="number"?f8(o):{top:o,right:o,bottom:o,left:o}}function bg(o){const{x:e,y:t,width:n,height:r}=o;return{width:n,height:r,top:t,left:e,right:e+n,bottom:t+r,x:e,y:t}}function mE(o,e,t){let{reference:n,floating:r}=o;const a=ll(e),i=hy(e),s=fy(i),c=fs(e),u=a==="y",h=n.x+n.width/2-r.width/2,f=n.y+n.height/2-r.height/2,m=n[s]/2-r[s]/2;let g;switch(c){case"top":g={x:h,y:n.y-r.height};break;case"bottom":g={x:h,y:n.y+n.height};break;case"right":g={x:n.x+n.width,y:f};break;case"left":g={x:n.x-r.width,y:f};break;default:g={x:n.x,y:n.y}}switch(Ed(e)){case"start":g[i]-=m*(t&&u?-1:1);break;case"end":g[i]+=m*(t&&u?-1:1);break}return g}const h8=async(o,e,t)=>{const{placement:n="bottom",strategy:r="absolute",middleware:a=[],platform:i}=t,s=a.filter(Boolean),c=await(i.isRTL==null?void 0:i.isRTL(e));let u=await i.getElementRects({reference:o,floating:e,strategy:r}),{x:h,y:f}=mE(u,n,c),m=n,g={},A=0;for(let _=0;_<s.length;_++){const{name:x,fn:C}=s[_],{x:b,y,data:M,reset:R}=await C({x:h,y:f,initialPlacement:n,placement:m,strategy:r,middlewareData:g,rects:u,platform:i,elements:{reference:o,floating:e}});h=b??h,f=y??f,g={...g,[x]:{...g[x],...M}},R&&A<=50&&(A++,typeof R=="object"&&(R.placement&&(m=R.placement),R.rects&&(u=R.rects===!0?await i.getElementRects({reference:o,floating:e,strategy:r}):R.rects),{x:h,y:f}=mE(u,m,c)),_=-1)}return{x:h,y:f,placement:m,strategy:r,middlewareData:g}};async function Rh(o,e){var t;e===void 0&&(e={});const{x:n,y:r,platform:a,rects:i,elements:s,strategy:c}=o,{boundary:u="clippingAncestors",rootBoundary:h="viewport",elementContext:f="floating",altBoundary:m=!1,padding:g=0}=ds(e,o),A=KR(g),x=s[m?f==="floating"?"reference":"floating":f],C=bg(await a.getClippingRect({element:(t=await(a.isElement==null?void 0:a.isElement(x)))==null||t?x:x.contextElement||await(a.getDocumentElement==null?void 0:a.getDocumentElement(s.floating)),boundary:u,rootBoundary:h,strategy:c})),b=f==="floating"?{x:n,y:r,width:i.floating.width,height:i.floating.height}:i.reference,y=await(a.getOffsetParent==null?void 0:a.getOffsetParent(s.floating)),M=await(a.isElement==null?void 0:a.isElement(y))?await(a.getScale==null?void 0:a.getScale(y))||{x:1,y:1}:{x:1,y:1},R=bg(a.convertOffsetParentRelativeRectToViewportRelativeRect?await a.convertOffsetParentRelativeRectToViewportRelativeRect({elements:s,rect:b,offsetParent:y,strategy:c}):b);return{top:(C.top-R.top+A.top)/M.y,bottom:(R.bottom-C.bottom+A.bottom)/M.y,left:(C.left-R.left+A.left)/M.x,right:(R.right-C.right+A.right)/M.x}}const p8=o=>({name:"arrow",options:o,async fn(e){const{x:t,y:n,placement:r,rects:a,platform:i,elements:s,middlewareData:c}=e,{element:u,padding:h=0}=ds(o,e)||{};if(u==null)return{};const f=KR(h),m={x:t,y:n},g=hy(r),A=fy(g),_=await i.getDimensions(u),x=g==="y",C=x?"top":"left",b=x?"bottom":"right",y=x?"clientHeight":"clientWidth",M=a.reference[A]+a.reference[g]-m[g]-a.floating[A],R=m[g]-a.reference[g],T=await(i.getOffsetParent==null?void 0:i.getOffsetParent(u));let w=T?T[y]:0;(!w||!await(i.isElement==null?void 0:i.isElement(T)))&&(w=s.floating[y]||a.floating[A]);const D=M/2-R/2,z=w/2-_[A]/2-1,F=sl(f[C],z),O=sl(f[b],z),q=F,ne=w-_[A]-O,$=w/2-_[A]/2+D,he=Kx(q,$,ne),K=!c.arrow&&Ed(r)!=null&&$!==he&&a.reference[A]/2-($<q?F:O)-_[A]/2<0,oe=K?$<q?$-q:$-ne:0;return{[g]:m[g]+oe,data:{[g]:he,centerOffset:$-he-oe,...K&&{alignmentOffset:oe}},reset:K}}}),m8=function(o){return o===void 0&&(o={}),{name:"flip",options:o,async fn(e){var t,n;const{placement:r,middlewareData:a,rects:i,initialPlacement:s,platform:c,elements:u}=e,{mainAxis:h=!0,crossAxis:f=!0,fallbackPlacements:m,fallbackStrategy:g="bestFit",fallbackAxisSideDirection:A="none",flipAlignment:_=!0,...x}=ds(o,e);if((t=a.arrow)!=null&&t.alignmentOffset)return{};const C=fs(r),b=ll(s),y=fs(s)===s,M=await(c.isRTL==null?void 0:c.isRTL(u.floating)),R=m||(y||!_?[yg(s)]:c8(s)),T=A!=="none";!m&&T&&R.push(...d8(s,_,A,M));const w=[s,...R],D=await Rh(e,x),z=[];let F=((n=a.flip)==null?void 0:n.overflows)||[];if(h&&z.push(D[C]),f){const $=l8(r,i,M);z.push(D[$[0]],D[$[1]])}if(F=[...F,{placement:r,overflows:z}],!z.every($=>$<=0)){var O,q;const $=(((O=a.flip)==null?void 0:O.index)||0)+1,he=w[$];if(he)return{data:{index:$,overflows:F},reset:{placement:he}};let K=(q=F.filter(oe=>oe.overflows[0]<=0).sort((oe,ie)=>oe.overflows[1]-ie.overflows[1])[0])==null?void 0:q.placement;if(!K)switch(g){case"bestFit":{var ne;const oe=(ne=F.filter(ie=>{if(T){const L=ll(ie.placement);return L===b||L==="y"}return!0}).map(ie=>[ie.placement,ie.overflows.filter(L=>L>0).reduce((L,U)=>L+U,0)]).sort((ie,L)=>ie[1]-L[1])[0])==null?void 0:ne[0];oe&&(K=oe);break}case"initialPlacement":K=s;break}if(r!==K)return{reset:{placement:K}}}return{}}}};function gE(o,e){return{top:o.top-e.height,right:o.right-e.width,bottom:o.bottom-e.height,left:o.left-e.width}}function vE(o){return a8.some(e=>o[e]>=0)}const g8=function(o){return o===void 0&&(o={}),{name:"hide",options:o,async fn(e){const{rects:t}=e,{strategy:n="referenceHidden",...r}=ds(o,e);switch(n){case"referenceHidden":{const a=await Rh(e,{...r,elementContext:"reference"}),i=gE(a,t.reference);return{data:{referenceHiddenOffsets:i,referenceHidden:vE(i)}}}case"escaped":{const a=await Rh(e,{...r,altBoundary:!0}),i=gE(a,t.floating);return{data:{escapedOffsets:i,escaped:vE(i)}}}default:return{}}}}};async function v8(o,e){const{placement:t,platform:n,elements:r}=o,a=await(n.isRTL==null?void 0:n.isRTL(r.floating)),i=fs(t),s=Ed(t),c=ll(t)==="y",u=["left","top"].includes(i)?-1:1,h=a&&c?-1:1,f=ds(e,o);let{mainAxis:m,crossAxis:g,alignmentAxis:A}=typeof f=="number"?{mainAxis:f,crossAxis:0,alignmentAxis:null}:{mainAxis:f.mainAxis||0,crossAxis:f.crossAxis||0,alignmentAxis:f.alignmentAxis};return s&&typeof A=="number"&&(g=s==="end"?A*-1:A),c?{x:g*h,y:m*u}:{x:m*u,y:g*h}}const _8=function(o){return o===void 0&&(o=0),{name:"offset",options:o,async fn(e){var t,n;const{x:r,y:a,placement:i,middlewareData:s}=e,c=await v8(e,o);return i===((t=s.offset)==null?void 0:t.placement)&&(n=s.arrow)!=null&&n.alignmentOffset?{}:{x:r+c.x,y:a+c.y,data:{...c,placement:i}}}}},A8=function(o){return o===void 0&&(o={}),{name:"shift",options:o,async fn(e){const{x:t,y:n,placement:r}=e,{mainAxis:a=!0,crossAxis:i=!1,limiter:s={fn:x=>{let{x:C,y:b}=x;return{x:C,y:b}}},...c}=ds(o,e),u={x:t,y:n},h=await Rh(e,c),f=ll(fs(r)),m=dy(f);let g=u[m],A=u[f];if(a){const x=m==="y"?"top":"left",C=m==="y"?"bottom":"right",b=g+h[x],y=g-h[C];g=Kx(b,g,y)}if(i){const x=f==="y"?"top":"left",C=f==="y"?"bottom":"right",b=A+h[x],y=A-h[C];A=Kx(b,A,y)}const _=s.fn({...e,[m]:g,[f]:A});return{..._,data:{x:_.x-t,y:_.y-n,enabled:{[m]:a,[f]:i}}}}}},x8=function(o){return o===void 0&&(o={}),{options:o,fn(e){const{x:t,y:n,placement:r,rects:a,middlewareData:i}=e,{offset:s=0,mainAxis:c=!0,crossAxis:u=!0}=ds(o,e),h={x:t,y:n},f=ll(r),m=dy(f);let g=h[m],A=h[f];const _=ds(s,e),x=typeof _=="number"?{mainAxis:_,crossAxis:0}:{mainAxis:0,crossAxis:0,..._};if(c){const y=m==="y"?"height":"width",M=a.reference[m]-a.floating[y]+x.mainAxis,R=a.reference[m]+a.reference[y]-x.mainAxis;g<M?g=M:g>R&&(g=R)}if(u){var C,b;const y=m==="y"?"width":"height",M=["top","left"].includes(fs(r)),R=a.reference[f]-a.floating[y]+(M&&((C=i.offset)==null?void 0:C[f])||0)+(M?0:x.crossAxis),T=a.reference[f]+a.reference[y]+(M?0:((b=i.offset)==null?void 0:b[f])||0)-(M?x.crossAxis:0);A<R?A=R:A>T&&(A=T)}return{[m]:g,[f]:A}}}},y8=function(o){return o===void 0&&(o={}),{name:"size",options:o,async fn(e){var t,n;const{placement:r,rects:a,platform:i,elements:s}=e,{apply:c=()=>{},...u}=ds(o,e),h=await Rh(e,u),f=fs(r),m=Ed(r),g=ll(r)==="y",{width:A,height:_}=a.floating;let x,C;f==="top"||f==="bottom"?(x=f,C=m===(await(i.isRTL==null?void 0:i.isRTL(s.floating))?"start":"end")?"left":"right"):(C=f,x=m==="end"?"top":"bottom");const b=_-h.top-h.bottom,y=A-h.left-h.right,M=sl(_-h[x],b),R=sl(A-h[C],y),T=!e.middlewareData.shift;let w=M,D=R;if((t=e.middlewareData.shift)!=null&&t.enabled.x&&(D=y),(n=e.middlewareData.shift)!=null&&n.enabled.y&&(w=b),T&&!m){const F=Vo(h.left,0),O=Vo(h.right,0),q=Vo(h.top,0),ne=Vo(h.bottom,0);g?D=A-2*(F!==0||O!==0?F+O:Vo(h.left,h.right)):w=_-2*(q!==0||ne!==0?q+ne:Vo(h.top,h.bottom))}await c({...e,availableWidth:D,availableHeight:w});const z=await i.getDimensions(s.floating);return A!==z.width||_!==z.height?{reset:{rects:!0}}:{}}}};function av(){return typeof window<"u"}function Md(o){return $R(o)?(o.nodeName||"").toLowerCase():"#document"}function Qo(o){var e;return(o==null||(e=o.ownerDocument)==null?void 0:e.defaultView)||window}function Ai(o){var e;return(e=($R(o)?o.ownerDocument:o.document)||window.document)==null?void 0:e.documentElement}function $R(o){return av()?o instanceof Node||o instanceof Qo(o).Node:!1}function Ua(o){return av()?o instanceof Element||o instanceof Qo(o).Element:!1}function pi(o){return av()?o instanceof HTMLElement||o instanceof Qo(o).HTMLElement:!1}function _E(o){return!av()||typeof ShadowRoot>"u"?!1:o instanceof ShadowRoot||o instanceof Qo(o).ShadowRoot}function rp(o){const{overflow:e,overflowX:t,overflowY:n,display:r}=za(o);return/auto|scroll|overlay|hidden|clip/.test(e+n+t)&&!["inline","contents"].includes(r)}function b8(o){return["table","td","th"].includes(Md(o))}function iv(o){return[":popover-open",":modal"].some(e=>{try{return o.matches(e)}catch{return!1}})}function py(o){const e=my(),t=Ua(o)?za(o):o;return["transform","translate","scale","rotate","perspective"].some(n=>t[n]?t[n]!=="none":!1)||(t.containerType?t.containerType!=="normal":!1)||!e&&(t.backdropFilter?t.backdropFilter!=="none":!1)||!e&&(t.filter?t.filter!=="none":!1)||["transform","translate","scale","rotate","perspective","filter"].some(n=>(t.willChange||"").includes(n))||["paint","layout","strict","content"].some(n=>(t.contain||"").includes(n))}function S8(o){let e=cl(o);for(;pi(e)&&!ud(e);){if(py(e))return e;if(iv(e))return null;e=cl(e)}return null}function my(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}function ud(o){return["html","body","#document"].includes(Md(o))}function za(o){return Qo(o).getComputedStyle(o)}function sv(o){return Ua(o)?{scrollLeft:o.scrollLeft,scrollTop:o.scrollTop}:{scrollLeft:o.scrollX,scrollTop:o.scrollY}}function cl(o){if(Md(o)==="html")return o;const e=o.assignedSlot||o.parentNode||_E(o)&&o.host||Ai(o);return _E(e)?e.host:e}function JR(o){const e=cl(o);return ud(e)?o.ownerDocument?o.ownerDocument.body:o.body:pi(e)&&rp(e)?e:JR(e)}function Ih(o,e,t){var n;e===void 0&&(e=[]),t===void 0&&(t=!0);const r=JR(o),a=r===((n=o.ownerDocument)==null?void 0:n.body),i=Qo(r);if(a){const s=Jx(i);return e.concat(i,i.visualViewport||[],rp(r)?r:[],s&&t?Ih(s):[])}return e.concat(r,Ih(r,[],t))}function Jx(o){return o.parent&&Object.getPrototypeOf(o.parent)?o.frameElement:null}function e4(o){const e=za(o);let t=parseFloat(e.width)||0,n=parseFloat(e.height)||0;const r=pi(o),a=r?o.offsetWidth:t,i=r?o.offsetHeight:n,s=xg(t)!==a||xg(n)!==i;return s&&(t=a,n=i),{width:t,height:n,$:s}}function gy(o){return Ua(o)?o:o.contextElement}function nd(o){const e=gy(o);if(!pi(e))return li(1);const t=e.getBoundingClientRect(),{width:n,height:r,$:a}=e4(e);let i=(a?xg(t.width):t.width)/n,s=(a?xg(t.height):t.height)/r;return(!i||!Number.isFinite(i))&&(i=1),(!s||!Number.isFinite(s))&&(s=1),{x:i,y:s}}const C8=li(0);function t4(o){const e=Qo(o);return!my()||!e.visualViewport?C8:{x:e.visualViewport.offsetLeft,y:e.visualViewport.offsetTop}}function E8(o,e,t){return e===void 0&&(e=!1),!t||e&&t!==Qo(o)?!1:e}function Ec(o,e,t,n){e===void 0&&(e=!1),t===void 0&&(t=!1);const r=o.getBoundingClientRect(),a=gy(o);let i=li(1);e&&(n?Ua(n)&&(i=nd(n)):i=nd(o));const s=E8(a,t,n)?t4(a):li(0);let c=(r.left+s.x)/i.x,u=(r.top+s.y)/i.y,h=r.width/i.x,f=r.height/i.y;if(a){const m=Qo(a),g=n&&Ua(n)?Qo(n):n;let A=m,_=Jx(A);for(;_&&n&&g!==A;){const x=nd(_),C=_.getBoundingClientRect(),b=za(_),y=C.left+(_.clientLeft+parseFloat(b.paddingLeft))*x.x,M=C.top+(_.clientTop+parseFloat(b.paddingTop))*x.y;c*=x.x,u*=x.y,h*=x.x,f*=x.y,c+=y,u+=M,A=Qo(_),_=Jx(A)}}return bg({width:h,height:f,x:c,y:u})}function vy(o,e){const t=sv(o).scrollLeft;return e?e.left+t:Ec(Ai(o)).left+t}function n4(o,e,t){t===void 0&&(t=!1);const n=o.getBoundingClientRect(),r=n.left+e.scrollLeft-(t?0:vy(o,n)),a=n.top+e.scrollTop;return{x:r,y:a}}function M8(o){let{elements:e,rect:t,offsetParent:n,strategy:r}=o;const a=r==="fixed",i=Ai(n),s=e?iv(e.floating):!1;if(n===i||s&&a)return t;let c={scrollLeft:0,scrollTop:0},u=li(1);const h=li(0),f=pi(n);if((f||!f&&!a)&&((Md(n)!=="body"||rp(i))&&(c=sv(n)),pi(n))){const g=Ec(n);u=nd(n),h.x=g.x+n.clientLeft,h.y=g.y+n.clientTop}const m=i&&!f&&!a?n4(i,c,!0):li(0);return{width:t.width*u.x,height:t.height*u.y,x:t.x*u.x-c.scrollLeft*u.x+h.x+m.x,y:t.y*u.y-c.scrollTop*u.y+h.y+m.y}}function w8(o){return Array.from(o.getClientRects())}function T8(o){const e=Ai(o),t=sv(o),n=o.ownerDocument.body,r=Vo(e.scrollWidth,e.clientWidth,n.scrollWidth,n.clientWidth),a=Vo(e.scrollHeight,e.clientHeight,n.scrollHeight,n.clientHeight);let i=-t.scrollLeft+vy(o);const s=-t.scrollTop;return za(n).direction==="rtl"&&(i+=Vo(e.clientWidth,n.clientWidth)-r),{width:r,height:a,x:i,y:s}}function R8(o,e){const t=Qo(o),n=Ai(o),r=t.visualViewport;let a=n.clientWidth,i=n.clientHeight,s=0,c=0;if(r){a=r.width,i=r.height;const u=my();(!u||u&&e==="fixed")&&(s=r.offsetLeft,c=r.offsetTop)}return{width:a,height:i,x:s,y:c}}function I8(o,e){const t=Ec(o,!0,e==="fixed"),n=t.top+o.clientTop,r=t.left+o.clientLeft,a=pi(o)?nd(o):li(1),i=o.clientWidth*a.x,s=o.clientHeight*a.y,c=r*a.x,u=n*a.y;return{width:i,height:s,x:c,y:u}}function AE(o,e,t){let n;if(e==="viewport")n=R8(o,t);else if(e==="document")n=T8(Ai(o));else if(Ua(e))n=I8(e,t);else{const r=t4(o);n={x:e.x-r.x,y:e.y-r.y,width:e.width,height:e.height}}return bg(n)}function r4(o,e){const t=cl(o);return t===e||!Ua(t)||ud(t)?!1:za(t).position==="fixed"||r4(t,e)}function L8(o,e){const t=e.get(o);if(t)return t;let n=Ih(o,[],!1).filter(s=>Ua(s)&&Md(s)!=="body"),r=null;const a=za(o).position==="fixed";let i=a?cl(o):o;for(;Ua(i)&&!ud(i);){const s=za(i),c=py(i);!c&&s.position==="fixed"&&(r=null),(a?!c&&!r:!c&&s.position==="static"&&!!r&&["absolute","fixed"].includes(r.position)||rp(i)&&!c&&r4(o,i))?n=n.filter(h=>h!==i):r=s,i=cl(i)}return e.set(o,n),n}function B8(o){let{element:e,boundary:t,rootBoundary:n,strategy:r}=o;const i=[...t==="clippingAncestors"?iv(e)?[]:L8(e,this._c):[].concat(t),n],s=i[0],c=i.reduce((u,h)=>{const f=AE(e,h,r);return u.top=Vo(f.top,u.top),u.right=sl(f.right,u.right),u.bottom=sl(f.bottom,u.bottom),u.left=Vo(f.left,u.left),u},AE(e,s,r));return{width:c.right-c.left,height:c.bottom-c.top,x:c.left,y:c.top}}function P8(o){const{width:e,height:t}=e4(o);return{width:e,height:t}}function N8(o,e,t){const n=pi(e),r=Ai(e),a=t==="fixed",i=Ec(o,!0,a,e);let s={scrollLeft:0,scrollTop:0};const c=li(0);if(n||!n&&!a)if((Md(e)!=="body"||rp(r))&&(s=sv(e)),n){const m=Ec(e,!0,a,e);c.x=m.x+e.clientLeft,c.y=m.y+e.clientTop}else r&&(c.x=vy(r));const u=r&&!n&&!a?n4(r,s):li(0),h=i.left+s.scrollLeft-c.x-u.x,f=i.top+s.scrollTop-c.y-u.y;return{x:h,y:f,width:i.width,height:i.height}}function X_(o){return za(o).position==="static"}function xE(o,e){if(!pi(o)||za(o).position==="fixed")return null;if(e)return e(o);let t=o.offsetParent;return Ai(o)===t&&(t=t.ownerDocument.body),t}function o4(o,e){const t=Qo(o);if(iv(o))return t;if(!pi(o)){let r=cl(o);for(;r&&!ud(r);){if(Ua(r)&&!X_(r))return r;r=cl(r)}return t}let n=xE(o,e);for(;n&&b8(n)&&X_(n);)n=xE(n,e);return n&&ud(n)&&X_(n)&&!py(n)?t:n||S8(o)||t}const D8=async function(o){const e=this.getOffsetParent||o4,t=this.getDimensions,n=await t(o.floating);return{reference:N8(o.reference,await e(o.floating),o.strategy),floating:{x:0,y:0,width:n.width,height:n.height}}};function O8(o){return za(o).direction==="rtl"}const F8={convertOffsetParentRelativeRectToViewportRelativeRect:M8,getDocumentElement:Ai,getClippingRect:B8,getOffsetParent:o4,getElementRects:D8,getClientRects:w8,getDimensions:P8,getScale:nd,isElement:Ua,isRTL:O8};function a4(o,e){return o.x===e.x&&o.y===e.y&&o.width===e.width&&o.height===e.height}function U8(o,e){let t=null,n;const r=Ai(o);function a(){var s;clearTimeout(n),(s=t)==null||s.disconnect(),t=null}function i(s,c){s===void 0&&(s=!1),c===void 0&&(c=1),a();const u=o.getBoundingClientRect(),{left:h,top:f,width:m,height:g}=u;if(s||e(),!m||!g)return;const A=wm(f),_=wm(r.clientWidth-(h+m)),x=wm(r.clientHeight-(f+g)),C=wm(h),y={rootMargin:-A+"px "+-_+"px "+-x+"px "+-C+"px",threshold:Vo(0,sl(1,c))||1};let M=!0;function R(T){const w=T[0].intersectionRatio;if(w!==c){if(!M)return i();w?i(!1,w):n=setTimeout(()=>{i(!1,1e-7)},1e3)}w===1&&!a4(u,o.getBoundingClientRect())&&i(),M=!1}try{t=new IntersectionObserver(R,{...y,root:r.ownerDocument})}catch{t=new IntersectionObserver(R,y)}t.observe(o)}return i(!0),a}function i4(o,e,t,n){n===void 0&&(n={});const{ancestorScroll:r=!0,ancestorResize:a=!0,elementResize:i=typeof ResizeObserver=="function",layoutShift:s=typeof IntersectionObserver=="function",animationFrame:c=!1}=n,u=gy(o),h=r||a?[...u?Ih(u):[],...Ih(e)]:[];h.forEach(C=>{r&&C.addEventListener("scroll",t,{passive:!0}),a&&C.addEventListener("resize",t)});const f=u&&s?U8(u,t):null;let m=-1,g=null;i&&(g=new ResizeObserver(C=>{let[b]=C;b&&b.target===u&&g&&(g.unobserve(e),cancelAnimationFrame(m),m=requestAnimationFrame(()=>{var y;(y=g)==null||y.observe(e)})),t()}),u&&!c&&g.observe(u),g.observe(e));let A,_=c?Ec(o):null;c&&x();function x(){const C=Ec(o);_&&!a4(_,C)&&t(),_=C,A=requestAnimationFrame(x)}return t(),()=>{var C;h.forEach(b=>{r&&b.removeEventListener("scroll",t),a&&b.removeEventListener("resize",t)}),f==null||f(),(C=g)==null||C.disconnect(),g=null,c&&cancelAnimationFrame(A)}}const z8=_8,V8=A8,k8=m8,G8=y8,Q8=g8,yE=p8,H8=x8,W8=(o,e,t)=>{const n=new Map,r={platform:F8,...t},a={...r.platform,_c:n};return h8(o,e,{...r,platform:a})};var ag=typeof document<"u"?j.useLayoutEffect:j.useEffect;function Sg(o,e){if(o===e)return!0;if(typeof o!=typeof e)return!1;if(typeof o=="function"&&o.toString()===e.toString())return!0;let t,n,r;if(o&&e&&typeof o=="object"){if(Array.isArray(o)){if(t=o.length,t!==e.length)return!1;for(n=t;n--!==0;)if(!Sg(o[n],e[n]))return!1;return!0}if(r=Object.keys(o),t=r.length,t!==Object.keys(e).length)return!1;for(n=t;n--!==0;)if(!{}.hasOwnProperty.call(e,r[n]))return!1;for(n=t;n--!==0;){const a=r[n];if(!(a==="_owner"&&o.$$typeof)&&!Sg(o[a],e[a]))return!1}return!0}return o!==o&&e!==e}function s4(o){return typeof window>"u"?1:(o.ownerDocument.defaultView||window).devicePixelRatio||1}function bE(o,e){const t=s4(o);return Math.round(e*t)/t}function q_(o){const e=j.useRef(o);return ag(()=>{e.current=o}),e}function l4(o){o===void 0&&(o={});const{placement:e="bottom",strategy:t="absolute",middleware:n=[],platform:r,elements:{reference:a,floating:i}={},transform:s=!0,whileElementsMounted:c,open:u}=o,[h,f]=j.useState({x:0,y:0,strategy:t,placement:e,middlewareData:{},isPositioned:!1}),[m,g]=j.useState(n);Sg(m,n)||g(n);const[A,_]=j.useState(null),[x,C]=j.useState(null),b=j.useCallback(ie=>{ie!==T.current&&(T.current=ie,_(ie))},[]),y=j.useCallback(ie=>{ie!==w.current&&(w.current=ie,C(ie))},[]),M=a||A,R=i||x,T=j.useRef(null),w=j.useRef(null),D=j.useRef(h),z=c!=null,F=q_(c),O=q_(r),q=q_(u),ne=j.useCallback(()=>{if(!T.current||!w.current)return;const ie={placement:e,strategy:t,middleware:m};O.current&&(ie.platform=O.current),W8(T.current,w.current,ie).then(L=>{const U={...L,isPositioned:q.current!==!1};$.current&&!Sg(D.current,U)&&(D.current=U,bd.flushSync(()=>{f(U)}))})},[m,e,t,O,q]);ag(()=>{u===!1&&D.current.isPositioned&&(D.current.isPositioned=!1,f(ie=>({...ie,isPositioned:!1})))},[u]);const $=j.useRef(!1);ag(()=>($.current=!0,()=>{$.current=!1}),[]),ag(()=>{if(M&&(T.current=M),R&&(w.current=R),M&&R){if(F.current)return F.current(M,R,ne);ne()}},[M,R,ne,F,z]);const he=j.useMemo(()=>({reference:T,floating:w,setReference:b,setFloating:y}),[b,y]),K=j.useMemo(()=>({reference:M,floating:R}),[M,R]),oe=j.useMemo(()=>{const ie={position:t,left:0,top:0};if(!K.floating)return ie;const L=bE(K.floating,h.x),U=bE(K.floating,h.y);return s?{...ie,transform:"translate("+L+"px, "+U+"px)",...s4(K.floating)>=1.5&&{willChange:"transform"}}:{position:t,left:L,top:U}},[t,s,K.floating,h.x,h.y]);return j.useMemo(()=>({...h,update:ne,refs:he,elements:K,floatingStyles:oe}),[h,ne,he,K,oe])}const Y8=o=>{function e(t){return{}.hasOwnProperty.call(t,"current")}return{name:"arrow",options:o,fn(t){const{element:n,padding:r}=typeof o=="function"?o(t):o;return n&&e(n)?n.current!=null?yE({element:n.current,padding:r}).fn(t):{}:n?yE({element:n,padding:r}).fn(t):{}}}},c4=(o,e)=>({...z8(o),options:[o,e]}),u4=(o,e)=>({...V8(o),options:[o,e]}),d4=(o,e)=>({...H8(o),options:[o,e]}),f4=(o,e)=>({...k8(o),options:[o,e]}),h4=(o,e)=>({...G8(o),options:[o,e]}),p4=(o,e)=>({...Q8(o),options:[o,e]}),m4=(o,e)=>({...Y8(o),options:[o,e]});var j8="Arrow",g4=j.forwardRef((o,e)=>{const{children:t,width:n=10,height:r=5,...a}=o;return ue.jsx(Yr.svg,{...a,ref:e,width:n,height:r,viewBox:"0 0 30 10",preserveAspectRatio:"none",children:o.asChild?t:ue.jsx("polygon",{points:"0,0 30,0 15,10"})})});g4.displayName=j8;var X8=g4;function q8(o){const[e,t]=j.useState(void 0);return Cc(()=>{if(o){t({width:o.offsetWidth,height:o.offsetHeight});const n=new ResizeObserver(r=>{if(!Array.isArray(r)||!r.length)return;const a=r[0];let i,s;if("borderBoxSize"in a){const c=a.borderBoxSize,u=Array.isArray(c)?c[0]:c;i=u.inlineSize,s=u.blockSize}else i=o.offsetWidth,s=o.offsetHeight;t({width:i,height:s})});return n.observe(o,{box:"border-box"}),()=>n.unobserve(o)}else t(void 0)},[o]),e}var _y="Popper",[v4,_4]=np(_y),[Z8,A4]=v4(_y),x4=o=>{const{__scopePopper:e,children:t}=o,[n,r]=j.useState(null);return ue.jsx(Z8,{scope:e,anchor:n,onAnchorChange:r,children:t})};x4.displayName=_y;var y4="PopperAnchor",b4=j.forwardRef((o,e)=>{const{__scopePopper:t,virtualRef:n,...r}=o,a=A4(y4,t),i=j.useRef(null),s=Fa(e,i);return j.useEffect(()=>{a.onAnchorChange((n==null?void 0:n.current)||i.current)}),n?null:ue.jsx(Yr.div,{...r,ref:s})});b4.displayName=y4;var Ay="PopperContent",[K8,$8]=v4(Ay),S4=j.forwardRef((o,e)=>{var G,ee,X,W,Y,P;const{__scopePopper:t,side:n="bottom",sideOffset:r=0,align:a="center",alignOffset:i=0,arrowPadding:s=0,avoidCollisions:c=!0,collisionBoundary:u=[],collisionPadding:h=0,sticky:f="partial",hideWhenDetached:m=!1,updatePositionStrategy:g="optimized",onPlaced:A,..._}=o,x=A4(Ay,t),[C,b]=j.useState(null),y=Fa(e,Q=>b(Q)),[M,R]=j.useState(null),T=q8(M),w=(T==null?void 0:T.width)??0,D=(T==null?void 0:T.height)??0,z=n+(a!=="center"?"-"+a:""),F=typeof h=="number"?h:{top:0,right:0,bottom:0,left:0,...h},O=Array.isArray(u)?u:[u],q=O.length>0,ne={padding:F,boundary:O.filter(eF),altBoundary:q},{refs:$,floatingStyles:he,placement:K,isPositioned:oe,middlewareData:ie}=l4({strategy:"fixed",placement:z,whileElementsMounted:(...Q)=>i4(...Q,{animationFrame:g==="always"}),elements:{reference:x.anchor},middleware:[c4({mainAxis:r+D,alignmentAxis:i}),c&&u4({mainAxis:!0,crossAxis:!1,limiter:f==="partial"?d4():void 0,...ne}),c&&f4({...ne}),h4({...ne,apply:({elements:Q,rects:I,availableWidth:N,availableHeight:se})=>{const{width:ce,height:fe}=I.reference,ve=Q.floating.style;ve.setProperty("--radix-popper-available-width",`${N}px`),ve.setProperty("--radix-popper-available-height",`${se}px`),ve.setProperty("--radix-popper-anchor-width",`${ce}px`),ve.setProperty("--radix-popper-anchor-height",`${fe}px`)}}),M&&m4({element:M,padding:s}),tF({arrowWidth:w,arrowHeight:D}),m&&p4({strategy:"referenceHidden",...ne})]}),[L,U]=M4(K),k=us(A);Cc(()=>{oe&&(k==null||k())},[oe,k]);const J=(G=ie.arrow)==null?void 0:G.x,de=(ee=ie.arrow)==null?void 0:ee.y,te=((X=ie.arrow)==null?void 0:X.centerOffset)!==0,[le,V]=j.useState();return Cc(()=>{C&&V(window.getComputedStyle(C).zIndex)},[C]),ue.jsx("div",{ref:$.setFloating,"data-radix-popper-content-wrapper":"",style:{...he,transform:oe?he.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:le,"--radix-popper-transform-origin":[(W=ie.transformOrigin)==null?void 0:W.x,(Y=ie.transformOrigin)==null?void 0:Y.y].join(" "),...((P=ie.hide)==null?void 0:P.referenceHidden)&&{visibility:"hidden",pointerEvents:"none"}},dir:o.dir,children:ue.jsx(K8,{scope:t,placedSide:L,onArrowChange:R,arrowX:J,arrowY:de,shouldHideArrow:te,children:ue.jsx(Yr.div,{"data-side":L,"data-align":U,..._,ref:y,style:{..._.style,animation:oe?void 0:"none"}})})})});S4.displayName=Ay;var C4="PopperArrow",J8={top:"bottom",right:"left",bottom:"top",left:"right"},E4=j.forwardRef(function(e,t){const{__scopePopper:n,...r}=e,a=$8(C4,n),i=J8[a.placedSide];return ue.jsx("span",{ref:a.onArrowChange,style:{position:"absolute",left:a.arrowX,top:a.arrowY,[i]:0,transformOrigin:{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[a.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[a.placedSide],visibility:a.shouldHideArrow?"hidden":void 0},children:ue.jsx(X8,{...r,ref:t,style:{...r.style,display:"block"}})})});E4.displayName=C4;function eF(o){return o!==null}var tF=o=>({name:"transformOrigin",options:o,fn(e){var x,C,b;const{placement:t,rects:n,middlewareData:r}=e,i=((x=r.arrow)==null?void 0:x.centerOffset)!==0,s=i?0:o.arrowWidth,c=i?0:o.arrowHeight,[u,h]=M4(t),f={start:"0%",center:"50%",end:"100%"}[h],m=(((C=r.arrow)==null?void 0:C.x)??0)+s/2,g=(((b=r.arrow)==null?void 0:b.y)??0)+c/2;let A="",_="";return u==="bottom"?(A=i?f:`${m}px`,_=`${-c}px`):u==="top"?(A=i?f:`${m}px`,_=`${n.floating.height+c}px`):u==="right"?(A=`${-c}px`,_=i?f:`${g}px`):u==="left"&&(A=`${n.floating.width+c}px`,_=i?f:`${g}px`),{data:{x:A,y:_}}}});function M4(o){const[e,t="center"]=o.split("-");return[e,t]}var nF=x4,w4=b4,rF=S4,oF=E4,aF="Portal",T4=j.forwardRef((o,e)=>{var s;const{container:t,...n}=o,[r,a]=j.useState(!1);Cc(()=>a(!0),[]);const i=t||r&&((s=globalThis==null?void 0:globalThis.document)==null?void 0:s.body);return i?hR.createPortal(ue.jsx(Yr.div,{...n,ref:e}),i):null});T4.displayName=aF;var iF=function(o){if(typeof document>"u")return null;var e=Array.isArray(o)?o[0]:o;return e.ownerDocument.body},du=new WeakMap,Tm=new WeakMap,Rm={},Z_=0,R4=function(o){return o&&(o.host||R4(o.parentNode))},sF=function(o,e){return e.map(function(t){if(o.contains(t))return t;var n=R4(t);return n&&o.contains(n)?n:(console.error("aria-hidden",t,"in not contained inside",o,". Doing nothing"),null)}).filter(function(t){return!!t})},lF=function(o,e,t,n){var r=sF(e,Array.isArray(o)?o:[o]);Rm[t]||(Rm[t]=new WeakMap);var a=Rm[t],i=[],s=new Set,c=new Set(r),u=function(f){!f||s.has(f)||(s.add(f),u(f.parentNode))};r.forEach(u);var h=function(f){!f||c.has(f)||Array.prototype.forEach.call(f.children,function(m){if(s.has(m))h(m);else try{var g=m.getAttribute(n),A=g!==null&&g!=="false",_=(du.get(m)||0)+1,x=(a.get(m)||0)+1;du.set(m,_),a.set(m,x),i.push(m),_===1&&A&&Tm.set(m,!0),x===1&&m.setAttribute(t,"true"),A||m.setAttribute(n,"true")}catch(C){console.error("aria-hidden: cannot operate on ",m,C)}})};return h(e),s.clear(),Z_++,function(){i.forEach(function(f){var m=du.get(f)-1,g=a.get(f)-1;du.set(f,m),a.set(f,g),m||(Tm.has(f)||f.removeAttribute(n),Tm.delete(f)),g||f.removeAttribute(t)}),Z_--,Z_||(du=new WeakMap,du=new WeakMap,Tm=new WeakMap,Rm={})}},I4=function(o,e,t){t===void 0&&(t="data-aria-hidden");var n=Array.from(Array.isArray(o)?o:[o]),r=iF(o);return r?(n.push.apply(n,Array.from(r.querySelectorAll("[aria-live]"))),lF(n,r,t,"aria-hidden")):function(){return null}},oi=function(){return oi=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])}return e},oi.apply(this,arguments)};function L4(o,e){var t={};for(var n in o)Object.prototype.hasOwnProperty.call(o,n)&&e.indexOf(n)<0&&(t[n]=o[n]);if(o!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,n=Object.getOwnPropertySymbols(o);r<n.length;r++)e.indexOf(n[r])<0&&Object.prototype.propertyIsEnumerable.call(o,n[r])&&(t[n[r]]=o[n[r]]);return t}function cF(o,e,t){if(t||arguments.length===2)for(var n=0,r=e.length,a;n<r;n++)(a||!(n in e))&&(a||(a=Array.prototype.slice.call(e,0,n)),a[n]=e[n]);return o.concat(a||Array.prototype.slice.call(e))}var ig="right-scroll-bar-position",sg="width-before-scroll-bar",uF="with-scroll-bars-hidden",dF="--removed-body-scroll-bar-size";function K_(o,e){return typeof o=="function"?o(e):o&&(o.current=e),o}function fF(o,e){var t=j.useState(function(){return{value:o,callback:e,facade:{get current(){return t.value},set current(n){var r=t.value;r!==n&&(t.value=n,t.callback(n,r))}}}})[0];return t.callback=e,t.facade}var hF=typeof window<"u"?j.useLayoutEffect:j.useEffect,SE=new WeakMap;function pF(o,e){var t=fF(null,function(n){return o.forEach(function(r){return K_(r,n)})});return hF(function(){var n=SE.get(t);if(n){var r=new Set(n),a=new Set(o),i=t.current;r.forEach(function(s){a.has(s)||K_(s,null)}),a.forEach(function(s){r.has(s)||K_(s,i)})}SE.set(t,o)},[o]),t}function mF(o){return o}function gF(o,e){e===void 0&&(e=mF);var t=[],n=!1,r={read:function(){if(n)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return t.length?t[t.length-1]:o},useMedium:function(a){var i=e(a,n);return t.push(i),function(){t=t.filter(function(s){return s!==i})}},assignSyncMedium:function(a){for(n=!0;t.length;){var i=t;t=[],i.forEach(a)}t={push:function(s){return a(s)},filter:function(){return t}}},assignMedium:function(a){n=!0;var i=[];if(t.length){var s=t;t=[],s.forEach(a),i=t}var c=function(){var h=i;i=[],h.forEach(a)},u=function(){return Promise.resolve().then(c)};u(),t={push:function(h){i.push(h),u()},filter:function(h){return i=i.filter(h),t}}}};return r}function vF(o){o===void 0&&(o={});var e=gF(null);return e.options=oi({async:!0,ssr:!1},o),e}var B4=function(o){var e=o.sideCar,t=L4(o,["sideCar"]);if(!e)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var n=e.read();if(!n)throw new Error("Sidecar medium not found");return j.createElement(n,oi({},t))};B4.isSideCarExport=!0;function _F(o,e){return o.useMedium(e),B4}var P4=vF(),$_=function(){},lv=j.forwardRef(function(o,e){var t=j.useRef(null),n=j.useState({onScrollCapture:$_,onWheelCapture:$_,onTouchMoveCapture:$_}),r=n[0],a=n[1],i=o.forwardProps,s=o.children,c=o.className,u=o.removeScrollBar,h=o.enabled,f=o.shards,m=o.sideCar,g=o.noIsolation,A=o.inert,_=o.allowPinchZoom,x=o.as,C=x===void 0?"div":x,b=o.gapMode,y=L4(o,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noIsolation","inert","allowPinchZoom","as","gapMode"]),M=m,R=pF([t,e]),T=oi(oi({},y),r);return j.createElement(j.Fragment,null,h&&j.createElement(M,{sideCar:P4,removeScrollBar:u,shards:f,noIsolation:g,inert:A,setCallbacks:a,allowPinchZoom:!!_,lockRef:t,gapMode:b}),i?j.cloneElement(j.Children.only(s),oi(oi({},T),{ref:R})):j.createElement(C,oi({},T,{className:c,ref:R}),s))});lv.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1};lv.classNames={fullWidth:sg,zeroRight:ig};var AF=function(){if(typeof __webpack_nonce__<"u")return __webpack_nonce__};function xF(){if(!document)return null;var o=document.createElement("style");o.type="text/css";var e=AF();return e&&o.setAttribute("nonce",e),o}function yF(o,e){o.styleSheet?o.styleSheet.cssText=e:o.appendChild(document.createTextNode(e))}function bF(o){var e=document.head||document.getElementsByTagName("head")[0];e.appendChild(o)}var SF=function(){var o=0,e=null;return{add:function(t){o==0&&(e=xF())&&(yF(e,t),bF(e)),o++},remove:function(){o--,!o&&e&&(e.parentNode&&e.parentNode.removeChild(e),e=null)}}},CF=function(){var o=SF();return function(e,t){j.useEffect(function(){return o.add(e),function(){o.remove()}},[e&&t])}},N4=function(){var o=CF(),e=function(t){var n=t.styles,r=t.dynamic;return o(n,r),null};return e},EF={left:0,top:0,right:0,gap:0},J_=function(o){return parseInt(o||"",10)||0},MF=function(o){var e=window.getComputedStyle(document.body),t=e[o==="padding"?"paddingLeft":"marginLeft"],n=e[o==="padding"?"paddingTop":"marginTop"],r=e[o==="padding"?"paddingRight":"marginRight"];return[J_(t),J_(n),J_(r)]},wF=function(o){if(o===void 0&&(o="margin"),typeof window>"u")return EF;var e=MF(o),t=document.documentElement.clientWidth,n=window.innerWidth;return{left:e[0],top:e[1],right:e[2],gap:Math.max(0,n-t+e[2]-e[0])}},TF=N4(),rd="data-scroll-locked",RF=function(o,e,t,n){var r=o.left,a=o.top,i=o.right,s=o.gap;return t===void 0&&(t="margin"),`
  .`.concat(uF,` {
   overflow: hidden `).concat(n,`;
   padding-right: `).concat(s,"px ").concat(n,`;
  }
  body[`).concat(rd,`] {
    overflow: hidden `).concat(n,`;
    overscroll-behavior: contain;
    `).concat([e&&"position: relative ".concat(n,";"),t==="margin"&&`
    padding-left: `.concat(r,`px;
    padding-top: `).concat(a,`px;
    padding-right: `).concat(i,`px;
    margin-left:0;
    margin-top:0;
    margin-right: `).concat(s,"px ").concat(n,`;
    `),t==="padding"&&"padding-right: ".concat(s,"px ").concat(n,";")].filter(Boolean).join(""),`
  }
  
  .`).concat(ig,` {
    right: `).concat(s,"px ").concat(n,`;
  }
  
  .`).concat(sg,` {
    margin-right: `).concat(s,"px ").concat(n,`;
  }
  
  .`).concat(ig," .").concat(ig,` {
    right: 0 `).concat(n,`;
  }
  
  .`).concat(sg," .").concat(sg,` {
    margin-right: 0 `).concat(n,`;
  }
  
  body[`).concat(rd,`] {
    `).concat(dF,": ").concat(s,`px;
  }
`)},CE=function(){var o=parseInt(document.body.getAttribute(rd)||"0",10);return isFinite(o)?o:0},IF=function(){j.useEffect(function(){return document.body.setAttribute(rd,(CE()+1).toString()),function(){var o=CE()-1;o<=0?document.body.removeAttribute(rd):document.body.setAttribute(rd,o.toString())}},[])},LF=function(o){var e=o.noRelative,t=o.noImportant,n=o.gapMode,r=n===void 0?"margin":n;IF();var a=j.useMemo(function(){return wF(r)},[r]);return j.createElement(TF,{styles:RF(a,!e,r,t?"":"!important")})},e2=!1;if(typeof window<"u")try{var Im=Object.defineProperty({},"passive",{get:function(){return e2=!0,!0}});window.addEventListener("test",Im,Im),window.removeEventListener("test",Im,Im)}catch{e2=!1}var fu=e2?{passive:!1}:!1,BF=function(o){return o.tagName==="TEXTAREA"},D4=function(o,e){if(!(o instanceof Element))return!1;var t=window.getComputedStyle(o);return t[e]!=="hidden"&&!(t.overflowY===t.overflowX&&!BF(o)&&t[e]==="visible")},PF=function(o){return D4(o,"overflowY")},NF=function(o){return D4(o,"overflowX")},EE=function(o,e){var t=e.ownerDocument,n=e;do{typeof ShadowRoot<"u"&&n instanceof ShadowRoot&&(n=n.host);var r=O4(o,n);if(r){var a=F4(o,n),i=a[1],s=a[2];if(i>s)return!0}n=n.parentNode}while(n&&n!==t.body);return!1},DF=function(o){var e=o.scrollTop,t=o.scrollHeight,n=o.clientHeight;return[e,t,n]},OF=function(o){var e=o.scrollLeft,t=o.scrollWidth,n=o.clientWidth;return[e,t,n]},O4=function(o,e){return o==="v"?PF(e):NF(e)},F4=function(o,e){return o==="v"?DF(e):OF(e)},FF=function(o,e){return o==="h"&&e==="rtl"?-1:1},UF=function(o,e,t,n,r){var a=FF(o,window.getComputedStyle(e).direction),i=a*n,s=t.target,c=e.contains(s),u=!1,h=i>0,f=0,m=0;do{var g=F4(o,s),A=g[0],_=g[1],x=g[2],C=_-x-a*A;(A||C)&&O4(o,s)&&(f+=C,m+=A),s instanceof ShadowRoot?s=s.host:s=s.parentNode}while(!c&&s!==document.body||c&&(e.contains(s)||e===s));return(h&&Math.abs(f)<1||!h&&Math.abs(m)<1)&&(u=!0),u},Lm=function(o){return"changedTouches"in o?[o.changedTouches[0].clientX,o.changedTouches[0].clientY]:[0,0]},ME=function(o){return[o.deltaX,o.deltaY]},wE=function(o){return o&&"current"in o?o.current:o},zF=function(o,e){return o[0]===e[0]&&o[1]===e[1]},VF=function(o){return`
  .block-interactivity-`.concat(o,` {pointer-events: none;}
  .allow-interactivity-`).concat(o,` {pointer-events: all;}
`)},kF=0,hu=[];function GF(o){var e=j.useRef([]),t=j.useRef([0,0]),n=j.useRef(),r=j.useState(kF++)[0],a=j.useState(N4)[0],i=j.useRef(o);j.useEffect(function(){i.current=o},[o]),j.useEffect(function(){if(o.inert){document.body.classList.add("block-interactivity-".concat(r));var _=cF([o.lockRef.current],(o.shards||[]).map(wE),!0).filter(Boolean);return _.forEach(function(x){return x.classList.add("allow-interactivity-".concat(r))}),function(){document.body.classList.remove("block-interactivity-".concat(r)),_.forEach(function(x){return x.classList.remove("allow-interactivity-".concat(r))})}}},[o.inert,o.lockRef.current,o.shards]);var s=j.useCallback(function(_,x){if("touches"in _&&_.touches.length===2||_.type==="wheel"&&_.ctrlKey)return!i.current.allowPinchZoom;var C=Lm(_),b=t.current,y="deltaX"in _?_.deltaX:b[0]-C[0],M="deltaY"in _?_.deltaY:b[1]-C[1],R,T=_.target,w=Math.abs(y)>Math.abs(M)?"h":"v";if("touches"in _&&w==="h"&&T.type==="range")return!1;var D=EE(w,T);if(!D)return!0;if(D?R=w:(R=w==="v"?"h":"v",D=EE(w,T)),!D)return!1;if(!n.current&&"changedTouches"in _&&(y||M)&&(n.current=R),!R)return!0;var z=n.current||R;return UF(z,x,_,z==="h"?y:M)},[]),c=j.useCallback(function(_){var x=_;if(!(!hu.length||hu[hu.length-1]!==a)){var C="deltaY"in x?ME(x):Lm(x),b=e.current.filter(function(R){return R.name===x.type&&(R.target===x.target||x.target===R.shadowParent)&&zF(R.delta,C)})[0];if(b&&b.should){x.cancelable&&x.preventDefault();return}if(!b){var y=(i.current.shards||[]).map(wE).filter(Boolean).filter(function(R){return R.contains(x.target)}),M=y.length>0?s(x,y[0]):!i.current.noIsolation;M&&x.cancelable&&x.preventDefault()}}},[]),u=j.useCallback(function(_,x,C,b){var y={name:_,delta:x,target:C,should:b,shadowParent:QF(C)};e.current.push(y),setTimeout(function(){e.current=e.current.filter(function(M){return M!==y})},1)},[]),h=j.useCallback(function(_){t.current=Lm(_),n.current=void 0},[]),f=j.useCallback(function(_){u(_.type,ME(_),_.target,s(_,o.lockRef.current))},[]),m=j.useCallback(function(_){u(_.type,Lm(_),_.target,s(_,o.lockRef.current))},[]);j.useEffect(function(){return hu.push(a),o.setCallbacks({onScrollCapture:f,onWheelCapture:f,onTouchMoveCapture:m}),document.addEventListener("wheel",c,fu),document.addEventListener("touchmove",c,fu),document.addEventListener("touchstart",h,fu),function(){hu=hu.filter(function(_){return _!==a}),document.removeEventListener("wheel",c,fu),document.removeEventListener("touchmove",c,fu),document.removeEventListener("touchstart",h,fu)}},[]);var g=o.removeScrollBar,A=o.inert;return j.createElement(j.Fragment,null,A?j.createElement(a,{styles:VF(r)}):null,g?j.createElement(LF,{gapMode:o.gapMode}):null)}function QF(o){for(var e=null;o!==null;)o instanceof ShadowRoot&&(e=o.host,o=o.host),o=o.parentNode;return e}const HF=_F(P4,GF);var xy=j.forwardRef(function(o,e){return j.createElement(lv,oi({},o,{ref:e,sideCar:HF}))});xy.classNames=lv.classNames;var yy="Popover",[U4,kie]=np(yy,[_4]),op=_4(),[WF,gl]=U4(yy),z4=o=>{const{__scopePopover:e,children:t,open:n,defaultOpen:r,onOpenChange:a,modal:i=!1}=o,s=op(e),c=j.useRef(null),[u,h]=j.useState(!1),[f=!1,m]=ay({prop:n,defaultProp:r,onChange:a});return ue.jsx(nF,{...s,children:ue.jsx(WF,{scope:e,contentId:oy(),triggerRef:c,open:f,onOpenChange:m,onOpenToggle:j.useCallback(()=>m(g=>!g),[m]),hasCustomAnchor:u,onCustomAnchorAdd:j.useCallback(()=>h(!0),[]),onCustomAnchorRemove:j.useCallback(()=>h(!1),[]),modal:i,children:t})})};z4.displayName=yy;var V4="PopoverAnchor",YF=j.forwardRef((o,e)=>{const{__scopePopover:t,...n}=o,r=gl(V4,t),a=op(t),{onCustomAnchorAdd:i,onCustomAnchorRemove:s}=r;return j.useEffect(()=>(i(),()=>s()),[i,s]),ue.jsx(w4,{...a,...n,ref:e})});YF.displayName=V4;var k4="PopoverTrigger",G4=j.forwardRef((o,e)=>{const{__scopePopover:t,...n}=o,r=gl(k4,t),a=op(t),i=Fa(e,r.triggerRef),s=ue.jsx(Yr.button,{type:"button","aria-haspopup":"dialog","aria-expanded":r.open,"aria-controls":r.contentId,"data-state":j4(r.open),...n,ref:i,onClick:Or(o.onClick,r.onOpenToggle)});return r.hasCustomAnchor?s:ue.jsx(w4,{asChild:!0,...a,children:s})});G4.displayName=k4;var by="PopoverPortal",[jF,XF]=U4(by,{forceMount:void 0}),Q4=o=>{const{__scopePopover:e,forceMount:t,children:n,container:r}=o,a=gl(by,e);return ue.jsx(jF,{scope:e,forceMount:t,children:ue.jsx(nv,{present:t||a.open,children:ue.jsx(T4,{asChild:!0,container:r,children:n})})})};Q4.displayName=by;var dd="PopoverContent",H4=j.forwardRef((o,e)=>{const t=XF(dd,o.__scopePopover),{forceMount:n=t.forceMount,...r}=o,a=gl(dd,o.__scopePopover);return ue.jsx(nv,{present:n||a.open,children:a.modal?ue.jsx(qF,{...r,ref:e}):ue.jsx(ZF,{...r,ref:e})})});H4.displayName=dd;var qF=j.forwardRef((o,e)=>{const t=gl(dd,o.__scopePopover),n=j.useRef(null),r=Fa(e,n),a=j.useRef(!1);return j.useEffect(()=>{const i=n.current;if(i)return I4(i)},[]),ue.jsx(xy,{as:cd,allowPinchZoom:!0,children:ue.jsx(W4,{...o,ref:r,trapFocus:t.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:Or(o.onCloseAutoFocus,i=>{var s;i.preventDefault(),a.current||(s=t.triggerRef.current)==null||s.focus()}),onPointerDownOutside:Or(o.onPointerDownOutside,i=>{const s=i.detail.originalEvent,c=s.button===0&&s.ctrlKey===!0,u=s.button===2||c;a.current=u},{checkForDefaultPrevented:!1}),onFocusOutside:Or(o.onFocusOutside,i=>i.preventDefault(),{checkForDefaultPrevented:!1})})})}),ZF=j.forwardRef((o,e)=>{const t=gl(dd,o.__scopePopover),n=j.useRef(!1),r=j.useRef(!1);return ue.jsx(W4,{...o,ref:e,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:a=>{var i,s;(i=o.onCloseAutoFocus)==null||i.call(o,a),a.defaultPrevented||(n.current||(s=t.triggerRef.current)==null||s.focus(),a.preventDefault()),n.current=!1,r.current=!1},onInteractOutside:a=>{var c,u;(c=o.onInteractOutside)==null||c.call(o,a),a.defaultPrevented||(n.current=!0,a.detail.originalEvent.type==="pointerdown"&&(r.current=!0));const i=a.target;((u=t.triggerRef.current)==null?void 0:u.contains(i))&&a.preventDefault(),a.detail.originalEvent.type==="focusin"&&r.current&&a.preventDefault()}})}),W4=j.forwardRef((o,e)=>{const{__scopePopover:t,trapFocus:n,onOpenAutoFocus:r,onCloseAutoFocus:a,disableOutsidePointerEvents:i,onEscapeKeyDown:s,onPointerDownOutside:c,onFocusOutside:u,onInteractOutside:h,...f}=o,m=gl(dd,t),g=op(t);return K6(),ue.jsx(qR,{asChild:!0,loop:!0,trapped:n,onMountAutoFocus:r,onUnmountAutoFocus:a,children:ue.jsx(jR,{asChild:!0,disableOutsidePointerEvents:i,onInteractOutside:h,onEscapeKeyDown:s,onPointerDownOutside:c,onFocusOutside:u,onDismiss:()=>m.onOpenChange(!1),children:ue.jsx(rF,{"data-state":j4(m.open),role:"dialog",id:m.contentId,...g,...f,ref:e,style:{...f.style,"--radix-popover-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-popover-content-available-width":"var(--radix-popper-available-width)","--radix-popover-content-available-height":"var(--radix-popper-available-height)","--radix-popover-trigger-width":"var(--radix-popper-anchor-width)","--radix-popover-trigger-height":"var(--radix-popper-anchor-height)"}})})})}),Y4="PopoverClose",KF=j.forwardRef((o,e)=>{const{__scopePopover:t,...n}=o,r=gl(Y4,t);return ue.jsx(Yr.button,{type:"button",...n,ref:e,onClick:Or(o.onClick,()=>r.onOpenChange(!1))})});KF.displayName=Y4;var $F="PopoverArrow",JF=j.forwardRef((o,e)=>{const{__scopePopover:t,...n}=o,r=op(t);return ue.jsx(oF,{...r,...n,ref:e})});JF.displayName=$F;function j4(o){return o?"open":"closed"}var e7=z4,t7=G4,n7=Q4,r7=H4;function o7({...o}){return ue.jsx(e7,{"data-slot":"popover",...o})}function a7({...o}){return ue.jsx(t7,{"data-slot":"popover-trigger",...o})}function i7({className:o,align:e="center",sideOffset:t=4,...n}){return ue.jsx(n7,{children:ue.jsx(r7,{"data-slot":"popover-content",align:e,sideOffset:t,className:jn("bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 w-72 origin-(--radix-popover-content-transform-origin) rounded-md border p-4 shadow-md outline-hidden",o),...n})})}function s7({className:o,type:e,...t}){return ue.jsx("input",{type:e,"data-slot":"input",className:jn("file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground dark:bg-input/30 border-input flex h-9 w-full min-w-0 rounded-md border bg-transparent px-3 py-1 text-base shadow-xs transition-[color,box-shadow] outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm","focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]","aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",o),...t})}const t2=j.forwardRef(({disabled:o,value:e,onChange:t,onBlur:n,name:r,className:a,...i},s)=>{const c=V6(s),[u,h]=j.useState(!1),f=j.useMemo(()=>e||"#FFFFFF",[e]);return ue.jsxs(o7,{onOpenChange:h,open:u,children:[ue.jsx(a7,{asChild:!0,disabled:o,onBlur:n,children:ue.jsx(ov,{...i,className:jn("block",a),name:r,onClick:()=>{h(!0)},size:"icon",style:{backgroundColor:f},variant:"outline",children:ue.jsx("div",{})})}),ue.jsxs(i7,{className:"w-full",children:[ue.jsx(z6,{color:f,onChange:t}),ue.jsx(s7,{maxLength:7,onChange:m=>{var g;t((g=m==null?void 0:m.currentTarget)==null?void 0:g.value)},ref:c,value:f})]})]})});t2.displayName="ColorPicker";const X4=j.createContext(void 0),q4=()=>{const o=j.useContext(X4);if(!o)throw new Error("useColor must be used within a ColorProvider");return o},l7=({children:o})=>{const[e,t]=j.useState("#ffffff"),[n,r]=j.useState("#b52929"),[a,i]=j.useState(["#4c2897","#069a68","#4e5b7c","#871212"]),[s,c]=j.useState(["#4c2897","#069a68","#4e5b7c","#871212"]),u=f=>{t(f),c(m=>{const g=m.filter(_=>_!==f);return[f,...g].slice(0,4)})},h=f=>{r(f),i(m=>{const g=m.filter(_=>_!==f);return[f,...g].slice(0,4)})};return ue.jsx(X4.Provider,{value:{color:e,setColor:u,recentColors:s,backlightColor:n,setBacklightColors:h,recentBacklightColors:a},children:o})},n2=({value:o,setColor:e})=>{const t=j.useMemo(()=>o||"#FFFFFF",[o]);return ue.jsx(ov,{onClick:()=>{e(t)},size:"icon",style:{backgroundColor:t},variant:"outline",children:ue.jsx("div",{})})},eA=({colorList:o,setColor:e})=>ue.jsx("div",{className:"space-y-1 flex row space-x-4",children:o.map((t,n)=>ue.jsx(n2,{value:t,setColor:e},n))});function r2(o,[e,t]){return Math.min(t,Math.max(e,o))}function _n(o,e,{checkForDefaultPrevented:t=!0}={}){return function(r){if(o==null||o(r),t===!1||!r.defaultPrevented)return e==null?void 0:e(r)}}function cv(o,e=[]){let t=[];function n(a,i){const s=j.createContext(i),c=t.length;t=[...t,i];const u=f=>{var C;const{scope:m,children:g,...A}=f,_=((C=m==null?void 0:m[o])==null?void 0:C[c])||s,x=j.useMemo(()=>A,Object.values(A));return ue.jsx(_.Provider,{value:x,children:g})};u.displayName=a+"Provider";function h(f,m){var _;const g=((_=m==null?void 0:m[o])==null?void 0:_[c])||s,A=j.useContext(g);if(A)return A;if(i!==void 0)return i;throw new Error(`\`${f}\` must be used within \`${a}\``)}return[u,h]}const r=()=>{const a=t.map(i=>j.createContext(i));return function(s){const c=(s==null?void 0:s[o])||a;return j.useMemo(()=>({[`__scope${o}`]:{...s,[o]:c}}),[s,c])}};return r.scopeName=o,[n,c7(r,...e)]}function c7(...o){const e=o[0];if(o.length===1)return e;const t=()=>{const n=o.map(r=>({useScope:r(),scopeName:r.scopeName}));return function(a){const i=n.reduce((s,{useScope:c,scopeName:u})=>{const f=c(a)[`__scope${u}`];return{...s,...f}},{});return j.useMemo(()=>({[`__scope${e.scopeName}`]:i}),[i])}};return t.scopeName=e.scopeName,t}function TE(o,e){if(typeof o=="function")return o(e);o!=null&&(o.current=e)}function Sy(...o){return e=>{let t=!1;const n=o.map(r=>{const a=TE(r,e);return!t&&typeof a=="function"&&(t=!0),a});if(t)return()=>{for(let r=0;r<n.length;r++){const a=n[r];typeof a=="function"?a():TE(o[r],null)}}}}function Ln(...o){return j.useCallback(Sy(...o),o)}function Cg(o){const e=u7(o),t=j.forwardRef((n,r)=>{const{children:a,...i}=n,s=j.Children.toArray(a),c=s.find(f7);if(c){const u=c.props.children,h=s.map(f=>f===c?j.Children.count(u)>1?j.Children.only(null):j.isValidElement(u)?u.props.children:null:f);return ue.jsx(e,{...i,ref:r,children:j.isValidElement(u)?j.cloneElement(u,void 0,h):null})}return ue.jsx(e,{...i,ref:r,children:a})});return t.displayName=`${o}.Slot`,t}function u7(o){const e=j.forwardRef((t,n)=>{const{children:r,...a}=t;if(j.isValidElement(r)){const i=p7(r),s=h7(a,r.props);return r.type!==j.Fragment&&(s.ref=n?Sy(n,i):i),j.cloneElement(r,s)}return j.Children.count(r)>1?j.Children.only(null):null});return e.displayName=`${o}.SlotClone`,e}var d7=Symbol("radix.slottable");function f7(o){return j.isValidElement(o)&&typeof o.type=="function"&&"__radixId"in o.type&&o.type.__radixId===d7}function h7(o,e){const t={...e};for(const n in e){const r=o[n],a=e[n];/^on[A-Z]/.test(n)?r&&a?t[n]=(...s)=>{a(...s),r(...s)}:r&&(t[n]=r):n==="style"?t[n]={...r,...a}:n==="className"&&(t[n]=[r,a].filter(Boolean).join(" "))}return{...o,...t}}function p7(o){var n,r;let e=(n=Object.getOwnPropertyDescriptor(o.props,"ref"))==null?void 0:n.get,t=e&&"isReactWarning"in e&&e.isReactWarning;return t?o.ref:(e=(r=Object.getOwnPropertyDescriptor(o,"ref"))==null?void 0:r.get,t=e&&"isReactWarning"in e&&e.isReactWarning,t?o.props.ref:o.props.ref||o.ref)}function m7(o){const e=o+"CollectionProvider",[t,n]=cv(e),[r,a]=t(e,{collectionRef:{current:null},itemMap:new Map}),i=_=>{const{scope:x,children:C}=_,b=nt.useRef(null),y=nt.useRef(new Map).current;return ue.jsx(r,{scope:x,itemMap:y,collectionRef:b,children:C})};i.displayName=e;const s=o+"CollectionSlot",c=Cg(s),u=nt.forwardRef((_,x)=>{const{scope:C,children:b}=_,y=a(s,C),M=Ln(x,y.collectionRef);return ue.jsx(c,{ref:M,children:b})});u.displayName=s;const h=o+"CollectionItemSlot",f="data-radix-collection-item",m=Cg(h),g=nt.forwardRef((_,x)=>{const{scope:C,children:b,...y}=_,M=nt.useRef(null),R=Ln(x,M),T=a(h,C);return nt.useEffect(()=>(T.itemMap.set(M,{ref:M,...y}),()=>void T.itemMap.delete(M))),ue.jsx(m,{[f]:"",ref:R,children:b})});g.displayName=h;function A(_){const x=a(o+"CollectionConsumer",_);return nt.useCallback(()=>{const b=x.collectionRef.current;if(!b)return[];const y=Array.from(b.querySelectorAll(`[${f}]`));return Array.from(x.itemMap.values()).sort((T,w)=>y.indexOf(T.ref.current)-y.indexOf(w.ref.current))},[x.collectionRef,x.itemMap])}return[{Provider:i,Slot:u,ItemSlot:g},A,n]}var g7=j.createContext(void 0);function Z4(o){const e=j.useContext(g7);return o||e||"ltr"}var v7=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],er=v7.reduce((o,e)=>{const t=Cg(`Primitive.${e}`),n=j.forwardRef((r,a)=>{const{asChild:i,...s}=r,c=i?t:e;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),ue.jsx(c,{...s,ref:a})});return n.displayName=`Primitive.${e}`,{...o,[e]:n}},{});function _7(o,e){o&&bd.flushSync(()=>o.dispatchEvent(e))}function Ao(o){const e=j.useRef(o);return j.useEffect(()=>{e.current=o}),j.useMemo(()=>(...t)=>{var n;return(n=e.current)==null?void 0:n.call(e,...t)},[])}function A7(o,e=globalThis==null?void 0:globalThis.document){const t=Ao(o);j.useEffect(()=>{const n=r=>{r.key==="Escape"&&t(r)};return e.addEventListener("keydown",n,{capture:!0}),()=>e.removeEventListener("keydown",n,{capture:!0})},[t,e])}var x7="DismissableLayer",o2="dismissableLayer.update",y7="dismissableLayer.pointerDownOutside",b7="dismissableLayer.focusOutside",RE,K4=j.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),$4=j.forwardRef((o,e)=>{const{disableOutsidePointerEvents:t=!1,onEscapeKeyDown:n,onPointerDownOutside:r,onFocusOutside:a,onInteractOutside:i,onDismiss:s,...c}=o,u=j.useContext(K4),[h,f]=j.useState(null),m=(h==null?void 0:h.ownerDocument)??(globalThis==null?void 0:globalThis.document),[,g]=j.useState({}),A=Ln(e,w=>f(w)),_=Array.from(u.layers),[x]=[...u.layersWithOutsidePointerEventsDisabled].slice(-1),C=_.indexOf(x),b=h?_.indexOf(h):-1,y=u.layersWithOutsidePointerEventsDisabled.size>0,M=b>=C,R=E7(w=>{const D=w.target,z=[...u.branches].some(F=>F.contains(D));!M||z||(r==null||r(w),i==null||i(w),w.defaultPrevented||s==null||s())},m),T=M7(w=>{const D=w.target;[...u.branches].some(F=>F.contains(D))||(a==null||a(w),i==null||i(w),w.defaultPrevented||s==null||s())},m);return A7(w=>{b===u.layers.size-1&&(n==null||n(w),!w.defaultPrevented&&s&&(w.preventDefault(),s()))},m),j.useEffect(()=>{if(h)return t&&(u.layersWithOutsidePointerEventsDisabled.size===0&&(RE=m.body.style.pointerEvents,m.body.style.pointerEvents="none"),u.layersWithOutsidePointerEventsDisabled.add(h)),u.layers.add(h),IE(),()=>{t&&u.layersWithOutsidePointerEventsDisabled.size===1&&(m.body.style.pointerEvents=RE)}},[h,m,t,u]),j.useEffect(()=>()=>{h&&(u.layers.delete(h),u.layersWithOutsidePointerEventsDisabled.delete(h),IE())},[h,u]),j.useEffect(()=>{const w=()=>g({});return document.addEventListener(o2,w),()=>document.removeEventListener(o2,w)},[]),ue.jsx(er.div,{...c,ref:A,style:{pointerEvents:y?M?"auto":"none":void 0,...o.style},onFocusCapture:_n(o.onFocusCapture,T.onFocusCapture),onBlurCapture:_n(o.onBlurCapture,T.onBlurCapture),onPointerDownCapture:_n(o.onPointerDownCapture,R.onPointerDownCapture)})});$4.displayName=x7;var S7="DismissableLayerBranch",C7=j.forwardRef((o,e)=>{const t=j.useContext(K4),n=j.useRef(null),r=Ln(e,n);return j.useEffect(()=>{const a=n.current;if(a)return t.branches.add(a),()=>{t.branches.delete(a)}},[t.branches]),ue.jsx(er.div,{...o,ref:r})});C7.displayName=S7;function E7(o,e=globalThis==null?void 0:globalThis.document){const t=Ao(o),n=j.useRef(!1),r=j.useRef(()=>{});return j.useEffect(()=>{const a=s=>{if(s.target&&!n.current){let c=function(){J4(y7,t,u,{discrete:!0})};const u={originalEvent:s};s.pointerType==="touch"?(e.removeEventListener("click",r.current),r.current=c,e.addEventListener("click",r.current,{once:!0})):c()}else e.removeEventListener("click",r.current);n.current=!1},i=window.setTimeout(()=>{e.addEventListener("pointerdown",a)},0);return()=>{window.clearTimeout(i),e.removeEventListener("pointerdown",a),e.removeEventListener("click",r.current)}},[e,t]),{onPointerDownCapture:()=>n.current=!0}}function M7(o,e=globalThis==null?void 0:globalThis.document){const t=Ao(o),n=j.useRef(!1);return j.useEffect(()=>{const r=a=>{a.target&&!n.current&&J4(b7,t,{originalEvent:a},{discrete:!1})};return e.addEventListener("focusin",r),()=>e.removeEventListener("focusin",r)},[e,t]),{onFocusCapture:()=>n.current=!0,onBlurCapture:()=>n.current=!1}}function IE(){const o=new CustomEvent(o2);document.dispatchEvent(o)}function J4(o,e,t,{discrete:n}){const r=t.originalEvent.target,a=new CustomEvent(o,{bubbles:!1,cancelable:!0,detail:t});e&&r.addEventListener(o,e,{once:!0}),n?_7(r,a):r.dispatchEvent(a)}var tA=0;function w7(){j.useEffect(()=>{const o=document.querySelectorAll("[data-radix-focus-guard]");return document.body.insertAdjacentElement("afterbegin",o[0]??LE()),document.body.insertAdjacentElement("beforeend",o[1]??LE()),tA++,()=>{tA===1&&document.querySelectorAll("[data-radix-focus-guard]").forEach(e=>e.remove()),tA--}},[])}function LE(){const o=document.createElement("span");return o.setAttribute("data-radix-focus-guard",""),o.tabIndex=0,o.style.outline="none",o.style.opacity="0",o.style.position="fixed",o.style.pointerEvents="none",o}var nA="focusScope.autoFocusOnMount",rA="focusScope.autoFocusOnUnmount",BE={bubbles:!1,cancelable:!0},T7="FocusScope",eI=j.forwardRef((o,e)=>{const{loop:t=!1,trapped:n=!1,onMountAutoFocus:r,onUnmountAutoFocus:a,...i}=o,[s,c]=j.useState(null),u=Ao(r),h=Ao(a),f=j.useRef(null),m=Ln(e,_=>c(_)),g=j.useRef({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;j.useEffect(()=>{if(n){let _=function(y){if(g.paused||!s)return;const M=y.target;s.contains(M)?f.current=M:Js(f.current,{select:!0})},x=function(y){if(g.paused||!s)return;const M=y.relatedTarget;M!==null&&(s.contains(M)||Js(f.current,{select:!0}))},C=function(y){if(document.activeElement===document.body)for(const R of y)R.removedNodes.length>0&&Js(s)};document.addEventListener("focusin",_),document.addEventListener("focusout",x);const b=new MutationObserver(C);return s&&b.observe(s,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",_),document.removeEventListener("focusout",x),b.disconnect()}}},[n,s,g.paused]),j.useEffect(()=>{if(s){NE.add(g);const _=document.activeElement;if(!s.contains(_)){const C=new CustomEvent(nA,BE);s.addEventListener(nA,u),s.dispatchEvent(C),C.defaultPrevented||(R7(N7(tI(s)),{select:!0}),document.activeElement===_&&Js(s))}return()=>{s.removeEventListener(nA,u),setTimeout(()=>{const C=new CustomEvent(rA,BE);s.addEventListener(rA,h),s.dispatchEvent(C),C.defaultPrevented||Js(_??document.body,{select:!0}),s.removeEventListener(rA,h),NE.remove(g)},0)}}},[s,u,h,g]);const A=j.useCallback(_=>{if(!t&&!n||g.paused)return;const x=_.key==="Tab"&&!_.altKey&&!_.ctrlKey&&!_.metaKey,C=document.activeElement;if(x&&C){const b=_.currentTarget,[y,M]=I7(b);y&&M?!_.shiftKey&&C===M?(_.preventDefault(),t&&Js(y,{select:!0})):_.shiftKey&&C===y&&(_.preventDefault(),t&&Js(M,{select:!0})):C===b&&_.preventDefault()}},[t,n,g.paused]);return ue.jsx(er.div,{tabIndex:-1,...i,ref:m,onKeyDown:A})});eI.displayName=T7;function R7(o,{select:e=!1}={}){const t=document.activeElement;for(const n of o)if(Js(n,{select:e}),document.activeElement!==t)return}function I7(o){const e=tI(o),t=PE(e,o),n=PE(e.reverse(),o);return[t,n]}function tI(o){const e=[],t=document.createTreeWalker(o,NodeFilter.SHOW_ELEMENT,{acceptNode:n=>{const r=n.tagName==="INPUT"&&n.type==="hidden";return n.disabled||n.hidden||r?NodeFilter.FILTER_SKIP:n.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;t.nextNode();)e.push(t.currentNode);return e}function PE(o,e){for(const t of o)if(!L7(t,{upTo:e}))return t}function L7(o,{upTo:e}){if(getComputedStyle(o).visibility==="hidden")return!0;for(;o;){if(e!==void 0&&o===e)return!1;if(getComputedStyle(o).display==="none")return!0;o=o.parentElement}return!1}function B7(o){return o instanceof HTMLInputElement&&"select"in o}function Js(o,{select:e=!1}={}){if(o&&o.focus){const t=document.activeElement;o.focus({preventScroll:!0}),o!==t&&B7(o)&&e&&o.select()}}var NE=P7();function P7(){let o=[];return{add(e){const t=o[0];e!==t&&(t==null||t.pause()),o=DE(o,e),o.unshift(e)},remove(e){var t;o=DE(o,e),(t=o[0])==null||t.resume()}}}function DE(o,e){const t=[...o],n=t.indexOf(e);return n!==-1&&t.splice(n,1),t}function N7(o){return o.filter(e=>e.tagName!=="A")}var Fr=globalThis!=null&&globalThis.document?j.useLayoutEffect:()=>{},D7=ry[" useId ".trim().toString()]||(()=>{}),O7=0;function Cy(o){const[e,t]=j.useState(D7());return Fr(()=>{t(n=>n??String(O7++))},[o]),o||(e?`radix-${e}`:"")}var F7="Arrow",nI=j.forwardRef((o,e)=>{const{children:t,width:n=10,height:r=5,...a}=o;return ue.jsx(er.svg,{...a,ref:e,width:n,height:r,viewBox:"0 0 30 10",preserveAspectRatio:"none",children:o.asChild?t:ue.jsx("polygon",{points:"0,0 30,0 15,10"})})});nI.displayName=F7;var U7=nI;function z7(o){const[e,t]=j.useState(void 0);return Fr(()=>{if(o){t({width:o.offsetWidth,height:o.offsetHeight});const n=new ResizeObserver(r=>{if(!Array.isArray(r)||!r.length)return;const a=r[0];let i,s;if("borderBoxSize"in a){const c=a.borderBoxSize,u=Array.isArray(c)?c[0]:c;i=u.inlineSize,s=u.blockSize}else i=o.offsetWidth,s=o.offsetHeight;t({width:i,height:s})});return n.observe(o,{box:"border-box"}),()=>n.unobserve(o)}else t(void 0)},[o]),e}var Ey="Popper",[rI,oI]=cv(Ey),[V7,aI]=rI(Ey),iI=o=>{const{__scopePopper:e,children:t}=o,[n,r]=j.useState(null);return ue.jsx(V7,{scope:e,anchor:n,onAnchorChange:r,children:t})};iI.displayName=Ey;var sI="PopperAnchor",lI=j.forwardRef((o,e)=>{const{__scopePopper:t,virtualRef:n,...r}=o,a=aI(sI,t),i=j.useRef(null),s=Ln(e,i);return j.useEffect(()=>{a.onAnchorChange((n==null?void 0:n.current)||i.current)}),n?null:ue.jsx(er.div,{...r,ref:s})});lI.displayName=sI;var My="PopperContent",[k7,G7]=rI(My),cI=j.forwardRef((o,e)=>{var G,ee,X,W,Y,P;const{__scopePopper:t,side:n="bottom",sideOffset:r=0,align:a="center",alignOffset:i=0,arrowPadding:s=0,avoidCollisions:c=!0,collisionBoundary:u=[],collisionPadding:h=0,sticky:f="partial",hideWhenDetached:m=!1,updatePositionStrategy:g="optimized",onPlaced:A,..._}=o,x=aI(My,t),[C,b]=j.useState(null),y=Ln(e,Q=>b(Q)),[M,R]=j.useState(null),T=z7(M),w=(T==null?void 0:T.width)??0,D=(T==null?void 0:T.height)??0,z=n+(a!=="center"?"-"+a:""),F=typeof h=="number"?h:{top:0,right:0,bottom:0,left:0,...h},O=Array.isArray(u)?u:[u],q=O.length>0,ne={padding:F,boundary:O.filter(H7),altBoundary:q},{refs:$,floatingStyles:he,placement:K,isPositioned:oe,middlewareData:ie}=l4({strategy:"fixed",placement:z,whileElementsMounted:(...Q)=>i4(...Q,{animationFrame:g==="always"}),elements:{reference:x.anchor},middleware:[c4({mainAxis:r+D,alignmentAxis:i}),c&&u4({mainAxis:!0,crossAxis:!1,limiter:f==="partial"?d4():void 0,...ne}),c&&f4({...ne}),h4({...ne,apply:({elements:Q,rects:I,availableWidth:N,availableHeight:se})=>{const{width:ce,height:fe}=I.reference,ve=Q.floating.style;ve.setProperty("--radix-popper-available-width",`${N}px`),ve.setProperty("--radix-popper-available-height",`${se}px`),ve.setProperty("--radix-popper-anchor-width",`${ce}px`),ve.setProperty("--radix-popper-anchor-height",`${fe}px`)}}),M&&m4({element:M,padding:s}),W7({arrowWidth:w,arrowHeight:D}),m&&p4({strategy:"referenceHidden",...ne})]}),[L,U]=fI(K),k=Ao(A);Fr(()=>{oe&&(k==null||k())},[oe,k]);const J=(G=ie.arrow)==null?void 0:G.x,de=(ee=ie.arrow)==null?void 0:ee.y,te=((X=ie.arrow)==null?void 0:X.centerOffset)!==0,[le,V]=j.useState();return Fr(()=>{C&&V(window.getComputedStyle(C).zIndex)},[C]),ue.jsx("div",{ref:$.setFloating,"data-radix-popper-content-wrapper":"",style:{...he,transform:oe?he.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:le,"--radix-popper-transform-origin":[(W=ie.transformOrigin)==null?void 0:W.x,(Y=ie.transformOrigin)==null?void 0:Y.y].join(" "),...((P=ie.hide)==null?void 0:P.referenceHidden)&&{visibility:"hidden",pointerEvents:"none"}},dir:o.dir,children:ue.jsx(k7,{scope:t,placedSide:L,onArrowChange:R,arrowX:J,arrowY:de,shouldHideArrow:te,children:ue.jsx(er.div,{"data-side":L,"data-align":U,..._,ref:y,style:{..._.style,animation:oe?void 0:"none"}})})})});cI.displayName=My;var uI="PopperArrow",Q7={top:"bottom",right:"left",bottom:"top",left:"right"},dI=j.forwardRef(function(e,t){const{__scopePopper:n,...r}=e,a=G7(uI,n),i=Q7[a.placedSide];return ue.jsx("span",{ref:a.onArrowChange,style:{position:"absolute",left:a.arrowX,top:a.arrowY,[i]:0,transformOrigin:{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[a.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[a.placedSide],visibility:a.shouldHideArrow?"hidden":void 0},children:ue.jsx(U7,{...r,ref:t,style:{...r.style,display:"block"}})})});dI.displayName=uI;function H7(o){return o!==null}var W7=o=>({name:"transformOrigin",options:o,fn(e){var x,C,b;const{placement:t,rects:n,middlewareData:r}=e,i=((x=r.arrow)==null?void 0:x.centerOffset)!==0,s=i?0:o.arrowWidth,c=i?0:o.arrowHeight,[u,h]=fI(t),f={start:"0%",center:"50%",end:"100%"}[h],m=(((C=r.arrow)==null?void 0:C.x)??0)+s/2,g=(((b=r.arrow)==null?void 0:b.y)??0)+c/2;let A="",_="";return u==="bottom"?(A=i?f:`${m}px`,_=`${-c}px`):u==="top"?(A=i?f:`${m}px`,_=`${n.floating.height+c}px`):u==="right"?(A=`${-c}px`,_=i?f:`${g}px`):u==="left"&&(A=`${n.floating.width+c}px`,_=i?f:`${g}px`),{data:{x:A,y:_}}}});function fI(o){const[e,t="center"]=o.split("-");return[e,t]}var Y7=iI,j7=lI,X7=cI,q7=dI,Z7="Portal",hI=j.forwardRef((o,e)=>{var s;const{container:t,...n}=o,[r,a]=j.useState(!1);Fr(()=>a(!0),[]);const i=t||r&&((s=globalThis==null?void 0:globalThis.document)==null?void 0:s.body);return i?hR.createPortal(ue.jsx(er.div,{...n,ref:e}),i):null});hI.displayName=Z7;var K7=ry[" useInsertionEffect ".trim().toString()]||Fr;function OE({prop:o,defaultProp:e,onChange:t=()=>{},caller:n}){const[r,a,i]=$7({defaultProp:e,onChange:t}),s=o!==void 0,c=s?o:r;{const h=j.useRef(o!==void 0);j.useEffect(()=>{const f=h.current;f!==s&&console.warn(`${n} is changing from ${f?"controlled":"uncontrolled"} to ${s?"controlled":"uncontrolled"}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`),h.current=s},[s,n])}const u=j.useCallback(h=>{var f;if(s){const m=J7(h)?h(o):h;m!==o&&((f=i.current)==null||f.call(i,m))}else a(h)},[s,o,a,i]);return[c,u]}function $7({defaultProp:o,onChange:e}){const[t,n]=j.useState(o),r=j.useRef(t),a=j.useRef(e);return K7(()=>{a.current=e},[e]),j.useEffect(()=>{var i;r.current!==t&&((i=a.current)==null||i.call(a,t),r.current=t)},[t,r]),[t,n,a]}function J7(o){return typeof o=="function"}function e9(o){const e=j.useRef({value:o,previous:o});return j.useMemo(()=>(e.current.value!==o&&(e.current.previous=e.current.value,e.current.value=o),e.current.previous),[o])}var pI=Object.freeze({position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal"}),t9="VisuallyHidden",n9=j.forwardRef((o,e)=>ue.jsx(er.span,{...o,ref:e,style:{...pI,...o.style}}));n9.displayName=t9;var r9=[" ","Enter","ArrowUp","ArrowDown"],o9=[" ","Enter"],Mc="Select",[uv,dv,a9]=m7(Mc),[wd,Gie]=cv(Mc,[a9,oI]),fv=oI(),[i9,vl]=wd(Mc),[s9,l9]=wd(Mc),mI=o=>{const{__scopeSelect:e,children:t,open:n,defaultOpen:r,onOpenChange:a,value:i,defaultValue:s,onValueChange:c,dir:u,name:h,autoComplete:f,disabled:m,required:g,form:A}=o,_=fv(e),[x,C]=j.useState(null),[b,y]=j.useState(null),[M,R]=j.useState(!1),T=Z4(u),[w,D]=OE({prop:n,defaultProp:r??!1,onChange:a,caller:Mc}),[z,F]=OE({prop:i,defaultProp:s,onChange:c,caller:Mc}),O=j.useRef(null),q=x?A||!!x.closest("form"):!0,[ne,$]=j.useState(new Set),he=Array.from(ne).map(K=>K.props.value).join(";");return ue.jsx(Y7,{..._,children:ue.jsxs(i9,{required:g,scope:e,trigger:x,onTriggerChange:C,valueNode:b,onValueNodeChange:y,valueNodeHasChildren:M,onValueNodeHasChildrenChange:R,contentId:Cy(),value:z,onValueChange:F,open:w,onOpenChange:D,dir:T,triggerPointerDownPosRef:O,disabled:m,children:[ue.jsx(uv.Provider,{scope:e,children:ue.jsx(s9,{scope:o.__scopeSelect,onNativeOptionAdd:j.useCallback(K=>{$(oe=>new Set(oe).add(K))},[]),onNativeOptionRemove:j.useCallback(K=>{$(oe=>{const ie=new Set(oe);return ie.delete(K),ie})},[]),children:t})}),q?ue.jsxs(FI,{"aria-hidden":!0,required:g,tabIndex:-1,name:h,autoComplete:f,value:z,onChange:K=>F(K.target.value),disabled:m,form:A,children:[z===void 0?ue.jsx("option",{value:""}):null,Array.from(ne)]},he):null]})})};mI.displayName=Mc;var gI="SelectTrigger",vI=j.forwardRef((o,e)=>{const{__scopeSelect:t,disabled:n=!1,...r}=o,a=fv(t),i=vl(gI,t),s=i.disabled||n,c=Ln(e,i.onTriggerChange),u=dv(t),h=j.useRef("touch"),[f,m,g]=zI(_=>{const x=u().filter(y=>!y.disabled),C=x.find(y=>y.value===i.value),b=VI(x,_,C);b!==void 0&&i.onValueChange(b.value)}),A=_=>{s||(i.onOpenChange(!0),g()),_&&(i.triggerPointerDownPosRef.current={x:Math.round(_.pageX),y:Math.round(_.pageY)})};return ue.jsx(j7,{asChild:!0,...a,children:ue.jsx(er.button,{type:"button",role:"combobox","aria-controls":i.contentId,"aria-expanded":i.open,"aria-required":i.required,"aria-autocomplete":"none",dir:i.dir,"data-state":i.open?"open":"closed",disabled:s,"data-disabled":s?"":void 0,"data-placeholder":UI(i.value)?"":void 0,...r,ref:c,onClick:_n(r.onClick,_=>{_.currentTarget.focus(),h.current!=="mouse"&&A(_)}),onPointerDown:_n(r.onPointerDown,_=>{h.current=_.pointerType;const x=_.target;x.hasPointerCapture(_.pointerId)&&x.releasePointerCapture(_.pointerId),_.button===0&&_.ctrlKey===!1&&_.pointerType==="mouse"&&(A(_),_.preventDefault())}),onKeyDown:_n(r.onKeyDown,_=>{const x=f.current!=="";!(_.ctrlKey||_.altKey||_.metaKey)&&_.key.length===1&&m(_.key),!(x&&_.key===" ")&&r9.includes(_.key)&&(A(),_.preventDefault())})})})});vI.displayName=gI;var _I="SelectValue",AI=j.forwardRef((o,e)=>{const{__scopeSelect:t,className:n,style:r,children:a,placeholder:i="",...s}=o,c=vl(_I,t),{onValueNodeHasChildrenChange:u}=c,h=a!==void 0,f=Ln(e,c.onValueNodeChange);return Fr(()=>{u(h)},[u,h]),ue.jsx(er.span,{...s,ref:f,style:{pointerEvents:"none"},children:UI(c.value)?ue.jsx(ue.Fragment,{children:i}):a})});AI.displayName=_I;var c9="SelectIcon",xI=j.forwardRef((o,e)=>{const{__scopeSelect:t,children:n,...r}=o;return ue.jsx(er.span,{"aria-hidden":!0,...r,ref:e,children:n||""})});xI.displayName=c9;var u9="SelectPortal",yI=o=>ue.jsx(hI,{asChild:!0,...o});yI.displayName=u9;var wc="SelectContent",bI=j.forwardRef((o,e)=>{const t=vl(wc,o.__scopeSelect),[n,r]=j.useState();if(Fr(()=>{r(new DocumentFragment)},[]),!t.open){const a=n;return a?bd.createPortal(ue.jsx(SI,{scope:o.__scopeSelect,children:ue.jsx(uv.Slot,{scope:o.__scopeSelect,children:ue.jsx("div",{children:o.children})})}),a):null}return ue.jsx(CI,{...o,ref:e})});bI.displayName=wc;var Ta=10,[SI,_l]=wd(wc),d9="SelectContentImpl",f9=Cg("SelectContent.RemoveScroll"),CI=j.forwardRef((o,e)=>{const{__scopeSelect:t,position:n="item-aligned",onCloseAutoFocus:r,onEscapeKeyDown:a,onPointerDownOutside:i,side:s,sideOffset:c,align:u,alignOffset:h,arrowPadding:f,collisionBoundary:m,collisionPadding:g,sticky:A,hideWhenDetached:_,avoidCollisions:x,...C}=o,b=vl(wc,t),[y,M]=j.useState(null),[R,T]=j.useState(null),w=Ln(e,G=>M(G)),[D,z]=j.useState(null),[F,O]=j.useState(null),q=dv(t),[ne,$]=j.useState(!1),he=j.useRef(!1);j.useEffect(()=>{if(y)return I4(y)},[y]),w7();const K=j.useCallback(G=>{const[ee,...X]=q().map(P=>P.ref.current),[W]=X.slice(-1),Y=document.activeElement;for(const P of G)if(P===Y||(P==null||P.scrollIntoView({block:"nearest"}),P===ee&&R&&(R.scrollTop=0),P===W&&R&&(R.scrollTop=R.scrollHeight),P==null||P.focus(),document.activeElement!==Y))return},[q,R]),oe=j.useCallback(()=>K([D,y]),[K,D,y]);j.useEffect(()=>{ne&&oe()},[ne,oe]);const{onOpenChange:ie,triggerPointerDownPosRef:L}=b;j.useEffect(()=>{if(y){let G={x:0,y:0};const ee=W=>{var Y,P;G={x:Math.abs(Math.round(W.pageX)-(((Y=L.current)==null?void 0:Y.x)??0)),y:Math.abs(Math.round(W.pageY)-(((P=L.current)==null?void 0:P.y)??0))}},X=W=>{G.x<=10&&G.y<=10?W.preventDefault():y.contains(W.target)||ie(!1),document.removeEventListener("pointermove",ee),L.current=null};return L.current!==null&&(document.addEventListener("pointermove",ee),document.addEventListener("pointerup",X,{capture:!0,once:!0})),()=>{document.removeEventListener("pointermove",ee),document.removeEventListener("pointerup",X,{capture:!0})}}},[y,ie,L]),j.useEffect(()=>{const G=()=>ie(!1);return window.addEventListener("blur",G),window.addEventListener("resize",G),()=>{window.removeEventListener("blur",G),window.removeEventListener("resize",G)}},[ie]);const[U,k]=zI(G=>{const ee=q().filter(Y=>!Y.disabled),X=ee.find(Y=>Y.ref.current===document.activeElement),W=VI(ee,G,X);W&&setTimeout(()=>W.ref.current.focus())}),J=j.useCallback((G,ee,X)=>{const W=!he.current&&!X;(b.value!==void 0&&b.value===ee||W)&&(z(G),W&&(he.current=!0))},[b.value]),de=j.useCallback(()=>y==null?void 0:y.focus(),[y]),te=j.useCallback((G,ee,X)=>{const W=!he.current&&!X;(b.value!==void 0&&b.value===ee||W)&&O(G)},[b.value]),le=n==="popper"?a2:EI,V=le===a2?{side:s,sideOffset:c,align:u,alignOffset:h,arrowPadding:f,collisionBoundary:m,collisionPadding:g,sticky:A,hideWhenDetached:_,avoidCollisions:x}:{};return ue.jsx(SI,{scope:t,content:y,viewport:R,onViewportChange:T,itemRefCallback:J,selectedItem:D,onItemLeave:de,itemTextRefCallback:te,focusSelectedItem:oe,selectedItemText:F,position:n,isPositioned:ne,searchRef:U,children:ue.jsx(xy,{as:f9,allowPinchZoom:!0,children:ue.jsx(eI,{asChild:!0,trapped:b.open,onMountAutoFocus:G=>{G.preventDefault()},onUnmountAutoFocus:_n(r,G=>{var ee;(ee=b.trigger)==null||ee.focus({preventScroll:!0}),G.preventDefault()}),children:ue.jsx($4,{asChild:!0,disableOutsidePointerEvents:!0,onEscapeKeyDown:a,onPointerDownOutside:i,onFocusOutside:G=>G.preventDefault(),onDismiss:()=>b.onOpenChange(!1),children:ue.jsx(le,{role:"listbox",id:b.contentId,"data-state":b.open?"open":"closed",dir:b.dir,onContextMenu:G=>G.preventDefault(),...C,...V,onPlaced:()=>$(!0),ref:w,style:{display:"flex",flexDirection:"column",outline:"none",...C.style},onKeyDown:_n(C.onKeyDown,G=>{const ee=G.ctrlKey||G.altKey||G.metaKey;if(G.key==="Tab"&&G.preventDefault(),!ee&&G.key.length===1&&k(G.key),["ArrowUp","ArrowDown","Home","End"].includes(G.key)){let W=q().filter(Y=>!Y.disabled).map(Y=>Y.ref.current);if(["ArrowUp","End"].includes(G.key)&&(W=W.slice().reverse()),["ArrowUp","ArrowDown"].includes(G.key)){const Y=G.target,P=W.indexOf(Y);W=W.slice(P+1)}setTimeout(()=>K(W)),G.preventDefault()}})})})})})})});CI.displayName=d9;var h9="SelectItemAlignedPosition",EI=j.forwardRef((o,e)=>{const{__scopeSelect:t,onPlaced:n,...r}=o,a=vl(wc,t),i=_l(wc,t),[s,c]=j.useState(null),[u,h]=j.useState(null),f=Ln(e,w=>h(w)),m=dv(t),g=j.useRef(!1),A=j.useRef(!0),{viewport:_,selectedItem:x,selectedItemText:C,focusSelectedItem:b}=i,y=j.useCallback(()=>{if(a.trigger&&a.valueNode&&s&&u&&_&&x&&C){const w=a.trigger.getBoundingClientRect(),D=u.getBoundingClientRect(),z=a.valueNode.getBoundingClientRect(),F=C.getBoundingClientRect();if(a.dir!=="rtl"){const Y=F.left-D.left,P=z.left-Y,Q=w.left-P,I=w.width+Q,N=Math.max(I,D.width),se=window.innerWidth-Ta,ce=r2(P,[Ta,Math.max(Ta,se-N)]);s.style.minWidth=I+"px",s.style.left=ce+"px"}else{const Y=D.right-F.right,P=window.innerWidth-z.right-Y,Q=window.innerWidth-w.right-P,I=w.width+Q,N=Math.max(I,D.width),se=window.innerWidth-Ta,ce=r2(P,[Ta,Math.max(Ta,se-N)]);s.style.minWidth=I+"px",s.style.right=ce+"px"}const O=m(),q=window.innerHeight-Ta*2,ne=_.scrollHeight,$=window.getComputedStyle(u),he=parseInt($.borderTopWidth,10),K=parseInt($.paddingTop,10),oe=parseInt($.borderBottomWidth,10),ie=parseInt($.paddingBottom,10),L=he+K+ne+ie+oe,U=Math.min(x.offsetHeight*5,L),k=window.getComputedStyle(_),J=parseInt(k.paddingTop,10),de=parseInt(k.paddingBottom,10),te=w.top+w.height/2-Ta,le=q-te,V=x.offsetHeight/2,G=x.offsetTop+V,ee=he+K+G,X=L-ee;if(ee<=te){const Y=O.length>0&&x===O[O.length-1].ref.current;s.style.bottom="0px";const P=u.clientHeight-_.offsetTop-_.offsetHeight,Q=Math.max(le,V+(Y?de:0)+P+oe),I=ee+Q;s.style.height=I+"px"}else{const Y=O.length>0&&x===O[0].ref.current;s.style.top="0px";const Q=Math.max(te,he+_.offsetTop+(Y?J:0)+V)+X;s.style.height=Q+"px",_.scrollTop=ee-te+_.offsetTop}s.style.margin=`${Ta}px 0`,s.style.minHeight=U+"px",s.style.maxHeight=q+"px",n==null||n(),requestAnimationFrame(()=>g.current=!0)}},[m,a.trigger,a.valueNode,s,u,_,x,C,a.dir,n]);Fr(()=>y(),[y]);const[M,R]=j.useState();Fr(()=>{u&&R(window.getComputedStyle(u).zIndex)},[u]);const T=j.useCallback(w=>{w&&A.current===!0&&(y(),b==null||b(),A.current=!1)},[y,b]);return ue.jsx(m9,{scope:t,contentWrapper:s,shouldExpandOnScrollRef:g,onScrollButtonChange:T,children:ue.jsx("div",{ref:c,style:{display:"flex",flexDirection:"column",position:"fixed",zIndex:M},children:ue.jsx(er.div,{...r,ref:f,style:{boxSizing:"border-box",maxHeight:"100%",...r.style}})})})});EI.displayName=h9;var p9="SelectPopperPosition",a2=j.forwardRef((o,e)=>{const{__scopeSelect:t,align:n="start",collisionPadding:r=Ta,...a}=o,i=fv(t);return ue.jsx(X7,{...i,...a,ref:e,align:n,collisionPadding:r,style:{boxSizing:"border-box",...a.style,"--radix-select-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-select-content-available-width":"var(--radix-popper-available-width)","--radix-select-content-available-height":"var(--radix-popper-available-height)","--radix-select-trigger-width":"var(--radix-popper-anchor-width)","--radix-select-trigger-height":"var(--radix-popper-anchor-height)"}})});a2.displayName=p9;var[m9,wy]=wd(wc,{}),i2="SelectViewport",MI=j.forwardRef((o,e)=>{const{__scopeSelect:t,nonce:n,...r}=o,a=_l(i2,t),i=wy(i2,t),s=Ln(e,a.onViewportChange),c=j.useRef(0);return ue.jsxs(ue.Fragment,{children:[ue.jsx("style",{dangerouslySetInnerHTML:{__html:"[data-radix-select-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-select-viewport]::-webkit-scrollbar{display:none}"},nonce:n}),ue.jsx(uv.Slot,{scope:t,children:ue.jsx(er.div,{"data-radix-select-viewport":"",role:"presentation",...r,ref:s,style:{position:"relative",flex:1,overflow:"hidden auto",...r.style},onScroll:_n(r.onScroll,u=>{const h=u.currentTarget,{contentWrapper:f,shouldExpandOnScrollRef:m}=i;if(m!=null&&m.current&&f){const g=Math.abs(c.current-h.scrollTop);if(g>0){const A=window.innerHeight-Ta*2,_=parseFloat(f.style.minHeight),x=parseFloat(f.style.height),C=Math.max(_,x);if(C<A){const b=C+g,y=Math.min(A,b),M=b-y;f.style.height=y+"px",f.style.bottom==="0px"&&(h.scrollTop=M>0?M:0,f.style.justifyContent="flex-end")}}}c.current=h.scrollTop})})})]})});MI.displayName=i2;var wI="SelectGroup",[g9,v9]=wd(wI),_9=j.forwardRef((o,e)=>{const{__scopeSelect:t,...n}=o,r=Cy();return ue.jsx(g9,{scope:t,id:r,children:ue.jsx(er.div,{role:"group","aria-labelledby":r,...n,ref:e})})});_9.displayName=wI;var TI="SelectLabel",A9=j.forwardRef((o,e)=>{const{__scopeSelect:t,...n}=o,r=v9(TI,t);return ue.jsx(er.div,{id:r.id,...n,ref:e})});A9.displayName=TI;var Eg="SelectItem",[x9,RI]=wd(Eg),II=j.forwardRef((o,e)=>{const{__scopeSelect:t,value:n,disabled:r=!1,textValue:a,...i}=o,s=vl(Eg,t),c=_l(Eg,t),u=s.value===n,[h,f]=j.useState(a??""),[m,g]=j.useState(!1),A=Ln(e,b=>{var y;return(y=c.itemRefCallback)==null?void 0:y.call(c,b,n,r)}),_=Cy(),x=j.useRef("touch"),C=()=>{r||(s.onValueChange(n),s.onOpenChange(!1))};if(n==="")throw new Error("A <Select.Item /> must have a value prop that is not an empty string. This is because the Select value can be set to an empty string to clear the selection and show the placeholder.");return ue.jsx(x9,{scope:t,value:n,disabled:r,textId:_,isSelected:u,onItemTextChange:j.useCallback(b=>{f(y=>y||((b==null?void 0:b.textContent)??"").trim())},[]),children:ue.jsx(uv.ItemSlot,{scope:t,value:n,disabled:r,textValue:h,children:ue.jsx(er.div,{role:"option","aria-labelledby":_,"data-highlighted":m?"":void 0,"aria-selected":u&&m,"data-state":u?"checked":"unchecked","aria-disabled":r||void 0,"data-disabled":r?"":void 0,tabIndex:r?void 0:-1,...i,ref:A,onFocus:_n(i.onFocus,()=>g(!0)),onBlur:_n(i.onBlur,()=>g(!1)),onClick:_n(i.onClick,()=>{x.current!=="mouse"&&C()}),onPointerUp:_n(i.onPointerUp,()=>{x.current==="mouse"&&C()}),onPointerDown:_n(i.onPointerDown,b=>{x.current=b.pointerType}),onPointerMove:_n(i.onPointerMove,b=>{var y;x.current=b.pointerType,r?(y=c.onItemLeave)==null||y.call(c):x.current==="mouse"&&b.currentTarget.focus({preventScroll:!0})}),onPointerLeave:_n(i.onPointerLeave,b=>{var y;b.currentTarget===document.activeElement&&((y=c.onItemLeave)==null||y.call(c))}),onKeyDown:_n(i.onKeyDown,b=>{var M;((M=c.searchRef)==null?void 0:M.current)!==""&&b.key===" "||(o9.includes(b.key)&&C(),b.key===" "&&b.preventDefault())})})})})});II.displayName=Eg;var ih="SelectItemText",LI=j.forwardRef((o,e)=>{const{__scopeSelect:t,className:n,style:r,...a}=o,i=vl(ih,t),s=_l(ih,t),c=RI(ih,t),u=l9(ih,t),[h,f]=j.useState(null),m=Ln(e,C=>f(C),c.onItemTextChange,C=>{var b;return(b=s.itemTextRefCallback)==null?void 0:b.call(s,C,c.value,c.disabled)}),g=h==null?void 0:h.textContent,A=j.useMemo(()=>ue.jsx("option",{value:c.value,disabled:c.disabled,children:g},c.value),[c.disabled,c.value,g]),{onNativeOptionAdd:_,onNativeOptionRemove:x}=u;return Fr(()=>(_(A),()=>x(A)),[_,x,A]),ue.jsxs(ue.Fragment,{children:[ue.jsx(er.span,{id:c.textId,...a,ref:m}),c.isSelected&&i.valueNode&&!i.valueNodeHasChildren?bd.createPortal(a.children,i.valueNode):null]})});LI.displayName=ih;var BI="SelectItemIndicator",PI=j.forwardRef((o,e)=>{const{__scopeSelect:t,...n}=o;return RI(BI,t).isSelected?ue.jsx(er.span,{"aria-hidden":!0,...n,ref:e}):null});PI.displayName=BI;var s2="SelectScrollUpButton",NI=j.forwardRef((o,e)=>{const t=_l(s2,o.__scopeSelect),n=wy(s2,o.__scopeSelect),[r,a]=j.useState(!1),i=Ln(e,n.onScrollButtonChange);return Fr(()=>{if(t.viewport&&t.isPositioned){let s=function(){const u=c.scrollTop>0;a(u)};const c=t.viewport;return s(),c.addEventListener("scroll",s),()=>c.removeEventListener("scroll",s)}},[t.viewport,t.isPositioned]),r?ue.jsx(OI,{...o,ref:i,onAutoScroll:()=>{const{viewport:s,selectedItem:c}=t;s&&c&&(s.scrollTop=s.scrollTop-c.offsetHeight)}}):null});NI.displayName=s2;var l2="SelectScrollDownButton",DI=j.forwardRef((o,e)=>{const t=_l(l2,o.__scopeSelect),n=wy(l2,o.__scopeSelect),[r,a]=j.useState(!1),i=Ln(e,n.onScrollButtonChange);return Fr(()=>{if(t.viewport&&t.isPositioned){let s=function(){const u=c.scrollHeight-c.clientHeight,h=Math.ceil(c.scrollTop)<u;a(h)};const c=t.viewport;return s(),c.addEventListener("scroll",s),()=>c.removeEventListener("scroll",s)}},[t.viewport,t.isPositioned]),r?ue.jsx(OI,{...o,ref:i,onAutoScroll:()=>{const{viewport:s,selectedItem:c}=t;s&&c&&(s.scrollTop=s.scrollTop+c.offsetHeight)}}):null});DI.displayName=l2;var OI=j.forwardRef((o,e)=>{const{__scopeSelect:t,onAutoScroll:n,...r}=o,a=_l("SelectScrollButton",t),i=j.useRef(null),s=dv(t),c=j.useCallback(()=>{i.current!==null&&(window.clearInterval(i.current),i.current=null)},[]);return j.useEffect(()=>()=>c(),[c]),Fr(()=>{var h;const u=s().find(f=>f.ref.current===document.activeElement);(h=u==null?void 0:u.ref.current)==null||h.scrollIntoView({block:"nearest"})},[s]),ue.jsx(er.div,{"aria-hidden":!0,...r,ref:e,style:{flexShrink:0,...r.style},onPointerDown:_n(r.onPointerDown,()=>{i.current===null&&(i.current=window.setInterval(n,50))}),onPointerMove:_n(r.onPointerMove,()=>{var u;(u=a.onItemLeave)==null||u.call(a),i.current===null&&(i.current=window.setInterval(n,50))}),onPointerLeave:_n(r.onPointerLeave,()=>{c()})})}),y9="SelectSeparator",b9=j.forwardRef((o,e)=>{const{__scopeSelect:t,...n}=o;return ue.jsx(er.div,{"aria-hidden":!0,...n,ref:e})});b9.displayName=y9;var c2="SelectArrow",S9=j.forwardRef((o,e)=>{const{__scopeSelect:t,...n}=o,r=fv(t),a=vl(c2,t),i=_l(c2,t);return a.open&&i.position==="popper"?ue.jsx(q7,{...r,...n,ref:e}):null});S9.displayName=c2;var C9="SelectBubbleInput",FI=j.forwardRef(({__scopeSelect:o,value:e,...t},n)=>{const r=j.useRef(null),a=Ln(n,r),i=e9(e);return j.useEffect(()=>{const s=r.current;if(!s)return;const c=window.HTMLSelectElement.prototype,h=Object.getOwnPropertyDescriptor(c,"value").set;if(i!==e&&h){const f=new Event("change",{bubbles:!0});h.call(s,e),s.dispatchEvent(f)}},[i,e]),ue.jsx(er.select,{...t,style:{...pI,...t.style},ref:a,defaultValue:e})});FI.displayName=C9;function UI(o){return o===""||o===void 0}function zI(o){const e=Ao(o),t=j.useRef(""),n=j.useRef(0),r=j.useCallback(i=>{const s=t.current+i;e(s),function c(u){t.current=u,window.clearTimeout(n.current),u!==""&&(n.current=window.setTimeout(()=>c(""),1e3))}(s)},[e]),a=j.useCallback(()=>{t.current="",window.clearTimeout(n.current)},[]);return j.useEffect(()=>()=>window.clearTimeout(n.current),[]),[t,r,a]}function VI(o,e,t){const r=e.length>1&&Array.from(e).every(u=>u===e[0])?e[0]:e,a=t?o.indexOf(t):-1;let i=E9(o,Math.max(a,0));r.length===1&&(i=i.filter(u=>u!==t));const c=i.find(u=>u.textValue.toLowerCase().startsWith(r.toLowerCase()));return c!==t?c:void 0}function E9(o,e){return o.map((t,n)=>o[(e+n)%o.length])}var M9=mI,w9=vI,T9=AI,R9=xI,I9=yI,L9=bI,B9=MI,P9=II,N9=LI,D9=PI,O9=NI,F9=DI;/**
 * @license lucide-react v0.479.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const U9=o=>o.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),kI=(...o)=>o.filter((e,t,n)=>!!e&&e.trim()!==""&&n.indexOf(e)===t).join(" ").trim();/**
 * @license lucide-react v0.479.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var z9={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.479.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const V9=j.forwardRef(({color:o="currentColor",size:e=24,strokeWidth:t=2,absoluteStrokeWidth:n,className:r="",children:a,iconNode:i,...s},c)=>j.createElement("svg",{ref:c,...z9,width:e,height:e,stroke:o,strokeWidth:n?Number(t)*24/Number(e):t,className:kI("lucide",r),...s},[...i.map(([u,h])=>j.createElement(u,h)),...Array.isArray(a)?a:[a]]));/**
 * @license lucide-react v0.479.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ty=(o,e)=>{const t=j.forwardRef(({className:n,...r},a)=>j.createElement(V9,{ref:a,iconNode:e,className:kI(`lucide-${U9(o)}`,n),...r}));return t.displayName=`${o}`,t};/**
 * @license lucide-react v0.479.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const k9=[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]],G9=Ty("Check",k9);/**
 * @license lucide-react v0.479.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Q9=[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]],GI=Ty("ChevronDown",Q9);/**
 * @license lucide-react v0.479.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const H9=[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]],W9=Ty("ChevronUp",H9);function Y9({...o}){return ue.jsx(M9,{"data-slot":"select",...o})}function j9({...o}){return ue.jsx(T9,{"data-slot":"select-value",...o})}function X9({className:o,size:e="default",children:t,...n}){return ue.jsxs(w9,{"data-slot":"select-trigger","data-size":e,className:jn("border-input data-[placeholder]:text-muted-foreground [&_svg:not([class*='text-'])]:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 dark:hover:bg-input/50 flex w-fit items-center justify-between gap-2 rounded-md border bg-transparent px-3 py-2 text-sm whitespace-nowrap shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 data-[size=default]:h-9 data-[size=sm]:h-8 *:data-[slot=select-value]:line-clamp-1 *:data-[slot=select-value]:flex *:data-[slot=select-value]:items-center *:data-[slot=select-value]:gap-2 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",o),...n,children:[t,ue.jsx(R9,{asChild:!0,children:ue.jsx(GI,{className:"size-4 opacity-50"})})]})}function q9({className:o,children:e,position:t="popper",...n}){return ue.jsx(I9,{children:ue.jsxs(L9,{"data-slot":"select-content",className:jn("bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 relative z-50 max-h-(--radix-select-content-available-height) min-w-[8rem] origin-(--radix-select-content-transform-origin) overflow-x-hidden overflow-y-auto rounded-md border shadow-md",t==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",o),position:t,...n,children:[ue.jsx(Z9,{}),ue.jsx(B9,{className:jn("p-1",t==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)] scroll-my-1"),children:e}),ue.jsx(K9,{})]})})}function oA({className:o,children:e,...t}){return ue.jsxs(P9,{"data-slot":"select-item",className:jn("focus:bg-accent focus:text-accent-foreground [&_svg:not([class*='text-'])]:text-muted-foreground relative flex w-full cursor-default items-center gap-2 rounded-sm py-1.5 pr-8 pl-2 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4 *:[span]:last:flex *:[span]:last:items-center *:[span]:last:gap-2",o),...t,children:[ue.jsx("span",{className:"absolute right-2 flex size-3.5 items-center justify-center",children:ue.jsx(D9,{children:ue.jsx(G9,{className:"size-4"})})}),ue.jsx(N9,{children:e})]})}function Z9({className:o,...e}){return ue.jsx(O9,{"data-slot":"select-scroll-up-button",className:jn("flex cursor-default items-center justify-center py-1",o),...e,children:ue.jsx(W9,{className:"size-4"})})}function K9({className:o,...e}){return ue.jsx(F9,{"data-slot":"select-scroll-down-button",className:jn("flex cursor-default items-center justify-center py-1",o),...e,children:ue.jsx(GI,{className:"size-4"})})}var ap=o=>o.type==="checkbox",pc=o=>o instanceof Date,Jr=o=>o==null;const QI=o=>typeof o=="object";var Jn=o=>!Jr(o)&&!Array.isArray(o)&&QI(o)&&!pc(o),HI=o=>Jn(o)&&o.target?ap(o.target)?o.target.checked:o.target.value:o,$9=o=>o.substring(0,o.search(/\.\d+(\.|$)/))||o,WI=(o,e)=>o.has($9(e)),J9=o=>{const e=o.constructor&&o.constructor.prototype;return Jn(e)&&e.hasOwnProperty("isPrototypeOf")},Ry=typeof window<"u"&&typeof window.HTMLElement<"u"&&typeof document<"u";function Lr(o){let e;const t=Array.isArray(o),n=typeof FileList<"u"?o instanceof FileList:!1;if(o instanceof Date)e=new Date(o);else if(o instanceof Set)e=new Set(o);else if(!(Ry&&(o instanceof Blob||n))&&(t||Jn(o)))if(e=t?[]:{},!t&&!J9(o))e=o;else for(const r in o)o.hasOwnProperty(r)&&(e[r]=Lr(o[r]));else return o;return e}var hv=o=>Array.isArray(o)?o.filter(Boolean):[],$n=o=>o===void 0,je=(o,e,t)=>{if(!e||!Jn(o))return t;const n=hv(e.split(/[,[\].]+?/)).reduce((r,a)=>Jr(r)?r:r[a],o);return $n(n)||n===o?$n(o[e])?t:o[e]:n},zo=o=>typeof o=="boolean",Iy=o=>/^\w*$/.test(o),YI=o=>hv(o.replace(/["|']|\]/g,"").split(/\.|\[/)),ln=(o,e,t)=>{let n=-1;const r=Iy(e)?[e]:YI(e),a=r.length,i=a-1;for(;++n<a;){const s=r[n];let c=t;if(n!==i){const u=o[s];c=Jn(u)||Array.isArray(u)?u:isNaN(+r[n+1])?{}:[]}if(s==="__proto__"||s==="constructor"||s==="prototype")return;o[s]=c,o=o[s]}};const Mg={BLUR:"blur",FOCUS_OUT:"focusout",CHANGE:"change"},Ia={onBlur:"onBlur",onChange:"onChange",onSubmit:"onSubmit",onTouched:"onTouched",all:"all"},Gi={max:"max",min:"min",maxLength:"maxLength",minLength:"minLength",pattern:"pattern",required:"required",validate:"validate"},jI=nt.createContext(null),Ly=()=>nt.useContext(jI),eU=o=>{const{children:e,...t}=o;return nt.createElement(jI.Provider,{value:t},e)};var XI=(o,e,t,n=!0)=>{const r={defaultValues:e._defaultValues};for(const a in o)Object.defineProperty(r,a,{get:()=>{const i=a;return e._proxyFormState[i]!==Ia.all&&(e._proxyFormState[i]=!n||Ia.all),t&&(t[i]=!0),o[i]}});return r};function tU(o){const e=Ly(),{control:t=e.control,disabled:n,name:r,exact:a}=o||{},[i,s]=nt.useState(t._formState),c=nt.useRef({isDirty:!1,isLoading:!1,dirtyFields:!1,touchedFields:!1,validatingFields:!1,isValidating:!1,isValid:!1,errors:!1}),u=nt.useRef(r);return u.current=r,nt.useEffect(()=>t._subscribe({name:u.current,formState:c.current,exact:a,callback:h=>{!n&&s({...t._formState,...h})}}),[t,n,a]),nt.useEffect(()=>{c.current.isValid&&t._setValid(!0)},[t]),nt.useMemo(()=>XI(i,t,c.current,!1),[i,t])}var ai=o=>typeof o=="string",qI=(o,e,t,n,r)=>ai(o)?(n&&e.watch.add(o),je(t,o,r)):Array.isArray(o)?o.map(a=>(n&&e.watch.add(a),je(t,a))):(n&&(e.watchAll=!0),t);function nU(o){const e=Ly(),{control:t=e.control,name:n,defaultValue:r,disabled:a,exact:i}=o||{},s=nt.useRef(n),c=nt.useRef(r);s.current=n,nt.useEffect(()=>t._subscribe({name:s.current,formState:{values:!0},exact:i,callback:f=>!a&&h(qI(s.current,t._names,f.values||t._formValues,!1,c.current))}),[t,a,i]);const[u,h]=nt.useState(t._getWatch(n,r));return nt.useEffect(()=>t._removeUnmounted()),u}function rU(o){const e=Ly(),{name:t,disabled:n,control:r=e.control,shouldUnregister:a}=o,i=WI(r._names.array,t),s=nU({control:r,name:t,defaultValue:je(r._formValues,t,je(r._defaultValues,t,o.defaultValue)),exact:!0}),c=tU({control:r,name:t,exact:!0}),u=nt.useRef(o),h=nt.useRef(r.register(t,{...o.rules,value:s,...zo(o.disabled)?{disabled:o.disabled}:{}})),f=nt.useMemo(()=>Object.defineProperties({},{invalid:{enumerable:!0,get:()=>!!je(c.errors,t)},isDirty:{enumerable:!0,get:()=>!!je(c.dirtyFields,t)},isTouched:{enumerable:!0,get:()=>!!je(c.touchedFields,t)},isValidating:{enumerable:!0,get:()=>!!je(c.validatingFields,t)},error:{enumerable:!0,get:()=>je(c.errors,t)}}),[c,t]),m=nt.useCallback(x=>h.current.onChange({target:{value:HI(x),name:t},type:Mg.CHANGE}),[t]),g=nt.useCallback(()=>h.current.onBlur({target:{value:je(r._formValues,t),name:t},type:Mg.BLUR}),[t,r._formValues]),A=nt.useCallback(x=>{const C=je(r._fields,t);C&&x&&(C._f.ref={focus:()=>x.focus(),select:()=>x.select(),setCustomValidity:b=>x.setCustomValidity(b),reportValidity:()=>x.reportValidity()})},[r._fields,t]),_=nt.useMemo(()=>({name:t,value:s,...zo(n)||c.disabled?{disabled:c.disabled||n}:{},onChange:m,onBlur:g,ref:A}),[t,n,c.disabled,m,g,A,s]);return nt.useEffect(()=>{const x=r._options.shouldUnregister||a;r.register(t,{...u.current.rules,...zo(u.current.disabled)?{disabled:u.current.disabled}:{}});const C=(b,y)=>{const M=je(r._fields,b);M&&M._f&&(M._f.mount=y)};if(C(t,!0),x){const b=Lr(je(r._options.defaultValues,t));ln(r._defaultValues,t,b),$n(je(r._formValues,t))&&ln(r._formValues,t,b)}return!i&&r.register(t),()=>{(i?x&&!r._state.action:x)?r.unregister(t):C(t,!1)}},[t,r,i,a]),nt.useEffect(()=>{r._setDisabledField({disabled:n,name:t})},[n,t,r]),nt.useMemo(()=>({field:_,formState:c,fieldState:f}),[_,c,f])}const oU=o=>o.render(rU(o));var ZI=(o,e,t,n,r)=>e?{...t[o],types:{...t[o]&&t[o].types?t[o].types:{},[n]:r||!0}}:{},_h=o=>Array.isArray(o)?o:[o],FE=()=>{let o=[];return{get observers(){return o},next:r=>{for(const a of o)a.next&&a.next(r)},subscribe:r=>(o.push(r),{unsubscribe:()=>{o=o.filter(a=>a!==r)}}),unsubscribe:()=>{o=[]}}},u2=o=>Jr(o)||!QI(o);function nl(o,e){if(u2(o)||u2(e))return o===e;if(pc(o)&&pc(e))return o.getTime()===e.getTime();const t=Object.keys(o),n=Object.keys(e);if(t.length!==n.length)return!1;for(const r of t){const a=o[r];if(!n.includes(r))return!1;if(r!=="ref"){const i=e[r];if(pc(a)&&pc(i)||Jn(a)&&Jn(i)||Array.isArray(a)&&Array.isArray(i)?!nl(a,i):a!==i)return!1}}return!0}var $r=o=>Jn(o)&&!Object.keys(o).length,By=o=>o.type==="file",La=o=>typeof o=="function",wg=o=>{if(!Ry)return!1;const e=o?o.ownerDocument:0;return o instanceof(e&&e.defaultView?e.defaultView.HTMLElement:HTMLElement)},KI=o=>o.type==="select-multiple",Py=o=>o.type==="radio",aU=o=>Py(o)||ap(o),aA=o=>wg(o)&&o.isConnected;function iU(o,e){const t=e.slice(0,-1).length;let n=0;for(;n<t;)o=$n(o)?n++:o[e[n++]];return o}function sU(o){for(const e in o)if(o.hasOwnProperty(e)&&!$n(o[e]))return!1;return!0}function dr(o,e){const t=Array.isArray(e)?e:Iy(e)?[e]:YI(e),n=t.length===1?o:iU(o,t),r=t.length-1,a=t[r];return n&&delete n[a],r!==0&&(Jn(n)&&$r(n)||Array.isArray(n)&&sU(n))&&dr(o,t.slice(0,-1)),o}var $I=o=>{for(const e in o)if(La(o[e]))return!0;return!1};function Tg(o,e={}){const t=Array.isArray(o);if(Jn(o)||t)for(const n in o)Array.isArray(o[n])||Jn(o[n])&&!$I(o[n])?(e[n]=Array.isArray(o[n])?[]:{},Tg(o[n],e[n])):Jr(o[n])||(e[n]=!0);return e}function JI(o,e,t){const n=Array.isArray(o);if(Jn(o)||n)for(const r in o)Array.isArray(o[r])||Jn(o[r])&&!$I(o[r])?$n(e)||u2(t[r])?t[r]=Array.isArray(o[r])?Tg(o[r],[]):{...Tg(o[r])}:JI(o[r],Jr(e)?{}:e[r],t[r]):t[r]=!nl(o[r],e[r]);return t}var Lf=(o,e)=>JI(o,e,Tg(e));const UE={value:!1,isValid:!1},zE={value:!0,isValid:!0};var eL=o=>{if(Array.isArray(o)){if(o.length>1){const e=o.filter(t=>t&&t.checked&&!t.disabled).map(t=>t.value);return{value:e,isValid:!!e.length}}return o[0].checked&&!o[0].disabled?o[0].attributes&&!$n(o[0].attributes.value)?$n(o[0].value)||o[0].value===""?zE:{value:o[0].value,isValid:!0}:zE:UE}return UE},tL=(o,{valueAsNumber:e,valueAsDate:t,setValueAs:n})=>$n(o)?o:e?o===""?NaN:o&&+o:t&&ai(o)?new Date(o):n?n(o):o;const VE={isValid:!1,value:null};var nL=o=>Array.isArray(o)?o.reduce((e,t)=>t&&t.checked&&!t.disabled?{isValid:!0,value:t.value}:e,VE):VE;function kE(o){const e=o.ref;return By(e)?e.files:Py(e)?nL(o.refs).value:KI(e)?[...e.selectedOptions].map(({value:t})=>t):ap(e)?eL(o.refs).value:tL($n(e.value)?o.ref.value:e.value,o)}var lU=(o,e,t,n)=>{const r={};for(const a of o){const i=je(e,a);i&&ln(r,a,i._f)}return{criteriaMode:t,names:[...o],fields:r,shouldUseNativeValidation:n}},Rg=o=>o instanceof RegExp,Bf=o=>$n(o)?o:Rg(o)?o.source:Jn(o)?Rg(o.value)?o.value.source:o.value:o,GE=o=>({isOnSubmit:!o||o===Ia.onSubmit,isOnBlur:o===Ia.onBlur,isOnChange:o===Ia.onChange,isOnAll:o===Ia.all,isOnTouch:o===Ia.onTouched});const QE="AsyncFunction";var cU=o=>!!o&&!!o.validate&&!!(La(o.validate)&&o.validate.constructor.name===QE||Jn(o.validate)&&Object.values(o.validate).find(e=>e.constructor.name===QE)),uU=o=>o.mount&&(o.required||o.min||o.max||o.maxLength||o.minLength||o.pattern||o.validate),HE=(o,e,t)=>!t&&(e.watchAll||e.watch.has(o)||[...e.watch].some(n=>o.startsWith(n)&&/^\.\w+/.test(o.slice(n.length))));const Ah=(o,e,t,n)=>{for(const r of t||Object.keys(o)){const a=je(o,r);if(a){const{_f:i,...s}=a;if(i){if(i.refs&&i.refs[0]&&e(i.refs[0],r)&&!n)return!0;if(i.ref&&e(i.ref,i.name)&&!n)return!0;if(Ah(s,e))break}else if(Jn(s)&&Ah(s,e))break}}};function WE(o,e,t){const n=je(o,t);if(n||Iy(t))return{error:n,name:t};const r=t.split(".");for(;r.length;){const a=r.join("."),i=je(e,a),s=je(o,a);if(i&&!Array.isArray(i)&&t!==a)return{name:t};if(s&&s.type)return{name:a,error:s};r.pop()}return{name:t}}var dU=(o,e,t,n)=>{t(o);const{name:r,...a}=o;return $r(a)||Object.keys(a).length>=Object.keys(e).length||Object.keys(a).find(i=>e[i]===(!n||Ia.all))},fU=(o,e,t)=>!o||!e||o===e||_h(o).some(n=>n&&(t?n===e:n.startsWith(e)||e.startsWith(n))),hU=(o,e,t,n,r)=>r.isOnAll?!1:!t&&r.isOnTouch?!(e||o):(t?n.isOnBlur:r.isOnBlur)?!o:(t?n.isOnChange:r.isOnChange)?o:!0,pU=(o,e)=>!hv(je(o,e)).length&&dr(o,e),mU=(o,e,t)=>{const n=_h(je(o,t));return ln(n,"root",e[t]),ln(o,t,n),o},lg=o=>ai(o);function YE(o,e,t="validate"){if(lg(o)||Array.isArray(o)&&o.every(lg)||zo(o)&&!o)return{type:t,message:lg(o)?o:"",ref:e}}var pu=o=>Jn(o)&&!Rg(o)?o:{value:o,message:""},jE=async(o,e,t,n,r,a)=>{const{ref:i,refs:s,required:c,maxLength:u,minLength:h,min:f,max:m,pattern:g,validate:A,name:_,valueAsNumber:x,mount:C}=o._f,b=je(t,_);if(!C||e.has(_))return{};const y=s?s[0]:i,M=q=>{r&&y.reportValidity&&(y.setCustomValidity(zo(q)?"":q||""),y.reportValidity())},R={},T=Py(i),w=ap(i),D=T||w,z=(x||By(i))&&$n(i.value)&&$n(b)||wg(i)&&i.value===""||b===""||Array.isArray(b)&&!b.length,F=ZI.bind(null,_,n,R),O=(q,ne,$,he=Gi.maxLength,K=Gi.minLength)=>{const oe=q?ne:$;R[_]={type:q?he:K,message:oe,ref:i,...F(q?he:K,oe)}};if(a?!Array.isArray(b)||!b.length:c&&(!D&&(z||Jr(b))||zo(b)&&!b||w&&!eL(s).isValid||T&&!nL(s).isValid)){const{value:q,message:ne}=lg(c)?{value:!!c,message:c}:pu(c);if(q&&(R[_]={type:Gi.required,message:ne,ref:y,...F(Gi.required,ne)},!n))return M(ne),R}if(!z&&(!Jr(f)||!Jr(m))){let q,ne;const $=pu(m),he=pu(f);if(!Jr(b)&&!isNaN(b)){const K=i.valueAsNumber||b&&+b;Jr($.value)||(q=K>$.value),Jr(he.value)||(ne=K<he.value)}else{const K=i.valueAsDate||new Date(b),oe=U=>new Date(new Date().toDateString()+" "+U),ie=i.type=="time",L=i.type=="week";ai($.value)&&b&&(q=ie?oe(b)>oe($.value):L?b>$.value:K>new Date($.value)),ai(he.value)&&b&&(ne=ie?oe(b)<oe(he.value):L?b<he.value:K<new Date(he.value))}if((q||ne)&&(O(!!q,$.message,he.message,Gi.max,Gi.min),!n))return M(R[_].message),R}if((u||h)&&!z&&(ai(b)||a&&Array.isArray(b))){const q=pu(u),ne=pu(h),$=!Jr(q.value)&&b.length>+q.value,he=!Jr(ne.value)&&b.length<+ne.value;if(($||he)&&(O($,q.message,ne.message),!n))return M(R[_].message),R}if(g&&!z&&ai(b)){const{value:q,message:ne}=pu(g);if(Rg(q)&&!b.match(q)&&(R[_]={type:Gi.pattern,message:ne,ref:i,...F(Gi.pattern,ne)},!n))return M(ne),R}if(A){if(La(A)){const q=await A(b,t),ne=YE(q,y);if(ne&&(R[_]={...ne,...F(Gi.validate,ne.message)},!n))return M(ne.message),R}else if(Jn(A)){let q={};for(const ne in A){if(!$r(q)&&!n)break;const $=YE(await A[ne](b,t),y,ne);$&&(q={...$,...F(ne,$.message)},M($.message),n&&(R[_]=q))}if(!$r(q)&&(R[_]={ref:y,...q},!n))return R}}return M(!0),R};const gU={mode:Ia.onSubmit,reValidateMode:Ia.onChange,shouldFocusError:!0};function vU(o={}){let e={...gU,...o},t={submitCount:0,isDirty:!1,isLoading:La(e.defaultValues),isValidating:!1,isSubmitted:!1,isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,touchedFields:{},dirtyFields:{},validatingFields:{},errors:e.errors||{},disabled:e.disabled||!1};const n={};let r=Jn(e.defaultValues)||Jn(e.values)?Lr(e.values||e.defaultValues)||{}:{},a=e.shouldUnregister?{}:Lr(r),i={action:!1,mount:!1,watch:!1},s={mount:new Set,disabled:new Set,unMount:new Set,array:new Set,watch:new Set},c,u=0;const h={isDirty:!1,dirtyFields:!1,validatingFields:!1,touchedFields:!1,isValidating:!1,isValid:!1,errors:!1};let f={...h};const m={array:FE(),state:FE()},g=GE(e.mode),A=GE(e.reValidateMode),_=e.criteriaMode===Ia.all,x=re=>me=>{clearTimeout(u),u=setTimeout(re,me)},C=async re=>{if(!e.disabled&&(h.isValid||f.isValid||re)){const me=e.resolver?$r((await z()).errors):await O(n,!0);me!==t.isValid&&m.state.next({isValid:me})}},b=(re,me)=>{!e.disabled&&(h.isValidating||h.validatingFields||f.isValidating||f.validatingFields)&&((re||Array.from(s.mount)).forEach(pe=>{pe&&(me?ln(t.validatingFields,pe,me):dr(t.validatingFields,pe))}),m.state.next({validatingFields:t.validatingFields,isValidating:!$r(t.validatingFields)}))},y=(re,me=[],pe,Ce,we=!0,be=!0)=>{if(Ce&&pe&&!e.disabled){if(i.action=!0,be&&Array.isArray(je(n,re))){const Pe=pe(je(n,re),Ce.argA,Ce.argB);we&&ln(n,re,Pe)}if(be&&Array.isArray(je(t.errors,re))){const Pe=pe(je(t.errors,re),Ce.argA,Ce.argB);we&&ln(t.errors,re,Pe),pU(t.errors,re)}if((h.touchedFields||f.touchedFields)&&be&&Array.isArray(je(t.touchedFields,re))){const Pe=pe(je(t.touchedFields,re),Ce.argA,Ce.argB);we&&ln(t.touchedFields,re,Pe)}(h.dirtyFields||f.dirtyFields)&&(t.dirtyFields=Lf(r,a)),m.state.next({name:re,isDirty:ne(re,me),dirtyFields:t.dirtyFields,errors:t.errors,isValid:t.isValid})}else ln(a,re,me)},M=(re,me)=>{ln(t.errors,re,me),m.state.next({errors:t.errors})},R=re=>{t.errors=re,m.state.next({errors:t.errors,isValid:!1})},T=(re,me,pe,Ce)=>{const we=je(n,re);if(we){const be=je(a,re,$n(pe)?je(r,re):pe);$n(be)||Ce&&Ce.defaultChecked||me?ln(a,re,me?be:kE(we._f)):K(re,be),i.mount&&C()}},w=(re,me,pe,Ce,we)=>{let be=!1,Pe=!1;const Ge={name:re};if(!e.disabled){if(!pe||Ce){(h.isDirty||f.isDirty)&&(Pe=t.isDirty,t.isDirty=Ge.isDirty=ne(),be=Pe!==Ge.isDirty);const tt=nl(je(r,re),me);Pe=!!je(t.dirtyFields,re),tt?dr(t.dirtyFields,re):ln(t.dirtyFields,re,!0),Ge.dirtyFields=t.dirtyFields,be=be||(h.dirtyFields||f.dirtyFields)&&Pe!==!tt}if(pe){const tt=je(t.touchedFields,re);tt||(ln(t.touchedFields,re,pe),Ge.touchedFields=t.touchedFields,be=be||(h.touchedFields||f.touchedFields)&&tt!==pe)}be&&we&&m.state.next(Ge)}return be?Ge:{}},D=(re,me,pe,Ce)=>{const we=je(t.errors,re),be=(h.isValid||f.isValid)&&zo(me)&&t.isValid!==me;if(e.delayError&&pe?(c=x(()=>M(re,pe)),c(e.delayError)):(clearTimeout(u),c=null,pe?ln(t.errors,re,pe):dr(t.errors,re)),(pe?!nl(we,pe):we)||!$r(Ce)||be){const Pe={...Ce,...be&&zo(me)?{isValid:me}:{},errors:t.errors,name:re};t={...t,...Pe},m.state.next(Pe)}},z=async re=>{b(re,!0);const me=await e.resolver(a,e.context,lU(re||s.mount,n,e.criteriaMode,e.shouldUseNativeValidation));return b(re),me},F=async re=>{const{errors:me}=await z(re);if(re)for(const pe of re){const Ce=je(me,pe);Ce?ln(t.errors,pe,Ce):dr(t.errors,pe)}else t.errors=me;return me},O=async(re,me,pe={valid:!0})=>{for(const Ce in re){const we=re[Ce];if(we){const{_f:be,...Pe}=we;if(be){const Ge=s.array.has(be.name),tt=we._f&&cU(we._f);tt&&h.validatingFields&&b([Ce],!0);const ot=await jE(we,s.disabled,a,_,e.shouldUseNativeValidation&&!me,Ge);if(tt&&h.validatingFields&&b([Ce]),ot[be.name]&&(pe.valid=!1,me))break;!me&&(je(ot,be.name)?Ge?mU(t.errors,ot,be.name):ln(t.errors,be.name,ot[be.name]):dr(t.errors,be.name))}!$r(Pe)&&await O(Pe,me,pe)}}return pe.valid},q=()=>{for(const re of s.unMount){const me=je(n,re);me&&(me._f.refs?me._f.refs.every(pe=>!aA(pe)):!aA(me._f.ref))&&X(re)}s.unMount=new Set},ne=(re,me)=>!e.disabled&&(re&&me&&ln(a,re,me),!nl(J(),r)),$=(re,me,pe)=>qI(re,s,{...i.mount?a:$n(me)?r:ai(re)?{[re]:me}:me},pe,me),he=re=>hv(je(i.mount?a:r,re,e.shouldUnregister?je(r,re,[]):[])),K=(re,me,pe={})=>{const Ce=je(n,re);let we=me;if(Ce){const be=Ce._f;be&&(!be.disabled&&ln(a,re,tL(me,be)),we=wg(be.ref)&&Jr(me)?"":me,KI(be.ref)?[...be.ref.options].forEach(Pe=>Pe.selected=we.includes(Pe.value)):be.refs?ap(be.ref)?be.refs.length>1?be.refs.forEach(Pe=>(!Pe.defaultChecked||!Pe.disabled)&&(Pe.checked=Array.isArray(we)?!!we.find(Ge=>Ge===Pe.value):we===Pe.value)):be.refs[0]&&(be.refs[0].checked=!!we):be.refs.forEach(Pe=>Pe.checked=Pe.value===we):By(be.ref)?be.ref.value="":(be.ref.value=we,be.ref.type||m.state.next({name:re,values:Lr(a)})))}(pe.shouldDirty||pe.shouldTouch)&&w(re,we,pe.shouldTouch,pe.shouldDirty,!0),pe.shouldValidate&&k(re)},oe=(re,me,pe)=>{for(const Ce in me){const we=me[Ce],be=`${re}.${Ce}`,Pe=je(n,be);(s.array.has(re)||Jn(we)||Pe&&!Pe._f)&&!pc(we)?oe(be,we,pe):K(be,we,pe)}},ie=(re,me,pe={})=>{const Ce=je(n,re),we=s.array.has(re),be=Lr(me);ln(a,re,be),we?(m.array.next({name:re,values:Lr(a)}),(h.isDirty||h.dirtyFields||f.isDirty||f.dirtyFields)&&pe.shouldDirty&&m.state.next({name:re,dirtyFields:Lf(r,a),isDirty:ne(re,be)})):Ce&&!Ce._f&&!Jr(be)?oe(re,be,pe):K(re,be,pe),HE(re,s)&&m.state.next({...t}),m.state.next({name:i.mount?re:void 0,values:Lr(a)})},L=async re=>{i.mount=!0;const me=re.target;let pe=me.name,Ce=!0;const we=je(n,pe),be=Pe=>{Ce=Number.isNaN(Pe)||pc(Pe)&&isNaN(Pe.getTime())||nl(Pe,je(a,pe,Pe))};if(we){let Pe,Ge;const tt=me.type?kE(we._f):HI(re),ot=re.type===Mg.BLUR||re.type===Mg.FOCUS_OUT,Pt=!uU(we._f)&&!e.resolver&&!je(t.errors,pe)&&!we._f.deps||hU(ot,je(t.touchedFields,pe),t.isSubmitted,A,g),$t=HE(pe,s,ot);ln(a,pe,tt),ot?(we._f.onBlur&&we._f.onBlur(re),c&&c(0)):we._f.onChange&&we._f.onChange(re);const St=w(pe,tt,ot),De=!$r(St)||$t;if(!ot&&m.state.next({name:pe,type:re.type,values:Lr(a)}),Pt)return(h.isValid||f.isValid)&&(e.mode==="onBlur"?ot&&C():ot||C()),De&&m.state.next({name:pe,...$t?{}:St});if(!ot&&$t&&m.state.next({...t}),e.resolver){const{errors:Un}=await z([pe]);if(be(tt),Ce){const dn=WE(t.errors,n,pe),Nt=WE(Un,n,dn.name||pe);Pe=Nt.error,pe=Nt.name,Ge=$r(Un)}}else b([pe],!0),Pe=(await jE(we,s.disabled,a,_,e.shouldUseNativeValidation))[pe],b([pe]),be(tt),Ce&&(Pe?Ge=!1:(h.isValid||f.isValid)&&(Ge=await O(n,!0)));Ce&&(we._f.deps&&k(we._f.deps),D(pe,Ge,Pe,St))}},U=(re,me)=>{if(je(t.errors,me)&&re.focus)return re.focus(),1},k=async(re,me={})=>{let pe,Ce;const we=_h(re);if(e.resolver){const be=await F($n(re)?re:we);pe=$r(be),Ce=re?!we.some(Pe=>je(be,Pe)):pe}else re?(Ce=(await Promise.all(we.map(async be=>{const Pe=je(n,be);return await O(Pe&&Pe._f?{[be]:Pe}:Pe)}))).every(Boolean),!(!Ce&&!t.isValid)&&C()):Ce=pe=await O(n);return m.state.next({...!ai(re)||(h.isValid||f.isValid)&&pe!==t.isValid?{}:{name:re},...e.resolver||!re?{isValid:pe}:{},errors:t.errors}),me.shouldFocus&&!Ce&&Ah(n,U,re?we:s.mount),Ce},J=re=>{const me={...i.mount?a:r};return $n(re)?me:ai(re)?je(me,re):re.map(pe=>je(me,pe))},de=(re,me)=>({invalid:!!je((me||t).errors,re),isDirty:!!je((me||t).dirtyFields,re),error:je((me||t).errors,re),isValidating:!!je(t.validatingFields,re),isTouched:!!je((me||t).touchedFields,re)}),te=re=>{re&&_h(re).forEach(me=>dr(t.errors,me)),m.state.next({errors:re?t.errors:{}})},le=(re,me,pe)=>{const Ce=(je(n,re,{_f:{}})._f||{}).ref,we=je(t.errors,re)||{},{ref:be,message:Pe,type:Ge,...tt}=we;ln(t.errors,re,{...tt,...me,ref:Ce}),m.state.next({name:re,errors:t.errors,isValid:!1}),pe&&pe.shouldFocus&&Ce&&Ce.focus&&Ce.focus()},V=(re,me)=>La(re)?m.state.subscribe({next:pe=>re($(void 0,me),pe)}):$(re,me,!0),G=re=>m.state.subscribe({next:me=>{fU(re.name,me.name,re.exact)&&dU(me,re.formState||h,ve,re.reRenderRoot)&&re.callback({values:{...a},...t,...me})}}).unsubscribe,ee=re=>(i.mount=!0,f={...f,...re.formState},G({...re,formState:f})),X=(re,me={})=>{for(const pe of re?_h(re):s.mount)s.mount.delete(pe),s.array.delete(pe),me.keepValue||(dr(n,pe),dr(a,pe)),!me.keepError&&dr(t.errors,pe),!me.keepDirty&&dr(t.dirtyFields,pe),!me.keepTouched&&dr(t.touchedFields,pe),!me.keepIsValidating&&dr(t.validatingFields,pe),!e.shouldUnregister&&!me.keepDefaultValue&&dr(r,pe);m.state.next({values:Lr(a)}),m.state.next({...t,...me.keepDirty?{isDirty:ne()}:{}}),!me.keepIsValid&&C()},W=({disabled:re,name:me})=>{(zo(re)&&i.mount||re||s.disabled.has(me))&&(re?s.disabled.add(me):s.disabled.delete(me))},Y=(re,me={})=>{let pe=je(n,re);const Ce=zo(me.disabled)||zo(e.disabled);return ln(n,re,{...pe||{},_f:{...pe&&pe._f?pe._f:{ref:{name:re}},name:re,mount:!0,...me}}),s.mount.add(re),pe?W({disabled:zo(me.disabled)?me.disabled:e.disabled,name:re}):T(re,!0,me.value),{...Ce?{disabled:me.disabled||e.disabled}:{},...e.progressive?{required:!!me.required,min:Bf(me.min),max:Bf(me.max),minLength:Bf(me.minLength),maxLength:Bf(me.maxLength),pattern:Bf(me.pattern)}:{},name:re,onChange:L,onBlur:L,ref:we=>{if(we){Y(re,me),pe=je(n,re);const be=$n(we.value)&&we.querySelectorAll&&we.querySelectorAll("input,select,textarea")[0]||we,Pe=aU(be),Ge=pe._f.refs||[];if(Pe?Ge.find(tt=>tt===be):be===pe._f.ref)return;ln(n,re,{_f:{...pe._f,...Pe?{refs:[...Ge.filter(aA),be,...Array.isArray(je(r,re))?[{}]:[]],ref:{type:be.type,name:re}}:{ref:be}}}),T(re,!1,void 0,be)}else pe=je(n,re,{}),pe._f&&(pe._f.mount=!1),(e.shouldUnregister||me.shouldUnregister)&&!(WI(s.array,re)&&i.action)&&s.unMount.add(re)}}},P=()=>e.shouldFocusError&&Ah(n,U,s.mount),Q=re=>{zo(re)&&(m.state.next({disabled:re}),Ah(n,(me,pe)=>{const Ce=je(n,pe);Ce&&(me.disabled=Ce._f.disabled||re,Array.isArray(Ce._f.refs)&&Ce._f.refs.forEach(we=>{we.disabled=Ce._f.disabled||re}))},0,!1))},I=(re,me)=>async pe=>{let Ce;pe&&(pe.preventDefault&&pe.preventDefault(),pe.persist&&pe.persist());let we=Lr(a);if(m.state.next({isSubmitting:!0}),e.resolver){const{errors:be,values:Pe}=await z();t.errors=be,we=Pe}else await O(n);if(s.disabled.size)for(const be of s.disabled)ln(we,be,void 0);if(dr(t.errors,"root"),$r(t.errors)){m.state.next({errors:{}});try{await re(we,pe)}catch(be){Ce=be}}else me&&await me({...t.errors},pe),P(),setTimeout(P);if(m.state.next({isSubmitted:!0,isSubmitting:!1,isSubmitSuccessful:$r(t.errors)&&!Ce,submitCount:t.submitCount+1,errors:t.errors}),Ce)throw Ce},N=(re,me={})=>{je(n,re)&&($n(me.defaultValue)?ie(re,Lr(je(r,re))):(ie(re,me.defaultValue),ln(r,re,Lr(me.defaultValue))),me.keepTouched||dr(t.touchedFields,re),me.keepDirty||(dr(t.dirtyFields,re),t.isDirty=me.defaultValue?ne(re,Lr(je(r,re))):ne()),me.keepError||(dr(t.errors,re),h.isValid&&C()),m.state.next({...t}))},se=(re,me={})=>{const pe=re?Lr(re):r,Ce=Lr(pe),we=$r(re),be=we?r:Ce;if(me.keepDefaultValues||(r=pe),!me.keepValues){if(me.keepDirtyValues){const Pe=new Set([...s.mount,...Object.keys(Lf(r,a))]);for(const Ge of Array.from(Pe))je(t.dirtyFields,Ge)?ln(be,Ge,je(a,Ge)):ie(Ge,je(be,Ge))}else{if(Ry&&$n(re))for(const Pe of s.mount){const Ge=je(n,Pe);if(Ge&&Ge._f){const tt=Array.isArray(Ge._f.refs)?Ge._f.refs[0]:Ge._f.ref;if(wg(tt)){const ot=tt.closest("form");if(ot){ot.reset();break}}}}for(const Pe of s.mount)ie(Pe,je(be,Pe))}a=Lr(be),m.array.next({values:{...be}}),m.state.next({values:{...be}})}s={mount:me.keepDirtyValues?s.mount:new Set,unMount:new Set,array:new Set,disabled:new Set,watch:new Set,watchAll:!1,focus:""},i.mount=!h.isValid||!!me.keepIsValid||!!me.keepDirtyValues,i.watch=!!e.shouldUnregister,m.state.next({submitCount:me.keepSubmitCount?t.submitCount:0,isDirty:we?!1:me.keepDirty?t.isDirty:!!(me.keepDefaultValues&&!nl(re,r)),isSubmitted:me.keepIsSubmitted?t.isSubmitted:!1,dirtyFields:we?{}:me.keepDirtyValues?me.keepDefaultValues&&a?Lf(r,a):t.dirtyFields:me.keepDefaultValues&&re?Lf(r,re):me.keepDirty?t.dirtyFields:{},touchedFields:me.keepTouched?t.touchedFields:{},errors:me.keepErrors?t.errors:{},isSubmitSuccessful:me.keepIsSubmitSuccessful?t.isSubmitSuccessful:!1,isSubmitting:!1})},ce=(re,me)=>se(La(re)?re(a):re,me),fe=(re,me={})=>{const pe=je(n,re),Ce=pe&&pe._f;if(Ce){const we=Ce.refs?Ce.refs[0]:Ce.ref;we.focus&&(we.focus(),me.shouldSelect&&La(we.select)&&we.select())}},ve=re=>{t={...t,...re}},Ie={control:{register:Y,unregister:X,getFieldState:de,handleSubmit:I,setError:le,_subscribe:G,_runSchema:z,_getWatch:$,_getDirty:ne,_setValid:C,_setFieldArray:y,_setDisabledField:W,_setErrors:R,_getFieldArray:he,_reset:se,_resetDefaultValues:()=>La(e.defaultValues)&&e.defaultValues().then(re=>{ce(re,e.resetOptions),m.state.next({isLoading:!1})}),_removeUnmounted:q,_disableForm:Q,_subjects:m,_proxyFormState:h,get _fields(){return n},get _formValues(){return a},get _state(){return i},set _state(re){i=re},get _defaultValues(){return r},get _names(){return s},set _names(re){s=re},get _formState(){return t},get _options(){return e},set _options(re){e={...e,...re}}},subscribe:ee,trigger:k,register:Y,handleSubmit:I,watch:V,setValue:ie,getValues:J,reset:ce,resetField:N,clearErrors:te,unregister:X,setError:le,setFocus:fe,getFieldState:de};return{...Ie,formControl:Ie}}function _U(o={}){const e=nt.useRef(void 0),t=nt.useRef(void 0),[n,r]=nt.useState({isDirty:!1,isValidating:!1,isLoading:La(o.defaultValues),isSubmitted:!1,isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,submitCount:0,dirtyFields:{},touchedFields:{},validatingFields:{},errors:o.errors||{},disabled:o.disabled||!1,defaultValues:La(o.defaultValues)?void 0:o.defaultValues});e.current||(e.current={...o.formControl?o.formControl:vU(o),formState:n},o.formControl&&o.defaultValues&&!La(o.defaultValues)&&o.formControl.reset(o.defaultValues,o.resetOptions));const a=e.current.control;return a._options=o,nt.useLayoutEffect(()=>a._subscribe({formState:a._proxyFormState,callback:()=>r({...a._formState}),reRenderRoot:!0}),[a]),nt.useEffect(()=>a._disableForm(o.disabled),[a,o.disabled]),nt.useEffect(()=>{if(a._proxyFormState.isDirty){const i=a._getDirty();i!==n.isDirty&&a._subjects.state.next({isDirty:i})}},[a,n.isDirty]),nt.useEffect(()=>{o.values&&!nl(o.values,t.current)?(a._reset(o.values,a._options.resetOptions),t.current=o.values,r(i=>({...i}))):a._resetDefaultValues()},[o.values,a]),nt.useEffect(()=>{o.errors&&!$r(o.errors)&&a._setErrors(o.errors)},[o.errors,a]),nt.useEffect(()=>{a._state.mount||(a._setValid(),a._state.mount=!0),a._state.watch&&(a._state.watch=!1,a._subjects.state.next({...a._formState})),a._removeUnmounted()}),nt.useEffect(()=>{o.shouldUnregister&&a._subjects.state.next({values:a._getWatch()})},[o.shouldUnregister,a]),e.current.formState=XI(n,a),e.current}const AU=eU;j.createContext({});j.createContext({});var Kt;(function(o){o.assertEqual=r=>r;function e(r){}o.assertIs=e;function t(r){throw new Error}o.assertNever=t,o.arrayToEnum=r=>{const a={};for(const i of r)a[i]=i;return a},o.getValidEnumValues=r=>{const a=o.objectKeys(r).filter(s=>typeof r[r[s]]!="number"),i={};for(const s of a)i[s]=r[s];return o.objectValues(i)},o.objectValues=r=>o.objectKeys(r).map(function(a){return r[a]}),o.objectKeys=typeof Object.keys=="function"?r=>Object.keys(r):r=>{const a=[];for(const i in r)Object.prototype.hasOwnProperty.call(r,i)&&a.push(i);return a},o.find=(r,a)=>{for(const i of r)if(a(i))return i},o.isInteger=typeof Number.isInteger=="function"?r=>Number.isInteger(r):r=>typeof r=="number"&&isFinite(r)&&Math.floor(r)===r;function n(r,a=" | "){return r.map(i=>typeof i=="string"?`'${i}'`:i).join(a)}o.joinValues=n,o.jsonStringifyReplacer=(r,a)=>typeof a=="bigint"?a.toString():a})(Kt||(Kt={}));var d2;(function(o){o.mergeShapes=(e,t)=>({...e,...t})})(d2||(d2={}));const et=Kt.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),os=o=>{switch(typeof o){case"undefined":return et.undefined;case"string":return et.string;case"number":return isNaN(o)?et.nan:et.number;case"boolean":return et.boolean;case"function":return et.function;case"bigint":return et.bigint;case"symbol":return et.symbol;case"object":return Array.isArray(o)?et.array:o===null?et.null:o.then&&typeof o.then=="function"&&o.catch&&typeof o.catch=="function"?et.promise:typeof Map<"u"&&o instanceof Map?et.map:typeof Set<"u"&&o instanceof Set?et.set:typeof Date<"u"&&o instanceof Date?et.date:et.object;default:return et.unknown}},He=Kt.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),xU=o=>JSON.stringify(o,null,2).replace(/"([^"]+)":/g,"$1:");class Ho extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=n=>{this.issues=[...this.issues,n]},this.addIssues=(n=[])=>{this.issues=[...this.issues,...n]};const t=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,this.name="ZodError",this.issues=e}format(e){const t=e||function(a){return a.message},n={_errors:[]},r=a=>{for(const i of a.issues)if(i.code==="invalid_union")i.unionErrors.map(r);else if(i.code==="invalid_return_type")r(i.returnTypeError);else if(i.code==="invalid_arguments")r(i.argumentsError);else if(i.path.length===0)n._errors.push(t(i));else{let s=n,c=0;for(;c<i.path.length;){const u=i.path[c];c===i.path.length-1?(s[u]=s[u]||{_errors:[]},s[u]._errors.push(t(i))):s[u]=s[u]||{_errors:[]},s=s[u],c++}}};return r(this),n}static assert(e){if(!(e instanceof Ho))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,Kt.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=t=>t.message){const t={},n=[];for(const r of this.issues)r.path.length>0?(t[r.path[0]]=t[r.path[0]]||[],t[r.path[0]].push(e(r))):n.push(e(r));return{formErrors:n,fieldErrors:t}}get formErrors(){return this.flatten()}}Ho.create=o=>new Ho(o);const fd=(o,e)=>{let t;switch(o.code){case He.invalid_type:o.received===et.undefined?t="Required":t=`Expected ${o.expected}, received ${o.received}`;break;case He.invalid_literal:t=`Invalid literal value, expected ${JSON.stringify(o.expected,Kt.jsonStringifyReplacer)}`;break;case He.unrecognized_keys:t=`Unrecognized key(s) in object: ${Kt.joinValues(o.keys,", ")}`;break;case He.invalid_union:t="Invalid input";break;case He.invalid_union_discriminator:t=`Invalid discriminator value. Expected ${Kt.joinValues(o.options)}`;break;case He.invalid_enum_value:t=`Invalid enum value. Expected ${Kt.joinValues(o.options)}, received '${o.received}'`;break;case He.invalid_arguments:t="Invalid function arguments";break;case He.invalid_return_type:t="Invalid function return type";break;case He.invalid_date:t="Invalid date";break;case He.invalid_string:typeof o.validation=="object"?"includes"in o.validation?(t=`Invalid input: must include "${o.validation.includes}"`,typeof o.validation.position=="number"&&(t=`${t} at one or more positions greater than or equal to ${o.validation.position}`)):"startsWith"in o.validation?t=`Invalid input: must start with "${o.validation.startsWith}"`:"endsWith"in o.validation?t=`Invalid input: must end with "${o.validation.endsWith}"`:Kt.assertNever(o.validation):o.validation!=="regex"?t=`Invalid ${o.validation}`:t="Invalid";break;case He.too_small:o.type==="array"?t=`Array must contain ${o.exact?"exactly":o.inclusive?"at least":"more than"} ${o.minimum} element(s)`:o.type==="string"?t=`String must contain ${o.exact?"exactly":o.inclusive?"at least":"over"} ${o.minimum} character(s)`:o.type==="number"?t=`Number must be ${o.exact?"exactly equal to ":o.inclusive?"greater than or equal to ":"greater than "}${o.minimum}`:o.type==="date"?t=`Date must be ${o.exact?"exactly equal to ":o.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(o.minimum))}`:t="Invalid input";break;case He.too_big:o.type==="array"?t=`Array must contain ${o.exact?"exactly":o.inclusive?"at most":"less than"} ${o.maximum} element(s)`:o.type==="string"?t=`String must contain ${o.exact?"exactly":o.inclusive?"at most":"under"} ${o.maximum} character(s)`:o.type==="number"?t=`Number must be ${o.exact?"exactly":o.inclusive?"less than or equal to":"less than"} ${o.maximum}`:o.type==="bigint"?t=`BigInt must be ${o.exact?"exactly":o.inclusive?"less than or equal to":"less than"} ${o.maximum}`:o.type==="date"?t=`Date must be ${o.exact?"exactly":o.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(o.maximum))}`:t="Invalid input";break;case He.custom:t="Invalid input";break;case He.invalid_intersection_types:t="Intersection results could not be merged";break;case He.not_multiple_of:t=`Number must be a multiple of ${o.multipleOf}`;break;case He.not_finite:t="Number must be finite";break;default:t=e.defaultError,Kt.assertNever(o)}return{message:t}};let rL=fd;function yU(o){rL=o}function Ig(){return rL}const Lg=o=>{const{data:e,path:t,errorMaps:n,issueData:r}=o,a=[...t,...r.path||[]],i={...r,path:a};if(r.message!==void 0)return{...r,path:a,message:r.message};let s="";const c=n.filter(u=>!!u).slice().reverse();for(const u of c)s=u(i,{data:e,defaultError:s}).message;return{...r,path:a,message:s}},bU=[];function Xe(o,e){const t=Ig(),n=Lg({issueData:e,data:o.data,path:o.path,errorMaps:[o.common.contextualErrorMap,o.schemaErrorMap,t,t===fd?void 0:fd].filter(r=>!!r)});o.common.issues.push(n)}class Wr{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,t){const n=[];for(const r of t){if(r.status==="aborted")return bt;r.status==="dirty"&&e.dirty(),n.push(r.value)}return{status:e.value,value:n}}static async mergeObjectAsync(e,t){const n=[];for(const r of t){const a=await r.key,i=await r.value;n.push({key:a,value:i})}return Wr.mergeObjectSync(e,n)}static mergeObjectSync(e,t){const n={};for(const r of t){const{key:a,value:i}=r;if(a.status==="aborted"||i.status==="aborted")return bt;a.status==="dirty"&&e.dirty(),i.status==="dirty"&&e.dirty(),a.value!=="__proto__"&&(typeof i.value<"u"||r.alwaysSet)&&(n[a.value]=i.value)}return{status:e.value,value:n}}}const bt=Object.freeze({status:"aborted"}),Zu=o=>({status:"dirty",value:o}),ro=o=>({status:"valid",value:o}),f2=o=>o.status==="aborted",h2=o=>o.status==="dirty",Tc=o=>o.status==="valid",Lh=o=>typeof Promise<"u"&&o instanceof Promise;function Bg(o,e,t,n){if(typeof e=="function"?o!==e||!0:!e.has(o))throw new TypeError("Cannot read private member from an object whose class did not declare it");return e.get(o)}function oL(o,e,t,n,r){if(typeof e=="function"?o!==e||!0:!e.has(o))throw new TypeError("Cannot write private member to an object whose class did not declare it");return e.set(o,t),t}var lt;(function(o){o.errToObj=e=>typeof e=="string"?{message:e}:e||{},o.toString=e=>typeof e=="string"?e:e==null?void 0:e.message})(lt||(lt={}));var sh,lh;class mi{constructor(e,t,n,r){this._cachedPath=[],this.parent=e,this.data=t,this._path=n,this._key=r}get path(){return this._cachedPath.length||(this._key instanceof Array?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}const XE=(o,e)=>{if(Tc(e))return{success:!0,data:e.value};if(!o.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const t=new Ho(o.common.issues);return this._error=t,this._error}}};function It(o){if(!o)return{};const{errorMap:e,invalid_type_error:t,required_error:n,description:r}=o;if(e&&(t||n))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:r}:{errorMap:(i,s)=>{var c,u;const{message:h}=o;return i.code==="invalid_enum_value"?{message:h??s.defaultError}:typeof s.data>"u"?{message:(c=h??n)!==null&&c!==void 0?c:s.defaultError}:i.code!=="invalid_type"?{message:s.defaultError}:{message:(u=h??t)!==null&&u!==void 0?u:s.defaultError}},description:r}}class Ut{get description(){return this._def.description}_getType(e){return os(e.data)}_getOrReturnCtx(e,t){return t||{common:e.parent.common,data:e.data,parsedType:os(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new Wr,ctx:{common:e.parent.common,data:e.data,parsedType:os(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){const t=this._parse(e);if(Lh(t))throw new Error("Synchronous parse encountered promise.");return t}_parseAsync(e){const t=this._parse(e);return Promise.resolve(t)}parse(e,t){const n=this.safeParse(e,t);if(n.success)return n.data;throw n.error}safeParse(e,t){var n;const r={common:{issues:[],async:(n=t==null?void 0:t.async)!==null&&n!==void 0?n:!1,contextualErrorMap:t==null?void 0:t.errorMap},path:(t==null?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:os(e)},a=this._parseSync({data:e,path:r.path,parent:r});return XE(r,a)}"~validate"(e){var t,n;const r={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:os(e)};if(!this["~standard"].async)try{const a=this._parseSync({data:e,path:[],parent:r});return Tc(a)?{value:a.value}:{issues:r.common.issues}}catch(a){!((n=(t=a==null?void 0:a.message)===null||t===void 0?void 0:t.toLowerCase())===null||n===void 0)&&n.includes("encountered")&&(this["~standard"].async=!0),r.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:r}).then(a=>Tc(a)?{value:a.value}:{issues:r.common.issues})}async parseAsync(e,t){const n=await this.safeParseAsync(e,t);if(n.success)return n.data;throw n.error}async safeParseAsync(e,t){const n={common:{issues:[],contextualErrorMap:t==null?void 0:t.errorMap,async:!0},path:(t==null?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:os(e)},r=this._parse({data:e,path:n.path,parent:n}),a=await(Lh(r)?r:Promise.resolve(r));return XE(n,a)}refine(e,t){const n=r=>typeof t=="string"||typeof t>"u"?{message:t}:typeof t=="function"?t(r):t;return this._refinement((r,a)=>{const i=e(r),s=()=>a.addIssue({code:He.custom,...n(r)});return typeof Promise<"u"&&i instanceof Promise?i.then(c=>c?!0:(s(),!1)):i?!0:(s(),!1)})}refinement(e,t){return this._refinement((n,r)=>e(n)?!0:(r.addIssue(typeof t=="function"?t(n,r):t),!1))}_refinement(e){return new Va({schema:this,typeName:yt.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:t=>this["~validate"](t)}}optional(){return ci.create(this,this._def)}nullable(){return hl.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return Oa.create(this)}promise(){return pd.create(this,this._def)}or(e){return Dh.create([this,e],this._def)}and(e){return Oh.create(this,e,this._def)}transform(e){return new Va({...It(this._def),schema:this,typeName:yt.ZodEffects,effect:{type:"transform",transform:e}})}default(e){const t=typeof e=="function"?e:()=>e;return new kh({...It(this._def),innerType:this,defaultValue:t,typeName:yt.ZodDefault})}brand(){return new Ny({typeName:yt.ZodBranded,type:this,...It(this._def)})}catch(e){const t=typeof e=="function"?e:()=>e;return new Gh({...It(this._def),innerType:this,catchValue:t,typeName:yt.ZodCatch})}describe(e){const t=this.constructor;return new t({...this._def,description:e})}pipe(e){return ip.create(this,e)}readonly(){return Qh.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}const SU=/^c[^\s-]{8,}$/i,CU=/^[0-9a-z]+$/,EU=/^[0-9A-HJKMNP-TV-Z]{26}$/i,MU=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,wU=/^[a-z0-9_-]{21}$/i,TU=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,RU=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,IU=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,LU="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";let iA;const BU=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,PU=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,NU=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,DU=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,OU=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,FU=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,aL="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",UU=new RegExp(`^${aL}$`);function iL(o){let e="([01]\\d|2[0-3]):[0-5]\\d:[0-5]\\d";return o.precision?e=`${e}\\.\\d{${o.precision}}`:o.precision==null&&(e=`${e}(\\.\\d+)?`),e}function zU(o){return new RegExp(`^${iL(o)}$`)}function sL(o){let e=`${aL}T${iL(o)}`;const t=[];return t.push(o.local?"Z?":"Z"),o.offset&&t.push("([+-]\\d{2}:?\\d{2})"),e=`${e}(${t.join("|")})`,new RegExp(`^${e}$`)}function VU(o,e){return!!((e==="v4"||!e)&&BU.test(o)||(e==="v6"||!e)&&NU.test(o))}function kU(o,e){if(!TU.test(o))return!1;try{const[t]=o.split("."),n=t.replace(/-/g,"+").replace(/_/g,"/").padEnd(t.length+(4-t.length%4)%4,"="),r=JSON.parse(atob(n));return!(typeof r!="object"||r===null||!r.typ||!r.alg||e&&r.alg!==e)}catch{return!1}}function GU(o,e){return!!((e==="v4"||!e)&&PU.test(o)||(e==="v6"||!e)&&DU.test(o))}class Na extends Ut{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==et.string){const a=this._getOrReturnCtx(e);return Xe(a,{code:He.invalid_type,expected:et.string,received:a.parsedType}),bt}const n=new Wr;let r;for(const a of this._def.checks)if(a.kind==="min")e.data.length<a.value&&(r=this._getOrReturnCtx(e,r),Xe(r,{code:He.too_small,minimum:a.value,type:"string",inclusive:!0,exact:!1,message:a.message}),n.dirty());else if(a.kind==="max")e.data.length>a.value&&(r=this._getOrReturnCtx(e,r),Xe(r,{code:He.too_big,maximum:a.value,type:"string",inclusive:!0,exact:!1,message:a.message}),n.dirty());else if(a.kind==="length"){const i=e.data.length>a.value,s=e.data.length<a.value;(i||s)&&(r=this._getOrReturnCtx(e,r),i?Xe(r,{code:He.too_big,maximum:a.value,type:"string",inclusive:!0,exact:!0,message:a.message}):s&&Xe(r,{code:He.too_small,minimum:a.value,type:"string",inclusive:!0,exact:!0,message:a.message}),n.dirty())}else if(a.kind==="email")IU.test(e.data)||(r=this._getOrReturnCtx(e,r),Xe(r,{validation:"email",code:He.invalid_string,message:a.message}),n.dirty());else if(a.kind==="emoji")iA||(iA=new RegExp(LU,"u")),iA.test(e.data)||(r=this._getOrReturnCtx(e,r),Xe(r,{validation:"emoji",code:He.invalid_string,message:a.message}),n.dirty());else if(a.kind==="uuid")MU.test(e.data)||(r=this._getOrReturnCtx(e,r),Xe(r,{validation:"uuid",code:He.invalid_string,message:a.message}),n.dirty());else if(a.kind==="nanoid")wU.test(e.data)||(r=this._getOrReturnCtx(e,r),Xe(r,{validation:"nanoid",code:He.invalid_string,message:a.message}),n.dirty());else if(a.kind==="cuid")SU.test(e.data)||(r=this._getOrReturnCtx(e,r),Xe(r,{validation:"cuid",code:He.invalid_string,message:a.message}),n.dirty());else if(a.kind==="cuid2")CU.test(e.data)||(r=this._getOrReturnCtx(e,r),Xe(r,{validation:"cuid2",code:He.invalid_string,message:a.message}),n.dirty());else if(a.kind==="ulid")EU.test(e.data)||(r=this._getOrReturnCtx(e,r),Xe(r,{validation:"ulid",code:He.invalid_string,message:a.message}),n.dirty());else if(a.kind==="url")try{new URL(e.data)}catch{r=this._getOrReturnCtx(e,r),Xe(r,{validation:"url",code:He.invalid_string,message:a.message}),n.dirty()}else a.kind==="regex"?(a.regex.lastIndex=0,a.regex.test(e.data)||(r=this._getOrReturnCtx(e,r),Xe(r,{validation:"regex",code:He.invalid_string,message:a.message}),n.dirty())):a.kind==="trim"?e.data=e.data.trim():a.kind==="includes"?e.data.includes(a.value,a.position)||(r=this._getOrReturnCtx(e,r),Xe(r,{code:He.invalid_string,validation:{includes:a.value,position:a.position},message:a.message}),n.dirty()):a.kind==="toLowerCase"?e.data=e.data.toLowerCase():a.kind==="toUpperCase"?e.data=e.data.toUpperCase():a.kind==="startsWith"?e.data.startsWith(a.value)||(r=this._getOrReturnCtx(e,r),Xe(r,{code:He.invalid_string,validation:{startsWith:a.value},message:a.message}),n.dirty()):a.kind==="endsWith"?e.data.endsWith(a.value)||(r=this._getOrReturnCtx(e,r),Xe(r,{code:He.invalid_string,validation:{endsWith:a.value},message:a.message}),n.dirty()):a.kind==="datetime"?sL(a).test(e.data)||(r=this._getOrReturnCtx(e,r),Xe(r,{code:He.invalid_string,validation:"datetime",message:a.message}),n.dirty()):a.kind==="date"?UU.test(e.data)||(r=this._getOrReturnCtx(e,r),Xe(r,{code:He.invalid_string,validation:"date",message:a.message}),n.dirty()):a.kind==="time"?zU(a).test(e.data)||(r=this._getOrReturnCtx(e,r),Xe(r,{code:He.invalid_string,validation:"time",message:a.message}),n.dirty()):a.kind==="duration"?RU.test(e.data)||(r=this._getOrReturnCtx(e,r),Xe(r,{validation:"duration",code:He.invalid_string,message:a.message}),n.dirty()):a.kind==="ip"?VU(e.data,a.version)||(r=this._getOrReturnCtx(e,r),Xe(r,{validation:"ip",code:He.invalid_string,message:a.message}),n.dirty()):a.kind==="jwt"?kU(e.data,a.alg)||(r=this._getOrReturnCtx(e,r),Xe(r,{validation:"jwt",code:He.invalid_string,message:a.message}),n.dirty()):a.kind==="cidr"?GU(e.data,a.version)||(r=this._getOrReturnCtx(e,r),Xe(r,{validation:"cidr",code:He.invalid_string,message:a.message}),n.dirty()):a.kind==="base64"?OU.test(e.data)||(r=this._getOrReturnCtx(e,r),Xe(r,{validation:"base64",code:He.invalid_string,message:a.message}),n.dirty()):a.kind==="base64url"?FU.test(e.data)||(r=this._getOrReturnCtx(e,r),Xe(r,{validation:"base64url",code:He.invalid_string,message:a.message}),n.dirty()):Kt.assertNever(a);return{status:n.value,value:e.data}}_regex(e,t,n){return this.refinement(r=>e.test(r),{validation:t,code:He.invalid_string,...lt.errToObj(n)})}_addCheck(e){return new Na({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...lt.errToObj(e)})}url(e){return this._addCheck({kind:"url",...lt.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...lt.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...lt.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...lt.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...lt.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...lt.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...lt.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...lt.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...lt.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...lt.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...lt.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...lt.errToObj(e)})}datetime(e){var t,n;return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:typeof(e==null?void 0:e.precision)>"u"?null:e==null?void 0:e.precision,offset:(t=e==null?void 0:e.offset)!==null&&t!==void 0?t:!1,local:(n=e==null?void 0:e.local)!==null&&n!==void 0?n:!1,...lt.errToObj(e==null?void 0:e.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return typeof e=="string"?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:typeof(e==null?void 0:e.precision)>"u"?null:e==null?void 0:e.precision,...lt.errToObj(e==null?void 0:e.message)})}duration(e){return this._addCheck({kind:"duration",...lt.errToObj(e)})}regex(e,t){return this._addCheck({kind:"regex",regex:e,...lt.errToObj(t)})}includes(e,t){return this._addCheck({kind:"includes",value:e,position:t==null?void 0:t.position,...lt.errToObj(t==null?void 0:t.message)})}startsWith(e,t){return this._addCheck({kind:"startsWith",value:e,...lt.errToObj(t)})}endsWith(e,t){return this._addCheck({kind:"endsWith",value:e,...lt.errToObj(t)})}min(e,t){return this._addCheck({kind:"min",value:e,...lt.errToObj(t)})}max(e,t){return this._addCheck({kind:"max",value:e,...lt.errToObj(t)})}length(e,t){return this._addCheck({kind:"length",value:e,...lt.errToObj(t)})}nonempty(e){return this.min(1,lt.errToObj(e))}trim(){return new Na({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new Na({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new Na({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>e.kind==="datetime")}get isDate(){return!!this._def.checks.find(e=>e.kind==="date")}get isTime(){return!!this._def.checks.find(e=>e.kind==="time")}get isDuration(){return!!this._def.checks.find(e=>e.kind==="duration")}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isEmoji(){return!!this._def.checks.find(e=>e.kind==="emoji")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(e=>e.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(e=>e.kind==="cuid2")}get isULID(){return!!this._def.checks.find(e=>e.kind==="ulid")}get isIP(){return!!this._def.checks.find(e=>e.kind==="ip")}get isCIDR(){return!!this._def.checks.find(e=>e.kind==="cidr")}get isBase64(){return!!this._def.checks.find(e=>e.kind==="base64")}get isBase64url(){return!!this._def.checks.find(e=>e.kind==="base64url")}get minLength(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxLength(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}}Na.create=o=>{var e;return new Na({checks:[],typeName:yt.ZodString,coerce:(e=o==null?void 0:o.coerce)!==null&&e!==void 0?e:!1,...It(o)})};function QU(o,e){const t=(o.toString().split(".")[1]||"").length,n=(e.toString().split(".")[1]||"").length,r=t>n?t:n,a=parseInt(o.toFixed(r).replace(".","")),i=parseInt(e.toFixed(r).replace(".",""));return a%i/Math.pow(10,r)}class ul extends Ut{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==et.number){const a=this._getOrReturnCtx(e);return Xe(a,{code:He.invalid_type,expected:et.number,received:a.parsedType}),bt}let n;const r=new Wr;for(const a of this._def.checks)a.kind==="int"?Kt.isInteger(e.data)||(n=this._getOrReturnCtx(e,n),Xe(n,{code:He.invalid_type,expected:"integer",received:"float",message:a.message}),r.dirty()):a.kind==="min"?(a.inclusive?e.data<a.value:e.data<=a.value)&&(n=this._getOrReturnCtx(e,n),Xe(n,{code:He.too_small,minimum:a.value,type:"number",inclusive:a.inclusive,exact:!1,message:a.message}),r.dirty()):a.kind==="max"?(a.inclusive?e.data>a.value:e.data>=a.value)&&(n=this._getOrReturnCtx(e,n),Xe(n,{code:He.too_big,maximum:a.value,type:"number",inclusive:a.inclusive,exact:!1,message:a.message}),r.dirty()):a.kind==="multipleOf"?QU(e.data,a.value)!==0&&(n=this._getOrReturnCtx(e,n),Xe(n,{code:He.not_multiple_of,multipleOf:a.value,message:a.message}),r.dirty()):a.kind==="finite"?Number.isFinite(e.data)||(n=this._getOrReturnCtx(e,n),Xe(n,{code:He.not_finite,message:a.message}),r.dirty()):Kt.assertNever(a);return{status:r.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,lt.toString(t))}gt(e,t){return this.setLimit("min",e,!1,lt.toString(t))}lte(e,t){return this.setLimit("max",e,!0,lt.toString(t))}lt(e,t){return this.setLimit("max",e,!1,lt.toString(t))}setLimit(e,t,n,r){return new ul({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:n,message:lt.toString(r)}]})}_addCheck(e){return new ul({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:lt.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:lt.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:lt.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:lt.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:lt.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:lt.toString(t)})}finite(e){return this._addCheck({kind:"finite",message:lt.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:lt.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:lt.toString(e)})}get minValue(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int"||e.kind==="multipleOf"&&Kt.isInteger(e.value))}get isFinite(){let e=null,t=null;for(const n of this._def.checks){if(n.kind==="finite"||n.kind==="int"||n.kind==="multipleOf")return!0;n.kind==="min"?(t===null||n.value>t)&&(t=n.value):n.kind==="max"&&(e===null||n.value<e)&&(e=n.value)}return Number.isFinite(t)&&Number.isFinite(e)}}ul.create=o=>new ul({checks:[],typeName:yt.ZodNumber,coerce:(o==null?void 0:o.coerce)||!1,...It(o)});class dl extends Ut{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce)try{e.data=BigInt(e.data)}catch{return this._getInvalidInput(e)}if(this._getType(e)!==et.bigint)return this._getInvalidInput(e);let n;const r=new Wr;for(const a of this._def.checks)a.kind==="min"?(a.inclusive?e.data<a.value:e.data<=a.value)&&(n=this._getOrReturnCtx(e,n),Xe(n,{code:He.too_small,type:"bigint",minimum:a.value,inclusive:a.inclusive,message:a.message}),r.dirty()):a.kind==="max"?(a.inclusive?e.data>a.value:e.data>=a.value)&&(n=this._getOrReturnCtx(e,n),Xe(n,{code:He.too_big,type:"bigint",maximum:a.value,inclusive:a.inclusive,message:a.message}),r.dirty()):a.kind==="multipleOf"?e.data%a.value!==BigInt(0)&&(n=this._getOrReturnCtx(e,n),Xe(n,{code:He.not_multiple_of,multipleOf:a.value,message:a.message}),r.dirty()):Kt.assertNever(a);return{status:r.value,value:e.data}}_getInvalidInput(e){const t=this._getOrReturnCtx(e);return Xe(t,{code:He.invalid_type,expected:et.bigint,received:t.parsedType}),bt}gte(e,t){return this.setLimit("min",e,!0,lt.toString(t))}gt(e,t){return this.setLimit("min",e,!1,lt.toString(t))}lte(e,t){return this.setLimit("max",e,!0,lt.toString(t))}lt(e,t){return this.setLimit("max",e,!1,lt.toString(t))}setLimit(e,t,n,r){return new dl({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:n,message:lt.toString(r)}]})}_addCheck(e){return new dl({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:lt.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:lt.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:lt.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:lt.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:lt.toString(t)})}get minValue(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}}dl.create=o=>{var e;return new dl({checks:[],typeName:yt.ZodBigInt,coerce:(e=o==null?void 0:o.coerce)!==null&&e!==void 0?e:!1,...It(o)})};class Bh extends Ut{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==et.boolean){const n=this._getOrReturnCtx(e);return Xe(n,{code:He.invalid_type,expected:et.boolean,received:n.parsedType}),bt}return ro(e.data)}}Bh.create=o=>new Bh({typeName:yt.ZodBoolean,coerce:(o==null?void 0:o.coerce)||!1,...It(o)});class Rc extends Ut{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==et.date){const a=this._getOrReturnCtx(e);return Xe(a,{code:He.invalid_type,expected:et.date,received:a.parsedType}),bt}if(isNaN(e.data.getTime())){const a=this._getOrReturnCtx(e);return Xe(a,{code:He.invalid_date}),bt}const n=new Wr;let r;for(const a of this._def.checks)a.kind==="min"?e.data.getTime()<a.value&&(r=this._getOrReturnCtx(e,r),Xe(r,{code:He.too_small,message:a.message,inclusive:!0,exact:!1,minimum:a.value,type:"date"}),n.dirty()):a.kind==="max"?e.data.getTime()>a.value&&(r=this._getOrReturnCtx(e,r),Xe(r,{code:He.too_big,message:a.message,inclusive:!0,exact:!1,maximum:a.value,type:"date"}),n.dirty()):Kt.assertNever(a);return{status:n.value,value:new Date(e.data.getTime())}}_addCheck(e){return new Rc({...this._def,checks:[...this._def.checks,e]})}min(e,t){return this._addCheck({kind:"min",value:e.getTime(),message:lt.toString(t)})}max(e,t){return this._addCheck({kind:"max",value:e.getTime(),message:lt.toString(t)})}get minDate(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e!=null?new Date(e):null}get maxDate(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e!=null?new Date(e):null}}Rc.create=o=>new Rc({checks:[],coerce:(o==null?void 0:o.coerce)||!1,typeName:yt.ZodDate,...It(o)});class Pg extends Ut{_parse(e){if(this._getType(e)!==et.symbol){const n=this._getOrReturnCtx(e);return Xe(n,{code:He.invalid_type,expected:et.symbol,received:n.parsedType}),bt}return ro(e.data)}}Pg.create=o=>new Pg({typeName:yt.ZodSymbol,...It(o)});class Ph extends Ut{_parse(e){if(this._getType(e)!==et.undefined){const n=this._getOrReturnCtx(e);return Xe(n,{code:He.invalid_type,expected:et.undefined,received:n.parsedType}),bt}return ro(e.data)}}Ph.create=o=>new Ph({typeName:yt.ZodUndefined,...It(o)});class Nh extends Ut{_parse(e){if(this._getType(e)!==et.null){const n=this._getOrReturnCtx(e);return Xe(n,{code:He.invalid_type,expected:et.null,received:n.parsedType}),bt}return ro(e.data)}}Nh.create=o=>new Nh({typeName:yt.ZodNull,...It(o)});class hd extends Ut{constructor(){super(...arguments),this._any=!0}_parse(e){return ro(e.data)}}hd.create=o=>new hd({typeName:yt.ZodAny,...It(o)});class _c extends Ut{constructor(){super(...arguments),this._unknown=!0}_parse(e){return ro(e.data)}}_c.create=o=>new _c({typeName:yt.ZodUnknown,...It(o)});class hs extends Ut{_parse(e){const t=this._getOrReturnCtx(e);return Xe(t,{code:He.invalid_type,expected:et.never,received:t.parsedType}),bt}}hs.create=o=>new hs({typeName:yt.ZodNever,...It(o)});class Ng extends Ut{_parse(e){if(this._getType(e)!==et.undefined){const n=this._getOrReturnCtx(e);return Xe(n,{code:He.invalid_type,expected:et.void,received:n.parsedType}),bt}return ro(e.data)}}Ng.create=o=>new Ng({typeName:yt.ZodVoid,...It(o)});class Oa extends Ut{_parse(e){const{ctx:t,status:n}=this._processInputParams(e),r=this._def;if(t.parsedType!==et.array)return Xe(t,{code:He.invalid_type,expected:et.array,received:t.parsedType}),bt;if(r.exactLength!==null){const i=t.data.length>r.exactLength.value,s=t.data.length<r.exactLength.value;(i||s)&&(Xe(t,{code:i?He.too_big:He.too_small,minimum:s?r.exactLength.value:void 0,maximum:i?r.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:r.exactLength.message}),n.dirty())}if(r.minLength!==null&&t.data.length<r.minLength.value&&(Xe(t,{code:He.too_small,minimum:r.minLength.value,type:"array",inclusive:!0,exact:!1,message:r.minLength.message}),n.dirty()),r.maxLength!==null&&t.data.length>r.maxLength.value&&(Xe(t,{code:He.too_big,maximum:r.maxLength.value,type:"array",inclusive:!0,exact:!1,message:r.maxLength.message}),n.dirty()),t.common.async)return Promise.all([...t.data].map((i,s)=>r.type._parseAsync(new mi(t,i,t.path,s)))).then(i=>Wr.mergeArray(n,i));const a=[...t.data].map((i,s)=>r.type._parseSync(new mi(t,i,t.path,s)));return Wr.mergeArray(n,a)}get element(){return this._def.type}min(e,t){return new Oa({...this._def,minLength:{value:e,message:lt.toString(t)}})}max(e,t){return new Oa({...this._def,maxLength:{value:e,message:lt.toString(t)}})}length(e,t){return new Oa({...this._def,exactLength:{value:e,message:lt.toString(t)}})}nonempty(e){return this.min(1,e)}}Oa.create=(o,e)=>new Oa({type:o,minLength:null,maxLength:null,exactLength:null,typeName:yt.ZodArray,...It(e)});function qu(o){if(o instanceof On){const e={};for(const t in o.shape){const n=o.shape[t];e[t]=ci.create(qu(n))}return new On({...o._def,shape:()=>e})}else return o instanceof Oa?new Oa({...o._def,type:qu(o.element)}):o instanceof ci?ci.create(qu(o.unwrap())):o instanceof hl?hl.create(qu(o.unwrap())):o instanceof gi?gi.create(o.items.map(e=>qu(e))):o}class On extends Ut{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;const e=this._def.shape(),t=Kt.objectKeys(e);return this._cached={shape:e,keys:t}}_parse(e){if(this._getType(e)!==et.object){const u=this._getOrReturnCtx(e);return Xe(u,{code:He.invalid_type,expected:et.object,received:u.parsedType}),bt}const{status:n,ctx:r}=this._processInputParams(e),{shape:a,keys:i}=this._getCached(),s=[];if(!(this._def.catchall instanceof hs&&this._def.unknownKeys==="strip"))for(const u in r.data)i.includes(u)||s.push(u);const c=[];for(const u of i){const h=a[u],f=r.data[u];c.push({key:{status:"valid",value:u},value:h._parse(new mi(r,f,r.path,u)),alwaysSet:u in r.data})}if(this._def.catchall instanceof hs){const u=this._def.unknownKeys;if(u==="passthrough")for(const h of s)c.push({key:{status:"valid",value:h},value:{status:"valid",value:r.data[h]}});else if(u==="strict")s.length>0&&(Xe(r,{code:He.unrecognized_keys,keys:s}),n.dirty());else if(u!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const u=this._def.catchall;for(const h of s){const f=r.data[h];c.push({key:{status:"valid",value:h},value:u._parse(new mi(r,f,r.path,h)),alwaysSet:h in r.data})}}return r.common.async?Promise.resolve().then(async()=>{const u=[];for(const h of c){const f=await h.key,m=await h.value;u.push({key:f,value:m,alwaysSet:h.alwaysSet})}return u}).then(u=>Wr.mergeObjectSync(n,u)):Wr.mergeObjectSync(n,c)}get shape(){return this._def.shape()}strict(e){return lt.errToObj,new On({...this._def,unknownKeys:"strict",...e!==void 0?{errorMap:(t,n)=>{var r,a,i,s;const c=(i=(a=(r=this._def).errorMap)===null||a===void 0?void 0:a.call(r,t,n).message)!==null&&i!==void 0?i:n.defaultError;return t.code==="unrecognized_keys"?{message:(s=lt.errToObj(e).message)!==null&&s!==void 0?s:c}:{message:c}}}:{}})}strip(){return new On({...this._def,unknownKeys:"strip"})}passthrough(){return new On({...this._def,unknownKeys:"passthrough"})}extend(e){return new On({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new On({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:yt.ZodObject})}setKey(e,t){return this.augment({[e]:t})}catchall(e){return new On({...this._def,catchall:e})}pick(e){const t={};return Kt.objectKeys(e).forEach(n=>{e[n]&&this.shape[n]&&(t[n]=this.shape[n])}),new On({...this._def,shape:()=>t})}omit(e){const t={};return Kt.objectKeys(this.shape).forEach(n=>{e[n]||(t[n]=this.shape[n])}),new On({...this._def,shape:()=>t})}deepPartial(){return qu(this)}partial(e){const t={};return Kt.objectKeys(this.shape).forEach(n=>{const r=this.shape[n];e&&!e[n]?t[n]=r:t[n]=r.optional()}),new On({...this._def,shape:()=>t})}required(e){const t={};return Kt.objectKeys(this.shape).forEach(n=>{if(e&&!e[n])t[n]=this.shape[n];else{let a=this.shape[n];for(;a instanceof ci;)a=a._def.innerType;t[n]=a}}),new On({...this._def,shape:()=>t})}keyof(){return lL(Kt.objectKeys(this.shape))}}On.create=(o,e)=>new On({shape:()=>o,unknownKeys:"strip",catchall:hs.create(),typeName:yt.ZodObject,...It(e)});On.strictCreate=(o,e)=>new On({shape:()=>o,unknownKeys:"strict",catchall:hs.create(),typeName:yt.ZodObject,...It(e)});On.lazycreate=(o,e)=>new On({shape:o,unknownKeys:"strip",catchall:hs.create(),typeName:yt.ZodObject,...It(e)});class Dh extends Ut{_parse(e){const{ctx:t}=this._processInputParams(e),n=this._def.options;function r(a){for(const s of a)if(s.result.status==="valid")return s.result;for(const s of a)if(s.result.status==="dirty")return t.common.issues.push(...s.ctx.common.issues),s.result;const i=a.map(s=>new Ho(s.ctx.common.issues));return Xe(t,{code:He.invalid_union,unionErrors:i}),bt}if(t.common.async)return Promise.all(n.map(async a=>{const i={...t,common:{...t.common,issues:[]},parent:null};return{result:await a._parseAsync({data:t.data,path:t.path,parent:i}),ctx:i}})).then(r);{let a;const i=[];for(const c of n){const u={...t,common:{...t.common,issues:[]},parent:null},h=c._parseSync({data:t.data,path:t.path,parent:u});if(h.status==="valid")return h;h.status==="dirty"&&!a&&(a={result:h,ctx:u}),u.common.issues.length&&i.push(u.common.issues)}if(a)return t.common.issues.push(...a.ctx.common.issues),a.result;const s=i.map(c=>new Ho(c));return Xe(t,{code:He.invalid_union,unionErrors:s}),bt}}get options(){return this._def.options}}Dh.create=(o,e)=>new Dh({options:o,typeName:yt.ZodUnion,...It(e)});const ns=o=>o instanceof Uh?ns(o.schema):o instanceof Va?ns(o.innerType()):o instanceof zh?[o.value]:o instanceof fl?o.options:o instanceof Vh?Kt.objectValues(o.enum):o instanceof kh?ns(o._def.innerType):o instanceof Ph?[void 0]:o instanceof Nh?[null]:o instanceof ci?[void 0,...ns(o.unwrap())]:o instanceof hl?[null,...ns(o.unwrap())]:o instanceof Ny||o instanceof Qh?ns(o.unwrap()):o instanceof Gh?ns(o._def.innerType):[];class pv extends Ut{_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==et.object)return Xe(t,{code:He.invalid_type,expected:et.object,received:t.parsedType}),bt;const n=this.discriminator,r=t.data[n],a=this.optionsMap.get(r);return a?t.common.async?a._parseAsync({data:t.data,path:t.path,parent:t}):a._parseSync({data:t.data,path:t.path,parent:t}):(Xe(t,{code:He.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[n]}),bt)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,t,n){const r=new Map;for(const a of t){const i=ns(a.shape[e]);if(!i.length)throw new Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(const s of i){if(r.has(s))throw new Error(`Discriminator property ${String(e)} has duplicate value ${String(s)}`);r.set(s,a)}}return new pv({typeName:yt.ZodDiscriminatedUnion,discriminator:e,options:t,optionsMap:r,...It(n)})}}function p2(o,e){const t=os(o),n=os(e);if(o===e)return{valid:!0,data:o};if(t===et.object&&n===et.object){const r=Kt.objectKeys(e),a=Kt.objectKeys(o).filter(s=>r.indexOf(s)!==-1),i={...o,...e};for(const s of a){const c=p2(o[s],e[s]);if(!c.valid)return{valid:!1};i[s]=c.data}return{valid:!0,data:i}}else if(t===et.array&&n===et.array){if(o.length!==e.length)return{valid:!1};const r=[];for(let a=0;a<o.length;a++){const i=o[a],s=e[a],c=p2(i,s);if(!c.valid)return{valid:!1};r.push(c.data)}return{valid:!0,data:r}}else return t===et.date&&n===et.date&&+o==+e?{valid:!0,data:o}:{valid:!1}}class Oh extends Ut{_parse(e){const{status:t,ctx:n}=this._processInputParams(e),r=(a,i)=>{if(f2(a)||f2(i))return bt;const s=p2(a.value,i.value);return s.valid?((h2(a)||h2(i))&&t.dirty(),{status:t.value,value:s.data}):(Xe(n,{code:He.invalid_intersection_types}),bt)};return n.common.async?Promise.all([this._def.left._parseAsync({data:n.data,path:n.path,parent:n}),this._def.right._parseAsync({data:n.data,path:n.path,parent:n})]).then(([a,i])=>r(a,i)):r(this._def.left._parseSync({data:n.data,path:n.path,parent:n}),this._def.right._parseSync({data:n.data,path:n.path,parent:n}))}}Oh.create=(o,e,t)=>new Oh({left:o,right:e,typeName:yt.ZodIntersection,...It(t)});class gi extends Ut{_parse(e){const{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==et.array)return Xe(n,{code:He.invalid_type,expected:et.array,received:n.parsedType}),bt;if(n.data.length<this._def.items.length)return Xe(n,{code:He.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),bt;!this._def.rest&&n.data.length>this._def.items.length&&(Xe(n,{code:He.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),t.dirty());const a=[...n.data].map((i,s)=>{const c=this._def.items[s]||this._def.rest;return c?c._parse(new mi(n,i,n.path,s)):null}).filter(i=>!!i);return n.common.async?Promise.all(a).then(i=>Wr.mergeArray(t,i)):Wr.mergeArray(t,a)}get items(){return this._def.items}rest(e){return new gi({...this._def,rest:e})}}gi.create=(o,e)=>{if(!Array.isArray(o))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new gi({items:o,typeName:yt.ZodTuple,rest:null,...It(e)})};class Fh extends Ut{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==et.object)return Xe(n,{code:He.invalid_type,expected:et.object,received:n.parsedType}),bt;const r=[],a=this._def.keyType,i=this._def.valueType;for(const s in n.data)r.push({key:a._parse(new mi(n,s,n.path,s)),value:i._parse(new mi(n,n.data[s],n.path,s)),alwaysSet:s in n.data});return n.common.async?Wr.mergeObjectAsync(t,r):Wr.mergeObjectSync(t,r)}get element(){return this._def.valueType}static create(e,t,n){return t instanceof Ut?new Fh({keyType:e,valueType:t,typeName:yt.ZodRecord,...It(n)}):new Fh({keyType:Na.create(),valueType:e,typeName:yt.ZodRecord,...It(t)})}}class Dg extends Ut{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==et.map)return Xe(n,{code:He.invalid_type,expected:et.map,received:n.parsedType}),bt;const r=this._def.keyType,a=this._def.valueType,i=[...n.data.entries()].map(([s,c],u)=>({key:r._parse(new mi(n,s,n.path,[u,"key"])),value:a._parse(new mi(n,c,n.path,[u,"value"]))}));if(n.common.async){const s=new Map;return Promise.resolve().then(async()=>{for(const c of i){const u=await c.key,h=await c.value;if(u.status==="aborted"||h.status==="aborted")return bt;(u.status==="dirty"||h.status==="dirty")&&t.dirty(),s.set(u.value,h.value)}return{status:t.value,value:s}})}else{const s=new Map;for(const c of i){const u=c.key,h=c.value;if(u.status==="aborted"||h.status==="aborted")return bt;(u.status==="dirty"||h.status==="dirty")&&t.dirty(),s.set(u.value,h.value)}return{status:t.value,value:s}}}}Dg.create=(o,e,t)=>new Dg({valueType:e,keyType:o,typeName:yt.ZodMap,...It(t)});class Ic extends Ut{_parse(e){const{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==et.set)return Xe(n,{code:He.invalid_type,expected:et.set,received:n.parsedType}),bt;const r=this._def;r.minSize!==null&&n.data.size<r.minSize.value&&(Xe(n,{code:He.too_small,minimum:r.minSize.value,type:"set",inclusive:!0,exact:!1,message:r.minSize.message}),t.dirty()),r.maxSize!==null&&n.data.size>r.maxSize.value&&(Xe(n,{code:He.too_big,maximum:r.maxSize.value,type:"set",inclusive:!0,exact:!1,message:r.maxSize.message}),t.dirty());const a=this._def.valueType;function i(c){const u=new Set;for(const h of c){if(h.status==="aborted")return bt;h.status==="dirty"&&t.dirty(),u.add(h.value)}return{status:t.value,value:u}}const s=[...n.data.values()].map((c,u)=>a._parse(new mi(n,c,n.path,u)));return n.common.async?Promise.all(s).then(c=>i(c)):i(s)}min(e,t){return new Ic({...this._def,minSize:{value:e,message:lt.toString(t)}})}max(e,t){return new Ic({...this._def,maxSize:{value:e,message:lt.toString(t)}})}size(e,t){return this.min(e,t).max(e,t)}nonempty(e){return this.min(1,e)}}Ic.create=(o,e)=>new Ic({valueType:o,minSize:null,maxSize:null,typeName:yt.ZodSet,...It(e)});class od extends Ut{constructor(){super(...arguments),this.validate=this.implement}_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==et.function)return Xe(t,{code:He.invalid_type,expected:et.function,received:t.parsedType}),bt;function n(s,c){return Lg({data:s,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,Ig(),fd].filter(u=>!!u),issueData:{code:He.invalid_arguments,argumentsError:c}})}function r(s,c){return Lg({data:s,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,Ig(),fd].filter(u=>!!u),issueData:{code:He.invalid_return_type,returnTypeError:c}})}const a={errorMap:t.common.contextualErrorMap},i=t.data;if(this._def.returns instanceof pd){const s=this;return ro(async function(...c){const u=new Ho([]),h=await s._def.args.parseAsync(c,a).catch(g=>{throw u.addIssue(n(c,g)),u}),f=await Reflect.apply(i,this,h);return await s._def.returns._def.type.parseAsync(f,a).catch(g=>{throw u.addIssue(r(f,g)),u})})}else{const s=this;return ro(function(...c){const u=s._def.args.safeParse(c,a);if(!u.success)throw new Ho([n(c,u.error)]);const h=Reflect.apply(i,this,u.data),f=s._def.returns.safeParse(h,a);if(!f.success)throw new Ho([r(h,f.error)]);return f.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new od({...this._def,args:gi.create(e).rest(_c.create())})}returns(e){return new od({...this._def,returns:e})}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}static create(e,t,n){return new od({args:e||gi.create([]).rest(_c.create()),returns:t||_c.create(),typeName:yt.ZodFunction,...It(n)})}}class Uh extends Ut{get schema(){return this._def.getter()}_parse(e){const{ctx:t}=this._processInputParams(e);return this._def.getter()._parse({data:t.data,path:t.path,parent:t})}}Uh.create=(o,e)=>new Uh({getter:o,typeName:yt.ZodLazy,...It(e)});class zh extends Ut{_parse(e){if(e.data!==this._def.value){const t=this._getOrReturnCtx(e);return Xe(t,{received:t.data,code:He.invalid_literal,expected:this._def.value}),bt}return{status:"valid",value:e.data}}get value(){return this._def.value}}zh.create=(o,e)=>new zh({value:o,typeName:yt.ZodLiteral,...It(e)});function lL(o,e){return new fl({values:o,typeName:yt.ZodEnum,...It(e)})}class fl extends Ut{constructor(){super(...arguments),sh.set(this,void 0)}_parse(e){if(typeof e.data!="string"){const t=this._getOrReturnCtx(e),n=this._def.values;return Xe(t,{expected:Kt.joinValues(n),received:t.parsedType,code:He.invalid_type}),bt}if(Bg(this,sh)||oL(this,sh,new Set(this._def.values)),!Bg(this,sh).has(e.data)){const t=this._getOrReturnCtx(e),n=this._def.values;return Xe(t,{received:t.data,code:He.invalid_enum_value,options:n}),bt}return ro(e.data)}get options(){return this._def.values}get enum(){const e={};for(const t of this._def.values)e[t]=t;return e}get Values(){const e={};for(const t of this._def.values)e[t]=t;return e}get Enum(){const e={};for(const t of this._def.values)e[t]=t;return e}extract(e,t=this._def){return fl.create(e,{...this._def,...t})}exclude(e,t=this._def){return fl.create(this.options.filter(n=>!e.includes(n)),{...this._def,...t})}}sh=new WeakMap;fl.create=lL;class Vh extends Ut{constructor(){super(...arguments),lh.set(this,void 0)}_parse(e){const t=Kt.getValidEnumValues(this._def.values),n=this._getOrReturnCtx(e);if(n.parsedType!==et.string&&n.parsedType!==et.number){const r=Kt.objectValues(t);return Xe(n,{expected:Kt.joinValues(r),received:n.parsedType,code:He.invalid_type}),bt}if(Bg(this,lh)||oL(this,lh,new Set(Kt.getValidEnumValues(this._def.values))),!Bg(this,lh).has(e.data)){const r=Kt.objectValues(t);return Xe(n,{received:n.data,code:He.invalid_enum_value,options:r}),bt}return ro(e.data)}get enum(){return this._def.values}}lh=new WeakMap;Vh.create=(o,e)=>new Vh({values:o,typeName:yt.ZodNativeEnum,...It(e)});class pd extends Ut{unwrap(){return this._def.type}_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==et.promise&&t.common.async===!1)return Xe(t,{code:He.invalid_type,expected:et.promise,received:t.parsedType}),bt;const n=t.parsedType===et.promise?t.data:Promise.resolve(t.data);return ro(n.then(r=>this._def.type.parseAsync(r,{path:t.path,errorMap:t.common.contextualErrorMap})))}}pd.create=(o,e)=>new pd({type:o,typeName:yt.ZodPromise,...It(e)});class Va extends Ut{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===yt.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){const{status:t,ctx:n}=this._processInputParams(e),r=this._def.effect||null,a={addIssue:i=>{Xe(n,i),i.fatal?t.abort():t.dirty()},get path(){return n.path}};if(a.addIssue=a.addIssue.bind(a),r.type==="preprocess"){const i=r.transform(n.data,a);if(n.common.async)return Promise.resolve(i).then(async s=>{if(t.value==="aborted")return bt;const c=await this._def.schema._parseAsync({data:s,path:n.path,parent:n});return c.status==="aborted"?bt:c.status==="dirty"||t.value==="dirty"?Zu(c.value):c});{if(t.value==="aborted")return bt;const s=this._def.schema._parseSync({data:i,path:n.path,parent:n});return s.status==="aborted"?bt:s.status==="dirty"||t.value==="dirty"?Zu(s.value):s}}if(r.type==="refinement"){const i=s=>{const c=r.refinement(s,a);if(n.common.async)return Promise.resolve(c);if(c instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return s};if(n.common.async===!1){const s=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});return s.status==="aborted"?bt:(s.status==="dirty"&&t.dirty(),i(s.value),{status:t.value,value:s.value})}else return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then(s=>s.status==="aborted"?bt:(s.status==="dirty"&&t.dirty(),i(s.value).then(()=>({status:t.value,value:s.value}))))}if(r.type==="transform")if(n.common.async===!1){const i=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});if(!Tc(i))return i;const s=r.transform(i.value,a);if(s instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:t.value,value:s}}else return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then(i=>Tc(i)?Promise.resolve(r.transform(i.value,a)).then(s=>({status:t.value,value:s})):i);Kt.assertNever(r)}}Va.create=(o,e,t)=>new Va({schema:o,typeName:yt.ZodEffects,effect:e,...It(t)});Va.createWithPreprocess=(o,e,t)=>new Va({schema:e,effect:{type:"preprocess",transform:o},typeName:yt.ZodEffects,...It(t)});class ci extends Ut{_parse(e){return this._getType(e)===et.undefined?ro(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}ci.create=(o,e)=>new ci({innerType:o,typeName:yt.ZodOptional,...It(e)});class hl extends Ut{_parse(e){return this._getType(e)===et.null?ro(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}hl.create=(o,e)=>new hl({innerType:o,typeName:yt.ZodNullable,...It(e)});class kh extends Ut{_parse(e){const{ctx:t}=this._processInputParams(e);let n=t.data;return t.parsedType===et.undefined&&(n=this._def.defaultValue()),this._def.innerType._parse({data:n,path:t.path,parent:t})}removeDefault(){return this._def.innerType}}kh.create=(o,e)=>new kh({innerType:o,typeName:yt.ZodDefault,defaultValue:typeof e.default=="function"?e.default:()=>e.default,...It(e)});class Gh extends Ut{_parse(e){const{ctx:t}=this._processInputParams(e),n={...t,common:{...t.common,issues:[]}},r=this._def.innerType._parse({data:n.data,path:n.path,parent:{...n}});return Lh(r)?r.then(a=>({status:"valid",value:a.status==="valid"?a.value:this._def.catchValue({get error(){return new Ho(n.common.issues)},input:n.data})})):{status:"valid",value:r.status==="valid"?r.value:this._def.catchValue({get error(){return new Ho(n.common.issues)},input:n.data})}}removeCatch(){return this._def.innerType}}Gh.create=(o,e)=>new Gh({innerType:o,typeName:yt.ZodCatch,catchValue:typeof e.catch=="function"?e.catch:()=>e.catch,...It(e)});class Og extends Ut{_parse(e){if(this._getType(e)!==et.nan){const n=this._getOrReturnCtx(e);return Xe(n,{code:He.invalid_type,expected:et.nan,received:n.parsedType}),bt}return{status:"valid",value:e.data}}}Og.create=o=>new Og({typeName:yt.ZodNaN,...It(o)});const HU=Symbol("zod_brand");class Ny extends Ut{_parse(e){const{ctx:t}=this._processInputParams(e),n=t.data;return this._def.type._parse({data:n,path:t.path,parent:t})}unwrap(){return this._def.type}}class ip extends Ut{_parse(e){const{status:t,ctx:n}=this._processInputParams(e);if(n.common.async)return(async()=>{const a=await this._def.in._parseAsync({data:n.data,path:n.path,parent:n});return a.status==="aborted"?bt:a.status==="dirty"?(t.dirty(),Zu(a.value)):this._def.out._parseAsync({data:a.value,path:n.path,parent:n})})();{const r=this._def.in._parseSync({data:n.data,path:n.path,parent:n});return r.status==="aborted"?bt:r.status==="dirty"?(t.dirty(),{status:"dirty",value:r.value}):this._def.out._parseSync({data:r.value,path:n.path,parent:n})}}static create(e,t){return new ip({in:e,out:t,typeName:yt.ZodPipeline})}}class Qh extends Ut{_parse(e){const t=this._def.innerType._parse(e),n=r=>(Tc(r)&&(r.value=Object.freeze(r.value)),r);return Lh(t)?t.then(r=>n(r)):n(t)}unwrap(){return this._def.innerType}}Qh.create=(o,e)=>new Qh({innerType:o,typeName:yt.ZodReadonly,...It(e)});function qE(o,e){const t=typeof o=="function"?o(e):typeof o=="string"?{message:o}:o;return typeof t=="string"?{message:t}:t}function cL(o,e={},t){return o?hd.create().superRefine((n,r)=>{var a,i;const s=o(n);if(s instanceof Promise)return s.then(c=>{var u,h;if(!c){const f=qE(e,n),m=(h=(u=f.fatal)!==null&&u!==void 0?u:t)!==null&&h!==void 0?h:!0;r.addIssue({code:"custom",...f,fatal:m})}});if(!s){const c=qE(e,n),u=(i=(a=c.fatal)!==null&&a!==void 0?a:t)!==null&&i!==void 0?i:!0;r.addIssue({code:"custom",...c,fatal:u})}}):hd.create()}const WU={object:On.lazycreate};var yt;(function(o){o.ZodString="ZodString",o.ZodNumber="ZodNumber",o.ZodNaN="ZodNaN",o.ZodBigInt="ZodBigInt",o.ZodBoolean="ZodBoolean",o.ZodDate="ZodDate",o.ZodSymbol="ZodSymbol",o.ZodUndefined="ZodUndefined",o.ZodNull="ZodNull",o.ZodAny="ZodAny",o.ZodUnknown="ZodUnknown",o.ZodNever="ZodNever",o.ZodVoid="ZodVoid",o.ZodArray="ZodArray",o.ZodObject="ZodObject",o.ZodUnion="ZodUnion",o.ZodDiscriminatedUnion="ZodDiscriminatedUnion",o.ZodIntersection="ZodIntersection",o.ZodTuple="ZodTuple",o.ZodRecord="ZodRecord",o.ZodMap="ZodMap",o.ZodSet="ZodSet",o.ZodFunction="ZodFunction",o.ZodLazy="ZodLazy",o.ZodLiteral="ZodLiteral",o.ZodEnum="ZodEnum",o.ZodEffects="ZodEffects",o.ZodNativeEnum="ZodNativeEnum",o.ZodOptional="ZodOptional",o.ZodNullable="ZodNullable",o.ZodDefault="ZodDefault",o.ZodCatch="ZodCatch",o.ZodPromise="ZodPromise",o.ZodBranded="ZodBranded",o.ZodPipeline="ZodPipeline",o.ZodReadonly="ZodReadonly"})(yt||(yt={}));const YU=(o,e={message:`Input not instance of ${o.name}`})=>cL(t=>t instanceof o,e),uL=Na.create,dL=ul.create,jU=Og.create,XU=dl.create,fL=Bh.create,qU=Rc.create,ZU=Pg.create,KU=Ph.create,$U=Nh.create,JU=hd.create,ez=_c.create,tz=hs.create,nz=Ng.create,rz=Oa.create,oz=On.create,az=On.strictCreate,iz=Dh.create,sz=pv.create,lz=Oh.create,cz=gi.create,uz=Fh.create,dz=Dg.create,fz=Ic.create,hz=od.create,pz=Uh.create,mz=zh.create,gz=fl.create,vz=Vh.create,_z=pd.create,ZE=Va.create,Az=ci.create,xz=hl.create,yz=Va.createWithPreprocess,bz=ip.create,Sz=()=>uL().optional(),Cz=()=>dL().optional(),Ez=()=>fL().optional(),Mz={string:o=>Na.create({...o,coerce:!0}),number:o=>ul.create({...o,coerce:!0}),boolean:o=>Bh.create({...o,coerce:!0}),bigint:o=>dl.create({...o,coerce:!0}),date:o=>Rc.create({...o,coerce:!0})},wz=bt;var KE=Object.freeze({__proto__:null,defaultErrorMap:fd,setErrorMap:yU,getErrorMap:Ig,makeIssue:Lg,EMPTY_PATH:bU,addIssueToContext:Xe,ParseStatus:Wr,INVALID:bt,DIRTY:Zu,OK:ro,isAborted:f2,isDirty:h2,isValid:Tc,isAsync:Lh,get util(){return Kt},get objectUtil(){return d2},ZodParsedType:et,getParsedType:os,ZodType:Ut,datetimeRegex:sL,ZodString:Na,ZodNumber:ul,ZodBigInt:dl,ZodBoolean:Bh,ZodDate:Rc,ZodSymbol:Pg,ZodUndefined:Ph,ZodNull:Nh,ZodAny:hd,ZodUnknown:_c,ZodNever:hs,ZodVoid:Ng,ZodArray:Oa,ZodObject:On,ZodUnion:Dh,ZodDiscriminatedUnion:pv,ZodIntersection:Oh,ZodTuple:gi,ZodRecord:Fh,ZodMap:Dg,ZodSet:Ic,ZodFunction:od,ZodLazy:Uh,ZodLiteral:zh,ZodEnum:fl,ZodNativeEnum:Vh,ZodPromise:pd,ZodEffects:Va,ZodTransformer:Va,ZodOptional:ci,ZodNullable:hl,ZodDefault:kh,ZodCatch:Gh,ZodNaN:Og,BRAND:HU,ZodBranded:Ny,ZodPipeline:ip,ZodReadonly:Qh,custom:cL,Schema:Ut,ZodSchema:Ut,late:WU,get ZodFirstPartyTypeKind(){return yt},coerce:Mz,any:JU,array:rz,bigint:XU,boolean:fL,date:qU,discriminatedUnion:sz,effect:ZE,enum:gz,function:hz,instanceof:YU,intersection:lz,lazy:pz,literal:mz,map:dz,nan:jU,nativeEnum:vz,never:tz,null:$U,nullable:xz,number:dL,object:oz,oboolean:Ez,onumber:Cz,optional:Az,ostring:Sz,pipeline:bz,preprocess:yz,promise:_z,record:uz,set:fz,strictObject:az,string:uL,symbol:ZU,transformer:ZE,tuple:cz,undefined:KU,union:iz,unknown:ez,void:nz,NEVER:wz,ZodIssueCode:He,quotelessJson:xU,ZodError:Ho});const $E=(o,e,t)=>{if(o&&"reportValidity"in o){const n=je(t,e);o.setCustomValidity(n&&n.message||""),o.reportValidity()}},hL=(o,e)=>{for(const t in e.fields){const n=e.fields[t];n&&n.ref&&"reportValidity"in n.ref?$E(n.ref,t,o):n&&n.refs&&n.refs.forEach(r=>$E(r,t,o))}},Tz=(o,e)=>{e.shouldUseNativeValidation&&hL(o,e);const t={};for(const n in o){const r=je(e.fields,n),a=Object.assign(o[n]||{},{ref:r&&r.ref});if(Rz(e.names||Object.keys(o),n)){const i=Object.assign({},je(t,n));ln(i,"root",a),ln(t,n,i)}else ln(t,n,a)}return t},Rz=(o,e)=>{const t=JE(e);return o.some(n=>JE(n).match(`^${t}\\.\\d+`))};function JE(o){return o.replace(/\]|\[/g,"")}function Iz(o,e){for(var t={};o.length;){var n=o[0],r=n.code,a=n.message,i=n.path.join(".");if(!t[i])if("unionErrors"in n){var s=n.unionErrors[0].errors[0];t[i]={message:s.message,type:s.code}}else t[i]={message:a,type:r};if("unionErrors"in n&&n.unionErrors.forEach(function(h){return h.errors.forEach(function(f){return o.push(f)})}),e){var c=t[i].types,u=c&&c[n.code];t[i]=ZI(i,e,t,r,u?[].concat(u,n.message):n.message)}o.shift()}return t}function Lz(o,e,t){return t===void 0&&(t={}),function(n,r,a){try{return Promise.resolve(function(i,s){try{var c=Promise.resolve(o[t.mode==="sync"?"parse":"parseAsync"](n,e)).then(function(u){return a.shouldUseNativeValidation&&hL({},a),{errors:{},values:t.raw?Object.assign({},n):u}})}catch(u){return s(u)}return c&&c.then?c.then(void 0,s):c}(0,function(i){if(function(s){return Array.isArray(s==null?void 0:s.errors)}(i))return{values:{},errors:Tz(Iz(i.errors,!a.shouldUseNativeValidation&&a.criteriaMode==="all"),a)};throw i}))}catch(i){return Promise.reject(i)}}}var Ac=(o=>(o.hyperX="HyperX",o.logitech="Logitech",o.aliExpress="AliExpress",o))(Ac||{});const pL=j.createContext(void 0),mL=()=>{const o=j.useContext(pL);if(!o)throw new Error("useKeyboard must be used within a KeyboardProvider");return o},Bz=({children:o})=>{const[e,t]=j.useState([]),[n,r]=j.useState(Ac.hyperX);return ue.jsx(pL.Provider,{value:{colorPallet:e,setColorPallet:t,keyboardModel:n,setKeyboardModel:r},children:o})},Pz=KE.object({keyboardModel:KE.nativeEnum(Ac,{required_error:"Please select a keyboard model to customise."})}),Nz=()=>{const o=_U({resolver:Lz(Pz),defaultValues:{keyboardModel:Ac.hyperX}}),{setKeyboardModel:e}=mL();function t(n){e(n.keyboardModel),console.log(`New Keyboard model set to: ${n.keyboardModel}`)}return ue.jsxs(td,{className:"mt-3",children:[ue.jsxs(hh,{children:[ue.jsx(ph,{children:"Keyboard Model"}),ue.jsx(mh,{children:"Select keyboard model and save changes"})]}),ue.jsx(gh,{className:"space-y-2",children:ue.jsx(AU,{...o,children:ue.jsxs("form",{onSubmit:o.handleSubmit(t),className:"space-y-4",children:[ue.jsx(oU,{control:o.control,name:"keyboardModel",render:({field:n})=>ue.jsxs(Y9,{onValueChange:n.onChange,value:n.value,children:[ue.jsx(X9,{className:"w-[80%]",children:ue.jsx(j9,{placeholder:"Select a model"})}),ue.jsxs(q9,{children:[ue.jsx(oA,{value:"HyperX",children:"HyperX"}),ue.jsx(oA,{value:"Logitech",children:"Logitech"}),ue.jsx(oA,{value:"AliExpress",children:"Aliexpress"})]})]})}),ue.jsx(ov,{type:"submit",children:"Save changes"})]})})})]})};function Dz(o){const e=Oz(o),t=j.forwardRef((n,r)=>{const{children:a,...i}=n,s=j.Children.toArray(a),c=s.find(Uz);if(c){const u=c.props.children,h=s.map(f=>f===c?j.Children.count(u)>1?j.Children.only(null):j.isValidElement(u)?u.props.children:null:f);return ue.jsx(e,{...i,ref:r,children:j.isValidElement(u)?j.cloneElement(u,void 0,h):null})}return ue.jsx(e,{...i,ref:r,children:a})});return t.displayName=`${o}.Slot`,t}function Oz(o){const e=j.forwardRef((t,n)=>{const{children:r,...a}=t;if(j.isValidElement(r)){const i=Vz(r),s=zz(a,r.props);return r.type!==j.Fragment&&(s.ref=n?Sy(n,i):i),j.cloneElement(r,s)}return j.Children.count(r)>1?j.Children.only(null):null});return e.displayName=`${o}.SlotClone`,e}var Fz=Symbol("radix.slottable");function Uz(o){return j.isValidElement(o)&&typeof o.type=="function"&&"__radixId"in o.type&&o.type.__radixId===Fz}function zz(o,e){const t={...e};for(const n in e){const r=o[n],a=e[n];/^on[A-Z]/.test(n)?r&&a?t[n]=(...s)=>{const c=a(...s);return r(...s),c}:r&&(t[n]=r):n==="style"?t[n]={...r,...a}:n==="className"&&(t[n]=[r,a].filter(Boolean).join(" "))}return{...o,...t}}function Vz(o){var n,r;let e=(n=Object.getOwnPropertyDescriptor(o.props,"ref"))==null?void 0:n.get,t=e&&"isReactWarning"in e&&e.isReactWarning;return t?o.ref:(e=(r=Object.getOwnPropertyDescriptor(o,"ref"))==null?void 0:r.get,t=e&&"isReactWarning"in e&&e.isReactWarning,t?o.props.ref:o.props.ref||o.ref)}var kz=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],sp=kz.reduce((o,e)=>{const t=Dz(`Primitive.${e}`),n=j.forwardRef((r,a)=>{const{asChild:i,...s}=r,c=i?t:e;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),ue.jsx(c,{...s,ref:a})});return n.displayName=`Primitive.${e}`,{...o,[e]:n}},{});function Gz(o,e){return j.useReducer((t,n)=>e[t][n]??t,o)}var lp=o=>{const{present:e,children:t}=o,n=Qz(e),r=typeof t=="function"?t({present:n.isPresent}):j.Children.only(t),a=Ln(n.ref,Hz(r));return typeof t=="function"||n.isPresent?j.cloneElement(r,{ref:a}):null};lp.displayName="Presence";function Qz(o){const[e,t]=j.useState(),n=j.useRef(null),r=j.useRef(o),a=j.useRef("none"),i=o?"mounted":"unmounted",[s,c]=Gz(i,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return j.useEffect(()=>{const u=Bm(n.current);a.current=s==="mounted"?u:"none"},[s]),Fr(()=>{const u=n.current,h=r.current;if(h!==o){const m=a.current,g=Bm(u);o?c("MOUNT"):g==="none"||(u==null?void 0:u.display)==="none"?c("UNMOUNT"):c(h&&m!==g?"ANIMATION_OUT":"UNMOUNT"),r.current=o}},[o,c]),Fr(()=>{if(e){let u;const h=e.ownerDocument.defaultView??window,f=g=>{const _=Bm(n.current).includes(g.animationName);if(g.target===e&&_&&(c("ANIMATION_END"),!r.current)){const x=e.style.animationFillMode;e.style.animationFillMode="forwards",u=h.setTimeout(()=>{e.style.animationFillMode==="forwards"&&(e.style.animationFillMode=x)})}},m=g=>{g.target===e&&(a.current=Bm(n.current))};return e.addEventListener("animationstart",m),e.addEventListener("animationcancel",f),e.addEventListener("animationend",f),()=>{h.clearTimeout(u),e.removeEventListener("animationstart",m),e.removeEventListener("animationcancel",f),e.removeEventListener("animationend",f)}}else c("ANIMATION_END")},[e,c]),{isPresent:["mounted","unmountSuspended"].includes(s),ref:j.useCallback(u=>{n.current=u?getComputedStyle(u):null,t(u)},[])}}function Bm(o){return(o==null?void 0:o.animationName)||"none"}function Hz(o){var n,r;let e=(n=Object.getOwnPropertyDescriptor(o.props,"ref"))==null?void 0:n.get,t=e&&"isReactWarning"in e&&e.isReactWarning;return t?o.ref:(e=(r=Object.getOwnPropertyDescriptor(o,"ref"))==null?void 0:r.get,t=e&&"isReactWarning"in e&&e.isReactWarning,t?o.props.ref:o.props.ref||o.ref)}function Wz(o,e){return j.useReducer((t,n)=>e[t][n]??t,o)}var Dy="ScrollArea",[gL,Qie]=cv(Dy),[Yz,ha]=gL(Dy),vL=j.forwardRef((o,e)=>{const{__scopeScrollArea:t,type:n="hover",dir:r,scrollHideDelay:a=600,...i}=o,[s,c]=j.useState(null),[u,h]=j.useState(null),[f,m]=j.useState(null),[g,A]=j.useState(null),[_,x]=j.useState(null),[C,b]=j.useState(0),[y,M]=j.useState(0),[R,T]=j.useState(!1),[w,D]=j.useState(!1),z=Ln(e,O=>c(O)),F=Z4(r);return ue.jsx(Yz,{scope:t,type:n,dir:F,scrollHideDelay:a,scrollArea:s,viewport:u,onViewportChange:h,content:f,onContentChange:m,scrollbarX:g,onScrollbarXChange:A,scrollbarXEnabled:R,onScrollbarXEnabledChange:T,scrollbarY:_,onScrollbarYChange:x,scrollbarYEnabled:w,onScrollbarYEnabledChange:D,onCornerWidthChange:b,onCornerHeightChange:M,children:ue.jsx(sp.div,{dir:F,...i,ref:z,style:{position:"relative","--radix-scroll-area-corner-width":C+"px","--radix-scroll-area-corner-height":y+"px",...o.style}})})});vL.displayName=Dy;var _L="ScrollAreaViewport",AL=j.forwardRef((o,e)=>{const{__scopeScrollArea:t,children:n,nonce:r,...a}=o,i=ha(_L,t),s=j.useRef(null),c=Ln(e,s,i.onViewportChange);return ue.jsxs(ue.Fragment,{children:[ue.jsx("style",{dangerouslySetInnerHTML:{__html:"[data-radix-scroll-area-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-scroll-area-viewport]::-webkit-scrollbar{display:none}"},nonce:r}),ue.jsx(sp.div,{"data-radix-scroll-area-viewport":"",...a,ref:c,style:{overflowX:i.scrollbarXEnabled?"scroll":"hidden",overflowY:i.scrollbarYEnabled?"scroll":"hidden",...o.style},children:ue.jsx("div",{ref:i.onContentChange,style:{minWidth:"100%",display:"table"},children:n})})]})});AL.displayName=_L;var xi="ScrollAreaScrollbar",xL=j.forwardRef((o,e)=>{const{forceMount:t,...n}=o,r=ha(xi,o.__scopeScrollArea),{onScrollbarXEnabledChange:a,onScrollbarYEnabledChange:i}=r,s=o.orientation==="horizontal";return j.useEffect(()=>(s?a(!0):i(!0),()=>{s?a(!1):i(!1)}),[s,a,i]),r.type==="hover"?ue.jsx(jz,{...n,ref:e,forceMount:t}):r.type==="scroll"?ue.jsx(Xz,{...n,ref:e,forceMount:t}):r.type==="auto"?ue.jsx(yL,{...n,ref:e,forceMount:t}):r.type==="always"?ue.jsx(Oy,{...n,ref:e}):null});xL.displayName=xi;var jz=j.forwardRef((o,e)=>{const{forceMount:t,...n}=o,r=ha(xi,o.__scopeScrollArea),[a,i]=j.useState(!1);return j.useEffect(()=>{const s=r.scrollArea;let c=0;if(s){const u=()=>{window.clearTimeout(c),i(!0)},h=()=>{c=window.setTimeout(()=>i(!1),r.scrollHideDelay)};return s.addEventListener("pointerenter",u),s.addEventListener("pointerleave",h),()=>{window.clearTimeout(c),s.removeEventListener("pointerenter",u),s.removeEventListener("pointerleave",h)}}},[r.scrollArea,r.scrollHideDelay]),ue.jsx(lp,{present:t||a,children:ue.jsx(yL,{"data-state":a?"visible":"hidden",...n,ref:e})})}),Xz=j.forwardRef((o,e)=>{const{forceMount:t,...n}=o,r=ha(xi,o.__scopeScrollArea),a=o.orientation==="horizontal",i=gv(()=>c("SCROLL_END"),100),[s,c]=Wz("hidden",{hidden:{SCROLL:"scrolling"},scrolling:{SCROLL_END:"idle",POINTER_ENTER:"interacting"},interacting:{SCROLL:"interacting",POINTER_LEAVE:"idle"},idle:{HIDE:"hidden",SCROLL:"scrolling",POINTER_ENTER:"interacting"}});return j.useEffect(()=>{if(s==="idle"){const u=window.setTimeout(()=>c("HIDE"),r.scrollHideDelay);return()=>window.clearTimeout(u)}},[s,r.scrollHideDelay,c]),j.useEffect(()=>{const u=r.viewport,h=a?"scrollLeft":"scrollTop";if(u){let f=u[h];const m=()=>{const g=u[h];f!==g&&(c("SCROLL"),i()),f=g};return u.addEventListener("scroll",m),()=>u.removeEventListener("scroll",m)}},[r.viewport,a,c,i]),ue.jsx(lp,{present:t||s!=="hidden",children:ue.jsx(Oy,{"data-state":s==="hidden"?"hidden":"visible",...n,ref:e,onPointerEnter:_n(o.onPointerEnter,()=>c("POINTER_ENTER")),onPointerLeave:_n(o.onPointerLeave,()=>c("POINTER_LEAVE"))})})}),yL=j.forwardRef((o,e)=>{const t=ha(xi,o.__scopeScrollArea),{forceMount:n,...r}=o,[a,i]=j.useState(!1),s=o.orientation==="horizontal",c=gv(()=>{if(t.viewport){const u=t.viewport.offsetWidth<t.viewport.scrollWidth,h=t.viewport.offsetHeight<t.viewport.scrollHeight;i(s?u:h)}},10);return md(t.viewport,c),md(t.content,c),ue.jsx(lp,{present:n||a,children:ue.jsx(Oy,{"data-state":a?"visible":"hidden",...r,ref:e})})}),Oy=j.forwardRef((o,e)=>{const{orientation:t="vertical",...n}=o,r=ha(xi,o.__scopeScrollArea),a=j.useRef(null),i=j.useRef(0),[s,c]=j.useState({content:0,viewport:0,scrollbar:{size:0,paddingStart:0,paddingEnd:0}}),u=ML(s.viewport,s.content),h={...n,sizes:s,onSizesChange:c,hasThumb:u>0&&u<1,onThumbChange:m=>a.current=m,onThumbPointerUp:()=>i.current=0,onThumbPointerDown:m=>i.current=m};function f(m,g){return eV(m,i.current,s,g)}return t==="horizontal"?ue.jsx(qz,{...h,ref:e,onThumbPositionChange:()=>{if(r.viewport&&a.current){const m=r.viewport.scrollLeft,g=eM(m,s,r.dir);a.current.style.transform=`translate3d(${g}px, 0, 0)`}},onWheelScroll:m=>{r.viewport&&(r.viewport.scrollLeft=m)},onDragScroll:m=>{r.viewport&&(r.viewport.scrollLeft=f(m,r.dir))}}):t==="vertical"?ue.jsx(Zz,{...h,ref:e,onThumbPositionChange:()=>{if(r.viewport&&a.current){const m=r.viewport.scrollTop,g=eM(m,s);a.current.style.transform=`translate3d(0, ${g}px, 0)`}},onWheelScroll:m=>{r.viewport&&(r.viewport.scrollTop=m)},onDragScroll:m=>{r.viewport&&(r.viewport.scrollTop=f(m))}}):null}),qz=j.forwardRef((o,e)=>{const{sizes:t,onSizesChange:n,...r}=o,a=ha(xi,o.__scopeScrollArea),[i,s]=j.useState(),c=j.useRef(null),u=Ln(e,c,a.onScrollbarXChange);return j.useEffect(()=>{c.current&&s(getComputedStyle(c.current))},[c]),ue.jsx(SL,{"data-orientation":"horizontal",...r,ref:u,sizes:t,style:{bottom:0,left:a.dir==="rtl"?"var(--radix-scroll-area-corner-width)":0,right:a.dir==="ltr"?"var(--radix-scroll-area-corner-width)":0,"--radix-scroll-area-thumb-width":mv(t)+"px",...o.style},onThumbPointerDown:h=>o.onThumbPointerDown(h.x),onDragScroll:h=>o.onDragScroll(h.x),onWheelScroll:(h,f)=>{if(a.viewport){const m=a.viewport.scrollLeft+h.deltaX;o.onWheelScroll(m),TL(m,f)&&h.preventDefault()}},onResize:()=>{c.current&&a.viewport&&i&&n({content:a.viewport.scrollWidth,viewport:a.viewport.offsetWidth,scrollbar:{size:c.current.clientWidth,paddingStart:Ug(i.paddingLeft),paddingEnd:Ug(i.paddingRight)}})}})}),Zz=j.forwardRef((o,e)=>{const{sizes:t,onSizesChange:n,...r}=o,a=ha(xi,o.__scopeScrollArea),[i,s]=j.useState(),c=j.useRef(null),u=Ln(e,c,a.onScrollbarYChange);return j.useEffect(()=>{c.current&&s(getComputedStyle(c.current))},[c]),ue.jsx(SL,{"data-orientation":"vertical",...r,ref:u,sizes:t,style:{top:0,right:a.dir==="ltr"?0:void 0,left:a.dir==="rtl"?0:void 0,bottom:"var(--radix-scroll-area-corner-height)","--radix-scroll-area-thumb-height":mv(t)+"px",...o.style},onThumbPointerDown:h=>o.onThumbPointerDown(h.y),onDragScroll:h=>o.onDragScroll(h.y),onWheelScroll:(h,f)=>{if(a.viewport){const m=a.viewport.scrollTop+h.deltaY;o.onWheelScroll(m),TL(m,f)&&h.preventDefault()}},onResize:()=>{c.current&&a.viewport&&i&&n({content:a.viewport.scrollHeight,viewport:a.viewport.offsetHeight,scrollbar:{size:c.current.clientHeight,paddingStart:Ug(i.paddingTop),paddingEnd:Ug(i.paddingBottom)}})}})}),[Kz,bL]=gL(xi),SL=j.forwardRef((o,e)=>{const{__scopeScrollArea:t,sizes:n,hasThumb:r,onThumbChange:a,onThumbPointerUp:i,onThumbPointerDown:s,onThumbPositionChange:c,onDragScroll:u,onWheelScroll:h,onResize:f,...m}=o,g=ha(xi,t),[A,_]=j.useState(null),x=Ln(e,z=>_(z)),C=j.useRef(null),b=j.useRef(""),y=g.viewport,M=n.content-n.viewport,R=Ao(h),T=Ao(c),w=gv(f,10);function D(z){if(C.current){const F=z.clientX-C.current.left,O=z.clientY-C.current.top;u({x:F,y:O})}}return j.useEffect(()=>{const z=F=>{const O=F.target;(A==null?void 0:A.contains(O))&&R(F,M)};return document.addEventListener("wheel",z,{passive:!1}),()=>document.removeEventListener("wheel",z,{passive:!1})},[y,A,M,R]),j.useEffect(T,[n,T]),md(A,w),md(g.content,w),ue.jsx(Kz,{scope:t,scrollbar:A,hasThumb:r,onThumbChange:Ao(a),onThumbPointerUp:Ao(i),onThumbPositionChange:T,onThumbPointerDown:Ao(s),children:ue.jsx(sp.div,{...m,ref:x,style:{position:"absolute",...m.style},onPointerDown:_n(o.onPointerDown,z=>{z.button===0&&(z.target.setPointerCapture(z.pointerId),C.current=A.getBoundingClientRect(),b.current=document.body.style.webkitUserSelect,document.body.style.webkitUserSelect="none",g.viewport&&(g.viewport.style.scrollBehavior="auto"),D(z))}),onPointerMove:_n(o.onPointerMove,D),onPointerUp:_n(o.onPointerUp,z=>{const F=z.target;F.hasPointerCapture(z.pointerId)&&F.releasePointerCapture(z.pointerId),document.body.style.webkitUserSelect=b.current,g.viewport&&(g.viewport.style.scrollBehavior=""),C.current=null})})})}),Fg="ScrollAreaThumb",CL=j.forwardRef((o,e)=>{const{forceMount:t,...n}=o,r=bL(Fg,o.__scopeScrollArea);return ue.jsx(lp,{present:t||r.hasThumb,children:ue.jsx($z,{ref:e,...n})})}),$z=j.forwardRef((o,e)=>{const{__scopeScrollArea:t,style:n,...r}=o,a=ha(Fg,t),i=bL(Fg,t),{onThumbPositionChange:s}=i,c=Ln(e,f=>i.onThumbChange(f)),u=j.useRef(void 0),h=gv(()=>{u.current&&(u.current(),u.current=void 0)},100);return j.useEffect(()=>{const f=a.viewport;if(f){const m=()=>{if(h(),!u.current){const g=tV(f,s);u.current=g,s()}};return s(),f.addEventListener("scroll",m),()=>f.removeEventListener("scroll",m)}},[a.viewport,h,s]),ue.jsx(sp.div,{"data-state":i.hasThumb?"visible":"hidden",...r,ref:c,style:{width:"var(--radix-scroll-area-thumb-width)",height:"var(--radix-scroll-area-thumb-height)",...n},onPointerDownCapture:_n(o.onPointerDownCapture,f=>{const g=f.target.getBoundingClientRect(),A=f.clientX-g.left,_=f.clientY-g.top;i.onThumbPointerDown({x:A,y:_})}),onPointerUp:_n(o.onPointerUp,i.onThumbPointerUp)})});CL.displayName=Fg;var Fy="ScrollAreaCorner",EL=j.forwardRef((o,e)=>{const t=ha(Fy,o.__scopeScrollArea),n=!!(t.scrollbarX&&t.scrollbarY);return t.type!=="scroll"&&n?ue.jsx(Jz,{...o,ref:e}):null});EL.displayName=Fy;var Jz=j.forwardRef((o,e)=>{const{__scopeScrollArea:t,...n}=o,r=ha(Fy,t),[a,i]=j.useState(0),[s,c]=j.useState(0),u=!!(a&&s);return md(r.scrollbarX,()=>{var f;const h=((f=r.scrollbarX)==null?void 0:f.offsetHeight)||0;r.onCornerHeightChange(h),c(h)}),md(r.scrollbarY,()=>{var f;const h=((f=r.scrollbarY)==null?void 0:f.offsetWidth)||0;r.onCornerWidthChange(h),i(h)}),u?ue.jsx(sp.div,{...n,ref:e,style:{width:a,height:s,position:"absolute",right:r.dir==="ltr"?0:void 0,left:r.dir==="rtl"?0:void 0,bottom:0,...o.style}}):null});function Ug(o){return o?parseInt(o,10):0}function ML(o,e){const t=o/e;return isNaN(t)?0:t}function mv(o){const e=ML(o.viewport,o.content),t=o.scrollbar.paddingStart+o.scrollbar.paddingEnd,n=(o.scrollbar.size-t)*e;return Math.max(n,18)}function eV(o,e,t,n="ltr"){const r=mv(t),a=r/2,i=e||a,s=r-i,c=t.scrollbar.paddingStart+i,u=t.scrollbar.size-t.scrollbar.paddingEnd-s,h=t.content-t.viewport,f=n==="ltr"?[0,h]:[h*-1,0];return wL([c,u],f)(o)}function eM(o,e,t="ltr"){const n=mv(e),r=e.scrollbar.paddingStart+e.scrollbar.paddingEnd,a=e.scrollbar.size-r,i=e.content-e.viewport,s=a-n,c=t==="ltr"?[0,i]:[i*-1,0],u=r2(o,c);return wL([0,i],[0,s])(u)}function wL(o,e){return t=>{if(o[0]===o[1]||e[0]===e[1])return e[0];const n=(e[1]-e[0])/(o[1]-o[0]);return e[0]+n*(t-o[0])}}function TL(o,e){return o>0&&o<e}var tV=(o,e=()=>{})=>{let t={left:o.scrollLeft,top:o.scrollTop},n=0;return function r(){const a={left:o.scrollLeft,top:o.scrollTop},i=t.left!==a.left,s=t.top!==a.top;(i||s)&&e(),t=a,n=window.requestAnimationFrame(r)}(),()=>window.cancelAnimationFrame(n)};function gv(o,e){const t=Ao(o),n=j.useRef(0);return j.useEffect(()=>()=>window.clearTimeout(n.current),[]),j.useCallback(()=>{window.clearTimeout(n.current),n.current=window.setTimeout(t,e)},[t,e])}function md(o,e){const t=Ao(e);Fr(()=>{let n=0;if(o){const r=new ResizeObserver(()=>{cancelAnimationFrame(n),n=window.requestAnimationFrame(t)});return r.observe(o),()=>{window.cancelAnimationFrame(n),r.unobserve(o)}}},[o,t])}var nV=vL,rV=AL,oV=EL;function aV({className:o,children:e,...t}){return ue.jsxs(nV,{"data-slot":"scroll-area",className:jn("relative",o),...t,children:[ue.jsx(rV,{"data-slot":"scroll-area-viewport",className:"focus-visible:ring-ring/50 size-full rounded-[inherit] transition-[color,box-shadow] outline-none focus-visible:ring-[3px] focus-visible:outline-1",children:e}),ue.jsx(iV,{}),ue.jsx(oV,{})]})}function iV({className:o,orientation:e="vertical",...t}){return ue.jsx(xL,{"data-slot":"scroll-area-scrollbar",orientation:e,className:jn("flex touch-none p-px transition-colors select-none",e==="vertical"&&"h-full w-2.5 border-l border-l-transparent",e==="horizontal"&&"h-2.5 flex-col border-t border-t-transparent",o),...t,children:ue.jsx(CL,{"data-slot":"scroll-area-thumb",className:"bg-border relative flex-1 rounded-full"})})}const sV=()=>{const{color:o,setColor:e,recentColors:t,backlightColor:n,setBacklightColors:r,recentBacklightColors:a}=q4();return ue.jsx(aV,{className:"h-full",children:ue.jsxs("div",{className:"space-y-3 p-1",children:[ue.jsx(Nz,{}),ue.jsxs(td,{children:[ue.jsxs(hh,{children:[ue.jsx(ph,{children:"Color picker"}),ue.jsx(mh,{children:"Choose color of the keys"})]}),ue.jsxs(gh,{className:"space-y-2",children:[ue.jsxs("div",{className:"space-y-1 flex row space-x-4",children:[ue.jsx(Xl,{className:"w-[30%]",children:"Color"}),ue.jsx(t2,{onChange:i=>e(i),value:o})]}),ue.jsxs("div",{className:"space-y-1 flex row space-x-4",children:[ue.jsx(Xl,{className:"w-[30%]",children:"Recent"}),t.map((i,s)=>ue.jsx(n2,{value:i,setColor:e},s))]})]})]}),ue.jsxs(td,{children:[ue.jsxs(hh,{children:[ue.jsx(ph,{children:"Backlight color picker"}),ue.jsx(mh,{children:"Choose color of the keys backlight"})]}),ue.jsxs(gh,{className:"space-y-2",children:[ue.jsxs("div",{className:"space-y-1 flex row space-x-4",children:[ue.jsx(Xl,{className:"w-[30%]",children:"Backlight"}),ue.jsx(t2,{onChange:i=>r(i),value:n})]}),ue.jsxs("div",{className:"space-y-1 flex row space-x-4",children:[ue.jsx(Xl,{className:"w-[30%]",children:"Recent"}),a.map((i,s)=>ue.jsx(n2,{value:i,setColor:r},s))]})]})]}),ue.jsxs(td,{children:[ue.jsxs(hh,{children:[ue.jsx(ph,{children:"Suggested Color Pallets"}),ue.jsx(mh,{children:"Click on the color to select it"})]}),ue.jsxs(gh,{className:"space-y-1",children:[ue.jsxs("div",{className:"space-y-1 flex row space-x-4",children:[ue.jsx(Xl,{className:"w-[30%]",children:"Cyberpunk"}),ue.jsx(eA,{colorList:["#00ff9f","#00b8ff","#001eff","#bd00ff"],setColor:e})]}),ue.jsxs("div",{className:"space-y-1 flex row space-x-4",children:[ue.jsx(Xl,{className:"w-[30%]",children:"Cappuccino"}),ue.jsx(eA,{colorList:["#4b3832","#854442","#3c2f2f","#fff4e6"],setColor:e})]}),ue.jsxs("div",{className:"space-y-1 flex row space-x-4",children:[ue.jsx(Xl,{className:"w-[30%]",children:"Teal"}),ue.jsx(eA,{colorList:["#b2d8d8","#66b2b2","#006666","#004c4c"],setColor:e})]})]})]})]})})},lV=()=>ue.jsx(td,{className:"w-[450px] m-3 p-3",children:ue.jsxs(x6,{defaultValue:"configuration",children:[ue.jsxs(y6,{className:"grid w-full grid-cols-2",children:[ue.jsx(tE,{value:"configuration",children:"Configuration"}),ue.jsx(tE,{value:"about",children:"About"})]}),ue.jsx(nE,{value:"configuration",children:ue.jsx(sV,{})}),ue.jsx(nE,{value:"about",children:ue.jsxs(td,{children:[ue.jsxs(hh,{children:[ue.jsx(ph,{children:"About"}),ue.jsx(mh,{children:"Description of project"})]}),ue.jsx(gh,{className:"space-y-2"})]})})]})}),cV="4.9.0",xc={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},uV={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},dV=0,fV=1,hV=2,pV=3,mV=0,gV=1,vV=2,_V=3,AV=0,xV=1,yV=2,bV=3,SV=0,CV=1,EV=2,MV=3,wV=4,TV=5,RL=100,IL=101,LL=102,RV=103,IV=104,BL=200,PL=201,NL=202,DL=203,OL=204,FL=205,UL=206,zL=207,VL=208,kL=209,GL=210,LV=0,BV=1,PV=2,NV=3,DV=4,OV=5,FV=6,UV=7,zV=0,VV=1,kV=2,GV=0,QV=1,HV=2,WV=3,YV=4,jV=5,XV=6,qV=7,ZV=8,KV=9,$V=10,JV=0,ek=1,tk=300,nk=301,rk=302,ok=303,ak=304,ik=306,QL=1e3,HL=1001,WL=1002,YL=1003,jL=1004,sk=1004,XL=1005,lk=1005,qL=1006,ZL=1007,ck=1007,KL=1008,uk=1008,dk=1009,fk=1010,hk=1011,pk=1012,mk=1013,gk=1014,vk=1015,_k=1016,Ak=1017,xk=1018,yk=1020,bk=1021,$L=1023,Sk=1024,Ck=1025,JL=1026,Ek=1027,Mk=1028,wk=1029,Tk=1030,Rk=1031,Ik=1033,e5=33776,Lk=33777,Bk=33778,t5=33779,n5=35840,Pk=35841,r5=35842,Nk=35843,o5=36196,a5=37492,i5=37496,s5=37808,Dk=37809,Ok=37810,Fk=37811,Uk=37812,zk=37813,Vk=37814,kk=37815,Gk=37816,Qk=37817,Hk=37818,Wk=37819,Yk=37820,jk=37821,l5=36492,Xk=2200,qk=2201,Zk=2202,Kk=2300,$k=2301,Jk=2302,eG=2400,tG=2401,nG=2402,rG=2500,oG=2501,aG=0,iG=1,sG=2,lG=3e3,cG=3001,uG=3200,dG=3201,fG=3202,hG=3301,pG=3302,mG=0,gG=1,vG="",m2="srgb",g2="srgb-linear",_G=0,AG=7680,xG=7681,yG=7682,bG=7683,SG=34055,CG=34056,EG=5386,MG=512,wG=513,TG=514,RG=515,IG=516,LG=517,BG=518,PG=519,NG=35044,DG=35048,OG=35040,FG=35045,UG=35049,zG=35041,VG=35046,kG=35050,GG=35042,QG="100",v2="300 es",HG=1035,WG="ALL",zg="__V3DL__0000000000",YG=0,jG=1,XG=2,qG=3,ZG=4,KG=5,$G=0,JG=1,eQ=2,tQ=0,nQ=1,rQ=0,oQ=1,aQ=2,iQ=0,sQ=1,lQ=0,cQ=1,uQ=2;class oo{addEventListener(e,t){this._listeners===void 0&&(this._listeners={});const n=this._listeners;n[e]===void 0&&(n[e]=[]),n[e].indexOf(t)===-1&&n[e].push(t)}hasEventListener(e,t){if(this._listeners===void 0)return!1;const n=this._listeners;return n[e]!==void 0&&n[e].indexOf(t)!==-1}removeEventListener(e,t){if(this._listeners===void 0)return;const n=this._listeners[e];if(n!==void 0){const r=n.indexOf(t);r!==-1&&n.splice(r,1)}}dispatchEvent(e){if(this._listeners===void 0)return;const t=this._listeners[e.type];if(t!==void 0){e.target=this;const n=t.slice(0);for(let r=0,a=n.length;r<a;r++)n[r].call(this,e);e.target=null}}}const dQ=new RegExp("^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}$"),ls=Math.PI/180,gd=180/Math.PI,Vr=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let tM=1234567;function Wo(){const o=4294967295*Math.random()|0,e=4294967295*Math.random()|0,t=4294967295*Math.random()|0,n=4294967295*Math.random()|0;return(Vr[255&o]+Vr[o>>8&255]+Vr[o>>16&255]+Vr[o>>24&255]+"-"+Vr[255&e]+Vr[e>>8&255]+"-"+Vr[e>>16&15|64]+Vr[e>>24&255]+"-"+Vr[63&t|128]+Vr[t>>8&255]+"-"+Vr[t>>16&255]+Vr[t>>24&255]+Vr[255&n]+Vr[n>>8&255]+Vr[n>>16&255]+Vr[n>>24&255]).toLowerCase()}function Uy(o){return dQ.test(o)}function Ft(o,e=0,t=1){return Math.max(e,Math.min(t,o))}function zy(o,e){return(o%e+e)%e}function fQ(o,e,t,n,r){return n+(o-e)*(r-n)/(t-e)}function hQ(o,e,t){return o!==e?(t-o)/(e-o):0}function ui(o,e,t){return(1-t)*o+t*e}function pQ(o,e,t,n){return ui(o,e,1-Math.exp(-t*n))}function mQ(o,e=1){return e-Math.abs(zy(o,2*e)-e)}function gQ(o,e,t){return o<=e?0:o>=t?1:(o=(o-e)/(t-e))*o*(3-2*o)}function Vy(o,e,t){return o<=e?0:o>=t?1:(o=(o-e)/(t-e))*o*o*(o*(6*o-15)+10)}function vQ(o,e){return o+Math.floor(Math.random()*(e-o+1))}function _Q(o,e){return o+Math.random()*(e-o)}function AQ(o){return o*(.5-Math.random())}function xQ(o){o!==void 0&&(tM=o);let e=tM+=1831565813;return e=Math.imul(e^e>>>15,1|e),e^=e+Math.imul(e^e>>>7,61|e),((e^e>>>14)>>>0)/4294967296}function cp(o){return o*ls}function vv(o){return o*gd}function _2(o){return!(o&o-1)&&o!==0}function c5(o){return Math.pow(2,Math.ceil(Math.log(o)/Math.LN2))}function Vg(o){return Math.pow(2,Math.floor(Math.log(o)/Math.LN2))}function yQ(o,e,t,n,r){const a=Math.cos,i=Math.sin,s=a(t/2),c=i(t/2),u=a((e+n)/2),h=i((e+n)/2),f=a((e-n)/2),m=i((e-n)/2),g=a((n-e)/2),A=i((n-e)/2);switch(r){case"XYX":o.set(s*h,c*f,c*m,s*u);break;case"YZY":o.set(c*m,s*h,c*f,s*u);break;case"ZXZ":o.set(c*f,c*m,s*h,s*u);break;case"XZX":o.set(s*h,c*A,c*g,s*u);break;case"YXY":o.set(c*g,s*h,c*A,s*u);break;case"ZYZ":o.set(c*A,c*g,s*h,s*u);break;default:console.warn("v3d.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+r)}}function is(o,e){switch(e.constructor){case Float32Array:return o;case Uint16Array:return o/65535;case Uint8Array:return o/255;case Int16Array:return Math.max(o/32767,-1);case Int8Array:return Math.max(o/127,-1);default:throw new Error("Invalid component type.")}}function cn(o,e){switch(e.constructor){case Float32Array:return o;case Uint16Array:return Math.round(65535*o);case Uint8Array:return Math.round(255*o);case Int16Array:return Math.round(32767*o);case Int8Array:return Math.round(127*o);default:throw new Error("Invalid component type.")}}function vd(o){let e=5381,t=o.length;for(;t;)e=33*e^o.charCodeAt(--t);return e>>>0}function u5(o,e,t,n){let r=Math.exp(-t/n);return o*r+(1-r)*e}function fr(o,e,t,n,r){let a=u5(o,e,t,n);return Math.abs(o-e)<r&&(a=e),a}function Hh(o){return Ft(o-2*Math.PI*Math.floor(o/(2*Math.PI)),0,2*Math.PI)}function cg(o){let e=o+Math.PI;return e%=2*Math.PI,e+=2*Math.PI,e%=2*Math.PI,e-=Math.PI,e}function ky(o,e,t){let n=Hh(o-e),r=Hh(t-e);return n>r&&(n=n<r/2+Math.PI?r:0),n+e}var bQ=Object.freeze({__proto__:null,DEG2RAD:ls,RAD2DEG:gd,angleToRange_0_2Pi:Hh,angleToRange_mPi_Pi:cg,ceilPowerOfTwo:c5,checkUUID:Uy,clamp:Ft,clampAngle:ky,damp:pQ,degToRad:cp,denormalize:is,euclideanModulo:zy,expAverage:u5,expAverageClamp:fr,floorPowerOfTwo:Vg,generateUUID:Wo,hashString:vd,inverseLerp:hQ,isPowerOfTwo:_2,lerp:ui,mapLinear:fQ,normalize:cn,pingpong:mQ,radToDeg:vv,randFloat:_Q,randFloatSpread:AQ,randInt:vQ,seededRandom:xQ,setQuaternionFromProperEuler:yQ,smootherstep:Vy,smoothstep:gQ});class Ee{constructor(e=0,t=0){Ee.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,n=this.y,r=e.elements;return this.x=r[0]*t+r[3]*n+r[6],this.y=r[1]*t+r[4]*n+r[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y;return t*t+n*n}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const n=Math.cos(t),r=Math.sin(t),a=this.x-e.x,i=this.y-e.y;return this.x=a*n-i*r+e.x,this.y=a*r+i*n+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class Qr{constructor(){Qr.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1]}set(e,t,n,r,a,i,s,c,u){const h=this.elements;return h[0]=e,h[1]=r,h[2]=s,h[3]=t,h[4]=a,h[5]=c,h[6]=n,h[7]=i,h[8]=u,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],this}extractBasis(e,t,n){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,r=t.elements,a=this.elements,i=n[0],s=n[3],c=n[6],u=n[1],h=n[4],f=n[7],m=n[2],g=n[5],A=n[8],_=r[0],x=r[3],C=r[6],b=r[1],y=r[4],M=r[7],R=r[2],T=r[5],w=r[8];return a[0]=i*_+s*b+c*R,a[3]=i*x+s*y+c*T,a[6]=i*C+s*M+c*w,a[1]=u*_+h*b+f*R,a[4]=u*x+h*y+f*T,a[7]=u*C+h*M+f*w,a[2]=m*_+g*b+A*R,a[5]=m*x+g*y+A*T,a[8]=m*C+g*M+A*w,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[1],r=e[2],a=e[3],i=e[4],s=e[5],c=e[6],u=e[7],h=e[8];return t*i*h-t*s*u-n*a*h+n*s*c+r*a*u-r*i*c}invert(){const e=this.elements,t=e[0],n=e[1],r=e[2],a=e[3],i=e[4],s=e[5],c=e[6],u=e[7],h=e[8],f=h*i-s*u,m=s*c-h*a,g=u*a-i*c,A=t*f+n*m+r*g;if(A===0)return this.set(0,0,0,0,0,0,0,0,0);const _=1/A;return e[0]=f*_,e[1]=(r*u-h*n)*_,e[2]=(s*n-r*i)*_,e[3]=m*_,e[4]=(h*t-r*c)*_,e[5]=(r*a-s*t)*_,e[6]=g*_,e[7]=(n*c-u*t)*_,e[8]=(i*t-n*a)*_,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,n,r,a,i,s){const c=Math.cos(a),u=Math.sin(a);return this.set(n*c,n*u,-n*(c*i+u*s)+i+e,-r*u,r*c,-r*(-u*i+c*s)+s+t,0,0,1),this}scale(e,t){return this.premultiply(sA.makeScale(e,t)),this}rotate(e){return this.premultiply(sA.makeRotation(-e)),this}translate(e,t){return this.premultiply(sA.makeTranslation(e,t)),this}makeTranslation(e,t){return this.set(1,0,e,0,1,t,0,0,1),this}makeRotation(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,n,t,0,0,0,1),this}makeScale(e,t){return this.set(e,0,0,0,t,0,0,0,1),this}equals(e){const t=this.elements,n=e.elements;for(let r=0;r<9;r++)if(t[r]!==n[r])return!1;return!0}fromArray(e,t=0){for(let n=0;n<9;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e}clone(){return new this.constructor().fromArray(this.elements)}}const sA=new Qr;function SQ(o){if(o.length===0)return 1/0;let e=o[0];for(let t=1,n=o.length;t<n;++t)o[t]<e&&(e=o[t]);return e}function d5(o){if(o.length===0)return-1/0;let e=o[0];for(let t=1,n=o.length;t<n;++t)o[t]>e&&(e=o[t]);return e}function f5(o){for(let e=o.length-1;e>=0;--e)if(o[e]>=65535)return!0;return!1}function Wh(o){return document.createElementNS("http://www.w3.org/1999/xhtml",o)}function _e(o){return o!==void 0}function h5(o,e,t){for(let n=0;n<o.length;n++)o[n]=Ft(o[n],e,t);return o}function ug(o){return o.charAt(0).toUpperCase()+o.slice(1).toLowerCase()}function p5(o){return o.toLowerCase().replace(/_([a-zA-Z])/g,function(e){return e[1].toUpperCase()})}function CQ(){return"Ultimate"}function nM(o){const e=o.match(/^[a-zA-Z38 ]*(\d+).(\d+).(\d+)(?: (.*))?$/)??[];let t=Number(e[1]),n=Number(e[2]),r=Number(e[3]);return t=Number.isNaN(t)?0:t,n=Number.isNaN(n)?0:n,r=Number.isNaN(r)?0:r,{major:t,minor:n,patch:r,pre:e[4]??""}}function rM(o){if(o==="")return 1/0;const e=o.match(/^pre(\d+)$/)??[];let t=Number(e[1]);return t=Number.isNaN(t)?0:t,t}function m5(o,e,t=3){const n=nM(o),r=nM(e);let a=r.major-n.major;return a===0&&t>1&&(a=r.minor-n.minor,a===0&&t>2&&(a=r.patch-n.patch,a===0&&t>3&&(a=rM(r.pre)-rM(n.pre),isNaN(a)&&(a=0)))),Math.sign(a)}function al(o){return`${o%1?o:`${o}.0`}`}function Yh(){return typeof window<"u"?window:typeof self<"u"?self:global}const ql={};function _v(o=""){const e=document.getElementsByTagName("script");let t=o;for(let n=e.length-1;n>=0;--n){const r=e[n].src,a=r.search(/\/v3d[\w.]+js/);a>-1&&(t=r.substr(0,a)+"/"+o)}return t}function g5(o,e=function(n){},t=function(n){}){ql[o]=ql[o]||{status:0,loadCallbacks:[],errorCallbacks:[]};const n=ql[o];if(n.status==4)return void e(o);if(n.loadCallbacks.push(e),n.errorCallbacks.push(t),n.status>0)return;let r=_v(o);const a=document.createElement("script");a.type="text/javascript",a.src=r,function(i){a.onload=function(){ql[i].loadCallbacks.forEach(function(s){s(i)}),ql[i].status=4},a.onerror=function(){ql[i].errorCallbacks.forEach(function(s){s(i)}),ql[i].status=0}}(o),document.getElementsByTagName("head")[0].appendChild(a),n.status=3}function EQ(o,e,t=0){const n=function(a,i,s,c){const u=performance.now();return e(a,i,s),u-c>t?(c=u,new Promise(function(h){setTimeout(function(){h(c)},1)})):c};let r=Promise.resolve(performance.now());return o.forEach(function(a,i,s){r=r.then(n.bind(null,a,i,s))}),r}function yc(o){return o<.04045?.0773993808*o:Math.pow(.9478672986*o+.0521327014,2.4)}function dg(o){return o<.0031308?12.92*o:1.055*Math.pow(o,.41666)-.055}const lA={[m2]:{[g2]:yc},[g2]:{[m2]:dg}},Br={legacyMode:!0,get workingColorSpace(){return"srgb-linear"},set workingColorSpace(o){console.warn("v3d.ColorManagement: .workingColorSpace is readonly.")},convert:function(o,e,t){if(this.legacyMode||e===t||!e||!t)return o;if(lA[e]&&lA[e][t]!==void 0){const n=lA[e][t];return o.r=n(o.r),o.g=n(o.g),o.b=n(o.b),o}throw new Error("Unsupported color space conversion.")},fromWorkingColorSpace:function(o,e){return this.convert(o,this.workingColorSpace,e)},toWorkingColorSpace:function(o,e){return this.convert(o,e,this.workingColorSpace)}},v5={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},ur={r:0,g:0,b:0},Ca={h:0,s:0,l:0},Pm={h:0,s:0,l:0};function cA(o,e,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?o+6*(e-o)*t:t<.5?e:t<2/3?o+6*(e-o)*(2/3-t):o}function Nm(o,e){return e.r=o.r,e.g=o.g,e.b=o.b,e}class Qe{constructor(e,t,n){return this.isColor=!0,this.r=1,this.g=1,this.b=1,t===void 0&&n===void 0?this.set(e):this.setRGB(e,t,n)}set(e){return e&&e.isColor?this.copy(e):typeof e=="number"?this.setHex(e):typeof e=="string"&&this.setStyle(e),this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,t="srgb"){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,Br.toWorkingColorSpace(this,t),this}setRGB(e,t,n,r=Br.workingColorSpace){return this.r=e,this.g=t,this.b=n,Br.toWorkingColorSpace(this,r),this}setHSL(e,t,n,r=Br.workingColorSpace){if(e=zy(e,1),t=Ft(t,0,1),n=Ft(n,0,1),t===0)this.r=this.g=this.b=n;else{const a=n<=.5?n*(1+t):n+t-n*t,i=2*n-a;this.r=cA(i,a,e+1/3),this.g=cA(i,a,e),this.b=cA(i,a,e-1/3)}return Br.toWorkingColorSpace(this,r),this}setStyle(e,t="srgb"){function n(a){a!==void 0&&parseFloat(a)<1&&console.warn("v3d.Color: Alpha component of "+e+" will be ignored.")}let r;if(r=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(e)){let a;const i=r[1],s=r[2];switch(i){case"rgb":case"rgba":if(a=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s))return this.r=Math.min(255,parseInt(a[1],10))/255,this.g=Math.min(255,parseInt(a[2],10))/255,this.b=Math.min(255,parseInt(a[3],10))/255,Br.toWorkingColorSpace(this,t),n(a[4]),this;if(a=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s))return this.r=Math.min(100,parseInt(a[1],10))/100,this.g=Math.min(100,parseInt(a[2],10))/100,this.b=Math.min(100,parseInt(a[3],10))/100,Br.toWorkingColorSpace(this,t),n(a[4]),this;break;case"hsl":case"hsla":if(a=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s)){const c=parseFloat(a[1])/360,u=parseFloat(a[2])/100,h=parseFloat(a[3])/100;return n(a[4]),this.setHSL(c,u,h,t)}}}else if(r=/^\#([A-Fa-f\d]+)$/.exec(e)){const a=r[1],i=a.length;if(i===3)return this.r=parseInt(a.charAt(0)+a.charAt(0),16)/255,this.g=parseInt(a.charAt(1)+a.charAt(1),16)/255,this.b=parseInt(a.charAt(2)+a.charAt(2),16)/255,Br.toWorkingColorSpace(this,t),this;if(i===6)return this.r=parseInt(a.charAt(0)+a.charAt(1),16)/255,this.g=parseInt(a.charAt(2)+a.charAt(3),16)/255,this.b=parseInt(a.charAt(4)+a.charAt(5),16)/255,Br.toWorkingColorSpace(this,t),this}return e&&e.length>0?this.setColorName(e,t):this}setColorName(e,t="srgb"){const n=v5[e.toLowerCase()];return n!==void 0?this.setHex(n,t):console.warn("v3d.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=yc(e.r),this.g=yc(e.g),this.b=yc(e.b),this}copyLinearToSRGB(e){return this.r=dg(e.r),this.g=dg(e.g),this.b=dg(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e="srgb"){return Br.fromWorkingColorSpace(Nm(this,ur),e),Ft(255*ur.r,0,255)<<16^Ft(255*ur.g,0,255)<<8^Ft(255*ur.b,0,255)}getHexString(e="srgb"){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,t=Br.workingColorSpace){Br.fromWorkingColorSpace(Nm(this,ur),t);const n=ur.r,r=ur.g,a=ur.b,i=Math.max(n,r,a),s=Math.min(n,r,a);let c,u;const h=(s+i)/2;if(s===i)c=0,u=0;else{const f=i-s;switch(u=h<=.5?f/(i+s):f/(2-i-s),i){case n:c=(r-a)/f+(r<a?6:0);break;case r:c=(a-n)/f+2;break;case a:c=(n-r)/f+4}c/=6}return e.h=c,e.s=u,e.l=h,e}getRGB(e,t=Br.workingColorSpace){return Br.fromWorkingColorSpace(Nm(this,ur),t),e.r=ur.r,e.g=ur.g,e.b=ur.b,e}getStyle(e="srgb"){return Br.fromWorkingColorSpace(Nm(this,ur),e),e!=="srgb"?`color(${e} ${ur.r} ${ur.g} ${ur.b})`:`rgb(${255*ur.r|0},${255*ur.g|0},${255*ur.b|0})`}offsetHSL(e,t,n){return this.getHSL(Ca),Ca.h+=e,Ca.s+=t,Ca.l+=n,this.setHSL(Ca.h,Ca.s,Ca.l),this}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,n){return this.r=e.r+(t.r-e.r)*n,this.g=e.g+(t.g-e.g)*n,this.b=e.b+(t.b-e.b)*n,this}lerpHSL(e,t){this.getHSL(Ca),e.getHSL(Pm);const n=ui(Ca.h,Pm.h,t),r=ui(Ca.s,Pm.s,t),a=ui(Ca.l,Pm.l,t);return this.setHSL(n,r,a),this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}let mu;Qe.NAMES=v5;class _5{static getDataURL(e){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement>"u")return e.src;let t;if(e instanceof HTMLCanvasElement)t=e;else{mu===void 0&&(mu=Wh("canvas")),mu.width=e.width,mu.height=e.height;const n=mu.getContext("2d");e instanceof ImageData?n.putImageData(e,0,0):n.drawImage(e,0,0,e.width,e.height),t=mu}return t.width>2048||t.height>2048?(console.warn("v3d.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),t.toDataURL("image/jpeg",.6)):t.toDataURL("image/png")}static sRGBToLinear(e){if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap){const t=Wh("canvas");t.width=e.width,t.height=e.height;const n=t.getContext("2d");n.drawImage(e,0,0,e.width,e.height);const r=n.getImageData(0,0,e.width,e.height),a=r.data;for(let i=0;i<a.length;i++)a[i]=255*yc(a[i]/255);return n.putImageData(r,0,0),t}if(e.data){const t=e.data.slice(0);for(let n=0;n<t.length;n++)t instanceof Uint8Array||t instanceof Uint8ClampedArray?t[n]=Math.floor(255*yc(t[n]/255)):t[n]=yc(t[n]);return{data:t,width:e.width,height:e.height}}return console.warn("v3d.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}let MQ=0;class Av{constructor(e=null){this.isSource=!0,Object.defineProperty(this,"id",{value:MQ++}),this.uuid=Wo(),this.data=e,this.version=0}set needsUpdate(e){e===!0&&this.version++}}let wQ=0;class In extends oo{constructor(e=In.DEFAULT_IMAGE,t=In.DEFAULT_MAPPING,n=1001,r=1001,a=1006,i=1008,s=1023,c=1009,u=In.DEFAULT_ANISOTROPY,h=3e3){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:wQ++}),this.uuid=Wo(),this.name="",this.source=new Av(e),this.mipmaps=[],this.mapping=t,this.wrapS=n,this.wrapT=r,this.magFilter=a,this.minFilter=i,this.anisotropy=u,this.format=s,this.internalFormat=null,this.type=c,this.offset=new Ee(0,0),this.repeat=new Ee(1,1),this.center=new Ee(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Qr,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=h,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(e){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.encoding=e.encoding,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==300)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case 1e3:e.x=e.x-Math.floor(e.x);break;case 1001:e.x=e.x<0?0:1;break;case 1002:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x)}if(e.y<0||e.y>1)switch(this.wrapT){case 1e3:e.y=e.y-Math.floor(e.y);break;case 1001:e.y=e.y<0?0:1;break;case 1002:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y)}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&(this.version++,this.source.needsUpdate=!0)}}In.DEFAULT_IMAGE=null,In.DEFAULT_MAPPING=300,In.DEFAULT_ANISOTROPY=1;class ct{constructor(e=0,t=0,n=0,r=1){ct.prototype.isVector4=!0,this.x=e,this.y=t,this.z=n,this.w=r}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,n,r){return this.x=e,this.y=t,this.z=n,this.w=r,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,n=this.y,r=this.z,a=this.w,i=e.elements;return this.x=i[0]*t+i[4]*n+i[8]*r+i[12]*a,this.y=i[1]*t+i[5]*n+i[9]*r+i[13]*a,this.z=i[2]*t+i[6]*n+i[10]*r+i[14]*a,this.w=i[3]*t+i[7]*n+i[11]*r+i[15]*a,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,n,r,a;const c=e.elements,u=c[0],h=c[4],f=c[8],m=c[1],g=c[5],A=c[9],_=c[2],x=c[6],C=c[10];if(Math.abs(h-m)<.01&&Math.abs(f-_)<.01&&Math.abs(A-x)<.01){if(Math.abs(h+m)<.1&&Math.abs(f+_)<.1&&Math.abs(A+x)<.1&&Math.abs(u+g+C-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;const y=(u+1)/2,M=(g+1)/2,R=(C+1)/2,T=(h+m)/4,w=(f+_)/4,D=(A+x)/4;return y>M&&y>R?y<.01?(n=0,r=.707106781,a=.707106781):(n=Math.sqrt(y),r=T/n,a=w/n):M>R?M<.01?(n=.707106781,r=0,a=.707106781):(r=Math.sqrt(M),n=T/r,a=D/r):R<.01?(n=.707106781,r=.707106781,a=0):(a=Math.sqrt(R),n=w/a,r=D/a),this.set(n,r,a,t),this}let b=Math.sqrt((x-A)*(x-A)+(f-_)*(f-_)+(m-h)*(m-h));return Math.abs(b)<.001&&(b=1),this.x=(x-A)/b,this.y=(f-_)/b,this.z=(m-h)/b,this.w=Math.acos((u+g+C-1)/2),this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this.w=e.w+(t.w-e.w)*n,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class qt extends oo{constructor(e=1,t=1,n={}){super(),this.isWebGLRenderTarget=!0,this.width=e,this.height=t,this.depth=1,this.scissor=new ct(0,0,e,t),this.scissorTest=!1,this.viewport=new ct(0,0,e,t);const r={width:e,height:t,depth:1};this.texture=new In(r,n.mapping,n.wrapS,n.wrapT,n.magFilter,n.minFilter,n.format,n.type,n.anisotropy,n.encoding),this.texture.isRenderTargetTexture=!0,this.texture.flipY=!1,this.texture.generateMipmaps=n.generateMipmaps!==void 0&&n.generateMipmaps,this.texture.internalFormat=n.internalFormat!==void 0?n.internalFormat:null,this.texture.minFilter=n.minFilter!==void 0?n.minFilter:1006,this.depthBuffer=n.depthBuffer===void 0||n.depthBuffer,this.stencilBuffer=n.stencilBuffer!==void 0&&n.stencilBuffer,this.depthTexture=n.depthTexture!==void 0?n.depthTexture:null,this.samples=n.samples!==void 0?n.samples:0}setSize(e,t,n=1){this.width===e&&this.height===t&&this.depth===n||(this.width=e,this.height=t,this.depth=n,this.texture.image.width=e,this.texture.image.height=t,this.texture.image.depth=n,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return new this.constructor().copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.texture.isRenderTargetTexture=!0;const t=Object.assign({},e.texture.image);return this.texture.source=new Av(t),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,e.depthTexture!==null&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class xv extends In{constructor(e=null,t=1,n=1,r=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:t,height:n,depth:r},this.magFilter=1003,this.minFilter=1003,this.wrapR=1001,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class TQ extends qt{constructor(e=1,t=1,n=1){super(e,t),this.isWebGLArrayRenderTarget=!0,this.depth=n,this.texture=new xv(null,e,t,n),this.texture.isRenderTargetTexture=!0}}class Gy extends In{constructor(e=null,t=1,n=1,r=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:t,height:n,depth:r},this.magFilter=1003,this.minFilter=1003,this.wrapR=1001,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class RQ extends qt{constructor(e=1,t=1,n=1){super(e,t),this.isWebGL3DRenderTarget=!0,this.depth=n,this.texture=new Gy(null,e,t,n),this.texture.isRenderTargetTexture=!0}}class A2 extends qt{constructor(e=1,t=1,n=1,r={}){super(e,t,r),this.isWebGLMultipleRenderTargets=!0;const a=this.texture;this.texture=[];for(let i=0;i<n;i++)this.texture[i]=a.clone(),this.texture[i].isRenderTargetTexture=!0}setSize(e,t,n=1){if(this.width!==e||this.height!==t||this.depth!==n){this.width=e,this.height=t,this.depth=n;for(let r=0,a=this.texture.length;r<a;r++)this.texture[r].image.width=e,this.texture[r].image.height=t,this.texture[r].image.depth=n;this.dispose()}return this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t),this}copy(e){this.dispose(),this.width=e.width,this.height=e.height,this.depth=e.depth,this.viewport.set(0,0,this.width,this.height),this.scissor.set(0,0,this.width,this.height),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,e.depthTexture!==null&&(this.depthTexture=e.depthTexture.clone()),this.texture.length=0;for(let t=0,n=e.texture.length;t<n;t++)this.texture[t]=e.texture[t].clone(),this.texture[t].isRenderTargetTexture=!0;return this}}class Ct{constructor(e=0,t=0,n=0,r=1){this.isQuaternion=!0,this._x=e,this._y=t,this._z=n,this._w=r}static slerpFlat(e,t,n,r,a,i,s){let c=n[r+0],u=n[r+1],h=n[r+2],f=n[r+3];const m=a[i+0],g=a[i+1],A=a[i+2],_=a[i+3];if(s===0)return e[t+0]=c,e[t+1]=u,e[t+2]=h,void(e[t+3]=f);if(s===1)return e[t+0]=m,e[t+1]=g,e[t+2]=A,void(e[t+3]=_);if(f!==_||c!==m||u!==g||h!==A){let x=1-s;const C=c*m+u*g+h*A+f*_,b=C>=0?1:-1,y=1-C*C;if(y>Number.EPSILON){const R=Math.sqrt(y),T=Math.atan2(R,C*b);x=Math.sin(x*T)/R,s=Math.sin(s*T)/R}const M=s*b;if(c=c*x+m*M,u=u*x+g*M,h=h*x+A*M,f=f*x+_*M,x===1-s){const R=1/Math.sqrt(c*c+u*u+h*h+f*f);c*=R,u*=R,h*=R,f*=R}}e[t]=c,e[t+1]=u,e[t+2]=h,e[t+3]=f}static multiplyQuaternionsFlat(e,t,n,r,a,i){const s=n[r],c=n[r+1],u=n[r+2],h=n[r+3],f=a[i],m=a[i+1],g=a[i+2],A=a[i+3];return e[t]=s*A+h*f+c*g-u*m,e[t+1]=c*A+h*m+u*f-s*g,e[t+2]=u*A+h*g+s*m-c*f,e[t+3]=h*A-s*f-c*m-u*g,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,n,r){return this._x=e,this._y=t,this._z=n,this._w=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t){const n=e._x,r=e._y,a=e._z,i=e._order,s=Math.cos,c=Math.sin,u=s(n/2),h=s(r/2),f=s(a/2),m=c(n/2),g=c(r/2),A=c(a/2);switch(i){case"XYZ":this._x=m*h*f+u*g*A,this._y=u*g*f-m*h*A,this._z=u*h*A+m*g*f,this._w=u*h*f-m*g*A;break;case"YXZ":this._x=m*h*f+u*g*A,this._y=u*g*f-m*h*A,this._z=u*h*A-m*g*f,this._w=u*h*f+m*g*A;break;case"ZXY":this._x=m*h*f-u*g*A,this._y=u*g*f+m*h*A,this._z=u*h*A+m*g*f,this._w=u*h*f-m*g*A;break;case"ZYX":this._x=m*h*f-u*g*A,this._y=u*g*f+m*h*A,this._z=u*h*A-m*g*f,this._w=u*h*f+m*g*A;break;case"YZX":this._x=m*h*f+u*g*A,this._y=u*g*f+m*h*A,this._z=u*h*A-m*g*f,this._w=u*h*f-m*g*A;break;case"XZY":this._x=m*h*f-u*g*A,this._y=u*g*f-m*h*A,this._z=u*h*A+m*g*f,this._w=u*h*f+m*g*A;break;default:console.warn("v3d.Quaternion: .setFromEuler() encountered an unknown order: "+i)}return t!==!1&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const n=t/2,r=Math.sin(n);return this._x=e.x*r,this._y=e.y*r,this._z=e.z*r,this._w=Math.cos(n),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,n=t[0],r=t[4],a=t[8],i=t[1],s=t[5],c=t[9],u=t[2],h=t[6],f=t[10],m=n+s+f;if(m>0){const g=.5/Math.sqrt(m+1);this._w=.25/g,this._x=(h-c)*g,this._y=(a-u)*g,this._z=(i-r)*g}else if(n>s&&n>f){const g=2*Math.sqrt(1+n-s-f);this._w=(h-c)/g,this._x=.25*g,this._y=(r+i)/g,this._z=(a+u)/g}else if(s>f){const g=2*Math.sqrt(1+s-n-f);this._w=(a-u)/g,this._x=(r+i)/g,this._y=.25*g,this._z=(c+h)/g}else{const g=2*Math.sqrt(1+f-n-s);this._w=(i-r)/g,this._x=(a+u)/g,this._y=(c+h)/g,this._z=.25*g}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let n=e.dot(t)+1;return n<Number.EPSILON?(n=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=n):(this._x=0,this._y=-e.z,this._z=e.y,this._w=n)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=n),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(Ft(this.dot(e),-1,1)))}rotateTowards(e,t){const n=this.angleTo(e);if(n===0)return this;const r=Math.min(1,t/n);return this.slerp(e,r),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const n=e._x,r=e._y,a=e._z,i=e._w,s=t._x,c=t._y,u=t._z,h=t._w;return this._x=n*h+i*s+r*u-a*c,this._y=r*h+i*c+a*s-n*u,this._z=a*h+i*u+n*c-r*s,this._w=i*h-n*s-r*c-a*u,this._onChangeCallback(),this}slerp(e,t){if(t===0)return this;if(t===1)return this.copy(e);const n=this._x,r=this._y,a=this._z,i=this._w;let s=i*e._w+n*e._x+r*e._y+a*e._z;if(s<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,s=-s):this.copy(e),s>=1)return this._w=i,this._x=n,this._y=r,this._z=a,this;const c=1-s*s;if(c<=Number.EPSILON){const g=1-t;return this._w=g*i+t*this._w,this._x=g*n+t*this._x,this._y=g*r+t*this._y,this._z=g*a+t*this._z,this.normalize(),this._onChangeCallback(),this}const u=Math.sqrt(c),h=Math.atan2(u,s),f=Math.sin((1-t)*h)/u,m=Math.sin(t*h)/u;return this._w=i*f+this._w*m,this._x=n*f+this._x*m,this._y=r*f+this._y*m,this._z=a*f+this._z*m,this._onChangeCallback(),this}slerpQuaternions(e,t,n){return this.copy(e).slerp(t,n)}random(){const e=Math.random(),t=Math.sqrt(1-e),n=Math.sqrt(e),r=2*Math.PI*Math.random(),a=2*Math.PI*Math.random();return this.set(t*Math.cos(r),n*Math.sin(a),n*Math.cos(a),t*Math.sin(r))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class B{constructor(e=0,t=0,n=0){B.prototype.isVector3=!0,this.x=e,this.y=t,this.z=n}set(e,t,n){return n===void 0&&(n=this.z),this.x=e,this.y=t,this.z=n,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(oM.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(oM.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,n=this.y,r=this.z,a=e.elements;return this.x=a[0]*t+a[3]*n+a[6]*r,this.y=a[1]*t+a[4]*n+a[7]*r,this.z=a[2]*t+a[5]*n+a[8]*r,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,n=this.y,r=this.z,a=e.elements,i=1/(a[3]*t+a[7]*n+a[11]*r+a[15]);return this.x=(a[0]*t+a[4]*n+a[8]*r+a[12])*i,this.y=(a[1]*t+a[5]*n+a[9]*r+a[13])*i,this.z=(a[2]*t+a[6]*n+a[10]*r+a[14])*i,this}applyQuaternion(e){const t=this.x,n=this.y,r=this.z,a=e.x,i=e.y,s=e.z,c=e.w,u=c*t+i*r-s*n,h=c*n+s*t-a*r,f=c*r+a*n-i*t,m=-a*t-i*n-s*r;return this.x=u*c+m*-a+h*-s-f*-i,this.y=h*c+m*-i+f*-a-u*-s,this.z=f*c+m*-s+u*-i-h*-a,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,n=this.y,r=this.z,a=e.elements;return this.x=a[0]*t+a[4]*n+a[8]*r,this.y=a[1]*t+a[5]*n+a[9]*r,this.z=a[2]*t+a[6]*n+a[10]*r,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){const n=e.x,r=e.y,a=e.z,i=t.x,s=t.y,c=t.z;return this.x=r*c-a*s,this.y=a*i-n*c,this.z=n*s-r*i,this}projectOnVector(e){const t=e.lengthSq();if(t===0)return this.set(0,0,0);const n=e.dot(this)/t;return this.copy(e).multiplyScalar(n)}projectOnPlane(e){return uA.copy(this).projectOnVector(e),this.sub(uA)}reflect(e){return this.sub(uA.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const n=this.dot(e)/t;return Math.acos(Ft(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y,r=this.z-e.z;return t*t+n*n+r*r}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,n){const r=Math.sin(t)*e;return this.x=r*Math.sin(n),this.y=Math.cos(t)*e,this.z=r*Math.cos(n),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,n){return this.x=e*Math.sin(t),this.y=n,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),n=this.setFromMatrixColumn(e,1).length(),r=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=n,this.z=r,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,4*t)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,3*t)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=2*(Math.random()-.5),t=Math.random()*Math.PI*2,n=Math.sqrt(1-e**2);return this.x=n*Math.cos(t),this.y=n*Math.sin(t),this.z=e,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const uA=new B,oM=new Ct;class mn{constructor(e=new B(1/0,1/0,1/0),t=new B(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){let t=1/0,n=1/0,r=1/0,a=-1/0,i=-1/0,s=-1/0;for(let c=0,u=e.length;c<u;c+=3){const h=e[c],f=e[c+1],m=e[c+2];h<t&&(t=h),f<n&&(n=f),m<r&&(r=m),h>a&&(a=h),f>i&&(i=f),m>s&&(s=m)}return this.min.set(t,n,r),this.max.set(a,i,s),this}setFromBufferAttribute(e){let t=1/0,n=1/0,r=1/0,a=-1/0,i=-1/0,s=-1/0;for(let c=0,u=e.count;c<u;c++){const h=e.getX(c),f=e.getY(c),m=e.getZ(c);h<t&&(t=h),f<n&&(n=f),m<r&&(r=m),h>a&&(a=h),f>i&&(i=f),m>s&&(s=m)}return this.min.set(t,n,r),this.max.set(a,i,s),this}setFromPoints(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const n=Zl.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}setFromObject(e,t=!1){return this.makeEmpty(),this.expandByObject(e,t)}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,t=!1){e.updateWorldMatrix(!1,!1);const n=e.geometry;if(n!==void 0)if(t&&n.attributes!=null&&n.attributes.position!==void 0){const a=n.attributes.position;for(let i=0,s=a.count;i<s;i++)Zl.fromBufferAttribute(a,i).applyMatrix4(e.matrixWorld),this.expandByPoint(Zl)}else n.boundingBox===null&&n.computeBoundingBox(),dA.copy(n.boundingBox),dA.applyMatrix4(e.matrixWorld),this.union(dA);const r=e.children;for(let a=0,i=r.length;a<i;a++)this.expandByObject(r[a],t);return this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}intersectsSphere(e){return this.clampPoint(e.center,Zl),Zl.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,n;return e.normal.x>0?(t=e.normal.x*this.min.x,n=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,n=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,n+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,n+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,n+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,n+=e.normal.z*this.min.z),t<=-e.constant&&n>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(Hi),Vs.subVectors(this.max,Hi),gu.subVectors(e.a,Hi),vu.subVectors(e.b,Hi),_u.subVectors(e.c,Hi),Us.subVectors(vu,gu),zs.subVectors(_u,vu),Kl.subVectors(gu,_u);let t=[0,-Us.z,Us.y,0,-zs.z,zs.y,0,-Kl.z,Kl.y,Us.z,0,-Us.x,zs.z,0,-zs.x,Kl.z,0,-Kl.x,-Us.y,Us.x,0,-zs.y,zs.x,0,-Kl.y,Kl.x,0];return!!fA(t,gu,vu,_u,Vs)&&(t=[1,0,0,0,1,0,0,0,1],!!fA(t,gu,vu,_u,Vs)&&(Dm.crossVectors(Us,zs),t=[Dm.x,Dm.y,Dm.z],fA(t,gu,vu,_u,Vs)))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return Zl.copy(e).clamp(this.min,this.max).sub(e).length()}getBoundingSphere(e){return this.getCenter(e.center),e.radius=.5*this.getSize(Zl).length(),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()||(Qi[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),Qi[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),Qi[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),Qi[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),Qi[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),Qi[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),Qi[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),Qi[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(Qi)),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}scale(e){return this.getCenter(Hi),Vs.subVectors(this.max,Hi),Vs.multiply(e),this.min.copy(Hi).sub(Vs),this.max.copy(Hi).add(Vs),this}}const Qi=[new B,new B,new B,new B,new B,new B,new B,new B],Zl=new B,dA=new mn,gu=new B,vu=new B,_u=new B,Us=new B,zs=new B,Kl=new B,Hi=new B,Vs=new B,Dm=new B,$l=new B;function fA(o,e,t,n,r){for(let a=0,i=o.length-3;a<=i;a+=3){$l.fromArray(o,a);const s=r.x*Math.abs($l.x)+r.y*Math.abs($l.y)+r.z*Math.abs($l.z),c=e.dot($l),u=t.dot($l),h=n.dot($l);if(Math.max(-Math.max(c,u,h),Math.min(c,u,h))>s)return!1}return!0}const IQ=new mn,Pf=new B,hA=new B;class Yo{constructor(e=new B,t=-1){this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const n=this.center;t!==void 0?n.copy(t):IQ.setFromPoints(e).getCenter(n);let r=0;for(let a=0,i=e.length;a<i;a++)r=Math.max(r,n.distanceToSquared(e[a]));return this.radius=Math.sqrt(r),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const n=this.center.distanceToSquared(e);return t.copy(e),n>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;Pf.subVectors(e,this.center);const t=Pf.lengthSq();if(t>this.radius*this.radius){const n=Math.sqrt(t),r=.5*(n-this.radius);this.center.addScaledVector(Pf,r/n),this.radius+=r}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(this.center.equals(e.center)===!0?this.radius=Math.max(this.radius,e.radius):(hA.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(Pf.copy(e.center).add(hA)),this.expandByPoint(Pf.copy(e.center).sub(hA))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return new this.constructor().copy(this)}}const Wi=new B,pA=new B,Om=new B,ks=new B,mA=new B,Fm=new B,gA=new B;class Td{constructor(e=new B,t=new B(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.direction).multiplyScalar(e).add(this.origin)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,Wi)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);const n=t.dot(this.direction);return n<0?t.copy(this.origin):t.copy(this.direction).multiplyScalar(n).add(this.origin)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const t=Wi.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(Wi.copy(this.direction).multiplyScalar(t).add(this.origin),Wi.distanceToSquared(e))}distanceSqToSegment(e,t,n,r){pA.copy(e).add(t).multiplyScalar(.5),Om.copy(t).sub(e).normalize(),ks.copy(this.origin).sub(pA);const a=.5*e.distanceTo(t),i=-this.direction.dot(Om),s=ks.dot(this.direction),c=-ks.dot(Om),u=ks.lengthSq(),h=Math.abs(1-i*i);let f,m,g,A;if(h>0)if(f=i*c-s,m=i*s-c,A=a*h,f>=0)if(m>=-A)if(m<=A){const _=1/h;f*=_,m*=_,g=f*(f+i*m+2*s)+m*(i*f+m+2*c)+u}else m=a,f=Math.max(0,-(i*m+s)),g=-f*f+m*(m+2*c)+u;else m=-a,f=Math.max(0,-(i*m+s)),g=-f*f+m*(m+2*c)+u;else m<=-A?(f=Math.max(0,-(-i*a+s)),m=f>0?-a:Math.min(Math.max(-a,-c),a),g=-f*f+m*(m+2*c)+u):m<=A?(f=0,m=Math.min(Math.max(-a,-c),a),g=m*(m+2*c)+u):(f=Math.max(0,-(i*a+s)),m=f>0?a:Math.min(Math.max(-a,-c),a),g=-f*f+m*(m+2*c)+u);else m=i>0?-a:a,f=Math.max(0,-(i*m+s)),g=-f*f+m*(m+2*c)+u;return n&&n.copy(this.direction).multiplyScalar(f).add(this.origin),r&&r.copy(Om).multiplyScalar(m).add(pA),g}intersectSphere(e,t){Wi.subVectors(e.center,this.origin);const n=Wi.dot(this.direction),r=Wi.dot(Wi)-n*n,a=e.radius*e.radius;if(r>a)return null;const i=Math.sqrt(a-r),s=n-i,c=n+i;return s<0&&c<0?null:s<0?this.at(c,t):this.at(s,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(t===0)return e.distanceToPoint(this.origin)===0?0:null;const n=-(this.origin.dot(e.normal)+e.constant)/t;return n>=0?n:null}intersectPlane(e,t){const n=this.distanceToPlane(e);return n===null?null:this.at(n,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin);return t===0?!0:e.normal.dot(this.direction)*t<0}intersectBox(e,t){let n,r,a,i,s,c;const u=1/this.direction.x,h=1/this.direction.y,f=1/this.direction.z,m=this.origin;return u>=0?(n=(e.min.x-m.x)*u,r=(e.max.x-m.x)*u):(n=(e.max.x-m.x)*u,r=(e.min.x-m.x)*u),h>=0?(a=(e.min.y-m.y)*h,i=(e.max.y-m.y)*h):(a=(e.max.y-m.y)*h,i=(e.min.y-m.y)*h),n>i||a>r?null:((a>n||isNaN(n))&&(n=a),(i<r||isNaN(r))&&(r=i),f>=0?(s=(e.min.z-m.z)*f,c=(e.max.z-m.z)*f):(s=(e.max.z-m.z)*f,c=(e.min.z-m.z)*f),n>c||s>r?null:((s>n||n!=n)&&(n=s),(c<r||r!=r)&&(r=c),r<0?null:this.at(n>=0?n:r,t)))}intersectsBox(e){return this.intersectBox(e,Wi)!==null}intersectTriangle(e,t,n,r,a){mA.subVectors(t,e),Fm.subVectors(n,e),gA.crossVectors(mA,Fm);let i,s=this.direction.dot(gA);if(s>0){if(r)return null;i=1}else{if(!(s<0))return null;i=-1,s=-s}ks.subVectors(this.origin,e);const c=i*this.direction.dot(Fm.crossVectors(ks,Fm));if(c<0)return null;const u=i*this.direction.dot(mA.cross(ks));if(u<0||c+u>s)return null;const h=-i*ks.dot(gA);return h<0?null:this.at(h/s,a)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}class Ve{constructor(){Ve.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}set(e,t,n,r,a,i,s,c,u,h,f,m,g,A,_,x){const C=this.elements;return C[0]=e,C[4]=t,C[8]=n,C[12]=r,C[1]=a,C[5]=i,C[9]=s,C[13]=c,C[2]=u,C[6]=h,C[10]=f,C[14]=m,C[3]=g,C[7]=A,C[11]=_,C[15]=x,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new Ve().fromArray(this.elements)}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],this}copyPosition(e){const t=this.elements,n=e.elements;return t[12]=n[12],t[13]=n[13],t[14]=n[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,n){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}makeBasis(e,t,n){return this.set(e.x,t.x,n.x,0,e.y,t.y,n.y,0,e.z,t.z,n.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,n=e.elements,r=1/Yi.setFromMatrixColumn(e,0).length(),a=1/Yi.setFromMatrixColumn(e,1).length(),i=1/Yi.setFromMatrixColumn(e,2).length();return t[0]=n[0]*r,t[1]=n[1]*r,t[2]=n[2]*r,t[3]=0,t[4]=n[4]*a,t[5]=n[5]*a,t[6]=n[6]*a,t[7]=0,t[8]=n[8]*i,t[9]=n[9]*i,t[10]=n[10]*i,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){const t=this.elements,n=e.x,r=e.y,a=e.z,i=Math.cos(n),s=Math.sin(n),c=Math.cos(r),u=Math.sin(r),h=Math.cos(a),f=Math.sin(a);if(e.order==="XYZ"){const m=i*h,g=i*f,A=s*h,_=s*f;t[0]=c*h,t[4]=-c*f,t[8]=u,t[1]=g+A*u,t[5]=m-_*u,t[9]=-s*c,t[2]=_-m*u,t[6]=A+g*u,t[10]=i*c}else if(e.order==="YXZ"){const m=c*h,g=c*f,A=u*h,_=u*f;t[0]=m+_*s,t[4]=A*s-g,t[8]=i*u,t[1]=i*f,t[5]=i*h,t[9]=-s,t[2]=g*s-A,t[6]=_+m*s,t[10]=i*c}else if(e.order==="ZXY"){const m=c*h,g=c*f,A=u*h,_=u*f;t[0]=m-_*s,t[4]=-i*f,t[8]=A+g*s,t[1]=g+A*s,t[5]=i*h,t[9]=_-m*s,t[2]=-i*u,t[6]=s,t[10]=i*c}else if(e.order==="ZYX"){const m=i*h,g=i*f,A=s*h,_=s*f;t[0]=c*h,t[4]=A*u-g,t[8]=m*u+_,t[1]=c*f,t[5]=_*u+m,t[9]=g*u-A,t[2]=-u,t[6]=s*c,t[10]=i*c}else if(e.order==="YZX"){const m=i*c,g=i*u,A=s*c,_=s*u;t[0]=c*h,t[4]=_-m*f,t[8]=A*f+g,t[1]=f,t[5]=i*h,t[9]=-s*h,t[2]=-u*h,t[6]=g*f+A,t[10]=m-_*f}else if(e.order==="XZY"){const m=i*c,g=i*u,A=s*c,_=s*u;t[0]=c*h,t[4]=-f,t[8]=u*h,t[1]=m*f+_,t[5]=i*h,t[9]=g*f-A,t[2]=A*f-g,t[6]=s*h,t[10]=_*f+m}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(LQ,e,BQ)}lookAt(e,t,n){const r=this.elements;return Po.subVectors(e,t),Po.lengthSq()===0&&(Po.z=1),Po.normalize(),Gs.crossVectors(n,Po),Gs.lengthSq()===0&&(Math.abs(n.z)===1?Po.x+=1e-4:Po.z+=1e-4,Po.normalize(),Gs.crossVectors(n,Po)),Gs.normalize(),Um.crossVectors(Po,Gs),r[0]=Gs.x,r[4]=Um.x,r[8]=Po.x,r[1]=Gs.y,r[5]=Um.y,r[9]=Po.y,r[2]=Gs.z,r[6]=Um.z,r[10]=Po.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,r=t.elements,a=this.elements,i=n[0],s=n[4],c=n[8],u=n[12],h=n[1],f=n[5],m=n[9],g=n[13],A=n[2],_=n[6],x=n[10],C=n[14],b=n[3],y=n[7],M=n[11],R=n[15],T=r[0],w=r[4],D=r[8],z=r[12],F=r[1],O=r[5],q=r[9],ne=r[13],$=r[2],he=r[6],K=r[10],oe=r[14],ie=r[3],L=r[7],U=r[11],k=r[15];return a[0]=i*T+s*F+c*$+u*ie,a[4]=i*w+s*O+c*he+u*L,a[8]=i*D+s*q+c*K+u*U,a[12]=i*z+s*ne+c*oe+u*k,a[1]=h*T+f*F+m*$+g*ie,a[5]=h*w+f*O+m*he+g*L,a[9]=h*D+f*q+m*K+g*U,a[13]=h*z+f*ne+m*oe+g*k,a[2]=A*T+_*F+x*$+C*ie,a[6]=A*w+_*O+x*he+C*L,a[10]=A*D+_*q+x*K+C*U,a[14]=A*z+_*ne+x*oe+C*k,a[3]=b*T+y*F+M*$+R*ie,a[7]=b*w+y*O+M*he+R*L,a[11]=b*D+y*q+M*K+R*U,a[15]=b*z+y*ne+M*oe+R*k,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[4],r=e[8],a=e[12],i=e[1],s=e[5],c=e[9],u=e[13],h=e[2],f=e[6],m=e[10],g=e[14];return e[3]*(+a*c*f-r*u*f-a*s*m+n*u*m+r*s*g-n*c*g)+e[7]*(+t*c*g-t*u*m+a*i*m-r*i*g+r*u*h-a*c*h)+e[11]*(+t*u*f-t*s*g-a*i*f+n*i*g+a*s*h-n*u*h)+e[15]*(-r*s*h-t*c*f+t*s*m+r*i*f-n*i*m+n*c*h)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,n){const r=this.elements;return e.isVector3?(r[12]=e.x,r[13]=e.y,r[14]=e.z):(r[12]=e,r[13]=t,r[14]=n),this}invert(){const e=this.elements,t=e[0],n=e[1],r=e[2],a=e[3],i=e[4],s=e[5],c=e[6],u=e[7],h=e[8],f=e[9],m=e[10],g=e[11],A=e[12],_=e[13],x=e[14],C=e[15],b=f*x*u-_*m*u+_*c*g-s*x*g-f*c*C+s*m*C,y=A*m*u-h*x*u-A*c*g+i*x*g+h*c*C-i*m*C,M=h*_*u-A*f*u+A*s*g-i*_*g-h*s*C+i*f*C,R=A*f*c-h*_*c-A*s*m+i*_*m+h*s*x-i*f*x,T=t*b+n*y+r*M+a*R;if(T===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const w=1/T;return e[0]=b*w,e[1]=(_*m*a-f*x*a-_*r*g+n*x*g+f*r*C-n*m*C)*w,e[2]=(s*x*a-_*c*a+_*r*u-n*x*u-s*r*C+n*c*C)*w,e[3]=(f*c*a-s*m*a-f*r*u+n*m*u+s*r*g-n*c*g)*w,e[4]=y*w,e[5]=(h*x*a-A*m*a+A*r*g-t*x*g-h*r*C+t*m*C)*w,e[6]=(A*c*a-i*x*a-A*r*u+t*x*u+i*r*C-t*c*C)*w,e[7]=(i*m*a-h*c*a+h*r*u-t*m*u-i*r*g+t*c*g)*w,e[8]=M*w,e[9]=(A*f*a-h*_*a-A*n*g+t*_*g+h*n*C-t*f*C)*w,e[10]=(i*_*a-A*s*a+A*n*u-t*_*u-i*n*C+t*s*C)*w,e[11]=(h*s*a-i*f*a-h*n*u+t*f*u+i*n*g-t*s*g)*w,e[12]=R*w,e[13]=(h*_*r-A*f*r+A*n*m-t*_*m-h*n*x+t*f*x)*w,e[14]=(A*s*r-i*_*r-A*n*c+t*_*c+i*n*x-t*s*x)*w,e[15]=(i*f*r-h*s*r+h*n*c-t*f*c-i*n*m+t*s*m)*w,this}scale(e){const t=this.elements,n=e.x,r=e.y,a=e.z;return t[0]*=n,t[4]*=r,t[8]*=a,t[1]*=n,t[5]*=r,t[9]*=a,t[2]*=n,t[6]*=r,t[10]*=a,t[3]*=n,t[7]*=r,t[11]*=a,this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],r=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,n,r))}makeTranslation(e,t,n){return this.set(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),n=Math.sin(e);return this.set(1,0,0,0,0,t,-n,0,0,n,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,0,n,0,0,1,0,0,-n,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,0,n,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const n=Math.cos(t),r=Math.sin(t),a=1-n,i=e.x,s=e.y,c=e.z,u=a*i,h=a*s;return this.set(u*i+n,u*s-r*c,u*c+r*s,0,u*s+r*c,h*s+n,h*c-r*i,0,u*c-r*s,h*c+r*i,a*c*c+n,0,0,0,0,1),this}makeScale(e,t,n){return this.set(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1),this}makeShear(e,t,n,r,a,i){return this.set(1,n,a,0,e,1,i,0,t,r,1,0,0,0,0,1),this}compose(e,t,n){const r=this.elements,a=t._x,i=t._y,s=t._z,c=t._w,u=a+a,h=i+i,f=s+s,m=a*u,g=a*h,A=a*f,_=i*h,x=i*f,C=s*f,b=c*u,y=c*h,M=c*f,R=n.x,T=n.y,w=n.z;return r[0]=(1-(_+C))*R,r[1]=(g+M)*R,r[2]=(A-y)*R,r[3]=0,r[4]=(g-M)*T,r[5]=(1-(m+C))*T,r[6]=(x+b)*T,r[7]=0,r[8]=(A+y)*w,r[9]=(x-b)*w,r[10]=(1-(m+_))*w,r[11]=0,r[12]=e.x,r[13]=e.y,r[14]=e.z,r[15]=1,this}decompose(e,t,n){const r=this.elements;let a=Yi.set(r[0],r[1],r[2]).length();const i=Yi.set(r[4],r[5],r[6]).length(),s=Yi.set(r[8],r[9],r[10]).length();this.determinant()<0&&(a=-a),e.x=r[12],e.y=r[13],e.z=r[14],Gn.copy(this);const c=1/a,u=1/i,h=1/s;return Gn.elements[0]*=c,Gn.elements[1]*=c,Gn.elements[2]*=c,Gn.elements[4]*=u,Gn.elements[5]*=u,Gn.elements[6]*=u,Gn.elements[8]*=h,Gn.elements[9]*=h,Gn.elements[10]*=h,t.setFromRotationMatrix(Gn),n.x=a,n.y=i,n.z=s,this}makePerspective(e,t,n,r,a,i){const s=this.elements,c=2*a/(t-e),u=2*a/(n-r),h=(t+e)/(t-e),f=(n+r)/(n-r),m=-(i+a)/(i-a),g=-2*i*a/(i-a);return s[0]=c,s[4]=0,s[8]=h,s[12]=0,s[1]=0,s[5]=u,s[9]=f,s[13]=0,s[2]=0,s[6]=0,s[10]=m,s[14]=g,s[3]=0,s[7]=0,s[11]=-1,s[15]=0,this}makeOrthographic(e,t,n,r,a,i){const s=this.elements,c=1/(t-e),u=1/(n-r),h=1/(i-a),f=(t+e)*c,m=(n+r)*u,g=(i+a)*h;return s[0]=2*c,s[4]=0,s[8]=0,s[12]=-f,s[1]=0,s[5]=2*u,s[9]=0,s[13]=-m,s[2]=0,s[6]=0,s[10]=-2*h,s[14]=-g,s[3]=0,s[7]=0,s[11]=0,s[15]=1,this}equals(e){const t=this.elements,n=e.elements;for(let r=0;r<16;r++)if(t[r]!==n[r])return!1;return!0}fromArray(e,t=0){for(let n=0;n<16;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e[t+9]=n[9],e[t+10]=n[10],e[t+11]=n[11],e[t+12]=n[12],e[t+13]=n[13],e[t+14]=n[14],e[t+15]=n[15],e}composeE(e,t,n){const r=this.elements;this.makeRotationFromEuler(t);const a=n.x,i=n.y,s=n.z;return r[0]*=a,r[1]*=a,r[2]*=a,r[3]=0,r[4]*=i,r[5]*=i,r[6]*=i,r[7]=0,r[8]*=s,r[9]*=s,r[10]*=s,r[11]=0,r[12]=e.x,r[13]=e.y,r[14]=e.z,r[15]=1,this}decomposeE(e,t,n,r=t.order){const a=this.elements;let i=Yi.set(a[0],a[1],a[2]).length();const s=Yi.set(a[4],a[5],a[6]).length(),c=Yi.set(a[8],a[9],a[10]).length();this.determinant()<0&&(i=-i),e.x=a[12],e.y=a[13],e.z=a[14],Gn.copy(this);const u=1/i,h=1/s,f=1/c;return Gn.elements[0]*=u,Gn.elements[1]*=u,Gn.elements[2]*=u,Gn.elements[4]*=h,Gn.elements[5]*=h,Gn.elements[6]*=h,Gn.elements[8]*=f,Gn.elements[9]*=f,Gn.elements[10]*=f,t.setFromRotationMatrix(Gn,r),n.x=i,n.y=s,n.z=c,this}}const Yi=new B,Gn=new Ve,LQ=new B(0,0,0),BQ=new B(1,1,1),Gs=new B,Um=new B,Po=new B,aM=new Ve,iM=new Ct;class ka{constructor(e=0,t=0,n=0,r=ka.DefaultOrder){this.isEuler=!0,this._x=e,this._y=t,this._z=n,this._order=r}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,n,r=this._order){return this._x=e,this._y=t,this._z=n,this._order=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,n=!0){const r=e.elements,a=r[0],i=r[4],s=r[8],c=r[1],u=r[5],h=r[9],f=r[2],m=r[6],g=r[10];switch(t){case"XYZ":this._y=Math.asin(Ft(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(-h,g),this._z=Math.atan2(-i,a)):(this._x=Math.atan2(m,u),this._z=0);break;case"YXZ":this._x=Math.asin(-Ft(h,-1,1)),Math.abs(h)<.9999999?(this._y=Math.atan2(s,g),this._z=Math.atan2(c,u)):(this._y=Math.atan2(-f,a),this._z=0);break;case"ZXY":this._x=Math.asin(Ft(m,-1,1)),Math.abs(m)<.9999999?(this._y=Math.atan2(-f,g),this._z=Math.atan2(-i,u)):(this._y=0,this._z=Math.atan2(c,a));break;case"ZYX":this._y=Math.asin(-Ft(f,-1,1)),Math.abs(f)<.9999999?(this._x=Math.atan2(m,g),this._z=Math.atan2(c,a)):(this._x=0,this._z=Math.atan2(-i,u));break;case"YZX":this._z=Math.asin(Ft(c,-1,1)),Math.abs(c)<.9999999?(this._x=Math.atan2(-h,u),this._y=Math.atan2(-f,a)):(this._x=0,this._y=Math.atan2(s,g));break;case"XZY":this._z=Math.asin(-Ft(i,-1,1)),Math.abs(i)<.9999999?(this._x=Math.atan2(m,u),this._y=Math.atan2(s,a)):(this._x=Math.atan2(-h,g),this._y=0);break;default:console.warn("v3d.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,n===!0&&this._onChangeCallback(),this}setFromQuaternion(e,t,n){return aM.makeRotationFromQuaternion(e),this.setFromRotationMatrix(aM,t,n)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return iM.setFromEuler(this),this.setFromQuaternion(iM,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}toVector3(e){return console.warn("v3d.Euler: .toVector3() has been removed. Use Vector3.setFromEuler() instead"),e?e.set(this._x,this._y,this._z):new B(this._x,this._y,this._z)}makeAlternative(){var e=this._order[1]==="X"?-1:1,t=this._order[1]==="Y"?-1:1,n=this._order[1]==="Z"?-1:1;return this._x=cg(e*(this._x+Math.PI)),this._y=cg(t*(this._y+Math.PI)),this._z=cg(n*(this._z+Math.PI)),this}equalsEps(e,t){return Math.abs(this._x-e._x)<t&&Math.abs(this._y-e._y)<t&&Math.abs(this._z-e._z)<t&&this._order===e._order}}ka.DefaultOrder="XYZ",ka.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];class Rd{constructor(){this.mask=1}set(e){this.mask=1<<e>>>0}enable(e){this.mask|=1<<e}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e}disable(e){this.mask&=~(1<<e)}disableAll(){this.mask=0}test(e){return!!(this.mask&e.mask)}isEnabled(e){return!!(this.mask&1<<e)}}let PQ=0;const sM=new B,Au=new Ct,No=new Ve,Qs=new B,ji=new B,lM=new B,NQ=new Ct,cM=new B(1,0,0),uM=new B(0,1,0),dM=new B(0,0,1),DQ={type:"added"},fM={type:"removed"};class Tt extends oo{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:PQ++}),this.uuid=Wo(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Tt.DefaultUp.clone();const e=new B,t=new ka,n=new Ct,r=new B(1,1,1);t._onChange(function(){n.setFromEuler(t,!1)}),n._onChange(function(){t.setFromQuaternion(n,void 0,!1)}),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:r},modelViewMatrix:{value:new Ve},normalMatrix:{value:new Qr}}),this.matrix=new Ve,this.matrixWorld=new Ve,this.matrixAutoUpdate=Tt.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.matrixWorldAutoUpdate=Tt.DefaultMatrixWorldAutoUpdate,this.layers=new Rd,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={},this.internVisible=!0,this.externVisible=!0,this.constraints=[],this.disableChildRendering=!1,this.hidpiCompositing=!1,this.groupNames=[],this.objectIndex=0,this.objectColor=new Qe,this.objectAlpha=1}set visible(e){this.externVisible=e}get visible(){return this.internVisible&&this.externVisible}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return Au.setFromAxisAngle(e,t),this.quaternion.multiply(Au),this}rotateOnWorldAxis(e,t){return Au.setFromAxisAngle(e,t),this.quaternion.premultiply(Au),this}rotateX(e){return this.rotateOnAxis(cM,e)}rotateY(e){return this.rotateOnAxis(uM,e)}rotateZ(e){return this.rotateOnAxis(dM,e)}translateOnAxis(e,t){return sM.copy(e).applyQuaternion(this.quaternion),this.position.add(sM.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(cM,e)}translateY(e){return this.translateOnAxis(uM,e)}translateZ(e){return this.translateOnAxis(dM,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(No.copy(this.matrixWorld).invert())}lookAt(e,t,n){e.isVector3?Qs.copy(e):Qs.set(e,t,n);const r=this.parent;this.updateWorldMatrix(!0,!1),ji.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?No.lookAt(ji,Qs,this.up):No.lookAt(Qs,ji,this.up),this.quaternion.setFromRotationMatrix(No),r&&(No.extractRotation(r.matrixWorld),Au.setFromRotationMatrix(No),this.quaternion.premultiply(Au.invert()))}add(e){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(console.error("v3d.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.parent!==null&&e.parent.remove(e),e.parent=this,this.children.push(e),e.dispatchEvent(DQ)):console.error("v3d.Object3D.add: object not an instance of v3d.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let n=0;n<arguments.length;n++)this.remove(arguments[n]);return this}const t=this.children.indexOf(e);return t!==-1&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(fM)),this}removeFromParent(){const e=this.parent;return e!==null&&e.remove(this),this}clear(){for(let e=0;e<this.children.length;e++){const t=this.children[e];t.parent=null,t.dispatchEvent(fM)}return this.children.length=0,this}attach(e){return this.updateWorldMatrix(!0,!1),No.copy(this.matrixWorld).invert(),e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),No.multiply(e.parent.matrixWorld)),e.applyMatrix4(No),this.add(e),e.updateWorldMatrix(!1,!0),this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let n=0,r=this.children.length;n<r;n++){const a=this.children[n].getObjectByProperty(e,t);if(a!==void 0)return a}}getObjectsByProperty(e,t){let n=[];this[e]===t&&n.push(this);for(let r=0,a=this.children.length;r<a;r++){const i=this.children[r].getObjectsByProperty(e,t);i.length>0&&(n=n.concat(i))}return n}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(ji,e,lM),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(ji,NQ,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[4],t[5],t[6]).normalize()}raycast(){}traverse(e){e(this);const t=this.children;for(let n=0,r=t.length;n<r;n++)t[n].traverse(e)}traverseVisible(e){if(this.visible===!1)return;e(this);const t=this.children;for(let n=0,r=t.length;n<r;n++)t[n].traverseVisible(e)}traverseAncestors(e){const t=this.parent;t!==null&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.updateConstraints(),this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let n=0,r=t.length;n<r;n++){const a=t[n];a.matrixWorldAutoUpdate!==!0&&e!==!0||a.updateMatrixWorld(e)}}updateWorldMatrix(e,t){const n=this.parent;if(e===!0&&n!==null&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),t===!0){const r=this.children;for(let a=0,i=r.length;a<i;a++)r[a].updateWorldMatrix(!1,!0)}}clone(e){return new this.constructor().copy(this,e)}copy(e,t=!0){this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.disableChildRendering=e.disableChildRendering,this.hidpiCompositing=e.hidpiCompositing,this.objectIndex=e.objectIndex,this.objectColor.copy(e.objectColor),this.objectAlpha=e.objectAlpha,this.constraints=[];for(let n=0;n<e.constraints.length;n++)this.constraints.push(e.constraints[n].clone());if(this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.userData=JSON.parse(JSON.stringify(e.userData)),t===!0)for(let n=0;n<e.children.length;n++){const r=e.children[n];this.add(r.clone())}return this}copyTransform(e){this.matrix.copy(e.matrixWorld),this.parent&&this.matrix.multiplyMatrices(No.copy(this.parent.matrixWorld).invert(),this.matrix),this.matrix.decompose(this.position,this.quaternion,this.scale)}isVisible(){return this.visible}updateConstraints(){for(let e=0;e<this.constraints.length;e++)this.constraints[e].update(this)}getWorldPositionNU(e){return e.setFromMatrixPosition(this.matrixWorld)}getLocalDirection(e){const t=this.matrix.elements;return this.isCamera||this.isLight?e.set(-t[8],-t[9],-t[10]).normalize():e.set(t[8],t[9],t[10]).normalize()}lookAtLocal(e,t,n){e.isVector3?Qs.copy(e):Qs.set(e,t,n),ji.setFromMatrixPosition(this.matrix),this.isCamera||this.isLight?No.lookAt(ji,Qs,this.up):No.lookAt(Qs,ji,this.up),this.quaternion.setFromRotationMatrix(No)}findRoot(){let e=this;return this.traverseAncestors(function(t){e=t}),e}resolveMultiMaterial(){const e=[];for(let t=0;t<this.children.length;t++){const n=this.children[t];n.isMesh&&n.isMaterialGeneratedMesh&&e.push(n)}return e.length||e.push(this),e}getAuxClippingMeshes(){const e=[];for(let t=0;t<this.children.length;t++){const n=this.children[t];n.isMesh&&n.isAuxClippingMesh&&e.push(n)}return e}getWorldEuler(e,t=e._order){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decomposeE(ji,e,lM,t),e}}Tt.DefaultUp=new B(0,1,0),Tt.DefaultMatrixAutoUpdate=!0,Tt.DefaultMatrixWorldAutoUpdate=!0;const Ea=new B,Xi=new B,vA=new B,qi=new B,xu=new B,yu=new B,hM=new B,_A=new B,AA=new B,xA=new B,yA=new ct,bA=new ct,SA=new ct;class Cr{constructor(e=new B,t=new B,n=new B){this.a=e,this.b=t,this.c=n}static getNormal(e,t,n,r){r.subVectors(n,t),Ea.subVectors(e,t),r.cross(Ea);const a=r.lengthSq();return a>0?r.multiplyScalar(1/Math.sqrt(a)):r.set(0,0,0)}static getBarycoord(e,t,n,r,a){Ea.subVectors(r,t),Xi.subVectors(n,t),vA.subVectors(e,t);const i=Ea.dot(Ea),s=Ea.dot(Xi),c=Ea.dot(vA),u=Xi.dot(Xi),h=Xi.dot(vA),f=i*u-s*s;if(f===0)return a.set(0,0,0),null;const m=1/f,g=(u*c-s*h)*m,A=(i*h-s*c)*m;return a.set(1-g-A,A,g)}static containsPoint(e,t,n,r){return this.getBarycoord(e,t,n,r,qi)!==null&&qi.x>=0&&qi.y>=0&&qi.x+qi.y<=1}static getInterpolation(e,t,n,r,a,i,s,c){return this.getBarycoord(e,t,n,r,qi)===null?(c.x=0,c.y=0,"z"in c&&(c.z=0),"w"in c&&(c.w=0),null):(c.setScalar(0),c.addScaledVector(a,qi.x),c.addScaledVector(i,qi.y),c.addScaledVector(s,qi.z),c)}static getInterpolatedAttribute(e,t,n,r,a,i){return yA.setScalar(0),bA.setScalar(0),SA.setScalar(0),yA.fromBufferAttribute(e,t),bA.fromBufferAttribute(e,n),SA.fromBufferAttribute(e,r),i.setScalar(0),i.addScaledVector(yA,a.x),i.addScaledVector(bA,a.y),i.addScaledVector(SA,a.z),i}static isFrontFacing(e,t,n,r){return Ea.subVectors(n,t),Xi.subVectors(e,t),Ea.cross(Xi).dot(r)<0}set(e,t,n){return this.a.copy(e),this.b.copy(t),this.c.copy(n),this}setFromPointsAndIndices(e,t,n,r){return this.a.copy(e[t]),this.b.copy(e[n]),this.c.copy(e[r]),this}setFromAttributeAndIndices(e,t,n,r){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,n),this.c.fromBufferAttribute(e,r),this}clone(){return new this.constructor().copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return Ea.subVectors(this.c,this.b),Xi.subVectors(this.a,this.b),.5*Ea.cross(Xi).length()}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return Cr.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return Cr.getBarycoord(e,this.a,this.b,this.c,t)}getInterpolation(e,t,n,r,a){return Cr.getInterpolation(e,this.a,this.b,this.c,t,n,r,a)}containsPoint(e){return Cr.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return Cr.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){const n=this.a,r=this.b,a=this.c;let i,s;xu.subVectors(r,n),yu.subVectors(a,n),_A.subVectors(e,n);const c=xu.dot(_A),u=yu.dot(_A);if(c<=0&&u<=0)return t.copy(n);AA.subVectors(e,r);const h=xu.dot(AA),f=yu.dot(AA);if(h>=0&&f<=h)return t.copy(r);const m=c*f-h*u;if(m<=0&&c>=0&&h<=0)return i=c/(c-h),t.copy(n).addScaledVector(xu,i);xA.subVectors(e,a);const g=xu.dot(xA),A=yu.dot(xA);if(A>=0&&g<=A)return t.copy(a);const _=g*u-c*A;if(_<=0&&u>=0&&A<=0)return s=u/(u-A),t.copy(n).addScaledVector(yu,s);const x=h*A-g*f;if(x<=0&&f-h>=0&&g-A>=0)return hM.subVectors(a,r),s=(f-h)/(f-h+(g-A)),t.copy(r).addScaledVector(hM,s);const C=1/(x+_+m);return i=_*C,s=m*C,t.copy(n).addScaledVector(xu,i).addScaledVector(yu,s)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}let OQ=0;class Er extends oo{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:OQ++}),this.uuid=Wo(),this.name="",this.type="Material",this.blending=1,this.side=0,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=204,this.blendDst=205,this.blendEquation=100,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=3,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=519,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=7680,this.stencilZFail=7680,this.stencilZPass=7680,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0,this.depthPrepass=!1,this.receiveShadow=!1,this.castShadow=!1,this.profile="",this.defines={},this.definesFragOnly=new Set,this.DefaultEnvMapAutoAssign=!0,this.envMapAutoAssign=this.DefaultEnvMapAutoAssign,this.gtaoVisible=!0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(e!==void 0)for(const t in e){const n=e[t];if(n===void 0){console.warn("v3d.Material: '"+t+"' parameter is undefined.");continue}const r=this[t];r!==void 0?r&&r.isColor?r.set(n):r&&r.isVector3&&n&&n.isVector3?r.copy(n):this[t]=n:console.warn("v3d."+this.type+": '"+t+"' is not a property of this material.")}}clone(){return new this.constructor().copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let n=null;if(t!==null){const r=t.length;n=new Array(r);for(let a=0;a!==r;++a)n[a]=t[a].clone()}return this.clippingPlanes=n,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this.depthPrepass=e.depthPrepass,this.defines=Object.assign({},e.defines),this.definesFragOnly=new Set(e.definesFragOnly),this.receiveShadow=e.receiveShadow,this.castShadow=e.castShadow,this.profile=e.profile,this.envMapAutoAssign=e.envMapAutoAssign,this.gtaoVisible=e.gtaoVisible,this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){e===!0&&this.version++}get needsUpdate(){return this.version!=0}}class hr extends Er{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new Qe(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this}}const or=new B,zm=new Ee;class $e{constructor(e,t,n=!1){if(Array.isArray(e))throw new TypeError("v3d.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=e,this.itemSize=t,this.count=e!==void 0?e.length/t:0,this.normalized=n,this.usage=35044,this.updateRange={offset:0,count:-1},this.version=0}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this}copyAt(e,t,n){e*=this.itemSize,n*=t.itemSize;for(let r=0,a=this.itemSize;r<a;r++)this.array[e+r]=t.array[n+r];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(this.itemSize===2)for(let t=0,n=this.count;t<n;t++)zm.fromBufferAttribute(this,t),zm.applyMatrix3(e),this.setXY(t,zm.x,zm.y);else if(this.itemSize===3)for(let t=0,n=this.count;t<n;t++)or.fromBufferAttribute(this,t),or.applyMatrix3(e),this.setXYZ(t,or.x,or.y,or.z);return this}applyMatrix4(e){for(let t=0,n=this.count;t<n;t++)or.fromBufferAttribute(this,t),or.applyMatrix4(e),this.setXYZ(t,or.x,or.y,or.z);return this}applyNormalMatrix(e){for(let t=0,n=this.count;t<n;t++)or.fromBufferAttribute(this,t),or.applyNormalMatrix(e),this.setXYZ(t,or.x,or.y,or.z);return this}transformDirection(e){for(let t=0,n=this.count;t<n;t++)or.fromBufferAttribute(this,t),or.transformDirection(e),this.setXYZ(t,or.x,or.y,or.z);return this}set(e,t=0){return this.array.set(e,t),this}getX(e){let t=this.array[e*this.itemSize];return this.normalized&&(t=is(t,this.array)),t}setX(e,t){return this.normalized&&(t=cn(t,this.array)),this.array[e*this.itemSize]=t,this}getY(e){let t=this.array[e*this.itemSize+1];return this.normalized&&(t=is(t,this.array)),t}setY(e,t){return this.normalized&&(t=cn(t,this.array)),this.array[e*this.itemSize+1]=t,this}getZ(e){let t=this.array[e*this.itemSize+2];return this.normalized&&(t=is(t,this.array)),t}setZ(e,t){return this.normalized&&(t=cn(t,this.array)),this.array[e*this.itemSize+2]=t,this}getW(e){let t=this.array[e*this.itemSize+3];return this.normalized&&(t=is(t,this.array)),t}setW(e,t){return this.normalized&&(t=cn(t,this.array)),this.array[e*this.itemSize+3]=t,this}setXY(e,t,n){return e*=this.itemSize,this.normalized&&(t=cn(t,this.array),n=cn(n,this.array)),this.array[e+0]=t,this.array[e+1]=n,this}setXYZ(e,t,n,r){return e*=this.itemSize,this.normalized&&(t=cn(t,this.array),n=cn(n,this.array),r=cn(r,this.array)),this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=r,this}setXYZW(e,t,n,r,a){return e*=this.itemSize,this.normalized&&(t=cn(t,this.array),n=cn(n,this.array),r=cn(r,this.array),a=cn(a,this.array)),this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=r,this.array[e+3]=a,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}}class FQ extends $e{constructor(e,t,n){super(new Int8Array(e),t,n)}}class UQ extends $e{constructor(e,t,n){super(new Uint8Array(e),t,n)}}class zQ extends $e{constructor(e,t,n){super(new Uint8ClampedArray(e),t,n)}}class VQ extends $e{constructor(e,t,n){super(new Int16Array(e),t,n)}}class A5 extends $e{constructor(e,t,n){super(new Uint16Array(e),t,n)}}class kQ extends $e{constructor(e,t,n){super(new Int32Array(e),t,n)}}class x5 extends $e{constructor(e,t,n){super(new Uint32Array(e),t,n)}}class GQ extends $e{constructor(e,t,n){super(new Uint16Array(e),t,n),this.isFloat16BufferAttribute=!0}}class ut extends $e{constructor(e,t,n){super(new Float32Array(e),t,n)}}class QQ extends $e{constructor(e,t,n){super(new Float64Array(e),t,n)}}let HQ=0;const oa=new Ve,CA=new Tt,bu=new B,Do=new mn,Nf=new mn,yr=new B;class mt extends oo{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:HQ++}),this.uuid=Wo(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.boundsTree=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new $e(new(f5(e)?Uint32Array:Uint16Array)(e),1):this.index=e,this}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return this.attributes[e]!==void 0}addGroup(e,t,n=0){this.groups.push({start:e,count:t,materialIndex:n})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){const t=this.attributes.position;t!==void 0&&(t.applyMatrix4(e),t.needsUpdate=!0);const n=this.attributes.normal;if(n!==void 0){const a=new Qr().getNormalMatrix(e);n.applyNormalMatrix(a),n.needsUpdate=!0}const r=this.attributes.tangent;return r!==void 0&&(r.transformDirection(e),r.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(e){return oa.makeRotationFromQuaternion(e),this.applyMatrix4(oa),this}rotateX(e){return oa.makeRotationX(e),this.applyMatrix4(oa),this}rotateY(e){return oa.makeRotationY(e),this.applyMatrix4(oa),this}rotateZ(e){return oa.makeRotationZ(e),this.applyMatrix4(oa),this}translate(e,t,n){return oa.makeTranslation(e,t,n),this.applyMatrix4(oa),this}scale(e,t,n){return oa.makeScale(e,t,n),this.applyMatrix4(oa),this}lookAt(e){return CA.lookAt(e),CA.updateMatrix(),this.applyMatrix4(CA.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(bu).negate(),this.translate(bu.x,bu.y,bu.z),this}setFromPoints(e){const t=[];for(let n=0,r=e.length;n<r;n++){const a=e[n];t.push(a.x,a.y,a.z||0)}return this.setAttribute("position",new ut(t,3)),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new mn);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error('v3d.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingBox.set(new B(-1/0,-1/0,-1/0),new B(1/0,1/0,1/0));if(e!==void 0){if(this.boundingBox.setFromBufferAttribute(e),t)for(let n=0,r=t.length;n<r;n++){const a=t[n];Do.setFromBufferAttribute(a),this.morphTargetsRelative?(yr.addVectors(this.boundingBox.min,Do.min),this.boundingBox.expandByPoint(yr),yr.addVectors(this.boundingBox.max,Do.max),this.boundingBox.expandByPoint(yr)):(this.boundingBox.expandByPoint(Do.min),this.boundingBox.expandByPoint(Do.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('v3d.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Yo);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error('v3d.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingSphere.set(new B,1/0);if(e){const n=this.boundingSphere.center;if(Do.setFromBufferAttribute(e),t)for(let a=0,i=t.length;a<i;a++){const s=t[a];Nf.setFromBufferAttribute(s),this.morphTargetsRelative?(yr.addVectors(Do.min,Nf.min),Do.expandByPoint(yr),yr.addVectors(Do.max,Nf.max),Do.expandByPoint(yr)):(Do.expandByPoint(Nf.min),Do.expandByPoint(Nf.max))}Do.getCenter(n);let r=0;for(let a=0,i=e.count;a<i;a++)yr.fromBufferAttribute(e,a),r=Math.max(r,n.distanceToSquared(yr));if(t)for(let a=0,i=t.length;a<i;a++){const s=t[a],c=this.morphTargetsRelative;for(let u=0,h=s.count;u<h;u++)yr.fromBufferAttribute(s,u),c&&(bu.fromBufferAttribute(e,u),yr.add(bu)),r=Math.max(r,n.distanceToSquared(yr))}this.boundingSphere.radius=Math.sqrt(r),isNaN(this.boundingSphere.radius)&&console.error('v3d.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,t=this.attributes;if(e===null||t.position===void 0||t.normal===void 0||t.uv===void 0)return void console.error("v3d.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");const n=e.array,r=t.position.array,a=t.normal.array,i=t.uv.array,s=r.length/3;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new $e(new Float32Array(4*s),4));const c=this.getAttribute("tangent").array,u=[],h=[];for(let F=0;F<s;F++)u[F]=new B,h[F]=new B;const f=new B,m=new B,g=new B,A=new Ee,_=new Ee,x=new Ee,C=new B,b=new B;function y(F,O,q){f.fromArray(r,3*F),m.fromArray(r,3*O),g.fromArray(r,3*q),A.fromArray(i,2*F),_.fromArray(i,2*O),x.fromArray(i,2*q),m.sub(f),g.sub(f),_.sub(A),x.sub(A);const ne=1/(_.x*x.y-x.x*_.y);isFinite(ne)&&(C.copy(m).multiplyScalar(x.y).addScaledVector(g,-_.y).multiplyScalar(ne),b.copy(g).multiplyScalar(_.x).addScaledVector(m,-x.x).multiplyScalar(ne),u[F].add(C),u[O].add(C),u[q].add(C),h[F].add(b),h[O].add(b),h[q].add(b))}let M=this.groups;M.length===0&&(M=[{start:0,count:n.length}]);for(let F=0,O=M.length;F<O;++F){const q=M[F],ne=q.start;for(let $=ne,he=ne+q.count;$<he;$+=3)y(n[$+0],n[$+1],n[$+2])}const R=new B,T=new B,w=new B,D=new B;function z(F){w.fromArray(a,3*F),D.copy(w);const O=u[F];R.copy(O),R.sub(w.multiplyScalar(w.dot(O))).normalize(),T.crossVectors(D,O);const q=T.dot(h[F])<0?-1:1;c[4*F]=R.x,c[4*F+1]=R.y,c[4*F+2]=R.z,c[4*F+3]=q}for(let F=0,O=M.length;F<O;++F){const q=M[F],ne=q.start;for(let $=ne,he=ne+q.count;$<he;$+=3)z(n[$+0]),z(n[$+1]),z(n[$+2])}}computeVertexNormals(){const e=this.index,t=this.getAttribute("position");if(t!==void 0){let n=this.getAttribute("normal");if(n===void 0)n=new $e(new Float32Array(3*t.count),3),this.setAttribute("normal",n);else for(let m=0,g=n.count;m<g;m++)n.setXYZ(m,0,0,0);const r=new B,a=new B,i=new B,s=new B,c=new B,u=new B,h=new B,f=new B;if(e)for(let m=0,g=e.count;m<g;m+=3){const A=e.getX(m+0),_=e.getX(m+1),x=e.getX(m+2);r.fromBufferAttribute(t,A),a.fromBufferAttribute(t,_),i.fromBufferAttribute(t,x),h.subVectors(i,a),f.subVectors(r,a),h.cross(f),s.fromBufferAttribute(n,A),c.fromBufferAttribute(n,_),u.fromBufferAttribute(n,x),s.add(h),c.add(h),u.add(h),n.setXYZ(A,s.x,s.y,s.z),n.setXYZ(_,c.x,c.y,c.z),n.setXYZ(x,u.x,u.y,u.z)}else for(let m=0,g=t.count;m<g;m+=3)r.fromBufferAttribute(t,m+0),a.fromBufferAttribute(t,m+1),i.fromBufferAttribute(t,m+2),h.subVectors(i,a),f.subVectors(r,a),h.cross(f),n.setXYZ(m+0,h.x,h.y,h.z),n.setXYZ(m+1,h.x,h.y,h.z),n.setXYZ(m+2,h.x,h.y,h.z);this.normalizeNormals(),n.needsUpdate=!0}}merge(){return console.error("v3d.BufferGeometry.merge() has been removed. Use v3d.BufferGeometryUtils.mergeBufferGeometries() instead."),this}normalizeNormals(){const e=this.attributes.normal;for(let t=0,n=e.count;t<n;t++)yr.fromBufferAttribute(e,t),yr.normalize(),e.setXYZ(t,yr.x,yr.y,yr.z)}toNonIndexed(){function e(s,c){const u=s.array,h=s.itemSize,f=s.normalized,m=new u.constructor(c.length*h);let g=0,A=0;for(let _=0,x=c.length;_<x;_++){g=s.isInterleavedBufferAttribute?c[_]*s.data.stride+s.offset:c[_]*h;for(let C=0;C<h;C++)m[A++]=u[g++]}return new $e(m,h,f)}if(this.index===null)return console.warn("v3d.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const t=new mt,n=this.index.array,r=this.attributes;for(const s in r){const c=e(r[s],n);t.setAttribute(s,c)}const a=this.morphAttributes;for(const s in a){const c=[],u=a[s];for(let h=0,f=u.length;h<f;h++){const m=e(u[h],n);c.push(m)}t.morphAttributes[s]=c}t.morphTargetsRelative=this.morphTargetsRelative;const i=this.groups;for(let s=0,c=i.length;s<c;s++){const u=i[s];t.addGroup(u.start,u.count,u.materialIndex)}return t}clone(){return new this.constructor().copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const n=e.index;n!==null&&this.setIndex(n.clone(t));const r=e.attributes;for(const u in r){const h=r[u];this.setAttribute(u,h.clone(t))}const a=e.morphAttributes;for(const u in a){const h=[],f=a[u];for(let m=0,g=f.length;m<g;m++)h.push(f[m].clone(t));this.morphAttributes[u]=h}this.morphTargetsRelative=e.morphTargetsRelative;const i=e.groups;for(let u=0,h=i.length;u<h;u++){const f=i[u];this.addGroup(f.start,f.count,f.materialIndex)}const s=e.boundingBox;s!==null&&(this.boundingBox=s.clone());const c=e.boundingSphere;return c!==null&&(this.boundingSphere=c.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,e.parameters!==void 0&&(this.parameters=Object.assign({},e.parameters)),this}dispose(){this.dispatchEvent({type:"dispose"})}}const pM=new Ve,Su=new Td,EA=new Yo,Hs=new B,Ws=new B,Ys=new B,ad=new B,MA=new B,wA=new B,rl=new B,Vm=new B,km=new B,Gm=new Ee,Qm=new Ee,Hm=new Ee,TA=new B,Wm=new B;class Mt extends Tt{constructor(e=new mt,t=new hr){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=t,this.updateMorphTargets(),this.isMaterialGeneratedMesh=!1,this.isAuxClippingMesh=!1}copy(e,t){return super.copy(e,t),e.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),e.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=e.material,this.geometry=e.geometry,this.isMaterialGeneratedMesh=e.isMaterialGeneratedMesh,this}updateMorphTargets(){const e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){const n=e[t[0]];if(n!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let r=0,a=n.length;r<a;r++){const i=n[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[i]=r}}}}getVertexPosition(e,t){const n=this.geometry,r=n.attributes.position,a=n.morphAttributes.position,i=n.morphTargetsRelative;t.fromBufferAttribute(r,e);const s=this.morphTargetInfluences;if(a&&s){rl.set(0,0,0);for(let c=0,u=a.length;c<u;c++){const h=s[c],f=a[c];h!==0&&(ad.fromBufferAttribute(f,e),i?rl.addScaledVector(ad,h):rl.addScaledVector(ad.sub(t),h))}t.add(rl)}return this.isSkinnedMesh&&this.boneTransform(e,t),t}raycast(e,t){if(this.isAuxClippingMesh)return;const n=this.geometry,r=this.material,a=this.matrixWorld;if(r===void 0||(n.boundingSphere===null&&n.computeBoundingSphere(),EA.copy(n.boundingSphere),EA.applyMatrix4(a),e.ray.intersectsSphere(EA)===!1)||(pM.copy(a).invert(),Su.copy(e.ray).applyMatrix4(pM),n.boundingBox!==null&&Su.intersectsBox(n.boundingBox)===!1))return;let i;const s=n.index,c=n.attributes.position,u=n.morphAttributes.position,h=n.morphTargetsRelative,f=n.attributes.uv,m=n.attributes.uv2,g=n.groups,A=n.drawRange;if(s!==null)if(Array.isArray(r))for(let _=0,x=g.length;_<x;_++){const C=g[_],b=r[C.materialIndex];for(let y=Math.max(C.start,A.start),M=Math.min(s.count,Math.min(C.start+C.count,A.start+A.count));y<M;y+=3){const R=s.getX(y),T=s.getX(y+1),w=s.getX(y+2);i=Ym(this,b,e,Su,c,u,h,f,m,R,T,w),i&&(i.faceIndex=Math.floor(y/3),i.face.materialIndex=C.materialIndex,t.push(i))}}else for(let _=Math.max(0,A.start),x=Math.min(s.count,A.start+A.count);_<x;_+=3){const C=s.getX(_),b=s.getX(_+1),y=s.getX(_+2);i=Ym(this,r,e,Su,c,u,h,f,m,C,b,y),i&&(i.faceIndex=Math.floor(_/3),t.push(i))}else if(c!==void 0)if(Array.isArray(r))for(let _=0,x=g.length;_<x;_++){const C=g[_],b=r[C.materialIndex];for(let y=Math.max(C.start,A.start),M=Math.min(c.count,Math.min(C.start+C.count,A.start+A.count));y<M;y+=3)i=Ym(this,b,e,Su,c,u,h,f,m,y,y+1,y+2),i&&(i.faceIndex=Math.floor(y/3),i.face.materialIndex=C.materialIndex,t.push(i))}else for(let _=Math.max(0,A.start),x=Math.min(c.count,A.start+A.count);_<x;_+=3)i=Ym(this,r,e,Su,c,u,h,f,m,_,_+1,_+2),i&&(i.faceIndex=Math.floor(_/3),t.push(i))}clone(){return new this.constructor(this.geometry,this.material).copy(this)}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}isVisible(){return this.isMaterialGeneratedMesh&&this.parent?this.visible&&this.parent.visible:this.visible}}function WQ(o,e,t,n,r,a,i,s){let c;if(c=e.side===1?n.intersectTriangle(i,a,r,!0,s):n.intersectTriangle(r,a,i,e.side===0,s),c===null)return null;Wm.copy(s),Wm.applyMatrix4(o.matrixWorld);const u=t.ray.origin.distanceTo(Wm);return u<t.near||u>t.far?null:{distance:u,point:Wm.clone(),object:o}}function Ym(o,e,t,n,r,a,i,s,c,u,h,f){Hs.fromBufferAttribute(r,u),Ws.fromBufferAttribute(r,h),Ys.fromBufferAttribute(r,f);const m=o.morphTargetInfluences;if(a&&m){rl.set(0,0,0),Vm.set(0,0,0),km.set(0,0,0);for(let A=0,_=a.length;A<_;A++){const x=m[A],C=a[A];x!==0&&(ad.fromBufferAttribute(C,u),MA.fromBufferAttribute(C,h),wA.fromBufferAttribute(C,f),i?(rl.addScaledVector(ad,x),Vm.addScaledVector(MA,x),km.addScaledVector(wA,x)):(rl.addScaledVector(ad.sub(Hs),x),Vm.addScaledVector(MA.sub(Ws),x),km.addScaledVector(wA.sub(Ys),x)))}Hs.add(rl),Ws.add(Vm),Ys.add(km)}o.isSkinnedMesh&&(o.boneTransform(u,Hs),o.boneTransform(h,Ws),o.boneTransform(f,Ys));const g=WQ(o,e,t,n,Hs,Ws,Ys,TA);if(g){s&&(Gm.fromBufferAttribute(s,u),Qm.fromBufferAttribute(s,h),Hm.fromBufferAttribute(s,f),g.uv=Cr.getInterpolation(TA,Hs,Ws,Ys,Gm,Qm,Hm,new Ee)),c&&(Gm.fromBufferAttribute(c,u),Qm.fromBufferAttribute(c,h),Hm.fromBufferAttribute(c,f),g.uv2=Cr.getInterpolation(TA,Hs,Ws,Ys,Gm,Qm,Hm,new Ee));const A={a:u,b:h,c:f,normal:new B,materialIndex:0};Cr.getNormal(Hs,Ws,Ys,A.normal),g.face=A}return g}class up extends mt{constructor(e=1,t=1,n=1,r=1,a=1,i=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:n,widthSegments:r,heightSegments:a,depthSegments:i};const s=this;r=Math.floor(r),a=Math.floor(a),i=Math.floor(i);const c=[],u=[],h=[],f=[];let m=0,g=0;function A(_,x,C,b,y,M,R,T,w,D,z){const F=M/w,O=R/D,q=M/2,ne=R/2,$=T/2,he=w+1,K=D+1;let oe=0,ie=0;const L=new B;for(let U=0;U<K;U++){const k=U*O-ne;for(let J=0;J<he;J++){const de=J*F-q;L[_]=de*b,L[x]=k*y,L[C]=$,u.push(L.x,L.y,L.z),L[_]=0,L[x]=0,L[C]=T>0?1:-1,h.push(L.x,L.y,L.z),f.push(J/w),f.push(1-U/D),oe+=1}}for(let U=0;U<D;U++)for(let k=0;k<w;k++){const J=m+k+he*U,de=m+k+he*(U+1),te=m+(k+1)+he*(U+1),le=m+(k+1)+he*U;c.push(J,de,le),c.push(de,te,le),ie+=6}s.addGroup(g,ie,z),g+=ie,m+=oe}A("z","y","x",-1,-1,n,t,e,i,a,0),A("z","y","x",1,-1,n,t,-e,i,a,1),A("x","z","y",1,1,e,n,t,r,i,2),A("x","z","y",1,-1,e,n,-t,r,i,3),A("x","y","z",1,-1,e,t,n,r,a,4),A("x","y","z",-1,-1,e,t,-n,r,a,5),this.setIndex(c),this.setAttribute("position",new $e(new Float32Array(u),3)),this.setAttribute("normal",new $e(new Float32Array(h),3)),this.setAttribute("uv",new $e(new Float32Array(f),2))}}function _d(o){const e={};for(const t in o){e[t]={};for(const n in o[t]){const r=o[t][n];r&&(r.isColor||r.isMatrix3||r.isMatrix4||r.isVector2||r.isVector3||r.isVector4||r.isTexture||r.isQuaternion)?e[t][n]=r.clone():Array.isArray(r)?e[t][n]=r.slice():e[t][n]=r}}return e}function go(o){const e={};for(let t=0;t<o.length;t++){const n=_d(o[t]);for(const r in n)e[r]=n[r]}return e}function YQ(o){const e=[];for(let t=0;t<o.length;t++)e.push(o[t].clone());return e}function y5(o){return o.getRenderTarget()===null&&o.outputEncoding===3001?"srgb":"srgb-linear"}const no={clone:_d,merge:go};var jQ=`void main() {
gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
}`,XQ=`void main() {
gl_FragColor = vec4(1.0, 0.0, 0.0, 1.0);
}`;class An extends Er{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.customPrepTokens={},this.vertexShader=jQ,this.fragmentShader=XQ,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,e!==void 0&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=_d(e.uniforms),this.uniformsGroups=YQ(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.customPrepTokens=Object.assign({},e.customPrepTokens),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}}class dp extends Tt{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new Ve,this.projectionMatrix=new Ve,this.projectionMatrixInverse=new Ve,this.controlSettings=null,this.viewportFit={type:0,initialAspect:1},this.ignoreShadowLayers=!1}get controls(){return console.warn("v3d.Camera.controls replaced by v3d.Camera.controlSettings"),this.controlSettings}set controls(e){console.warn("v3d.Camera.controls replaced by v3d.Camera.controlSettings"),this.controlSettings=e}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),e.controlSettings&&(this.controlSettings=e.controlSettings.clone()),this.viewportFit.type=e.viewportFit.type,this.viewportFit.initialAspect=e.viewportFit.initialAspect,this.ignoreShadowLayers=e.ignoreShadowLayers,this}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(-t[8],-t[9],-t[10]).normalize()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(e){return new this.constructor().copy(this,e)}}class ir extends dp{constructor(e=50,t=1,n=.1,r=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=n,this.far=r,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=e.view===null?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const t=.5*this.getFilmHeight()/e;this.fov=2*gd*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(.5*ls*this.fov);return .5*this.getFilmHeight()/e}getEffectiveFOV(){return 2*gd*Math.atan(Math.tan(.5*ls*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(e,t,n,r,a,i){this.aspect=e/t,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=r,this.view.width=a,this.view.height=i,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let t=e*Math.tan(.5*ls*this.fov)/this.zoom,n=2*t,r=this.aspect*n,a=-.5*r;const i=this.view;if(this.view!==null&&this.view.enabled){const c=i.fullWidth,u=i.fullHeight;a+=i.offsetX*r/c,t-=i.offsetY*n/u,r*=i.width/c,n*=i.height/u}const s=this.filmOffset;s!==0&&(a+=e*s/this.getFilmWidth()),this.projectionMatrix.makePerspective(a,a+r,t,t-n,e,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}}class kg extends Tt{constructor(e,t,n){super(),this.type="CubeCamera",this.renderTarget=n;const r=new ir(-90,1,e,t);r.layers=this.layers,r.up.set(0,1,0),r.lookAt(1,0,0),this.add(r);const a=new ir(-90,1,e,t);a.layers=this.layers,a.up.set(0,1,0),a.lookAt(-1,0,0),this.add(a);const i=new ir(-90,1,e,t);i.layers=this.layers,i.up.set(0,0,-1),i.lookAt(0,1,0),this.add(i);const s=new ir(-90,1,e,t);s.layers=this.layers,s.up.set(0,0,1),s.lookAt(0,-1,0),this.add(s);const c=new ir(-90,1,e,t);c.layers=this.layers,c.up.set(0,1,0),c.lookAt(0,0,1),this.add(c);const u=new ir(-90,1,e,t);u.layers=this.layers,u.up.set(0,1,0),u.lookAt(0,0,-1),this.add(u)}update(e,t){this.parent===null&&this.updateMatrixWorld();const n=this.renderTarget,[r,a,i,s,c,u]=this.children,h=e.getRenderTarget(),f=e.toneMapping,m=e.xr.enabled;e.toneMapping=0,e.xr.enabled=!1;const g=n.texture.generateMipmaps;n.texture.generateMipmaps=!1,e.setRenderTarget(n,0),e.render(t,r),e.setRenderTarget(n,1),e.render(t,a),e.setRenderTarget(n,2),e.render(t,i),e.setRenderTarget(n,3),e.render(t,s),e.setRenderTarget(n,4),e.render(t,c),n.texture.generateMipmaps=g,e.setRenderTarget(n,5),e.render(t,u),e.setRenderTarget(h),e.toneMapping=f,e.xr.enabled=m,n.texture.needsPMREMUpdate=!0}}class yv extends In{constructor(e,t,n,r,a,i,s,c,u,h){super(e=e!==void 0?e:[],t=t!==void 0?t:301,n,r,a,i,s,c,u,h),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.source.data}set images(e){this.source.data=e}}class fp extends qt{constructor(e=1,t={}){super(e,e,t),this.isWebGLCubeRenderTarget=!0;const n={width:e,height:e,depth:1},r=[n,n,n,n,n,n];this.texture=new yv(r,t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.encoding),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=t.generateMipmaps!==void 0&&t.generateMipmaps,this.texture.minFilter=t.minFilter!==void 0?t.minFilter:1006}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.encoding=t.encoding,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const n={uniforms:{tEquirect:{value:null}},vertexShader:`

                varying vec3 vWorldDirection;

                vec3 transformDirection(in vec3 dir, in mat4 matrix) {

                    return normalize((matrix * vec4(dir, 0.0)).xyz);

                }

                void main() {

                    vWorldDirection = transformDirection(position, modelMatrix);

                    #include <begin_vertex>
                    #include <project_vertex>

                }
            `,fragmentShader:`

                uniform sampler2D tEquirect;

                varying vec3 vWorldDirection;

                #include <common>

                void main() {

                    vec3 direction = normalize(vWorldDirection);

                    vec2 sampleUV = equirectUv(direction);

                    gl_FragColor = texture2D(tEquirect, sampleUV);

                }
            `},r=new up(5,5,5),a=new An({name:"CubemapFromEquirect",uniforms:_d(n.uniforms),vertexShader:n.vertexShader,fragmentShader:n.fragmentShader,side:1,blending:0});a.uniforms.tEquirect.value=t;const i=new Mt(r,a),s=t.minFilter;return t.minFilter===1008&&(t.minFilter=1006),new kg(1,10,this).update(e,i),t.minFilter=s,i.geometry.dispose(),i.material.dispose(),this}clear(e,t,n,r){const a=e.getRenderTarget();for(let i=0;i<6;i++)e.setRenderTarget(this,i),e.clear(t,n,r);e.setRenderTarget(a)}}const Wn={checkWebGL:function(){try{const o=document.createElement("canvas");return!(!window.WebGLRenderingContext||!o.getContext("webgl")&&!o.getContext("experimental-webgl"))}catch{return!1}},checkWebGL2:function(){try{const o=document.createElement("canvas");return!(!window.WebGL2RenderingContext||!o.getContext("webgl2"))}catch{return!1}},checkWorkers:function(){return!!window.Worker},checkFileAPI:function(){return window.File&&window.FileReader&&window.FileList&&window.Blob},genWebGLErrorMessage:function(o){const e=document.createElement("div");e.setAttribute("class","v3d-webgl-error-container");const t=document.createElement("div");t.setAttribute("class","v3d-webgl-error-image"),e.appendChild(t);const n=document.createElement("div");return n.setAttribute("class","v3d-webgl-error"),n.innerHTML=o,e.appendChild(n),e},showWebGLErrorMessage:function(o,e){(o=o||document.body).appendChild(Wn.genWebGLErrorMessage(e));const t=document.getElementById("v3d_preloader_container");t&&(t.style.visibility="hidden")},checkIOS:function(){return(/iPad|iPhone|iPod/.test(navigator.platform)||navigator.platform==="MacIntel"&&navigator.maxTouchPoints>1)&&!window.MSStream},checkAndroid:function(){return!!navigator.userAgent.match(/Android/i)},checkSafari:function(){return/Safari/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)},checkFloatTex:function(o,e){const t=o.getContext();return!(!o.capabilities.isWebGL2||!t.getExtension("EXT_color_buffer_float")||e&&!t.getExtension("OES_texture_float_linear"))||!(o.capabilities.isWebGL2||!t.getExtension("OES_texture_float")||e&&!t.getExtension("OES_texture_float_linear"))},checkHalfFloatTex:function(o,e){const t=o.getContext();return!(!o.capabilities.isWebGL2||!t.getExtension("EXT_color_buffer_float"))||!(o.capabilities.isWebGL2||!t.getExtension("OES_texture_half_float")||e&&!t.getExtension("OES_texture_half_float_linear"))},checkHalfFloatReadPixels:function(o){const e=o.getContext(),t=o.capabilities;return!/Firefox/.test(navigator.userAgent)&&!!(e.getExtension("EXT_color_buffer_half_float")||t.isWebGL2&&e.getExtension("EXT_color_buffer_float"))},checkFloatReadPixels:function(o){const e=o.getContext();return!!(o.capabilities.isWebGL2||e.getExtension("OES_texture_float")||e.getExtension("WEBGL_color_buffer_float"))},checkDepthTex:function(o){const e=o.getContext();return!(!o.capabilities.isWebGL2&&!e.getExtension("WEBGL_depth_texture"))},getGPUVendor:function(o){const e=o?o.getContext():document.createElement("canvas").getContext("webgl")||document.createElement("canvas").getContext("experimental-webgl");if(/Firefox/.test(navigator.userAgent))return e.getParameter(7936);{const t=e.getExtension("WEBGL_debug_renderer_info");return t!=null?e.getParameter(t.UNMASKED_VENDOR_WEBGL):""}},getGPUModel:function(o){const e=o?o.getContext():document.createElement("canvas").getContext("webgl")||document.createElement("canvas").getContext("experimental-webgl");if(/Firefox/.test(navigator.userAgent))return e.getParameter(7937);{const t=e.getExtension("WEBGL_debug_renderer_info");return t!=null?e.getParameter(t.UNMASKED_RENDERER_WEBGL):""}},checkWebXR:function(o,e,t){"xr"in navigator&&navigator.xr.isSessionSupported?navigator.xr.isSessionSupported(o).then(function(n){n?e():t()}).catch(t):t()},checkNativeWebXR:function(){return!1},checkCardboard:function(){return!1},checkSwiftShader:function(o){return this.getGPUModel(o)=="Google SwiftShader"},checkWebAudio:function(){return(window.AudioContext||window.webkitAudioContext)!==void 0},isSafariWithMultisamplingBug:function(){const o=navigator.userAgent;return!(!this.checkSafari()&&!o.match("MicroMessenger"))&&(o.match("Version/15.4")||o.match(/CPU (OS|iPhone OS) (15_4|15_4_1|15_4_2|15_4_3) like Mac OS X/))},isSafariWithUint16Bug:function(){const o=navigator.userAgent;return!(!this.checkSafari()&&!o.match("MicroMessenger"))&&o.match(/CPU (OS|iPhone OS) (11_[0-9][0-9_]*|12_[0-9][0-9_]*) like Mac OS X/)},isTouchDevice:function(){return"ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0}},RA=new B,qQ=new B,ZQ=new Qr;class _o{constructor(e=new B(1,0,0),t=0){this.isPlane=!0,this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,n,r){return this.normal.set(e,t,n),this.constant=r,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,n){const r=RA.subVectors(n,t).cross(qQ.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(r,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(this.normal).multiplyScalar(-this.distanceToPoint(e)).add(e)}intersectLine(e,t){const n=e.delta(RA),r=this.normal.dot(n);if(r===0)return this.distanceToPoint(e.start)===0?t.copy(e.start):null;const a=-(e.start.dot(this.normal)+this.constant)/r;return a<0||a>1?null:t.copy(n).multiplyScalar(a).add(e.start)}intersectsLine(e){const t=this.distanceToPoint(e.start),n=this.distanceToPoint(e.end);return t<0&&n>0||n<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){const n=t||ZQ.getNormalMatrix(e),r=this.coplanarPoint(RA).applyMatrix4(e),a=this.normal.applyMatrix3(n).normalize();return this.constant=-r.dot(a),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return new this.constructor().copy(this)}}const Cu=new Yo,jm=new B;class hp{constructor(e=new _o,t=new _o,n=new _o,r=new _o,a=new _o,i=new _o){this.planes=[e,t,n,r,a,i]}set(e,t,n,r,a,i){const s=this.planes;return s[0].copy(e),s[1].copy(t),s[2].copy(n),s[3].copy(r),s[4].copy(a),s[5].copy(i),this}copy(e){const t=this.planes;for(let n=0;n<6;n++)t[n].copy(e.planes[n]);return this}setFromProjectionMatrix(e){const t=this.planes,n=e.elements,r=n[0],a=n[1],i=n[2],s=n[3],c=n[4],u=n[5],h=n[6],f=n[7],m=n[8],g=n[9],A=n[10],_=n[11],x=n[12],C=n[13],b=n[14],y=n[15];return t[0].setComponents(s-r,f-c,_-m,y-x).normalize(),t[1].setComponents(s+r,f+c,_+m,y+x).normalize(),t[2].setComponents(s+a,f+u,_+g,y+C).normalize(),t[3].setComponents(s-a,f-u,_-g,y-C).normalize(),t[4].setComponents(s-i,f-h,_-A,y-b).normalize(),t[5].setComponents(s+i,f+h,_+A,y+b).normalize(),this}intersectsObject(e){const t=e.geometry;return t.boundingSphere===null&&t.computeBoundingSphere(),Cu.copy(t.boundingSphere).applyMatrix4(e.matrixWorld),this.intersectsSphere(Cu)}intersectsSprite(e){return Cu.center.set(0,0,0),Cu.radius=.7071067811865476,Cu.applyMatrix4(e.matrixWorld),this.intersectsSphere(Cu)}intersectsSphere(e){const t=this.planes,n=e.center,r=-e.radius;for(let a=0;a<6;a++)if(t[a].distanceToPoint(n)<r)return!1;return!0}intersectsBox(e){const t=this.planes;for(let n=0;n<6;n++){const r=t[n];if(jm.x=r.normal.x>0?e.max.x:e.min.x,jm.y=r.normal.y>0?e.max.y:e.min.y,jm.z=r.normal.z>0?e.max.z:e.min.z,r.distanceToPoint(jm)<0)return!1}return!0}containsPoint(e){const t=this.planes;for(let n=0;n<6;n++)if(t[n].distanceToPoint(e)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}class Hr extends Tt{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.overrideMaterial=null,this.backgroundToneMapped=!0,this.postprocessing=[],this.worldMaterial=null,this.worldEnvMapProbe=null,typeof __V3D_DEVTOOLS__<"u"&&__V3D_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),e.background!==null&&(this.background=e.background.clone()),e.environment!==null&&(this.environment=e.environment.clone()),e.fog!==null&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,this.backgroundIntensity=e.backgroundIntensity,this.backgroundToneMapped=e.backgroundToneMapped,e.overrideMaterial!==null&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}dispose(){this.dispatchEvent({type:"dispose"})}}function b5(){let o=null,e=!1,t=null,n=null;function r(a,i){t(a,i),n=o.requestAnimationFrame(r)}return{start:function(){e!==!0&&t!==null&&(n=o.requestAnimationFrame(r),e=!0)},stop:function(){o.cancelAnimationFrame(n),e=!1},setAnimationLoop:function(a){t=a},setContext:function(a){o=a}}}function KQ(o,e){const t=e.isWebGL2;let n=new WeakMap;return{get:function(r){return r.isInterleavedBufferAttribute&&(r=r.data),n.get(r)},remove:function(r){r.isInterleavedBufferAttribute&&(r=r.data);const a=n.get(r);a&&(o.deleteBuffer(a.buffer),n.delete(r))},update:function(r,a){if(r.isGLBufferAttribute){const s=n.get(r);return void((!s||s.version<r.version)&&n.set(r,{buffer:r.buffer,type:r.type,bytesPerElement:r.elementSize,version:r.version}))}r.isInterleavedBufferAttribute&&(r=r.data);const i=n.get(r);i===void 0?n.set(r,function(s,c){const u=s.array,h=s.usage,f=o.createBuffer();let m;if(o.bindBuffer(c,f),o.bufferData(c,u,h),s.onUploadCallback(),u instanceof Float32Array)m=5126;else if(u instanceof Uint16Array)if(s.isFloat16BufferAttribute){if(!t)throw new Error("v3d.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.");m=5131}else m=5123;else if(u instanceof Int16Array)m=5122;else if(u instanceof Uint32Array)m=5125;else if(u instanceof Int32Array)m=5124;else if(u instanceof Int8Array)m=5120;else if(u instanceof Uint8Array)m=5121;else{if(!(u instanceof Uint8ClampedArray))throw new Error("v3d.WebGLAttributes: Unsupported buffer data format: "+u);m=5121}return{buffer:f,type:m,bytesPerElement:u.BYTES_PER_ELEMENT,version:s.version}}(r,a)):i.version<r.version&&(function(s,c,u){const h=c.array,f=c.updateRange;o.bindBuffer(u,s),f.count===-1?o.bufferSubData(u,0,h):(t?o.bufferSubData(u,f.offset*h.BYTES_PER_ELEMENT,h,f.offset,f.count):o.bufferSubData(u,f.offset*h.BYTES_PER_ELEMENT,h.subarray(f.offset,f.offset+f.count)),f.count=-1),c.onUploadCallback()}(i.buffer,r,a),i.version=r.version)},dispose:function(){n=new WeakMap}}}class ps extends mt{constructor(e=1,t=1,n=1,r=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:n,heightSegments:r};const a=e/2,i=t/2,s=Math.floor(n),c=Math.floor(r),u=s+1,h=c+1,f=e/s,m=t/c,g=[],A=[],_=[],x=[];for(let C=0;C<h;C++){const b=C*m-i;for(let y=0;y<u;y++){const M=y*f-a;A.push(M,-b,0),_.push(0,0,1),x.push(y/s),x.push(1-C/c)}}for(let C=0;C<c;C++)for(let b=0;b<s;b++){const y=b+u*C,M=b+u*(C+1),R=b+1+u*(C+1),T=b+1+u*C;g.push(y,M,T),g.push(M,R,T)}this.setIndex(g),this.setAttribute("position",new $e(new Float32Array(A),3)),this.setAttribute("normal",new $e(new Float32Array(_),3)),this.setAttribute("uv",new $e(new Float32Array(x),2))}}var $Q=`#ifdef USE_ALPHAMAP
diffuseColor.a *= texture2D(alphaMap, vUv).g;
#endif`,JQ=`#ifdef USE_ALPHAMAP
uniform sampler2D alphaMap;
#endif`,eH=`#ifdef USE_ALPHATEST
if (diffuseColor.a < alphaTest)
discard;
else
diffuseColor.a = 1.0;
#endif`,tH=`#ifdef USE_ALPHATEST
uniform float alphaTest;
#endif`,nH=`#ifdef USE_AOMAP
float ambientOcclusion = (texture2D(aoMap, vUv2).r - 1.0) * aoMapIntensity + 1.0;
reflectedLight.indirectDiffuse *= ambientOcclusion;
#if defined(USE_ENVMAP) && defined(STANDARD)
float dotNV = saturate(dot(geometry.normal, geometry.viewDir));
reflectedLight.indirectSpecular *= computeSpecularOcclusion(dotNV, ambientOcclusion, material.roughness);
#endif
#endif`,rH=`#ifdef USE_AOMAP
uniform sampler2D aoMap;
uniform float aoMapIntensity;
#endif`,oH="vec3 transformed = vec3(position);",aH=`vec3 objectNormal = vec3(normal);
#ifdef USE_TANGENT
vec3 objectTangent = vec3(tangent.xyz);
#endif`,iH=`vec3 BRDF_Lambert(const in vec3 diffuseColor) {
return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick(const in vec3 f0, const in float f90, const in float dotVH) {
float fresnel = exp2((-5.55473 * dotVH - 6.98316) * dotVH);
return f0 * (1.0 - fresnel) + (f90 * fresnel);
}
float V_GGX_SmithCorrelated(const in float alpha, const in float dotNL, const in float dotNV) {
float a2 = pow2(alpha);
float gv = dotNL * sqrt(a2 + (1.0 - a2) * pow2(dotNV));
float gl = dotNV * sqrt(a2 + (1.0 - a2) * pow2(dotNL));
return 0.5 / max(gv + gl, EPSILON);
}
float D_GGX(const in float alpha, const in float dotNH) {
float a2 = pow2(alpha);
float denom = pow2(dotNH) * (a2 - 1.0) + 1.0;
return RECIPROCAL_PI * a2 / pow2(denom);
}
vec3 BRDF_GGX(const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float roughness) {
float alpha = pow2(clamp(roughness, 0.04, 1.0));
vec3 halfDir = normalize(lightDir + viewDir);
float dotNL = saturate(dot(normal, lightDir));
float dotNV = saturate(dot(normal, viewDir));
float dotNH = saturate(dot(normal, halfDir));
float dotVH = saturate(dot(viewDir, halfDir));
vec3 F = F_Schlick(f0, f90, dotVH);
float V = V_GGX_SmithCorrelated(alpha, dotNL, dotNV);
float D = D_GGX(alpha, dotNH);
return F * (V * D);
}
vec2 LTC_Uv(const in vec3 N, const in vec3 V, const in float roughness) {
const float LUT_SIZE = 64.0;
const float LUT_SCALE = (LUT_SIZE - 1.0) / LUT_SIZE;
const float LUT_BIAS = 0.5 / LUT_SIZE;
float dotNV = saturate(dot(N, V));
vec2 uv = vec2(roughness, sqrt(1.0 - dotNV));
uv = uv * LUT_SCALE + LUT_BIAS;
return uv;
}
float LTC_ClippedSphereFormFactor(const in vec3 f) {
float l = length(f);
return max((l * l + f.z) / (l + 1.0), 0.0);
}
vec3 LTC_EdgeVectorFormFactor(const in vec3 v1, const in vec3 v2) {
float x = dot(v1, v2);
float y = abs(x);
float a = 0.8543985 + (0.4965155 + 0.0145206 * y) * y;
float b = 3.4175940 + (4.1616724 + y) * y;
float v = a / b;
float theta_sintheta = (x > 0.0) ? v : 0.5 * inversesqrt(max(1.0 - x * x, 1e-7)) - v;
return cross(v1, v2) * theta_sintheta;
}
vec3 LTC_Evaluate(const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[4]) {
vec3 v1 = rectCoords[1] - rectCoords[0];
vec3 v2 = rectCoords[3] - rectCoords[0];
vec3 lightNormal = cross(v1, v2);
if(dot(lightNormal, P - rectCoords[0]) < 0.0) return vec3(0.0);
vec3 T1, T2;
T1 = normalize(V - N * dot(V, N));
T2 = -cross(N, T1);
mat3 mat = mInv * transposeMat3(mat3(T1, T2, N));
vec3 coords[4];
coords[0] = mat * (rectCoords[0] - P);
coords[1] = mat * (rectCoords[1] - P);
coords[2] = mat * (rectCoords[2] - P);
coords[3] = mat * (rectCoords[3] - P);
coords[0] = normalize(coords[0]);
coords[1] = normalize(coords[1]);
coords[2] = normalize(coords[2]);
coords[3] = normalize(coords[3]);
vec3 vectorFormFactor = vec3(0.0);
vectorFormFactor += LTC_EdgeVectorFormFactor(coords[0], coords[1]);
vectorFormFactor += LTC_EdgeVectorFormFactor(coords[1], coords[2]);
vectorFormFactor += LTC_EdgeVectorFormFactor(coords[2], coords[3]);
vectorFormFactor += LTC_EdgeVectorFormFactor(coords[3], coords[0]);
float result = LTC_ClippedSphereFormFactor(vectorFormFactor);
return vec3(result);
}
vec2 integrateSpecularBRDF(const in float dotNV, const in float roughness) {
const vec4 c0 = vec4(-1, -0.0275, -0.572, 0.022);
const vec4 c1 = vec4(1, 0.0425, 1.04, -0.04);
vec4 r = roughness * c0 + c1;
float a004 = min(r.x * r.x, exp2(-9.28 * dotNV)) * r.x + r.y;
return vec2(-1.04, 1.04) * a004 + r.zw;
}
vec3 BRDF_Specular_GGX_Environment(const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in vec3 specularColor90, const in float roughness) {
float dotNV = saturate(dot(normal, viewDir));
vec2 brdf = integrateSpecularBRDF(dotNV, roughness);
return specularColor * brdf.x + specularColor90 * brdf.y;
}
#if defined(USE_SHEEN)
float D_Charlie(float roughness, float dotNH) {
float alpha = pow2(roughness);
float invAlpha = 1.0 / alpha;
float cos2h = dotNH * dotNH;
float sin2h = max(1.0 - cos2h, 0.0078125);
return (2.0 + invAlpha) * pow(sin2h, invAlpha * 0.5) / (2.0 * PI);
}
float V_Neubelt(float dotNV, float dotNL) {
return saturate(1.0 / (4.0 * (dotNL + dotNV - dotNL * dotNV)));
}
vec3 BRDF_Sheen(const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness) {
vec3 halfDir = normalize(lightDir + viewDir);
float dotNL = saturate(dot(normal, lightDir));
float dotNV = saturate(dot(normal, viewDir));
float dotNH = saturate(dot(normal, halfDir));
float D = D_Charlie(sheenRoughness, dotNH);
float V = V_Neubelt(dotNV, dotNL);
return sheenColor * (D * V);
}
#endif`,sH=`#ifdef USE_BUMPMAP
uniform sampler2D bumpMap;
uniform float bumpScale;
vec2 dHdxy_fwd() {
vec2 dSTdx = dFdx(vUv);
vec2 dSTdy = dFdy(vUv);
float Hll = bumpScale * texture2D(bumpMap, vUv).x;
float dBx = bumpScale * texture2D(bumpMap, vUv + dSTdx).x - Hll;
float dBy = bumpScale * texture2D(bumpMap, vUv + dSTdy).x - Hll;
return vec2(dBx, dBy);
}
vec3 perturbNormalArb(vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection) {
vec3 vSigmaX = dFdx(surf_pos.xyz);
vec3 vSigmaY = dFdy(surf_pos.xyz);
vec3 vN = surf_norm;
vec3 R1 = cross(vSigmaY, vN);
vec3 R2 = cross(vN, vSigmaX);
float fDet = dot(vSigmaX, R1) * faceDirection;
vec3 vGrad = sign(fDet) * (dHdxy.x * R1 + dHdxy.y * R2);
return normalize(abs(fDet) * surf_norm - vGrad);
}
#endif`,lH=`#if NUM_CLIPPING_PLANES > 0
vec4 plane;
#pragma unroll_loop
for (int i = 0; i < UNION_CLIPPING_PLANES; i++) {
plane = clippingPlanes[i];
if (dot(vClipPosition, plane.xyz) > plane.w) discard;
}
#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
bool clipped = true;
#pragma unroll_loop
for (int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i++) {
plane = clippingPlanes[i];
clipped = (dot(vClipPosition, plane.xyz) > plane.w) && clipped;
}
if (clipped) discard;
#endif
#endif`,cH=`#if NUM_CLIPPING_PLANES > 0
varying vec3 vClipPosition;
uniform vec4 clippingPlanes[NUM_CLIPPING_PLANES];
#endif`,uH=`#if NUM_CLIPPING_PLANES > 0
varying vec3 vClipPosition;
#endif`,dH=`#if NUM_CLIPPING_PLANES > 0
vClipPosition = -mvPosition.xyz;
#endif`,fH=`#if defined(USE_COLOR_ALPHA)
diffuseColor *= vColor;
#elif defined(USE_COLOR)
diffuseColor.rgb *= vColor;
#endif`,hH=`#if defined(USE_COLOR_ALPHA)
varying vec4 vColor;
#elif defined(USE_COLOR)
varying vec3 vColor;
#endif`,pH=`#if defined(USE_COLOR_ALPHA)
varying vec4 vColor;
#elif defined(USE_COLOR) || defined(USE_INSTANCING_COLOR)
varying vec3 vColor;
#endif`,mH=`#if defined(USE_COLOR_ALPHA)
vColor = vec4(1.0);
#elif defined(USE_COLOR) || defined(USE_INSTANCING_COLOR)
vColor = vec3(1.0);
#endif
#ifdef USE_COLOR
vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
vColor.xyz *= instanceColor.xyz;
#endif`,gH=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate(a) clamp(a, 0.0, 1.0)
#endif
float pow2(const in float x) { return x*x; }
vec3 pow2(const in vec3 x) { return x*x; }
float pow3(const in float x) { return x*x*x; }
float pow4(const in float x) { float x2 = x*x; return x2*x2; }
float max3(const in vec3 v) { return max(max(v.x, v.y), v.z); }
float average(const in vec3 v) { return dot(v, vec3(0.3333333)); }
highp float rand(const in vec2 uv) {
const highp float a = 12.9898, b = 78.233, c = 43758.5453;
highp float dt = dot(uv.xy, vec2(a,b)), sn = mod(dt, PI);
return fract(sin(sn) * c);
}
#ifdef HIGH_PRECISION
float precisionSafeLength(vec3 v) { return length(v); }
#else
float precisionSafeLength(vec3 v) {
float maxComponent = max3(abs(v));
return length(v / maxComponent) * maxComponent;
}
#endif
struct IncidentLight {
vec3 color;
vec3 direction;
bool visible;
};
struct ReflectedLight {
vec3 directDiffuse;
vec3 directSpecular;
vec3 indirectDiffuse;
vec3 indirectSpecular;
};
struct GeometricContext {
vec3 position;
vec3 normal;
vec3 viewDir;
vec3 probeNormal;
#ifdef USE_CLEARCOAT
vec3 clearcoatNormal;
#endif
};
vec3 transformDirection(in vec3 dir, in mat4 matrix) {
return normalize((matrix * vec4(dir, 0.0)).xyz);
}
vec3 inverseTransformDirection(in vec3 dir, in mat4 matrix) {
return normalize((vec4(dir, 0.0) * matrix).xyz);
}
mat3 transposeMat3(const in mat3 m) {
mat3 tmp;
tmp[0] = vec3(m[0].x, m[1].x, m[2].x);
tmp[1] = vec3(m[0].y, m[1].y, m[2].y);
tmp[2] = vec3(m[0].z, m[1].z, m[2].z);
return tmp;
}
float linearToRelativeLuminance(const in vec3 color) {
const vec3 weights = vec3(0.2126729, 0.7151522, 0.0721750);
return dot(weights, color.rgb);
}
bool isPerspectiveMatrix(mat4 m) {
return m[2][3] == -1.0;
}
vec2 equirectUv(in vec3 dir) {
float u = atan(dir.z, dir.x) * RECIPROCAL_PI2 + 0.5;
float v = asin(clamp(dir.y, -1.0, 1.0)) * RECIPROCAL_PI + 0.5;
return vec2(u, v);
}
vec3 octUVToCubeVec(vec2 octUV, vec2 texelSize) {
octUV = (1.0 + 2.0 * texelSize) * octUV - texelSize;
octUV = octUV * 2.0 - 1.0;
float x = octUV.x;
float z = -octUV.y;
float absX = abs(x);
float absZ = abs(z);
vec3 cubeVec = vec3(x, 1.0 - absX - absZ, z);
if (absX + absZ > 1.0) {
cubeVec.xz = -(vec2(absZ, absX) - 1.0) * sign(vec2(x, z));
}
return cubeVec;
}
vec2 cubeVecToOctUV(vec3 cubeVec, vec2 texelSize) {
cubeVec /= dot(vec3(1.0), abs(cubeVec));
vec2 octUV = vec2(cubeVec.x, -cubeVec.z);
if (cubeVec.y < 0.0) {
octUV = sign(octUV) * (1.0 - abs(octUV.ts));
}
octUV = (octUV + 1.0) / 2.0;
octUV = (1.0 - 2.0 * texelSize) * octUV + texelSize;
return octUV;
}
vec3 vec3RotateAxisAngle(vec3 vector, vec3 axis, float angle) {
vec3 axisNorm = normalize(axis);
float x = axisNorm.x, y = axisNorm.y, z = axisNorm.z;
float s = sin(angle), c = cos(angle);
return mat3(
x * x * (1.0 - c) + c, x * y * (1.0 - c) + z * s, x * z * (1.0 - c) - y * s,
x * y * (1.0 - c) - z * s, y * y * (1.0 - c) + c, y * z * (1.0 - c) + x * s,
x * z * (1.0 - c) + y * s, y * z * (1.0 - c) - x * s, z * z * (1.0 - c) + c
) * vector;
}`,vH=`#ifdef ENVMAP_TYPE_CUBE_UV
float getFace(vec3 direction) {
vec3 absDirection = abs(direction);
float face = -1.0;
if (absDirection.x > absDirection.z) {
if (absDirection.x > absDirection.y) {
face = direction.x > 0.0 ? 0.0 : 3.0;
} else {
face = direction.y > 0.0 ? 1.0 : 4.0;
}
} else {
if (absDirection.z > absDirection.y) {
face = direction.z > 0.0 ? 2.0 : 5.0;
} else {
face = direction.y > 0.0 ? 1.0 : 4.0;
}
}
return face;
}
vec2 getUV(vec3 direction, float face) {
vec2 uv;
if (face == 0.0) {
uv = vec2(-direction.z, direction.y) / abs(direction.x);
} else if (face == 1.0) {
uv = vec2(direction.x, -direction.z) / abs(direction.y);
} else if (face == 2.0) {
uv = direction.xy / abs(direction.z);
} else if (face == 3.0) {
uv = vec2(direction.z, direction.y) / abs(direction.x);
} else if (face == 4.0) {
uv = direction.xz / abs(direction.y);
} else {
uv = vec2(-direction.x, direction.y) / abs(direction.z);
}
return 0.5 * (uv + 1.0);
}
#ifndef cubeUV_maxTileSize
#define cubeUV_maxTileSize 256.0
#endif
#define cubeUV_lodIdxMin 0.0
#define cubeUV_lodIdxLastDownscaled 4.0
#define cubeUV_lodIdxMax 10.0
#define cubeUV_minTileSize (cubeUV_maxTileSize / exp2(cubeUV_lodIdxLastDownscaled))
float getLodTileSize(float lodIdx) {
return cubeUV_maxTileSize / exp2(min(lodIdx, cubeUV_lodIdxLastDownscaled));
}
float getLodFilterLevel(float lodIdx) {
return max(lodIdx - cubeUV_lodIdxLastDownscaled, 0.0);
}
vec2 fixCubeUVSeams(vec2 uv, float faceSize) {
float BORDER_WIDTH_PX = max(cubeUV_maxTileSize / 256.0 - 1.0, 0.0);
float scale = (faceSize - BORDER_WIDTH_PX) / faceSize;
float offset = 0.5 * BORDER_WIDTH_PX / faceSize;
return uv * scale + offset;
}
vec2 getUVPixels(vec3 direction, float lodIdx) {
float face = getFace(direction);
float faceSize = getLodTileSize(lodIdx);
float filterLevel = getLodFilterLevel(lodIdx);
vec2 uv = getUV(direction, face);
uv = fixCubeUVSeams(uv, faceSize);
uv *= (faceSize - 1.0);
if (face > 2.0) {
uv.y += faceSize;
face -= 3.0;
}
uv.x += face * faceSize;
if (lodIdx > 0.0) {
uv.y += 2.0 * cubeUV_maxTileSize;
}
uv.y += filterLevel * 2.0 * cubeUV_minTileSize;
uv.x += 3.0 * max(0.0, cubeUV_maxTileSize - 2.0 * faceSize);
return uv;
}
vec3 bilinearCubeUV(sampler2D envMap, vec3 direction, float lodIdx) {
float texelSize = 1.0 / (3.0 * cubeUV_maxTileSize);
vec2 uv = getUVPixels(direction, lodIdx);
vec2 f = fract(uv);
uv += 0.5 - f;
uv *= texelSize;
vec3 tl = texture2D(envMap, uv).rgb;
uv.x += texelSize;
vec3 tr = texture2D(envMap, uv).rgb;
uv.y += texelSize;
vec3 br = texture2D(envMap, uv).rgb;
uv.x -= texelSize;
vec3 bl = texture2D(envMap, uv).rgb;
vec3 tm = mix(tl, tr, f.x);
vec3 bm = mix(bl, br, f.x);
return mix(tm, bm, f.y);
}
vec3 sampleCubeUV(sampler2D envMap, vec3 direction, float lodIdx) {
float texelSize = 1.0 / (3.0 * cubeUV_maxTileSize);
vec2 uv = getUVPixels(direction, lodIdx);
uv += 0.5;
uv *= texelSize;
return texture2D(envMap, uv).rgb;
}
float roughnessToMip(float roughness) {
float r = roughness;
float r2 = r * r;
float r3 = r2 * r;
roughness = -1.20278049 * r3 + 1.86860137 * r2 + 0.32478081 * r + 0.0098139;
return roughness * (cubeUV_lodIdxMax - cubeUV_lodIdxMin);
}
vec4 textureCubeUV(sampler2D envMap, vec3 sampleDir, float roughness) {
float lodIdx = clamp(roughnessToMip(roughness), cubeUV_lodIdxMin, cubeUV_lodIdxMax);
float lodIdxF = fract(lodIdx);
float lodIdxI = floor(lodIdx);
vec3 color0 = sampleCubeUV(envMap, sampleDir, lodIdxI);
if (lodIdxF == 0.0) {
return vec4(color0, 1.0);
} else {
vec3 color1 = sampleCubeUV(envMap, sampleDir, lodIdxI + 1.0);
return vec4(mix(color0, color1, lodIdxF), 1.0);
}
}
#endif`,_H=`vec3 transformedNormal = objectNormal;
#ifdef USE_INSTANCING
mat3 m = mat3(instanceMatrix);
transformedNormal /= vec3(dot(m[0], m[0]), dot(m[1], m[1]), dot(m[2], m[2]));
transformedNormal = m * transformedNormal;
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
transformedNormal = -transformedNormal;
#endif
#ifdef USE_TANGENT
vec3 transformedTangent = (modelViewMatrix * vec4(objectTangent, 0.0)).xyz;
#ifdef FLIP_SIDED
transformedTangent = -transformedTangent;
#endif
#endif`,AH=`#ifdef USE_DISPLACEMENTMAP
uniform sampler2D displacementMap;
uniform float displacementScale;
uniform float displacementBias;
#endif`,xH=`#ifdef USE_DISPLACEMENTMAP
transformed += normalize(objectNormal) * (texture2D(displacementMap, vUv).x * displacementScale + displacementBias);
#endif`,yH=`#ifdef USE_EMISSIVEMAP
vec4 emissiveColor = texture2D(emissiveMap, vUv);
totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,bH=`#ifdef USE_EMISSIVEMAP
uniform sampler2D emissiveMap;
#endif`,SH="gl_FragColor = linearToOutputTexel(gl_FragColor);",CH=`vec4 LinearToLinear(in vec4 value) {
return value;
}
vec4 LinearTosRGB(in vec4 value) {
return vec4(mix(pow(value.rgb, vec3(0.41666)) * 1.055 - vec3(0.055), value.rgb * 12.92, vec3(lessThanEqual(value.rgb, vec3(0.0031308)))), value.a);
}`,EH=`#ifdef USE_ENVMAP
#ifdef ENV_WORLDPOS
vec3 cameraToFrag;
if (isOrthographic) {
cameraToFrag = normalize(vec3(-viewMatrix[0][2], - viewMatrix[1][2], - viewMatrix[2][2]));
} else {
cameraToFrag = normalize(vWorldPosition - cameraPosition);
}
vec3 worldNormal = inverseTransformDirection(normal, viewMatrix);
#ifdef ENVMAP_MODE_REFLECTION
vec3 reflectVec = reflect(cameraToFrag, worldNormal);
#else
vec3 reflectVec = refract(cameraToFrag, worldNormal, refractionRatio);
#endif
#else
vec3 reflectVec = vReflect;
#endif
#ifdef ENVMAP_TYPE_CUBE
vec4 envColor = textureCube(envMap, vec3(flipEnvMap * reflectVec.x, reflectVec.yz));
#else
vec4 envColor = vec4(0.0);
#endif
#ifdef ENVMAP_BLENDING_MULTIPLY
outgoingLight = mix(outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity);
#elif defined(ENVMAP_BLENDING_MIX)
outgoingLight = mix(outgoingLight, envColor.xyz, specularStrength * reflectivity);
#elif defined(ENVMAP_BLENDING_ADD)
outgoingLight += envColor.xyz * specularStrength * reflectivity;
#endif
#endif`,MH=`#ifdef USE_ENVMAP
uniform float envMapIntensity;
uniform float flipEnvMap;
#ifdef ENVMAP_TYPE_CUBE
uniform samplerCube envMap;
#else
uniform sampler2D envMap;
#endif
#if defined(ENVMAP_TYPE_CUBE) && defined(NODE) || defined(ENVMAP_TYPE_CUBE_UV)
float calcGeometryRoughness(vec3 geometryNormal) {
vec3 dxy = max(abs(dFdx(geometryNormal)), abs(dFdy(geometryNormal)));
return max(max(dxy.x, dxy.y), dxy.z);
}
float calcCubeUVAdjustedRoughness(float origRoughness, float geomRoughness) {
return min(max(origRoughness, 0.0525) + geomRoughness, 1.0);
}
#endif
#endif`,wH=`#ifdef USE_ENVMAP
uniform float reflectivity;
#if defined(USE_BUMPMAP) || defined(USE_NORMALMAP) || defined(LAMBERT)
#define ENV_WORLDPOS
#endif
#ifdef ENV_WORLDPOS
varying vec3 vWorldPosition;
uniform float refractionRatio;
#else
varying vec3 vReflect;
#endif
#endif`,TH=`#ifdef USE_ENVMAP
#if defined(USE_BUMPMAP) || defined(USE_NORMALMAP) || defined(LAMBERT)
#define ENV_WORLDPOS
#endif
#ifdef ENV_WORLDPOS
varying vec3 vWorldPosition;
#else
varying vec3 vReflect;
uniform float refractionRatio;
#endif
#endif`,RH=`#ifdef USE_ENVMAP
#ifdef ENV_WORLDPOS
vWorldPosition = worldPosition.xyz;
#else
vec3 cameraToVertex;
if (isOrthographic) {
cameraToVertex = normalize(vec3(-viewMatrix[0][2], - viewMatrix[1][2], - viewMatrix[2][2]));
} else {
cameraToVertex = normalize(worldPosition.xyz - cameraPosition);
}
vec3 worldNormal = inverseTransformDirection(transformedNormal, viewMatrix);
#ifdef ENVMAP_MODE_REFLECTION
vReflect = reflect(cameraToVertex, worldNormal);
#else
vReflect = refract(cameraToVertex, worldNormal, refractionRatio);
#endif
#endif
#endif`,IH=`#ifdef USE_FOG
vFogDepth = -mvPosition.z;
#endif`,LH=`#ifdef USE_FOG
varying float vFogDepth;
#endif`,BH=`#ifdef USE_FOG
#ifdef FOG_EXP2
float fogFactor = 1.0 - exp(-fogDensity * fogDensity * vFogDepth * vFogDepth);
#else
float fogFactor = smoothstep(fogNear, fogFar, vFogDepth);
#endif
gl_FragColor.rgb = mix(gl_FragColor.rgb, fogColor, fogFactor);
#endif`,PH=`#ifdef USE_FOG
uniform vec3 fogColor;
varying float vFogDepth;
#ifdef FOG_EXP2
uniform float fogDensity;
#else
uniform float fogNear;
uniform float fogFar;
#endif
#endif`,NH=`#ifdef USE_LIGHTMAP
vec4 lightMapTexel = texture2D(lightMap, vUv2);
vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
reflectedLight.indirectDiffuse += lightMapIrradiance;
#endif`,DH=`#ifdef USE_LIGHTMAP
uniform sampler2D lightMap;
uniform float lightMapIntensity;
#endif`,OH=`LambertMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularStrength = specularStrength;`,FH=`varying vec3 vViewPosition;
struct LambertMaterial {
vec3 diffuseColor;
float specularStrength;
};
void RE_Direct_Lambert(const in IncidentLight directLight, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight) {
float dotNL = saturate(dot(geometry.normal, directLight.direction));
vec3 irradiance = dotNL * directLight.color;
reflectedLight.directDiffuse += irradiance * BRDF_Lambert(material.diffuseColor);
}
void RE_IndirectDiffuse_Lambert(const in vec3 irradiance, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight) {
reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert(material.diffuseColor);
}
#define RE_Direct RE_Direct_Lambert
#define RE_IndirectDiffuse RE_IndirectDiffuse_Lambert`,UH=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
uniform vec3 lightProbe[9];
vec3 shGetIrradianceAt(in vec3 normal, in vec3 shCoefficients[9]) {
float x = normal.x, y = normal.y, z = normal.z;
vec3 result = shCoefficients[0] * 0.886227;
result += shCoefficients[1] * 2.0 * 0.511664 * y;
result += shCoefficients[2] * 2.0 * 0.511664 * z;
result += shCoefficients[3] * 2.0 * 0.511664 * x;
result += shCoefficients[4] * 2.0 * 0.429043 * x * y;
result += shCoefficients[5] * 2.0 * 0.429043 * y * z;
result += shCoefficients[6] * (0.743125 * z * z - 0.247708);
result += shCoefficients[7] * 2.0 * 0.429043 * x * z;
result += shCoefficients[8] * 0.429043 * (x * x - y * y);
return result;
}
vec3 getLightProbeIrradiance(const in vec3 lightProbe[9], const in vec3 normal) {
vec3 worldNormal = inverseTransformDirection(normal, viewMatrix);
vec3 irradiance = shGetIrradianceAt(worldNormal, lightProbe);
return irradiance;
}
vec3 getAmbientLightIrradiance(const in vec3 ambientLightColor) {
vec3 irradiance = ambientLightColor;
return irradiance;
}
float getDistanceAttenuation(float lightDistance, const in float cutoffDistance, const in float decayExponent) {
lightDistance = UNITS_SCALE_FACTOR * lightDistance;
#ifdef MT_MAYA
float distanceFalloff = 1.0 / pow(lightDistance + 1.0, decayExponent);
#else
float distanceFalloff = 1.0 / max(pow(lightDistance, decayExponent), 0.01);
#endif
if (cutoffDistance > 0.0) {
distanceFalloff *= pow2(saturate(1.0 - pow4(lightDistance / (UNITS_SCALE_FACTOR * cutoffDistance))));
}
return distanceFalloff;
}
float getSpotAttenuation(const in float coneCosine, const in float penumbraCosine, const in float angleCosine) {
return smoothstep(coneCosine, penumbraCosine, angleCosine);
}
#if NUM_DIR_LIGHTS > 0
struct DirectionalLight {
vec3 direction;
vec3 color;
};
uniform DirectionalLight directionalLights[NUM_DIR_LIGHTS];
void getDirectionalLightInfo(const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight light) {
light.color = directionalLight.color;
light.direction = directionalLight.direction;
light.visible = true;
}
#endif
#if NUM_POINT_LIGHTS > 0
struct PointLight {
vec3 position;
vec3 color;
float distance;
float decay;
};
uniform PointLight pointLights[NUM_POINT_LIGHTS];
void getPointLightInfo(const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight light) {
vec3 lVector = pointLight.position - geometry.position;
light.direction = normalize(lVector);
float lightDistance = length(lVector);
light.color = pointLight.color;
light.color *= getDistanceAttenuation(lightDistance, pointLight.distance, pointLight.decay);
light.visible = (light.color != vec3(0.0));
}
#endif
#if NUM_SPOT_LIGHTS > 0
struct SpotLight {
vec3 position;
vec3 direction;
vec3 color;
float distance;
float decay;
float coneCos;
float penumbraCos;
};
uniform SpotLight spotLights[NUM_SPOT_LIGHTS];
void getSpotLightInfo(const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight light) {
vec3 lVector = spotLight.position - geometry.position;
light.direction = normalize(lVector);
float angleCos = dot(light.direction, spotLight.direction);
#if defined(MT_MAX)
float coneCosDecayed = 2.0 * spotLight.coneCos - spotLight.penumbraCos;
if (angleCos > coneCosDecayed) {
float spotAttenuation = pow(max(angleCos, 0.0), log(0.5) / log(spotLight.penumbraCos) - 1.0);
if (angleCos < spotLight.coneCos) {
float decayFac = 1.0 + (spotLight.coneCos - angleCos)
/ (spotLight.coneCos - spotLight.penumbraCos);
spotAttenuation *= pow2(decayFac) * (3.0 - 2.0 * decayFac);
}
float lightDistance = length(lVector);
light.color = spotLight.color * spotAttenuation;
light.color *= getDistanceAttenuation(lightDistance, spotLight.distance, spotLight.decay);
light.visible = true;
} else {
light.color = vec3(0.0);
light.visible = false;
}
#else
float spotAttenuation = getSpotAttenuation(spotLight.coneCos, spotLight.penumbraCos, angleCos);
if (spotAttenuation > 0.0) {
float lightDistance = length(lVector);
light.color = spotLight.color * spotAttenuation;
light.color *= getDistanceAttenuation(lightDistance, spotLight.distance, spotLight.decay);
light.visible = true;
} else {
light.color = vec3(0.0);
light.visible = false;
}
#endif
}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
struct RectAreaLight {
vec3 color;
vec3 position;
vec3 halfWidth;
vec3 halfHeight;
};
uniform sampler2D ltc_1;
uniform sampler2D ltc_2;
uniform RectAreaLight rectAreaLights[NUM_RECT_AREA_LIGHTS];
#endif
#if NUM_HEMI_LIGHTS > 0
struct HemisphereLight {
vec3 direction;
vec3 skyColor;
vec3 groundColor;
};
uniform HemisphereLight hemisphereLights[NUM_HEMI_LIGHTS];
vec3 getHemisphereLightIrradiance(const in HemisphereLight hemiLight, const in vec3 normal) {
float dotNL = dot(normal, hemiLight.direction);
float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
vec3 irradiance = mix(hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight);
return irradiance;
}
#endif`,zH=`#if defined(USE_ENVMAP)
#define ENVMAP_PARALLAX_INFINITE 0
#define ENVMAP_PARALLAX_SPHERE 1
#define ENVMAP_PARALLAX_BOX 2
uniform int envMapParallaxType;
uniform mat4 envMapParallaxMatrix;
uniform mat4 envMapParallaxMatrixInv;
vec3 correctParallax(vec3 directionVecWorld, vec3 posWorld, int parallaxType) {
vec3 posProbe = (envMapParallaxMatrix * vec4(posWorld, 1.0)).xyz;
vec3 reflectVecProbe = transformDirection(directionVecWorld, envMapParallaxMatrix);
if (parallaxType == ENVMAP_PARALLAX_SPHERE) {
float b = 2.0 * dot(reflectVecProbe, posProbe);
float c = dot(posProbe, posProbe) - 1.0;
float D = b * b - 4.0 * c;
if (D >= 0.0) {
float x = (sqrt(D) - b) / 2.0;
reflectVecProbe = posProbe + x * reflectVecProbe;
}
} else if (parallaxType == ENVMAP_PARALLAX_BOX) {
vec3 scalePos = (vec3(1.0) - posProbe) / reflectVecProbe;
vec3 scaleNeg = (vec3(-1.0) - posProbe) / reflectVecProbe;
vec3 scalePosNeg = mix(scaleNeg, scalePos, step(vec3(0.0), reflectVecProbe));
float x = min(scalePosNeg.x, min(scalePosNeg.y, scalePosNeg.z));
reflectVecProbe = posProbe + x * reflectVecProbe;
}
vec3 directionVecWorldCorrected = transformDirection(reflectVecProbe,
envMapParallaxMatrixInv);
return directionVecWorldCorrected;
}
vec3 getIBLIrradiance(const in vec3 normal) {
#if defined(ENVMAP_TYPE_CUBE_UV)
vec3 worldNormal = inverseTransformDirection(normal, viewMatrix);
vec4 envMapColor = textureCubeUV(envMap, worldNormal, 1.0);
return PI * envMapColor.rgb * envMapIntensity;
#else
return vec3(0.0);
#endif
}
vec3 getIBLRadiance(const in vec3 viewDir, const in vec3 normal, const in float roughness, vec3 position) {
#if defined(ENVMAP_TYPE_CUBE_UV)
vec3 reflectVec = reflect(-viewDir, normal);
reflectVec = inverseTransformDirection(reflectVec, viewMatrix);
if (envMapParallaxType != ENVMAP_PARALLAX_INFINITE) {
vec3 posWorld = (invViewMatrix * vec4(position, 1.0)).xyz;
reflectVec = correctParallax(reflectVec, posWorld, envMapParallaxType);
}
vec4 envMapColor = textureCubeUV(envMap, reflectVec, roughness);
return envMapColor.rgb * envMapIntensity;
#else
return vec3(0.0);
#endif
}
vec3 getIBLRefraction(const in vec3 viewDir, const in vec3 normal, const in float roughness, const float refrRatio, vec3 position) {
#if defined(ENVMAP_TYPE_CUBE_UV)
vec3 refractVec = refract(-viewDir, normal, refrRatio);
refractVec = inverseTransformDirection(refractVec, viewMatrix);
if (envMapParallaxType != ENVMAP_PARALLAX_INFINITE) {
vec3 posWorld = (invViewMatrix * vec4(position, 1.0)).xyz;
refractVec = correctParallax(refractVec, posWorld, envMapParallaxType);
}
vec4 envMapColor = textureCubeUV(envMap, refractVec, roughness);
return envMapColor.rgb * envMapIntensity;
#else
return vec3(0.0);
#endif
}
#endif`,VH=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * (1.0 - metalnessFactor);
vec3 dxy = max(abs(dFdx(geometryNormal)), abs(dFdy(geometryNormal)));
float geometryRoughness = max(max(dxy.x, dxy.y), dxy.z);
material.roughness = max(roughnessFactor, 0.0525);
material.roughness += geometryRoughness;
material.roughness = min(material.roughness, 1.0);
#ifdef IOR
material.ior = ior;
#ifdef SPECULAR
float specularIntensityFactor = specularIntensity;
vec3 specularColorFactor = specularColor;
#ifdef USE_SPECULARINTENSITYMAP
specularIntensityFactor *= texture2D(specularIntensityMap, vUv).a;
#endif
#ifdef USE_SPECULARCOLORMAP
specularColorFactor *= texture2D(specularColorMap, vUv).rgb;
#endif
material.specularF90 = mix(specularIntensityFactor, 1.0, metalnessFactor);
#else
float specularIntensityFactor = 1.0;
vec3 specularColorFactor = vec3(1.0);
material.specularF90 = 1.0;
#endif
material.specularColor = mix(min(pow2((material.ior - 1.0) / (material.ior + 1.0)) * specularColorFactor, vec3(1.0)) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor);
#else
material.specularColor = mix(vec3(0.04), diffuseColor.rgb, metalnessFactor);
material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
material.clearcoat = clearcoat;
material.clearcoatRoughness = clearcoatRoughness;
material.clearcoatF0 = vec3(0.04);
material.clearcoatF90 = 1.0;
#ifdef USE_CLEARCOATMAP
material.clearcoat *= texture2D(clearcoatMap, vUv).x;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
material.clearcoatRoughness *= texture2D(clearcoatRoughnessMap, vUv).y;
#endif
material.clearcoat = saturate(material.clearcoat);
material.clearcoatRoughness = max(material.clearcoatRoughness, 0.0525);
material.clearcoatRoughness += geometryRoughness;
material.clearcoatRoughness = min(material.clearcoatRoughness, 1.0);
#endif`,kH=`struct PhysicalMaterial {
vec3 diffuseColor;
float roughness;
vec3 specularColor;
float specularF90;
#ifdef USE_CLEARCOAT
float clearcoat;
float clearcoatRoughness;
vec3 clearcoatF0;
float clearcoatF90;
#endif
#ifdef IOR
float ior;
#endif
#ifdef USE_TRANSMISSION
float transmission;
float transmissionAlpha;
float thickness;
float attenuationDistance;
vec3 attenuationColor;
#endif
};
vec3 clearcoatSpecular = vec3(0.0);
vec2 DFGApprox(const in vec3 normal, const in vec3 viewDir, const in float roughness) {
float dotNV = saturate(dot(normal, viewDir));
const vec4 c0 = vec4(- 1, -0.0275, -0.572, 0.022);
const vec4 c1 = vec4(1, 0.0425, 1.04, -0.04);
vec4 r = roughness * c0 + c1;
float a004 = min(r.x * r.x, exp2(- 9.28 * dotNV)) * r.x + r.y;
vec2 fab = vec2(- 1.04, 1.04) * a004 + r.zw;
return fab;
}
vec3 EnvironmentBRDF(const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness) {
vec2 fab = DFGApprox(normal, viewDir, roughness);
return specularColor * fab.x + specularF90 * fab.y;
}
void computeMultiscattering(const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter) {
vec2 fab = DFGApprox(normal, viewDir, roughness);
vec3 Fr = specularColor;
vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
float Ess = fab.x + fab.y;
float Ems = 1.0 - Ess;
vec3 Favg = Fr + (1.0 - Fr) * 0.047619;
vec3 Fms = FssEss * Favg / (1.0 - Ems * Favg);
singleScatter += FssEss;
multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
void RE_Direct_RectArea_Physical(const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
vec3 normal = geometry.normal;
vec3 viewDir = geometry.viewDir;
vec3 position = geometry.position;
vec3 lightPos = rectAreaLight.position;
vec3 halfWidth = rectAreaLight.halfWidth;
vec3 halfHeight = rectAreaLight.halfHeight;
vec3 lightColor = rectAreaLight.color;
float roughness = material.roughness;
vec3 rectCoords[4];
rectCoords[0] = lightPos + halfWidth - halfHeight;
rectCoords[1] = lightPos - halfWidth - halfHeight;
rectCoords[2] = lightPos - halfWidth + halfHeight;
rectCoords[3] = lightPos + halfWidth + halfHeight;
vec2 uv = LTC_Uv(normal, viewDir, roughness);
vec4 t1 = texture2D(ltc_1, uv);
vec4 t2 = texture2D(ltc_2, uv);
mat3 mInv = mat3(
vec3(t1.x, 0, t1.y),
vec3( 0, 1, 0),
vec3(t1.z, 0, t1.w)
);
vec3 fresnel = (material.specularColor * t2.x + (vec3(1.0) - material.specularColor) * t2.y);
reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate(normal, viewDir, position, mInv, rectCoords);
reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate(normal, viewDir, position, mat3(1.0), rectCoords);
}
#endif
void RE_Direct_Physical(const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
float dotNL = saturate(dot(geometry.normal, directLight.direction));
vec3 irradiance = dotNL * directLight.color;
#ifdef USE_CLEARCOAT
float dotNLcc = saturate(dot(geometry.clearcoatNormal, directLight.direction));
vec3 ccIrradiance = dotNLcc * directLight.color;
clearcoatSpecular += ccIrradiance * BRDF_GGX(directLight.direction, geometry.viewDir, geometry.clearcoatNormal, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness);
#endif
reflectedLight.directSpecular += irradiance * BRDF_GGX(directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.roughness);
reflectedLight.directDiffuse += irradiance * BRDF_Lambert(material.diffuseColor);
}
void RE_IndirectDiffuse_Physical(const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert(material.diffuseColor);
}
void RE_IndirectSpecular_Physical(const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
#ifdef USE_CLEARCOAT
clearcoatSpecular += clearcoatRadiance * EnvironmentBRDF(geometry.clearcoatNormal, geometry.viewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness);
#endif
vec3 singleScattering = vec3(0.0);
vec3 multiScattering = vec3(0.0);
vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
computeMultiscattering(geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering);
vec3 totalScattering = singleScattering + multiScattering;
vec3 diffuse = material.diffuseColor * (1.0 - max(max(totalScattering.r, totalScattering.g), totalScattering.b));
reflectedLight.indirectSpecular += radiance * singleScattering;
reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct RE_Direct_Physical
#define RE_Direct_RectArea RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular RE_IndirectSpecular_Physical
float computeSpecularOcclusion(const in float dotNV, const in float ambientOcclusion, const in float roughness) {
return saturate(pow(abs(dotNV + ambientOcclusion), exp2(- 16.0 * roughness - 1.0)) - 1.0 + ambientOcclusion);
}`,GH=`
GeometricContext geometry;
geometry.position = -vViewPosition;
geometry.normal = normal;
geometry.viewDir = (isOrthographic) ? vec3(0, 0, 1) : normalize(vViewPosition);
#ifdef USE_CLEARCOAT
geometry.clearcoatNormal = clearcoatNormal;
#endif
#ifdef PROBE_NORMAL
geometry.probeNormal = PROBE_NORMAL;
#else
geometry.probeNormal = normal;
#endif
IncidentLight directLight;
#if (NUM_POINT_LIGHTS > 0) && defined(RE_Direct)
PointLight pointLight;
#if defined(USE_SHADOWMAP) && NUM_POINT_LIGHT_SHADOWS > 0
PointLightShadow pointLightShadow;
#endif
#pragma unroll_loop
for (int i = 0; i < NUM_POINT_LIGHTS; i++) {
pointLight = pointLights[i];
getPointLightInfo(pointLight, geometry, directLight);
#if defined(USE_SHADOWMAP) && ((i) < NUM_POINT_LIGHT_SHADOWS)
pointLightShadow = pointLightShadows[i];
directLight.color *= (directLight.visible && receiveShadow) ? getPointShadow(pointLightShadow, pointShadowMap[i], vPointShadowCoord[i]) : 1.0;
#endif
RE_Direct(directLight, geometry, material, reflectedLight);
}
#endif
#if (NUM_SPOT_LIGHTS > 0) && defined(RE_Direct)
SpotLight spotLight;
#if defined(USE_SHADOWMAP) && NUM_SPOT_LIGHT_SHADOWS > 0
SpotLightShadow spotLightShadow;
#endif
#pragma unroll_loop
for (int i = 0; i < NUM_SPOT_LIGHTS; i++) {
spotLight = spotLights[i];
getSpotLightInfo(spotLight, geometry, directLight);
#if defined(USE_SHADOWMAP) && ((i) < NUM_SPOT_LIGHT_SHADOWS)
spotLightShadow = spotLightShadows[i];
if (directLight.visible && receiveShadow) {
if (spotLightShadow.shadow == 1) {
float distWorld = 0.0;
#if defined(SHADOWMAP_TYPE_ESM)
distWorld = length((invViewMatrix * vec4(spotLight.position
- geometry.position, 0.0)).xyz);
#endif
directLight.color *= getSpotShadow(spotLightShadow, spotShadowMap[i],
vSpotShadowCoord[i], distWorld);
} else if (spotLightShadow.shadow == 2) {
directLight.color *= getSpotOmniShadow(spotLightShadow,
spotShadowMap[i], vSpotShadowCoord[i]);
}
}
#endif
RE_Direct(directLight, geometry, material, reflectedLight);
}
#endif
#if (NUM_DIR_LIGHTS > 0) && defined(RE_Direct)
DirectionalLight directionalLight;
#if defined(USE_SHADOWMAP) && NUM_DIR_LIGHT_SHADOWS_CSM > 0
DirectionalLightShadowCSM directionalLightShadowCSM;
DirectionalLightShadowCascade dirShadowCascade;
vec2 cascade;
float cascadeCenter;
float closestEdge;
float margin;
float csmx, csmy;
float linearDepth;
int maxCascadeIdx;
#pragma unroll_loop
for (int i = 0; i < NUM_DIR_LIGHT_SHADOW_CASCADES_CSM; i++) {
dirShadowCascade = directionalLightShadowsCSMCascade[i];
#if defined(LUT_DIR_LIGHT_SHADOWS_CSM)
directionalLightShadowCSM = directionalLightShadowsCSM[LUT_DIR_LIGHT_SHADOWS_CSM[i]];
directionalLight = directionalLights[LUT_DIR_LIGHT_SHADOWS_CSM[i]];
getDirectionalLightInfo(directionalLight, geometry, directLight);
#else
if (dirShadowCascade.csmIdx == 0) {
directionalLightShadowCSM = directionalLightShadowsCSM[0];
directionalLight = directionalLights[0];
getDirectionalLightInfo(directionalLight, geometry, directLight);
}
#if NUM_DIR_LIGHT_SHADOWS_CSM >= 2
else if (dirShadowCascade.csmIdx == 1) {
directionalLightShadowCSM = directionalLightShadowsCSM[1];
directionalLight = directionalLights[1];
getDirectionalLightInfo(directionalLight, geometry, directLight);
}
#endif
#if NUM_DIR_LIGHT_SHADOWS_CSM >= 3
else if (dirShadowCascade.csmIdx == 2) {
directionalLightShadowCSM = directionalLightShadowsCSM[2];
directionalLight = directionalLights[2];
getDirectionalLightInfo(directionalLight, geometry, directLight);
}
#endif
#if NUM_DIR_LIGHT_SHADOWS_CSM >= 4
else if (dirShadowCascade.csmIdx == 3) {
directionalLightShadowCSM = directionalLightShadowsCSM[3];
directionalLight = directionalLights[3];
getDirectionalLightInfo(directionalLight, geometry, directLight);
}
#endif
#if NUM_DIR_LIGHT_SHADOWS_CSM >= 5
else if (dirShadowCascade.csmIdx == 4) {
directionalLightShadowCSM = directionalLightShadowsCSM[4];
directionalLight = directionalLights[4];
getDirectionalLightInfo(directionalLight, geometry, directLight);
}
#endif
#endif
maxCascadeIdx = directionalLightShadowCSM.cascadeIdxEnd;
linearDepth = (vViewPosition.z) / (directionalLightShadowCSM.shadowFar - directionalLightShadowCSM.cameraNear);
cascade = dirShadowCascade.cascade;
#if (i) < NUM_DIR_LIGHT_SHADOWS_CSM_WITH_FADE
cascadeCenter = (cascade.x + cascade.y) / 2.0;
closestEdge = linearDepth < cascadeCenter ? cascade.x : cascade.y;
margin = directionalLightShadowCSM.fade * pow(closestEdge, 2.0);
csmx = cascade.x - margin / 2.0;
csmy = cascade.y + margin / 2.0;
if (linearDepth >= csmx && (linearDepth < csmy || (i) == maxCascadeIdx - 1)) {
float dist = min(linearDepth - csmx, csmy - linearDepth);
float ratio = clamp(dist / margin, 0.0, 1.0);
vec3 prevColor = directLight.color;
float distWorld = 0.0;
#if defined(SHADOWMAP_TYPE_ESM)
distWorld = length((invViewMatrix * vec4(dirShadowCascade.position
- directionalLight.direction * dirShadowCascade.shadowCameraNear
- geometry.position, 0.0)).xyz);
#endif
directLight.color *= (directLight.visible && receiveShadow) ?
getDirShadowCSM(dirShadowCascade, directionalShadowCSMMap[i], vDirectionalShadowCSMCoord[i], distWorld)
: 1.0;
bool shouldFadeLastCascade = (i) == maxCascadeIdx - 1 && linearDepth > cascadeCenter;
directLight.color = mix(prevColor, directLight.color, shouldFadeLastCascade ? ratio : 1.0);
ReflectedLight prevLight = reflectedLight;
RE_Direct(directLight, geometry, material, reflectedLight);
bool shouldBlend = (i) != maxCascadeIdx - 1 || ((i) == maxCascadeIdx - 1 && linearDepth < cascadeCenter);
float blendRatio = shouldBlend ? ratio : 1.0;
reflectedLight.directDiffuse = mix(prevLight.directDiffuse, reflectedLight.directDiffuse, blendRatio);
reflectedLight.directSpecular = mix(prevLight.directSpecular, reflectedLight.directSpecular, blendRatio);
reflectedLight.indirectDiffuse = mix(prevLight.indirectDiffuse, reflectedLight.indirectDiffuse, blendRatio);
reflectedLight.indirectSpecular = mix(prevLight.indirectSpecular, reflectedLight.indirectSpecular, blendRatio);
}
#else
if (linearDepth >= cascade.x && (linearDepth < cascade.y || (i) == maxCascadeIdx - 1)) {
if (directLight.visible && receiveShadow) {
float distWorld = 0.0;
#if defined(SHADOWMAP_TYPE_ESM)
distWorld = length((invViewMatrix * vec4(dirShadowCascade.position
- directionalLight.direction * dirShadowCascade.shadowCameraNear
- geometry.position, 0.0)).xyz);
#endif
directLight.color *= getDirShadowCSM(dirShadowCascade, directionalShadowCSMMap[i], vDirectionalShadowCSMCoord[i], distWorld);
}
RE_Direct(directLight, geometry, material, reflectedLight);
}
#endif
}
#endif
#pragma unroll_loop
for (int i = NUM_DIR_LIGHT_SHADOWS_CSM; i < NUM_DIR_LIGHTS; i++) {
directionalLight = directionalLights[i];
getDirectionalLightInfo(directionalLight, geometry, directLight);
RE_Direct(directLight, geometry, material, reflectedLight);
}
#endif
#if (NUM_RECT_AREA_LIGHTS > 0) && defined(RE_Direct_RectArea)
RectAreaLight rectAreaLight;
#if defined(USE_SHADOWMAP) && NUM_RECT_AREA_LIGHT_SHADOWS > 0
RectAreaLightShadow rectAreaLightShadow;
#endif
#pragma unroll_loop
for (int i = 0; i < NUM_RECT_AREA_LIGHTS; i++) {
rectAreaLight = rectAreaLights[i];
#if defined(USE_SHADOWMAP) && ((i) < NUM_RECT_AREA_LIGHT_SHADOWS)
rectAreaLightShadow = rectAreaLightShadows[i];
rectAreaLight.color *= receiveShadow ?
getRectAreaShadow(rectAreaLightShadow, rectAreaShadowMap[i], vRectAreaShadowCoord[i]) : 1.0;
#endif
RE_Direct_RectArea(rectAreaLight, geometry, material, reflectedLight);
}
#endif
#if defined(RE_IndirectDiffuse)
vec3 iblIrradiance = vec3(0.0);
vec3 irradiance = getAmbientLightIrradiance(ambientLightColor);
irradiance += getLightProbeIrradiance(lightProbe, geometry.probeNormal);
#if (NUM_HEMI_LIGHTS > 0)
#pragma unroll_loop
for (int i = 0; i < NUM_HEMI_LIGHTS; i++) {
irradiance += getHemisphereLightIrradiance(hemisphereLights[i], geometry.probeNormal);
}
#endif
#endif
#if defined(RE_IndirectSpecular)
vec3 radiance = vec3(0.0);
vec3 clearcoatRadiance = vec3(0.0);
#endif
#if defined(RE_Refraction)
vec3 refraction = vec3(0.0);
#endif`,QH=`#if defined(RE_IndirectDiffuse)
#ifdef USE_LIGHTMAP
vec4 lightMapTexel = texture2D(lightMap, vUv2);
vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
irradiance += lightMapIrradiance;
#endif
#if defined(USE_ENVMAP) && (defined(STANDARD) || defined(NODE)) && defined(ENVMAP_TYPE_CUBE_UV)
iblIrradiance += getIBLIrradiance(geometry.probeNormal);
#endif
#endif
#if defined(USE_ENVMAP) && defined(RE_IndirectSpecular)
radiance += getIBLRadiance(geometry.viewDir, geometry.normal, material.roughness, geometry.position);
#if defined(USE_SSR) && !defined(USE_SSR_REFRACT)
radiance = computeSSR(radiance, geometry.normal, 0.0);
#endif
#if defined(USE_PLANE_REFLECTION)
radiance = computePlaneReflection(radiance, material.roughness, geometry.position, geometry.normal, modelMatrix);
#endif
#ifdef USE_CLEARCOAT
clearcoatRadiance += getIBLRadiance(geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness, geometry.position);
#endif
#endif
#if defined(USE_ENVMAP) && defined(RE_Refraction)
refraction += getIBLRefraction(geometry.viewDir, geometry.normal, material.refractionRoughness, 1.0 / material.refractionIOR, geometry.position);
#ifdef USE_SSR_REFRACT
refraction = computeSSR(refraction, geometry.normal, material.refractionIOR);
#endif
#endif`,HH=`#if defined(RE_IndirectDiffuse)
#ifdef NODE
irradiance += iblIrradiance;
#endif
RE_IndirectDiffuse(irradiance, geometry, material, reflectedLight);
#endif
#if defined(RE_IndirectSpecular)
RE_IndirectSpecular(radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight);
#endif
#if defined(RE_Refraction)
RE_Refraction(refraction, material, refractedLight);
#endif`,WH=`#if defined(USE_LOGDEPTHBUF) && defined(USE_LOGDEPTHBUF_EXT)
gl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2(vFragDepth) * logDepthBufFC * 0.5;
#endif`,YH=`#if defined(USE_LOGDEPTHBUF) && defined(USE_LOGDEPTHBUF_EXT)
uniform float logDepthBufFC;
varying float vFragDepth;
varying float vIsPerspective;
#endif`,jH=`#ifdef USE_LOGDEPTHBUF
#ifdef USE_LOGDEPTHBUF_EXT
varying float vFragDepth;
varying float vIsPerspective;
#else
uniform float logDepthBufFC;
#endif
#endif`,XH=`#ifdef USE_LOGDEPTHBUF
#ifdef USE_LOGDEPTHBUF_EXT
vFragDepth = 1.0 + gl_Position.w;
vIsPerspective = float(isPerspectiveMatrix(projectionMatrix));
#else
if (isPerspectiveMatrix(projectionMatrix)) {
gl_Position.z = log2(max(EPSILON, gl_Position.w + 1.0)) * logDepthBufFC - 1.0;
gl_Position.z *= gl_Position.w;
}
#endif
#endif`,qH=`#ifdef USE_MAP
vec4 sampledDiffuseColor = texture2D(map, vUv);
#ifdef DECODE_VIDEO_TEXTURE
sampledDiffuseColor = vec4(mix(pow(sampledDiffuseColor.rgb * 0.9478672986 + vec3(0.0521327014), vec3(2.4)), sampledDiffuseColor.rgb * 0.0773993808, vec3(lessThanEqual(sampledDiffuseColor.rgb, vec3(0.04045)))), sampledDiffuseColor.w);
#endif
diffuseColor *= sampledDiffuseColor;
#endif`,ZH=`#ifdef USE_MAP
uniform sampler2D map;
#endif`,KH=`#if defined(USE_MAP) || defined(USE_ALPHAMAP)
vec2 uv = (uvTransform * vec3(gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1)).xy;
#endif
#ifdef USE_MAP
diffuseColor *= texture2D(map, uv);
#endif
#ifdef USE_ALPHAMAP
diffuseColor.a *= texture2D(alphaMap, uv).g;
#endif`,$H=`#if defined(USE_MAP) || defined(USE_ALPHAMAP)
uniform mat3 uvTransform;
#endif
#ifdef USE_MAP
uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
uniform sampler2D alphaMap;
#endif`,JH=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
vec4 texelMetalness = texture2D(metalnessMap, vUv);
metalnessFactor *= texelMetalness.b;
#endif`,eW=`#ifdef USE_METALNESSMAP
uniform sampler2D metalnessMap;
#endif`,tW=`#if defined(USE_MORPHCOLORS) && defined(MORPHTARGETS_TEXTURE)
vColor *= morphTargetBaseInfluence;
for (int i = 0; i < MORPHTARGETS_COUNT; i++) {
#if defined(USE_COLOR_ALPHA)
if (morphTargetInfluences[i] != 0.0) vColor += getMorph(gl_VertexID, i, 2) * morphTargetInfluences[i];
#elif defined(USE_COLOR)
if (morphTargetInfluences[i] != 0.0) vColor += getMorph(gl_VertexID, i, 2).rgb * morphTargetInfluences[i];
#endif
}
#endif`,nW=`#ifdef USE_MORPHNORMALS
objectNormal *= morphTargetBaseInfluence;
#ifdef MORPHTARGETS_TEXTURE
for (int i = 0; i < MORPHTARGETS_COUNT; i++) {
if (morphTargetInfluences[i] != 0.0) objectNormal += getMorph(gl_VertexID, i, 1).xyz * morphTargetInfluences[i];
}
#else
#if MORPHTARGETS_COUNT > 0
objectNormal += morphNormal0 * morphTargetInfluences[0];
#endif
#if MORPHTARGETS_COUNT > 1
objectNormal += morphNormal1 * morphTargetInfluences[1];
#endif
#if MORPHTARGETS_COUNT > 2
objectNormal += morphNormal2 * morphTargetInfluences[2];
#endif
#if MORPHTARGETS_COUNT > 3
objectNormal += morphNormal3 * morphTargetInfluences[3];
#endif
#if MORPHTARGETS_COUNT > 4
objectNormal += morphNormal4 * morphTargetInfluences[4];
#endif
#if MORPHTARGETS_COUNT > 5
objectNormal += morphNormal5 * morphTargetInfluences[5];
#endif
#endif
#endif`,rW=`#ifdef USE_MORPHTARGETS
uniform float morphTargetBaseInfluence;
#ifdef MORPHTARGETS_TEXTURE
uniform float morphTargetInfluences[MORPHTARGETS_COUNT];
uniform sampler2DArray morphTargetsTexture;
uniform ivec2 morphTargetsTextureSize;
vec4 getMorph(const in int vertexIndex, const in int morphTargetIndex, const in int offset) {
int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
int y = texelIndex / morphTargetsTextureSize.x;
int x = texelIndex - y * morphTargetsTextureSize.x;
ivec3 morphUV = ivec3(x, y, morphTargetIndex);
return texelFetch(morphTargetsTexture, morphUV, 0);
}
#else
#ifndef USE_MORPHNORMALS
uniform float morphTargetInfluences[12];
#else
uniform float morphTargetInfluences[6];
#endif
#endif
#endif`,oW=`#ifdef USE_MORPHTARGETS
transformed *= morphTargetBaseInfluence;
#ifdef MORPHTARGETS_TEXTURE
for (int i = 0; i < MORPHTARGETS_COUNT; i++) {
if (morphTargetInfluences[i] != 0.0) transformed += getMorph(gl_VertexID, i, 0).xyz * morphTargetInfluences[i];
}
#else
#if MORPHTARGETS_COUNT > 0
transformed += morphTarget0 * morphTargetInfluences[0];
#endif
#if MORPHTARGETS_COUNT > 1
transformed += morphTarget1 * morphTargetInfluences[1];
#endif
#if MORPHTARGETS_COUNT > 2
transformed += morphTarget2 * morphTargetInfluences[2];
#endif
#if MORPHTARGETS_COUNT > 3
transformed += morphTarget3 * morphTargetInfluences[3];
#endif
#if MORPHTARGETS_COUNT > 4
transformed += morphTarget4 * morphTargetInfluences[4];
#endif
#if MORPHTARGETS_COUNT > 5
transformed += morphTarget5 * morphTargetInfluences[5];
#endif
#ifndef USE_MORPHNORMALS
#if MORPHTARGETS_COUNT > 6
transformed += morphTarget6 * morphTargetInfluences[6];
#endif
#if MORPHTARGETS_COUNT > 7
transformed += morphTarget7 * morphTargetInfluences[7];
#endif
#if MORPHTARGETS_COUNT > 8
transformed += morphTarget8 * morphTargetInfluences[8];
#endif
#if MORPHTARGETS_COUNT > 9
transformed += morphTarget9 * morphTargetInfluences[9];
#endif
#if MORPHTARGETS_COUNT > 10
transformed += morphTarget10 * morphTargetInfluences[10];
#endif
#if MORPHTARGETS_COUNT > 11
transformed += morphTarget1 * morphTargetInfluences[11];
#endif
#endif
#endif
#endif`,aW=`float faceDirection = gl_FrontFacing ? 1.0 : -1.0;
#ifdef FLAT_SHADED
vec3 fdx = dFdx(vViewPosition);
vec3 fdy = dFdy(vViewPosition);
vec3 normal = normalize(cross(fdx, fdy));
#else
vec3 normal = normalize(vNormal);
#ifdef DOUBLE_SIDED
normal = normal * faceDirection;
#endif
#ifdef USE_TANGENT
vec3 tangent = normalize(vTangent);
vec3 bitangent = normalize(vBitangent);
#ifdef DOUBLE_SIDED
tangent = tangent * faceDirection;
bitangent = bitangent * faceDirection;
#endif
#if defined(TANGENTSPACE_NORMALMAP) || defined(USE_CLEARCOAT_NORMALMAP)
mat3 vTBN = mat3(tangent, bitangent, normal);
#endif
#endif
#endif
vec3 geometryNormal = normal;`,iW=`#ifdef OBJECTSPACE_NORMALMAP
normal = texture2D(normalMap, vUv).xyz * 2.0 - 1.0;
#ifdef FLIP_SIDED
normal = -normal;
#endif
#ifdef DOUBLE_SIDED
normal = normal * faceDirection;
#endif
normal = normalize(normalMatrix * normal);
#elif defined(TANGENTSPACE_NORMALMAP)
vec3 mapN = texture2D(normalMap, vUv).xyz * 2.0 - 1.0;
mapN.xy *= normalScale;
#ifdef USE_TANGENT
normal = normalize(vTBN * mapN);
#else
normal = perturbNormal2Arb(-vViewPosition, normal, mapN, faceDirection);
#endif
#elif defined(USE_BUMPMAP)
normal = perturbNormalArb(-vViewPosition, normal, dHdxy_fwd(), faceDirection);
#endif`,sW=`#ifndef FLAT_SHADED
varying vec3 vNormal;
#ifdef USE_TANGENT
varying vec3 vTangent;
varying vec3 vBitangent;
#endif
#endif`,lW=`#ifndef FLAT_SHADED
varying vec3 vNormal;
#ifdef USE_TANGENT
varying vec3 vTangent;
varying vec3 vBitangent;
#endif
#endif`,cW=`#ifndef FLAT_SHADED
vNormal = normalize(transformedNormal);
#ifdef USE_TANGENT
vTangent = normalize(transformedTangent);
vBitangent = normalize(cross(vNormal, vTangent) * tangent.w);
#endif
#endif`,uW=`#ifdef USE_NORMALMAP
uniform sampler2D normalMap;
uniform vec2 normalScale;
#endif
#ifdef OBJECTSPACE_NORMALMAP
uniform mat3 normalMatrix;
#endif
#if !defined (USE_TANGENT) && (defined (TANGENTSPACE_NORMALMAP) || defined (USE_CLEARCOAT_NORMALMAP))
vec3 perturbNormal2Arb(vec3 eye_pos, vec3 surf_norm, vec3 mapN, float faceDirection) {
vec3 q0 = dFdx(eye_pos.xyz);
vec3 q1 = dFdy(eye_pos.xyz);
vec2 st0 = dFdx(vUv.st);
vec2 st1 = dFdy(vUv.st);
vec3 N = surf_norm;
vec3 q1perp = cross(q1, N);
vec3 q0perp = cross(N, q0);
vec3 T = q1perp * st0.x + q0perp * st1.x;
vec3 B = q1perp * st0.y + q0perp * st1.y;
float det = max(dot(T, T), dot(B, B));
float scale = (det == 0.0) ? 0.0 : faceDirection * inversesqrt(det);
return normalize(T * (mapN.x * scale) + B * (mapN.y * scale) + N * mapN.z);
}
#endif`,dW=`#ifdef USE_CLEARCOAT
vec3 clearcoatNormal = geometryNormal;
#endif`,fW=`#ifdef USE_CLEARCOAT_NORMALMAP
vec3 clearcoatMapN = texture2D(clearcoatNormalMap, vUv).xyz * 2.0 - 1.0;
clearcoatMapN.xy *= clearcoatNormalScale;
#ifdef USE_TANGENT
clearcoatNormal = normalize(vTBN * clearcoatMapN);
#else
clearcoatNormal = perturbNormal2Arb(-vViewPosition, clearcoatNormal, clearcoatMapN, faceDirection);
#endif
#endif`,hW=`#ifdef USE_CLEARCOATMAP
uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
uniform sampler2D clearcoatRoughnessMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
uniform sampler2D clearcoatNormalMap;
uniform vec2 clearcoatNormalScale;
#endif`,pW=`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= material.transmissionAlpha + 0.1;
#endif
gl_FragColor = vec4(outgoingLight, diffuseColor.a);`,mW=`vec3 packNormalToRGB(const in vec3 normal) {
return normalize(normal) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal(const in vec3 rgb) {
return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;
const float UnpackDownscale = 255. / 256.;
const vec3 PackFactors = vec3(256. * 256. * 256., 256. * 256., 256.);
const vec4 UnpackFactors = UnpackDownscale / vec4(PackFactors, 1.);
const float ShiftRight8 = 1. / 256.;
vec4 packDepthToRGBA(const in float v) {
vec4 r = vec4(fract(v * PackFactors), v);
r.yzw -= r.xyz * ShiftRight8;
return r * PackUpscale;
}
float unpackRGBAToDepth(const in vec4 v) {
return dot(v, UnpackFactors);
}
vec2 packDepthToRG(in highp float v) {
return packDepthToRGBA(v).yx;
}
float unpackRGToDepth(const in highp vec2 v) {
return unpackRGBAToDepth(vec4(v.xy, 0.0, 0.0));
}
vec4 pack2HalfToRGBA(vec2 v) {
vec4 r = vec4(v.x, fract(v.x * 255.0), v.y, fract(v.y * 255.0));
return vec4(r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w);
}
vec2 unpackRGBATo2Half(vec4 v) {
return vec2(v.x + (v.y / 255.0), v.z + (v.w / 255.0));
}
float viewZToOrthographicDepth(const in float viewZ, const in float near, const in float far) {
return (viewZ + near) / (near - far);
}
float orthographicDepthToViewZ(const in float linearClipZ, const in float near, const in float far) {
return linearClipZ * (near - far) - near;
}
float viewZToPerspectiveDepth(const in float viewZ, const in float near, const in float far) {
return ((near + viewZ) * far) / ((far - near) * viewZ);
}
float perspectiveDepthToViewZ(const in float invClipZ, const in float near, const in float far) {
return (near * far) / ((far - near) * invClipZ - far);
}`,gW=`#ifdef PREMULTIPLIED_ALPHA
gl_FragColor.rgb *= gl_FragColor.a;
#endif`,vW=`vec4 mvPosition = vec4(transformed, 1.0);
#ifdef USE_INSTANCING
mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;
#if defined(BACKGROUND_DEPTH)
gl_Position.z = gl_Position.w;
#endif`,_W=`#ifdef DITHERING
gl_FragColor.rgb = dithering(gl_FragColor.rgb);
#endif`,AW=`#ifdef DITHERING
vec3 dithering(vec3 color) {
float grid_position = rand(gl_FragCoord.xy);
vec3 dither_shift_RGB = vec3(0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0);
dither_shift_RGB = mix(2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position);
return color + dither_shift_RGB;
}
#endif`,xW=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
vec4 texelRoughness = texture2D(roughnessMap, vUv);
roughnessFactor *= texelRoughness.g;
#endif`,yW=`#ifdef USE_ROUGHNESSMAP
uniform sampler2D roughnessMap;
#endif`,bW=`
#define BIAS_FRUSTUM_SCALE_COEFF 30.0
#define ESM_SPOT_SINGLE_BLUR_COEFF 0.25
#define PCF_POISSON_SPOT_OMNI_BLUR_COEFF 4.0
#define PCF_POISSON_POINT_BLUR_COEFF 2.5
#define ESM_BIAS_COEFF 100.0
#ifndef ESM_DISTANCE_SCALE
#define ESM_DISTANCE_SCALE 1.0
#endif
#ifdef USE_SHADOWMAP
#if NUM_SPOT_LIGHT_SHADOWS > 0
uniform sampler2D spotShadowMap[NUM_SPOT_LIGHT_SHADOWS];
varying vec4 vSpotShadowCoord[NUM_SPOT_LIGHT_SHADOWS];
struct SpotLightShadow {
float shadowBias;
float shadowNormalBias;
float shadowRadius;
vec2 shadowMapSize;
int shadow;
float shadowCameraNear;
float shadowCameraFar;
float expBias;
};
uniform SpotLightShadow spotLightShadows[NUM_SPOT_LIGHT_SHADOWS];
#endif
#if NUM_POINT_LIGHT_SHADOWS > 0
uniform sampler2D pointShadowMap[NUM_POINT_LIGHT_SHADOWS];
varying vec4 vPointShadowCoord[NUM_POINT_LIGHT_SHADOWS];
struct PointLightShadow {
float shadowBias;
float shadowNormalBias;
float shadowRadius;
vec2 shadowMapSize;
float shadowCameraNear;
float shadowCameraFar;
float expBias;
};
uniform PointLightShadow pointLightShadows[NUM_POINT_LIGHT_SHADOWS];
#endif
#if NUM_RECT_AREA_LIGHT_SHADOWS > 0
uniform sampler2D rectAreaShadowMap[NUM_RECT_AREA_LIGHT_SHADOWS];
varying vec4 vRectAreaShadowCoord[NUM_RECT_AREA_LIGHT_SHADOWS];
struct RectAreaLightShadow {
float shadowBias;
float shadowNormalBias;
float shadowRadius;
vec2 shadowMapSize;
float shadowCameraNear;
float shadowCameraFar;
float expBias;
};
uniform RectAreaLightShadow rectAreaLightShadows[NUM_RECT_AREA_LIGHT_SHADOWS];
#endif
#if NUM_DIR_LIGHT_SHADOWS_CSM > 0
uniform sampler2D directionalShadowCSMMap[NUM_DIR_LIGHT_SHADOW_CASCADES_CSM];
varying vec4 vDirectionalShadowCSMCoord[NUM_DIR_LIGHT_SHADOW_CASCADES_CSM];
struct DirectionalLightShadowCascade {
float shadowBias;
float shadowNormalBias;
float shadowRadius;
vec2 shadowMapSize;
float shadowCameraNear;
float shadowCameraFar;
vec2 cascade;
float expBias;
vec3 position;
int csmIdx;
};
struct DirectionalLightShadowCSM {
int cascadeIdxEnd;
float cameraNear;
float shadowFar;
float fade;
};
uniform DirectionalLightShadowCSM directionalLightShadowsCSM[NUM_DIR_LIGHT_SHADOWS_CSM];
uniform DirectionalLightShadowCascade directionalLightShadowsCSMCascade[NUM_DIR_LIGHT_SHADOW_CASCADES_CSM];
#endif
const vec3 PERMUTE_DIR_X = vec3(1.0, 0.0, 0.0);
const vec3 PERMUTE_DIR_Y = vec3(0.0, 1.0, 0.0);
const vec3 PERMUTE_DIR_Z = vec3(0.0, 0.0, 1.0);
const mat4 POISSON_DISK_0 = mat4(
0.954845, 0.242214, -0.623893, -0.235473,
-0.173288, 0.799228, 0.605969, -0.548050,
-0.560406, 0.327647, -0.448307, -0.774344,
0.308258, 0.417332, -0.125623, -0.056098
);
const mat4 POISSON_DISK_1 = mat4(
0.145585, -0.305634, 0.264060, -0.661648,
0.617942, 0.652121, -0.041412, -0.893582,
0.463911, 0.039752, 0.212664, 0.810727,
-0.955989, -0.014390, -0.652588, 0.671204
);
float texture2DCompare(sampler2D depths, vec2 uv, float compare) {
return step(compare, unpackRGBAToDepth(texture2D(depths, uv)));
}
float texture2DShadowLerp(sampler2D depths, vec2 size, vec2 uv, float compare) {
const vec2 offset = vec2(0.0, 1.0);
vec2 texelSize = vec2(1.0) / size;
vec2 centroidUV = floor(uv * size + 0.5) / size;
float lb = texture2DCompare(depths, centroidUV + texelSize * offset.xx, compare);
float lt = texture2DCompare(depths, centroidUV + texelSize * offset.xy, compare);
float rb = texture2DCompare(depths, centroidUV + texelSize * offset.yx, compare);
float rt = texture2DCompare(depths, centroidUV + texelSize * offset.yy, compare);
vec2 f = fract(uv * size + 0.5);
float a = mix(lb, lt, f.y);
float b = mix(rb, rt, f.y);
float c = mix(a, b, f.x);
return c;
}
vec2 cubeToUV(vec3 v, float texelSizeY) {
vec3 absV = abs(v);
float scaleToCube = 1.0 / max(absV.x, max(absV.y, absV.z));
absV *= scaleToCube;
v *= scaleToCube * (1.0 - 2.0 * texelSizeY);
vec2 planar = v.xy;
float almostATexel = 1.5 * texelSizeY;
float almostOne = 1.0 - almostATexel;
if (absV.z >= almostOne) {
if (v.z > 0.0)
planar.x = 4.0 - v.x;
} else if (absV.x >= almostOne) {
float signX = sign(v.x);
planar.x = v.z * signX + 2.0 * signX;
} else if (absV.y >= almostOne) {
float signY = sign(v.y);
planar.x = v.x + 2.0 * signY + 2.0;
planar.y = v.z * signY - 2.0;
}
return vec2(0.125, 0.25) * planar + vec2(0.375, 0.75);
}
float texture2DShadowAvgCube(sampler2D depths, vec2 size, vec3 bd3D, float compare) {
vec2 texelSize = vec2(1.0) / size;
vec3 dirX = normalize(abs(bd3D.y) < 0.99999 ? vec3(bd3D.z, 0.0, -bd3D.x)
: vec3(0.0, -bd3D.z, bd3D.y));
vec3 dirY = cross(bd3D, dirX);
float theta = PI_HALF * texelSize.y;
vec3 sX = sin(theta) * dirX;
vec3 sY = sin(theta) * dirY;
float cosT = cos(theta);
vec3 sampleVec[4];
sampleVec[0] = bd3D;
sampleVec[1] = bd3D * cosT + sY;
sampleVec[2] = bd3D * cosT + sX;
sampleVec[3] = sampleVec[2] * cosT + sY;
float avg = 0.0;
for (int i = 0; i < 4; i++) {
avg += texture2DCompare(depths, cubeToUV(sampleVec[i], texelSize.y), compare);
}
avg /= 4.0;
return avg;
}
float getShadow(sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord,
float expBias, float distWorld) {
float shadow = 1.0;
shadowCoord.xyz /= shadowCoord.w;
bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;
bool frustumTest = inFrustum && shadowCoord.z <= 1.0 && shadowCoord.z >= 0.0;
if (frustumTest) {
#if defined(SHADOWMAP_TYPE_BILINEAR)
shadowCoord.z += shadowBias;
shadow = texture2DShadowLerp(shadowMap, shadowMapSize, shadowCoord.xy, shadowCoord.z);
#elif defined(SHADOWMAP_TYPE_PCF)
shadowCoord.z += shadowBias;
vec2 texelSize = vec2(1.0) / shadowMapSize;
float randAngle = rand(gl_FragCoord.xy) * PI2;
float c = cos(randAngle), s = sin(randAngle);
mat2 sampleMat = mat2(c, s, -s, c)
* mat2(shadowRadius * texelSize.x, 0.0, 0.0, shadowRadius * texelSize.y);
vec2 sampleVec[16];
sampleVec[0] = POISSON_DISK_0[0].xy;
sampleVec[1] = POISSON_DISK_0[0].zw;
sampleVec[2] = POISSON_DISK_0[1].xy;
sampleVec[3] = POISSON_DISK_0[1].zw;
sampleVec[4] = POISSON_DISK_0[2].xy;
sampleVec[5] = POISSON_DISK_0[2].zw;
sampleVec[6] = POISSON_DISK_0[3].xy;
sampleVec[7] = POISSON_DISK_0[3].zw;
sampleVec[8] = POISSON_DISK_1[0].xy;
sampleVec[9] = POISSON_DISK_1[0].zw;
sampleVec[10] = POISSON_DISK_1[1].xy;
sampleVec[11] = POISSON_DISK_1[1].zw;
sampleVec[12] = POISSON_DISK_1[2].xy;
sampleVec[13] = POISSON_DISK_1[2].zw;
sampleVec[14] = POISSON_DISK_1[3].xy;
sampleVec[15] = POISSON_DISK_1[3].zw;
shadow = 0.0;
for (int i = 0; i < 16; i++) {
shadow += texture2DCompare(shadowMap, shadowCoord.xy
+ sampleMat * sampleVec[i], shadowCoord.z);
}
shadow /= 16.0;
#elif defined(SHADOWMAP_TYPE_ESM)
shadow = saturate(exp(expBias * (texture2D(shadowMap, shadowCoord.xy).x
- length(distWorld) * ESM_DISTANCE_SCALE
- ESM_BIAS_COEFF * shadowBias)));
#else
shadowCoord.z += shadowBias;
shadow = texture2DCompare(shadowMap, shadowCoord.xy, shadowCoord.z);
#endif
}
return shadow;
}
float getOmniShadow(sampler2D shadowMap, vec2 shadowMapSize, float shadowBias,
float expBias, float shadowRadius, vec4 shadowCoord,
float shadowCameraNear, float shadowCameraFar) {
float shadow = 1.0;
vec3 lightToPosition = shadowCoord.xyz;
float dp = (length(lightToPosition) - shadowCameraNear)
/ (shadowCameraFar - shadowCameraNear);
bool frustumTest = dp <= 1.0 && dp >= 0.0;
if (frustumTest) {
float biasScaleCoeff = BIAS_FRUSTUM_SCALE_COEFF
/ (shadowCameraFar - shadowCameraNear);
dp += shadowBias * biasScaleCoeff;
vec3 bd3D = normalize(lightToPosition);
vec2 texelSize = 1.0 / shadowMapSize;
#if defined(SHADOWMAP_TYPE_BILINEAR)
shadow = texture2DShadowAvgCube(shadowMap, shadowMapSize, bd3D, dp);
#elif defined(SHADOWMAP_TYPE_ESM)
shadow = saturate(exp(expBias * (texture2D(shadowMap,
cubeVecToOctUV(bd3D, texelSize)).x
- length(lightToPosition) * ESM_DISTANCE_SCALE
- ESM_BIAS_COEFF * shadowBias)));
#elif defined(SHADOWMAP_TYPE_PCF)
float randAngle = rand(gl_FragCoord.xy) * PI2;
float c = cos(randAngle), s = sin(randAngle);
mat2 sampleMat = mat2(c, s, -s, c)
* mat2(shadowRadius * texelSize.y, 0.0, 0.0, shadowRadius * texelSize.y);
vec3 absBd3D = abs(bd3D);
absBd3D /= max(absBd3D.x, max(absBd3D.y, absBd3D.z));
bvec2 isPointingCubeFace = greaterThan(absBd3D.xy, vec2(0.999));
mat3 permuteMat = mat3(
isPointingCubeFace.x ? PERMUTE_DIR_Y : PERMUTE_DIR_X,
isPointingCubeFace.x || isPointingCubeFace.y ? PERMUTE_DIR_Z : PERMUTE_DIR_Y,
isPointingCubeFace.x ? PERMUTE_DIR_X : isPointingCubeFace.y ? PERMUTE_DIR_Y : PERMUTE_DIR_Z
);
vec2 sampleVec[16];
sampleVec[0] = POISSON_DISK_0[0].xy;
sampleVec[1] = POISSON_DISK_0[0].zw;
sampleVec[2] = POISSON_DISK_0[1].xy;
sampleVec[3] = POISSON_DISK_0[1].zw;
sampleVec[4] = POISSON_DISK_0[2].xy;
sampleVec[5] = POISSON_DISK_0[2].zw;
sampleVec[6] = POISSON_DISK_0[3].xy;
sampleVec[7] = POISSON_DISK_0[3].zw;
sampleVec[8] = POISSON_DISK_1[0].xy;
sampleVec[9] = POISSON_DISK_1[0].zw;
sampleVec[10] = POISSON_DISK_1[1].xy;
sampleVec[11] = POISSON_DISK_1[1].zw;
sampleVec[12] = POISSON_DISK_1[2].xy;
sampleVec[13] = POISSON_DISK_1[2].zw;
sampleVec[14] = POISSON_DISK_1[3].xy;
sampleVec[15] = POISSON_DISK_1[3].zw;
shadow = 0.0;
for (int i = 0; i < 16; i++) {
shadow += texture2DCompare(shadowMap, cubeToUV(bd3D + permuteMat * vec3(sampleMat * sampleVec[i], 0.0), texelSize.y), dp);
}
shadow /= 16.0;
#else
shadow = texture2DCompare(shadowMap, cubeToUV(bd3D, texelSize.y), dp);
#endif
}
return shadow;
}
#if NUM_POINT_LIGHT_SHADOWS > 0
float getPointShadow(PointLightShadow light, sampler2D shadowMap, vec4 shadowCoord) {
float shadowRadius = light.shadowRadius;
vec2 mapSize = light.shadowMapSize;
#if defined(SHADOWMAP_TYPE_ESM)
mapSize *= 2.0;
#else
mapSize *= vec2(4.0, 2.0);
#if defined(SHADOWMAP_TYPE_PCF)
shadowRadius *= PCF_POISSON_POINT_BLUR_COEFF;
#endif
#endif
return getOmniShadow(shadowMap, mapSize, light.shadowBias, light.expBias,
shadowRadius, shadowCoord, light.shadowCameraNear,
light.shadowCameraFar);
}
#endif
#if NUM_RECT_AREA_LIGHT_SHADOWS > 0
float getRectAreaShadow(RectAreaLightShadow light, sampler2D shadowMap, vec4 shadowCoord) {
float shadowRadius = light.shadowRadius;
vec2 mapSize = light.shadowMapSize;
#if defined(SHADOWMAP_TYPE_ESM)
mapSize *= 2.0;
#else
mapSize *= vec2(4.0, 2.0);
#if defined(SHADOWMAP_TYPE_PCF)
shadowRadius *= PCF_POISSON_POINT_BLUR_COEFF;
#endif
#endif
return getOmniShadow(shadowMap, mapSize, light.shadowBias, light.expBias,
shadowRadius, shadowCoord, light.shadowCameraNear,
light.shadowCameraFar);
}
#endif
#if NUM_SPOT_LIGHT_SHADOWS > 0
float getSpotOmniShadow(SpotLightShadow light, sampler2D shadowMap, vec4 shadowCoord) {
float shadowRadius = light.shadowRadius;
vec2 mapSize = light.shadowMapSize;
#if defined(SHADOWMAP_TYPE_ESM)
#else
mapSize *= vec2(4.0, 2.0);
#if defined(SHADOWMAP_TYPE_PCF)
shadowRadius *= PCF_POISSON_SPOT_OMNI_BLUR_COEFF;
#endif
#endif
return getOmniShadow(shadowMap, mapSize, light.shadowBias, light.expBias,
shadowRadius, shadowCoord, light.shadowCameraNear,
light.shadowCameraFar);
}
float biasLinearNormalizedToNonlinear(float bias, float near, float far,
float projZ, float projW) {
return (bias * (far + near) + 2.0 * projZ) / (bias * (far - near) + 2.0 * projW)
- projZ / projW;
}
float getSpotShadow(SpotLightShadow light, sampler2D shadowMap, vec4 shadowCoord,
float distWorld) {
float shadowRadius = light.shadowRadius;
float shadowBias = light.shadowBias;
#if defined(SHADOWMAP_TYPE_ESM)
shadowRadius *= ESM_SPOT_SINGLE_BLUR_COEFF;
#endif
shadowBias *= BIAS_FRUSTUM_SCALE_COEFF
/ (light.shadowCameraFar - light.shadowCameraNear);
#if defined(SHADOWMAP_TYPE_BASIC) || defined(SHADOWMAP_TYPE_BILINEAR) || defined(SHADOWMAP_TYPE_PCF)
shadowBias = biasLinearNormalizedToNonlinear(shadowBias,
light.shadowCameraNear, light.shadowCameraFar, shadowCoord.z,
shadowCoord.w);
#endif
return getShadow(shadowMap, light.shadowMapSize, shadowBias, shadowRadius, shadowCoord,
light.expBias, distWorld);
}
#endif
#if NUM_DIR_LIGHT_SHADOWS_CSM > 0
float getDirShadowCSM(DirectionalLightShadowCascade light, sampler2D shadowMap,
vec4 shadowCoord, float distWorld) {
return getShadow(shadowMap, light.shadowMapSize, light.shadowBias, light.shadowRadius, shadowCoord,
light.expBias, distWorld);
}
#endif
#endif`,SW=`#ifdef USE_SHADOWMAP
#if NUM_SPOT_LIGHT_SHADOWS > 0
uniform mat4 spotShadowMatrix[NUM_SPOT_LIGHT_SHADOWS];
varying vec4 vSpotShadowCoord[NUM_SPOT_LIGHT_SHADOWS];
struct SpotLightShadow {
float shadowBias;
float shadowNormalBias;
float shadowRadius;
vec2 shadowMapSize;
int shadow;
float shadowCameraNear;
float shadowCameraFar;
float expBias;
};
uniform SpotLightShadow spotLightShadows[NUM_SPOT_LIGHT_SHADOWS];
#endif
#if NUM_POINT_LIGHT_SHADOWS > 0
uniform mat4 pointShadowMatrix[NUM_POINT_LIGHT_SHADOWS];
varying vec4 vPointShadowCoord[NUM_POINT_LIGHT_SHADOWS];
struct PointLightShadow {
float shadowBias;
float shadowNormalBias;
float shadowRadius;
vec2 shadowMapSize;
float shadowCameraNear;
float shadowCameraFar;
float expBias;
};
uniform PointLightShadow pointLightShadows[NUM_POINT_LIGHT_SHADOWS];
#endif
#if NUM_RECT_AREA_LIGHT_SHADOWS > 0
uniform mat4 rectAreaShadowMatrix[NUM_RECT_AREA_LIGHT_SHADOWS];
varying vec4 vRectAreaShadowCoord[NUM_RECT_AREA_LIGHT_SHADOWS];
struct RectAreaLightShadow {
float shadowBias;
float shadowNormalBias;
float shadowRadius;
vec2 shadowMapSize;
float shadowCameraNear;
float shadowCameraFar;
float expBias;
};
uniform RectAreaLightShadow rectAreaLightShadows[NUM_RECT_AREA_LIGHT_SHADOWS];
#endif
#if NUM_DIR_LIGHT_SHADOWS_CSM > 0
uniform mat4 directionalShadowCSMMatrix[NUM_DIR_LIGHT_SHADOW_CASCADES_CSM];
varying vec4 vDirectionalShadowCSMCoord[NUM_DIR_LIGHT_SHADOW_CASCADES_CSM];
struct DirectionalLightShadowCascade {
float shadowBias;
float shadowNormalBias;
float shadowRadius;
vec2 shadowMapSize;
float shadowCameraNear;
float shadowCameraFar;
vec2 cascade;
float expBias;
vec3 position;
int csmIdx;
};
struct DirectionalLightShadowCSM {
int cascadeIdxEnd;
float cameraNear;
float shadowFar;
float fade;
};
uniform DirectionalLightShadowCSM directionalLightShadowsCSM[NUM_DIR_LIGHT_SHADOWS_CSM];
uniform DirectionalLightShadowCascade directionalLightShadowsCSMCascade[NUM_DIR_LIGHT_SHADOW_CASCADES_CSM];
#endif
#endif`,CW=`#if defined(USE_SHADOWMAP)
#if NUM_SPOT_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 || NUM_RECT_AREA_LIGHT_SHADOWS > 0 || NUM_DIR_LIGHT_SHADOWS_CSM > 0
vec3 shadowWorldNormal = inverseTransformDirection(transformedNormal, viewMatrix);
vec4 shadowWorldPosition;
#endif
#if NUM_SPOT_LIGHT_SHADOWS > 0
#pragma unroll_loop
for (int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i++) {
shadowWorldPosition = worldPosition + vec4(shadowWorldNormal * spotLightShadows[i].shadowNormalBias, 0);
vSpotShadowCoord[i] = spotShadowMatrix[i] * shadowWorldPosition;
}
#endif
#if NUM_POINT_LIGHT_SHADOWS > 0
#pragma unroll_loop
for (int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i++) {
shadowWorldPosition = worldPosition + vec4(shadowWorldNormal * pointLightShadows[i].shadowNormalBias, 0);
vPointShadowCoord[i] = pointShadowMatrix[i] * shadowWorldPosition;
}
#endif
#if NUM_RECT_AREA_LIGHT_SHADOWS > 0
#pragma unroll_loop
for (int i = 0; i < NUM_RECT_AREA_LIGHT_SHADOWS; i++) {
shadowWorldPosition = worldPosition + vec4(shadowWorldNormal * rectAreaLightShadows[i].shadowNormalBias, 0);
vRectAreaShadowCoord[i] = rectAreaShadowMatrix[i] * shadowWorldPosition;
}
#endif
#if NUM_DIR_LIGHT_SHADOWS_CSM > 0
#pragma unroll_loop
for (int i = 0; i < NUM_DIR_LIGHT_SHADOW_CASCADES_CSM; i++) {
shadowWorldPosition = worldPosition + vec4(shadowWorldNormal * directionalLightShadowsCSMCascade[i].shadowNormalBias, 0);
vDirectionalShadowCSMCoord[i] = directionalShadowCSMMatrix[i] * shadowWorldPosition;
}
#endif
#endif`,EW=`float getShadowMask() {
float shadow = 1.0;
#ifdef USE_SHADOWMAP
#if NUM_SPOT_LIGHT_SHADOWS > 0
SpotLightShadow spotLight;
#pragma unroll_loop
for (int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i++) {
spotLight = spotLightShadows[i];
if (receiveShadow) {
if (spotLight.shadow == 1) {
float distWorld = 0.0;
#if defined(SHADOWMAP_TYPE_ESM)
distWorld = length((invViewMatrix * vec4(spotLight.position
+ vViewPosition, 0.0)).xyz);
#endif
shadow *= getSpotShadow(spotLight, spotShadowMap[i], vSpotShadowCoord[i], distWorld);
} else if (spotLight.shadow == 2) {
shadow *= getSpotOmniShadow(spotLight, spotShadowMap[i], vSpotShadowCoord[i]);
}
}
}
#endif
#if NUM_POINT_LIGHT_SHADOWS > 0
PointLightShadow pointLight;
#pragma unroll_loop
for (int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i++) {
pointLight = pointLightShadows[i];
shadow *= receiveShadow ? getPointShadow(pointLight, pointShadowMap[i], vPointShadowCoord[i]) : 1.0;
}
#endif
#if NUM_RECT_AREA_LIGHT_SHADOWS > 0
RectAreaLightShadow rectAreaLight;
#pragma unroll_loop
for (int i = 0; i < NUM_RECT_AREA_LIGHT_SHADOWS; i++) {
rectAreaLight = rectAreaLightShadows[i];
shadow *= receiveShadow ? getRectAreaShadow(rectAreaLight, rectAreaShadowMap[i], vRectAreaShadowCoord[i]) : 1.0;
}
#endif
#if NUM_DIR_LIGHT_SHADOWS_CSM > 0
DirectionalLightShadowCascade dirShadowCascade;
#pragma unroll_loop
for (int i = 0; i < NUM_DIR_LIGHT_SHADOW_CASCADES_CSM; i++) {
dirShadowCascade = directionalLightShadowsCSMCascade[i];
float distWorld = 0.0;
#if defined(SHADOWMAP_TYPE_ESM)
distWorld = length((invViewMatrix * vec4(dirShadowCascade.position
+ vViewPosition, 0.0)).xyz);
#endif
shadow *= ((vViewPosition.z < dirShadowCascade.shadowCameraFar) && receiveShadow) ?
getDirShadowCSM(dirShadowCascade, directionalShadowCSMMap[i], vDirectionalShadowCSMCoord[i], distWorld)
: 1.0;
}
#endif
#endif
return shadow;
}`,MW=`#ifdef USE_SKINNING
mat4 boneMatX = getBoneMatrix(skinIndex.x);
mat4 boneMatY = getBoneMatrix(skinIndex.y);
mat4 boneMatZ = getBoneMatrix(skinIndex.z);
mat4 boneMatW = getBoneMatrix(skinIndex.w);
#endif`,wW=`#ifdef USE_SKINNING
uniform mat4 bindMatrix;
uniform mat4 bindMatrixInverse;
uniform highp sampler2D boneTexture;
uniform int boneTextureSize;
mat4 getBoneMatrix(const in float i) {
float j = i * 4.0;
float x = mod(j, float(boneTextureSize));
float y = floor(j / float(boneTextureSize));
float dx = 1.0 / float(boneTextureSize);
float dy = 1.0 / float(boneTextureSize);
y = dy * (y + 0.5);
vec4 v1 = texture2D(boneTexture, vec2(dx * (x + 0.5), y));
vec4 v2 = texture2D(boneTexture, vec2(dx * (x + 1.5), y));
vec4 v3 = texture2D(boneTexture, vec2(dx * (x + 2.5), y));
vec4 v4 = texture2D(boneTexture, vec2(dx * (x + 3.5), y));
mat4 bone = mat4(v1, v2, v3, v4);
return bone;
}
#endif`,TW=`#ifdef USE_SKINNING
vec4 skinVertex = bindMatrix * vec4(transformed, 1.0);
vec4 skinned = vec4(0.0);
skinned += boneMatX * skinVertex * skinWeight.x;
skinned += boneMatY * skinVertex * skinWeight.y;
skinned += boneMatZ * skinVertex * skinWeight.z;
skinned += boneMatW * skinVertex * skinWeight.w;
transformed = (bindMatrixInverse * skinned).xyz;
#endif`,RW=`#ifdef USE_SKINNING
mat4 skinMatrix = mat4(0.0);
skinMatrix += skinWeight.x * boneMatX;
skinMatrix += skinWeight.y * boneMatY;
skinMatrix += skinWeight.z * boneMatZ;
skinMatrix += skinWeight.w * boneMatW;
skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
objectNormal = vec4(skinMatrix * vec4(objectNormal, 0.0)).xyz;
#ifdef USE_TANGENT
objectTangent = vec4(skinMatrix * vec4(objectTangent, 0.0)).xyz;
#endif
#endif`,IW=`float specularStrength;
#ifdef USE_SPECULARMAP
vec4 texelSpecular = texture2D(specularMap, vUv);
specularStrength = texelSpecular.r;
#else
specularStrength = 1.0;
#endif`,LW=`#ifdef USE_SPECULARMAP
uniform sampler2D specularMap;
#endif`,BW=`#if defined(TONE_MAPPING)
gl_FragColor.rgb = toneMapping(gl_FragColor.rgb);
#endif`,PW=`#ifndef saturate
#define saturate(a) clamp(a, 0.0, 1.0)
#endif
uniform float toneMappingExposure;
uniform float toneMappingMidTones;
uniform float toneMappingPhysicalScale;
uniform float toneMappingBrightness;
uniform float toneMappingContrast;
uniform bool toneMappingChromaticAdaptation;
uniform vec3 toneMappingWhiteColor;
uniform bool toneMappingColorDifferentiation;
uniform bool toneMappingExteriorDaylight;
uniform vec3 toneMappingWhiteBalance;
uniform float toneMappingHighlights;
uniform float toneMappingShadows;
uniform float toneMappingSaturation;
uniform float toneMappingAperture;
uniform float toneMappingShutter;
uniform float toneMappingISO;
uniform float toneMappingVignetting;
uniform vec2 toneMappingResolution;
const mat3 LINEAR_REC2020_TO_LINEAR_SRGB = mat3(
vec3(1.6605, -0.1246, -0.0182),
vec3(- 0.5876, 1.1329, -0.1006),
vec3(- 0.0728, -0.0083, 1.1187)
);
const mat3 LINEAR_SRGB_TO_LINEAR_REC2020 = mat3(
vec3(0.6274, 0.0691, 0.0164),
vec3(0.3293, 0.9195, 0.0880),
vec3(0.0433, 0.0113, 0.8956)
);
#define TONE_MAPPING_LOOK_NONE 0
#define TONE_MAPPING_LOOK_AGX_PUNCHY 1
const float FILMIC_BLENDER_LOG_MIN = -12.473931188;
const float FILMIC_BLENDER_LOG_MAX = 12.526068812;
const float FILMIC_BLENDER_EXPOSURE_LATITUDE_RATIO = 0.66;
vec3 LinearToneMapping(vec3 color) {
return toneMappingExposure * color;
}
vec3 ReinhardToneMapping(vec3 color) {
color *= toneMappingExposure;
return saturate(color / (vec3(1.0) + color));
}
vec3 OptimizedCineonToneMapping(vec3 color) {
color *= toneMappingExposure;
color = max(vec3(0.0), color - 0.004);
return pow((color * (6.2 * color + 0.5)) / (color * (6.2 * color + 1.7) + 0.06), vec3(2.2));
}
vec3 RRTAndODTFit(vec3 v) {
vec3 a = v * (v + 0.0245786) -0.000090537;
vec3 b = v * (0.983729 * v + 0.4329510) + 0.238081;
return a / b;
}
vec3 ACESFilmicToneMapping(vec3 color) {
const mat3 ACESInputMat = mat3(
vec3(0.59719, 0.07600, 0.02840),
vec3(0.35458, 0.90834, 0.13383),
vec3(0.04823, 0.01566, 0.83777)
);
const mat3 ACESOutputMat = mat3(
vec3( 1.60475, -0.10208, -0.00327),
vec3(-0.53108, 1.10813, -0.07276),
vec3(-0.07367, -0.00605, 1.07602)
);
color *= toneMappingExposure / 0.6;
color = ACESInputMat * color;
color = RRTAndODTFit(color);
color = ACESOutputMat * color;
return saturate(color);
}
vec3 agxDefaultContrastApprox(vec3 x) {
vec3 x2 = x * x;
vec3 x4 = x2 * x2;
return + 15.5 * x4 * x2
-40.14 * x4 * x
+ 31.96 * x4
-6.868 * x2 * x
+ 0.4298 * x2
+ 0.1191 * x
-0.00232;
}
vec3 toneMappingLook(vec3 color, int look) {
if (look == TONE_MAPPING_LOOK_NONE) {
return color;
}
const vec3 lw = vec3(0.2126, 0.7152, 0.0722);
float luma = dot(color, lw);
vec3 offset = vec3(0.0);
vec3 slope = vec3(1.0);
vec3 power = vec3(1.0);
float sat = 1.0;
if (look == TONE_MAPPING_LOOK_AGX_PUNCHY) {
slope = vec3(1.0);
power = vec3(1.35, 1.35, 1.35);
sat = 1.4;
}
color = pow(color * slope + offset, power);
return luma + sat * (color - luma);
}
vec3 AgXToneMapping(vec3 color) {
const mat3 AgXInsetMatrix = mat3(
vec3(0.856627153315983, 0.137318972929847, 0.11189821299995),
vec3(0.0951212405381588, 0.761241990602591, 0.0767994186031903),
vec3(0.0482516061458583, 0.101439036467562, 0.811302368396859)
);
const mat3 AgXOutsetMatrix = mat3(
vec3(1.1271005818144368, -0.1413297634984383, -0.14132976349843826),
vec3(- 0.11060664309660323, 1.157823702216272, -0.11060664309660294),
vec3(- 0.016493938717834573, -0.016493938717834257, 1.2519364065950405)
);
const float AgxMinEv = -12.47393;
const float AgxMaxEv = 4.026069;
color *= toneMappingExposure;
color = LINEAR_SRGB_TO_LINEAR_REC2020 * color;
color = AgXInsetMatrix * color;
color = max(color, 1e-10);
color = log2(color);
color = (color - AgxMinEv) / (AgxMaxEv - AgxMinEv);
color = clamp(color, 0.0, 1.0);
color = agxDefaultContrastApprox(color);
color = toneMappingLook(color, TONE_MAPPING_LOOK);
color = AgXOutsetMatrix * color;
color = pow(max(vec3(0.0), color), vec3(2.2));
color = LINEAR_REC2020_TO_LINEAR_SRGB * color;
color = clamp(color, 0.0, 1.0);
return color;
}
vec3 CustomToneMapping(vec3 color) { return color; }
#define ORDERS_OF_MAG 5.0
#define PI_TONE 3.14159265359
float toneCalcBrightness(in vec3 color)
{
return (abs(color.r) * 0.263 + abs(color.g) * 0.655 + abs(color.b) * 0.082);
}
float toneApproximateScotopicLuminance(vec3 color)
{
return (0.062 * color.r + 0.608 * color.g + 0.330 * color.b);
}
vec3 LogarithmicMaxToneMapping(vec3 color) {
float inputScaleFactor = toneMappingPhysicalScale / PI_TONE;
float brightness = (toneMappingBrightness < 0.0) ? 0.0 : (toneMappingBrightness * 0.7);
float powerBot = toneMappingExteriorDaylight ? 4.0 : 2.0;
float res = 100.0 / ORDERS_OF_MAG;
float mag = floor((50.0 / res));
float power = ((brightness / 20.0 - ORDERS_OF_MAG) - powerBot) + mag;
float stepsize = 9.0 / res;
float step = 50.0 - (mag * res);
float param_c = (0.02 * toneMappingContrast) * 2.0;
float param_b = pow(10.0, power) * (1.0 + (stepsize * step));
float param_a = param_b * (1.0 + param_c);
param_c /= pow(2.0, toneMappingMidTones - 1.0);
param_b *= PI_TONE;
vec3 whiteConstancyFactor = toneMappingWhiteColor;
if (toneMappingChromaticAdaptation) {
float luminance = toneCalcBrightness(whiteConstancyFactor);
whiteConstancyFactor.r = (whiteConstancyFactor.r > 0.001) ? luminance / whiteConstancyFactor.r : luminance / 0.001;
whiteConstancyFactor.g = (whiteConstancyFactor.g > 0.001) ? luminance / whiteConstancyFactor.g : luminance / 0.001;
whiteConstancyFactor.b = (whiteConstancyFactor.b > 0.001) ? luminance / whiteConstancyFactor.b : luminance / 0.001;
}
vec3 outColor = inputScaleFactor * color;
if (toneMappingChromaticAdaptation) {
outColor *= whiteConstancyFactor.rgb;
}
float luminance = toneCalcBrightness(outColor);
if (toneMappingColorDifferentiation && (luminance < 5.62)) {
float sLuminance = toneApproximateScotopicLuminance(outColor);
if (luminance <= 5.62e-3) {
outColor = vec3(sLuminance);
} else {
float w = (luminance - 5.62e-3) / 5.61438;
outColor = outColor * w + sLuminance * (1.0 - w);
}
}
outColor = outColor * (param_a / (param_b * outColor + param_c));
return outColor;
}
float maxExposurePhotographic(in vec4 color1, in vec4 color2)
{
return ((color1.r * color2.r) + (color1.g * color2.g)) + (color1.b * color2.b);
}
vec3 PhysicalMaxToneMapping(vec3 color) {
float vignettingInfluence = 1.0;
if (toneMappingVignetting > 0.0) {
vec3 vignettingCoords = vec3(0.0, 0.0, 0.0);
float aspect = toneMappingResolution.x / toneMappingResolution.y;
vignettingCoords.x = gl_FragCoord.x / toneMappingResolution.x - 0.5;
vignettingCoords.y = (gl_FragCoord.y / toneMappingResolution.y - 0.5) / aspect;
vignettingCoords.z = 1.0;
vignettingCoords = normalize(vignettingCoords);
vignettingInfluence = pow(vignettingCoords.z, toneMappingVignetting);
}
float inputScaleFactor = toneMappingPhysicalScale / PI_TONE;
float filmISO = toneMappingISO;
float camShutter = 1.0 / toneMappingShutter;
float fNumber = toneMappingAperture;
float cm2 = 1.0;
float burnHighlights = toneMappingHighlights;
float crushBlacks = toneMappingShadows;
float saturation = toneMappingSaturation;
vec3 whitePointInfluence = toneMappingWhiteBalance;
if (whitePointInfluence.r > 0.0) {
whitePointInfluence.r = 1.0 / whitePointInfluence.r;
} else {
whitePointInfluence.r = 1.0;
}
if (whitePointInfluence.g > 0.0) {
whitePointInfluence.g = 1.0 / whitePointInfluence.g;
} else {
whitePointInfluence.g = 1.0;
}
if (whitePointInfluence.b > 0.0) {
whitePointInfluence.b = 1.0 / whitePointInfluence.b;
} else {
whitePointInfluence.b = 1.0;
}
vec4 lumFactor = vec4(0.212671, 0.715160, 0.072169, 0.0);
float whiteLumFactor = maxExposurePhotographic(lumFactor, vec4(whitePointInfluence, 0.0));
whitePointInfluence.r /= whiteLumFactor;
whitePointInfluence.g /= whiteLumFactor;
whitePointInfluence.b /= whiteLumFactor;
float isoInfluence = 0.0;
float camShutterInv = 1.0 / camShutter;
if (filmISO > 0.0) {
isoInfluence = ((cm2 * 0.169811) * (filmISO * camShutterInv)) / ((15.4 * fNumber) * fNumber);
} else {
isoInfluence = cm2;
}
vec3 outColor = inputScaleFactor * color;
outColor.r = outColor.r * whitePointInfluence.r * isoInfluence * vignettingInfluence;
outColor.g = outColor.g * whitePointInfluence.g * isoInfluence * vignettingInfluence;
outColor.b = outColor.b * whitePointInfluence.b * isoInfluence * vignettingInfluence;
outColor.r = (outColor.r * (1.0 + (outColor.r * burnHighlights))) / (1.0 + outColor.r);
outColor.g = (outColor.g * (1.0 + (outColor.g * burnHighlights))) / (1.0 + outColor.g);
outColor.b = (outColor.b * (1.0 + (outColor.b * burnHighlights))) / (1.0 + outColor.b);
float lumFactor2 = maxExposurePhotographic(lumFactor, vec4(outColor, 0.0));
float tmpFloat = 1.0 - saturation;
outColor.r = outColor.r * saturation + lumFactor2 * tmpFloat;
outColor.g = outColor.g * saturation + lumFactor2 * tmpFloat;
outColor.b = outColor.b * saturation + lumFactor2 * tmpFloat;
outColor = max(vec3(0.0), outColor);
float crushBlacksFac = crushBlacks * 2.0 + 1.0;
float crushBlacksFac2 = pow(maxExposurePhotographic(lumFactor, vec4(outColor, 0.0)), 0.5);
tmpFloat = (1.0 - crushBlacksFac2);
if (crushBlacksFac2 < 1.0) {
outColor.r = outColor.r * crushBlacksFac2 + pow(outColor.r, crushBlacksFac) * tmpFloat;
outColor.g = outColor.g * crushBlacksFac2 + pow(outColor.g, crushBlacksFac) * tmpFloat;
outColor.b = outColor.b * crushBlacksFac2 + pow(outColor.b, crushBlacksFac) * tmpFloat;
}
return outColor;
}
float filmicBlenderDesaturationMinIntensity(vec3 color) {
float maxChannel = max(color.r, max(color.g, color.b));
float x = max(maxChannel, 0.6251);
return (1.2192868 * x - 0.63221059)
* ((x - 0.65069831) / (abs(x - 0.65069831) + 0.00952982) + 0.73015231);
}
vec3 filmicBlenderDesaturationTransform(vec3 color) {
const float CURVE_SMOOTHNESS = 0.03;
float minIntensity = filmicBlenderDesaturationMinIntensity(color);
vec4 x = vec4(color, 1.0) - minIntensity;
x = pow(x, vec4(2.0)) / (abs(x) + CURVE_SMOOTHNESS);
return (x.rgb - x.a + color + 1.0) / 2.0;
}
vec3 filmicBlenderDynamicRangeTransform(vec3 color) {
return pow(
(0.28882259 * color - 0.15880336)
/ (pow(color - 0.6229693, vec3(2.0)) + 0.16965022)
+ 0.20453365 * color + 0.37847142,
vec3(3.0)
);
}
vec3 FilmicBlenderToneMapping(vec3 color) {
color *= toneMappingExposure;
color = max(color, 0.000175);
color = clamp((log2(color) - FILMIC_BLENDER_LOG_MIN)
/ (FILMIC_BLENDER_LOG_MAX - FILMIC_BLENDER_LOG_MIN), 0.0, 1.0);
color = filmicBlenderDesaturationTransform(color);
color = clamp(color / FILMIC_BLENDER_EXPOSURE_LATITUDE_RATIO, 0.0, 1.0);
color = filmicBlenderDynamicRangeTransform(color);
return color;
}
vec3 PbrNeutralToneMapping(vec3 color) {
const float startCompression = 0.8 - 0.04;
const float desaturation = 0.15;
float x = min(color.r, min(color.g, color.b));
float offset = x < 0.08 ? x - 6.25 * x * x : 0.04;
color -= offset;
float peak = max(color.r, max(color.g, color.b));
if (peak < startCompression)
return color;
const float d = 1.0 - startCompression;
float newPeak = 1.0 - d * d / (peak + d - startCompression);
color *= newPeak / peak;
float g = 1.0 - 1.0 / (desaturation * (peak - newPeak) + 1.);
return mix(color, newPeak * vec3(1, 1, 1), g);
}`,NW=`#ifdef USE_TRANSMISSION
material.transmission = transmission;
material.transmissionAlpha = 1.0;
material.thickness = thickness;
material.attenuationDistance = attenuationDistance;
material.attenuationColor = attenuationColor;
#ifdef USE_TRANSMISSIONMAP
material.transmission *= texture2D(transmissionMap, vUv).r;
#endif
#ifdef USE_THICKNESSMAP
material.thickness *= texture2D(thicknessMap, vUv).g;
#endif
vec3 pos = vWorldPosition;
vec3 v = normalize(cameraPosition - pos);
vec3 n = inverseTransformDirection(normal, viewMatrix);
vec4 transmission = getIBLVolumeRefraction(
n, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
pos, modelMatrix, viewMatrix, projectionMatrix, material.ior, material.thickness,
material.attenuationColor, material.attenuationDistance);
material.transmissionAlpha = mix(material.transmissionAlpha, transmission.a, material.transmission);
totalDiffuse = mix(totalDiffuse, transmission.rgb, material.transmission);
#endif`,DW=`#ifdef USE_TRANSMISSION
uniform float transmission;
uniform float thickness;
uniform float attenuationDistance;
uniform vec3 attenuationColor;
#ifdef USE_TRANSMISSIONMAP
uniform sampler2D transmissionMap;
#endif
#ifdef USE_THICKNESSMAP
uniform sampler2D thicknessMap;
#endif
uniform vec2 transmissionSamplerSize;
uniform sampler2D transmissionSamplerMap;
uniform mat4 modelMatrix;
uniform mat4 projectionMatrix;
varying vec3 vWorldPosition;
vec3 getVolumeTransmissionRay(const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix) {
vec3 refractionVector = refract(- v, normalize(n), 1.0 / ior);
vec3 modelScale;
modelScale.x = length(vec3(modelMatrix[0].xyz));
modelScale.y = length(vec3(modelMatrix[1].xyz));
modelScale.z = length(vec3(modelMatrix[2].xyz));
return normalize(refractionVector) * thickness * modelScale;
}
float applyIorToRoughness(const in float roughness, const in float ior) {
return roughness * clamp(ior * 2.0 - 2.0, 0.0, 1.0);
}
vec4 getTransmissionSample(const in vec2 fragCoord, const in float roughness, const in float ior) {
float framebufferLod = log2(transmissionSamplerSize.x) * applyIorToRoughness(roughness, ior);
#ifdef texture2DLodEXT
return texture2DLodEXT(transmissionSamplerMap, fragCoord.xy, framebufferLod);
#else
return texture2D(transmissionSamplerMap, fragCoord.xy, framebufferLod);
#endif
}
vec3 applyVolumeAttenuation(const in vec3 radiance, const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance) {
if (isinf(attenuationDistance)) {
return radiance;
} else {
vec3 attenuationCoefficient = -log(attenuationColor) / attenuationDistance;
vec3 transmittance = exp(-attenuationCoefficient * transmissionDistance);
return transmittance * radiance;
}
}
vec4 getIBLVolumeRefraction(const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
const in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,
const in vec3 attenuationColor, const in float attenuationDistance) {
vec3 transmissionRay = getVolumeTransmissionRay(n, v, thickness, ior, modelMatrix);
vec3 refractedRayExit = position + transmissionRay;
vec4 ndcPos = projMatrix * viewMatrix * vec4(refractedRayExit, 1.0);
vec2 refractionCoords = ndcPos.xy / ndcPos.w;
refractionCoords += 1.0;
refractionCoords /= 2.0;
vec4 transmittedLight = getTransmissionSample(refractionCoords, roughness, ior);
vec3 attenuatedColor = applyVolumeAttenuation(transmittedLight.rgb, length(transmissionRay), attenuationColor, attenuationDistance);
vec3 F = EnvironmentBRDF(n, v, specularColor, specularF90, roughness);
return vec4((1.0 - F) * attenuatedColor * diffuseColor, transmittedLight.a);
}
#endif`,OW=`#if (defined(USE_UV) && !defined(UVS_VERTEX_ONLY))
varying vec2 vUv;
#endif`,FW=`#ifdef USE_UV
#ifdef UVS_VERTEX_ONLY
vec2 vUv;
#else
varying vec2 vUv;
#endif
uniform mat3 uvTransform;
#endif`,UW=`#ifdef USE_UV
vUv = (uvTransform * vec3(uv, 1)).xy;
#endif`,zW=`#if defined(USE_LIGHTMAP) || defined(USE_AOMAP)
varying vec2 vUv2;
#endif`,VW=`#if defined(USE_LIGHTMAP) || defined(USE_AOMAP)
attribute vec2 uv2;
varying vec2 vUv2;
uniform mat3 uv2Transform;
#endif`,kW=`#if defined(USE_LIGHTMAP) || defined(USE_AOMAP)
vUv2 = (uv2Transform * vec3(uv2, 1)).xy;
#endif`,GW=`float cosh(float x) {
return (exp(x) + exp(-x)) / 2.0;
}
vec2 cosh(vec2 x) {
return (exp(x) + exp(-x)) / 2.0;
}
vec3 cosh(vec3 x) {
return (exp(x) + exp(-x)) / 2.0;
}
vec4 cosh(vec4 x) {
return (exp(x) + exp(-x)) / 2.0;
}
float sinh(float x) {
return (exp(x) - exp(-x)) / 2.0;
}
vec2 sinh(vec2 x) {
return (exp(x) - exp(-x)) / 2.0;
}
vec3 sinh(vec3 x) {
return (exp(x) - exp(-x)) / 2.0;
}
vec4 sinh(vec4 x) {
return (exp(x) - exp(-x)) / 2.0;
}
float tanh(float x) {
float exp2x = exp(2.0 * x);
return (exp2x - 1.0) / (exp2x + 1.0);
}
vec2 tanh(vec2 x) {
vec2 exp2x = exp(2.0 * x);
return (exp2x - 1.0) / (exp2x + 1.0);
}
vec3 tanh(vec3 x) {
vec3 exp2x = exp(2.0 * x);
return (exp2x - 1.0) / (exp2x + 1.0);
}
vec4 tanh(vec4 x) {
vec4 exp2x = exp(2.0 * x);
return (exp2x - 1.0) / (exp2x + 1.0);
}
float trunc(float x) {
return floor(abs(x)) * sign(x);
}
vec2 trunc(vec2 x) {
return floor(abs(x)) * sign(x);
}
vec3 trunc(vec3 x) {
return floor(abs(x)) * sign(x);
}
vec4 trunc(vec4 x) {
return floor(abs(x)) * sign(x);
}`,QW=`#if defined(USE_ENVMAP) || defined(DISTANCE) || defined (USE_SHADOWMAP) || defined (USE_TRANSMISSION) || defined(MASK) || defined(NODE)
vec4 worldPosition = vec4(transformed, 1.0);
#ifdef USE_INSTANCING
worldPosition = instanceMatrix * worldPosition;
#endif
worldPosition = modelMatrix * worldPosition;
#endif`;const HW=`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
vUv = (uvTransform * vec3(uv, 1)).xy;
gl_Position = vec4(position.xy, 1.0, 1.0);
}`,WW=`uniform sampler2D t2D;
uniform float backgroundIntensity;
varying vec2 vUv;
void main() {
vec4 texColor = texture2D(t2D, vUv);
#ifdef DECODE_VIDEO_TEXTURE
texColor = vec4(mix(pow(texColor.rgb * 0.9478672986 + vec3(0.0521327014), vec3(2.4)), texColor.rgb * 0.0773993808, vec3(lessThanEqual(texColor.rgb, vec3(0.04045)))), texColor.w);
#endif
texColor.rgb *= backgroundIntensity;
gl_FragColor = texColor;
#include <tonemapping_fragment>
#include <encodings_fragment>
}`,YW=`varying vec3 vWorldDirection;
#include <common>
void main() {
vWorldDirection = transformDirection(position, modelMatrix);
#include <begin_vertex>
#include <project_vertex>
gl_Position.z = gl_Position.w;
}`,jW=`#ifdef ENVMAP_TYPE_CUBE
uniform samplerCube envMap;
#elif defined(ENVMAP_TYPE_CUBE_UV)
uniform sampler2D envMap;
#endif
uniform float flipEnvMap;
uniform float backgroundBlurriness;
uniform float backgroundIntensity;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
#ifdef ENVMAP_TYPE_CUBE
vec4 texColor = textureCube(envMap, vec3(flipEnvMap * vWorldDirection.x, vWorldDirection.yz));
#elif defined(ENVMAP_TYPE_CUBE_UV)
vec4 texColor = textureCubeUV(envMap, vWorldDirection, backgroundBlurriness);
#else
vec4 texColor = vec4(0.0, 0.0, 0.0, 1.0);
#endif
texColor.rgb *= backgroundIntensity;
gl_FragColor = texColor;
#include <tonemapping_fragment>
#include <encodings_fragment>
}`,XW=`varying vec3 vWorldDirection;
#include <common>
void main() {
vWorldDirection = transformDirection(position, modelMatrix);
#include <begin_vertex>
#include <project_vertex>
gl_Position.z = gl_Position.w;
}`,qW=`uniform samplerCube tCube;
uniform float tFlip;
uniform float opacity;
varying vec3 vWorldDirection;
void main() {
vec4 texColor = textureCube(tCube, vec3(tFlip * vWorldDirection.x, vWorldDirection.yz));
gl_FragColor = texColor;
gl_FragColor.a *= opacity;
#include <tonemapping_fragment>
#include <encodings_fragment>
}`,ZW=`#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec3 vViewPosition;
varying vec2 vProjectedPosZW;
void main() {
#include <uv_vertex>
#include <skinbase_vertex>
#ifdef USE_DISPLACEMENTMAP
#include <beginnormal_vertex>
#include <morphnormal_vertex>
#include <skinnormal_vertex>
#endif
#include <begin_vertex>
#include <morphtarget_vertex>
#include <skinning_vertex>
#include <displacementmap_vertex>
#include <project_vertex>
#include <logdepthbuf_vertex>
#include <clipping_planes_vertex>
vViewPosition = mvPosition.xyz;
vProjectedPosZW = mat2(
projectionMatrix[2][2], projectionMatrix[2][3],
projectionMatrix[3][2], projectionMatrix[3][3]
) * mvPosition.zw;
#ifdef PANCAKE_DEPTH
gl_Position.z = max(gl_Position.z, -1.0);
#endif
}`,KW=`#if DEPTH_PACKING == 3200
uniform float opacity;
#endif
#ifdef USE_SLOPE_SCALED_BIAS
uniform float slopeScaledBias;
const float ONE_MINUS_EPS = 0.9999999;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec3 vViewPosition;
varying vec2 vProjectedPosZW;
void main() {
#include <clipping_planes_fragment>
vec4 diffuseColor = vec4(1.0);
#if DEPTH_PACKING == 3200
diffuseColor.a = opacity;
#endif
#include <map_fragment>
#include <alphamap_fragment>
#include <alphatest_fragment>
#include <logdepthbuf_fragment>
#if DEPTH_PACKING != 3202
float depth = vProjectedPosZW.x / vProjectedPosZW.y;
depth = (depth + 1.0) / 2.0;
#ifdef PANCAKE_DEPTH
depth = max(depth, 0.0);
#endif
#ifdef USE_SLOPE_SCALED_BIAS
vec2 dxdy = abs(vec2(dFdx(depth), dFdy(depth)));
float bias = slopeScaledBias * max(dxdy.x, dxdy.y);
depth = clamp(depth + max(bias, 1e-6), 0.0, ONE_MINUS_EPS);
#endif
#if DEPTH_PACKING == 3200
gl_FragColor = vec4(vec3(1.0 - depth), opacity);
#elif DEPTH_PACKING == 3201
gl_FragColor = packDepthToRGBA(depth);
#endif
#else
gl_FragColor = vec4(vViewPosition.z);
#endif
}`,$W=`#define DISTANCE
varying vec3 vWorldPosition;
#ifdef PANCAKE_DEPTH
varying vec4 vMVPPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
#include <uv_vertex>
#include <skinbase_vertex>
#ifdef USE_DISPLACEMENTMAP
#include <beginnormal_vertex>
#include <morphnormal_vertex>
#include <skinnormal_vertex>
#endif
#include <begin_vertex>
#include <morphtarget_vertex>
#include <skinning_vertex>
#include <displacementmap_vertex>
#include <project_vertex>
#include <worldpos_vertex>
#include <clipping_planes_vertex>
vWorldPosition = worldPosition.xyz;
#ifdef PANCAKE_DEPTH
vec4 mvpPosition = projectionMatrix * mvPosition;
gl_Position.z = max(mvpPosition.z, -1.0);
vMVPPosition = mvpPosition;
#endif
}`,JW=`#define DISTANCE
#ifdef USE_SLOPE_SCALED_BIAS
uniform float slopeScaledBias;
const float ONE_MINUS_EPS = 0.9999999;
#endif
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#ifdef PANCAKE_DEPTH
varying vec4 vMVPPosition;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <clipping_planes_pars_fragment>
#ifndef DISTANCE_SCALE
#define DISTANCE_SCALE 1.0
#endif
void main () {
#include <clipping_planes_fragment>
vec4 diffuseColor = vec4(1.0);
#include <map_fragment>
#include <alphamap_fragment>
#include <alphatest_fragment>
float dist = length(vWorldPosition - referencePosition);
#if DISTANCE_PACKING == 3301
dist = (dist - nearDistance) / (farDistance - nearDistance);
dist = saturate(dist);
#ifdef USE_SLOPE_SCALED_BIAS
vec2 dxdy = abs(vec2(dFdx(dist), dFdy(dist)));
float bias = slopeScaledBias * max(dxdy.x, dxdy.y);
dist = clamp(dist + bias, 0.0, ONE_MINUS_EPS);
#endif
gl_FragColor = packDepthToRGBA(dist);
#elif DISTANCE_PACKING == 3302
#ifdef USE_SLOPE_SCALED_BIAS
vec2 dxdy = abs(vec2(dFdx(dist), dFdy(dist)));
dist += slopeScaledBias * max(dxdy.x, dxdy.y);
#endif
#ifdef PANCAKE_DEPTH
if (vMVPPosition.z < -1.0) {
dist = length(vec3(vMVPPosition.x * CAM_WIDTH, vMVPPosition.y * CAM_HEIGHT, nearDistance));
}
#endif
gl_FragColor = vec4(dist * DISTANCE_SCALE, 0.0, 0.0, 1.0);
#endif
}`,eY=`varying vec3 vWorldDirection;
#include <common>
void main() {
vWorldDirection = transformDirection(position, modelMatrix);
#include <begin_vertex>
#include <project_vertex>
}`,tY=`uniform sampler2D tEquirect;
uniform bool invertU;
uniform float offsetU;
varying vec3 vWorldDirection;
#include <common>
void main() {
vec3 direction = normalize(vWorldDirection);
vec2 sampleUV = equirectUv(direction);
if (invertU)
sampleUV.x = 1.0 - sampleUV.x;
sampleUV.x += offsetU;
gl_FragColor = texture2D(tEquirect, sampleUV);
#include <tonemapping_fragment>
#include <encodings_fragment>
}`,nY=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
vLineDistance = scale * lineDistance;
#include <color_vertex>
#include <morphcolor_vertex>
#include <begin_vertex>
#include <morphtarget_vertex>
#include <project_vertex>
#include <logdepthbuf_vertex>
#include <clipping_planes_vertex>
#include <fog_vertex>
}`,rY=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
#include <clipping_planes_fragment>
if (mod(vLineDistance, totalSize) > dashSize) {
discard;
}
vec3 outgoingLight = vec3(0.0);
vec4 diffuseColor = vec4(diffuse, opacity);
#include <logdepthbuf_fragment>
#include <color_fragment>
outgoingLight = diffuseColor.rgb;
#include <output_fragment>
#include <tonemapping_fragment>
#include <encodings_fragment>
#include <fog_fragment>
#include <premultiplied_alpha_fragment>
}`,oY=`#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
#include <uv_vertex>
#include <uv2_vertex>
#include <color_vertex>
#include <morphcolor_vertex>
#if defined (USE_ENVMAP) || defined (USE_SKINNING)
#include <beginnormal_vertex>
#include <morphnormal_vertex>
#include <skinbase_vertex>
#include <skinnormal_vertex>
#include <defaultnormal_vertex>
#endif
#include <begin_vertex>
#include <morphtarget_vertex>
#include <skinning_vertex>
#include <project_vertex>
#include <logdepthbuf_vertex>
#include <clipping_planes_vertex>
#include <worldpos_vertex>
#include <envmap_vertex>
#include <fog_vertex>
}`,aY=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
#include <clipping_planes_fragment>
vec4 diffuseColor = vec4(diffuse, opacity);
#include <logdepthbuf_fragment>
#include <map_fragment>
#include <color_fragment>
#include <alphamap_fragment>
#include <alphatest_fragment>
#include <specularmap_fragment>
ReflectedLight reflectedLight = ReflectedLight(vec3(0.0), vec3(0.0), vec3(0.0), vec3(0.0));
#ifdef USE_LIGHTMAP
vec4 lightMapTexel = texture2D(lightMap, vUv2);
reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
#else
reflectedLight.indirectDiffuse += vec3(1.0);
#endif
#include <aomap_fragment>
reflectedLight.indirectDiffuse *= diffuseColor.rgb;
vec3 outgoingLight = reflectedLight.indirectDiffuse;
#include <envmap_fragment>
#include <output_fragment>
#include <tonemapping_fragment>
#include <encodings_fragment>
#include <fog_fragment>
#include <premultiplied_alpha_fragment>
#include <dithering_fragment>
}`,iY=`#define LAMBERT
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
#include <uv_vertex>
#include <uv2_vertex>
#include <color_vertex>
#include <morphcolor_vertex>
#include <beginnormal_vertex>
#include <morphnormal_vertex>
#include <skinbase_vertex>
#include <skinnormal_vertex>
#include <defaultnormal_vertex>
#include <normal_vertex>
#include <begin_vertex>
#include <morphtarget_vertex>
#include <skinning_vertex>
#include <displacementmap_vertex>
#include <project_vertex>
#include <logdepthbuf_vertex>
#include <clipping_planes_vertex>
vViewPosition = -mvPosition.xyz;
#include <worldpos_vertex>
#include <envmap_vertex>
#include <shadowmap_vertex>
#include <fog_vertex>
}`,sY=`#define LAMBERT
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#if defined(SHADOWMAP_TYPE_ESM) || defined(USE_ENVMAP)
uniform mat4 invViewMatrix;
#endif
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_lambert_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
#include <clipping_planes_fragment>
vec4 diffuseColor = vec4(diffuse, opacity);
ReflectedLight reflectedLight = ReflectedLight(vec3(0.0), vec3(0.0), vec3(0.0), vec3(0.0));
vec3 totalEmissiveRadiance = emissive;
#include <logdepthbuf_fragment>
#include <map_fragment>
#include <color_fragment>
#include <alphamap_fragment>
#include <alphatest_fragment>
#include <specularmap_fragment>
#include <normal_fragment_begin>
#include <normal_fragment_maps>
#include <emissivemap_fragment>
#include <lights_lambert_fragment>
#include <lights_fragment_begin>
#include <lights_fragment_maps>
#include <lights_fragment_end>
#include <aomap_fragment>
vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
#include <envmap_fragment>
#include <output_fragment>
#include <tonemapping_fragment>
#include <encodings_fragment>
#include <fog_fragment>
#include <premultiplied_alpha_fragment>
#include <dithering_fragment>
}`,lY=`#define NORMAL
#if defined(FLAT_SHADED) || defined(USE_BUMPMAP) || defined(TANGENTSPACE_NORMALMAP)
varying vec3 vViewPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
#include <uv_vertex>
#include <beginnormal_vertex>
#include <morphnormal_vertex>
#include <skinbase_vertex>
#include <skinnormal_vertex>
#include <defaultnormal_vertex>
#include <normal_vertex>
#include <begin_vertex>
#include <morphtarget_vertex>
#include <skinning_vertex>
#include <displacementmap_vertex>
#include <project_vertex>
#include <logdepthbuf_vertex>
#include <clipping_planes_vertex>
#if defined(FLAT_SHADED) || defined(USE_BUMPMAP) || defined(TANGENTSPACE_NORMALMAP)
vViewPosition = -mvPosition.xyz;
#endif
}`,cY=`#define NORMAL
uniform float opacity;
#if defined(FLAT_SHADED) || defined(USE_BUMPMAP) || defined(TANGENTSPACE_NORMALMAP)
varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
#include <clipping_planes_fragment>
#include <logdepthbuf_fragment>
#include <normal_fragment_begin>
#include <normal_fragment_maps>
gl_FragColor = vec4(packNormalToRGB(normal), opacity);
#ifdef OPAQUE
gl_FragColor.a = 1.0;
#endif
}`,uY=`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
varying vec3 vWorldPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
#include <plane_reflection_pars_vertex>
void main() {
#include <uv_vertex>
#include <uv2_vertex>
#include <color_vertex>
#include <morphcolor_vertex>
#include <beginnormal_vertex>
#include <morphnormal_vertex>
#include <skinbase_vertex>
#include <skinnormal_vertex>
#include <defaultnormal_vertex>
#include <normal_vertex>
#include <begin_vertex>
#include <morphtarget_vertex>
#include <skinning_vertex>
#include <displacementmap_vertex>
#include <project_vertex>
#include <plane_reflection_vertex>
#include <logdepthbuf_vertex>
#include <clipping_planes_vertex>
vViewPosition = -mvPosition.xyz;
#include <worldpos_vertex>
#include <shadowmap_vertex>
#include <fog_vertex>
#ifdef USE_TRANSMISSION
vWorldPosition = worldPosition.xyz;
#endif
}`,dY=`#define STANDARD
#ifdef PHYSICAL
#define IOR
#define SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
uniform float ior;
#endif
#ifdef SPECULAR
uniform float specularIntensity;
uniform vec3 specularColor;
#ifdef USE_SPECULARINTENSITYMAP
uniform sampler2D specularIntensityMap;
#endif
#ifdef USE_SPECULARCOLORMAP
uniform sampler2D specularColorMap;
#endif
#endif
#ifdef USE_CLEARCOAT
uniform float clearcoat;
uniform float clearcoatRoughness;
#endif
#if defined(SHADOWMAP_TYPE_ESM) || defined(USE_ENVMAP)
uniform mat4 invViewMatrix;
#endif
#if defined(USE_PLANE_REFLECTION) && !defined(USE_TRANSMISSION)
uniform mat4 modelMatrix;
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <bsdfs>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
#include <plane_reflection_pars_fragment>
#include <oit_weighted_pars_fragment>
void main() {
#include <clipping_planes_fragment>
vec4 diffuseColor = vec4(diffuse, opacity);
ReflectedLight reflectedLight = ReflectedLight(vec3(0.0), vec3(0.0), vec3(0.0), vec3(0.0));
vec3 totalEmissiveRadiance = emissive;
#include <logdepthbuf_fragment>
#include <map_fragment>
#include <color_fragment>
#include <alphamap_fragment>
#include <alphatest_fragment>
#include <roughnessmap_fragment>
#include <metalnessmap_fragment>
#include <normal_fragment_begin>
#include <normal_fragment_maps>
#include <clearcoat_normal_fragment_begin>
#include <clearcoat_normal_fragment_maps>
#include <emissivemap_fragment>
#include <lights_physical_fragment>
#include <lights_fragment_begin>
#include <lights_fragment_maps>
#include <lights_fragment_end>
#include <aomap_fragment>
vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
#include <transmission_fragment>
vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
#ifdef USE_CLEARCOAT
float dotNVcc = saturate(dot(geometry.clearcoatNormal, geometry.viewDir));
vec3 Fcc = F_Schlick(material.clearcoatF0, material.clearcoatF90, dotNVcc);
outgoingLight = outgoingLight * (1.0 - material.clearcoat * Fcc) + clearcoatSpecular * material.clearcoat;
#endif
#include <output_fragment>
#include <tonemapping_fragment>
#include <encodings_fragment>
#include <fog_fragment>
#include <premultiplied_alpha_fragment>
#include <dithering_fragment>
#include <oit_weighted_fragment>
}`,fY=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
#include <color_vertex>
#include <morphcolor_vertex>
#include <begin_vertex>
#include <morphtarget_vertex>
#include <project_vertex>
gl_PointSize = size;
#ifdef USE_SIZEATTENUATION
bool isPerspective = isPerspectiveMatrix(projectionMatrix);
if (isPerspective) gl_PointSize *= (scale / - mvPosition.z);
#endif
#include <logdepthbuf_vertex>
#include <clipping_planes_vertex>
#include <worldpos_vertex>
#include <fog_vertex>
}`,hY=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
#include <clipping_planes_fragment>
vec3 outgoingLight = vec3(0.0);
vec4 diffuseColor = vec4(diffuse, opacity);
#include <logdepthbuf_fragment>
#include <map_particle_fragment>
#include <color_fragment>
#include <alphatest_fragment>
outgoingLight = diffuseColor.rgb;
#include <output_fragment>
#include <tonemapping_fragment>
#include <encodings_fragment>
#include <fog_fragment>
#include <premultiplied_alpha_fragment>
}`,pY=`#include <common>
#ifdef USE_SHADOWMAP
varying vec3 vViewPosition;
#endif
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
#include <beginnormal_vertex>
#include <morphnormal_vertex>
#include <skinbase_vertex>
#include <skinnormal_vertex>
#include <defaultnormal_vertex>
#include <begin_vertex>
#include <morphtarget_vertex>
#include <skinning_vertex>
#include <project_vertex>
#include <worldpos_vertex>
#include <shadowmap_vertex>
#include <fog_vertex>
#ifdef USE_SHADOWMAP
vViewPosition = -mvPosition.xyz;
#endif
}`,mY=`uniform vec3 color;
uniform float opacity;
#ifdef USE_SHADOWMAP
varying vec3 vViewPosition;
#ifdef SHADOWMAP_TYPE_ESM
uniform mat4 invViewMatrix;
#endif
#endif
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
gl_FragColor = vec4(color, opacity * (1.0 - getShadowMask()));
#include <tonemapping_fragment>
#include <encodings_fragment>
#include <fog_fragment>
}`,gY=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
#include <uv_vertex>
vec4 mvPosition = modelViewMatrix * vec4(0.0, 0.0, 0.0, 1.0);
vec2 scale;
scale.x = length(vec3(modelMatrix[0].x, modelMatrix[0].y, modelMatrix[0].z));
scale.y = length(vec3(modelMatrix[1].x, modelMatrix[1].y, modelMatrix[1].z));
#ifndef USE_SIZEATTENUATION
bool isPerspective = isPerspectiveMatrix(projectionMatrix);
if (isPerspective) scale *= -mvPosition.z;
#endif
vec2 alignedPosition = (position.xy - (center - vec2(0.5))) * scale;
vec2 rotatedPosition;
rotatedPosition.x = cos(rotation) * alignedPosition.x - sin(rotation) * alignedPosition.y;
rotatedPosition.y = sin(rotation) * alignedPosition.x + cos(rotation) * alignedPosition.y;
mvPosition.xy += rotatedPosition;
gl_Position = projectionMatrix * mvPosition;
#include <logdepthbuf_vertex>
#include <clipping_planes_vertex>
#include <fog_vertex>
}`,vY=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
#include <clipping_planes_fragment>
vec3 outgoingLight = vec3(0.0);
vec4 diffuseColor = vec4(diffuse, opacity);
#include <logdepthbuf_fragment>
#include <map_fragment>
#include <alphamap_fragment>
#include <alphatest_fragment>
outgoingLight = diffuseColor.rgb;
#include <output_fragment>
#include <tonemapping_fragment>
#include <encodings_fragment>
#include <fog_fragment>
}`,_Y=`#define MASK
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
uniform mat4 textureMatrix;
varying vec3 vViewPosition;
varying vec4 projTexCoord;
void main() {
#include <uv_vertex>
#include <skinbase_vertex>
#ifdef USE_DISPLACEMENTMAP
#include <beginnormal_vertex>
#include <morphnormal_vertex>
#include <skinnormal_vertex>
#endif
#include <begin_vertex>
#include <morphtarget_vertex>
#include <skinning_vertex>
#include <displacementmap_vertex>
#include <project_vertex>
vViewPosition = -mvPosition.xyz;
#include <worldpos_vertex>
projTexCoord = textureMatrix * worldPosition;
#include <logdepthbuf_vertex>
#include <clipping_planes_vertex>
}`,AY=`#define MASK
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
uniform float opacity;
uniform sampler2D depthTexture;
uniform vec2 cameraNearFar;
varying vec3 vViewPosition;
varying vec4 projTexCoord;
void main() {
#include <clipping_planes_fragment>
vec4 diffuseColor = vec4(1.0);
diffuseColor.a = opacity;
#include <map_fragment>
#include <alphamap_fragment>
#include <alphatest_fragment>
#include <logdepthbuf_fragment>
float depth = unpackRGBAToDepth(texture2DProj(depthTexture, projTexCoord));
float viewZ;
if (isOrthographic)
viewZ = -orthographicDepthToViewZ(depth,
cameraNearFar.x, cameraNearFar.y);
else
viewZ = -perspectiveDepthToViewZ(depth,
cameraNearFar.x, cameraNearFar.y);
float depthTest = (vViewPosition.z > viewZ) ? 1.0 : 0.0;
gl_FragColor = vec4(0.0, depthTest, 1.0, 0.0);
}`,xY=`#define NODE
varying vec3 vViewPosition;
#ifndef FLAT_SHADED
varying vec3 vNormal;
#endif
#include <common>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
#include <plane_reflection_pars_vertex>
#if defined(NODE_REFLECT_REFRACT_MX) || defined(NODE_BITMAP_ENV_MX) || defined(NODE_BUMP_BL) || defined(NODE_PHY_SUN_SKY_ENV_MX) || defined(NODE_ENV_SPHERE_MY) || defined(NODE_UV_PROJECTION_AR) || defined(NODE_SUB_TRANSFORM_MX) || defined(NODE_SUB_TRANSFORM_MY)
varying vec3 vWorldPosition;
#endif
#include <node_pars_vertex>
void main() {
#include <beginnormal_vertex>
#include <morphnormal_vertex>
#include <skinbase_vertex>
#include <skinnormal_vertex>
#include <defaultnormal_vertex>
#ifndef FLAT_SHADED
vNormal = normalize(transformedNormal);
#endif
#include <begin_vertex>
#include <morphtarget_vertex>
#include <skinning_vertex>
#include <displacementmap_vertex>
#include <project_vertex>
#include <plane_reflection_vertex>
#include <logdepthbuf_vertex>
#include <clipping_planes_vertex>
vViewPosition = -mvPosition.xyz;
#include <worldpos_vertex>
#include <shadowmap_vertex>
#include <fog_vertex>
#if defined(NODE_REFLECT_REFRACT_MX) || defined(NODE_BITMAP_ENV_MX) || defined(NODE_BUMP_BL) || defined(NODE_PHY_SUN_SKY_ENV_MX) || defined(NODE_ENV_SPHERE_MY) || defined(NODE_UV_PROJECTION_AR) || defined(NODE_SUB_TRANSFORM_MX) || defined(NODE_SUB_TRANSFORM_MY)
vWorldPosition = worldPosition.xyz;
#endif
#include <node_vertex>
}`,yY=`#define NODE
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <alphatest_pars_fragment>
#include <bsdfs>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#if defined(NODE_NEW_GEOMETRY_BL) || defined(NODE_VECT_TRANSFORM_BL) || defined(NODE_TEX_COORD_BL) || defined(NODE_NORMAL_MAP_BL) || defined(NODE_LAYER_WEIGHT_BL) || defined(NODE_FRESNEL_BL) || defined(NODE_BUMP_BL) || defined(NODE_BSDF_GLASS_BL) || defined(NODE_BSDF_PRINCIPLED_BL) || defined(NODE_TANGENT_BL) || defined(NODE_BITMAP_MX) || defined(NODE_GRADIENT_MX) || defined(NODE_GRADIENT_RAMP_MX) || defined(NODE_NOISE_MX) || defined(NODE_SUB_TRANSFORM_MX) || defined(NODE_SUB_TRANSFORM_MY) || defined(NODE_SAMPLER_INFO_MY) || defined(NODE_INCIDENT) || defined(NODE_POSITION) || defined(NODE_NORMAL) || defined(USE_OSL) || defined(USE_ENVMAP) || defined(SHADOWMAP_TYPE_ESM) && (defined(NODE_BSDF_DIFFUSE_BL) || defined(NODE_DIFFUSE_BSDF_BL) || defined(NODE_EEVEE_SPECULAR_BL) || defined(NODE_BSDF_GLOSSY_BL) || defined(NODE_BSDF_REFRACTION_BL) || defined(NODE_MATERIAL_MX) || defined(NODE_PHYSICAL_MX) || defined(NODE_STANDARD_SURFACE_AR) || defined(NODE_SHADOW_MATTE_AR))
uniform mat4 invViewMatrix;
#endif
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <lights_node_pars_fragment>
#include <lights_node_gtao_pars_fragment>
#include <shadowmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
#if defined(USE_SSR)
uniform mat4 projectionMatrix;
#endif
#if defined(NODE_VECT_TRANSFORM_BL) || defined(NODE_TEX_COORD_BL) || defined(NODE_NEW_GEOMETRY_BL) || defined(NODE_TANGENT_BL) || defined(NODE_OBJECT_INFO_BL) || defined(NODE_BITMAP_MX) || defined(NODE_GRADIENT_MX) || defined(NODE_GRADIENT_RAMP_MX) || defined(NODE_NOISE_MX) || defined(NODE_SAMPLER_INFO_MY) || defined(NODE_TRANSFORM_MY) || defined(USE_OSL) || defined(USE_PLANE_REFLECTION) || defined(NODE_UV_PROJECTION_AR) || defined(NODE_SUB_TRANSFORM_MX) || defined(NODE_SUB_TRANSFORM_MY)
uniform mat4 modelMatrix;
uniform mat4 invModelMatrix;
#endif
#if defined(NODE_VECT_TRANSFORM_BL) || defined(NODE_NORMAL_MAP_BL) || defined(NODE_NORMAL_BUMP_MX) || defined(NODE_BUMP_2D_MY) || defined(NODE_SAMPLER_INFO_MY)
uniform mat4 modelViewMatrix;
#endif
#if defined(NODE_TEX_IMAGE_BL)
uniform mat3 normalMatrix;
#endif
#if defined(NODE_TEX_COORD_BL) || defined(NODE_NEW_GEOMETRY_BL) || defined(NODE_TANGENT_BL)
uniform vec3 boundingBoxMin;
uniform vec3 boundingBoxMax;
#endif
#if defined(NODE_REFLECT_REFRACT_MX) || defined(NODE_BITMAP_ENV_MX) || defined(NODE_BUMP_BL) || defined(NODE_PHY_SUN_SKY_ENV_MX) || defined(NODE_ENV_SPHERE_MY) || defined(NODE_UV_PROJECTION_AR) || defined(NODE_SUB_TRANSFORM_MX) || defined(NODE_SUB_TRANSFORM_MY)
varying vec3 vWorldPosition;
#endif
#if defined(NODE_TEX_COORD_BL)
uniform vec2 viewWidthHeight;
#endif
#include <ssr_pars_fragment>
#include <plane_reflection_pars_fragment>
#include <node_common_frag>
#include <node_pars_fragment>
#include <oit_weighted_pars_fragment>
void main() {
#include <clipping_planes_fragment>
#include <logdepthbuf_fragment>
#include <normal_fragment_begin>
vec4 outgoingLight = vec4(0.0);
#include <node_fragment>
#if WORLD_NODES == 1
outgoingLight.a = 1.0;
#endif
#ifdef USE_ALPHATEST
if (outgoingLight.a < alphaTest)
discard;
else
outgoingLight.a = 1.0;
#endif
#if defined(OPAQUE) && !(defined(NODE_HOLDOUT_BL) || defined(NODE_MATTE_SHADOW_MX) || defined(NODE_SHADOW_MATTE_AR) || defined(NODE_AI_SHADOW_MATTE_MY))
outgoingLight.a = 1.0;
#endif
gl_FragColor = vec4(outgoingLight);
#include <tonemapping_fragment>
#include <encodings_fragment>
#include <fog_fragment>
#include <premultiplied_alpha_fragment>
#include <dithering_fragment>
#include <normal_output_fragment>
#include <oit_weighted_fragment>
}`;var bY=`
varying vec3 vViewPosition;
#ifndef FLAT_SHADED
varying vec3 vNormal;
#endif
struct NodeMaterial {
vec3 diffuseColor;
float roughness;
vec3 specularColor;
float specularF90;
vec3 fresnelRefl90;
vec3 refractionColor;
float refractionRoughness;
float refractionIOR;
#ifdef USE_CLEARCOAT
float clearcoat;
float clearcoatRoughness;
vec3 clearcoatF0;
float clearcoatF90;
#endif
#ifdef USE_SHEEN
vec3 sheenColor;
float sheenRoughness;
#endif
};
vec3 clearcoatSpecular = vec3(0.0);
vec3 sheenSpecular = vec3(0.0);
float IBLSheenBRDF(const in vec3 normal, const in vec3 viewDir, const in float roughness) {
float dotNV = saturate(dot(normal, viewDir));
float r2 = roughness * roughness;
float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;
float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;
float DG = exp(a * dotNV + b) + (roughness < 0.25 ? 0.0 : 0.1 * (roughness - 0.25));
return saturate(DG * RECIPROCAL_PI);
}
#if NUM_RECT_AREA_LIGHTS > 0
void RE_Direct_RectArea_Node(const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in NodeMaterial material, inout ReflectedLight reflectedLight) {
vec3 normal = geometry.normal;
vec3 viewDir = geometry.viewDir;
vec3 position = geometry.position;
vec3 lightPos = rectAreaLight.position;
vec3 halfWidth = rectAreaLight.halfWidth;
vec3 halfHeight = rectAreaLight.halfHeight;
vec3 lightColor = rectAreaLight.color;
float roughness = material.roughness;
vec3 rectCoords[4];
rectCoords[0] = lightPos + halfWidth - halfHeight;
rectCoords[1] = lightPos - halfWidth - halfHeight;
rectCoords[2] = lightPos - halfWidth + halfHeight;
rectCoords[3] = lightPos + halfWidth + halfHeight;
vec2 uv = LTC_Uv(normal, viewDir, roughness);
vec4 t1 = texture2D(ltc_1, uv);
vec4 t2 = texture2D(ltc_2, uv);
mat3 mInv = mat3(
vec3(t1.x, 0, t1.y),
vec3( 0, 1, 0),
vec3(t1.z, 0, t1.w)
);
vec3 fresnel = (material.specularColor * t2.x + (vec3(1.0) - material.specularColor) * t2.y);
reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate(normal, viewDir, position, mInv, rectCoords);
reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate(normal, viewDir, position, mat3(1.0), rectCoords);
}
#endif
void RE_Direct_Node(const in IncidentLight directLight, const in GeometricContext geometry, const in NodeMaterial material, inout ReflectedLight reflectedLight) {
float dotNL = saturate(dot(geometry.normal, directLight.direction));
vec3 irradiance = dotNL * directLight.color;
#ifdef USE_CLEARCOAT
float dotNLcc = saturate(dot(geometry.clearcoatNormal, directLight.direction));
vec3 ccIrradiance = dotNLcc * directLight.color;
clearcoatSpecular += ccIrradiance * BRDF_GGX(directLight.direction, geometry.viewDir, geometry.clearcoatNormal, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness);
#endif
#ifdef USE_SHEEN
sheenSpecular += irradiance * BRDF_Sheen(directLight.direction, geometry.viewDir, geometry.normal, material.sheenColor, material.sheenRoughness);
#endif
reflectedLight.directSpecular += irradiance * BRDF_GGX(directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.roughness);
reflectedLight.directDiffuse += irradiance * BRDF_Lambert(material.diffuseColor);
}
void RE_IndirectDiffuse_Node(const in vec3 irradiance, const in GeometricContext geometry, const in NodeMaterial material, inout ReflectedLight reflectedLight) {
reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert(material.diffuseColor);
}
void RE_IndirectSpecular_Node(const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in NodeMaterial material, inout ReflectedLight reflectedLight) {
#ifdef USE_CLEARCOAT
clearcoatSpecular += clearcoatRadiance * BRDF_Specular_GGX_Environment(geometry.viewDir, geometry.clearcoatNormal, material.clearcoatF0, vec3(material.clearcoatF90), material.clearcoatRoughness);
#endif
#ifdef USE_SHEEN
sheenSpecular += irradiance * material.sheenColor * IBLSheenBRDF(geometry.normal, geometry.viewDir, material.sheenRoughness);
#endif
#ifdef MT_BLENDER
vec3 specEnv = BRDF_Specular_GGX_Environment(geometry.viewDir, geometry.normal, material.specularColor, material.fresnelRefl90, material.roughness);
#elif defined(MT_MAX)
float alphaEnv = pow2(pow2(material.roughness));
vec3 specEnv = material.specularColor / (1.0 - alphaEnv + PI * alphaEnv);
#elif defined(MT_MAYA)
vec3 specEnv = BRDF_Specular_GGX_Environment(geometry.viewDir, geometry.normal, material.specularColor, material.fresnelRefl90, material.roughness);
#else
vec3 specEnv = vec3(1.0);
#endif
reflectedLight.indirectSpecular += radiance * specEnv;
}
void RE_Refraction_Node(const vec3 refraction, const NodeMaterial material, inout vec3 refractedLight) {
refractedLight += refraction * material.refractionColor;
}
void RE_DirectDiffuseOnly_Node(const in IncidentLight directLight, const in GeometricContext geometry, const in NodeMaterial material, inout ReflectedLight reflectedLight) {
float dotNL = saturate(dot(geometry.normal, directLight.direction));
vec3 irradiance = dotNL * directLight.color;
reflectedLight.directDiffuse += irradiance * BRDF_Lambert(material.diffuseColor);
}
void RE_IndirectDiffuse_Empty(const in vec3 irradiance, const in GeometricContext geometry, const in NodeMaterial material, inout ReflectedLight reflectedLight) {}
#define RE_Direct_RectArea RE_Direct_RectArea_Node`,SY=`#ifdef USE_GTAO
uniform sampler2D gtaoMap;
uniform vec2 currResolution;
float calcGTAOVisibilityFix(vec3 viewDir, vec3 normal) {
float slopeCoeff = saturate(dot(viewDir, normal));
return pow(2.0 / (slopeCoeff + 1.0), log2(PI) - 1.0);
}
float calcSolidAngle(float radiusAngle) {
return PI2 * (1.0 - cos(radiusAngle));
}
float calcSolidAnglesIntersectionApprox(float radiusAngle0, float radiusAngle1,
float distanceAngle) {
float rp = radiusAngle0, rl = radiusAngle1, d = distanceAngle;
float rDiff = abs(rp - rl);
return PI2 * (1.0 - cos(min(rp, rl))) * smoothstep(0.0, 1.0, 1.0 -
(d - rDiff) / (rp + rl - rDiff));
}
float calcGTSOVisibility(float aoVisibility, vec3 bentNormal, vec3 viewDir, vec3 normal,
float roughness) {
aoVisibility = saturate(aoVisibility * calcGTAOVisibilityFix(viewDir, normal));
float radiusAngleVisCone = acos(clamp(sqrt(1.0 - aoVisibility), -1.0, 1.0));
float radiusAngleSpecCone = acos(clamp(exp2(-3.32193 * pow2(roughness)), -1.0, 1.0));
radiusAngleSpecCone = max(0.001, radiusAngleSpecCone);
vec3 specularConeAxis = -reflect(viewDir, normal);
float distanceAngle = acos(clamp(dot(bentNormal, specularConeAxis), -1.0, 1.0));
float solidAngleIntersection = calcSolidAnglesIntersectionApprox(
radiusAngleVisCone, radiusAngleSpecCone, distanceAngle);
float solidAngleSpecular = calcSolidAngle(radiusAngleSpecCone);
float specVisibility = solidAngleIntersection / solidAngleSpecular;
return mix(specVisibility, 1.0, aoVisibility);
}
#endif`,CY=`#ifdef USE_GTAO
reflectedLight.indirectSpecular *= calcGTSOVisibility(gtaoVisibility,
gtaoBentNormal, gtaoViewDir, gtaoNormal, gtaoRoughness);
#endif`,EY=`#if NORMAL_OUTPUT == 1
gl_FragColor = vec4(packNormalToRGB(normal), gl_FragColor.a);
#endif`,MY=`#ifdef USE_SSR
uniform sampler2D ssrSourceBuffer;
uniform sampler2D ssrDepthBuffer;
uniform sampler2D ssrBackfaceDepthBuffer;
uniform mat4 invProjectionMatrix;
uniform vec2 ssrResolution;
uniform float ssrThickness;
uniform float ssrStride;
uniform float ssrJitter;
uniform float ssrMaxDistance;
#ifdef USE_SSR_REFRACT
#define STEPS_FADE_AMOUNT 0.1
#define SCREEN_FADE_THRESHOLD 0.6
#else
#define STEPS_FADE_AMOUNT 1.0
#define SCREEN_FADE_THRESHOLD 0.4
#endif
vec3 deproject(vec3 p) {
vec4 res = invProjectionMatrix * vec4(p, 1);
return res.xyz / res.w;
}
bool doesIntersect(float rayzmax, float rayzmin, vec2 uv) {
float sceneZMin = texture2D(ssrDepthBuffer, uv).r;
#ifdef USE_SSR_REFRACT
return rayzmin >= (sceneZMin-ssrThickness) && rayzmax <= sceneZMin;
#else
float sceneZMax = texture2D(ssrBackfaceDepthBuffer, uv).r;
return rayzmin >= sceneZMax && rayzmax <= sceneZMin;
#endif
}
float distanceSquared(vec2 a, vec2 b) { a -= b; return dot(a, a); }
void swapIfBigger(inout float a, inout float b) {
if (a > b) {
float t = a;
a = b;
b = t;
}
}
bool isOutsideUvBounds(float x) { return x < 0.0 || x > 1.0; }
bool isOutsideUvBounds(vec2 uv) { return isOutsideUvBounds(uv.x) || isOutsideUvBounds(uv.y); }
vec3 computeSSR(vec3 color, vec3 normal, float ior) {
vec2 uv = gl_FragCoord.xy / ssrResolution;
vec2 screenCoord = uv * 2.0 - vec2(1, 1);
float nearClip = deproject(vec3(0, 0, -1)).z;
vec3 ray = deproject(vec3(screenCoord, -1));
ray /= ray.z;
float depthSample = -vViewPosition.z;
vec3 vpos = depthSample * ray;
#ifdef USE_SSR_REFRACT
vec3 dir = normalize(refract(normalize(vpos), normalize(normal), 1.0/ior));
#else
vec3 dir = normalize(reflect(normalize(vpos), normalize(normal)));
#endif
float maxDist = ssrMaxDistance;
float rayLength = (vpos.z + dir.z * maxDist) > nearClip ? (nearClip - vpos.z) / dir.z : maxDist;
vec3 csOrig = vpos;
vec3 csEndPoint = csOrig + dir * rayLength;
vec4 H0 = projectionMatrix * vec4(csOrig, 1.0);
vec4 H1 = projectionMatrix * vec4(csEndPoint, 1.0);
float k0 = 1.0 / H0.w, k1 = 1.0 / H1.w;
vec3 Q0 = csOrig.xyz * k0, Q1 = csEndPoint.xyz * k1;
vec2 P0 = H0.xy * k0, P1 = H1.xy * k1;
P0 = P0 * 0.5 + vec2(0.5), P1 = P1 * 0.5 + vec2(0.5);
#ifndef SSR_SIMPLE_REFRACT
P0 *= ssrResolution, P1 *= ssrResolution;
P1 += vec2((distanceSquared(P0, P1) < 0.0001) ? 0.01 : 0.0);
vec2 delta = P1 - P0;
bool permute = false;
if (abs(delta.x) < abs(delta.y)) {
permute = true; delta = delta.yx; P0 = P0.yx; P1 = P1.yx;
}
float stepDir = sign(delta.x);
float invdx = stepDir / delta.x;
vec3 dQ = (Q1 - Q0) * invdx;
float dk = (k1 - k0) * invdx;
vec2 dP = vec2(stepDir, delta.y * invdx);
float pixelStride = ssrStride;
float jitterMod = (gl_FragCoord.x + gl_FragCoord.y) * 0.25;
vec4 PQK = vec4(P0, Q0.z, k0);
vec4 dPQK = vec4(dP, dQ.z, dk);
dPQK *= pixelStride;
PQK += dPQK * mod(jitterMod, 1.0) * ssrJitter;
float end = P1.x * stepDir;
float prevZMaxEstimate = PQK.z / PQK.w;
float rayZMin = prevZMaxEstimate, rayZMax = prevZMaxEstimate;
float stepped = 0.0;
vec2 hitUV;
bool intersected = false;
for (float stepCount = 1.0; stepCount <= float(MAX_STEPS); stepCount ++) {
PQK += dPQK;
rayZMin = prevZMaxEstimate;
rayZMax = (dPQK.z * 0.5 + PQK.z) / (dPQK.w * 0.5 + PQK.w);
prevZMaxEstimate = rayZMax;
swapIfBigger(rayZMax, rayZMin);
stepped = stepCount;
hitUV = (permute ? PQK.yx: PQK.xy) / ssrResolution;
if (isOutsideUvBounds(hitUV)) break;
intersected = doesIntersect(rayZMax, rayZMin, hitUV);
if (intersected || (P0.x * stepDir) > end) break;
}
if (intersected && pixelStride > 1.0) {
PQK -= dPQK;
dPQK /= ssrStride;
float ogStride = pixelStride * 0.5;
float currStride = pixelStride;
prevZMaxEstimate = PQK.z / PQK.w;
rayZMin = prevZMaxEstimate, rayZMax = prevZMaxEstimate;
for(int j = 0; j < int(BINARY_SEARCH_ITERATIONS); j ++) {
PQK += dPQK * currStride;
rayZMin = prevZMaxEstimate;
rayZMax = (dPQK.z * 0.5 + PQK.z) / (dPQK.w * 0.5 + PQK.w);
prevZMaxEstimate = rayZMax;
swapIfBigger(rayZMax, rayZMin);
vec2 newUV = (permute ? PQK.yx: PQK.xy) / ssrResolution;
ogStride *= 0.5;
if (doesIntersect(rayZMax, rayZMin, newUV)) {
hitUV = newUV;
currStride = -ogStride;
} else {
currStride = ogStride;
}
}
}
vec3 result = color;
#ifdef USE_SSR_REFRACT
#endif
if (intersected) {
vec4 col = texture2D(ssrSourceBuffer, hitUV);
vec2 ndc = abs(hitUV * 2.0 - 1.0);
float maxndc = max(ndc.x, ndc.y);
float fadeVal =
(1.0 - (max(0.0, maxndc - SCREEN_FADE_THRESHOLD) / (1.0 - SCREEN_FADE_THRESHOLD))) *
(1.0 - STEPS_FADE_AMOUNT * (stepped / float(MAX_STEPS)));
col.a = fadeVal;
result = mix(result, col.rgb, col.a);
}
#else
vec3 result = texture2D(ssrSourceBuffer, P1).xyz;
#endif
return result;
}
#endif`,wY=`#ifdef USE_PLANE_REFLECTION
uniform mat4 planeReflTextureMatrix;
varying vec4 vPlaneReflUv;
#endif`,TY=`#ifdef USE_PLANE_REFLECTION
uniform sampler2D planeReflTexture;
uniform mat4 planeReflTextureMatrix;
uniform vec3 planeReflDir;
uniform vec3 planeReflBoundingBoxMin;
uniform vec3 planeReflBoundingBoxMax;
uniform mat4 planeReflInvModelMatrix;
uniform float planeReflFalloff;
varying vec4 vPlaneReflUv;
vec3 computePlaneReflection(vec3 radiance, float roughness, vec3 position, vec3 normal, mat4 modelMatrix) {
vec3 posRefl = (planeReflInvModelMatrix * invViewMatrix * vec4(position, 1.0)).xyz;
if (any(lessThan(posRefl, planeReflBoundingBoxMin)) || any(greaterThan(posRefl, planeReflBoundingBoxMax)))
return radiance;
vec3 norWorld = transformDirection(normal, invViewMatrix);
vec3 uvNormalOffsetScale;
uvNormalOffsetScale.x = length(vec3(modelMatrix[0].xyz));
uvNormalOffsetScale.y = length(vec3(modelMatrix[1].xyz));
uvNormalOffsetScale.z = length(vec3(modelMatrix[2].xyz));
vec4 uvNormalOffset = planeReflTextureMatrix * vec4((norWorld - planeReflDir) * uvNormalOffsetScale, 0.0);
vec3 result = texture2DProj(planeReflTexture, vPlaneReflUv + uvNormalOffset).rgb;
float falloffFactor;
if (planeReflFalloff < EPSILON)
falloffFactor = 0.0;
else if (posRefl.y > 0.0)
falloffFactor = 1.0 - clamp((planeReflBoundingBoxMax.y - posRefl.y) / (planeReflBoundingBoxMax.y * (planeReflFalloff)), 0.0, 1.0);
else
falloffFactor = 1.0 - clamp((planeReflBoundingBoxMin.y - posRefl.y) / (planeReflBoundingBoxMin.y * (planeReflFalloff)), 0.0, 1.0);
result = mix(result, radiance, falloffFactor);
result = mix(result, radiance, (roughness < 0.0526) ? 0.0 : saturate(10.0*roughness));
return result;
}
#endif`,RY=`#ifdef USE_PLANE_REFLECTION
vPlaneReflUv = planeReflTextureMatrix * modelMatrix * vec4(transformed, 1.0);
#endif`,IY=`#ifdef USE_OIT_WEIGHTED
layout(location = 1) out float outBufferR;
#endif`,LY=`#ifdef USE_OIT_WEIGHTED
float weight = 1.0 - gl_FragCoord.z;
outBufferR = gl_FragColor.a * weight;
pc_fragColor = vec4(gl_FragColor.rgb * weight, gl_FragColor.a);
#endif`,BY=`
#define LUM_WEIGHTS vec3(0.2126, 0.7152, 0.0722)
#define LUM_WEIGHTS_MAYA vec3(0.3, 0.59, 0.11)
#define LUMENS_PER_WATT 683.0
#define MAX_ENV_COORDS_DIR 0
#define MAX_ENV_COORDS_REFLECT 1
#define MAX_ENV_COORDS_REFRACT 2
#if defined(NODE_COLOR_CONVERT_AR) || defined(NODE_COLOR_CORRECT_AR) || defined(NODE_COMBINE_COLOR_BL) || defined(NODE_SEPARATE_COLOR_BL) || defined(NODE_COMBHSV_BL) || defined(NODE_SEPHSV_BL) || defined(NODE_HUE_SAT_BL) || defined(NODE_COLOR_CORRECTION_MX) || defined(NODE_COMPOSITE_LAYER_MX) || defined(NODE_COLOR_CORRECT_MY) || defined(USE_OSL)
#define HSV_NODES
#endif
#define OPENPBR_EMISSION_LUM_FACTOR 0.001
float powCompat(const in float val, const in float power) {
if (power == 0.0)
return 1.0;
else if (val < 0.0) {
if (mod(-power, 2.0) == 0.0)
return pow(abs(val), power);
else
return -pow(abs(val), power);
} else if (val == 0.0)
return 0.0;
return pow(abs(val), power);
}
float maxFromRGB(vec3 rgb) {
return max(max(rgb.r, rgb.g), rgb.b);
}
vec3 swizzleUpZ(const vec3 vec) {
return vec3(vec[0], -vec[2], vec[1]);
}
vec3 swizzleUpY(const vec3 vec) {
return vec3(vec[0], vec[2], -vec[1]);
}
float getSmoothFactor(float a, float b, float smoothness) {
return max(smoothness - abs(a - b), 0.0) / smoothness;
}
float smoothMin(float a, float b, float smoothness) {
float smoothFac = getSmoothFactor(a, b, smoothness);
return min(a, b) - smoothFac * smoothFac * smoothFac * smoothness * (1.0 / 6.0);
}
float smoothMax(float a, float b, float smoothness) {
float smoothFac = getSmoothFactor(a, b, smoothness);
return max(a, b) + smoothFac * smoothFac * smoothFac * smoothness * (1.0 / 6.0);
}
float mat3GetDeterminant(mat3 mat) {
return mat[0][0] * mat[1][1] * mat[2][2]
+ mat[0][2] * mat[1][0] * mat[2][1]
+ mat[0][1] * mat[1][2] * mat[2][0]
- mat[0][2] * mat[1][1] * mat[2][0]
- mat[0][0] * mat[1][2] * mat[2][1]
- mat[0][1] * mat[1][0] * mat[2][2];
}
mat3 mat3RotateX(float angle) {
float s = sin(angle), c = cos(angle);
return mat3(1.0, 0.0, 0.0,
0.0, c, s,
0.0, -s, c);
}
mat3 mat3RotateY(float angle) {
float s = sin(angle), c = cos(angle);
return mat3(c, 0.0, -s,
0.0, 1.0, 0.0,
s, 0.0, c);
}
mat3 mat3RotateZ(float angle) {
float s = sin(angle), c = cos(angle);
return mat3(c, s, 0.0,
-s, c, 0.0,
0.0, 0.0, 1.0);
}
vec3 vec3RotateXAngle(vec3 vector, float angle) {
return mat3RotateX(angle) * vector;
}
vec3 vec3RotateYAngle(vec3 vector, float angle) {
return mat3RotateY(angle) * vector;
}
vec3 vec3RotateZAngle(vec3 vector, float angle) {
return mat3RotateZ(angle) * vector;
}
vec4 eulerToAxisAngle(vec3 euler) {
float c1 = cos(euler.x / 2.0), c2 = cos(euler.y / 2.0), c3 = cos(euler.z / 2.0);
float s1 = sin(euler.x / 2.0), s2 = sin(euler.y / 2.0), s3 = sin(euler.z / 2.0);
vec4 axisAngle = vec4(
s1 * c2 * c3 - c1 * s2 * s3,
c1 * s2 * c3 + s1 * c2 * s3,
c1 * c2 * s3 - s1 * s2 * c3,
2.0 * acos(c1 * c2 * c3 + s1 * s2 * s3)
);
axisAngle.xyz = length(axisAngle.xyz) > 0.0 ? normalize(axisAngle.xyz) : vec3(1.0, 0.0, 0.0);
return axisAngle;
}
mat3 axisAngleToMat3(vec3 axis, float angle) {
float s = sin(angle), c = cos(angle);
float t = 1.0 - c;
float x = axis.x, y = axis.y, z = axis.z;
float tx = t * x, ty = t * y;
return mat3(tx * x + c, tx * y - s * z, tx * z + s * y,
tx * y + s * z, ty * y + c, ty * z - s * x,
tx * z - s * y, ty * z + s * x, t * z * z + c);
}
mat3 toMat3(mat4 mat) {
return mat3(mat[0][0], mat[0][1], mat[0][2],
mat[1][0], mat[1][1], mat[1][2],
mat[2][0], mat[2][1], mat[2][2]);
}
mat4 toMat4(mat3 mat) {
return mat4(mat[0][0], mat[0][1], mat[0][2], 0.0,
mat[1][0], mat[1][1], mat[1][2], 0.0,
mat[2][0], mat[2][1], mat[2][2], 0.0,
0.0, 0.0, 0.0, 1.0);
}
mat4 translationToMat4(vec3 v) {
return mat4(1.0, 0.0, 0.0, 0.0,
0.0, 1.0, 0.0, 0.0,
0.0, 0.0, 1.0, 0.0,
v.x, v.y, v.z, 1.0);
}
mat4 scalingToMat4(vec3 v) {
return mat4(v.x, 0.0, 0.0, 0.0,
0.0, v.y, 0.0, 0.0,
0.0, 0.0, v.z, 0.0,
0.0, 0.0, 0.0, 1.0);
}
vec4 nodeTexelToLinear(in vec4 color, in int sourceType) {
if (sourceType == 1)
return vec4(pow(color.rgb, vec3(2.2)), color.a);
else
return color;
}
vec3 xyz_to_sRGB(vec3 xyz) {
mat3 convMat = mat3(
3.2406, -0.9689, 0.0557,
-1.5372, 1.8758, -0.2040,
-0.4986, 0.0415, 1.0570
);
return convMat * xyz;
}
vec3 xyY_to_XYZ(float x, float y, float Y) {
float X = 0.0;
float Z = 0.0;
if (y != 0.0) {
X = (Y / y) * x;
Z = (Y / y) * (1.0 - x - y);
}
return vec3(X, Y, Z);
}
#if defined HSV_NODES
void hsvToRGB(vec4 hsv, out vec4 outCol)
{
float i, f, p, q, t, h, s, v;
vec3 rgb;
h = hsv[0];
s = hsv[1];
v = hsv[2];
if (s == 0.0)
rgb = vec3(v, v, v);
else {
if (h == 1.0)
h = 0.0;
h *= 6.0;
i = floor(h);
f = h - i;
rgb = vec3(f, f, f);
p = v * (1.0 - s);
q = v * (1.0 - (s * f));
t = v * (1.0 - (s * (1.0 - f)));
if (i == 0.0)
rgb = vec3(v, t, p);
else if (i == 1.0)
rgb = vec3(q, v, p);
else if (i == 2.0)
rgb = vec3(p, v, t);
else if (i == 3.0)
rgb = vec3(p, q, v);
else if (i == 4.0)
rgb = vec3(t, p, v);
else
rgb = vec3(v, p, q);
}
outCol = vec4(rgb, hsv.w);
}
void rgbToHSV(vec4 rgb, out vec4 outCol)
{
float cmax, cmin, h, s, v, cdelta;
vec3 c;
cmax = max(rgb[0], max(rgb[1], rgb[2]));
cmin = min(rgb[0], min(rgb[1], rgb[2]));
cdelta = cmax - cmin;
v = cmax;
if (cmax != 0.0)
s = cdelta / cmax;
else {
s = 0.0;
h = 0.0;
}
if (s == 0.0)
h = 0.0;
else {
c = (vec3(cmax, cmax, cmax) - rgb.xyz) / cdelta;
if (rgb.x == cmax) h = c[2] - c[1];
else if (rgb.y == cmax) h = 2.0 + c[0] - c[2];
else h = 4.0 + c[1] - c[0];
h /= 6.0;
if (h < 0.0)
h += 1.0;
}
outCol = vec4(h, s, v, rgb.w);
}
#endif
#if defined(NODE_REFLECT_REFRACT_MX) || defined(NODE_BITMAP_ENV_MX) || defined(NODE_ENV_SPHERE_MY)
vec4 sampleEquirectangular(sampler2D map, vec3 reflectVec, mat3 uvTransform, int encoding)
{
reflectVec = normalize(reflectVec);
vec2 sampleUV;
sampleUV.y = asin(clamp(reflectVec.y, - 1.0, 1.0)) * RECIPROCAL_PI + 0.5;
sampleUV.x = atan(reflectVec.x, reflectVec.z) * RECIPROCAL_PI2 + 0.5;
sampleUV.y *= -1.0;
const float seamWidth = 0.15;
const float seamBiasFactor = -10.0;
float seam = max(0.0, 1.0 - abs (reflectVec.x) / seamWidth) *
clamp (1.0 - reflectVec.z / seamWidth, 0.0, 1.0);
sampleUV = (uvTransform * vec3(sampleUV, 1.0)).xy;
return texture2D(map, sampleUV, seamBiasFactor * seam);
}
#endif
#if defined(NODE_FRESNEL_BL) || defined(NODE_LAYER_WEIGHT_BL) || defined(NODE_FALLOFF_MX) || defined(NODE_BSDF_GLASS_BL) || defined(NODE_BSDF_PRINCIPLED_BL)
float fresnelReflection(const vec3 dir, const vec3 normal, const float ior) {
float cosTheta = clamp(abs(dot(dir, normal)), -1.0, 1.0);
float gSquared = pow2(ior) + pow2(cosTheta) - 1.0;
if (gSquared < 0.0) return 1.0;
float g = sqrt(gSquared);
return 0.5 * pow2((g - cosTheta) / (g + cosTheta))
* (1.0 + pow2(
((g + cosTheta) * cosTheta - 1.0) /
((g - cosTheta) * cosTheta + 1.0)
));
}
#endif
#if defined(NODE_BITMAP_MX) || defined(NODE_BITMAP_ENV_MX) || defined(NODE_GRADIENT_MX) || defined(NODE_GRADIENT_RAMP_MX)
#define MAPPING_EXPLICIT_MAP_CHANNEL 1
#define MAPPING_VERTEX_COLOR_CHANNEL 2
#define MAPPING_PLANAR_OBJECT_XYZ 3
#define MAPPING_PLANAR_WORLD_XYZ 4
#define AXIS_XY 1
#define AXIS_YZ 2
#define AXIS_ZX 3
#endif
#if defined(NODE_BITMAP_MX) || defined(NODE_BITMAP_ENV_MX) || defined(NODE_BUMP_MX) || defined(NODE_GRADIENT_MX) || defined(NODE_GRADIENT_RAMP_MX) || defined(NODE_PLACE_2D_TEXTURE_MY)
mat3 calcUvTransform(float uOffset, float vOffset, float uTiling, float vTiling, float wAngle)
{
if (abs(uOffset) < EPSILON && abs(vOffset) < EPSILON &&
(abs(uTiling - 1.0)) < EPSILON && (abs(vTiling - 1.0)) < EPSILON &&
abs(wAngle) < EPSILON)
return mat3(1.0);
float sx = uTiling;
float sy = vTiling;
float c = cos(-wAngle);
float s = sin(-wAngle);
#if defined(NODE_PLACE_2D_TEXTURE_MY)
float tx = uOffset;
float ty = vOffset;
float cx = 0.5;
float cy = 0.5;
return mat3(c*sx, s*sx, 0.0,
-s*sy, c*sy, 0.0,
s*(ty+sy-cy)+c*(tx-cx)+cx, -c*(ty+sy-cy)+s*(tx-cx)-cy+1.0, 1.0);
#else
float tx = -uOffset;
float ty = -vOffset;
float cx = uOffset + 0.5;
float cy = vOffset + 0.5;
return mat3(sx * c, -sy * s, 0.0,
sx * s, sy * c, 0.0,
-sx * (c * cx + s * cy) + cx + tx, -sy * (- s * cx + c * cy) + cy + ty, 1.0);
#endif
}
#endif
#if defined(NODE_NOISE_MX)
mat4 calcXYZTransform(vec3 offset, vec3 tiling, vec3 angle) {
mat4 rot = mat4(
cos(angle.y)*cos(angle.z), cos(angle.x)*sin(angle.z)+sin(angle.x)*sin(angle.y)*cos(angle.z), sin(angle.x)*sin(angle.z)-cos(angle.x)*sin(angle.y)*cos(angle.z), 0.0,
-cos(angle.y)*sin(angle.z), cos(angle.x)*cos(angle.z)-sin(angle.x)*sin(angle.y)*sin(angle.z), cos(angle.x)*sin(angle.y)*sin(angle.z)+sin(angle.x)*cos(angle.z), 0.0,
sin(angle.y), -sin(angle.x)*cos(angle.y), cos(angle.x)*cos(angle.y), 0.0,
0.0, 0.0, 0.0, 1.0
);
mat4 til = mat4(
tiling.x, 0.0, 0.0, 0.0,
0.0, tiling.y, 0.0, 0.0,
0.0, 0.0, tiling.z, 0.0,
0.0, 0.0, 0.0, 1.0
);
mat4 off = mat4(
1.0, 0.0, 0.0, 0.0,
0.0, 1.0, 0.0, 0.0,
0.0, 0.0, 1.0, 0.0,
offset.x, offset.y, offset.z, 1.0
);
return (til * rot * off);
}
#endif
#if defined(NODE_TEX_NOISE_BL) || defined(NODE_TEX_WAVE_BL) || defined(NODE_NOISE_MX) || defined(USE_OSL) || defined(NODE_NOISE_MY)
#define NOISE_AMP_HACK 0.75
#define NOISE_BLENDER_MEAN 0.78
#define NOISE_SCALE_HACK 0.5
#define noiseModulo(x) (x - floor(x * (1.0 / 289.0)) * 289.0)
vec4 noisePermute(vec4 x) {
return noiseModulo(((x * 34.0) + 1.0) * x);
}
vec4 taylorInvSqrt(vec4 r) {
return 1.79284291400159 - 0.85373472095314 * r;
}
float taylorInvSqrt(float r) {
return 1.79284291400159 - 0.85373472095314 * r;
}
float noisePerlin(vec3 v) {
const vec2 C = vec2(1.0 / 6.0, 1.0 / 3.0);
const vec4 D = vec4(0.0, 0.5, 1.0, 2.0);
vec3 i = floor(v + dot(v, C.yyy));
vec3 x0 = v - i + dot(i, C.xxx);
vec3 g = step(x0.yzx, x0.xyz);
vec3 l = 1.0 - g;
vec3 i1 = min(g.xyz, l.zxy);
vec3 i2 = max(g.xyz, l.zxy);
vec3 x1 = x0 - i1 + C.xxx;
vec3 x2 = x0 - i2 + C.yyy;
vec3 x3 = x0 - D.yyy;
i = noiseModulo(i);
vec4 p = noisePermute(noisePermute(noisePermute(i.z + vec4(0.0, i1.z, i2.z, 1.0))
+ i.y + vec4(0.0, i1.y, i2.y, 1.0)) + i.x + vec4(0.0, i1.x, i2.x, 1.0));
float n_ = 0.142857142857;
vec3 ns = n_ * D.wyz - D.xzx;
vec4 j = p - 49.0 * floor(p * ns.z * ns.z);
vec4 x_ = floor(j * ns.z);
vec4 y_ = floor(j - 7.0 * x_);
vec4 x = x_ * ns.x + ns.yyyy;
vec4 y = y_ * ns.x + ns.yyyy;
vec4 h = 1.0 - abs(x) - abs(y);
vec4 b0 = vec4(x.xy, y.xy);
vec4 b1 = vec4(x.zw, y.zw);
vec4 s0 = floor(b0) * 2.0 + 1.0;
vec4 s1 = floor(b1) * 2.0 + 1.0;
vec4 sh = -step(h, vec4(0.0));
vec4 a0 = b0.xzyw + s0.xzyw * sh.xxyy;
vec4 a1 = b1.xzyw + s1.xzyw * sh.zzww;
vec3 p0 = vec3(a0.xy, h.x);
vec3 p1 = vec3(a0.zw, h.y);
vec3 p2 = vec3(a1.xy, h.z);
vec3 p3 = vec3(a1.zw, h.w);
vec4 norm = taylorInvSqrt(vec4(dot(p0, p0), dot(p1, p1), dot(p2, p2), dot(p3, p3)));
p0 *= norm.x;
p1 *= norm.y;
p2 *= norm.z;
p3 *= norm.w;
vec4 m = max(0.6 - vec4(dot(x0, x0), dot(x1, x1), dot(x2, x2), dot(x3, x3)), 0.0);
m = m * m;
return 42.0 * dot(m * m, vec4(dot(p0, x0), dot(p1, x1),
dot(p2, x2), dot(p3, x3)));
}
vec4 permute(vec4 x) {
return mod(((x*34.0)+1.0)*x, 289.0);
}
float permute(float x) {
return floor(mod(((x*34.0)+1.0)*x, 289.0));
}
vec4 grad4(float j, vec4 ip) {
const vec4 ones = vec4(1.0, 1.0, 1.0, -1.0);
vec4 p,s;
p.xyz = floor( fract (vec3(j) * ip.xyz) * 7.0) * ip.z - 1.0;
p.w = 1.5 - dot(abs(p.xyz), ones.xyz);
s = vec4(lessThan(p, vec4(0.0)));
p.xyz = p.xyz + (s.xyz*2.0 - 1.0) * s.www;
return p;
}
float snoise(vec4 v) {
const vec2 C = vec2(0.138196601125010504,
0.309016994374947451);
vec4 i = floor(v + dot(v, C.yyyy) );
vec4 x0 = v - i + dot(i, C.xxxx);
vec4 i0;
vec3 isX = step( x0.yzw, x0.xxx );
vec3 isYZ = step( x0.zww, x0.yyz );
i0.x = isX.x + isX.y + isX.z;
i0.yzw = 1.0 - isX;
i0.y += isYZ.x + isYZ.y;
i0.zw += 1.0 - isYZ.xy;
i0.z += isYZ.z;
i0.w += 1.0 - isYZ.z;
vec4 i3 = clamp( i0, 0.0, 1.0 );
vec4 i2 = clamp( i0-1.0, 0.0, 1.0 );
vec4 i1 = clamp( i0-2.0, 0.0, 1.0 );
vec4 x1 = x0 - i1 + 1.0 * C.xxxx;
vec4 x2 = x0 - i2 + 2.0 * C.xxxx;
vec4 x3 = x0 - i3 + 3.0 * C.xxxx;
vec4 x4 = x0 - 1.0 + 4.0 * C.xxxx;
i = mod(i, 289.0);
float j0 = permute( permute( permute( permute(i.w) + i.z) + i.y) + i.x);
vec4 j1 = permute( permute( permute( permute (
i.w + vec4(i1.w, i2.w, i3.w, 1.0 ))
+ i.z + vec4(i1.z, i2.z, i3.z, 1.0 ))
+ i.y + vec4(i1.y, i2.y, i3.y, 1.0 ))
+ i.x + vec4(i1.x, i2.x, i3.x, 1.0 ));
vec4 ip = vec4(1.0/294.0, 1.0/49.0, 1.0/7.0, 0.0) ;
vec4 p0 = grad4(j0, ip);
vec4 p1 = grad4(j1.x, ip);
vec4 p2 = grad4(j1.y, ip);
vec4 p3 = grad4(j1.z, ip);
vec4 p4 = grad4(j1.w, ip);
vec4 norm = taylorInvSqrt(vec4(dot(p0,p0), dot(p1,p1), dot(p2, p2), dot(p3,p3)));
p0 *= norm.x;
p1 *= norm.y;
p2 *= norm.z;
p3 *= norm.w;
p4 *= taylorInvSqrt(dot(p4,p4));
vec3 m0 = max(0.6 - vec3(dot(x0,x0), dot(x1,x1), dot(x2,x2)), 0.0);
vec2 m1 = max(0.6 - vec2(dot(x3,x3), dot(x4,x4) ), 0.0);
m0 = m0 * m0;
m1 = m1 * m1;
return 49.0 * ( dot(m0*m0, vec3( dot( p0, x0 ), dot( p1, x1 ), dot( p2, x2 )))
+ dot(m1*m1, vec2( dot( p3, x3 ), dot( p4, x4 ) ) ) ) ;
}
float noiseBlender(vec3 p) {
return 0.5 * NOISE_AMP_HACK * (noisePerlin(NOISE_SCALE_HACK * vec3(p.x, p.y, p.z))) + 0.5;
}
float noiseSmooth(vec3 p, float octaveLenPerPixel, float falloffFactor,
float dispersionFactor) {
float mixFac = mix(1.0, smoothstep(0.0, 1.0, octaveLenPerPixel) * falloffFactor,
dispersionFactor);
return mix(noiseBlender(p), NOISE_BLENDER_MEAN, mixFac);
}
#define MAX_OCTAVES_NUM 16
float noiseTurbulence(vec3 p, float octaves, float octaveLenPerPixel,
float falloffFactor, float dispersionFactor) {
float fscale = 1.0;
float amp = 1.0;
float sum = 0.0;
octaves = clamp(octaves, 0.0, 16.0);
int octavesInt = int(octaves);
for (int i = 0; i <= MAX_OCTAVES_NUM; i++) {
#if __VERSION__ == 300
if (i <= octavesInt) {
float t = noiseSmooth(fscale * p, octaveLenPerPixel, falloffFactor,
dispersionFactor);
sum += t * amp;
amp *= 0.5;
fscale *= 2.0;
octaveLenPerPixel *= 2.0;
} else {
i = MAX_OCTAVES_NUM;
}
#else
if (i > octavesInt) break;
float t = noiseSmooth(fscale * p, octaveLenPerPixel, falloffFactor,
dispersionFactor);
sum += t * amp;
amp *= 0.5;
fscale *= 2.0;
octaveLenPerPixel *= 2.0;
#endif
}
float octavesFrac = fract(octaves);
float octavesCoeff = pow(2.0, float(octavesInt));
if (octavesFrac != 0.0) {
float t = noiseSmooth(fscale * p, octaveLenPerPixel, falloffFactor,
dispersionFactor);
float sum2 = sum + t * amp;
sum *= octavesCoeff / (2.0 * octavesCoeff - 1.0);
sum2 *= 2.0 * octavesCoeff / (4.0 * octavesCoeff - 1.0);
return mix(sum, sum2, octavesFrac);
} else {
return sum * octavesCoeff / (2.0 * octavesCoeff - 1.0);
}
}
#endif
#if (defined(USE_OSL) || defined(NODE_WAVELENGTH_BL)) && __VERSION__ == 300
vec3 cieColorMatch[81] = vec3[](
vec3(0.0014,0.0000,0.0065), vec3(0.0022,0.0001,0.0105), vec3(0.0042,0.0001,0.0201),
vec3(0.0076,0.0002,0.0362), vec3(0.0143,0.0004,0.0679), vec3(0.0232,0.0006,0.1102),
vec3(0.0435,0.0012,0.2074), vec3(0.0776,0.0022,0.3713), vec3(0.1344,0.0040,0.6456),
vec3(0.2148,0.0073,1.0391), vec3(0.2839,0.0116,1.3856), vec3(0.3285,0.0168,1.6230),
vec3(0.3483,0.0230,1.7471), vec3(0.3481,0.0298,1.7826), vec3(0.3362,0.0380,1.7721),
vec3(0.3187,0.0480,1.7441), vec3(0.2908,0.0600,1.6692), vec3(0.2511,0.0739,1.5281),
vec3(0.1954,0.0910,1.2876), vec3(0.1421,0.1126,1.0419), vec3(0.0956,0.1390,0.8130),
vec3(0.0580,0.1693,0.6162), vec3(0.0320,0.2080,0.4652), vec3(0.0147,0.2586,0.3533),
vec3(0.0049,0.3230,0.2720), vec3(0.0024,0.4073,0.2123), vec3(0.0093,0.5030,0.1582),
vec3(0.0291,0.6082,0.1117), vec3(0.0633,0.7100,0.0782), vec3(0.1096,0.7932,0.0573),
vec3(0.1655,0.8620,0.0422), vec3(0.2257,0.9149,0.0298), vec3(0.2904,0.9540,0.0203),
vec3(0.3597,0.9803,0.0134), vec3(0.4334,0.9950,0.0087), vec3(0.5121,1.0000,0.0057),
vec3(0.5945,0.9950,0.0039), vec3(0.6784,0.9786,0.0027), vec3(0.7621,0.9520,0.0021),
vec3(0.8425,0.9154,0.0018), vec3(0.9163,0.8700,0.0017), vec3(0.9786,0.8163,0.0014),
vec3(1.0263,0.7570,0.0011), vec3(1.0567,0.6949,0.0010), vec3(1.0622,0.6310,0.0008),
vec3(1.0456,0.5668,0.0006), vec3(1.0026,0.5030,0.0003), vec3(0.9384,0.4412,0.0002),
vec3(0.8544,0.3810,0.0002), vec3(0.7514,0.3210,0.0001), vec3(0.6424,0.2650,0.0000),
vec3(0.5419,0.2170,0.0000), vec3(0.4479,0.1750,0.0000), vec3(0.3608,0.1382,0.0000),
vec3(0.2835,0.1070,0.0000), vec3(0.2187,0.0816,0.0000), vec3(0.1649,0.0610,0.0000),
vec3(0.1212,0.0446,0.0000), vec3(0.0874,0.0320,0.0000), vec3(0.0636,0.0232,0.0000),
vec3(0.0468,0.0170,0.0000), vec3(0.0329,0.0119,0.0000), vec3(0.0227,0.0082,0.0000),
vec3(0.0158,0.0057,0.0000), vec3(0.0114,0.0041,0.0000), vec3(0.0081,0.0029,0.0000),
vec3(0.0058,0.0021,0.0000), vec3(0.0041,0.0015,0.0000), vec3(0.0029,0.0010,0.0000),
vec3(0.0020,0.0007,0.0000), vec3(0.0014,0.0005,0.0000), vec3(0.0010,0.0004,0.0000),
vec3(0.0007,0.0002,0.0000), vec3(0.0005,0.0002,0.0000), vec3(0.0003,0.0001,0.0000),
vec3(0.0002,0.0001,0.0000), vec3(0.0002,0.0001,0.0000), vec3(0.0001,0.0000,0.0000),
vec3(0.0001,0.0000,0.0000), vec3(0.0001,0.0000,0.0000), vec3(0.0000,0.0000,0.0000)
);
#endif
#if defined(USE_OSL) || defined(NODE_BLACKBODY_BL)
vec3 colorTempToRGB(float temp)
{
vec3 retColor;
temp = clamp(temp, 100.0, 40000.0) / 100.0;
if (temp <= 66.0) {
retColor.r = 1.0;
retColor.g = saturate(0.390081578 * log(temp) - 0.631841443);
} else {
float t = temp - 60.0;
retColor.r = saturate(1.292936186 * pow(t, -0.133204759));
retColor.g = saturate(1.129890860 * pow(t, -0.075514849));
}
if (temp >= 66.0)
retColor.b = 1.0;
else if (temp <= 19.0)
retColor.b = 0.0;
else
retColor.b = saturate(0.543206789 * log(temp - 10.0) - 1.196254089);
retColor.rgb = pow(retColor.rgb, vec3(2.2));
return retColor;
}
#endif
#if (defined(NODE_TEX_WHITE_NOISE_BL) || defined(NODE_TEX_GABOR_BL)) && __VERSION__ == 300
#define rotUint32(x, k) (((x) << (k)) | ((x) >> (32 - (k))))
#define mixUint32(a, b, c) { a -= c; a ^= rotUint32(c, 4); c += b; b -= a; b ^= rotUint32(a, 6); a += c; c -= b; c ^= rotUint32(b, 8); b += a; a -= c; a ^= rotUint32(c, 16); c += b; b -= a; b ^= rotUint32(a, 19); a += c; c -= b; c ^= rotUint32(b, 4); b += a; }
#define finalUint32(a, b, c) { c ^= b; c -= rotUint32(b, 14); a ^= c; a -= rotUint32(c, 11); b ^= a; b -= rotUint32(a, 25); c ^= b; c -= rotUint32(b, 16); a ^= c; a -= rotUint32(c, 4); b ^= a; b -= rotUint32(a, 14); c ^= b; c -= rotUint32(b, 24); }
uint hashUint(uint x) {
uint a = 0xdeadbeefu + 17u + x;
uint b = 0xdeadbeefu + 17u;
uint c = 0xdeadbeefu + 17u;
finalUint32(a, b, c);
return c;
}
uint hashUint2(uvec2 vec) {
uvec3 abc = uvec3(0xdeadbeefu + 21u) + uvec3(vec, 0u);
finalUint32(abc.x, abc.y, abc.z);
return abc.z;
}
uint hashUint3(uvec3 vec) {
uvec3 abc = uvec3(0xdeadbeefu + 25u) + vec;
finalUint32(abc.x, abc.y, abc.z);
return abc.z;
}
uint hashUint4(uvec4 vec) {
uvec3 abc = uvec3(0xdeadbeefu + 29u) + vec.xyz;
mixUint32(abc.x, abc.y, abc.z);
abc.x += vec.w;
finalUint32(abc.x, abc.y, abc.z);
return abc.z;
}
#undef rotUint32
#undef mixUint32
#undef finalUint32
float uintToFloat(uint value) {
return float(value) / float(0xFFFFFFFFu);
}
float hashFloatToFloat(float value) {
return uintToFloat(hashUint(floatBitsToUint(value)));
}
float hashVec2ToFloat(vec2 vec) {
return uintToFloat(hashUint2(floatBitsToUint(vec)));
}
float hashVec3ToFloat(vec3 vec) {
return uintToFloat(hashUint3(floatBitsToUint(vec)));
}
float hashVec4ToFloat(vec4 vec) {
return uintToFloat(hashUint4(floatBitsToUint(vec)));
}
vec2 hashVec3ToVec2(vec3 k) {
return vec2(hashVec3ToFloat(k.xyz), hashVec3ToFloat(k.zxy));
}
vec2 hashVec4ToVec2(vec4 k) {
return vec2(hashVec4ToFloat(k.xyzw), hashVec4ToFloat(k.zxwy));
}
vec3 hashFloatToVec3(float val) {
return vec3(hashFloatToFloat(val), hashVec2ToFloat(vec2(val, 1.0)),
hashVec2ToFloat(vec2(val, 2.0)));
}
vec3 hashVec2ToVec3(vec2 vec) {
return vec3(hashVec2ToFloat(vec), hashVec3ToFloat(vec3(vec, 1.0)),
hashVec3ToFloat(vec3(vec, 2.0)));
}
vec3 hashVec3ToVec3(vec3 vec) {
return vec3(hashVec3ToFloat(vec), hashVec4ToFloat(vec4(vec, 1.0)),
hashVec4ToFloat(vec4(vec, 2.0)));
}
vec3 hashVec4ToVec3(vec4 vec) {
return vec3(hashVec4ToFloat(vec.xyzw), hashVec4ToFloat(vec.zxwy),
hashVec4ToFloat(vec.wzyx));
}
#endif`,PY=`#ifdef USE_OSL
#define M_PI PI
#define M_PI_2 PI / 2.0
#define M_PI_4 PI / 4.0
#define M_2_PI 2.0 / PI
#define M_2PI 2.0 * PI
#define M_4PI 4.0 * PI
#define M_2_SQRTPI 2.0 / sqrt(PI)
#define M_E 2.718281828459
#define M_LN2 0.69314718056
#define M_LN10 2.30258509299
#define M_LOG2E 1.4426950409
#define M_LOG10E 0.43429448190
#define M_SQRT2 sqrt(2.0)
#define M_SQRT1_2 sqrt(0.5)
#define OSL_ALPHA 33633
#define OSL_ANISOTROPIC 40205
#define OSL_AVERAGEALPHA 57701
#define OSL_AVERAGECOLOR 46077
#define OSL_BANDWIDTH 37485
#define OSL_BEZIER 27645
#define OSL_BLACK 62409
#define OSL_BSPLINE 16959
#define OSL_CAMERA 8198
#define OSL_CAMERA_CLIP 34380
#define OSL_CAMERA_CLIP_FAR 31933
#define OSL_CAMERA_CLIP_NEAR 21485
#define OSL_CAMERA_FOV 60706
#define OSL_CAMERA_PIXELASPECT 4950
#define OSL_CAMERA_PROJECTION 29369
#define OSL_CAMERA_RESOLUTION 39679
#define OSL_CAMERA_SCREEN_WINDOW 47009
#define OSL_CAMERA_SHUTTER 7107
#define OSL_CAMERA_SHUTTER_CLOSE 34406
#define OSL_CAMERA_SHUTTER_OPEN 40085
#define OSL_CATMULL_ROM 31642
#define OSL_CELL 20984
#define OSL_CHANNELS 8726
#define OSL_CLAMP 20052
#define OSL_COLOR 53753
#define OSL_COMMON 49871
#define OSL_CONSTANT 25144
#define OSL_DATAWINDOW 54276
#define OSL_DEFAULT 54870
#define OSL_DIFFUSE 40389
#define OSL_DIRECTION 42220
#define OSL_DISPLAYWINDOW 30728
#define OSL_DISTANCE 51337
#define OSL_DO_FILTER 35765
#define OSL_EMPTY 9314
#define OSL_ERRORMESSAGE 38305
#define OSL_EXISTS 41510
#define OSL_FILL 39132
#define OSL_FIRSTCHANNEL 48155
#define OSL_GABOR 57764
#define OSL_GEOM_NAME 63686
#define OSL_GLOSSY 47998
#define OSL_HASH 49390
#define OSL_HERMITE 63643
#define OSL_HIT 48491
#define OSL_HITDIST 22029
#define OSL_HSL 49898
#define OSL_HSV 29073
#define OSL_IMPULSES 56191
#define OSL_INDEX 1731
#define OSL_INTERP 10557
#define OSL_LINEAR 2182
#define OSL_MIRROR 64591
#define OSL_MISSINGALPHA 39755
#define OSL_MISSINGCOLOR 51667
#define OSL_NDC 48899
#define OSL_NORMAL 16520
#define OSL_OBJECT 59084
#define OSL_OSL_VERSION 47920
#define OSL_PERIODIC 8749
#define OSL_PERLIN 730
#define OSL_POSITION 43041
#define OSL_RASTER 2618
#define OSL_REFLECTION 37621
#define OSL_REFRACTION 37287
#define OSL_RESOLUTION 48704
#define OSL_RGB 26673
#define OSL_RWRAP 47801
#define OSL_SCREEN 55875
#define OSL_SHADER 21066
#define OSL_SHADER_GROUPNAME 62327
#define OSL_SHADER_LAYERNAME 51796
#define OSL_SHADER_SHADERNAME 65123
#define OSL_SHADOW 60708
#define OSL_SIMPLEX 61636
#define OSL_SUBIMAGE 33526
#define OSL_SUBIMAGES 2366
#define OSL_SWRAP 4328
#define OSL_TEXTUREFORMAT 17851
#define OSL_TIME 52235
#define OSL_TRACE 62908
#define OSL_TWRAP 30524
#define OSL_TYPE 64071
#define OSL_UPERLIN 65308
#define OSL_USIMPLEX 11314
#define OSL_WIDTH 48751
#define OSL_WORLD 9059
#define OSL_WORLDTOCAMERA 32273
#define OSL_WORLDTOSCREEN 33876
#define OSL_WRAP 58300
#define OSL_XYY 2228
#define OSL_XYZ 47351
#define OSL_YIQ 15839
vec3 oslGetP(vec3 viewPos) {
#if WORLD_NODES == 1
return swizzleUpZ((invViewMatrix * vec4(-viewPos, 0.0)).xyz);
#else
return swizzleUpZ((invViewMatrix * vec4(-viewPos, 1.0)).xyz);
#endif
}
vec3 oslGetI(vec3 viewPos) {
#if WORLD_NODES == 1
return swizzleUpZ((invViewMatrix * vec4(normalize(-viewPos), 0.0)).xyz);
#else
return swizzleUpZ((invViewMatrix * vec4(normalize(-viewPos), 0.0)).xyz);
#endif
}
vec3 oslGetN(vec3 viewNorm) {
return swizzleUpZ(normalize(invViewMatrix * vec4(viewNorm, 0.0)).xyz);
}
vec3 oslBlackbody(float temperatureK) {
return vec4(colorTempToRGB(temperatureK), 1.0).rgb;
}
float oslDistance(vec3 p0, vec3 p1) {
return distance(p0, p1);
}
float oslDistance(vec3 p0, vec3 p1, vec3 q) {
vec3 d = p1 - p0;
float dd = dot(d, d);
if (dd == 0.0)
return distance(q, p0);
float t = dot(q - p0, d) / dd;
return distance(q, p0 + clamp(t, 0.0, 1.0) * d);
}
int oslEndsWith(int name1, int name2) {
return int(name1 == name2);
}
int oslFormat(int name1, int name2) {
return name2;
}
int oslGetAttribute(int name, out int value) {
value = 0;
return 0;
}
int oslGetAttribute(int name, out float value) {
value = 0.0;
return 0;
}
int oslGetAttribute(int name, out vec3 vec) {
vec = vec3(0.0, 0.0, 0.0);
return 0;
}
void oslGetTextureInfo(int filename, int name, out int value) {
value = 4;
}
void oslGetTextureInfo(int filename, int name, out int value[2]) {
value[0] = 1024;
value[1] = 1024;
}
vec3 oslHSV(float h, float s, float v) {
vec4 outCol;
hsvToRGB(vec4(h, s, v, 1.0), outCol);
return outCol.rgb;
}
float oslHypot(float x, float y) {
return sqrt(x*x + y*y);
}
float oslHypot(float x, float y, float z) {
return sqrt(x*x + y*y + z*z);
}
float oslLog2(float x, float y) {
return log(x) / log(y);
}
float oslLuminance(vec3 color) {
return linearToRelativeLuminance(color);
}
float oslNoise(int type, vec3 vec, float phase) {
float n = snoise(vec4(vec, phase));
if (type == OSL_UPERLIN)
n = n * 0.5 + 0.5;
return n;
}
float oslNoise(int type, float value, float phase) {
return oslNoise(type, vec3(value), phase);
}
float oslNoise(int type, vec3 vec) {
return oslNoise(type, vec, 0.0);
}
float oslNoise(int type, float value) {
return oslNoise(type, vec3(value), 0.0);
}
vec3 oslNoise3D(int type, vec3 vec, float phase) {
float x = snoise(vec4(vec, phase));
float y = snoise(vec4(vec.y, vec.x, vec.z, phase));
float z = snoise(vec4(vec.y, vec.z, vec.x, phase));
vec3 n = vec3(x, y, z);
if (type == OSL_UPERLIN)
n = n * 0.5 + 0.5;
return n;
}
vec3 oslNoise3D(int type, float value, float phase) {
return oslNoise3D(type, vec3(value), phase);
}
vec3 oslNoise3D(int type, vec3 vec) {
return oslNoise3D(type, vec, 0.0);
}
vec3 oslNoise3D(int type, float value) {
return oslNoise3D(type, vec3(value), 0.0);
}
float oslPow(float a, float b) {
return pow(a, b);
}
vec3 oslPow(vec3 a, float b) {
return pow(a, vec3(b));
}
int oslRayType(int name) {
if (name == OSL_CAMERA)
#if LIGHT_PATH_IS_CAM_RAY
return 1;
#else
return 0;
#endif
else
return 0;
}
vec3 oslRotate(vec3 vec, float angle, vec3 p0, vec3 p1) {
vec3 axis = normalize(p1 - p0);
float c = cos(angle);
float s = sin(angle);
float x = axis[0];
float y = axis[1];
float z = axis[2];
mat4 mat = mat4(
x * x + (1.0 - x * x) * c, x * y * (1.0 - c) + z * s, x * z * (1.0 - c) - y * s, 0.0,
x * y * (1.0 - c) - z * s, y * y + (1.0 - y * y) * c, y * z * (1.0 - c) + x * s, 0.0,
x * z * (1.0 - c) + y * s, y * z * (1.0 - c) - x * s, z * z + (1.0 - z * z) * c, 0.0,
0.0, 0.0, 0.0, 1.0
);
return (mat * vec4((vec - p0), 1.0) + vec4(p0, 1.0)).xyz;
}
vec3 oslRotate(vec3 vec, float angle, vec3 axis) {
return oslRotate(vec, angle, vec3(0.0), axis);
}
int oslStartsWith(int name1, int name2) {
return int(name1 == name2);
}
int oslStrLen(int name) {
if (name == OSL_EMPTY)
return 0;
else
return 1;
}
int oslSubStr(int s, int start, int len) {
return s;
}
int oslSubStr(int s, int start) {
return s;
}
vec3 oslTexture(sampler2D image, float u, float v, int wrapModeFlag, int wrapMode, int alphaFlag, out float alpha) {
if (wrapMode == OSL_DEFAULT || wrapMode == OSL_BLACK) {
if (u < 0.0 || u > 1.0 || v < 0.0 || v > 1.0)
return vec3(0.0);
} else if (wrapMode == OSL_CLAMP) {
u = clamp(u, 0.0, 1.0);
v = clamp(v, 0.0, 1.0);
} else if (wrapMode == OSL_PERIODIC) {
u = mod(u, 1.0);
v = mod(v, 1.0);
} else if (wrapMode == OSL_MIRROR) {
if (mod(floor(u), 2.0) == 0.0)
u = u - floor(u);
else
u = 1.0 - (u - floor(u));
if (mod(floor(v), 2.0) == 0.0)
v = v - floor(v);
else
v = 1.0 - (v - floor(v));
}
vec4 colAlpha = texture2D(image, vec2(u, v));
alpha = colAlpha.a;
return colAlpha.rgb;
}
vec3 oslTexture(sampler2D image, float u, float v, int alphaFlag, out float alpha, int wrapModeFlag, int wrapMode) {
return oslTexture(image, u, v, wrapModeFlag, wrapMode, alphaFlag, alpha);
}
vec3 oslTexture(sampler2D image, float u, float v, int alphaFlag, out float alpha) {
return oslTexture(image, u, v, OSL_WRAP, OSL_DEFAULT, alphaFlag, alpha);
}
vec3 oslTexture(sampler2D image, float u, float v, int wrapModeFlag, int wrapMode) {
float alpha;
return oslTexture(image, u, v, wrapModeFlag, wrapMode, OSL_ALPHA, alpha);
}
vec3 oslTexture(sampler2D image, float u, float v) {
float alpha;
return oslTexture(image, u, v, OSL_WRAP, OSL_DEFAULT, OSL_ALPHA, alpha);
}
vec3 oslTexture(sampler2D image, float u, float v, int wrapModeFlag, int wrapMode, int colorSpaceFlag, int colorSpace) {
float alpha;
return oslTexture(image, u, v, wrapModeFlag, wrapMode, OSL_ALPHA, alpha);
}
vec3 oslTransform(int fromSpace, int toSpace, vec4 vec) {
if (toSpace == OSL_WORLD || toSpace == OSL_SHADER || toSpace == OSL_COMMON) {
return vec.xyz;
} else if (toSpace == OSL_OBJECT) {
vec = vec4(swizzleUpY(vec.xyz), vec.w);
vec = invModelMatrix * vec;
return swizzleUpZ(vec.xyz);
} else if (toSpace == OSL_CAMERA) {
vec = vec4(swizzleUpY(vec.xyz), vec.w);
return (viewMatrix * vec).xyz;
} else if (toSpace == OSL_SCREEN) {
return vec.xyz;
} else if (toSpace == OSL_RASTER) {
return gl_FragCoord.xyz;
} else if (toSpace == OSL_NDC) {
return vec.xyz;
} else {
return vec.xyz;
}
}
vec3 oslTransform(int fromSpace, int toSpace, vec3 vec) {
return oslTransform(fromSpace, toSpace, vec4(vec, 1.0));
}
vec3 oslTransform(int toSpace, vec3 vec) {
return oslTransform(OSL_COMMON, toSpace, vec4(vec, 1.0));
}
vec3 oslTransformDir(int fromSpace, int toSpace, vec3 vec) {
return oslTransform(fromSpace, toSpace, vec4(vec, 0.0));
}
vec3 oslTransformDir(int toSpace, vec3 vec) {
return oslTransform(OSL_COMMON, toSpace, vec4(vec, 0.0));
}
vec3 oslTransformC(int fromSpace, int toSpace, vec3 vec) {
vec4 outVec = vec4(vec, 1.0);
if (fromSpace == OSL_HSV && toSpace == OSL_RGB)
hsvToRGB(vec4(vec, 1.0), outVec);
else if (fromSpace == OSL_RGB && toSpace == OSL_HSV)
rgbToHSV(vec4(vec, 1.0), outVec);
return outVec.rgb;
}
vec3 oslTransformC(int toSpace, vec3 vec) {
return oslTransformC(OSL_RGB, toSpace, vec);
}
void oslError() {}
void oslFPrintf() {}
void oslPrintf() {}
void oslWarning() {}
vec3 oslWaveLengthColor(float lambdaNM) {
#if __VERSION__ == 300
vec3 xyz = vec3(0.0);
float ii = (lambdaNM - 380.0) / 5.0;
int i = int(ii);
if (i < 0 || i >= 80)
return xyz;
ii -= float(i);
vec3 c1 = cieColorMatch[i];
vec3 c2 = cieColorMatch[i+1];
xyz = mix(c1, c2, ii);
return xyz_to_sRGB(xyz);
#else
return vec3(0.0);
#endif
}
#endif`,NY=`void node_incident(vec3 viewPos, out vec3 incident)
{

vec4 viewDir = vec4(normalize(viewPos), 0.0);
incident = -swizzleUpZ(viewDir.xyz);
}`,DY=`void node_normal(vec3 norParam, out vec3 norOut)
{
#ifdef MT_BLENDER
#if WORLD_NODES == 1
vec4 viewDir = isOrthographic ? vec4(0.0, 0.0, -1.0, 0.0) : vec4(normalize(-vViewPosition), 0.0);
viewDir = invViewMatrix * viewDir;
norOut = -swizzleUpZ(viewDir.xyz);
#else
norOut = normalize(invViewMatrix * vec4(norParam, 0.0)).xyz;
norOut = swizzleUpZ(norOut);
#endif
#else
norOut = norParam;
#endif
}`,OY=`void node_position(vec3 posParam, out vec3 posOut)
{
#if defined(MT_BLENDER) || defined(MT_MAX)
posOut = swizzleUpZ(-posParam);
#else
posOut = -posParam;
#endif
}`,FY=`uniform vec4 nodeRGB[NODE_RGB_NUM];
void node_rgb_alpha(vec4 color, out vec3 outColor, out float outAlpha)
{
outColor = color.rgb;
outAlpha = color.a;
}`,UY=`uniform float nodeValue[NODE_VALUE_NUM];
void node_value(float value, out float outValue)
{
outValue = value;
}`,zY=`void node_u_float(vec2 inUv, out float u)
{
u = inUv.x;
}`,VY=`void node_abs(
vec3 inputVal,
out vec3 outColor)
{
outColor = abs(inputVal);
}`,kY=`void node_add(
vec3 input1, vec3 input2,
out vec3 outColor)
{
outColor = input1 + input2;
}`,GY=`void node_atan(
int units,
vec3 x, vec3 y,
out vec3 outColor)
{
outColor = atan(y, x);
if (units == 1)
outColor = degrees(outColor);
}`,QY=`void node_checkerboard(
const vec2 inUv, vec3 color1, vec3 color2, float uFrequency, float vFrequency, float uOffset, float vOffset, float contrast,
out vec3 outColor) {
vec2 uv = -1.0 + 2.0 * inUv;
float fmodResult = mod(floor(uOffset * 2.0 + uFrequency * uv.x) + floor(vOffset * 2.0 + vFrequency * uv.y), 2.0);
float final = max(sign(fmodResult), 0.0);
vec3 col = vec3(final);
if (final == 0.0)
col = color1;
else
col = color2;
outColor = col * vec3(contrast) + vec3(1.0 - contrast);
}`,HY=`void node_clamp(
const int mode,
vec3 inputValue, float minValue, float maxValue, vec3 minColor, vec3 maxColor,
out vec3 outColor, out vec3 outTransparency)
{
if (mode == 0)
outColor = clamp(inputValue, vec3(minValue), vec3(maxValue));
else
outColor = clamp(inputValue, minColor, maxColor);
outTransparency = outColor;
}`,WY=`void node_color_to_float(
const int mode,
vec3 inputValue,
out float outValue)
{
if (mode == 0)
outValue = min(min(inputValue.r, inputValue.g), inputValue.b);
else if (mode == 1)
outValue = max(max(inputValue.r, inputValue.g), inputValue.b);
else if (mode == 2)
outValue = (inputValue.r + inputValue.g + inputValue.b) / 3.0;
else if (mode == 3)
outValue = inputValue.r + inputValue.g + inputValue.b;
else if (mode == 4) {
outValue = dot(inputValue, LUM_WEIGHTS);
}
else if (mode == 5)
outValue = inputValue.r;
else if (mode == 6)
outValue = inputValue.g;
else if (mode == 7)
outValue = inputValue.b;
}`,YY=`void node_color_convert(
const int from, const int to,
vec3 inputValue,
out vec3 outColor, out vec3 outTransparency)
{
vec4 c;
if (from == to)
c = vec4(inputValue, 1.0);
else if (from == 0) 
rgbToHSV(vec4(inputValue, 1.0), c);
else if (from == 1)
hsvToRGB(vec4(inputValue, 1.0), c);
outColor = c.rgb;
outTransparency = outColor;
}`,jY=`void node_color_correct(
vec3 inputValue, float mask, float gamma, float hueShift, float saturation, float contrast, float contrastPivot,
float exposure, vec3 multiply, vec3 add, bool invert, bool alphaIsLuminance, float alphaMultiply, float alphaAdd, bool invertAlpha,
out vec3 outColor, out float outAlpha)
{ 
outColor = inputValue;
outColor = invert ? 1.0 - outColor : outColor;
outColor = vec3(pow(abs(outColor.r), gamma), pow(abs(outColor.g), gamma), pow(abs(outColor.b), gamma));
vec4 hsv;
rgbToHSV(vec4(outColor, 1.0), hsv);
hsv[0] += hueShift / 360.0;
if (hsv[0] > 1.0)
hsv[0] -= 1.0;
else if (hsv[0] < 0.0)
hsv[0] += 1.0;

hsv[1] *= (saturation);
hsv[1] = saturate(hsv[1]);
hsv[2] += exposure * 2.0;
vec4 c = hsv;
hsvToRGB(hsv, c);
c = ((c - contrastPivot) * contrast + contrastPivot) * vec4(multiply, 1.0) + vec4(add, 1.0);
outColor = c.rgb;
outAlpha = 1.0;
}`,XY=`void node_compare(
int test,
float input1, float input2,
out bool outValue)
{
if (test == 0)
outValue = input1 == input2;
else if (test == 1)
outvalue = input1 != input2;
else if (test == 2)
outValue = input1 < input2;
else if (test == 3)
outValue = input1 > input2;
else if (test == 4)
outValue = input1 <= input2;
else if (test == 5)
outValue = input1 >= input2;
}`,qY=`void node_complement(
vec3 inputValue,
out vec3 outColor)
{
outColor = 1.0 - inputValue;
}`,ZY=`void node_composite(
const int operation, const int alphaOperation,
vec3 A, vec3 B, float AA, float BA,
out float outAlpha, out vec3 outColor, out vec3 outTransparency)
{
vec4 A1 = vec4(A, AA);
vec4 B1 = vec4(B, BA);
vec4 color = vec4(0.0);
if (operation == 0)
color = A1;
else if (operation == 1)
color = B1;
else if (operation == 2)
color = A1 * B1.a + B1 * (1.0 - A1.a);
else if (operation == 3)
color = (A1 + B1) / 2.0;
else if (operation == 4)
color = A1.a > B1.a ? A1 : (A1 + B1 * (1.0 - A1.a) / B1.a);
else if (operation == 5)
color = abs(A1 - B1);
else if (operation == 6)
color = A1.a + B1.a < 1.0 ? A1 + B1 : A1 + B1 * (1.0 - A1.a) / B1.a;
else if (operation == 7)
for (int i = 0; i < 4; i++)
color[i] = B1[i] == 0.0 ? 0.0 : (A1[i] / B1[i]);
else if (operation == 8)
color = A1 + B1 - 2.0 * A1 * B1;
else if (operation == 9)
color = B1 - A1;
else if (operation == 10)
color = 2.0 * A1 * B1 / (A1 + B1);
else if (operation == 11)
for (int i = 0; i < 4; i++)
color[i] = A1[i] < 0.5 ? (A1[i] * B1[i]) : (A1[i] >= 0.0 && A1[i] <= 1.0 && B1[i] >= 0.0 && B1[i] <= 1.0) ? (A1[i] + B1[i] - A1[i] * B1[i]) : max(A1[i], B1[i]);
else if (operation == 12)
color = sqrt(A1 * A1 + B1 * B1);
else if (operation == 13)
color = A1 * B1.a;
else if (operation == 14)
color = B1 * A1.a;
else if (operation == 15)
color = A1 * A1.a + B1 * (1.0 - A1.a);
else if (operation == 16)
color = max(A1, B1);
else if (operation == 17)
color = min(A1, B1);
else if (operation == 18)
color = A1 - B1;
else if (operation == 19)
color = A1 * B1;
else if (operation == 20)
color = A1 * (1.0 - B1.a);
else if (operation == 21)
color = A1 + B1 * (1.0 - A1.a);
else if (operation == 22)
for (int i = 0; i < 4; i++)
color[i] = B1[i] < 0.5 ? (A1[i] * B1[i]) : (A1[i] >= 0.0 && A1[i] <= 1.0 && B1[i] >= 0.0 && B1[i] <= 1.0) ? (A1[i] + B1[i] - A1[i] * B1[i]) : max(A1[i], B1[i]);
else if (operation == 23)
color = A1 + B1;
else if (operation == 24)
for (int i = 0; i < 4; i++)
color[i] = (A1[i] >= 0.0 && A1[i] <= 1.0 && B1[i] >= 0.0 && B1[i] <= 1.0) ? (A1[i] + B1[i] - A1[i] * B1[i]) : max(A1[i], B1[i]);

else if (operation == 25)
for (int i = 0; i < 4; i++)
color[i] = (A1[i] < .75) ? (A1[i] * B1[i]) : (A1[i] >= 0.0 && A1[i] <= 1.0 && B1[i] >= 0.0 && B1[i] <= 1.0) ? (A1[i] + B1[i] - A1[i] * B1[i]) : max(A1[i], B1[i]);
else if (operation == 26)
color = B1 * (1.0 - A1.a);
else if (operation == 27)
color = A1 * (1.0 - B1.a) + B1;
else if (operation == 28)
color = A1 * (1.0 - B1.a) + B1 * (1.0 - A1.a);
if (alphaOperation == 1)
color.a = AA;
else if (alphaOperation ==2)
color.a = BA;
outColor = color.rgb;
outAlpha = color.a;
outTransparency = outColor;
}`,KY=`void node_cross(
vec3 input1, vec3 input2,
out vec3 outValue)
{
outValue = cross(input1, input2);
}`,$Y=`void node_divide(
vec3 input1, vec3 input2,
out vec3 outColor)
{
outColor = input1 / input2;
}`,JY=`void node_dot(
vec3 input1, vec3 input2,
out vec3 outValue)
{
outValue = dot(input1, input2);
}`,ej=`void node_exp(
vec3 inputVal,
out vec3 outColor)
{
outColor = exp(inputVal);
}`,tj=`void node_facing_ratio(
vec3 viewNorm,
const float bias, const float gain, const bool invert, const bool linear,
out float outValue)
{
outValue = dot(normalize(viewNorm), normalize(vViewPosition));
}`,nj=`void node_flat(vec3 color, out vec3 outColor)
{
outColor = color;
}`,rj=`void node_float_to_int(
const int mode, 
float inputValue,
out int outValue)
{
if (mode == 0)
outValue = round(inputValue);
else if (mode == 1)
outValue = trunc(inputValue);
else if (mode == 2)
outValue = floor(inputValue);
else if (mode == 3)
outValue = ceil(inputValue);
}`,oj=`void node_float_to_matrix(
float input00, float input01, float input02, float input03, float input10, float input11, float input12, float input13, float input20, float input21, float input22, float input23, float input30, float input31, float input32, float input33,
out mat4 outValue)
{
outValue = mat4(input00, input01, input02, input03,
input10, input11, input12, input13,
input20, input21, input22, input23,
input30, input31, input32, input33);
}`,aj=`void node_float_to_rgba(
float r, float g, float b, float a,
out vec4 outColor, out float outAlpha, out vec3 outTransparency)
{
outAlpha = a;
outColor = vec4(r, g, b, a);
outTransparency = vec3(1.0 - a);
}`,ij=`void node_float_to_rgb(
float r, float g, float b,
out vec3 outValue)
{
outValue = vec3(r, g, b);
}`,sj=`void node_fraction(
vec3 inputValue,
out vec3 outColor)
{
outColor = fract(inputValue);
}`,lj=`void node_is_finite(
vec3 inputValue,
out bool outValue)
{
outValue = !any(isinf(inputValue));
}`,cj=`
void node_image(sampler2D ima, const int encoding, 
vec3 multiply, vec3 offset, vec2 uvcoords, float soffset, float toffset, float sscale, float tscale, bool sflip, bool tflip, bool swapSt,
out vec3 outColor, out float outAlpha, out vec3 outTransparency) {
vec2 uv = vec2(uvcoords.x, uvcoords.y);
uv += vec2(soffset, toffset);
uv = mix(uv.xy, uv.yx, float(swapSt));
vec2 stFlip = vec2(float(sflip), float(tflip));
uv = mix(uv, 1.0 - uv, stFlip);
uv *= vec2(sscale, tscale);
uv.y = 1.0 - uv.y;
vec4 tex = texture2D(ima, uv);
outColor = nodeTexelToLinear(tex, encoding).rgb * multiply + offset;
outAlpha = tex.a;
outTransparency = outColor.rgb;
}
void node_image(sampler2D ima, const int encoding,
vec3 multiply, vec3 offset, vec2 uvcoords, float soffset, float toffset, float sscale, float tscale, bool sflip, bool tflip, bool swapSt, vec2 dUVdx, vec2 dUVdy,
out vec3 outColor, out float outAlpha, out vec3 outTransparency) {
vec2 uv = vec2(uvcoords.x, uvcoords.y);
uv += vec2(soffset, toffset);
uv = mix(uv.xy, uv.yx, float(swapSt));
vec2 stFlip = vec2(float(sflip), float(tflip));
uv = mix(uv, 1.0 - uv, stFlip);
uv *= vec2(sscale, tscale);
uv.y = 1.0 - uv.y;
#ifdef texture2DGradEXT
vec2 dInvOp = stFlip * (-2.0) + 1.0;
dUVdx *= vec2(sscale, tscale) * dInvOp;
dUVdy *= vec2(sscale, tscale) * dInvOp;
vec4 tex = textureGrad(ima, uv, dUVdx, dUVdy);
#else
vec4 tex = texture2D(ima, uv);
#endif
outColor = nodeTexelToLinear(tex, encoding).rgb * multiply + offset;
outAlpha = tex.a;
outTransparency = outColor.rgb;
}
void node_image(sampler2D ima, const int encoding, 
vec4 multiply, vec4 offset, vec2 uvcoords, float soffset, float toffset, float sscale, float tscale, bool sflip, bool tflip, bool swapSt,
out vec4 outColor) {
vec2 uv = vec2(uvcoords.x, uvcoords.y);
uv += vec2(soffset, toffset);
uv = mix(uv.xy, uv.yx, float(swapSt));
vec2 stFlip = vec2(float(sflip), float(tflip));
uv = mix(uv, 1.0 - uv, stFlip);
uv *= vec2(sscale, tscale);
uv.y = 1.0 - uv.y;
vec4 tex = texture2D(ima, uv);
outColor = nodeTexelToLinear(tex, encoding).rgba * multiply + offset;
}
void node_image(sampler2D ima, const int encoding,
vec4 multiply, vec4 offset, vec2 uvcoords, float soffset, float toffset, float sscale, float tscale, bool sflip, bool tflip, bool swapSt, vec2 dUVdx, vec2 dUVdy,
out vec4 outColor) {
vec2 uv = vec2(uvcoords.x, uvcoords.y);
uv += vec2(soffset, toffset);
uv = mix(uv.xy, uv.yx, float(swapSt));
vec2 stFlip = vec2(float(sflip), float(tflip));
uv = mix(uv, 1.0 - uv, stFlip);
uv *= vec2(sscale, tscale);
uv.y = 1.0 - uv.y;
#ifdef texture2DGradEXT
vec2 dInvOp = stFlip * (-2.0) + 1.0;
dUVdx *= vec2(sscale, tscale) * dInvOp;
dUVdy *= vec2(sscale, tscale) * dInvOp;
vec4 tex = textureGrad(ima, uv, dUVdx, dUVdy);
#else
vec4 tex = texture2D(ima, uv);
#endif
outColor = nodeTexelToLinear(tex, encoding).rgba * multiply + offset;
}`,uj=`void node_lambert(
vec3 geometryNormal,
float base, vec3 baseColor, vec3 normalCamera, vec3 opacity,
out vec4 outColor, out float outAlpha, out vec3 outTransparency)
{
NodeMaterial material;
material.diffuseColor = base * baseColor;
ReflectedLight reflectedLight = ReflectedLight(vec3(0.0), vec3(0.0), vec3(0.0), vec3(0.0));
#ifdef USE_CLEARCOAT
#undef USE_CLEARCOAT
#define _CLEARCOAT_RESTORE
#endif
vec3 normal = normalCamera;
#define RE_Direct RE_DirectDiffuseOnly_Node
#define RE_IndirectDiffuse RE_IndirectDiffuse_Node
#include <lights_fragment_begin>
#include <lights_fragment_maps>
#include <lights_fragment_end>
#undef RE_Direct
#undef RE_IndirectDiffuse
#ifdef _CLEARCOAT_RESTORE
#undef _CLEARCOAT_RESTORE
#define USE_CLEARCOAT
#endif
outAlpha = average(opacity);
outColor = vec4(reflectedLight.directDiffuse + reflectedLight.indirectDiffuse, outAlpha);
outTransparency = vec3(1.0) - opacity;
}`,dj=`void node_length(
int mode,
vec3 inputVec,
out float outValue)
{
if (mode == 0)
outValue = length(inputVec);
else if (mode == 1)
outValue = dot(inputVec, inputVec);
else
outValue = abs(inputVec.x) + abs(inputVec.y) + abs(inputVec.z);
}`,fj=`void node_log(
vec3 inputVec, vec3 base,
out vec3 outColor)
{
outColor = log(inputVec) / log(base);
}`,hj=`void node_map_to_mtl(bool opaqueEnabled, vec4 color, out vec4 outColor)
{
outColor = vec4(color.rgb, opaqueEnabled ? color.a : 1.0);
}`,pj=`
void node_matrix_transform(
const int transformOrder, const int rotationType, const int rotationUnits, const int rotationOrder,
vec3 rotationEuler, vec3 rotationAxis, float rotationAngle, vec3 translation, vec3 scaling, vec3 pivot,
out mat4 outMatrix)
{
mat4 tMat = translationToMat4(translation);
mat4 sMat = scalingToMat4(scaling);
mat4 rMat = mat4(1.0);
if (rotationType == 0) {
vec3 rot = float(rotationUnits) * radians(rotationEuler) + float(1 - rotationUnits) * rotationEuler;
mat3 matX = mat3RotateX(rot.x);
mat3 matY = mat3RotateY(-rot.y);
mat3 matZ = mat3RotateZ(rot.z);
mat3 rotMat3;
if (rotationOrder == 0) {
rotMat3 = matX * matY * matZ;
} else if (rotationOrder == 1) {
rotMat3 = matX * matZ * matY;
} else if (rotationOrder == 2) {
rotMat3 = matY * matX * matZ;
} else if (rotationOrder == 3) {
rotMat3 = matY * matZ * matX;
} else if (rotationOrder == 4) {
rotMat3 = matZ * matX * matY;
} else if (rotationOrder == 5) {
rotMat3 = matZ * matY * matX;
}
rMat = toMat4(rotMat3);
} else if (rotationType == 1) {
float angleInRadians = float(rotationUnits) * radians(rotationAngle) + float(1 - rotationUnits) * rotationAngle;
rotationAxis = normalize(rotationAxis);
rMat = toMat4(axisAngleToMat3(rotationAxis, angleInRadians));
}
if (transformOrder == 0) {
outMatrix = sMat * rMat * tMat;
} else if (transformOrder == 1) {
outMatrix = sMat * tMat * rMat;
} else if (transformOrder == 2) {
outMatrix = rMat * sMat * tMat;
} else if (transformOrder == 3) {
outMatrix = rMat * tMat * sMat;
} else if (transformOrder == 4) {
outMatrix = tMat * sMat * rMat;
} else if (transformOrder == 5) {
outMatrix = tMat * rMat * sMat;
}
mat4 rotX90 = toMat4(mat3RotateX(PI * 0.5));
mat4 pivotMat = translationToMat4(pivot);
mat4 invPivotMat = inverse(pivotMat);
outMatrix = invPivotMat * outMatrix * pivotMat * rotX90;
}
void node_matrix_transform(
const int transformOrder, const int rotationType, const int rotationUnits, const int rotationOrder,
vec3 rotationEuler, vec3 rotationAxis, float rotationAngle, vec3 translation, vec3 scaling, vec3 pivot,
out mat4 outMatrix, out vec3 outTransparency)
{
mat4 tMat = translationToMat4(translation);
mat4 sMat = scalingToMat4(scaling);
mat4 rMat = mat4(1.0);
if (rotationType == 0) {
vec3 rot = mix(rotationEuler, radians(rotationEuler), float(rotationUnits));
mat3 matX = mat3RotateX(rot.x);
mat3 matY = mat3RotateY(-rot.y);
mat3 matZ = mat3RotateZ(rot.z);
mat3 rotMat3;
if (rotationOrder == 0) {
rotMat3 = matX * matY * matZ;
} else if (rotationOrder == 1) {
rotMat3 = matX * matZ * matY;
} else if (rotationOrder == 2) {
rotMat3 = matY * matX * matZ;
} else if (rotationOrder == 3) {
rotMat3 = matY * matZ * matX;
} else if (rotationOrder == 4) {
rotMat3 = matZ * matX * matY;
} else if (rotationOrder == 5) {
rotMat3 = matZ * matY * matX;
}
rMat = toMat4(rotMat3);
} else if (rotationType == 1) {
float angleInRadians = mix(rotationAngle, radians(rotationAngle), float(rotationUnits));
rotationAxis = normalize(rotationAxis);
rMat = toMat4(axisAngleToMat3(rotationAxis, angleInRadians));
}
outMatrix = rMat;
if (transformOrder == 0) {
outMatrix = sMat * rMat * tMat;
} else if (transformOrder == 1) {
outMatrix = sMat * tMat * rMat;
} else if (transformOrder == 2) {
outMatrix = rMat * sMat * tMat;
} else if (transformOrder == 3) {
outMatrix = rMat * tMat * sMat;
} else if (transformOrder == 4) {
outMatrix = tMat * sMat * rMat;
} else if (transformOrder == 5) {
outMatrix = tMat * rMat * sMat;
}
mat4 pivotMat = translationToMat4(pivot);
mat4 invPivotMat = inverse(pivotMat);
outMatrix = invPivotMat * outMatrix * pivotMat;
}`,mj=`void node_max(
vec3 input1, vec3 input2,
out vec3 outColor)
{
outColor = max(input1, input2);
}`,gj=`void node_min(
vec3 input1, vec3 input2,
out vec3 outColor)
{
outColor = min(input1, input2);
}`,vj=`void node_mix_shader(const int mode,
const float mixAmt, vec4 shader1, vec4 shader2,
out vec4 color)
{
shader1.rgb *= shader1.a;
shader2.rgb *= shader2.a;
if (mode == 0)
color = mix(shader1, shader2, clamp(mixAmt, 0.0, 1.0));
else
color = vec4(shader1.rgb + shader2.rgb, min(shader1.a, shader2.a));
color.rgb /= color.a;
}`,_j=`void node_modulo(
vec3 inputVec, vec3 divisor,
out vec3 outColor)
{
outColor = mod(inputVec, divisor);
}`,Aj=`void node_multiply(
vec3 input1, vec3 input2,
out vec3 outColor)
{
outColor = input1 * input2;
}`,xj=`void node_negate(
vec3 inputVec,
out vec3 outColor)
{
outColor = -inputVec;
}`,yj=`void node_normalize(
vec3 inputVec,
out vec3 outValue)
{
outValue = normalize(inputVec);
}`,bj=`void node_normal_map(
vec4 tangentParam,
vec3 inputVal, vec3 normal, float strength, vec3 tangent,
out vec3 outValue) {
#ifdef DOUBLE_SIDED
normal = normal * (float(gl_FrontFacing) * 2.0 - 1.0);
#endif
vec3 normalTex = inputVal.xyz * 2.0 - 1.0;
vec3 bitangent = tangentParam.w * cross(normal, tangent);
outValue = normalize(normalTex.x * tangent + normalTex.y * bitangent + normalTex.z * normal);
}`,Sj=`void node_pow(
vec3 base, vec3 exponent,
out vec3 outColor)
{
outColor = pow(base, exponent);
}`,Cj=`void node_abs(
vec3 inputColor,
out vec3 outColor)
{
outColor = inputColor;
}`,Ej=`void node_range(
vec3 inputValue, float inputMin, float inputMax, 
float outputMin, float outputMax, bool smoothstep1, 
float contrast, float contrastPivot, float bias, float gain,
out vec3 outColor, out vec3 outTransparency)
{

outColor = min(max(inputValue, vec3(inputMin)), vec3(inputMax));
outColor = (outColor - contrastPivot) * contrast + contrastPivot;
if (smoothstep1 == true) {
for (int i = 0; i < 3; i++)
outColor[i] = smoothstep(outputMin, outputMax, outColor[i]);
} else
outColor = min(max(outColor, vec3(outputMin)), vec3(outputMax));
outTransparency = outColor;
}`,Mj=`void node_ray_switch(vec3 camera, vec3 diffuseReflection, vec3 diffuseTransmission,
vec3 shadow, vec3 specularReflection, vec3 specularTransmission,
out vec3 outColor, out float outAlpha)
{
#if LIGHT_PATH_IS_CAM_RAY
outColor = camera;
#else
outColor = diffuseReflection;
#endif
outAlpha = 1.0;
}`,wj=`void node_reciprocal(
vec3 inputVec,
out vec3 outColor)
{
outColor = 1.0 / inputVec;
}`,Tj=`void node_rgba_to_float(
const int mode,
vec3 inputValue, float inputA,
out float outValue, out vec3 outTransparency)
{
outTransparency = inputValue + vec3(inputA / 4.0);
if (mode == 0)
outValue = min(min(min(inputValue.r, inputValue.g), inputValue.b), inputA);
else if (mode == 1)
outValue = max(max(max(inputValue.r, inputValue.g), inputValue.b), inputA);
else if (mode == 2)
outValue = (inputValue.r + inputValue.g + inputValue.b + inputA) / 4.0;
else if (mode == 3)
outValue = inputValue.r + inputValue.g + inputValue.b + inputA;
else if (mode == 4) {
outValue = dot(inputValue, LUM_WEIGHTS);
}
else if (mode == 5)
outValue = inputValue.r;
else if (mode == 6)
outValue = inputValue.g;
else if (mode == 7)
outValue = inputValue.b;
}`,Rj=`void node_rgb_to_float(
const int mode,
vec3 inputValue,
out float outValue)
{
if (mode == 0)
outValue = min(min(inputValue.r, inputValue.g), inputValue.b);
else if (mode == 1)
outValue = max(max(inputValue.r, inputValue.g), inputValue.b);
else if (mode == 2)
outValue = (inputValue.r + inputValue.g + inputValue.b) / 3.0;
else if (mode == 3)
outValue = inputValue.r + inputValue.g + inputValue.b;
else if (mode == 4) {
outValue = dot(inputValue, LUM_WEIGHTS);
}
else if (mode == 5)
outValue = inputValue.r;
else if (mode == 6)
outValue = inputValue.g;
else if (mode == 7)
outValue = inputValue.b;
}`,Ij=`void node_rgb_to_vector(
const int mode, 
vec3 inputValue,
out vec3 outValue)
{

outValue = inputValue;
}`,Lj=`#include <shadowmask_pars_fragment>
void node_shadow_matte(
vec3 normal,
vec3 shadowColor, float backlighting, float shadowOpacity,
out vec4 outColor, out float outAlpha) {
float shadow = getShadowMask();
outColor = vec4(shadowColor, shadowOpacity * (1.0 - shadow));
outAlpha = outColor.a;
}`,Bj=`
void node_shuffle(const int channelR, const int channelG, const int channelB, const int channelA,
vec3 color, float alpha, bool negateR, bool negateG, bool negateB, bool negateA,
out vec3 outColor, out float outAlpha)
{
outColor = vec3(0.0);
vec4 choose = vec4(color, alpha);
outAlpha = 1.0;
#if __VERSION__ == 100
outColor.r = choose[0];
outColor.g = choose[1];
outColor.b = choose[2];
outAlpha = choose[3];
#else
outColor.r = choose[channelR];
outColor.g = choose[channelG];
outColor.b = choose[channelB];
outAlpha = choose[channelA];
#endif
if (negateR)
outColor.r = -outColor.r;
if (negateG)
outColor.g = -outColor.g;
if (negateB)
outColor.b = -outColor.b;
if (negateA)
outAlpha = -outAlpha;
}
void node_shuffle(const int channelR, const int channelG, const int channelB, const int channelA,
vec4 color, float alpha, bool negateR, bool negateG, bool negateB, bool negateA,
out vec4 outColor)
{
outColor = vec4(0.0);
vec4 choose = vec4(color.rgb, alpha);
#if __VERSION__ == 100
outColor.r = choose[0];
outColor.g = choose[1];
outColor.b = choose[2];
outColor.a = choose[3];
#else
outColor.r = choose[channelR];
outColor.g = choose[channelG];
outColor.b = choose[channelB];
outColor.a = choose[channelA];
#endif
if (negateR)
outColor.r = -outColor.r;
if (negateG)
outColor.g = -outColor.g;
if (negateB)
outColor.b = -outColor.b;
if (negateA)
outColor.a = -outColor.a;
}`,Pj=`void node_sign(
vec3 inputVec,
out vec3 outColor)
{
outColor = sign(inputVec);
}`,Nj=`void node_skydome_light(vec3 color, float intensity,
out vec4 outgoingLight)
{
outgoingLight = vec4(color * intensity, 1.0);
}`,Dj=`void node_sqrt(
vec3 inputVec,
out vec3 outColor)
{
outColor = sqrt(inputVec);
}`,Oj=`void node_standard_surface(
vec3 geometryNormal, const bool thinWalled,
const float base, const vec3 baseColor, const float diffuseRoughness,
const float metalness, const float specular, const vec3 specularColor,
const float specularRoughness, const float trans, const vec3 transColor,
const float transDepth, const vec3 transScatter, const float transExtraRoughness,
const float subsurface, const vec3 subsurfaceColor, const vec3 subsurfaceRadius,
const float clearcoat, const vec3 clearcoatColor, const float clearcoatRoughness,
const float sheen, const vec3 sheenColor, const float sheenRoughness,
const float emission, const vec3 emissionColor, const vec3 opacity,
const vec3 normal, const vec3 clearcoatNormal, const float specularIOR,
out vec4 outColor, out vec3 outTransparency)
{
NodeMaterial material;
vec3 baseColorWeighted = base * baseColor.rgb;
material.diffuseColor = baseColorWeighted * (1.0 - metalness) * (1.0 - trans);
#ifdef USE_CLEARCOAT
material.clearcoat = saturate(clearcoat);
material.clearcoatRoughness = clamp(clearcoatRoughness, 0.0, 1.0);
material.clearcoatF0 = vec3(0.04);
material.clearcoatF90 = 1.0;
#endif
#ifdef USE_SHEEN
material.sheenColor = saturate(sheen * sheenColor);
material.sheenRoughness = clamp(sheenRoughness, 0.0, 1.0);
#endif
vec3 dxy = max(abs(dFdx(geometryNormal)), abs(dFdy(geometryNormal)));
float geometryRoughness = max(max(dxy.x, dxy.y), dxy.z);
material.roughness = max(specularRoughness, 0.0525);
material.roughness += geometryRoughness;
material.roughness = min(material.roughness, 1.0);
vec3 specularColorWeighted = specular * specularColor;
vec3 dielRefl = pow2((1.0 - specularIOR) / (1.0 + specularIOR)) * specularColorWeighted;
material.specularColor = mix(dielRefl, baseColorWeighted, metalness);
material.fresnelRefl90 = mix(specularColorWeighted, vec3(1.0), metalness);
material.specularF90 = average(material.fresnelRefl90);
material.refractionColor = pow(trans * (1.0 - metalness) * transColor.rgb, vec3(2.0));
material.refractionIOR = specularIOR;
material.refractionRoughness = material.roughness;
ReflectedLight reflectedLight = ReflectedLight(vec3(0.0), vec3(0.0), vec3(0.0), vec3(0.0));
vec3 refractedLight = vec3(0.0);
#ifdef USE_GTAO
vec4 gtaoVisibilityBentNormal = texture2D(gtaoMap,
gl_FragCoord.xy / currResolution);
vec3 bentNormal = normalize(unpackRGBToNormal(gtaoVisibilityBentNormal.gba));
#define PROBE_NORMAL bentNormal
#endif
#define RE_Direct RE_Direct_Node
#define RE_IndirectDiffuse RE_IndirectDiffuse_Node
#define RE_IndirectSpecular RE_IndirectSpecular_Node
#define RE_Refraction RE_Refraction_Node
#include <lights_fragment_begin>
#include <lights_fragment_maps>
#include <lights_fragment_end>
#undef RE_Direct
#undef RE_IndirectDiffuse
#undef RE_IndirectSpecular
#undef RE_Refraction
#ifdef PROBE_NORMAL
#undef PROBE_NORMAL
#endif
#ifdef USE_GTAO
reflectedLight.indirectDiffuse *= gtaoVisibilityBentNormal.r;
float gtaoVisibility = gtaoVisibilityBentNormal.r;
vec3 gtaoBentNormal = bentNormal;
vec3 gtaoViewDir = geometry.viewDir;
vec3 gtaoNormal = normal;
float gtaoRoughness = material.roughness;
#endif
#include <lights_fragment_gtso>
vec3 totalEmissiveRadiance = emission * emissionColor;
vec3 outSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
vec3 outColor3 = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse +
outSpecular + totalEmissiveRadiance;
#ifdef USE_SHEEN
float sheenEnergyComp = 1.0 - 0.157 * max3(material.sheenColor);
outColor3 = outColor3 * sheenEnergyComp + sheenSpecular;
#endif
#ifdef USE_CLEARCOAT
float dotNVcc = saturate(dot(geometry.normal, geometry.viewDir));
vec3 Fcc = F_Schlick(material.clearcoatF0, material.clearcoatF90, dotNVcc);
outColor3 = outColor3 * (1.0 - material.clearcoat * Fcc) + clearcoatSpecular * material.clearcoat;
#endif
float alpha = 1.0;
if (thinWalled) {
alpha = average(opacity) * (1.0 - saturate(trans) + maxFromRGB(outSpecular) * saturate(trans));
} else {
outColor3 += refractedLight;
}
outColor = vec4(outColor3, saturate(alpha));
outTransparency = outColor3;
}
void node_standard_surface(
vec3 geometryNormal, const bool thinWalled,
const float base, const vec3 baseColor, const float diffuseRoughness,
const float metalness, const float specular, const vec3 specularColor,
const float specularRoughness, const float trans, const vec3 transColor,
const float transDepth, const vec3 transScatter, const float transExtraRoughness,
const float subsurface, const vec3 subsurfaceColor, const vec3 subsurfaceRadius,
const float clearcoat, const vec3 clearcoatColor, const float clearcoatRoughness,
const float sheen, const vec3 sheenColor, const float sheenRoughness,
const float emission, const vec3 emissionColor, const vec3 opacity,
const vec3 normal, const vec3 clearcoatNormal,
out vec4 outColor, out vec3 outTransparency)
{
node_standard_surface(
geometryNormal, thinWalled,
base, baseColor, diffuseRoughness,
metalness, specular, specularColor,
specularRoughness, trans, transColor,
transDepth, transScatter, transExtraRoughness,
subsurface, subsurfaceColor, subsurfaceRadius,
clearcoat, clearcoatColor, clearcoatRoughness,
sheen, sheenColor, sheenRoughness,
emission, emissionColor, opacity,
normal, clearcoatNormal, 1.5,
outColor, outTransparency);
}`,Fj=`void node_subtract(
vec3 input1, vec3 input2,
out vec3 outColor)
{
outColor = input1 - input2;
}`,Uj=`void node_trigo(
const int function, const int units,
vec3 inputVec, float frequency, float phase,
out vec3 outColor)
{
if (units == 1 && function >= 0 && function <=2)
inputVec = radians(inputVec);
if (function == 0)
outColor = cos(inputVec * frequency + phase);
else if (function == 1)
outColor = sin(inputVec * frequency + phase);
else if (function == 2)
outColor = tan(inputVec * frequency + phase);
else if (function == 3)
outColor = acos(inputVec * frequency + phase);
else if (function == 4)
outColor = asin(inputVec * frequency + phase);
else if (function == 5)
outColor = atan(inputVec * frequency + phase);
else if (function == 6)
outColor = cosh(inputVec * frequency + phase);
else if (function == 7)
outColor = sinh(inputVec * frequency + phase);
else
outColor = tanh(inputVec * frequency + phase);
if (units == 1 && function >= 3 && function <=5)
outColor = degrees(outColor);
}`,zj=`
void node_triplanar(
const int coordSpace, const bool inputPerAxis, const bool flipOnOppositeDirection, const float blendFactor,
vec4 inputColor, vec4 inputColorY, vec4 inputColorZ, vec3 scaling, vec3 rotation, vec3 offset, vec3 normal,
out vec4 outColor)
{
if (inputPerAxis == true) {
vec3 barycentric = abs(normal);
barycentric /= barycentric.x + barycentric.y + barycentric.z;
vec3 edgeShape = min(min(barycentric.yzx, barycentric.zxy),
(blendFactor - 1.0) / (blendFactor - 3.0));
vec3 edgeValue = (1.0 - blendFactor) * (1.0 - edgeShape) / 2.0;
vec3 weight = max((barycentric - edgeValue) / (1.0 - edgeValue), EPSILON);
weight /= (weight.x + weight.y + weight.z);
outColor = weight.x * inputColor + weight.y * inputColorY + weight.z * inputColorZ;
} else {
outColor = inputColor;
}
}
void node_triplanar(
const int coordSpace, const bool inputPerAxis, const bool flipOnOppositeDirection, const float blendFactor,
vec3 inputColor, vec3 inputColorY, vec3 inputColorZ, vec3 scaling, vec3 rotation, vec3 offset, vec3 normal,
out vec3 outColor)
{
if (inputPerAxis == true) {
vec3 barycentric = abs(normal);
barycentric /= barycentric.x + barycentric.y + barycentric.z;
vec3 edgeShape = min(min(barycentric.yzx, barycentric.zxy),
(blendFactor - 1.0) / (blendFactor - 3.0));
vec3 edgeValue = (1.0 - blendFactor) * (1.0 - edgeShape) / 2.0;
vec3 weight = max((barycentric - edgeValue) / (1.0 - edgeValue), EPSILON);
weight /= (weight.x + weight.y + weight.z);
outColor = weight.x * inputColor + weight.y * inputColorY + weight.z * inputColorZ;
} else {
outColor = inputColor;
}
}`,Vj=`
float screenSpaceDither12(vec2 vScreenPos) {
float vDither = dot(vec2(171.0, 231.0), vScreenPos.xy);
return fract(vDither / 103.0);
}
vec3 smoothContrast(vec3 alpha, float contrast) {
vec3 powAlpha = pow(alpha, vec3(contrast));
return powAlpha / (powAlpha.x + powAlpha.y + powAlpha.z);
}
void node_triplanar_uv(
const bool flipOnOppositeDirection, const float blendFactor,
vec3 vector, vec3 normal,
out vec2 outUV, out vec2 dUVdx, out vec2 dUVdy)
{
vec3 norm = normal;
float fp = float(flipOnOppositeDirection);
vec2 xFac = mix(vec2(1.0), vec2(-sign(norm.x), 1.0), fp);
vec2 uvX = vec2(vector.z, vector.y) * xFac + 0.5;
vec2 yFac = mix(vec2(1.0), vec2(1.0, -sign(norm.y)), fp);
vec2 uvY = vec2(vector.x, vector.z) * yFac + 0.5;
vec2 zFac = vec2(mix(1.0, sign(norm.z), fp), 1.0);
vec2 uvZ = vec2(vector.x, vector.y) * zFac + 0.5;
#ifdef texture2DGradEXT
vec3 alpha = abs(norm);
float contrast = mix(20.0, 1.0, blendFactor);
alpha = smoothContrast(alpha, contrast);
float dither = screenSpaceDither12(gl_FragCoord.xy);
dither = clamp(dither, 0.01, 0.99);
vec3 duvwdx = dFdx(vector);
vec3 duvwdy = dFdy(vector);
if (alpha.x > dither) {
outUV = uvX;
dUVdx = duvwdx.yz * xFac;
dUVdy = duvwdy.yz * xFac;
} else if (1.-alpha.z > dither) {
outUV = uvY;
dUVdx = duvwdx.xz * yFac;
dUVdy = duvwdy.xz * yFac;
} else {
outUV = uvZ;
dUVdx = duvwdx.xy * zFac;
dUVdy = duvwdy.xy * zFac;
}
#else
vec3 absNorm = abs(norm);
vec3 faceMask = step(absNorm.yzx, absNorm) * step(absNorm.zxy, absNorm);
outUV = faceMask.x * uvX + faceMask.y * uvY + faceMask.z * uvZ;
#endif
}
void node_triplanar_uv(
const bool flipOnOppositeDirection, const int projectionAxis,
vec3 vector, vec3 normal,
out vec2 outUV)
{
vec3 norm = normal;
float fp = float(flipOnOppositeDirection);
if (projectionAxis == 0) {
vec2 xFac = mix(vec2(1.0), vec2(-sign(norm.x), 1.0), fp);
outUV = vec2(vector.z, vector.y) * xFac + 0.5;
} else if (projectionAxis == 1) {
vec2 yFac = mix(vec2(1.0), vec2(1.0, -sign(norm.y)), fp);
outUV = vec2(vector.x, vector.z) * yFac + 0.5;
} else if (projectionAxis == 2) {
vec2 zFac = vec2(mix(1.0, sign(norm.z), fp), 1.0);
outUV = vec2(vector.x, vector.y) * zFac + 0.5;
} else if (projectionAxis == 3) {
vec2 xFac = mix(vec2(1.0), vec2(-sign(norm.x), 1.0), fp);
vec2 uvX = vec2(vector.z, vector.y) * xFac + 0.5;
vec2 yFac = mix(vec2(1.0), vec2(1.0, -sign(norm.y)), fp);
vec2 uvY = vec2(vector.x, vector.z) * yFac + 0.5;
vec2 zFac = vec2(mix(1.0, sign(norm.z), fp), 1.0);
vec2 uvZ = vec2(vector.x, vector.y) * zFac + 0.5;
vec3 absNorm = abs(norm);
vec3 faceMask = step(absNorm.yzx, absNorm) * step(absNorm.zxy, absNorm);
outUV = faceMask.x * uvX + faceMask.y * uvY + faceMask.z * uvZ;
}
}`,kj=`void node_two_sided(
float frontFacing,
vec3 front, vec3 back,
out vec3 outColor)
{
outColor = (frontFacing > 0.0) ? front : back;
}`,Gj=`void node_user_data_color(vec4 color, 
out vec3 outColor, out float outAlpha)
{
outColor = color.rgb;
outAlpha = color.a;
}`,Qj=`#define TEX_PROJ_PLANAR 0
#define TEX_PROJ_SPHERICAL 1
#define TEX_PROJ_CYLINDRICAL 2
#define TEX_PROJ_BALL 3
#define TEX_PROJ_CUBIC 4
#define TEX_PROJ_SHRINK_WRAP 5
#define COORD_WORLD_SPACE 0
#define COORD_OBJECT_SPACE 1
void node_uv_projection(
const int projectionType, const int coordSpace,
vec3 projectionColor, float uAngleDegrees, float vAngleDegrees, mat4 matrix,
out vec2 outUV)
{
vec3 vector = vWorldPosition.xyz;
if (coordSpace == COORD_OBJECT_SPACE) {
vector = (invModelMatrix * vec4(vector, 1.0)).xyz;
}
vector = (matrix * vec4(vector, 1.0)).xyz;
if (projectionType == TEX_PROJ_PLANAR) {
outUV = vector.xy * 0.5 + 0.5;
} else if (projectionType == TEX_PROJ_SPHERICAL) {
vector = normalize(vector);
float uAngle = radians(uAngleDegrees);
float vAngle = radians(vAngleDegrees);
float theta = atan(vector.x, vector.z) / (uAngle);
theta = theta * 0.5 + 0.5;
float vAngleNormalized = vAngle * 2.0 / PI;
float phi = (acos(-vector.y) / PI - 0.5) / vAngleNormalized + 0.5;
outUV = vec2(theta, phi);
} else if (projectionType == TEX_PROJ_CYLINDRICAL) {
vector.xz = normalize(vector).xz;
float uAngle = radians(uAngleDegrees);
vec2 uv = vec2((atan(vector.x, vector.z)) / (uAngle), (vector.y) / 2.0);
outUV = uv + 0.5;
} else if (projectionType == TEX_PROJ_BALL) {
vec3 normal = normalize(vector);
normal.z += 1.0;
normal /= (2.0 * sqrt(max(0.5 * normal.z, 0.0)));
outUV = clamp(0.5 * normal.xy + 0.5, 0.0, 1.0);
} else if (projectionType == TEX_PROJ_CUBIC) {
vec2 uvX = vec2(vector.z, vector.y) / abs(vector.x);
vec2 uvY = vec2(vector.x, vector.z) / abs(vector.y);
vec2 uvZ = vec2(vector.x, vector.y) / abs(vector.z);
vec3 absVec = abs(vector);
vec3 faceMask = step(absVec.yzx, absVec) * step(absVec.zxy, absVec);
vec2 uv = faceMask.x * uvX + faceMask.y * uvY + faceMask.z * uvZ;
uv = uv * 0.5 + 0.5;
outUV = uv;
} else if (projectionType == TEX_PROJ_SHRINK_WRAP) {
vector = normalize(vector);
outUV = normalize(vector.xz) * acos(vector.y) / PI;
outUV = outUV * 0.5 + 0.5;
}
}`,Hj=`void node_vector_to_rgb(
const int mode, 
vec3 inputValue,
out vec3 outColor)
{
if (mode == 0)
outColor = inputValue;
else if (mode == 1)
outColor = normalize(inputValue);
else if (mode == 2)
outColor = inputValue;
}`,Wj=`void node_add_shader(vec4 color1, vec4 color2, out vec4 outColor) {
outColor.rgb = color1.rgb + color2.rgb;
outColor.a = clamp(color1.a + color2.a, 0.0, 1.0);
}`,Yj=`void node_ambient_occlusion(vec4 color, float distance, vec3 normal,
out vec4 outColor, out float outAO) {
outColor = color;
outAO = 1.0;
}`,jj=`void node_attribute(vec4 paramAttr,
out vec4 outColor, out vec3 outVector, out float outFac, out float outAlpha) {
outColor = vec4(paramAttr.xyz, 1.0);
outVector = paramAttr.xyz;
outFac = average(paramAttr.xyz);
outAlpha = paramAttr.w;
}`,Xj=`void node_background(vec4 color, float strength, out vec4 outColor)
{
outColor = strength * color;
}`,qj=`void node_bevel(float radius, vec3 normal, out vec3 outNormal) {
outNormal = normal;
}`,Zj=`void node_blackbody(float temp, out vec4 outColor)
{
outColor = vec4(colorTempToRGB(temp), 1.0);
}`,Kj=`void node_brightcontrast(vec4 color, float bright, float contrast, out vec4 outColor)
{
float bminc = bright - contrast * 0.5;
outColor.r = max((1.0 + contrast) * color.r + bminc, 0.0);
outColor.g = max((1.0 + contrast) * color.g + bminc, 0.0);
outColor.b = max((1.0 + contrast) * color.b + bminc, 0.0);
outColor.a = color.a;
}`,$j=`void node_bsdf_anisotropic(
vec4 color, float roughness, float anisotropy, float rotation, vec3 normal, vec3 tangent,
out vec4 outColor)
{
outColor = color;
}`,Jj=`
void node_bsdf_diffuse(
vec4 color, float roughness, vec3 normal,
out vec4 outColor) {
normal = vec3(normal[0], normal[2], -normal[1]);
normal = (viewMatrix * vec4(normal.xyz, 0.0)).xyz;
NodeMaterial material;
material.diffuseColor = color.rgb;
ReflectedLight reflectedLight = ReflectedLight(vec3(0.0), vec3(0.0), vec3(0.0), vec3(0.0));
#ifdef USE_CLEARCOAT
#undef USE_CLEARCOAT
#define _CLEARCOAT_RESTORE
#endif
#ifdef USE_GTAO
vec4 gtaoVisibilityBentNormal = texture2D(gtaoMap,
gl_FragCoord.xy / currResolution);
vec3 bentNormal = normalize(unpackRGBToNormal(gtaoVisibilityBentNormal.gba));
#define PROBE_NORMAL bentNormal
#endif
#define RE_Direct RE_DirectDiffuseOnly_Node
#define RE_IndirectDiffuse RE_IndirectDiffuse_Node
#include <lights_fragment_begin>
#include <lights_fragment_maps>
#include <lights_fragment_end>
#undef RE_Direct
#undef RE_IndirectDiffuse
#ifdef PROBE_NORMAL
#undef PROBE_NORMAL
#endif
#ifdef _CLEARCOAT_RESTORE
#undef _CLEARCOAT_RESTORE
#define USE_CLEARCOAT
#endif
#ifdef USE_GTAO
reflectedLight.indirectDiffuse *= gtaoVisibilityBentNormal.r;
#endif
outColor = vec4(reflectedLight.directDiffuse + reflectedLight.indirectDiffuse, 1.0);
}`,eX=`void node_bsdf_glass(
vec3 geometryNormal,
vec4 color, float roughness, float ior, vec3 normal,
out vec4 outColor) {
normal = normalize(normal);
normal = swizzleUpY(normal);
vec3 normalWorld = normal;
normal = (viewMatrix * vec4(normal.xyz, 0.0)).xyz;
NodeMaterial material;
material.specularColor = vec3(1.0);
material.fresnelRefl90 = vec3(1.0);
material.roughness = clamp(roughness, 0.0, 1.0);
material.refractionColor = vec3(1.0);
material.refractionIOR = ior;
material.refractionRoughness = pow2(roughness);
#if defined(ENVMAP_TYPE_CUBE) || defined(ENVMAP_TYPE_CUBE_UV)
float geomRoughness = calcGeometryRoughness(geometryNormal);
material.roughness = calcCubeUVAdjustedRoughness(
material.roughness, geomRoughness);
material.refractionRoughness = calcCubeUVAdjustedRoughness(
material.refractionRoughness, geomRoughness);
#endif
ReflectedLight reflectedLight = ReflectedLight(vec3(0.0), vec3(0.0),
vec3(0.0), vec3(0.0));
vec3 refractedLight = vec3(0.0);
#ifdef USE_CLEARCOAT
#undef USE_CLEARCOAT
#define _CLEARCOAT_RESTORE
#endif
#ifdef USE_GTAO
vec4 gtaoVisibilityBentNormal = texture2D(gtaoMap,
gl_FragCoord.xy / currResolution);
vec3 bentNormal = normalize(unpackRGBToNormal(gtaoVisibilityBentNormal.gba));
#define PROBE_NORMAL bentNormal
#endif
#define RE_Direct RE_Direct_Node
#define RE_IndirectDiffuse RE_IndirectDiffuse_Empty
#define RE_IndirectSpecular RE_IndirectSpecular_Node
#define RE_Refraction RE_Refraction_Node
#include <lights_fragment_begin>
#include <lights_fragment_maps>
#include <lights_fragment_end>
#undef RE_Direct
#undef RE_IndirectDiffuse
#undef RE_IndirectSpecular
#undef RE_Refraction
#ifdef PROBE_NORMAL
#undef PROBE_NORMAL
#endif
#ifdef _CLEARCOAT_RESTORE
#undef _CLEARCOAT_RESTORE
#define USE_CLEARCOAT
#endif
#ifdef USE_GTAO
float gtaoVisibility = gtaoVisibilityBentNormal.r;
vec3 gtaoBentNormal = bentNormal;
vec3 gtaoViewDir = geometry.viewDir;
vec3 gtaoNormal = normal;
float gtaoRoughness = material.roughness;
#endif
#include <lights_fragment_gtso>
vec3 viewWorld;
if (isOrthographic)
viewWorld = (invViewMatrix * vec4(0.0, 0.0, -1.0, 0.0)).xyz;
else
viewWorld = (invViewMatrix * vec4(-vViewPosition, 0.0)).xyz;
viewWorld = normalize(viewWorld);
float fresnel = fresnelReflection(viewWorld, normalWorld, ior);
outColor = vec4(color.rgb * mix(refractedLight, reflectedLight.directSpecular
+ reflectedLight.indirectSpecular, fresnel), 1.0);
}`,tX=`void node_bsdf_glossy(
vec3 geometryNormal,
vec4 color, float roughness, float anisotropy, float rotation, vec3 normal, vec3 tangent,
out vec4 outColor) {
normal = vec3(normal[0], normal[2], -normal[1]);
normal = normalize((viewMatrix * vec4(normal.xyz, 0.0)).xyz);
NodeMaterial material;
material.specularColor = vec3(1.0);
material.fresnelRefl90 = vec3(1.0);
material.roughness = clamp(roughness, 0.0, 1.0);
#if defined(ENVMAP_TYPE_CUBE) || defined(ENVMAP_TYPE_CUBE_UV)
float geomRoughness = calcGeometryRoughness(geometryNormal);
material.roughness = calcCubeUVAdjustedRoughness(
material.roughness, geomRoughness);
#endif
ReflectedLight reflectedLight = ReflectedLight(vec3(0.0), vec3(0.0), vec3(0.0), vec3(0.0));
#ifdef USE_CLEARCOAT
#undef USE_CLEARCOAT
#define _CLEARCOAT_RESTORE
#endif
#ifdef USE_GTAO
vec4 gtaoVisibilityBentNormal = texture2D(gtaoMap,
gl_FragCoord.xy / currResolution);
vec3 bentNormal = normalize(unpackRGBToNormal(gtaoVisibilityBentNormal.gba));
#define PROBE_NORMAL bentNormal
#endif
#define RE_Direct RE_Direct_Node
#define RE_IndirectDiffuse RE_IndirectDiffuse_Empty
#define RE_IndirectSpecular RE_IndirectSpecular_Node
#include <lights_fragment_begin>
#include <lights_fragment_maps>
#include <lights_fragment_end>
#undef RE_Direct
#undef RE_IndirectDiffuse
#undef RE_IndirectSpecular
#ifdef PROBE_NORMAL
#undef PROBE_NORMAL
#endif
#ifdef _CLEARCOAT_RESTORE
#undef _CLEARCOAT_RESTORE
#define USE_CLEARCOAT
#endif
#ifdef USE_GTAO
float gtaoVisibility = gtaoVisibilityBentNormal.r;
vec3 gtaoBentNormal = bentNormal;
vec3 gtaoViewDir = geometry.viewDir;
vec3 gtaoNormal = normal;
float gtaoRoughness = material.roughness;
#endif
#include <lights_fragment_gtso>
outColor = vec4(color.rgb * (reflectedLight.directSpecular
+ reflectedLight.indirectSpecular), 1.0);
}
void node_bsdf_glossy(
vec3 geometryNormal,
vec4 color, float roughness, vec3 normal,
out vec4 outColor) {
node_bsdf_glossy(geometryNormal, color, roughness, 0.0, 0.0, normal, vec3(0.0), outColor);
}`,nX=`void node_bsdf_hair(vec4 color, float offset, float roughnessU, float roughnessV, vec3 tangent, out vec4 outColor)
{
outColor = color;
}`,rX=`#define BSDF_METALLIC_BECKMANN 0
#define BSDF_METALLIC_GGX 1
#define BSDF_METALLIC_MULTI_GGX 2
vec3 fresnelConductor(float cosi, vec3 eta, vec3 k) {
vec3 cosiSqr = vec3(cosi * cosi);
vec3 tmpF = (eta * eta) + (k * k);
vec3 tmp2EtaCosI = 2.0 * eta * vec3(cosi);
vec3 tmp = tmpF * cosiSqr;
vec3 rparl2 = (tmp - tmp2EtaCosI + vec3(1.0)) / (tmp + tmp2EtaCosI + vec3(1.0));
vec3 rperp2 = (tmpF - tmp2EtaCosI + cosiSqr) / (tmpF + tmp2EtaCosI + cosiSqr);
return (rparl2 + rperp2) * 0.5;
}
void node_bsdf_metallic(
vec3 geometryNormal, const int distribution, const bool usePhysicalConductor,
vec4 baseColor, vec4 edgeTint, vec3 ior, vec3 extinction, float roughness, float anisotropy, float rotation, vec3 normal, vec3 tangent,
out vec4 outColor) {
normal = vec3(normal[0], normal[2], -normal[1]);
normal = normalize((viewMatrix * vec4(normal.xyz, 0.0)).xyz);
NodeMaterial material;
if (usePhysicalConductor) {
material.specularColor = saturate(fresnelConductor(1.0, ior, extinction));
material.fresnelRefl90 = saturate(fresnelConductor(1.0 / 7.0, ior, extinction));
} else {
material.specularColor = saturate(baseColor.rgb);
material.fresnelRefl90 = saturate(edgeTint.rgb);
}
material.specularF90 = average(material.fresnelRefl90);
material.roughness = saturate(roughness);
#if defined(ENVMAP_TYPE_CUBE) || defined(ENVMAP_TYPE_CUBE_UV)
float geomRoughness = calcGeometryRoughness(geometryNormal);
material.roughness = calcCubeUVAdjustedRoughness(
material.roughness, geomRoughness);
#endif
ReflectedLight reflectedLight = ReflectedLight(vec3(0.0), vec3(0.0), vec3(0.0), vec3(0.0));
#ifdef USE_CLEARCOAT
#undef USE_CLEARCOAT
#define _CLEARCOAT_RESTORE
#endif
#ifdef USE_GTAO
vec4 gtaoVisibilityBentNormal = texture2D(gtaoMap,
gl_FragCoord.xy / currResolution);
vec3 bentNormal = normalize(unpackRGBToNormal(gtaoVisibilityBentNormal.gba));
#define PROBE_NORMAL bentNormal
#endif
#define RE_Direct RE_Direct_Node
#define RE_IndirectDiffuse RE_IndirectDiffuse_Empty
#define RE_IndirectSpecular RE_IndirectSpecular_Node
#include <lights_fragment_begin>
#include <lights_fragment_maps>
#include <lights_fragment_end>
#undef RE_Direct
#undef RE_IndirectDiffuse
#undef RE_IndirectSpecular
#ifdef PROBE_NORMAL
#undef PROBE_NORMAL
#endif
#ifdef _CLEARCOAT_RESTORE
#undef _CLEARCOAT_RESTORE
#define USE_CLEARCOAT
#endif
#ifdef USE_GTAO
float gtaoVisibility = gtaoVisibilityBentNormal.r;
vec3 gtaoBentNormal = bentNormal;
vec3 gtaoViewDir = geometry.viewDir;
vec3 gtaoNormal = normal;
float gtaoRoughness = material.roughness;
#endif
#include <lights_fragment_gtso>
outColor = vec4(reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular, 1.0);
}`,oX=`
vec3 tintFromColor(vec3 color) {
float lum = dot(color, vec3(0.3, 0.6, 0.1));
return lum > 0.0 ? color / lum : vec3(1.0);
}
vec3 fresnelBlend(float ior, float fresnel, vec3 fresnelColor) {
float fresnelFac = fresnelReflection(vec3(1.0, 0.0, 0.0), vec3(1.0, 0.0, 0.0), ior);
float mixFac = saturate((fresnel - fresnelFac) / max(1e-8, 1.0 - fresnelFac));
return mix(fresnelColor, vec3(1.0), mixFac);
}
float iorToF0(float eta) {
float A = (eta - 1.0) / (eta + 1.0);
return A * A;
}
#ifdef USE_SHEEN_BLENDER
float principledSheen(float NV, float rough) {
float den = 35.6694 * rough * rough - 24.4269 * rough * NV - 0.1405 * NV * NV + 6.1211 * rough + 0.28105 * NV - 0.1405;
float num = 58.5299 * rough * rough - 85.0941 * rough * NV + 9.8955 * NV * NV + 1.9250 * rough + 74.2268 * NV - 0.2246;
return saturate(den / num);
}
#elif defined(USE_SHEEN_BLENDER_OLD)
float principledSheen(float NV) {
float f = 1.0 - NV;
float sheen = f * f * f * 0.077 + f * 0.01 + 0.00026;
return sheen;
}
#endif
void node_bsdf_principled(
vec3 geometryNormal,
vec4 baseColor, float metallic, float roughness, float ior, float alpha, vec3 normal, float diffuseRoughness,
float subsurface, vec3 subsurfaceRadius, float subsurfaceScale, float subsurfaceIOR,
float subsurfaceAnisotropy,
float specularIORLevel, vec4 specularTint,
float anisotropic, float anisotropicRotation, vec3 tangent,
float transmission,
float clearcoat, float clearcoatRoughness, float clearcoatIOR, vec4 clearcoatTint,
vec3 clearcoatNormal,
float sheen, float sheenRoughness, vec4 sheenTint,
vec4 emission, float emissionStrength,
float thinFilmThickness, float thinFilmIOR,
out vec4 outColor) {
normal = vec3(normal[0], normal[2], -normal[1]);
vec3 normalWorld = normal;
normal = (viewMatrix * vec4(normal.xyz, 0.0)).xyz;
NodeMaterial material;
metallic = clamp(metallic, 0.0, 1.0);
float dielectric = 1.0 - metallic;
transmission *= dielectric;
material.diffuseColor = baseColor.rgb * dielectric;
#ifdef USE_CLEARCOAT
material.clearcoat = saturate(clearcoat);
material.clearcoatRoughness = clamp(clearcoatRoughness, 0.0, 1.0);
material.clearcoatF0 = vec3(0.04);
material.clearcoatF90 = 1.0;
#endif
#ifdef USE_SHEEN_BLENDER
float dotNVsh = dot(normal, (isOrthographic) ? vec3(0, 0, 1) : normalize(vViewPosition));
material.diffuseColor += sheen * sheenTint.rgb * principledSheen(dotNVsh, sheenRoughness);
#endif
material.roughness = clamp(roughness, 0.0, 1.0);
vec3 viewWorld;
if (isOrthographic)
viewWorld = (invViewMatrix * vec4(0.0, 0.0, -1.0, 0.0)).xyz;
else
viewWorld = (invViewMatrix * vec4(-vViewPosition, 0.0)).xyz;
viewWorld = normalize(viewWorld);
float f0d = iorToF0(ior);
if (specularIORLevel != 0.5)
f0d *= 2.0 * specularIORLevel;
vec3 F0d = vec3(f0d) * specularTint.rgb;
F0d = clamp(F0d, vec3(0.0), vec3(1.0));
vec3 F90d = vec3(1.0);
material.specularColor = mix(F0d, baseColor.rgb, metallic);
material.fresnelRefl90 = mix(F90d, specularTint.rgb, metallic);
material.specularF90 = average(material.fresnelRefl90);
material.refractionColor = baseColor.rgb;
material.refractionIOR = ior;
material.refractionRoughness = pow2(roughness);
#if defined(ENVMAP_TYPE_CUBE) || defined(ENVMAP_TYPE_CUBE_UV)
float geomRoughness = calcGeometryRoughness(geometryNormal);
material.roughness = calcCubeUVAdjustedRoughness(
material.roughness, geomRoughness);
material.refractionRoughness = calcCubeUVAdjustedRoughness(
material.refractionRoughness, geomRoughness);
#ifdef USE_CLEARCOAT
material.clearcoatRoughness = calcCubeUVAdjustedRoughness(
material.clearcoatRoughness, geomRoughness);
clearcoatNormal = normalize(vec3(clearcoatNormal[0], clearcoatNormal[2], -clearcoatNormal[1]));
clearcoatNormal = (viewMatrix * vec4(clearcoatNormal.xyz, 0.0)).xyz;
#endif
#endif
ReflectedLight reflectedLight = ReflectedLight(vec3(0.0), vec3(0.0), vec3(0.0), vec3(0.0));
vec3 refractedLight = vec3(0.0);
#ifdef USE_GTAO
vec4 gtaoVisibilityBentNormal = texture2D(gtaoMap,
gl_FragCoord.xy / currResolution);
vec3 bentNormal = normalize(unpackRGBToNormal(gtaoVisibilityBentNormal.gba));
#define PROBE_NORMAL bentNormal
#endif
#define RE_Direct RE_Direct_Node
#define RE_IndirectDiffuse RE_IndirectDiffuse_Node
#define RE_IndirectSpecular RE_IndirectSpecular_Node
#define RE_Refraction RE_Refraction_Node
#include <lights_fragment_begin>
#include <lights_fragment_maps>
#ifdef USE_CLEARCOAT
clearcoatSpecular += clearcoatRadiance * BRDF_Specular_GGX_Environment(geometry.viewDir, geometry.clearcoatNormal, material.clearcoatF0, vec3(material.clearcoatF90), material.clearcoatRoughness);
#endif
irradiance += iblIrradiance;
vec3 specEnv = BRDF_Specular_GGX_Environment(geometry.viewDir, geometry.normal, material.specularColor, material.fresnelRefl90, material.roughness);
reflectedLight.indirectSpecular += radiance * specEnv;
float weight = 1.0;
weight *= max((1.0 - max3(specEnv)), 0.0);
material.diffuseColor *= weight;
RE_IndirectDiffuse(irradiance, geometry, material, reflectedLight);
RE_Refraction(refraction, material, refractedLight);
#undef RE_Direct
#undef RE_IndirectDiffuse
#undef RE_IndirectSpecular
#undef RE_Refraction
#ifdef PROBE_NORMAL
#undef PROBE_NORMAL
#endif
#ifdef USE_GTAO
reflectedLight.indirectDiffuse *= gtaoVisibilityBentNormal.r;
float gtaoVisibility = gtaoVisibilityBentNormal.r;
vec3 gtaoBentNormal = bentNormal;
vec3 gtaoViewDir = geometry.viewDir;
vec3 gtaoNormal = normal;
float gtaoRoughness = material.roughness;
#endif
#include <lights_fragment_gtso>
float fresnel = fresnelReflection(viewWorld, normalWorld, ior);
vec3 outColor3 = (reflectedLight.directDiffuse + reflectedLight.indirectDiffuse) * (1.0 - transmission)
+ reflectedLight.directSpecular + reflectedLight.indirectSpecular
+ refractedLight * transmission * (1.0 - fresnel)
+ emission.rgb * emissionStrength;
#ifdef USE_CLEARCOAT
float dotNVcc = saturate(dot(geometry.normal, geometry.viewDir));
vec3 Fcc = F_Schlick(material.clearcoatF0, material.clearcoatF90, dotNVcc);
outColor3 = outColor3 * (1.0 - material.clearcoat * Fcc) + clearcoatSpecular * material.clearcoat;
#endif
outColor = vec4(outColor3, alpha);
}
void node_bsdf_principled(
vec3 geometryNormal,
vec4 baseColor, float metallic, float roughness, float ior, float alpha, vec3 normal,
float subsurface, vec3 subsurfaceRadius, float subsurfaceScale, float subsurfaceIOR,
float subsurfaceAnisotropy,
float specularIORLevel, vec4 specularTint,
float anisotropic, float anisotropicRotation, vec3 tangent,
float transmission,
float clearcoat, float clearcoatRoughness, float clearcoatIOR, vec4 clearcoatTint,
vec3 clearcoatNormal,
float sheen, float sheenRoughness, vec4 sheenTint,
vec4 emission, float emissionStrength,
float thinFilmThickness, float thinFilmIOR,
out vec4 outColor) {
node_bsdf_principled(geometryNormal, baseColor, metallic, roughness, ior, alpha, normal, 0.0, subsurface, subsurfaceRadius, subsurfaceScale, subsurfaceIOR, subsurfaceAnisotropy, specularIORLevel, specularTint, anisotropic, anisotropicRotation, tangent, transmission, clearcoat, clearcoatRoughness, clearcoatIOR, clearcoatTint, clearcoatNormal, sheen, sheenRoughness, sheenTint, emission, emissionStrength, 0.0, 0.0, outColor);
}
void node_bsdf_principled(
vec3 geometryNormal,
vec4 baseColor, float metallic, float roughness, float ior, float alpha, vec3 normal,
float subsurface, vec3 subsurfaceRadius, float subsurfaceScale, float subsurfaceIOR,
float subsurfaceAnisotropy,
float specularIORLevel, vec4 specularTint,
float anisotropic, float anisotropicRotation, vec3 tangent,
float transmission,
float clearcoat, float clearcoatRoughness, float clearcoatIOR, vec4 clearcoatTint,
vec3 clearcoatNormal,
float sheen, float sheenRoughness, vec4 sheenTint,
vec4 emission, float emissionStrength,
out vec4 outColor) {
node_bsdf_principled(geometryNormal, baseColor, metallic, roughness, ior, alpha, normal, subsurface, subsurfaceRadius, subsurfaceScale, subsurfaceIOR, subsurfaceAnisotropy, specularIORLevel, specularTint, anisotropic, anisotropicRotation, tangent, transmission, clearcoat, clearcoatRoughness, clearcoatIOR, clearcoatTint, clearcoatNormal, sheen, sheenRoughness, sheenTint, emission, emissionStrength, 0.0, 0.0, outColor);
}
void node_bsdf_principled(
vec3 geometryNormal,
vec4 baseColor, float subsurface, vec3 subsurfaceRadius, vec4 subsurfaceColor,
float subsurfaceIOR, float subsurfaceAnisotropy,
float metallic, float specular, float specularTint, float roughness,
float anisotropic, float anisotropicRotation, float sheen, float sheenTint,
float clearcoat, float clearcoatRoughness, float ior,
float transmission, float transmissionRoughness, vec4 emission,
float emissionStrength, float alpha, vec3 normal, vec3 clearcoatNormal,
vec3 tangent,
out vec4 outColor) {
normal = vec3(normal[0], normal[2], -normal[1]);
vec3 normalWorld = normal;
normal = (viewMatrix * vec4(normal.xyz, 0.0)).xyz;
NodeMaterial material;
metallic = clamp(metallic, 0.0, 1.0);
float dielectric = 1.0 - metallic;
transmission *= dielectric;
material.diffuseColor = baseColor.rgb * dielectric;
#ifndef USE_CLEARCOAT
float dielReflCoeff = 0.08;
#else
float dielReflCoeff = 0.16;
material.clearcoat = saturate(clearcoat);
material.clearcoatRoughness = clamp(clearcoatRoughness, 0.0, 1.0);
material.clearcoatF0 = vec3(0.04);
material.clearcoatF90 = 1.0;
#endif
#if defined(USE_SHEEN_BLENDER_OLD)
float dotNVsh = dot(normal, (isOrthographic) ? vec3(0, 0, 1) : normalize(vViewPosition));
vec3 sheenColor = mix(vec3(1.0), tintFromColor(baseColor.rgb), sheenTint);
material.diffuseColor += sheen * sheenColor * principledSheen(dotNVsh);
#endif
vec3 dielRefl = dielReflCoeff * specular
* mix(vec3(1.0), tintFromColor(baseColor.rgb), specularTint);
material.specularColor = mix(dielRefl, baseColor.rgb, metallic);
material.roughness = clamp(roughness, 0.0, 1.0);
vec3 viewWorld;
if (isOrthographic)
viewWorld = (invViewMatrix * vec4(0.0, 0.0, -1.0, 0.0)).xyz;
else
viewWorld = (invViewMatrix * vec4(-vViewPosition, 0.0)).xyz;
viewWorld = normalize(viewWorld);
float fresnel = fresnelReflection(viewWorld, normalWorld, ior);
vec3 fresnelColor = mix(vec3(1.0), baseColor.rgb, specularTint);
material.specularColor = mix(material.specularColor,
fresnelBlend(ior, fresnel, fresnelColor) * fresnel, transmission);
float isStrictDielectric = step(0.0, -length(vec4(subsurface, clearcoat,
transmission, float(metallic == 1.0))));
material.fresnelRefl90 = mix(vec3(1.0), material.specularColor,
(1.0 - specular) * metallic * (1.0 - isStrictDielectric));
material.specularF90 = average(material.fresnelRefl90);
material.refractionColor = baseColor.rgb;
material.refractionIOR = ior;
material.refractionRoughness = pow2(roughness);
#if defined(ENVMAP_TYPE_CUBE) || defined(ENVMAP_TYPE_CUBE_UV)
float geomRoughness = calcGeometryRoughness(geometryNormal);
material.roughness = calcCubeUVAdjustedRoughness(
material.roughness, geomRoughness);
material.refractionRoughness = calcCubeUVAdjustedRoughness(
material.refractionRoughness, geomRoughness);
#ifdef USE_CLEARCOAT
material.clearcoatRoughness = calcCubeUVAdjustedRoughness(
material.clearcoatRoughness, geomRoughness);
clearcoatNormal = normalize(vec3(clearcoatNormal[0], clearcoatNormal[2], -clearcoatNormal[1]));
clearcoatNormal = (viewMatrix * vec4(clearcoatNormal.xyz, 0.0)).xyz;
#endif
#endif
ReflectedLight reflectedLight = ReflectedLight(vec3(0.0), vec3(0.0), vec3(0.0), vec3(0.0));
vec3 refractedLight = vec3(0.0);
#ifdef USE_GTAO
vec4 gtaoVisibilityBentNormal = texture2D(gtaoMap,
gl_FragCoord.xy / currResolution);
vec3 bentNormal = normalize(unpackRGBToNormal(gtaoVisibilityBentNormal.gba));
#define PROBE_NORMAL bentNormal
#endif
#define RE_Direct RE_Direct_Node
#define RE_IndirectDiffuse RE_IndirectDiffuse_Node
#define RE_IndirectSpecular RE_IndirectSpecular_Node
#define RE_Refraction RE_Refraction_Node
#include <lights_fragment_begin>
#include <lights_fragment_maps>
#include <lights_fragment_end>
#undef RE_Direct
#undef RE_IndirectDiffuse
#undef RE_IndirectSpecular
#undef RE_Refraction
#ifdef PROBE_NORMAL
#undef PROBE_NORMAL
#endif
#ifdef USE_GTAO
reflectedLight.indirectDiffuse *= gtaoVisibilityBentNormal.r;
float gtaoVisibility = gtaoVisibilityBentNormal.r;
vec3 gtaoBentNormal = bentNormal;
vec3 gtaoViewDir = geometry.viewDir;
vec3 gtaoNormal = normal;
float gtaoRoughness = material.roughness;
#endif
#include <lights_fragment_gtso>
vec3 outColor3 = (reflectedLight.directDiffuse + reflectedLight.indirectDiffuse) * (1.0 - transmission)
+ reflectedLight.directSpecular + reflectedLight.indirectSpecular
+ refractedLight * transmission * (1.0 - fresnel)
+ emission.rgb * emissionStrength;
#ifdef USE_CLEARCOAT
float dotNVcc = saturate(dot(geometry.normal, geometry.viewDir));
vec3 Fcc = F_Schlick(material.clearcoatF0, material.clearcoatF90, dotNVcc);
outColor3 = outColor3 * (1.0 - material.clearcoat * Fcc) + clearcoatSpecular * material.clearcoat;
#endif
outColor = vec4(outColor3, alpha);
}`,aX=`#define BSDF_REFRACTION_GGX 0
#define BSDF_REFRACTION_BECKMANN 1
#define BSDF_REFRACTION_SHARP 2
void node_bsdf_refraction(
vec3 geometryNormal, const int distribution,
vec4 color, float roughness, float ior, vec3 normal,
out vec4 outColor) {
normal = swizzleUpY(normal);
normal = (viewMatrix * vec4(normal.xyz, 0.0)).xyz;
NodeMaterial material;
material.refractionColor = color.rgb;
material.refractionIOR = ior;
if (distribution == BSDF_REFRACTION_SHARP) {
material.refractionRoughness = 0.0;
} else {
material.refractionRoughness = pow2(roughness);
}
#if defined(ENVMAP_TYPE_CUBE) || defined(ENVMAP_TYPE_CUBE_UV)
float geomRoughness = calcGeometryRoughness(geometryNormal);
material.refractionRoughness = calcCubeUVAdjustedRoughness(
material.refractionRoughness, geomRoughness);
#endif
ReflectedLight reflectedLight = ReflectedLight(vec3(0.0), vec3(0.0), vec3(0.0), vec3(0.0));
vec3 refractedLight = vec3(0.0);
#ifdef USE_CLEARCOAT
#undef USE_CLEARCOAT
#define _CLEARCOAT_RESTORE
#endif
#define RE_Refraction RE_Refraction_Node
#include <lights_fragment_begin>
#include <lights_fragment_maps>
#include <lights_fragment_end>
#undef RE_Refraction
#ifdef _CLEARCOAT_RESTORE
#undef _CLEARCOAT_RESTORE
#define USE_CLEARCOAT
#endif
outColor = vec4(refractedLight, 1.0);
}`,iX=`
void node_bsdf_sheen(vec4 color, float roughness, vec3 normal, out vec4 outColor)
{
normal = vec3(normal[0], normal[2], -normal[1]);
normal = (viewMatrix * vec4(normal.xyz, 0.0)).xyz;
NodeMaterial material;
material.diffuseColor = color.rgb;
ReflectedLight reflectedLight = ReflectedLight(vec3(0.0), vec3(0.0), vec3(0.0), vec3(0.0));
#ifdef USE_CLEARCOAT
#undef USE_CLEARCOAT
#define _CLEARCOAT_RESTORE
#endif
#define RE_Direct RE_DirectDiffuseOnly_Node
#define RE_IndirectDiffuse RE_IndirectDiffuse_Node
#include <lights_fragment_begin>
#include <lights_fragment_maps>
#include <lights_fragment_end>
#undef RE_Direct
#undef RE_IndirectDiffuse
#ifdef _CLEARCOAT_RESTORE
#undef _CLEARCOAT_RESTORE
#define USE_CLEARCOAT
#endif
outColor = vec4(reflectedLight.directDiffuse + reflectedLight.indirectDiffuse, 1.0);
}`,sX=`void node_bsdf_toon(
vec4 color, float size, float smoothFac, vec3 normal,
out vec4 outColor)
{
outColor = color;
}`,lX=`void node_bsdf_translucent(vec4 color, vec3 normal, out vec4 outColor) {
normal = -vec3(normal[0], normal[2], -normal[1]);
normal = (viewMatrix * vec4(normal.xyz, 0.0)).xyz;
NodeMaterial material;
material.diffuseColor = color.rgb;
ReflectedLight reflectedLight = ReflectedLight(vec3(0.0), vec3(0.0), vec3(0.0), vec3(0.0));
#ifdef USE_CLEARCOAT
#undef USE_CLEARCOAT
#define _CLEARCOAT_RESTORE
#endif
#define RE_Direct RE_DirectDiffuseOnly_Node
#define RE_IndirectDiffuse RE_IndirectDiffuse_Node
#include <lights_fragment_begin>
#include <lights_fragment_maps>
#include <lights_fragment_end>
#undef RE_Direct
#undef RE_IndirectDiffuse
#ifdef _CLEARCOAT_RESTORE
#undef _CLEARCOAT_RESTORE
#define USE_CLEARCOAT
#endif
outColor = vec4(reflectedLight.directDiffuse + reflectedLight.indirectDiffuse, 1.0);
}`,cX=`void node_bsdf_transparent(vec4 color, out vec4 outColor)
{
float alpha = saturate(1.0 - dot(color.rgb, vec3(0.333333)));
outColor = vec4(0.0, 0.0, 0.0, alpha);
}`,uX=`
void node_bsdf_velvet(vec4 color, float sigma, vec3 normal, out vec4 outColor)
{
outColor = color;
}`,dX=`void node_bump(
const bool invert,
float strength, float bumpDist, float height, vec3 normal,
out vec3 outNormal) {
vec3 position = swizzleUpZ(vWorldPosition);
if (invert)
bumpDist *= -1.0;
vec3 dPdx = dFdx(position);
vec3 dPdy = dFdy(position);
float dHdx = dFdx(height);
float dHdy = dFdy(height);
vec3 tanX = cross(dPdy, normal);
vec3 tanY = cross(normal, dPdx);
vec3 surfaceGrad = dHdx * tanX + dHdy * tanY;
float dotPosTanX = dot(dPdx, tanX);
outNormal = normalize(normal * abs(dotPosTanX) - surfaceGrad * bumpDist * sign(dotPosTanX));
outNormal = normalize(mix(normal, outNormal, max(0.0, strength)));
}
void node_bump(const bool invert,
float strength, float bumpDist, float height, float height_dx, float height_dy, vec3 normal,
out vec3 outNormal) {
node_bump(invert, strength, bumpDist, height, normal, outNormal);
}`,fX=`void node_camera(
vec3 viewPos, const bool invCamZ,
out vec3 outViewVector, out float outViewZDepth, out float outViewDistance)
{
viewPos = -viewPos;
if (invCamZ)
viewPos.z = -viewPos.z;
outViewVector = normalize(viewPos);
outViewZDepth = abs(viewPos.z);
outViewDistance = length(viewPos);
}`,hX=`void node_clamp(bool clampRange, float value, float minVal, float maxVal, out float result) {
if (clampRange)
result = (maxVal > minVal) ? clamp(value, minVal, maxVal) : clamp(value, maxVal, minVal);
else
result = min(max(value, minVal), maxVal);
}`,pX=`
void node_combhsv(float h, float s, float v, out vec4 col)
{
hsvToRGB(vec4(h, s, v, 1.0), col);
}`,mX=`#define NODE_COMB_COL_RGB 0
#define NODE_COMB_COL_HSV 1
#define NODE_COMB_COL_HSL 2
void hslToRGB(vec3 hsl, out vec3 outCol)
{
float nr, ng, nb, chroma;
float h, s, l;
h = hsl[0];
s = hsl[1];
l = hsl[2];
nr = abs(h * 6.0 - 3.0) - 1.0;
ng = 2.0 - abs(h * 6.0 - 2.0);
nb = 2.0 - abs(h * 6.0 - 4.0);
nr = clamp(nr, 0.0, 1.0);
nb = clamp(nb, 0.0, 1.0);
ng = clamp(ng, 0.0, 1.0);
chroma = (1.0 - abs(2.0 * l - 1.0)) * s;
outCol = vec3((nr - 0.5) * chroma + l, (ng - 0.5) * chroma + l, (nb - 0.5) * chroma + l);
}
void node_combine_color(int mode, float r, float g, float b, out vec4 col)
{
if (mode == NODE_COMB_COL_RGB) {
col = vec4(r, g, b, 1.0);
} else if (mode == NODE_COMB_COL_HSV) {
hsvToRGB(vec4(r, g, b, 1.0), col);
} else {
vec3 col3;
hslToRGB(vec3(r, g, b), col3);
col = vec4(col3, 1.0);
}
}`,gX=`
void node_combrgb(float r, float g, float b, out vec4 col)
{
col = vec4(r, g, b, 1.0);
}`,vX=`void node_combxyz(float x, float y, float z, out vec3 outVector)
{
outVector = vec3(x, y, z);
}`,_X=`void node_curve_float(sampler2D curveData, float fac, float value, out float outValue)
{
outValue = texture2D(curveData, vec2((value + 1.0) * 0.5, 0.0)).x;
outValue = mix(value, outValue * 2.0 - 1.0, fac);
}`,AX=`void node_curve_rgb(sampler2D curveData, float fac, vec4 col, out vec4 outCol)
{
outCol.r = texture2D(curveData, vec2(texture2D(curveData, vec2(col.r, 0.0)).a, 0.0)).r;
outCol.g = texture2D(curveData, vec2(texture2D(curveData, vec2(col.g, 0.0)).a, 0.0)).g;
outCol.b = texture2D(curveData, vec2(texture2D(curveData, vec2(col.b, 0.0)).a, 0.0)).b;
outCol = mix(col, outCol, fac);
outCol.a = col.a;
}`,xX=`void node_curve_vec(sampler2D curveData, float fac, vec3 vec, out vec3 outVec)
{
outVec.x = texture2D(curveData, vec2((vec.x + 1.0) * 0.5, 0.0)).x;
outVec.y = texture2D(curveData, vec2((vec.y + 1.0) * 0.5, 0.0)).y;
outVec.z = texture2D(curveData, vec2((vec.z + 1.0) * 0.5, 0.0)).z;
outVec = mix(vec, outVec * 2.0 - vec3(1.0), fac);
}`,yX=`void node_diffuse_bsdf(
vec4 color, float roughness, vec3 normal,
out vec4 outColor) {
normal = vec3(normal[0], normal[2], -normal[1]);
normal = (viewMatrix * vec4(normal.xyz, 0.0)).xyz;
NodeMaterial material;
material.diffuseColor = color.rgb;
ReflectedLight reflectedLight = ReflectedLight(vec3(0.0), vec3(0.0), vec3(0.0), vec3(0.0));
#ifdef USE_CLEARCOAT
#undef USE_CLEARCOAT
#define _CLEARCOAT_RESTORE
#endif
#ifdef USE_GTAO
vec4 gtaoVisibilityBentNormal = texture2D(gtaoMap,
gl_FragCoord.xy / currResolution);
vec3 bentNormal = normalize(unpackRGBToNormal(gtaoVisibilityBentNormal.gba));
#define PROBE_NORMAL bentNormal
#endif
#define RE_Direct RE_DirectDiffuseOnly_Node
#define RE_IndirectDiffuse RE_IndirectDiffuse_Node
#include <lights_fragment_begin>
#include <lights_fragment_maps>
#include <lights_fragment_end>
#undef RE_Direct
#undef RE_IndirectDiffuse
#ifdef PROBE_NORMAL
#undef PROBE_NORMAL
#endif
#ifdef _CLEARCOAT_RESTORE
#undef _CLEARCOAT_RESTORE
#define USE_CLEARCOAT
#endif
#ifdef USE_GTAO
reflectedLight.indirectDiffuse *= gtaoVisibilityBentNormal.r;
#endif
outColor = vec4(reflectedLight.directDiffuse + reflectedLight.indirectDiffuse, 1.0);
}`,bX=`void node_displacement(float height, float midlevel, float scale, vec3 normal, out vec3 outDisplacement) {
outDisplacement = vec3(0.0);
}`,SX=`void node_eevee_specular(
vec3 geometryNormal,
vec4 baseColor, vec4 specular, float roughness, vec4 emissiveColor,
float transparency, vec3 normal, float clearcoat, float clearcoatRoughness,
vec3 clearcoatNormal, float ambientOcclusion,
out vec4 outColor) {
normal = vec3(normal[0], normal[2], -normal[1]);
vec3 normalWorld = normal;
normal = (viewMatrix * vec4(normal.xyz, 0.0)).xyz;
NodeMaterial material;
material.diffuseColor = baseColor.rgb;
material.specularColor = specular.rgb;
material.roughness = clamp(roughness, 0.0, 1.0);
#ifdef USE_CLEARCOAT
material.clearcoat = saturate(clearcoat);
material.clearcoatRoughness = clamp(clearcoatRoughness, 0.0, 1.0);
#endif
#if defined(ENVMAP_TYPE_CUBE) || defined(ENVMAP_TYPE_CUBE_UV)
float geomRoughness = calcGeometryRoughness(geometryNormal);
material.roughness = calcCubeUVAdjustedRoughness(
material.roughness, geomRoughness);
#ifdef USE_CLEARCOAT
material.clearcoatRoughness = calcCubeUVAdjustedRoughness(
material.clearcoatRoughness, geomRoughness);
clearcoatNormal = normalize(vec3(clearcoatNormal[0], clearcoatNormal[2], -clearcoatNormal[1]));
clearcoatNormal = (viewMatrix * vec4(clearcoatNormal.xyz, 0.0)).xyz;
#endif
#endif
ReflectedLight reflectedLight = ReflectedLight(vec3(0.0), vec3(0.0), vec3(0.0), vec3(0.0));
#ifdef USE_GTAO
vec4 gtaoVisibilityBentNormal = texture2D(gtaoMap,
gl_FragCoord.xy / currResolution);
vec3 bentNormal = normalize(unpackRGBToNormal(gtaoVisibilityBentNormal.gba));
#define PROBE_NORMAL bentNormal
#endif
#define RE_Direct RE_Direct_Node
#define RE_IndirectDiffuse RE_IndirectDiffuse_Node
#define RE_IndirectSpecular RE_IndirectSpecular_Node
#include <lights_fragment_begin>
#include <lights_fragment_maps>
#include <lights_fragment_end>
#undef RE_Direct
#undef RE_IndirectDiffuse
#undef RE_IndirectSpecular
#ifdef PROBE_NORMAL
#undef PROBE_NORMAL
#endif
#ifdef USE_GTAO
reflectedLight.indirectDiffuse *= gtaoVisibilityBentNormal.r;
float gtaoVisibility = gtaoVisibilityBentNormal.r;
vec3 gtaoBentNormal = bentNormal;
vec3 gtaoViewDir = geometry.viewDir;
vec3 gtaoNormal = normal;
float gtaoRoughness = material.roughness;
#endif
#include <lights_fragment_gtso>
vec3 outColor3 = (reflectedLight.directDiffuse + reflectedLight.indirectDiffuse
+ reflectedLight.directSpecular + reflectedLight.indirectSpecular) * ambientOcclusion
+ emissiveColor.rgb;
outColor = vec4(outColor3, 1.0 - transparency);
}`,CX=`void node_emission(vec4 color, float strength, out vec4 outColor)
{
outColor = vec4(strength * color.rgb, 1.0);
}`,EX=`void node_fresnel(vec3 viewPos, float IOR, vec3 normal, out float fac)
{
vec3 worldDir;
if (isOrthographic)
worldDir = (invViewMatrix * vec4(0.0, 0.0, -1.0, 0.0)).xyz;
else
worldDir = (invViewMatrix * vec4(-viewPos, 0.0)).xyz;
worldDir = normalize(swizzleUpZ(worldDir));
float eta = max(IOR, 0.00001);
fac = fresnelReflection(worldDir, normal, (gl_FrontFacing) ? eta : 1.0 / eta);
}`,MX=`void node_gamma(vec4 col, float gamma, out vec4 outCol)
{
outCol = col;
if (col.r > 0.0)
outCol.r = powCompat(col.r, gamma);
if (col.g > 0.0)
outCol.g = powCompat(col.g, gamma);
if (col.b > 0.0)
outCol.b = powCompat(col.b, gamma);
}`,wX=`
void node_hair_info(out float isStrand, out float intercept, out float len, out float thickness,
out vec3 tangentNormal, out float random) {
isStrand = 0.0;
intercept = 0.0;
len = 0.0;
thickness = 0.0;
tangentNormal = vec3(0.0);
random = 1.0;
}
void node_hair_info(out float isStrand, out float intercept, out float thickness,
out vec3 tangentNormal, out float random) {
float len;
node_hair_info(isStrand, intercept, len, thickness, tangentNormal, random);
}`,TX=`void node_holdout(out vec4 outColor)
{
outColor = vec4(0.0);
}`,RX=`void node_hue_sat(float hue, float sat, float value, float fac, vec4 col, out vec4 outCol)
{
vec4 hsv;
rgbToHSV(col, hsv);
hsv[0] += (fract(hue) - 0.5);
if (hsv[0] > 1.0) hsv[0] -= 1.0; else if (hsv[0] < 0.0) hsv[0] += 1.0;
hsv[1] *= sat;
if (hsv[1] > 1.0) hsv[1] = 1.0; else if (hsv[1] < 0.0) hsv[1] = 0.0;
hsv[2] *= value;
hsvToRGB(hsv, outCol);
outCol = mix(col, outCol, fac);
}`,IX=`void node_invert(float fac, vec4 col, out vec4 outCol)
{
outCol.xyz = mix(col.xyz, vec3(1.0, 1.0, 1.0) - col.xyz, fac);
outCol.w = col.w;
}`,LX=`void node_layer_weight(vec3 viewPos, float blend, vec3 normal, out float fresnel, out float facing)
{
vec3 worldDir;
if (isOrthographic)
worldDir = (invViewMatrix * vec4(0.0, 0.0, -1.0, 0.0)).xyz;
else
worldDir = (invViewMatrix * vec4(-viewPos, 0.0)).xyz;
worldDir = normalize(swizzleUpZ(worldDir));
float eta = max(1.0 - blend, EPSILON);
fresnel = fresnelReflection(worldDir, normal, (gl_FrontFacing) ? 1.0 / eta : eta);
facing = abs(dot(worldDir, normal));
if (blend != 0.5) {
blend = clamp(blend, 0.0, 1.0 - EPSILON);
blend = (blend < 0.5) ? blend * 2.0 : 0.5 / (1.0 - blend);
facing = pow(facing, blend);
}
facing = 1.0 - facing;
}`,BX=`void node_light_falloff(
float strength, float inSmooth,
out float quadratic, out float linear, out float constant)
{
quadratic = 1.0;
linear = 1.0;
constant = 1.0;
}`,PX=`void node_light_path(
out float isCameraRay, out float isShadowRay, out float isDiffuseRay, 
out float isGlossyRay, out float isSingularRay, out float isReflectionRay,
out float isTransmissionRay, out float rayLength, out float rayDepth, 
out float diffuseDepth, out float glossyDepth, out float transparentDepth, 
out float transmissionDepth)
{
#if LIGHT_PATH_IS_CAM_RAY
isCameraRay = 1.0;
#else
isCameraRay = 0.0;
#endif
isShadowRay = 0.0;
isDiffuseRay = 0.0;
isGlossyRay = 0.0;
isSingularRay = 0.0;
isReflectionRay = 0.0;
isTransmissionRay = 0.0;
rayLength = 1.0;
rayDepth = 1.0;
diffuseDepth = 1.0;
glossyDepth = 1.0;
transparentDepth = 1.0; 
transmissionDepth = 1.0;
}`,NX=`#define NODE_MAPPING_POINT 1
#define NODE_MAPPING_TEXTURE 2
#define NODE_MAPPING_VECTOR 3
#define NODE_MAPPING_NORMAL 4
mat3 rotationMatrix(float angleX, float angleY, float angleZ) {
float cx = cos(angleX);
float sx = sin(angleX);
float cy = cos(angleY);
float sy = sin(angleY);
float cz = cos(angleZ);
float sz = sin(angleZ);
mat3 mat;
mat[0][0] = cy * cz;
mat[0][1] = cy * sz;
mat[0][2] = -sy;
mat[1][0] = sy * sx * cz - cx * sz;
mat[1][1] = sy * sx * sz + cx * cz;
mat[1][2] = cy * sx;
mat[2][0] = sy * cx * cz + sx * sz;
mat[2][1] = sy * cx * sz - sx * cz;
mat[2][2] = cy * cx;
return mat;
}
mat3 mat3GetInverseTransposed(mat3 mat) {
float det = mat3GetDeterminant(mat);
float a00 = (mat[1][1] * mat[2][2] - mat[1][2] * mat[2][1]) / det;
float a01 = - (mat[1][0] * mat[2][2] - mat[1][2] * mat[2][0]) / det;
float a02 = (mat[1][0] * mat[2][1] - mat[1][1] * mat[2][0]) / det;
float a10 = - (mat[0][1] * mat[2][2] - mat[0][2] * mat[2][1]) / det;
float a11 = (mat[0][0] * mat[2][2] - mat[0][2] * mat[2][0]) / det;
float a12 = - (mat[0][0] * mat[2][1] - mat[0][1] * mat[2][0]) / det;
float a20 = (mat[0][1] * mat[1][2] - mat[0][2] * mat[1][1]) / det;
float a21 = - (mat[0][0] * mat[1][2] - mat[0][2] * mat[1][0]) / det;
float a22 = (mat[0][0] * mat[1][1] - mat[0][1] * mat[1][0]) / det;
return mat3(
a00, a01, a02,
a10, a11, a12,
a20, a21, a22
);
}
void node_mapping(int type, vec3 vec, vec3 loc, vec3 rot, vec3 scale, out vec3 outVec)
{
if (type == NODE_MAPPING_POINT)
outVec = rotationMatrix(rot.x, rot.y, rot.z) * (vec * scale) + loc;
else if (type == NODE_MAPPING_TEXTURE)
outVec = transposeMat3(rotationMatrix(rot.x, rot.y, rot.z)) * (vec - loc) / scale;
else if (type == NODE_MAPPING_VECTOR)
outVec = rotationMatrix(rot.x, rot.y, rot.z) * (vec * scale);
else {
mat3 rot = rotationMatrix(rot.x, rot.y, rot.z) * mat3(
scale[0], 0.0, 0.0,
0.0, scale[1], 0.0,
0.0, 0.0, scale[2]
);
outVec = normalize(mat3GetInverseTransposed(rot) * vec);
}
}`,DX=`#define NODE_MAP_RANGE_INTERP_LINEAR 0
#define NODE_MAP_RANGE_INTERP_STEPPED 1
#define NODE_MAP_RANGE_INTERP_SMOOTHSTEP 2
#define NODE_MAP_RANGE_INTERP_SMOOTHERSTEP 3
#define NODE_MAP_RANGE_TYPE_FLOAT 0
#define NODE_MAP_RANGE_TYPE_FLOAT_VECTOR 1
float smootherstep(float edge0, float edge1, float x) {
float t = clamp((x - edge0) / (edge1 - edge0), 0.0, 1.0);
return t * t * t * (t * (t * 6.0 - 15.0) + 10.0);
}
vec3 smootherstep(vec3 x) {
vec3 t = clamp(x, 0.0, 1.0);
return (t * (t * 6.0 - 15.0) + 10.0) * t * t * t;
}
void node_map_range(const int interpolation, bool inClamp, float value, float fromMin, float fromMax,
float toMin, float toMax, float steps, out float result) {
if (fromMax == fromMin) {
result = 0.0;
} else if (interpolation == NODE_MAP_RANGE_INTERP_LINEAR) {
result = (value - fromMin) / (fromMax - fromMin) * (toMax - toMin) + toMin;
} else if (interpolation == NODE_MAP_RANGE_INTERP_STEPPED) {
float fac = (value - fromMin) / (fromMax - fromMin);
fac = (steps > 0.0) ? floor(fac * (steps + 1.0)) / steps : 0.0;
result = fac * (toMax - toMin) + toMin;
} else if (interpolation == NODE_MAP_RANGE_INTERP_SMOOTHSTEP) {
float fac = (fromMin > fromMax) ?
1.0 - smoothstep(fromMax, fromMin, value) :
smoothstep(fromMin, fromMax, value);
result = fac * (toMax - toMin) + toMin;
} else {
float fac = (fromMin > fromMax) ?
1.0 - smootherstep(fromMax, fromMin, value) :
smootherstep(fromMin, fromMax, value);
result = fac * (toMax - toMin) + toMin;
}
if (inClamp && interpolation <= NODE_MAP_RANGE_INTERP_STEPPED) {
result = clamp(result, toMin, toMax);
}
}
void node_map_range(const int dataType, const int interpolation, bool inClamp, float value,
float fromMin, float fromMax, float toMin, float toMax, float steps, vec3 valueVec,
vec3 fromMinVec, vec3 fromMaxVec, vec3 toMinVec, vec3 toMaxVec, vec3 stepsVec,
out float result, out vec3 resultVec) {
if (dataType == NODE_MAP_RANGE_TYPE_FLOAT) {
if (fromMax == fromMin) {
result = 0.0;
} else if (interpolation == NODE_MAP_RANGE_INTERP_LINEAR) {
result = (value - fromMin) / (fromMax - fromMin) * (toMax - toMin) + toMin;
} else if (interpolation == NODE_MAP_RANGE_INTERP_STEPPED) {
float fac = (value - fromMin) / (fromMax - fromMin);
fac = (steps > 0.0) ? floor(fac * (steps + 1.0)) / steps : 0.0;
result = fac * (toMax - toMin) + toMin;
} else if (interpolation == NODE_MAP_RANGE_INTERP_SMOOTHSTEP) {
float fac = (fromMin > fromMax) ?
1.0 - smoothstep(fromMax, fromMin, value) :
smoothstep(fromMin, fromMax, value);
result = fac * (toMax - toMin) + toMin;
} else {
float fac = (fromMin > fromMax) ?
1.0 - smootherstep(fromMax, fromMin, value) :
smootherstep(fromMin, fromMax, value);
result = fac * (toMax - toMin) + toMin;
}
} else if (dataType == NODE_MAP_RANGE_TYPE_FLOAT_VECTOR) {
vec3 deltaVec = fromMaxVec - fromMinVec;
vec3 fac = vec3(
deltaVec.x == 0.0 ? 0.0 : (valueVec.x - fromMinVec.x) / deltaVec.x,
deltaVec.y == 0.0 ? 0.0 : (valueVec.y - fromMinVec.y) / deltaVec.y,
deltaVec.z == 0.0 ? 0.0 : (valueVec.z - fromMinVec.z) / deltaVec.z
);
if (interpolation == NODE_MAP_RANGE_INTERP_LINEAR) {
resultVec = fac * (toMaxVec - toMinVec) + toMinVec;
} else if (interpolation == NODE_MAP_RANGE_INTERP_STEPPED) {
fac.x = stepsVec.x == 0.0 ? 0.0 : floor(fac.x * (stepsVec.x + 1.0)) / stepsVec.x;
fac.y = stepsVec.y == 0.0 ? 0.0 : floor(fac.y * (stepsVec.y + 1.0)) / stepsVec.y;
fac.z = stepsVec.z == 0.0 ? 0.0 : floor(fac.z * (stepsVec.z + 1.0)) / stepsVec.z;
resultVec = fac * (toMaxVec - toMinVec) + toMinVec;
} else if (interpolation == NODE_MAP_RANGE_INTERP_SMOOTHSTEP) {
fac = clamp(fac, 0.0, 1.0);
fac = fac * fac * (3.0 - 2.0 * fac);
resultVec = fac * (toMaxVec - toMinVec) + toMinVec;
} else {
resultVec = smootherstep(fac) * (toMaxVec - toMinVec) + toMinVec;
}
if (inClamp && interpolation <= NODE_MAP_RANGE_INTERP_STEPPED) {
vec3 sumVec = toMinVec + toMaxVec;
toMaxVec = max(toMaxVec, toMinVec);
toMinVec = sumVec - toMaxVec;
resultVec = clamp(resultVec, toMinVec, toMaxVec);
}
}
}`,OX=`void node_math_add(float val1, float val2, float val3, out float outVal)
{
outVal = val1 + val2;
}
void node_math_subtract(float val1, float val2, float val3, out float outVal)
{
outVal = val1 - val2;
}
void node_math_multiply(float val1, float val2, float val3, out float outVal)
{
outVal = val1 * val2;
}
void node_math_divide(float val1, float val2, float val3, out float outVal)
{
if (val2 == 0.0)
outVal = 0.0;
else
outVal = val1 / val2;
}
void node_math_sine(float val, float val2, float val3, out float outVal)
{
outVal = sin(val);
}
void node_math_cosine(float val, float val2, float val3, out float outVal)
{
outVal = cos(val);
}
void node_math_tangent(float val, float val2, float val3, out float outVal)
{
outVal = tan(val);
}
void node_math_arcsine(float val, float val2, float val3, out float outVal)
{
if (val <= 1.0 && val >= -1.0)
outVal = asin(val);
else
outVal = 0.0;
}
void node_math_arccosine(float val, float val2, float val3, out float outVal)
{
if (val <= 1.0 && val >= -1.0)
outVal = acos(val);
else
outVal = 0.0;
}
void node_math_arctangent(float val, float val2, float val3, out float outVal)
{
outVal = atan(val);
}
void node_math_arctan2(float val, float val2, float val3, out float outVal)
{
outVal = atan(val, val2);
}
void node_math_power(float val1, float val2, float val3, out float outVal)
{
if (val1 >= 0.0)
outVal = powCompat(val1, val2);
else {
float val2_mod_1 = mod(abs(val2), 1.0);
if (val2_mod_1 > 0.999 || val2_mod_1 < 0.001)
outVal = powCompat(val1, floor(val2 + 0.5));
else
outVal = 0.0;
}
}
void node_math_logarithm(float val1, float val2, float val3, out float outVal)
{
if (val1 > 0.0 && val2 > 0.0)
outVal = log2(val1) / log2(val2);
else
outVal = 0.0;
}
void node_math_sqrt(float val1, float val2, float val3, out float outVal)
{
outVal = sqrt(val1);
}
void node_math_maximum(float val1, float val2, float val3, out float outVal)
{
outVal = max(val1, val2);
}
void node_math_minimum(float val1, float val2, float val3, out float outVal)
{
outVal = min(val1, val2);
}
void node_math_round(float val1, float val2, float val3, out float outVal)
{
outVal = floor(val1 + 0.5);
}
void node_math_floor(float val1, float val2, float val3, out float outVal)
{
outVal = floor(val1);
}
void node_math_ceil(float val1, float val2, float val3, out float outVal)
{
outVal = ceil(val1);
}
void node_math_fract(float val1, float val2, float val3, out float outVal)
{
outVal = fract(val1);
}
void node_math_less_than(float val1, float val2, float val3, out float outVal)
{
if (val1 < val2)
outVal = 1.0;
else
outVal = 0.0;
}
void node_math_greater_than(float val1, float val2, float val3, out float outVal)
{
if (val1 > val2)
outVal = 1.0;
else
outVal = 0.0;
}
void node_math_modulo(float val1, float val2, float val3, out float outVal)
{
if (val2 == 0.0)
outVal = 0.0;
else
outVal = mod(val1, val2);
outVal = (val1 > 0.0) ? outVal : outVal - val2;
}
void node_math_absolute(float val1, float val2, float val3, out float outVal)
{
outVal = abs(val1);
}
void node_math_compare(float val1, float val2, float val3, out float outVal) {
outVal = step(abs(val1 - val2), val3);
}
void node_math_cosh(float val1, float val2, float val3, out float outVal) {
outVal = cosh(val1);
}
void node_math_degrees(float val1, float val2, float val3, out float outVal) {
outVal = val1 / PI * 180.0;
}
void node_math_exponent(float val1, float val2, float val3, out float outVal) {
outVal = exp(val1);
}
void node_math_inverse_sqrt(float val1, float val2, float val3, out float outVal) {
if (val1 >= 0.0) {
outVal = 1.0 / sqrt(val1);
} else {
outVal = 0.0;
}
}
void node_math_multiply_add(float val1, float val2, float val3, out float outVal) {
outVal = val1 * val2 + val3;
}
void node_math_pingpong(float val1, float val2, float val3, out float outVal) {
if (val2 == 0.0) {
outVal = 0.0;
} else {
float absVal2 = abs(val2);
float rem = mod(val1, absVal2);
outVal = mix(rem, absVal2 - rem, mod(floor(val1 / absVal2), 2.0));
}
}
void node_math_radians(float val1, float val2, float val3, out float outVal) {
outVal = val1 / 180.0 * PI;
}
void node_math_sign(float val1, float val2, float val3, out float outVal) {
outVal = sign(val1);
}
void node_math_sinh(float val1, float val2, float val3, out float outVal) {
outVal = sinh(val1);
}
void node_math_smooth_max(float val1, float val2, float val3, out float outVal) {
outVal = smoothMax(val1, val2, val3);
}
void node_math_smooth_min(float val1, float val2, float val3, out float outVal) {
outVal = smoothMin(val1, val2, val3);
}
void node_math_snap(float val1, float val2, float val3, out float outVal) {
val1 += 1e-5 * sign(val2);
float quot = val1 / val2;
outVal = floor(quot) * val2;
}
void node_math_tanh(float val1, float val2, float val3, out float outVal) {
outVal = tanh(val1);
}
void node_math_trunc(float val1, float val2, float val3, out float outVal) {
val1 += 1e-5;
outVal = trunc(val1);
}
void node_math_wrap(float val1, float val2, float val3, out float outVal) {
val1 += 1e-5;
outVal = mod(val1 - val3, val2 - val3) + val3;
}`,FX=`void node_mix_rgba_mix(float fac, vec4 col1, vec4 col2, out vec4 outCol)
{
fac = clamp(fac, 0.0, 1.0);
outCol = mix(col1, col2, fac);
outCol.a = col1.a;
}
void node_mix_rgba_add(float fac, vec4 col1, vec4 col2, out vec4 outCol)
{
fac = clamp(fac, 0.0, 1.0);
outCol = mix(col1, col1 + col2, fac);
outCol.a = col1.a;
}
void node_mix_rgba_multiply(float fac, vec4 col1, vec4 col2, out vec4 outCol)
{
fac = clamp(fac, 0.0, 1.0);
outCol = mix(col1, col1 * col2, fac);
outCol.a = col1.a;
}
void node_mix_rgba_screen(float fac, vec4 col1, vec4 col2, out vec4 outCol)
{
fac = clamp(fac, 0.0, 1.0);
float facm = 1.0 - fac;
outCol = vec4(1.0) - (vec4(facm) + fac * (vec4(1.0) - col2)) * (vec4(1.0) - col1);
outCol.a = col1.a;
}
void node_mix_rgba_overlay(float fac, vec4 col1, vec4 col2, out vec4 outCol)
{
fac = clamp(fac, 0.0, 1.0);
float facm = 1.0 - fac;
outCol = col1;
if (outCol.r < 0.5)
outCol.r *= facm + 2.0 * fac * col2.r;
else
outCol.r = 1.0 - (facm + 2.0 * fac * (1.0 - col2.r)) * (1.0 - outCol.r);
if (outCol.g < 0.5)
outCol.g *= facm + 2.0 * fac * col2.g;
else
outCol.g = 1.0 - (facm + 2.0 * fac * (1.0 - col2.g)) * (1.0 - outCol.g);
if (outCol.b < 0.5)
outCol.b *= facm + 2.0 * fac * col2.b;
else
outCol.b = 1.0 - (facm + 2.0 * fac * (1.0 - col2.b)) * (1.0 - outCol.b);
}
void node_mix_rgba_exclusion(float fac, vec4 col1, vec4 col2, out vec4 outCol)
{
fac = clamp(fac, 0.0, 1.0);
outCol = max(mix(col1, col1 + col2 - 2.0 * col1 * col2, fac), 0.0);
outCol.a = col1.a;
}
void node_mix_rgba_subtract(float fac, vec4 col1, vec4 col2, out vec4 outCol)
{
fac = clamp(fac, 0.0, 1.0);
outCol = mix(col1, col1 - col2, fac);
outCol.a = col1.a;
}
void node_mix_rgba_divide(float fac, vec4 col1, vec4 col2, out vec4 outCol)
{
fac = clamp(fac, 0.0, 1.0);
float facm = 1.0 - fac;
outCol = col1;
if (col2.r != 0.0) outCol.r = facm * outCol.r + fac * outCol.r / col2.r;
if (col2.g != 0.0) outCol.g = facm * outCol.g + fac * outCol.g / col2.g;
if (col2.b != 0.0) outCol.b = facm * outCol.b + fac * outCol.b / col2.b;
}
void node_mix_rgba_difference(float fac, vec4 col1, vec4 col2, out vec4 outCol)
{
fac = clamp(fac, 0.0, 1.0);
outCol = mix(col1, abs(col1 - col2), fac);
outCol.a = col1.a;
}
void node_mix_rgba_darken(float fac, vec4 col1, vec4 col2, out vec4 outCol)
{
fac = clamp(fac, 0.0, 1.0);
outCol.rgb = mix(col1.rgb, min(col1.rgb, col2.rgb), fac);
outCol.a = col1.a;
}
void node_mix_rgba_lighten(float fac, vec4 col1, vec4 col2, out vec4 outCol)
{
fac = clamp(fac, 0.0, 1.0);
outCol.rgb = mix(col1.rgb, max(col1.rgb, col2.rgb), fac);
outCol.a = col1.a;
}
void node_mix_rgba_dodge(float fac, vec4 col1, vec4 col2, out vec4 outCol)
{
fac = clamp(fac, 0.0, 1.0);
outCol = col1;
if (outCol.r != 0.0) {
float tmp = 1.0 - fac * col2.r;
if (tmp <= 0.0)
outCol.r = 1.0;
else if ((tmp = outCol.r / tmp) > 1.0)
outCol.r = 1.0;
else
outCol.r = tmp;
}
if (outCol.g != 0.0) {
float tmp = 1.0 - fac * col2.g;
if (tmp <= 0.0)
outCol.g = 1.0;
else if ((tmp = outCol.g / tmp) > 1.0)
outCol.g = 1.0;
else
outCol.g = tmp;
}
if (outCol.b != 0.0) {
float tmp = 1.0 - fac * col2.b;
if (tmp <= 0.0)
outCol.b = 1.0;
else if ((tmp = outCol.b / tmp) > 1.0)
outCol.b = 1.0;
else
outCol.b = tmp;
}
}
void node_mix_rgba_burn(float fac, vec4 col1, vec4 col2, out vec4 outCol)
{
fac = clamp(fac, 0.0, 1.0);
float tmp, facm = 1.0 - fac;
outCol = col1;
tmp = facm + fac * col2.r;
if (tmp <= 0.0)
outCol.r = 0.0;
else if ((tmp = (1.0 - (1.0 - outCol.r) / tmp)) < 0.0)
outCol.r = 0.0;
else if (tmp > 1.0)
outCol.r = 1.0;
else
outCol.r = tmp;
tmp = facm + fac * col2.g;
if (tmp <= 0.0)
outCol.g = 0.0;
else if ((tmp = (1.0 - (1.0 - outCol.g) / tmp)) < 0.0)
outCol.g = 0.0;
else if (tmp > 1.0)
outCol.g = 1.0;
else
outCol.g = tmp;
tmp = facm + fac * col2.b;
if (tmp <= 0.0)
outCol.b = 0.0;
else if ((tmp = (1.0 - (1.0 - outCol.b) / tmp)) < 0.0)
outCol.b = 0.0;
else if (tmp > 1.0)
outCol.b = 1.0;
else
outCol.b = tmp;
}
#ifdef HSV_NODES
void node_mix_rgba_hue(float fac, vec4 col1, vec4 col2, out vec4 outCol)
{
fac = clamp(fac, 0.0, 1.0);
float facm = 1.0 - fac;
outCol = col1;
vec4 hsv, hsv2, tmp;
rgbToHSV(col2, hsv2);
if (hsv2.y != 0.0) {
rgbToHSV(outCol, hsv);
hsv.x = hsv2.x;
hsvToRGB(hsv, tmp);
outCol = mix(outCol, tmp, fac);
outCol.a = col1.a;
}
}
void node_mix_rgba_saturation(float fac, vec4 col1, vec4 col2, out vec4 outCol)
{
fac = clamp(fac, 0.0, 1.0);
float facm = 1.0 - fac;
outCol = col1;
vec4 hsv, hsv2;
rgbToHSV(outCol, hsv);
if (hsv.y != 0.0) {
rgbToHSV(col2, hsv2);
hsv.y = facm * hsv.y + fac * hsv2.y;
hsvToRGB(hsv, outCol);
}
}
void node_mix_rgba_value(float fac, vec4 col1, vec4 col2, out vec4 outCol)
{
fac = clamp(fac, 0.0, 1.0);
float facm = 1.0 - fac;
vec4 hsv, hsv2;
rgbToHSV(col1, hsv);
rgbToHSV(col2, hsv2);
hsv.z = facm * hsv.z + fac * hsv2.z;
hsvToRGB(hsv, outCol);
}
void node_mix_rgba_color(float fac, vec4 col1, vec4 col2, out vec4 outCol)
{
fac = clamp(fac, 0.0, 1.0);
float facm = 1.0 - fac;
outCol = col1;
vec4 hsv, hsv2, tmp;
rgbToHSV(col2, hsv2);
if (hsv2.y != 0.0) {
rgbToHSV(outCol, hsv);
hsv.x = hsv2.x;
hsv.y = hsv2.y;
hsvToRGB(hsv, tmp);
outCol = mix(outCol, tmp, fac);
outCol.a = col1.a;
}
}
#endif
void node_mix_rgba_soft_light(float fac, vec4 col1, vec4 col2, out vec4 outCol)
{
fac = clamp(fac, 0.0, 1.0);
float facm = 1.0 - fac;
vec4 one = vec4(1.0);
vec4 scr = one - (one - col2) * (one - col1);
outCol = facm * col1 + fac * ((one - col1) * col2 * col1 + col1 * scr);
}
void node_mix_rgba_linear_light(float fac, vec4 col1, vec4 col2, out vec4 outCol)
{
fac = clamp(fac, 0.0, 1.0);
outCol = col1 + fac * (2.0 * (col2 - vec4(0.5)));
}
void node_mix_vector_uniform(float fac, vec3 facVec, vec3 v1, vec3 v2, out vec3 outVec)
{
fac = clamp(fac, 0.0, 1.0);
outVec = mix(v1, v2, fac);
}
void node_mix_vector_non_uniform(float fac, vec3 facVec, vec3 v1, vec3 v2, out vec3 outVec)
{
facVec = clamp(facVec, 0.0, 1.0);
outVec = mix(v1, v2, facVec);
}
void node_mix_float(float fac, float val1, float val2, out float outVal)
{
fac = clamp(fac, 0.0, 1.0);
outVal = mix(val1, val2, fac);
}`,UX=`
void node_mix_rgb_mix(float fac, vec4 col1, vec4 col2, out vec4 outCol)
{
fac = clamp(fac, 0.0, 1.0);
outCol = mix(col1, col2, fac);
outCol.a = col1.a;
}
void node_mix_rgb_add(float fac, vec4 col1, vec4 col2, out vec4 outCol)
{
fac = clamp(fac, 0.0, 1.0);
outCol = mix(col1, col1 + col2, fac);
outCol.a = col1.a;
}
void node_mix_rgb_multiply(float fac, vec4 col1, vec4 col2, out vec4 outCol)
{
fac = clamp(fac, 0.0, 1.0);
outCol = mix(col1, col1 * col2, fac);
outCol.a = col1.a;
}
void node_mix_rgb_screen(float fac, vec4 col1, vec4 col2, out vec4 outCol)
{
fac = clamp(fac, 0.0, 1.0);
float facm = 1.0 - fac;
outCol = vec4(1.0) - (vec4(facm) + fac * (vec4(1.0) - col2)) * (vec4(1.0) - col1);
outCol.a = col1.a;
}
void node_mix_rgb_overlay(float fac, vec4 col1, vec4 col2, out vec4 outCol)
{
fac = clamp(fac, 0.0, 1.0);
float facm = 1.0 - fac;
outCol = col1;
if (outCol.r < 0.5)
outCol.r *= facm + 2.0 * fac * col2.r;
else
outCol.r = 1.0 - (facm + 2.0 * fac * (1.0 - col2.r)) * (1.0 - outCol.r);
if (outCol.g < 0.5)
outCol.g *= facm + 2.0 * fac * col2.g;
else
outCol.g = 1.0 - (facm + 2.0 * fac * (1.0 - col2.g)) * (1.0 - outCol.g);
if (outCol.b < 0.5)
outCol.b *= facm + 2.0 * fac * col2.b;
else
outCol.b = 1.0 - (facm + 2.0 * fac * (1.0 - col2.b)) * (1.0 - outCol.b);
}
void node_mix_rgb_subtract(float fac, vec4 col1, vec4 col2, out vec4 outCol)
{
fac = clamp(fac, 0.0, 1.0);
outCol = mix(col1, col1 - col2, fac);
outCol.a = col1.a;
}
void node_mix_rgb_divide(float fac, vec4 col1, vec4 col2, out vec4 outCol)
{
fac = clamp(fac, 0.0, 1.0);
float facm = 1.0 - fac;
outCol = col1;
if (col2.r != 0.0) outCol.r = facm * outCol.r + fac * outCol.r / col2.r;
if (col2.g != 0.0) outCol.g = facm * outCol.g + fac * outCol.g / col2.g;
if (col2.b != 0.0) outCol.b = facm * outCol.b + fac * outCol.b / col2.b;
}
void node_mix_rgb_difference(float fac, vec4 col1, vec4 col2, out vec4 outCol)
{
fac = clamp(fac, 0.0, 1.0);
outCol = mix(col1, abs(col1 - col2), fac);
outCol.a = col1.a;
}
void node_mix_rgb_darken(float fac, vec4 col1, vec4 col2, out vec4 outCol)
{
fac = clamp(fac, 0.0, 1.0);
outCol.rgb = mix(col1.rgb, min(col1.rgb, col2.rgb), fac);
outCol.a = col1.a;
}
void node_mix_rgb_lighten(float fac, vec4 col1, vec4 col2, out vec4 outCol)
{
fac = clamp(fac, 0.0, 1.0);
outCol.rgb = max(col1.rgb, col2.rgb * fac);
outCol.a = col1.a;
}
void node_mix_rgb_dodge(float fac, vec4 col1, vec4 col2, out vec4 outCol)
{
fac = clamp(fac, 0.0, 1.0);
outCol = col1;
if (outCol.r != 0.0) {
float tmp = 1.0 - fac * col2.r;
if (tmp <= 0.0)
outCol.r = 1.0;
else if ((tmp = outCol.r / tmp) > 1.0)
outCol.r = 1.0;
else
outCol.r = tmp;
}
if (outCol.g != 0.0) {
float tmp = 1.0 - fac * col2.g;
if (tmp <= 0.0)
outCol.g = 1.0;
else if ((tmp = outCol.g / tmp) > 1.0)
outCol.g = 1.0;
else
outCol.g = tmp;
}
if (outCol.b != 0.0) {
float tmp = 1.0 - fac * col2.b;
if (tmp <= 0.0)
outCol.b = 1.0;
else if ((tmp = outCol.b / tmp) > 1.0)
outCol.b = 1.0;
else
outCol.b = tmp;
}
}
void node_mix_rgb_burn(float fac, vec4 col1, vec4 col2, out vec4 outCol)
{
fac = clamp(fac, 0.0, 1.0);
float tmp, facm = 1.0 - fac;
outCol = col1;
tmp = facm + fac * col2.r;
if (tmp <= 0.0)
outCol.r = 0.0;
else if ((tmp = (1.0 - (1.0 - outCol.r) / tmp)) < 0.0)
outCol.r = 0.0;
else if (tmp > 1.0)
outCol.r = 1.0;
else
outCol.r = tmp;
tmp = facm + fac * col2.g;
if (tmp <= 0.0)
outCol.g = 0.0;
else if ((tmp = (1.0 - (1.0 - outCol.g) / tmp)) < 0.0)
outCol.g = 0.0;
else if (tmp > 1.0)
outCol.g = 1.0;
else
outCol.g = tmp;
tmp = facm + fac * col2.b;
if (tmp <= 0.0)
outCol.b = 0.0;
else if ((tmp = (1.0 - (1.0 - outCol.b) / tmp)) < 0.0)
outCol.b = 0.0;
else if (tmp > 1.0)
outCol.b = 1.0;
else
outCol.b = tmp;
}
#ifdef HSV_NODES
void node_mix_rgb_hue(float fac, vec4 col1, vec4 col2, out vec4 outCol)
{
fac = clamp(fac, 0.0, 1.0);
float facm = 1.0 - fac;
outCol = col1;
vec4 hsv, hsv2, tmp;
rgbToHSV(col2, hsv2);
if (hsv2.y != 0.0) {
rgbToHSV(outCol, hsv);
hsv.x = hsv2.x;
hsvToRGB(hsv, tmp);
outCol = mix(outCol, tmp, fac);
outCol.a = col1.a;
}
}
void node_mix_rgb_saturation(float fac, vec4 col1, vec4 col2, out vec4 outCol)
{
fac = clamp(fac, 0.0, 1.0);
float facm = 1.0 - fac;
outCol = col1;
vec4 hsv, hsv2;
rgbToHSV(outCol, hsv);
if (hsv.y != 0.0) {
rgbToHSV(col2, hsv2);
hsv.y = facm * hsv.y + fac * hsv2.y;
hsvToRGB(hsv, outCol);
}
}
void node_mix_rgb_value(float fac, vec4 col1, vec4 col2, out vec4 outCol)
{
fac = clamp(fac, 0.0, 1.0);
float facm = 1.0 - fac;
vec4 hsv, hsv2;
rgbToHSV(col1, hsv);
rgbToHSV(col2, hsv2);
hsv.z = facm * hsv.z + fac * hsv2.z;
hsvToRGB(hsv, outCol);
}
void node_mix_rgb_color(float fac, vec4 col1, vec4 col2, out vec4 outCol)
{
fac = clamp(fac, 0.0, 1.0);
float facm = 1.0 - fac;
outCol = col1;
vec4 hsv, hsv2, tmp;
rgbToHSV(col2, hsv2);
if (hsv2.y != 0.0) {
rgbToHSV(outCol, hsv);
hsv.x = hsv2.x;
hsv.y = hsv2.y;
hsvToRGB(hsv, tmp);
outCol = mix(outCol, tmp, fac);
outCol.a = col1.a;
}
}
#endif
void node_mix_rgb_soft_light(float fac, vec4 col1, vec4 col2, out vec4 outCol)
{
fac = clamp(fac, 0.0, 1.0);
float facm = 1.0 - fac;
vec4 one = vec4(1.0);
vec4 scr = one - (one - col2) * (one - col1);
outCol = facm * col1 + fac * ((one - col1) * col2 * col1 + col1 * scr);
}
void node_mix_rgb_linear_light(float fac, vec4 col1, vec4 col2, out vec4 outCol)
{
fac = clamp(fac, 0.0, 1.0);
outCol = col1 + fac * (2.0 * (col2 - vec4(0.5)));
}`,zX=`void node_mix_shader(int transpShaderNum,
float fac, vec4 color1, vec4 color2, out vec4 outColor)
{
if (transpShaderNum == 0)
color1.rgb = color2.rgb;
else if (transpShaderNum == 1)
color2.rgb = color1.rgb;
outColor = mix(color1, color2, clamp(fac, 0.0, 1.0));
}`,VX=`void node_new_geometry(
float frontFacing, vec3 viewPos, vec3 viewNorm,
out vec3 position, out vec3 normal, out vec3 tangent,
out vec3 trueNormal, out vec3 incoming, out vec3 parametric,
out float backfacing, out float pointiness, out float randomPerIsland)
{
vec4 posWorld = invViewMatrix * vec4(-viewPos, 1.0);
position = swizzleUpZ(posWorld.xyz);
vec4 viewDir = isOrthographic ? vec4(0.0, 0.0, -1.0, 0.0) : vec4(normalize(-viewPos), 0.0);
viewDir = invViewMatrix * viewDir;
vec3 incomingVec = -swizzleUpZ(viewDir.xyz);
#if WORLD_NODES == 1
normal = incomingVec;
tangent = vec3(0.0);
#else
vec3 norWorld = normalize(invViewMatrix * vec4(viewNorm, 0.0)).xyz;
normal = swizzleUpZ(norWorld);
vec4 posLocal = invModelMatrix * posWorld;
vec3 posLocalDelta = posLocal.xyz - boundingBoxMin;
vec3 bbDelta = boundingBoxMax - boundingBoxMin;
vec3 posOrco = vec3(
bbDelta.x < 1e-5 ? -sign(posLocal.y) : posLocalDelta.x / bbDelta.x,
0.0,
bbDelta.z < 1e-5 ? sign(posLocal.y) : posLocalDelta.z / bbDelta.z
);
posOrco -= 0.5;
vec3 tangWorld = (modelMatrix * vec4(posOrco.z, 0.0, -posOrco.x, 0.0)).xyz;
tangWorld = cross(norWorld, normalize(cross(tangWorld, norWorld)));
tangent = swizzleUpZ(tangWorld);
#endif
trueNormal = normal;
incoming = incomingVec;
parametric = vec3(0.0);
backfacing = (frontFacing > 0.0) ? 0.0 : 1.0;
#if WORLD_NODES == 1
pointiness = 0.0;
#else
pointiness = 0.5;
#endif
randomPerIsland = 0.0;
}`,kX=`void node_normal(vec3 norParam, vec3 norIn, out vec3 norOut, out float dotOut)
{
norOut = norParam;
dotOut = dot(normalize(norIn), norParam);
}`,GX=`void node_normal_map(vec4 tangent, vec3 normal, float strength, vec4 normalColor, out vec3 normalOut)
{
#ifdef DOUBLE_SIDED
normal = normal * (float(gl_FrontFacing) * 2.0 - 1.0);
#endif
if (all(lessThan(abs(tangent.xyz), vec3(EPSILON)))) {
normalOut = normal;
} else {
vec3 normalTex = (normalColor.xyz * 2.0 - 1.0);
vec4 viewTangent = vec4(normalize((modelViewMatrix * vec4(tangent.xyz, 0.0)).xyz), tangent.w);
vec3 bitangent = viewTangent.w * cross(normal, viewTangent.xyz);
normalOut = normalize(normalTex.x * viewTangent.xyz + normalTex.y * bitangent
+ normalTex.z * normal);
normalOut = mix(normal, normalOut, strength);
}
normalOut = normalize((invViewMatrix * vec4(normalOut, 0.0)).xyz);
normalOut = swizzleUpZ(normalOut);
}`,QX=`uniform int objectIndex;
uniform vec4 objectColor;
uniform int materialIndex;
uniform float objectRandom;
void node_object_info(out vec3 location, out vec4 color, out float alpha, out float objIndex,
out float matIndex, out float random) {
#if WORLD_NODES == 1
location = vec3(0.0);
color = vec4(1.0);
alpha = 1.0;
objIndex = 0.0;
matIndex = 0.0;
random = 0.0;
#else
location = swizzleUpZ(modelMatrix[3].xyz);
color = vec4(objectColor.rgb, 1.0);
alpha = objectColor.a;
objIndex = float(objectIndex);
matIndex = float(materialIndex);
random = float(objectRandom);
#endif
}
void node_object_info(out vec3 location, out vec4 color, out float objIndex,
out float matIndex, out float random) {
float alpha;
node_object_info(location, color, alpha, objIndex, matIndex, random);
}`,HX=`void node_output_lamp(out vec4 outColor)
{
outColor = vec4(0.0);
}`,WX=`void node_output_material(vec4 surface, vec4 volume, vec3 displacement, float thickness, out vec4 outgoingLight) {
outgoingLight = surface + volume;
}
void node_output_material(vec4 surface, vec4 volume, vec3 displacement, out vec4 outgoingLight) {
node_output_material(surface, volume, displacement, 0.0, outgoingLight);
}`,YX=`void node_output_world(vec4 surface, vec4 volume, out vec4 outgoingLight)
{
outgoingLight = surface;
}`,jX=`void node_particle_info(out float index, out float random, out float age,
out float lifeTime, out vec3 location, out float size, out vec3 velocity,
out vec3 angularVelocity) {
#if WORLD_NODES == 1
index = 0.0;
random = 0.0;
age = 0.0;
lifeTime = 0.0;
location = vec3(0.0);
size = 0.0;
velocity = vec3(0.0);
angularVelocity = vec3(0.0);
#else
index = 0.0;
random = 0.0;
age = 0.0;
lifeTime = 0.0;
location = vec3(0.0);
size = 0.0;
velocity = vec3(0.0);
angularVelocity = vec3(0.0);
#endif
}`,XX=`void node_point_info(out vec3 position, out float radius, out float random) {
position = vec3(0.0);
radius = 0.0;
random = 0.0;
}`,qX=`void node_principled_volume(vec4 color, float colorAttribute, float density,
float densityAttribute, float anisotropy, vec4 absorptionColor,
float emissionStrength, vec4 emissionColor, float blackbodyIntensity,
vec4 blackbodyTint, float temperature, float temperatureAttribute,
out vec4 volume) {
volume = vec4(0.0);
}`,ZX=`uniform vec4 nodeRGB[NODE_RGB_NUM];
void node_rgb(vec4 color, out vec4 outColor)
{
outColor = color;
}`,KX=`void node_rgbtobw(vec4 color, out float outVal) {
outVal = linearToRelativeLuminance(color.rgb);
}`,$X=`void node_script(out vec4 outColor)
{
outColor = vec4(0.0);
}`,JX=`
void node_sephsv(vec4 col, out float h, out float s, out float v)
{
vec4 hsv;
rgbToHSV(col, hsv);
h = hsv[0];
s = hsv[1];
v = hsv[2];
}`,eq=`#define NODE_SEP_COL_RGB 0
#define NODE_SEP_COL_HSV 1
#define NODE_SEP_COL_HSL 2
void rgbToHSL(vec3 rgb, out vec3 outCol)
{
float cMax, cMin;
float h, s, l;
cMax = max(rgb[0], max(rgb[1], rgb[2]));
cMin = min(rgb[0], min(rgb[1], rgb[2]));
l = min(1.0, (cMax + cMin) / 2.0);
if (cMax == cMin) {
h = s = 0.0;
} else {
float cdelta = cMax - cMin;
s = l > 0.5 ? cdelta / (2.0 - cMax - cMin) : cdelta / (cMax + cMin);
if (cMax == rgb[0]) {
h = (rgb[1] - rgb[2]) / cdelta + (rgb[1] < rgb[2] ? 6.0 : 0.0);
} else if (cMax == rgb[1]) {
h = (rgb[2] - rgb[0]) / cdelta + 2.0;
} else {
h = (rgb[0] - rgb[1]) / cdelta + 4.0;
}
}
h /= 6.0;
outCol = vec3(h, s, l);
}
void node_separate_color(int mode, vec4 color, out float r, out float g, out float b)
{
if (mode == NODE_SEP_COL_RGB) {
r = color.r;
g = color.g;
b = color.b;
} else if (mode == NODE_SEP_COL_HSV) {
vec4 hsv;
rgbToHSV(color, hsv);
r = hsv[0];
g = hsv[1];
b = hsv[2];
} else {
vec3 hsl;
rgbToHSL(color.rgb, hsl);
r = hsl[0];
g = hsl[1];
b = hsl[2];
}
}`,tq=`
void node_seprgb(vec4 col, out float r, out float g, out float b)
{
r = col.r;
g = col.g;
b = col.b;
}`,nq=`void node_sepxyz(vec3 vector, out float x, out float y, out float z)
{
x = vector.x;
y = vector.y;
z = vector.z;
}`,rq=`void node_shadertorgb(vec4 shader, out vec4 color, out float alpha) {
color = vec4(shader.rgb, 1.0);
alpha = shader.a;
}`,oq=`void node_squeeze(float val, float width, float center, out float outVal)
{
outVal = 1.0 / (1.0 + pow(2.71828183, -((val - center) * width)));
}`,aq=`void node_subsurface_scattering(
vec4 color, float scale, vec3 radius, float sharpen, float textureBlur, vec3 normal,
out vec4 outColor)
{
outColor = color;
}`,iq=`#define TANGENT_AXIS_X 0
#define TANGENT_AXIS_Y 1
#define TANGENT_AXIS_Z 2
void node_tangent(int axis, vec3 viewPos, vec3 viewNorm, out vec3 outTangent) {
outTangent = vec3(0.0);
#if WORLD_NODES == 0
vec4 posWorld = invViewMatrix * vec4(-viewPos, 1.0);
vec3 norWorld = normalize(invViewMatrix * vec4(viewNorm, 0.0)).xyz;
vec3 posLocal = (invModelMatrix * posWorld).xyz;
vec3 posOrco = (posLocal - boundingBoxMin)
/ (boundingBoxMax - boundingBoxMin) - 0.5;
vec4 posOrcoPermuted;
if (axis == TANGENT_AXIS_X) {
posOrcoPermuted = vec4(0.0, -posOrco.z, posOrco.y, 0.0);
} else if (axis == TANGENT_AXIS_Y) {
posOrcoPermuted = vec4(-posOrco.y, posOrco.x, 0.0, 0.0);
} else if (axis == TANGENT_AXIS_Z) {
posOrcoPermuted = vec4(posOrco.z, 0.0, -posOrco.x, 0.0);
}
vec3 tangWorld = (modelMatrix * posOrcoPermuted).xyz;
tangWorld = cross(norWorld, normalize(cross(tangWorld, norWorld)));
outTangent = swizzleUpZ(tangWorld);
#endif
}
void node_tangent(vec4 tangent, out vec3 outTangent) {
#if WORLD_NODES == 0
outTangent = normalize((modelMatrix * vec4(tangent.xyz, 0.0)).xyz);
outTangent = swizzleUpZ(outTangent);
#endif
}`,sq=`float integer_noise(int rowCount, int brickCount)
{
#if __VERSION__ == 300
int n = (rowCount << 16) + (brickCount & 0xFFFF);
n = (n + 1013) & 0x7fffffff;
n = (n >> 13) ^ n;
int nn = (n * (n * n * 60493 + 19990303) + 1376312589) & 0x7fffffff;
return 0.5 * (float(nn) / 1073741824.0);
#else
const int RAND_MAX = 32767;
int next = ((123456 * rowCount) + brickCount) * 1103515245 + 12345;
return (mod(float(next/65536), float(RAND_MAX + 1))) / float(RAND_MAX);
#endif
}
void node_tex_brick(
float offset, int offsetFrequency, float squash, int squashFrequency, 
vec3 vector, vec4 color1, vec4 color2, vec4 mortar, float scale,
float mortarSize, float mortarSmooth, float bias, float brickWidth,
float rowHeight,
out vec4 outColor, out float outFac)
{
float x, y;
vec3 p = vector * scale;
float rowCount = floor(p.y / rowHeight);
if (offsetFrequency != 0 && squashFrequency != 0) {
brickWidth *= mod(rowCount, float(squashFrequency)) > 0.5 ? 1.0 : squash;
offset = mod(rowCount, float(offsetFrequency)) > 0.5 ? 0.0 : (brickWidth * offset);
} 
int brickCount = int((p.x + offset) / brickWidth); 
float tint = clamp((integer_noise(int(rowCount), brickCount) + bias), 0.0, 1.0);

x = abs((p.x + offset) - brickWidth * float(brickCount));
y = abs(p.y - rowHeight * rowCount);
float min_dist = min(min(x, y), min(brickWidth - x, rowHeight - y));

float f = step(min_dist, mortarSize);
if (mortarSmooth > 0.0) {
min_dist = 1.0 - min_dist / mortarSize;
f *= smoothstep(0.0, mortarSmooth, min_dist);
}
outColor = mix(mix(color1, color2, tint), mortar, f);
outFac = f;
}`,lq=`void node_tex_checker(vec3 vector, vec4 color1, vec4 color2, float scale, 
out vec4 outColor, out float outFac)
{
vec3 p = vector * scale;
p = (p + 0.00001) * 0.99999;
float cx = floor(p.x);
float cy = floor(p.y);
float cz = floor(p.z);
float result = sign(mod(cx + cy + cz, 2.0));
outFac = max(result, 0.0);
outColor = mix(color2, color1, outFac);
}`,cq=`uniform mat4 nodeTexCoordObjectMatrices[NODE_TEX_COORD_NUM];
void node_tex_coord(
mat4 objectMat, vec3 viewPos, vec3 viewNorm, vec2 uv,
out vec3 outGenerated, out vec3 outNormal, out vec3 outUV, out vec3 outObject,
out vec3 outCamera, out vec3 outWindow, out vec3 outReflection)
{
vec4 view = vec4(-viewPos, 1.0);
vec4 posWorld = invViewMatrix * view;
vec3 loc = swizzleUpZ((invModelMatrix * posWorld).xyz);
#if WORLD_NODES == 1
loc = normalize(loc);
#endif
#if WORLD_NODES == 1
outGenerated = loc;
#else
vec3 boxMin = vec3(boundingBoxMin.x, -boundingBoxMax.z, boundingBoxMin.y);
vec3 boxMax = vec3(boundingBoxMax.x, -boundingBoxMin.z, boundingBoxMax.y);
vec3 boxSize = boxMax - boxMin;
if (abs(boxSize.x) < 0.001) {
outGenerated.x = 0.5;
} else {
outGenerated.x = (loc.x - boxMin.x) / boxSize.x;
}
if (abs(boxSize.y) < 0.001) {
outGenerated.y = 0.5;
} else {
outGenerated.y = (loc.y - boxMin.y) / boxSize.y;
}
if (abs(boxSize.z) < 0.001) {
outGenerated.z = 0.5;
} else {
outGenerated.z = (loc.z - boxMin.z) / boxSize.z;
}
#endif
#if WORLD_NODES == 1
outNormal = -loc;
#else
outNormal = normalize(invModelMatrix * invViewMatrix * vec4(viewNorm, 0.0)).rgb;
outNormal = swizzleUpZ(outNormal);
#endif
#if WORLD_NODES == 1
outUV = vec3(0.0);
#else
uv.y = 1.0 - uv.y;
outUV = vec3(uv, 0.0);
#endif
#if WORLD_NODES == 1
outObject = loc;
#else
outObject = swizzleUpZ((objectMat * posWorld).xyz);
#endif
outCamera = vec3(view.xy, -view.z);
#if WORLD_NODES == 1
outWindow = vec3(0.0);
#else
outWindow = vec3(gl_FragCoord.xy / viewWidthHeight, 0.0);
#endif
#if WORLD_NODES == 1
outReflection = -loc;
#else
vec4 reflection = (invViewMatrix * vec4(reflect(view.xyz, normalize(viewNorm)), 0.0));
outReflection = normalize(swizzleUpZ(reflection.xyz));
#endif
}`,uq=`#define TEX_PROJ_EQUIRECTANGULAR 0
#define TEX_PROJ_MIRROR_BALL 1
void node_tex_environment(sampler2D tex, const int encoding, const int projection, vec3 vector, out vec4 outColor) {
vec2 uv;
float bias;
if (projection == TEX_PROJ_EQUIRECTANGULAR) {
vec3 direction = swizzleUpY(vector);
if (length(direction) == 0.0) {
direction = vec3(0.0, 1.0, 0.0);
} else {
direction = normalize(direction);
}
uv = equirectUv(direction);
#if WORLD_NODES == 1
bias = -16.0;
#else
const float seamWidth = 0.15;
const float seamBiasFactor = -10.0;
float seam = max(0.0, 1.0 - abs (direction.z) / seamWidth) *
clamp (1.0 - direction.x / seamWidth, 0.0, 1.0);
bias = seamBiasFactor * seam;
#endif
} else {
vec3 normal = normalize(vector);
normal.y -= 1.0;
normal /= (2.0 * sqrt(max(-0.5 * normal.y, 0.0)));
uv = clamp(0.5 * normal.xz + 0.5, 0.0, 1.0);
bias = 0.0;
}
uv.y = 1.0 - uv.y;
outColor = texture2D(tex, uv, bias);
outColor = nodeTexelToLinear(outColor, encoding);
}`,dq=`void node_tex_environment_none(vec3 vector, out vec4 outColor) {
outColor = vec4(1.0, 0.0, 1.0, 1.0);
}`,fq=`#define TEX_GABOR_2D 0
#define TEX_GABOR_3D 1
#define IMPULSES_COUNT 8
#if __VERSION__ == 300
vec2 compute2DGaborKernel(vec2 position, float frequency, float orientation) {
float distanceSq = dot(position, position);
float hannWindow = 0.5 + 0.5 * cos(PI * distanceSq);
float gaussianEnvelop = exp(-PI * distanceSq);
float windowedGaussianEnvelope = gaussianEnvelop * hannWindow;
vec2 frequencyVector = frequency * vec2(cos(orientation), sin(orientation));
float angle = 2.0 * PI * dot(position, frequencyVector);
vec2 phasor = vec2(cos(angle), sin(angle));
return windowedGaussianEnvelope * phasor;
}
float compute2DGaborStandardDeviation() {
float integralOfGaborSq = 0.25;
float secondMoment = 0.5;
return sqrt(float(IMPULSES_COUNT) * secondMoment * integralOfGaborSq);
}
vec2 compute2DGaborNoiseCell(vec2 cell, vec2 position, float frequency, float isotropy, float baseOrientation) {
vec2 noise = vec2(0.0);
for (int i = 0; i < IMPULSES_COUNT; ++i) {
vec3 seedForOrientation = vec3(cell, i * 3);
vec3 seedForKernelCenter = vec3(cell, i * 3 + 1);
vec3 seedForWeight = vec3(cell, i * 3 + 2);
float random_orientation = (hashVec3ToFloat(seedForOrientation) - 0.5) * PI;
float orientation = baseOrientation + random_orientation * isotropy;
vec2 kernelCenter = hashVec3ToVec2(seedForKernelCenter);
vec2 positionInKernelSpace = position - kernelCenter;
if (dot(positionInKernelSpace, positionInKernelSpace) >= 1.0)
continue;
float weight = hashVec3ToFloat(seedForWeight) < 0.5 ? -1.0 : 1.0;
noise += weight * compute2DGaborKernel(positionInKernelSpace, frequency, orientation);
}
return noise;
}
vec2 compute2DGaborNoise(vec2 coordinates, float frequency, float isotropy, float baseOrientation) {
vec2 cellPosition = floor(coordinates);
vec2 localPosition = coordinates - cellPosition;
vec2 sum = vec2(0.0);
for (int j = -1; j <= 1; j++) {
for (int i = -1; i <= 1; i++) {
vec2 cellOffset = vec2(i, j);
vec2 currCellPosition = cellPosition + cellOffset;
vec2 positionInCellSpace = localPosition - cellOffset;
sum += compute2DGaborNoiseCell(
currCellPosition, positionInCellSpace, frequency, isotropy, baseOrientation);
}
}
return sum;
}
vec2 compute3DGaborKernel(vec3 position, float frequency, vec3 orientation) {
float distanceSq = dot(position, position);
float hannWindow = 0.5 + 0.5 * cos(PI * distanceSq);
float gaussianEnvelop = exp(-PI * distanceSq);
float windowedGaussianEnvelope = gaussianEnvelop * hannWindow;
vec3 frequencyVector = frequency * orientation;
float angle = 2.0 * PI * dot(position, frequencyVector);
vec2 phasor = vec2(cos(angle), sin(angle));
return windowedGaussianEnvelope * phasor;
}
float compute3DGaborStandardDeviation() {
float integralOfGaborSq = 1.0 / (4.0 * sqrt(2.0));
float secondMoment = 0.5;
return sqrt(float(IMPULSES_COUNT) * secondMoment * integralOfGaborSq);
}
vec3 compute3DOrientation(vec3 orientation, float isotropy, vec4 seed) {
if (isotropy == 0.0)
return orientation;
float inclination = acos(orientation.z);
float azimuth = sign(orientation.y) * acos(orientation.x / length(orientation.xy));
vec2 randomAngles = hashVec4ToVec2(seed) * PI;
inclination += randomAngles.x * isotropy;
azimuth += randomAngles.y * isotropy;
return vec3(sin(inclination) * cos(azimuth), sin(inclination) * sin(azimuth), cos(inclination));
}
vec2 compute3DGaborNoiseCell(vec3 cell, vec3 position, float frequency, float isotropy, vec3 baseOrientation) {
vec2 noise = vec2(0.0);
for (int i = 0; i < IMPULSES_COUNT; ++i) {
vec4 seedForOrientation = vec4(cell, i * 3);
vec4 seedForKernelCenter = vec4(cell, i * 3 + 1);
vec4 seedForWeight = vec4(cell, i * 3 + 2);
vec3 orientation = compute3DOrientation(baseOrientation, isotropy, seedForOrientation);
vec3 kernelCenter = hashVec4ToVec3(seedForKernelCenter);
vec3 positionInKernelSpace = position - kernelCenter;
if (dot(positionInKernelSpace, positionInKernelSpace) >= 1.0)
continue;
float weight = hashVec4ToFloat(seedForWeight) < 0.5 ? -1.0 : 1.0;
noise += weight * compute3DGaborKernel(positionInKernelSpace, frequency, orientation);
}
return noise;
}
vec2 compute3DGaborNoise(vec3 coordinates, float frequency, float isotropy, vec3 baseOrientation) {
vec3 cellPosition = floor(coordinates);
vec3 localPosition = coordinates - cellPosition;
vec2 sum = vec2(0.0);
for (int k = -1; k <= 1; k++) {
for (int j = -1; j <= 1; j++) {
for (int i = -1; i <= 1; i++) {
vec3 cellOffset = vec3(i, j, k);
vec3 currCellPosition = cellPosition + cellOffset;
vec3 positionInCellSpace = localPosition - cellOffset;
sum += compute3DGaborNoiseCell(currCellPosition, positionInCellSpace, frequency, isotropy, baseOrientation);
}
}
}
return sum;
}
void node_tex_gabor(
int gaborType,
vec3 vector, float scale, float frequency, float anisotropy, float orientation2D, vec3 orientation3D,
out float outValue, out float outPhase, out float outIntensity) {
vec3 scaledVector = vector * scale;
float isotropy = 1.0 - clamp(anisotropy, 0.0, 1.0);
frequency = max(0.001, frequency);
vec2 phasor = vec2(0.0);
float standard_deviation = 1.0;
if (gaborType == TEX_GABOR_2D) {
phasor = compute2DGaborNoise(scaledVector.xy, frequency, isotropy, orientation2D);
standard_deviation = compute2DGaborStandardDeviation();
} else {
vec3 orientation = normalize(orientation3D);
phasor = compute3DGaborNoise(scaledVector, frequency, isotropy, orientation);
standard_deviation = compute3DGaborStandardDeviation();
}
float normalizationFactor = 6.0 * standard_deviation;
outValue = (phasor.y / normalizationFactor) * 0.5 + 0.5;
outPhase = (atan(phasor.y, phasor.x) + PI) / (2.0 * PI);
outIntensity = length(phasor) / normalizationFactor;
}
#else
void node_tex_gabor(
int gaborType,
vec3 vector, float scale, float frequency, float anisotropy, float orientation2D, vec3 orientation3D,
out float outValue, out float outPhase, out float outIntensity) {
outValue = 0.0;
outPhase = 0.0;
outIntensity = 0.0;
}
#endif`,hq=`#define TEX_GRAD_LINEAR 0
#define TEX_GRAD_QUADRATIC 1
#define TEX_GRAD_EASING 2
#define TEX_GRAD_DIAGONAL 3
#define TEX_GRAD_SPHERICAL 4
#define TEX_GRAD_QUADRATIC_SPHERE 5
#define TEX_GRAD_RADIAL 6
void node_tex_gradient(const int type, vec3 vector, out vec4 outColor, out float outFac)
{
float x, y, z, r;
x = vector.x;
y = vector.y;
z = vector.z;
if (type == TEX_GRAD_LINEAR) {
outFac = x;
} else if (type == TEX_GRAD_QUADRATIC) {
r = max(x, 0.0);
outFac = pow2(r);
} else if (type == TEX_GRAD_EASING) {
r = min(max(x, 0.0), 1.0);
outFac = (3.0 * pow2(r) - 2.0 * pow3(r));
} else if (type == TEX_GRAD_DIAGONAL) {
outFac = (x + y) * 0.5;
} else if (type == TEX_GRAD_RADIAL) {
outFac = atan(y, x) / PI2 + 0.5;
} else {
r = max(0.99999 - sqrt(x * x + y * y + z * z), 0.0);
if (type == TEX_GRAD_QUADRATIC_SPHERE) {
outFac = pow2(r);
} else if (type == TEX_GRAD_SPHERICAL) {
outFac = r;
}
}
outFac = clamp(outFac, 0.0, 1.0);
outColor = vec4(outFac, outFac, outFac, 1.0);
}`,pq=`void node_tex_ies(vec3 vector, float strength, out float fac) {
fac = 0.0;
}`,mq=`#define TEX_PROJ_FLAT 0
#define TEX_PROJ_BOX 1
#define TEX_PROJ_SPHERE 2
#define TEX_PROJ_TUBE 3
#define TEX_ALPHA_CLEAR 0
#define TEX_ALPHA_PREMUL 1
#define TEX_ALPHA_UNPREMUL 2
#define TEX_ALPHA_ONE 3
vec4 applyAlphaMode(vec4 color, const int alphaMode) {
if (alphaMode == TEX_ALPHA_CLEAR) {
} else if (alphaMode == TEX_ALPHA_PREMUL) {
color.rgb = color.rgb * color.a;
} else if (alphaMode == TEX_ALPHA_UNPREMUL) {
float alpha = color.a;
color.rgb = clamp(color.rgb, 0.0, alpha);
if (alpha == 0.0)
color.rgb = vec3(0.0);
else
color.rgb /= alpha;
}
return color;
}
void node_tex_image(sampler2D ima, const int encoding, const int alphaMode, vec3 viewNorm,
const int projection, const float projectionBlend, const bool clampToEdgeNoExtend,
vec3 vector,
out vec4 outColor, out float outAlpha) {
if (projection == TEX_PROJ_FLAT) {
vec2 uv = vector.xy;
uv.y = 1.0 - uv.y;
if (clampToEdgeNoExtend && (uv.x < 0.0 || uv.x > 1.0 || uv.y < 0.0 || uv.y > 1.0)) {
outColor = vec4(0.0);
outAlpha = 0.0;
} else {
outColor = texture2D(ima, uv);
outAlpha = outColor.a;
}
outColor = nodeTexelToLinear(outColor, encoding);
} else if (projection == TEX_PROJ_BOX) {
vec3 norm = normalize(viewNorm * normalMatrix);
vector = swizzleUpY(vector);
vec2 uvX = vec2(-sign(norm.x) * vector.z, -vector.y);
vec2 uvY = vec2(sign(norm.y) * vector.z, -vector.x);
vec2 uvZ = vec2(sign(norm.z) * vector.x, -vector.y);
vec4 colX = nodeTexelToLinear(texture2D(ima, uvX), encoding);
vec4 colY = nodeTexelToLinear(texture2D(ima, uvY), encoding);
vec4 colZ = nodeTexelToLinear(texture2D(ima, uvZ), encoding);
vec3 barycentric = abs(norm);
barycentric /= barycentric.x + barycentric.y + barycentric.z;
vec3 edgeShape = min(min(barycentric.yzx, barycentric.zxy),
(projectionBlend - 1.0) / (projectionBlend - 3.0));
vec3 edgeValue = (1.0 - projectionBlend) * (1.0 - edgeShape) / 2.0;
vec3 weight = max((barycentric - edgeValue) / (1.0 - edgeValue), EPSILON);
weight /= (weight.x + weight.y + weight.z);
outColor = weight.x * colX + weight.y * colY + weight.z * colZ;
outAlpha = outColor.a;
} else if (projection == TEX_PROJ_SPHERE) {
vector = normalize(vector * 2.0 - 1.0);
vector = swizzleUpY(vector);
vec2 uv = vec2(atan(vector.x, vector.z) / PI2, acos(vector.y) / PI);
uv.x = mod(uv.x, 1.0);
outColor = texture2D(ima, uv);
outAlpha = outColor.a;
outColor = nodeTexelToLinear(outColor, encoding);
} else if (projection == TEX_PROJ_TUBE) {
vector = vector * 2.0 - 1.0;
vector = swizzleUpY(vector);
vec2 uv = vec2(atan(vector.x, vector.z) / PI2, (1.0 - vector.y) / 2.0);
uv.x = mod(uv.x, 1.0);
outColor = texture2D(ima, uv);
outAlpha = outColor.a;
outColor = nodeTexelToLinear(outColor, encoding);
}
outColor = applyAlphaMode(outColor, alphaMode);
if (alphaMode == TEX_ALPHA_ONE)
outAlpha = 1.0;
}`,gq=`void node_tex_image_none(vec3 vector, out vec4 color, out float alpha)
{
color = vec4(1.0, 0.0, 1.0, 1.0);
alpha = 1.0;
}`,vq=`void node_tex_magic(vec3 vector, float scale, float distortion,
out vec4 outColor, out float outFac)
{
outColor = vec4(0.0);
outFac = 0.0;
}`,_q=`
void node_tex_musgrave(vec3 vector, float w, float scale, float detail,
float dimension, float lacunarity, float offset, float gain,
out float outFac) {
outFac = 0.0;
}`,Aq=`#define TEX_NOISE_MULTIFRACTAL 0
#define TEX_NOISE_RIDGED_MULTIFRACTAL 1
#define TEX_NOISE_HYBRID_MULTIFRACTAL 2
#define TEX_NOISE_FBM 3
#define TEX_NOISE_HETERO_TERRAIN 4
void node_tex_noise(
int noiseType, float falloffFactor, float dispersionFactor,
vec3 vector, float w, float scale, float detail, float roughness,
float lacunarity, float offset, float gain, float distortion, out float outFac, out vec4 outColor) {
vec3 p = vector * scale;
vec3 dx = dFdx(p);
vec3 dy = dFdy(p);
float octaveLenPerPixel = (length(dx) + length(dy)) / 4.0;
if (distortion != 0.0) {
vec3 r, offset = vec3(13.5, 13.5, 13.5);
r.x = noiseSmooth(p + offset, octaveLenPerPixel, falloffFactor,
dispersionFactor) * distortion;
r.y = noiseSmooth(p, octaveLenPerPixel, falloffFactor,
dispersionFactor) * distortion;
r.z = noiseSmooth(p - offset, octaveLenPerPixel, falloffFactor,
dispersionFactor) * distortion;
p += r;
}
outFac = noiseTurbulence(p, detail, octaveLenPerPixel, falloffFactor,
dispersionFactor);
vec3 color = vec3(outFac,
noiseTurbulence(vec3(p.y, p.x, p.z), detail, octaveLenPerPixel,
falloffFactor, dispersionFactor),
noiseTurbulence(vec3(p.y, p.z, p.x), detail, octaveLenPerPixel,
falloffFactor, dispersionFactor)
);
outColor = vec4(color, 1.0);
}
void node_tex_noise(
float falloffFactor, float dispersionFactor,
vec3 vector, float w, float scale, float detail, float roughness,
float lacunarity, float distortion, out float outFac, out vec4 outColor) {
node_tex_noise(TEX_NOISE_FBM, falloffFactor, dispersionFactor, vector, w, scale, detail, roughness,
lacunarity, 0.0, 1.0, distortion, outFac, outColor);
}
void node_tex_noise(
float falloffFactor, float dispersionFactor,
vec3 vector, float w, float scale, float detail, float roughness,
float distortion, out float outFac, out vec4 outColor) {
node_tex_noise(falloffFactor, dispersionFactor, vector, w, scale, detail, roughness,
2.0, distortion, outFac, outColor);
}`,xq=`void node_tex_pointdensity(
vec3 vector,
out vec4 outColor, out float outDensity)
{
outColor = vec4(0.0);
outDensity = 0.0;
}`,yq=`
#define TEX_SKY_PREETHAM 0
#define TEX_SKY_HOSEK_WILKIE 1
#define TEX_SKY_NISHITA 2
#define Km 683.0
void node_tex_sky(const int skyType, vec3 param0, vec3 param1, vec3 param2,
vec3 param3, vec3 param4, vec3 param5, vec3 param6, vec3 param7,
vec3 param8, vec3 radiance, vec3 sunDirection, vec3 vectorIn,
out vec4 outColor) {
if (length(vectorIn) == 0.0) {
vectorIn = vec3(0.0, 1.0, 0.0);
} else {
vectorIn = normalize(vectorIn);
}
vectorIn = swizzleUpY(vectorIn);
sunDirection = swizzleUpY(sunDirection);
float cosGamma = clamp(dot(vectorIn, sunDirection), -1.0, 1.0);
float cosTheta = clamp(vectorIn.y, 0.0, 1.0);
if (skyType == TEX_SKY_PREETHAM) {
vec3 radInternal = (1.0 + param0 * exp(param1 / cosTheta)) * (
1.0 + param2 * exp(param3 * acos(cosGamma))
+ param4 * pow(cosGamma, 2.0)
);
vec3 XYZ = xyY_to_XYZ(radInternal.y * radiance.y,
radInternal.z * radiance.z, radInternal.x * radiance.x);
outColor = vec4(max(xyz_to_sRGB(XYZ), 0.0), 1.0);
} else if (skyType == TEX_SKY_HOSEK_WILKIE) {
float cosGammaSq = pow(cosGamma, 2.0);
vec3 chi = (1.0 + cosGammaSq) / pow(1.0 + pow(param8, vec3(2.0))
- 2.0 * param8 * cosGamma, vec3(1.5));
vec3 radInternal = (1.0 + param0 * exp(param1 / (cosTheta + 0.01))) * (
param2 + param3 * exp(param4 * acos(cosGamma))
+ param5 * cosGammaSq + param6 * chi + param7 * sqrt(cosTheta)
);
outColor = vec4(max(xyz_to_sRGB(radInternal * radiance), 0.0) * PI2/Km, 1.0);
} else {
outColor = vec4(0.0, 0.0, 0.0, 1.0);
}
}`,bq=`#define DISTANCE_EUCLIDEAN 0
#define DISTANCE_MANHATTAN 1
#define DISTANCE_CHEBYCHEV 2
#define DISTANCE_MINKOWSKI 3
#define FEATURE_F1 0
#define FEATURE_F2 1
#define FEATURE_SMOOTH_F1 2
#define FEATURE_DISTANCE_TO_EDGE 3
#define FEATURE_N_SPHERE_RADIUS 4
struct VoronoiGridData {
vec3 point;
vec3 randVec;
vec3 toClosest;
float dist;
};
highp vec3 rand3(const in vec3 v) {
const highp float c = 43758.5453;
const highp mat3 coeffs = mat3(
165.15, 253.34, 323.22,
241.49, 329.07, 147.79,
376.31, 143.45, 281.63
);
highp vec3 sn = mod(coeffs * v, PI);
return fract(sin(sn) * c);
}
float worleyLength(vec3 vec, int distance, float exponent) {
if (distance == DISTANCE_EUCLIDEAN) {
return length(vec);
} else if (distance == DISTANCE_MANHATTAN) {
return abs(vec.x) + abs(vec.y) + abs(vec.z);
} else if (distance == DISTANCE_CHEBYCHEV) {
return max(max(abs(vec.x), abs(vec.y)), abs(vec.z));
} else if (distance == DISTANCE_MINKOWSKI) {
return pow(pow(abs(vec.x), exponent)
+ pow(abs(vec.y), exponent)
+ pow(abs(vec.z), exponent), 1.0 / exponent);
}
return 0.0;
}
void worleyNoise(vec3 pos, int distance, float exponent, int feature,
float smoothness, float randomness, out float outDist, out vec4 outColor,
out vec3 outPosition, out float outW, out float outRadius) {
const highp float RAND_FIX_ZERO = 0.125;
vec3 posI = floor(pos);
vec3 posF = fract(pos);
VoronoiGridData vgd[27];
#pragma unroll_loop
for (int i = 0; i <= 2; i++) {
#pragma unroll_loop
for (int j = 0; j <= 2; j++) {
#pragma unroll_loop
for (int k = 0; k <= 2; k++) {
vec3 point = vec3((i), (j), (k)) - 1.0;
vec3 randVec = rand3(posI + point + RAND_FIX_ZERO);
vec3 toClosest = point + randomness * randVec - posF;
const int counter = (i) + (j) * 3 + (k) * 9;
vgd[counter].point = point;
vgd[counter].randVec = randVec;
vgd[counter].toClosest = toClosest;
vgd[counter].dist = worleyLength(toClosest, distance, exponent);
}
}
}
float f1 = 1e10;
float f2 = 1e10;
vec3 edgeToClosest = vec3(0.0);
float distToEdge = 1e10;
vec3 randColF1 = vec3(0.0);
vec3 randColF2 = vec3(0.0);
vec3 toClosestF1 = vec3(0.0);
vec3 toClosestF2 = vec3(0.0);
vec3 radPoint = vec3(0.0);
vec3 radToClosest = vec3(0.0);
#pragma unroll_loop
for (int i = 0; i < 27; i++) {
if (feature == FEATURE_F1) {
if (vgd[i].dist < f1) {
f1 = vgd[i].dist;
randColF1 = vgd[i].randVec;
toClosestF1 = vgd[i].toClosest;
}
} else if (feature == FEATURE_F2) {
if (vgd[i].dist < f1) {
f2 = f1;
f1 = vgd[i].dist;
randColF2 = randColF1;
randColF1 = vgd[i].randVec;
toClosestF2 = toClosestF1;
toClosestF1 = vgd[i].toClosest;
} else if (vgd[i].dist < f2) {
f2 = vgd[i].dist;
randColF2 = vgd[i].randVec;
toClosestF2 = vgd[i].toClosest;
}
} else if (feature == FEATURE_SMOOTH_F1) {
f1 = smoothMin(f1, vgd[i].dist, smoothness);
} else if (feature == FEATURE_DISTANCE_TO_EDGE) {
float dist = worleyLength(vgd[i].toClosest, DISTANCE_EUCLIDEAN, exponent);
if (dist < f1) {
f1 = dist;
edgeToClosest = vgd[i].toClosest;
}
} else if (feature == FEATURE_N_SPHERE_RADIUS) {
float dist = worleyLength(vgd[i].toClosest, DISTANCE_EUCLIDEAN, exponent);
if (dist < f1) {
f1 = dist;
radPoint = vgd[i].point;
radToClosest = vgd[i].toClosest;
}
}
}
if (feature == FEATURE_F1) {
outDist = f1;
outColor = vec4(randColF1, 1.0);
outPosition = pos + toClosestF1;
} else if (feature == FEATURE_F2) {
outDist = f2;
outColor = vec4(randColF2, 1.0);
outPosition = pos + toClosestF2;
} else if (feature == FEATURE_SMOOTH_F1) {
outDist = f1;
vec3 avgCol = vec3(0.0);
vec3 avgOff = vec3(0.0);
float sumWeightsCol = 0.0;
float sumWeightsOff = 0.0;
#pragma unroll_loop
for (int i = 0; i < 27; i++) {
float smoothFac = getSmoothFactor(f1, vgd[i].dist, smoothness);
float weightOff = smoothFac * smoothFac * smoothFac;
float weightCol = weightOff * smoothFac;
avgCol += vgd[i].randVec * weightCol;
avgOff += vgd[i].toClosest * weightOff;
sumWeightsCol += weightCol;
sumWeightsOff += weightOff;
}
outColor = vec4(avgCol / sumWeightsCol, 1.0);
outPosition = pos + avgOff / sumWeightsOff;
} else if (feature == FEATURE_DISTANCE_TO_EDGE) {
#pragma unroll_loop
for (int i = 0; i < 27; i++) {
if (vgd[i].toClosest != edgeToClosest) {
float dist = dot(0.5 * (edgeToClosest + vgd[i].toClosest),
normalize(vgd[i].toClosest - edgeToClosest));
distToEdge = min(distToEdge, dist);
}
}
outDist = distToEdge;
} else if (feature == FEATURE_N_SPHERE_RADIUS) {
float diam = 1e10;
#pragma unroll_loop
for (int i = 0; i <= 2; i++) {
#pragma unroll_loop
for (int j = 0; j <= 2; j++) {
#pragma unroll_loop
for (int k = 0; k <= 2; k++) {
vec3 localPoint = vec3((i), (j), (k)) - 1.0;
if (length(localPoint) > 0.0) {
vec3 point = localPoint + radPoint;
vec3 randVec = rand3(posI + point + RAND_FIX_ZERO);
vec3 toClosest = point + randomness * randVec - posF;
diam = min(diam, length(toClosest - radToClosest));
}
}
}
}
outRadius = diam / 2.0;
}
}
#define VORONOI_SMOOTH_COEFF 0.74
void node_tex_voronoi(
int distance, int feature,
vec3 vector, float w, float scale, float detail, float roughness, float lacunarity,
float smoothness, float exponent, float randomness,
out float outDistance, out vec4 outColor, out vec3 outPosition,
out float outW, out float outRadius) {
vector = scale * (vector - 0.0001);
smoothness = clamp(smoothness, 1e-3, 1.0);
smoothness *= VORONOI_SMOOTH_COEFF;
worleyNoise(vector, distance, exponent, feature, smoothness, randomness,
outDistance, outColor, outPosition, outW, outRadius);
outPosition /= scale;
}
void node_tex_voronoi(
int distance, int feature,
vec3 vector, float w, float scale,
float smoothness, float exponent, float randomness,
out float outDistance, out vec4 outColor, out vec3 outPosition,
out float outW, out float outRadius) {
node_tex_voronoi(
distance, feature, vector, w, scale, 0.0, 0.5, 2.0, smoothness, exponent, randomness,
outDistance, outColor, outPosition, outW, outRadius);
}
#define FEATURE_F3 5
#define FEATURE_F4 6
#define FEATURE_F2F1 7
#define COLORING_INTENSITY 0
#define COLORING_CELLS 1
struct VoronoiClosest {
vec4 closestDists;
vec4 closestInds;
};
void updateVoronoiClosest(inout VoronoiClosest vf, vec3 newDistances,
vec3 newIndices) {
#pragma unroll_loop
for (int i = 0; i < 3; i++) {
float currDist = newDistances[i];
float currIdx = newIndices[i];
#pragma unroll_loop
for (int j = 0; j < 4; j++) {
if (currDist < vf.closestDists[j]) {
float tmp = vf.closestDists[j];
vf.closestDists[j] = currDist;
currDist = tmp;
tmp = vf.closestInds[j];
vf.closestInds[j] = currIdx;
currIdx = tmp;
}
}
}
}
vec3 worleyPermute(vec3 x) {
return mod((34.0 * x + 1.0) * x, 289.0);
}
vec3 worleyDist(vec3 x, vec3 y, vec3 z, int distance, float exponent) {
if (distance == DISTANCE_EUCLIDEAN) {
return x * x + y * y + z * z;
} else if (distance == DISTANCE_MANHATTAN) {
return abs(x) + abs(y) + abs(z);
} else if (distance == DISTANCE_CHEBYCHEV) {
return max(max(abs(x), abs(y)), abs(z));
} else if (distance == DISTANCE_MINKOWSKI) {
vec3 expVec = vec3(exponent);
return pow(pow(abs(x), expVec)
+ pow(abs(y), expVec)
+ pow(abs(z), expVec), 1.0 / expVec);
}
return vec3(0.0);
}
VoronoiClosest worleyClosest(vec3 P, float jitter, int distance, float exponent) {
float K = 0.142857142857;
float Ko = 0.428571428571;
float K2 = 0.020408163265306;
float Kz = 0.166666666667;
float Kzo = 0.416666666667;
vec3 Pi = mod(floor(P), 289.0);
vec3 Pf = fract(P) - 0.5;
vec3 Pfx = Pf.x + vec3(1.0, 0.0, -1.0);
vec3 Pfy = Pf.y + vec3(1.0, 0.0, -1.0);
vec3 Pfz = Pf.z + vec3(1.0, 0.0, -1.0);
vec3 p = worleyPermute(Pi.x + vec3(-1.0, 0.0, 1.0));
vec3 p1 = worleyPermute(p + Pi.y - 1.0);
vec3 p2 = worleyPermute(p + Pi.y);
vec3 p3 = worleyPermute(p + Pi.y + 1.0);
vec3 p11 = worleyPermute(p1 + Pi.z - 1.0);
vec3 p12 = worleyPermute(p1 + Pi.z);
vec3 p13 = worleyPermute(p1 + Pi.z + 1.0);
vec3 p21 = worleyPermute(p2 + Pi.z - 1.0);
vec3 p22 = worleyPermute(p2 + Pi.z);
vec3 p23 = worleyPermute(p2 + Pi.z + 1.0);
vec3 p31 = worleyPermute(p3 + Pi.z - 1.0);
vec3 p32 = worleyPermute(p3 + Pi.z);
vec3 p33 = worleyPermute(p3 + Pi.z + 1.0);
vec3 ox11 = fract(p11*K) - Ko;
vec3 oy11 = mod(floor(p11*K), 7.0)*K - Ko;
vec3 oz11 = floor(p11*K2)*Kz - Kzo;
vec3 ox12 = fract(p12*K) - Ko;
vec3 oy12 = mod(floor(p12*K), 7.0)*K - Ko;
vec3 oz12 = floor(p12*K2)*Kz - Kzo;
vec3 ox13 = fract(p13*K) - Ko;
vec3 oy13 = mod(floor(p13*K), 7.0)*K - Ko;
vec3 oz13 = floor(p13*K2)*Kz - Kzo;
vec3 ox21 = fract(p21*K) - Ko;
vec3 oy21 = mod(floor(p21*K), 7.0)*K - Ko;
vec3 oz21 = floor(p21*K2)*Kz - Kzo;
vec3 ox22 = fract(p22*K) - Ko;
vec3 oy22 = mod(floor(p22*K), 7.0)*K - Ko;
vec3 oz22 = floor(p22*K2)*Kz - Kzo;
vec3 ox23 = fract(p23*K) - Ko;
vec3 oy23 = mod(floor(p23*K), 7.0)*K - Ko;
vec3 oz23 = floor(p23*K2)*Kz - Kzo;
vec3 ox31 = fract(p31*K) - Ko;
vec3 oy31 = mod(floor(p31*K), 7.0)*K - Ko;
vec3 oz31 = floor(p31*K2)*Kz - Kzo;
vec3 ox32 = fract(p32*K) - Ko;
vec3 oy32 = mod(floor(p32*K), 7.0)*K - Ko;
vec3 oz32 = floor(p32*K2)*Kz - Kzo;
vec3 ox33 = fract(p33*K) - Ko;
vec3 oy33 = mod(floor(p33*K), 7.0)*K - Ko;
vec3 oz33 = floor(p33*K2)*Kz - Kzo;
vec3 dx11 = Pfx + jitter*ox11;
vec3 dy11 = Pfy.x + jitter*oy11;
vec3 dz11 = Pfz.x + jitter*oz11;
vec3 dx12 = Pfx + jitter*ox12;
vec3 dy12 = Pfy.x + jitter*oy12;
vec3 dz12 = Pfz.y + jitter*oz12;
vec3 dx13 = Pfx + jitter*ox13;
vec3 dy13 = Pfy.x + jitter*oy13;
vec3 dz13 = Pfz.z + jitter*oz13;
vec3 dx21 = Pfx + jitter*ox21;
vec3 dy21 = Pfy.y + jitter*oy21;
vec3 dz21 = Pfz.x + jitter*oz21;
vec3 dx22 = Pfx + jitter*ox22;
vec3 dy22 = Pfy.y + jitter*oy22;
vec3 dz22 = Pfz.y + jitter*oz22;
vec3 dx23 = Pfx + jitter*ox23;
vec3 dy23 = Pfy.y + jitter*oy23;
vec3 dz23 = Pfz.z + jitter*oz23;
vec3 dx31 = Pfx + jitter*ox31;
vec3 dy31 = Pfy.z + jitter*oy31;
vec3 dz31 = Pfz.x + jitter*oz31;
vec3 dx32 = Pfx + jitter*ox32;
vec3 dy32 = Pfy.z + jitter*oy32;
vec3 dz32 = Pfz.y + jitter*oz32;
vec3 dx33 = Pfx + jitter*ox33;
vec3 dy33 = Pfy.z + jitter*oy33;
vec3 dz33 = Pfz.z + jitter*oz33;
vec3 d11 = worleyDist(dx11, dy11, dz11, distance, exponent);
vec3 d12 = worleyDist(dx12, dy12, dz12, distance, exponent);
vec3 d13 = worleyDist(dx13, dy13, dz13, distance, exponent);
vec3 d21 = worleyDist(dx21, dy21, dz21, distance, exponent);
vec3 d22 = worleyDist(dx22, dy22, dz22, distance, exponent);
vec3 d23 = worleyDist(dx23, dy23, dz23, distance, exponent);
vec3 d31 = worleyDist(dx31, dy31, dz31, distance, exponent);
vec3 d32 = worleyDist(dx32, dy32, dz32, distance, exponent);
vec3 d33 = worleyDist(dx33, dy33, dz33, distance, exponent);
VoronoiClosest vf = VoronoiClosest(vec4(1e10), vec4(0.0));
updateVoronoiClosest(vf, d11, p11);
updateVoronoiClosest(vf, d12, p12);
updateVoronoiClosest(vf, d13, p13);
updateVoronoiClosest(vf, d21, p21);
updateVoronoiClosest(vf, d22, p22);
updateVoronoiClosest(vf, d23, p23);
updateVoronoiClosest(vf, d31, p31);
updateVoronoiClosest(vf, d32, p32);
updateVoronoiClosest(vf, d33, p33);
return vf;
}
void node_tex_voronoi(int coloring, int distance, int feature, vec3 vector,
float scale, float exponent, out vec4 outColor, out float outFac) {
vector = scale * (vector - 0.0001);
VoronoiClosest vf = worleyClosest(vector, 1.0, distance, exponent);
vec4 vorColorData;
if (coloring == COLORING_INTENSITY) {
vorColorData = vf.closestDists;
} else if (coloring == COLORING_CELLS) {
vorColorData = vf.closestInds;
}
float vorColorFac;
if (feature == FEATURE_F1) {
vorColorFac = vorColorData.x;
} else if (feature == FEATURE_F2) {
vorColorFac = vorColorData.y;
} else if (feature == FEATURE_F3) {
vorColorFac = vorColorData.z;
} else if (feature == FEATURE_F4) {
vorColorFac = vorColorData.w;
} else if (feature == FEATURE_F2F1) {
vorColorFac = vorColorData.y - vorColorData.x;
}
if (coloring == COLORING_INTENSITY) {
outFac = vorColorFac;
outColor = vec4(vec3(outFac), 1.0);
} else if (coloring == COLORING_CELLS) {
vorColorFac += 1e-3;
float r = rand(vec2(vorColorFac / 289.0));
float g = rand(vec2(vorColorFac / 23535.0));
float b = rand(vec2(vorColorFac / 4353.0));
outFac = (r + g + b) / 3.0;
outColor = vec4(r, g, b, 1.0);
}
}`,Sq=`#define TEX_WAVE_TYPE_BANDS 0
#define TEX_WAVE_TYPE_RINGS 1
#define TEX_WAVE_PROFILE_SIN 0
#define TEX_WAVE_PROFILE_SAW 1
#define TEX_WAVE_PROFILE_TRI 2
#define TEX_WAVE_BANDS_DIR_X 0
#define TEX_WAVE_BANDS_DIR_Y 1
#define TEX_WAVE_BANDS_DIR_Z 2
#define TEX_WAVE_BANDS_DIR_DIAGONAL 3
#define TEX_WAVE_RINGS_DIR_X 0
#define TEX_WAVE_RINGS_DIR_Y 1
#define TEX_WAVE_RINGS_DIR_Z 2
#define TEX_WAVE_RINGS_DIR_SPHERICAL 3
void node_tex_wave(
int waveType, int waveProfile, int bandsDirection, int ringsDirection,
vec3 vector, float scale, float distortion, float detail, float detailScale,
float detailRoughness, float phaseOffset,
out vec4 outColor, out float outFac) {
vec3 coScaled = vector * scale;
float waveFac;
vec3 waveVec = coScaled;
if (waveType == TEX_WAVE_TYPE_BANDS) {
const float BANDS_AXIS_SCALE = 2.0 / 3.0;
if (bandsDirection == TEX_WAVE_BANDS_DIR_X) {
waveVec = waveVec.xxx * BANDS_AXIS_SCALE;
} else if (bandsDirection == TEX_WAVE_BANDS_DIR_Y) {
waveVec = waveVec.yyy * BANDS_AXIS_SCALE;
} else if (bandsDirection == TEX_WAVE_BANDS_DIR_Z) {
waveVec = waveVec.zzz * BANDS_AXIS_SCALE;
} else if (bandsDirection == TEX_WAVE_BANDS_DIR_DIAGONAL) {
}
waveFac = (waveVec.x + waveVec.y + waveVec.z) * 10.0;
} else {
if (ringsDirection == TEX_WAVE_RINGS_DIR_X) {
waveVec.x = 0.0;
} else if (ringsDirection == TEX_WAVE_RINGS_DIR_Y) {
waveVec.y = 0.0;
} else if (ringsDirection == TEX_WAVE_RINGS_DIR_Z) {
waveVec.z = 0.0;
} else if (ringsDirection == TEX_WAVE_RINGS_DIR_SPHERICAL) {
}
waveFac = length(waveVec) * 20.0;
}
if (distortion != 0.0) {
waveFac += distortion * noiseTurbulence(coScaled * detailScale, detail,
0.0, 0.0, 1.0);
}
if (waveProfile == TEX_WAVE_PROFILE_SIN) {
waveFac = 0.5 + 0.5 * sin(waveFac - PI_HALF + phaseOffset);
} else if (waveProfile == TEX_WAVE_PROFILE_SAW) {
waveFac = fract((waveFac + phaseOffset + 1e-4) / PI2);
} else if (waveProfile == TEX_WAVE_PROFILE_TRI) {
waveFac = abs(2.0 * fract((waveFac + PI + phaseOffset) / PI2) - 1.0);
}
outColor = vec4(waveFac, waveFac, waveFac, 1.0);
outFac = waveFac;
}`,Cq=`#if __VERSION__ == 300
void node_tex_white_noise_1d(vec3 vector, float w, out float outValue,
out vec4 outColor)
{
outValue = hashFloatToFloat(w);
outColor = vec4(hashFloatToVec3(w), 1.0);
}
void node_tex_white_noise_2d(vec3 vector, float w, out float outValue,
out vec4 outColor)
{
outValue = hashVec2ToFloat(vector.xy);
outColor = vec4(hashVec2ToVec3(vector.xy), 1.0);
}
void node_tex_white_noise_3d(vec3 vector, float w, out float outValue,
out vec4 outColor)
{
outValue = hashVec3ToFloat(vector);
outColor = vec4(hashVec3ToVec3(vector), 1.0);
}
void node_tex_white_noise_4d(vec3 vector, float w, out float outValue,
out vec4 outColor)
{
outValue = hashVec4ToFloat(vec4(vector, w));
outColor = vec4(hashVec4ToVec3(vec4(vector, w)), 1.0);
}
#else
void node_tex_white_noise_1d(vec3 vector, float w, out float outValue,
out vec4 outColor)
{
outValue = 0.0;
outColor = vec4(0.0);
}
void node_tex_white_noise_2d(vec3 vector, float w, out float outValue,
out vec4 outColor)
{
outValue = 0.0;
outColor = vec4(0.0);
}
void node_tex_white_noise_3d(vec3 vector, float w, out float outValue,
out vec4 outColor)
{
outValue = 0.0;
outColor = vec4(0.0);
}
void node_tex_white_noise_4d(vec3 vector, float w, out float outValue,
out vec4 outColor)
{
outValue = 0.0;
outColor = vec4(0.0);
}
#endif`,Eq=`void node_uvmap(vec2 uv, out vec3 outUV) {
#if WORLD_NODES == 1
outUV = vec3(0.0);
#else
uv.y = 1.0 - uv.y;
outUV = vec3(uv, 0.0);
#endif
}`,Mq=`void node_valtorgb(sampler2D colormap, float fac, out vec4 colOut, out float alphaOut)
{
colOut = texture2D(colormap, vec2(fac, 0.0));
alphaOut = colOut.a;
}`,wq=`uniform float nodeValue[NODE_VALUE_NUM];
void node_value(float value, out float outValue)
{
outValue = value;
}`,Tq=`void node_vect_math_add(vec3 v1, vec3 v2, vec3 v3, float val, out vec3 outVec,
out float outVal) {
outVec = v1 + v2;
}
void node_vect_math_subtract(vec3 v1, vec3 v2, vec3 v3, float val, out vec3 outVec,
out float outVal) {
outVec = v1 - v2;
}
void node_vect_math_multiply(vec3 v1, vec3 v2, vec3 v3, float val,
out vec3 outVec, out float outVal) {
outVec = v1 * v2;
}
void node_vect_math_divide(vec3 v1, vec3 v2, vec3 v3, float val, out vec3 outVec,
out float outVal) {
outVec.x = v2.x == 0.0 ? 0.0 : v1.x / v2.x;
outVec.y = v2.y == 0.0 ? 0.0 : v1.y / v2.y;
outVec.z = v2.z == 0.0 ? 0.0 : v1.z / v2.z;
}
void node_vect_math_cross_product(vec3 v1, vec3 v2, vec3 v3, float val,
out vec3 outVec, out float outVal) {
outVec = cross(v1, v2);
}
void node_vect_math_project(vec3 v1, vec3 v2, vec3 v3, float val, out vec3 outVec,
out float outVal) {
float d = dot(v2, v2);
outVec = (d != 0.0) ? (dot(v1, v2) / d) * v2 : vec3(0.0);
}
void node_vect_math_reflect(vec3 v1, vec3 v2, vec3 v3, float val, out vec3 outVec,
out float outVal) {
if (v2 != vec3(0.0)) {
v2 = normalize(v2);
}
outVec = reflect(v1, v2);
}
void node_vect_math_dot_product(vec3 v1, vec3 v2, vec3 v3, float val,
out vec3 outVec, out float outVal) {
outVal = dot(v1, v2);
}
void node_vect_math_distance(vec3 v1, vec3 v2, vec3 v3, float val, out vec3 outVec,
out float outVal) {
outVal = distance(v1, v2);
}
void node_vect_math_length(vec3 v1, vec3 v2, vec3 v3, float val, out vec3 outVec,
out float outVal) {
outVal = length(v1);
}
void node_vect_math_scale(vec3 v1, vec3 v2, vec3 v3, float val, out vec3 outVec,
out float outVal) {
outVec = v1 * val;
}
void node_vect_math_normalize(vec3 v1, vec3 v2, vec3 v3, float val,
out vec3 outVec, out float outVal) {
if (v1 != vec3(0.0)) {
v1 = normalize(v1);
}
outVec = v1;
}
void node_vect_math_snap(vec3 v1, vec3 v2, vec3 v3, float val, out vec3 outVec,
out float outVal) {
outVec.x = v2.x == 0.0 ? 0.0 : floor(v1.x / v2.x) * v2.x;
outVec.y = v2.y == 0.0 ? 0.0 : floor(v1.y / v2.y) * v2.y;
outVec.z = v2.z == 0.0 ? 0.0 : floor(v1.z / v2.z) * v2.z;
}
void node_vect_math_floor(vec3 v1, vec3 v2, vec3 v3, float val, out vec3 outVec,
out float outVal) {
outVec = floor(v1);
}
void node_vect_math_ceil(vec3 v1, vec3 v2, vec3 v3, float val, out vec3 outVec,
out float outVal) {
outVec = ceil(v1);
}
void node_vect_math_modulo(vec3 v1, vec3 v2, vec3 v3, float val, out vec3 outVec,
out float outVal) {
vec3 signProduct = sign(v1) * sign(v2);
v1 += 1e-5 * signProduct;
outVec.x = signProduct.x > 0.0 ? mod(v1.x, abs(v2.x)) : 0.0;
outVec.y = signProduct.y > 0.0 ? mod(v1.y, abs(v2.y)) : 0.0;
outVec.z = signProduct.z > 0.0 ? mod(v1.z, abs(v2.z)) : 0.0;
}
void node_vect_math_fraction(vec3 v1, vec3 v2, vec3 v3, float val,
out vec3 outVec, out float outVal) {
outVec = fract(v1);
}
void node_vect_math_absolute(vec3 v1, vec3 v2, vec3 v3, float val,
out vec3 outVec, out float outVal) {
outVec = abs(v1);
}
void node_vect_math_minimum(vec3 v1, vec3 v2, vec3 v3, float val, out vec3 outVec,
out float outVal) {
outVec = min(v1, v2);
}
void node_vect_math_maximum(vec3 v1, vec3 v2, vec3 v3, float val, out vec3 outVec,
out float outVal) {
outVec = max(v1, v2);
}
void node_vect_math_cosine(vec3 v1, vec3 v2, vec3 v3, float val, out vec3 outVec,
out float outVal) {
outVec = cos(v1);
}
void node_vect_math_sine(vec3 v1, vec3 v2, vec3 v3, float val, out vec3 outVec,
out float outVal) {
outVec = sin(v1);
}
void node_vect_math_tangent(vec3 v1, vec3 v2, vec3 v3, float val, out vec3 outVec,
out float outVal) {
outVec = tan(v1);
}
void node_vect_math_wrap(vec3 v1, vec3 v2, vec3 v3, float val, out vec3 outVec,
out float outVal) {
v1 += 1e-5;
outVec.x = v2.x == v3.x ? v2.x : mod(v1.x - v3.x, v2.x - v3.x) + v3.x;
outVec.y = v2.y == v3.y ? v2.y : mod(v1.y - v3.y, v2.y - v3.y) + v3.y;
outVec.z = v2.z == v3.z ? v2.z : mod(v1.z - v3.z, v2.z - v3.z) + v3.z;
}
void node_vect_math_faceforward(vec3 v1, vec3 v2, vec3 v3, float val,
out vec3 outVec, out float outVal) {
outVec = dot(v2, v3) < 0.0 ? v1 : -v1;
}
void node_vect_math_multiply_add(vec3 v1, vec3 v2, vec3 v3, float val,
out vec3 outVec, out float outVal) {
outVec = v1 * v2 + v3;
}
void node_vect_math_refract(vec3 v1, vec3 v2, vec3 v3, float val,
out vec3 outVec, out float outVal) {
if (v2 != vec3(0.0)) {
v2 = normalize(v2);
}
outVec = refract(v1, v2, val);
}`,Rq=`#define VEC_TRANS_NONE 0
#define VEC_TRANS_W_O 1
#define VEC_TRANS_W_C 2
#define VEC_TRANS_O_W 3
#define VEC_TRANS_O_C 4
#define VEC_TRANS_C_W 5
#define VEC_TRANS_C_O 6
#define VEC_TRANS_W_O_DIR 7
#define VEC_TRANS_W_C_DIR 8
#define VEC_TRANS_O_W_DIR 9
#define VEC_TRANS_O_C_DIR 10
#define VEC_TRANS_C_W_DIR 11
#define VEC_TRANS_C_O_DIR 12
void node_vect_transform(const int vecTransType, const bool invCamZ, vec3 vIn, out vec3 vOut)
{
if (vecTransType == VEC_TRANS_NONE)
vOut = vIn;
else {
vec4 vec;
if (vecTransType < VEC_TRANS_W_O_DIR)
vec = vec4(vIn.xyz, 1.0);
else
vec = vec4(vIn.xyz, 0.0);
if (vecTransType == VEC_TRANS_W_O || vecTransType == VEC_TRANS_W_O_DIR) {
vec = vec4(vec.x, vec.z, -vec.y, vec.w);
vec = invModelMatrix * vec;
vec = vec4(vec.x, -vec.z, vec.y, vec.w);
} else if (vecTransType == VEC_TRANS_W_C || vecTransType == VEC_TRANS_W_C_DIR) {
vec = vec4(vec.x, vec.z, -vec.y, vec.w);
vec = viewMatrix * vec;
if (invCamZ)
vec[2] = -vec[2];
} else if (vecTransType == VEC_TRANS_O_W || vecTransType == VEC_TRANS_O_W_DIR) {
vec = vec4(vec.x, vec.z, -vec.y, vec.w);
vec = modelMatrix * vec;
vec = vec4(vec.x, -vec.z, vec.y, vec.w);
} else if (vecTransType == VEC_TRANS_O_C || vecTransType == VEC_TRANS_O_C_DIR) {
vec = vec4(vec.x, vec.z, -vec.y, vec.w);
vec = modelViewMatrix * vec;
if (invCamZ)
vec[2] = -vec[2];
} else if (vecTransType == VEC_TRANS_C_W || vecTransType == VEC_TRANS_C_W_DIR) {
if (invCamZ)
vec[2] = -vec[2];
vec = invViewMatrix * vec;
vec = vec4(vec.x, -vec.z, vec.y, vec.w);
} else if (vecTransType == VEC_TRANS_C_O || vecTransType == VEC_TRANS_C_O_DIR) {
if (invCamZ)
vec[2] = -vec[2];
vec = invModelMatrix * invViewMatrix * vec;
vec = vec4(vec.x, -vec.z, vec.y, vec.w);
}
vOut = vec.xyz;
}
}`,Iq=`void node_vector_displacement(vec4 vector, float midLevel, float scale,
out vec3 displacement) {
displacement = vec3(0.0);
}`,Lq=`void node_vector_rotate_axis_angle(float invert, vec3 vector, vec3 center,
vec3 axis, float angle, vec3 rotation, out vec3 outVector) {
if (length(axis) > 0.0) {
vector -= center;
outVector = vec3RotateAxisAngle(vector, axis, invert * angle);
outVector += center;
} else {
outVector = vector;
}
}
void node_vector_rotate_euler_xyz(float invert, vec3 vector, vec3 center,
vec3 axis, float angle, vec3 rotation, out vec3 outVector) {
vec4 axisAngle = eulerToAxisAngle(rotation);
vector -= center;
outVector = vec3RotateAxisAngle(vector, axisAngle.xyz, invert * axisAngle.w);
outVector += center;
}
void node_vector_rotate_x_axis(float invert, vec3 vector, vec3 center,
vec3 axis, float angle, vec3 rotation, out vec3 outVector) {
vector -= center;
outVector = vec3RotateXAngle(vector, invert * angle);
outVector += center;
}
void node_vector_rotate_y_axis(float invert, vec3 vector, vec3 center,
vec3 axis, float angle, vec3 rotation, out vec3 outVector) {
vector -= center;
outVector = vec3RotateYAngle(vector, invert * angle);
outVector += center;
}
void node_vector_rotate_z_axis(float invert, vec3 vector, vec3 center,
vec3 axis, float angle, vec3 rotation, out vec3 outVector) {
vector -= center;
outVector = vec3RotateZAngle(vector, invert * angle);
outVector += center;
}`,Bq=`void node_vertex_color(vec4 color, out vec4 outColor, out float outAlpha) {
outColor = color;
outAlpha = color.a;
}`,Pq=`void node_volume_absorption(vec4 color, float density, out vec4 outColor)
{
outColor = color;
}`,Nq=`void node_volume_info(out vec4 color, out float density, out float flame,
out float temperature) {
color = vec4(vec3(0.0), 1.0);
density = 0.0;
flame = 0.0;
temperature = 0.0;
}`,Dq=`void node_volume_scatter(vec4 color, float density, float anisotropy, out vec4 outColor)
{
outColor = vec4(color);
}`,Oq=`void node_wavelength(float wavelength, out vec4 outColor)
{
outColor = vec4(0.0, 0.0, 0.0, 1.0);
#if __VERSION__ == 300
vec3 xyz = vec3(0.0);
float ii = (wavelength - 380.0) / 5.0;
int i = int(ii);
if (i < 0 || i >= 80) {
return;
}
ii -= float(i);
vec3 c1 = cieColorMatch[i];
vec3 c2 = cieColorMatch[i+1];
xyz = mix(c1, c2, ii);
outColor = vec4(xyz_to_sRGB(xyz), 1.0);
#endif
}`,Fq=`void node_wireframe(float size, out float outFac)
{
outFac = 0.0;
}`,Uq=`void node_bitmap_none(out vec4 color)
{
color = vec4(1.0);
}`,zq=`void node_bitmap_env(sampler2D envMap, int reflectMode, float IOR,
const int encoding, const bool alphaAsMono, const bool alphaAsRGB,
float uOffset, float vOffset, float uTiling, float vTiling, float wAngle, vec3 normal,
out vec4 color, out float value)
{
vec3 cameraToVertex = normalize(vWorldPosition - cameraPosition);
vec3 worldNormal = inverseTransformDirection(normal, viewMatrix);
vec3 reflectVec;
#if WORLD_NODES
reflectVec = normalize(cameraToVertex);
#else
if (reflectMode == MAX_ENV_COORDS_REFLECT)
reflectVec = reflect(cameraToVertex, worldNormal);
else {
float refrRatio = 1.0 / IOR;
reflectVec = refract(cameraToVertex, worldNormal, refrRatio);
}
#endif
mat3 uvTransform = calcUvTransform(uOffset, vOffset, uTiling, vTiling, wAngle);
color = sampleEquirectangular(envMap, reflectVec, uvTransform, encoding);
if (alphaAsMono)
value = color.a;
else
value = average(color.rgb);
if (alphaAsRGB)
color = vec4(color.a);
}`,Vq=`void node_bitmap(sampler2D map, const vec2 uvIn, const int mapping, const int axis,
const ivec2 clampToEdgeNoExtend,
const int encoding, const bool alphaAsMono, const bool alphaAsRGB,
float uOffset, float vOffset, float uTiling, float vTiling, float wAngle,
out vec4 color, out float value)
{
vec3 coordsIn;
if (mapping == MAPPING_EXPLICIT_MAP_CHANNEL) {
coordsIn = vec3(uvIn.x, 1.0 - uvIn.y, 0.0);
} else if (mapping == MAPPING_VERTEX_COLOR_CHANNEL) {
coordsIn = vec3(0.0);
} else if (mapping == MAPPING_PLANAR_OBJECT_XYZ) {
coordsIn = swizzleUpZ((invModelMatrix * invViewMatrix * vec4(-vViewPosition, 1.0)).xyz);
} else {
coordsIn = swizzleUpZ((invViewMatrix * vec4(-vViewPosition, 1.0)).xyz);
}
if (axis == AXIS_XY)
coordsIn = vec3(coordsIn.x, coordsIn.y, 1.0);
else if (axis == AXIS_YZ)
coordsIn = vec3(coordsIn.y, coordsIn.z, 1.0);
else if (axis == AXIS_ZX)
coordsIn = vec3(coordsIn.z, coordsIn.x, 1.0);
vec3 coordsOut = calcUvTransform(uOffset, vOffset, uTiling, vTiling, wAngle) * coordsIn;
vec2 uv = vec2(coordsOut.x, 1.0 - coordsOut.y);
if ((clampToEdgeNoExtend[0] == 1 && (uvIn.x < 0.0 || uvIn.x > 1.0)) ||
(clampToEdgeNoExtend[1] == 1 && (uvIn.y < 0.0 || uvIn.y > 1.0))) {
color = vec4(0.0, 0.0, 0.0, 1.0);
} else {
color = texture2D(map, uv);
color = nodeTexelToLinear(color, encoding);
}
if (alphaAsMono)
value = color.a;
else
value = average(color.rgb);
if (alphaAsRGB)
color = vec4(color.a);
}`,kq=`void node_bump(sampler2D bumpMap, const vec3 eyePos, const vec3 normal, const vec2 uvIn,
float uOffset, float vOffset, float uTiling, float vTiling, float wAngle,
out vec3 normalOut)
{
vec3 coordsIn;
coordsIn = vec3(uvIn.x, 1.0 - uvIn.y, 1.0);
vec3 coordsOut = calcUvTransform(uOffset, vOffset, uTiling, vTiling, wAngle) * coordsIn;
vec2 uv = vec2(coordsOut.x, 1.0 - coordsOut.y);
vec2 dSTdx = dFdx(uv);
vec2 dSTdy = dFdy(uv);
if (any(equal(dSTdx, vec2(0.0))) || any(equal(dSTdy, vec2(0.0)))) {
normalOut = normal;
} else {
const float bumpScale = 1.0;
vec3 vSigmaX = vec3(dFdx(eyePos.x), dFdx(eyePos.y), dFdx(eyePos.z));
vec3 vSigmaY = vec3(dFdy(eyePos.x), dFdy(eyePos.y), dFdy(eyePos.z));
vec3 vN = normal;
vec3 R1 = cross(vSigmaY, vN);
vec3 R2 = cross(vN, vSigmaX);
float fDet = dot(vSigmaX, R1);
float Hll = bumpScale * texture2D(bumpMap, uv).x;
float dBx = bumpScale * texture2D(bumpMap, uv + dSTdx).x - Hll;
float dBy = bumpScale * texture2D(bumpMap, uv + dSTdy).x - Hll;
vec2 dHdxy = vec2(dBx, dBy);
vec3 vGrad = sign(fDet) * (dHdxy.x * R1 + dHdxy.y * R2);
normalOut = normalize(abs(fDet) * normal - vGrad);
}
}`,Gq=`void node_blend(
const bool useCurve, const float curveLower, const float curveUpper,
const vec4 color1, const vec4 color2, float mask,
out vec4 color)
{
if (useCurve)
mask = smoothstep(curveLower, curveUpper, mask);
else
mask = clamp(mask, 0.0, 1.0);
color = mix(color1, color2, mask);
}`,Qq=`#define REWIRE_RED 0
#define REWIRE_GREEN 1
#define REWIRE_BLUE 2
#define REWIRE_ALPHA 3
#define REWIRE_RED_INV 4
#define REWIRE_GREEN_INV 5
#define REWIRE_BLUE_INV 6
#define REWIRE_ALPHA_INV 7
#define REWIRE_MONOCHROME 8
#define REWIRE_ONE 9
#define REWIRE_ZERO 10
float rewireChannel(int type, vec4 color)
{
if (type == REWIRE_RED)
return color.r;
else if (type == REWIRE_GREEN)
return color.g;
else if (type == REWIRE_BLUE)
return color.b;
else if (type == REWIRE_ALPHA)
return color.a;
else if (type == REWIRE_RED_INV)
return 1.0-color.r;
else if (type == REWIRE_GREEN_INV)
return 1.0-color.g;
else if (type == REWIRE_BLUE_INV)
return 1.0-color.b;
else if (type == REWIRE_ALPHA_INV)
return 1.0-color.a;
else if (type == REWIRE_MONOCHROME)
return average(color.rgb);
else if (type == REWIRE_ONE)
return 1.0;
else
return 0.0;
}
vec3 gainPivotGammaLift(vec3 color, float gain, float pivot, float gamma, float lift, int exposureMode, float printerLights)
{
gain = gain / 100.0;
if (exposureMode == 0) {
color = color * gain / pivot;
} else if (exposureMode == 1) {
color = color * pow(2.0, gain) / pivot;
} else {
color = color * pow(printerLights, gain) / pivot;
}
vec3 tmp = pivot * pow(color, vec3(1.0 / gamma));
return step(0.00001, color) * tmp + lift;
}
float gainPivotGammaLift(float value, float gain, float pivot, float gamma, float lift, int exposureMode, float printerLights)
{
gain = gain / 100.0;
if (exposureMode == 0) {
value = value * gain / pivot;
} else if (exposureMode == 1) {
value = value * pow(2.0, gain) / pivot;
} else {
value = value * pow(printerLights, gain) / pivot;
}
float tmp = pivot * pow(value, 1.0 / gamma);
return step(0.00001, value) * tmp + lift;
}
void node_color_correction(const ivec4 rewire,
const vec4 color, const float hueShift, const float saturation,
const vec4 tint, const float tintStrength,
const float brightness, const float contrast,
out vec4 outColor)
{
if (all(equal(rewire, ivec4(REWIRE_RED, REWIRE_GREEN, REWIRE_BLUE, REWIRE_ALPHA)))) {
outColor = color;
} else {
outColor.r = rewireChannel(rewire.x, color);
outColor.g = rewireChannel(rewire.y, color);
outColor.b = rewireChannel(rewire.z, color);
outColor.a = rewireChannel(rewire.w, color);
}
vec4 hsv;
rgbToHSV(outColor, hsv);
hsv[0] += hueShift / 360.0;
if (hsv[0] > 1.0)
hsv[0] -= 1.0;
else if (hsv[0] < 0.0)
hsv[0] += 1.0;
hsv[1] *= (saturation / 100.0 + 1.0);
hsv[1] = saturate(hsv[1]);
if (tintStrength > 0.0) {
vec4 hsvTint;
rgbToHSV(tint, hsvTint);
hsv[0] = hsv[0] + (hsvTint[0] - hsv[0]) * tintStrength / 100.0;
}
hsvToRGB(hsv, outColor);
outColor = (outColor - 0.5) * (contrast / 100.0 + 1.0) + 0.5 + brightness / 100.0;
outColor = max(outColor, 0.0);
}
void node_color_correction(const ivec4 rewire, const mat4 params,
bool enableR, bool enableG, bool enableB, int exposureMode, float printerLights,
const vec4 color, const float hueShift, const float saturation,
const vec4 tint, const float tintStrength,
out vec4 outColor)
{
if (all(equal(rewire, ivec4(REWIRE_RED, REWIRE_GREEN, REWIRE_BLUE, REWIRE_ALPHA)))) {
outColor = color;
} else {
outColor.r = rewireChannel(rewire.x, color);
outColor.g = rewireChannel(rewire.y, color);
outColor.b = rewireChannel(rewire.z, color);
outColor.a = rewireChannel(rewire.w, color);
}
vec4 hsv;
rgbToHSV(outColor, hsv);
hsv[0] += hueShift / 360.0;
if (hsv[0] > 1.0)
hsv[0] -= 1.0;
else if (hsv[0] < 0.0)
hsv[0] += 1.0;
hsv[1] *= (saturation / 100.0 + 1.0);
hsv[1] = saturate(hsv[1]);
if (tintStrength > 0.0) {
vec4 hsvTint;
rgbToHSV(tint, hsvTint);
hsv[0] = hsv[0] + (hsvTint[0] - hsv[0]) * tintStrength / 100.0;
}
hsvToRGB(hsv, outColor);
outColor.rgb = gainPivotGammaLift(outColor.rgb, params[0][0], params[0][1], params[0][2], params[0][3],
exposureMode, printerLights);
if (enableR)
outColor.r = gainPivotGammaLift(outColor.r, params[1][0], params[1][1], params[1][2], params[1][3],
exposureMode, printerLights);
if (enableG)
outColor.g = gainPivotGammaLift(outColor.g, params[2][0], params[2][1], params[2][2], params[2][3],
exposureMode, printerLights);
if (enableB)
outColor.b = gainPivotGammaLift(outColor.b, params[3][0], params[3][1], params[3][2], params[3][3],
exposureMode, printerLights);
outColor = max(outColor, 0.0);
}`,Hq=`void node_color_map(const bool reverseGamma,
const vec4 color, const float gamma, const float gain,
out vec4 outColor)
{
float p = reverseGamma ? gamma : 1.0 / gamma;
float g = reverseGamma ? (gain > EPSILON ? 1.0 / gain : 1.0) : gain;
outColor = vec4(g * pow(abs(color.rgb), vec3(p)), color.a);
}`,Wq=`#define COMP_BLEND_NORMAL 0
#define COMP_BLEND_AVERAGE 1
#define COMP_BLEND_ADD 2
#define COMP_BLEND_SUBTRACT 3
#define COMP_BLEND_DARKEN 4
#define COMP_BLEND_MULTIPLY 5
#define COMP_BLEND_COLORBURN 6
#define COMP_BLEND_LINEARBURN 7
#define COMP_BLEND_LIGHTEN 8
#define COMP_BLEND_SCREEN 9
#define COMP_BLEND_COLORDODGE 10
#define COMP_BLEND_LINEARDODGE 11
#define COMP_BLEND_SPOT 12
#define COMP_BLEND_SPOTBLEND 13
#define COMP_BLEND_OVERLAY 14
#define COMP_BLEND_SOFTLIGHT 15
#define COMP_BLEND_HARDLIGHT 16
#define COMP_BLEND_PINLIGHT 17
#define COMP_BLEND_HARDMIX 18
#define COMP_BLEND_DIFFERENCE 19
#define COMP_BLEND_EXCLUSION 20
#define COMP_BLEND_HUE 21
#define COMP_BLEND_SATURATION 22
#define COMP_BLEND_COLOR 23
#define COMP_BLEND_VALUE 24
vec4 calcBlending(const vec4 colorBG, const vec4 colorFG, const int blendMode) {
if (blendMode == COMP_BLEND_NORMAL)
return colorFG;
else if (blendMode == COMP_BLEND_AVERAGE)
return (colorFG + colorBG) / 2.0;
else if (blendMode == COMP_BLEND_ADD)
return colorBG + colorFG;
else if (blendMode == COMP_BLEND_SUBTRACT)
return colorBG - colorFG;
else if (blendMode == COMP_BLEND_DARKEN)
return min(colorFG, colorBG);
else if (blendMode == COMP_BLEND_MULTIPLY)
return colorBG * colorFG;
else if (blendMode == COMP_BLEND_COLORBURN) {
if (colorFG.r == 0.0 && colorFG.g == 0.0 && colorFG.b == 0.0)
return vec4(0.0, 0.0, 0.0, 1.0);
else
return max(1.0 - (1.0 - colorBG) / colorFG, 0.0);
} else if (blendMode == COMP_BLEND_LINEARBURN)
return max(colorFG + colorBG - 1.0, 0.0);
else if (blendMode == COMP_BLEND_LIGHTEN)
return max(colorFG, colorBG);
else if (blendMode == COMP_BLEND_SCREEN)
return colorFG + colorBG - colorFG * colorBG;
else if (blendMode == COMP_BLEND_COLORDODGE) {
if (colorFG.r == 1.0 && colorFG.g == 1.0 && colorFG.b == 1.0)
return vec4(1.0);
else
return min(colorBG / (1.0 - colorFG), 1.0);
} else if (blendMode == COMP_BLEND_LINEARDODGE)
return min(colorFG + colorBG, 1.0);
else if (blendMode == COMP_BLEND_SPOT)
return min(2.0 * colorFG * colorBG, 1.0);
else if (blendMode == COMP_BLEND_SPOTBLEND)
return min(colorFG * colorBG + colorBG, 1.0);
else if (blendMode == COMP_BLEND_OVERLAY) {
if (colorBG.r <= 0.5 && colorBG.g <= 0.5 && colorBG.b <= 0.5)
return saturate(2.0 * colorFG * colorBG);
else
return saturate(1.0 - 2.0 * (1.0-colorFG) * (1.0-colorBG));
} else if (blendMode == COMP_BLEND_SOFTLIGHT) {
if (colorFG.r <= 0.5 && colorFG.g <= 0.5 && colorFG.b <= 0.5)
return saturate(colorBG * (colorBG + 2.0 * colorFG * (1.0 - colorBG)));
else
return saturate(colorBG + (2.0 * colorFG - 1.0) * (sqrt(colorBG) - colorBG));
} else if (blendMode == COMP_BLEND_HARDLIGHT) {
if (colorFG.r <= 0.5 && colorFG.g <= 0.5 && colorFG.b <= 0.5)
return saturate(2.0 * colorFG * colorBG);
else
return saturate(1.0 - 2.0*(1.0 - colorFG)*(1.0 - colorBG));
} else if (blendMode == COMP_BLEND_PINLIGHT) {
if (((colorFG.r > 0.5 && colorFG.g > 0.5 && colorFG.b > 0.5) && all(greaterThan(colorFG, colorBG))) ||
((colorFG.r <= 0.5 && colorFG.g <= 0.5 && colorFG.b <= 0.5) && all(lessThan(colorFG, colorBG))))
return colorFG;
else
return colorBG;
} else if (blendMode == COMP_BLEND_HARDMIX) {
if (colorFG.r + colorBG.r <= 1.0 && colorFG.g + colorBG.g <= 1.0 && colorFG.b + colorBG.b <= 1.0)
return vec4(0.0, 0.0, 0.0, 1.0);
else
return vec4(1.0);
} else if (blendMode == COMP_BLEND_DIFFERENCE)
return abs(colorFG - colorBG);
else if (blendMode == COMP_BLEND_EXCLUSION)
return colorFG + colorBG - 2.0 * colorFG * colorBG;
}
vec4 calcBlendingHSV(const vec4 colorBG, const vec4 colorFG, const int blendMode)
{
vec4 hsvBG, hsvFG;
vec4 outColor;
if (blendMode == COMP_BLEND_HUE) {
rgbToHSV(colorBG, hsvBG);
rgbToHSV(colorFG, hsvFG);
hsvToRGB(vec4(hsvFG[0], hsvBG[1], hsvBG[2], 1.0), outColor);
} else if (blendMode == COMP_BLEND_SATURATION) {
rgbToHSV(colorBG, hsvBG);
rgbToHSV(colorFG, hsvFG);
hsvToRGB(vec4(hsvBG[0], hsvFG[1], hsvBG[2], 1.0), outColor);
} else if (blendMode == COMP_BLEND_COLOR) {
rgbToHSV(colorBG, hsvBG);
rgbToHSV(colorFG, hsvFG);
hsvToRGB(vec4(hsvFG[0], hsvFG[1], hsvBG[2], 1.0), outColor);
} else if (blendMode == COMP_BLEND_VALUE) {
rgbToHSV(colorBG, hsvBG);
rgbToHSV(colorFG, hsvFG);
hsvToRGB(vec4(hsvBG[0], hsvBG[1], hsvFG[2], 1.0), outColor);
}
return outColor;
}
void node_composite_layer(const int blendMode, const float opacity, 
const vec4 colorBG, const vec4 colorFG, const vec4 mask,
out vec4 outColor)
{
float fac = saturate(opacity * average(mask.rgb));
if (blendMode < COMP_BLEND_HUE)
outColor = calcBlending(colorBG, colorFG, blendMode);
else
outColor = calcBlendingHSV(colorBG, colorFG, blendMode);
outColor = mix(colorBG, outColor, fac);
}`,Yq=`#define FALLOFF_TYPE_TOWARDS_AWAY 0
#define FALLOFF_TYPE_PERP_PARALL 1
#define FALLOFF_TYPE_FRESHNEL 2
#define FALLOFF_TYPE_SHADOW_LIGHT 3
#define FALLOFF_TYPE_DIST_BLEND 4
void node_falloff(const vec3 viewPos, const float IOR, const int falloffType,
const vec4 color1, const vec4 color2, const vec3 normal, out vec4 color)
{
vec3 dir = normalize(viewPos);
float fac;
if (falloffType == FALLOFF_TYPE_TOWARDS_AWAY) {
fac = 1.0 - (0.5 * (abs(dot(dir, normal)) + 1.0));
} else if (falloffType == FALLOFF_TYPE_PERP_PARALL) {
fac = 1.0 - abs(dot(dir, normal));
} else if (falloffType == FALLOFF_TYPE_FRESHNEL) {
float eta = max(IOR, 0.00001);
fac = fresnelReflection(dir, normal, (gl_FrontFacing) ? eta : 1.0 / eta);
} else {
fac = 0.0;
}
color = mix(color1, color2, fac);
}
void node_falloff(const vec3 viewPos, bool extrapolateOn, float nearDistance, float farDistance,
const vec4 color1, const vec4 color2, const vec3 normal, out vec4 color)
{
float dist = length(viewPos);
float fac;
if (!extrapolateOn && dist <= nearDistance) {
fac = 1.0;
} else if (!extrapolateOn && dist > farDistance) {
fac = 0.0;
} else {
fac = ((farDistance - nearDistance) != 0.0) ? ((farDistance - dist) / (farDistance - nearDistance)) : 10000.0;
}
color = mix(color1, color2, fac);
}`,jq=`#define GRAD_TYPE_LINEAR 0
#define GRAD_TYPE_RADIAL 1
void node_gradient(
float color2Pos, int gradientType, vec2 uvIn, vec3 viewPos, int mapping, int axis, ivec2 clampToEdgeNoExtend,
vec3 color1, vec3 color2, vec3 color3, float uOffset, float vOffset, float uTiling, float vTiling, float wAngle,
out vec4 outCol)
{
vec3 coordsIn;
if (mapping == MAPPING_EXPLICIT_MAP_CHANNEL) {
coordsIn = vec3(uvIn.x, 1.0 - uvIn.y, 0.0);
} else if (mapping == MAPPING_VERTEX_COLOR_CHANNEL) {
coordsIn = vec3(0.0);
} else if (mapping == MAPPING_PLANAR_OBJECT_XYZ) {
coordsIn = swizzleUpZ((invModelMatrix * invViewMatrix * vec4(-viewPos, 1.0)).xyz);
} else {
coordsIn = swizzleUpZ((invViewMatrix * vec4(-vViewPosition, 1.0)).xyz);
}
if (axis == AXIS_XY)
coordsIn = vec3(coordsIn.x, coordsIn.y, 1.0);
else if (axis == AXIS_YZ)
coordsIn = vec3(coordsIn.y, coordsIn.z, 1.0);
else if (axis == AXIS_ZX)
coordsIn = vec3(coordsIn.z, coordsIn.x, 1.0);
vec3 coordsOut = calcUvTransform(uOffset, vOffset, uTiling, vTiling, wAngle) * coordsIn;
float coord = uvIn.x;
uvIn = coordsOut.xy;
if ((clampToEdgeNoExtend[0] == 1 && (uvIn.x < 0.0 || uvIn.x > 1.0)) ||
(clampToEdgeNoExtend[1] == 1 && (uvIn.y < 0.0 || uvIn.y > 1.0))) {
outCol = vec4(0.0, 0.0, 0.0, 1.0);
return;
}
uvIn = fract(uvIn);
if (gradientType == GRAD_TYPE_LINEAR) {
coord = uvIn.y;
} else {
coord = length(uvIn - vec2(0.5)) * 2.0;
if (coord > 1.0)
coord = 1.0;
}
if (coord < color2Pos) {
coord = coord / color2Pos;
outCol = vec4(color3 * (1.0 - coord) + color2 * coord, 1.0);
} else if (coord > color2Pos) {
coord = (coord - color2Pos) / (1.0 - color2Pos);
outCol = vec4(color2 * (1.0 - coord) + color1 * coord, 1.0);
} else {
outCol = vec4(color2, 1.0);
}
}`,Xq=`#define GRAD_TYPE_4_CORNER 0
#define GRAD_TYPE_BOX 1
#define GRAD_TYPE_DIAGONAL 2
#define GRAD_TYPE_LIGHTING 3
#define GRAD_TYPE_LINEAR 4
#define GRAD_TYPE_MAPPED 5
#define GRAD_TYPE_NORMAL 6
#define GRAD_TYPE_PONG 7
#define GRAD_TYPE_RADIAL 8
#define GRAD_TYPE_SPIRAL 9
#define GRAD_TYPE_SWEEP 10
#define GRAD_TYPE_TARTAN 11
void node_gradient_ramp(
sampler2D gradientData, int gradientType, vec2 uvIn, vec3 geometryNormal,
vec3 viewPos, int mapping, int axis, ivec2 clampToEdgeNoExtend,
vec4 sourceMap, float uOffset, float vOffset, float uTiling, float vTiling, float wAngle,
out vec4 outCol)
{
vec3 coordsIn;
if (mapping == MAPPING_EXPLICIT_MAP_CHANNEL) {
coordsIn = vec3(uvIn.x, 1.0 - uvIn.y, 0.0);
} else if (mapping == MAPPING_VERTEX_COLOR_CHANNEL) {
coordsIn = vec3(0.0);
} else if (mapping == MAPPING_PLANAR_OBJECT_XYZ) {
coordsIn = swizzleUpZ((invModelMatrix * invViewMatrix * vec4(-viewPos, 1.0)).xyz);
} else {
coordsIn = swizzleUpZ((invViewMatrix * vec4(-vViewPosition, 1.0)).xyz);
}
if (axis == AXIS_XY)
coordsIn = vec3(coordsIn.x, coordsIn.y, 1.0);
else if (axis == AXIS_YZ)
coordsIn = vec3(coordsIn.y, coordsIn.z, 1.0);
else if (axis == AXIS_ZX)
coordsIn = vec3(coordsIn.z, coordsIn.x, 1.0);
vec3 coordsOut = calcUvTransform(uOffset, vOffset, uTiling, vTiling, wAngle) * coordsIn;
float coord = uvIn.x;
uvIn = coordsOut.xy;
if ((clampToEdgeNoExtend[0] == 1 && (uvIn.x < 0.0 || uvIn.x > 1.0)) ||
(clampToEdgeNoExtend[1] == 1 && (uvIn.y < 0.0 || uvIn.y > 1.0))) {
outCol = vec4(0.0, 0.0, 0.0, 1.0);
return;
}
uvIn = fract(uvIn);
if (gradientType == GRAD_TYPE_4_CORNER) {
coord = pow(uvIn.x, 2.0);
} else if (gradientType == GRAD_TYPE_BOX) {
vec2 boxUv = abs(uvIn - vec2(0.5)) * 2.0;
coord = max(boxUv.x, boxUv.y);
} else if (gradientType == GRAD_TYPE_DIAGONAL) {
coord = abs(uvIn.x - uvIn.y) * sqrt(2.0);
} else if (gradientType == GRAD_TYPE_LIGHTING) {
IncidentLight directLight;
GeometricContext geometry;
geometry.position = -viewPos;
vec3 irr = vec3(0.0);
#if (NUM_POINT_LIGHTS > 0)
#pragma unroll_loop
for (int i = 0; i < NUM_POINT_LIGHTS; i++) {
getPointLightInfo(pointLights[i], geometry, directLight);
float dotNL = saturate(dot(geometryNormal, directLight.direction));
irr += dotNL * directLight.color;
}
#endif
#if (NUM_SPOT_LIGHTS > 0)
#pragma unroll_loop
for (int i = 0; i < NUM_SPOT_LIGHTS; i++) {
getSpotLightInfo(spotLights[i], geometry, directLight);
float dotNL = saturate(dot(geometryNormal, directLight.direction));
irr += dotNL * directLight.color;
}
#endif
#if (NUM_DIR_LIGHTS > 0)
#pragma unroll_loop
for (int i = 0; i < NUM_DIR_LIGHTS; i++) {
getDirectionalLightInfo(directionalLights[i], geometry, directLight);
float dotNL = saturate(dot(geometryNormal, directLight.direction));
irr += dotNL * directLight.color;
}
#endif
irr /= PI;
vec3 ambIrr = getAmbientLightIrradiance(ambientLightColor);
irr += ambIrr;
coord = (irr.x + irr.y + irr.z) / 3.0;
} else if (gradientType == GRAD_TYPE_LINEAR) {
coord = uvIn.x;
} else if (gradientType == GRAD_TYPE_MAPPED) {
coord = (sourceMap.x + sourceMap.y + sourceMap.z) / 3.0;
} else if (gradientType == GRAD_TYPE_NORMAL) {
float angle = acos(clamp(dot(geometryNormal, normalize(viewPos)), -1.0, 1.0));
float k = 100.0;
coord = 1.0 - sin(pow2(k) - k * sqrt(pow2(k) - pow2(angle)));
} else if (gradientType == GRAD_TYPE_PONG) {
float y = min(uvIn.y, uvIn.x);
float x = max(uvIn.y, uvIn.x);
coord = y / x;
} else if (gradientType == GRAD_TYPE_RADIAL) {
coord = length(uvIn - vec2(0.5)) * 2.0;
} else if (gradientType == GRAD_TYPE_SPIRAL) {
vec2 uvSpiral = mat2(0.0, 1.0, -1.0, 0.0) * (uvIn - vec2(0.5));
coord = atan(uvSpiral.y, uvSpiral.x) / PI2 + 0.5;
} else if (gradientType == GRAD_TYPE_SWEEP) {
coord = atan(uvIn.x, uvIn.y) / PI_HALF;
} else if (gradientType == GRAD_TYPE_TARTAN) {
vec2 uvTartan = abs(uvIn - vec2(0.5));
coord = 1.0 - min(uvTartan.x, uvTartan.y) * 2.0;
}
outCol = texture2D(gradientData, vec2(coord, 0.0));
}`,qq=`
void node_map(const vec4 colorIn, out vec4 color)
{
color = colorIn;
}`,Zq=`void node_mask(const bool maskInverted,
const vec4 color, vec4 mask,
out vec4 outColor)
{
mask = maskInverted ? vec4(vec3(1.0) - mask.rgb, mask.a) : mask;
outColor = color * mask;
}`,Kq=`void node_material(
float reflectionRatio, const float refractionRatio,
const bool selfIllumColorOn,
const vec4 ambientColor, const vec4 diffuseColor, const vec4 specularColor,
const float glossiness, const float specularLevel, const vec4 selfIllum,
const float opacity, const vec4 filterColor, const vec3 normal,
const vec4 reflection, const vec4 refraction, const float displacement,
out vec4 outColor)
{
vec3 diffuse, specular;
NodeMaterial material;
float ior = 1.5;
float facing = pow2((1.0 - ior) / (1.0 + ior));
float edge = 1.0;
float slope = 5.0;
float cosTheta = saturate(dot(normal, normalize(vViewPosition)));
float fresnelRefl = (facing + (edge - facing) * pow(1.0 - cosTheta, slope)) * saturate(specularLevel);
float kd = 1.0 - fresnelRefl;
material.diffuseColor = diffuseColor.rgb * kd;
material.specularColor = mix(vec3(0.0), specularColor.rgb, fresnelRefl);
material.roughness = 1.0 - glossiness;
ReflectedLight reflectedLight = ReflectedLight(vec3(0.0), vec3(0.0), vec3(0.0), vec3(0.0));
#define RE_Direct RE_Direct_Node
#define RE_IndirectDiffuse RE_IndirectDiffuse_Node
#define RE_IndirectSpecular RE_IndirectSpecular_Node
#include <lights_fragment_begin>
#include <lights_fragment_maps>
#include <lights_fragment_end>
#undef RE_Direct
#undef RE_IndirectDiffuse
#undef RE_IndirectSpecular
diffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
if (selfIllumColorOn) {
diffuse += selfIllum.rgb;
} else {
diffuse = mix(diffuse, material.diffuseColor, selfIllum[0]);
}
specular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
outColor = vec4(saturate(diffuse + specular), 1.0);
float alpha = opacity - saturate(maxFromRGB(specular)) * (opacity - 1.0);
outColor += reflection * specularColor * reflectionRatio;
outColor += refraction * refractionRatio;
alpha += saturate(maxFromRGB(reflection.rgb) * maxFromRGB(specularColor.rgb)) * reflectionRatio;
alpha += saturate(maxFromRGB(refraction.rgb)) * refractionRatio;
outColor.a = alpha;
}`,$q=`#include <shadowmask_pars_fragment>
void node_matte_shadow(
vec3 normal, bool receiveShadow, float shadowBrightness, vec3 color,
out vec4 outColor) {
float shadow = getShadowMask();
outColor = vec4(color, 1.0 - (shadowBrightness + (1.0 - shadowBrightness) * shadow));
}`,Jq=`void node_mix(const vec4 color1, const vec4 color2, const float amount, out vec4 color)
{
color = mix(color1, color2, clamp(amount, 0.0, 1.0));
}`,eZ=`#define NOISE_REGULAR 0
#define NOISE_FRACTAL 1
#define NOISE_TURBULENCE 2
float noise(vec3 vec, const int noiseType, const float size, const float thresholdLow, const float thresholdHigh, const float levels, float phase) {
vec /= size;
float n = 0.0;
if (noiseType == NOISE_REGULAR) {
n = (1.0 + snoise(vec4(vec, phase))) * 0.5;
} else if (noiseType == NOISE_FRACTAL) {
float l, f = 1.0;
#if __VERSION__ == 100
for (float l = 3.0; l >= 1.0; l-=1.0) {
#else
for (l = levels; l >= 1.0; l-=1.0) {
#endif
n += snoise(vec4(vec * f, phase)) / f;
f *= 2.0;
}
if (l > 0.0)
n += l * snoise(vec4(vec * f, phase)) / f;
n = 0.5 * (n + 1.0);
} else {
float l, f = 1.0;
float ml = levels;
#if __VERSION__ == 100
for (float l = 3.0; l >= 1.0; l-=1.0) {
#else
for (l = levels; l >= 1.0; l-=1.0, ml-=1.0) {
#endif
n += abs(snoise(vec4(vec * f, phase))) / f;
f *= 2.0;
}
if (l > 0.0)
n += l * abs(snoise(vec4(vec * f, phase))) / f;
}
return clamp(smoothstep(thresholdLow, thresholdHigh, n), 0.0, 1.0);
}
void node_noise(const vec2 uv, const int noiseType, const int coordType,
const vec3 color1, const vec3 color2, const float size,
const float thresholdLow, const float thresholdHigh, const float levels,
const float phase, const vec3 offset, const vec3 tiling, const vec3 angle,
out vec4 color) {
vec3 vec = (calcXYZTransform(offset, tiling, angle) * vec4(uv.x, 1.0 - uv.y, 1.0, 1.0)).xyz;
color = vec4(mix(color1, color2, noise(vec, noiseType, size, thresholdLow, thresholdHigh, levels, phase)), 1.0);
}
void node_noise(const vec3 viewPos, const int noiseType, const int coordType,
const vec3 color1, const vec3 color2, const float size,
const float thresholdLow, const float thresholdHigh, const float levels,
const float phase, const vec3 offset, const vec3 tiling, const vec3 angle,
out vec4 color) {
vec4 posWorld = invViewMatrix * vec4(-viewPos, 1.0);
vec3 vec;
if (coordType == 0)
vec = (invModelMatrix * posWorld).xyz;
else
vec = posWorld.xyz;
vec = (calcXYZTransform(offset, tiling, angle) * vec4(swizzleUpZ(vec), 1.0)).xyz;
color = vec4(mix(color1, color2, noise(vec, noiseType, size, thresholdLow, thresholdHigh, levels, phase)), 1.0);
}`,tZ=`void node_normal_bump(const vec4 tangent, const vec3 normal, ivec2 flip,
vec4 normalColor, vec3 additionalBump, float normalMult, float addBumpMult,
out vec3 normalOut)
{
if (flip[0] == 1)
normalColor.x = 1.0 - normalColor.x;
if (flip[1] == 0)
normalColor.y = 1.0 - normalColor.y;
vec3 normalTex = (normalColor.xyz * 2.0 - 1.0);
vec4 viewTangent = vec4(normalize(modelViewMatrix * vec4(tangent.xyz, 0.0)).xyz, tangent.w);
vec3 bitangent = viewTangent.w * cross(normal, viewTangent.xyz);
normalOut = normalize(normalTex.x * viewTangent.xyz + normalTex.y * bitangent 
+ normalTex.z * normal);
normalOut = mix(normal, normalOut, normalMult);
additionalBump = mix(normal, additionalBump, addBumpMult);
normalOut = normalize(normalOut + additionalBump);
}`,nZ=`void node_openpbr_surface(
vec3 geometryNormal, const bool thinWalled,
const float baseWeight, const vec3 baseColor, const float baseMetalness,
const float baseDiffuseRoughness,
const float specularWeight, const vec3 specularColor,
const float specularRoughness, const float specularIOR,
const float transmissionWeight, const vec3 transmissionColor, const float transmissionDepth,
const float coatWeight, const vec3 coatColor, const float coatRoughness,
const float fuzzWeight, const vec3 fuzzColor, const float fuzzRoughness,
const float emissionWeight, const vec3 emissionColor, const float emissionLuminance,
const float geometryOpacity,
const vec3 normal, const vec3 clearcoatNormal,
out vec4 outColor)
{
NodeMaterial material;
vec3 baseColorWeighted = baseWeight * baseColor.rgb;
material.diffuseColor = baseColorWeighted * (1.0 - baseMetalness) * (1.0 - transmissionWeight);
#ifdef USE_CLEARCOAT
material.clearcoat = saturate(coatWeight);
material.clearcoatRoughness = clamp(coatRoughness, 0.0, 1.0);
material.clearcoatF0 = vec3(0.04);
material.clearcoatF90 = 1.0;
#endif
#ifdef USE_SHEEN
material.sheenColor = saturate(fuzzWeight * fuzzColor);
material.sheenRoughness = clamp(fuzzRoughness, 0.0, 1.0);
#endif
vec3 dxy = max(abs(dFdx(geometryNormal)), abs(dFdy(geometryNormal)));
float geometryRoughness = max(max(dxy.x, dxy.y), dxy.z);
material.roughness = max(specularRoughness, 0.0525);
material.roughness += geometryRoughness;
material.roughness = min(material.roughness, 1.0);
vec3 specularColorWeighted = specularWeight * specularColor;
vec3 dielRefl = pow2((1.0 - specularIOR) / (1.0 + specularIOR)) * specularColorWeighted;
material.specularColor = mix(dielRefl, baseColorWeighted, baseMetalness);
material.fresnelRefl90 = mix(specularColorWeighted, vec3(1.0), baseMetalness);
material.specularF90 = average(material.fresnelRefl90);
material.refractionColor = pow(transmissionWeight * (1.0 - baseMetalness) * transmissionColor.rgb, vec3(2.0));
material.refractionIOR = specularIOR;
material.refractionRoughness = material.roughness;
ReflectedLight reflectedLight = ReflectedLight(vec3(0.0), vec3(0.0), vec3(0.0), vec3(0.0));
vec3 refractedLight = vec3(0.0);
#ifdef USE_GTAO
vec4 gtaoVisibilityBentNormal = texture2D(gtaoMap,
gl_FragCoord.xy / currResolution);
vec3 bentNormal = normalize(unpackRGBToNormal(gtaoVisibilityBentNormal.gba));
#define PROBE_NORMAL bentNormal
#endif
#define RE_Direct RE_Direct_Node
#define RE_IndirectDiffuse RE_IndirectDiffuse_Node
#define RE_IndirectSpecular RE_IndirectSpecular_Node
#define RE_Refraction RE_Refraction_Node
#include <lights_fragment_begin>
#include <lights_fragment_maps>
#include <lights_fragment_end>
#undef RE_Direct
#undef RE_IndirectDiffuse
#undef RE_IndirectSpecular
#undef RE_Refraction
#ifdef PROBE_NORMAL
#undef PROBE_NORMAL
#endif
#ifdef USE_GTAO
reflectedLight.indirectDiffuse *= gtaoVisibilityBentNormal.r;
float gtaoVisibility = gtaoVisibilityBentNormal.r;
vec3 gtaoBentNormal = bentNormal;
vec3 gtaoViewDir = geometry.viewDir;
vec3 gtaoNormal = normal;
float gtaoRoughness = material.roughness;
#endif
#include <lights_fragment_gtso>
vec3 totalEmissiveRadiance = emissionWeight * emissionColor * emissionLuminance * OPENPBR_EMISSION_LUM_FACTOR;
vec3 outSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
vec3 outColor3 = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse +
outSpecular + totalEmissiveRadiance;
#ifdef USE_SHEEN
float sheenEnergyComp = 1.0 - 0.157 * max3(material.sheenColor);
outColor3 = outColor3 * sheenEnergyComp + sheenSpecular;
#endif
#ifdef USE_CLEARCOAT
float dotNVcc = saturate(dot(geometry.normal, geometry.viewDir));
vec3 Fcc = F_Schlick(material.clearcoatF0, material.clearcoatF90, dotNVcc);
outColor3 = outColor3 * (1.0 - material.clearcoat * Fcc) + clearcoatSpecular * material.clearcoat;
#endif
float alpha = 1.0;
if (thinWalled) {
alpha = geometryOpacity * (1.0 - saturate(transmissionWeight) + maxFromRGB(outSpecular) * saturate(transmissionWeight));
} else {
outColor3 += refractedLight;
}
outColor = vec4(outColor3, saturate(alpha));
}`,rZ=`vec4 processOutputColor(vec4 color, const bool invert, const bool clampColor, const bool alphaFromRGB,
const float rgbLevel, const float rgbOffset, const float outputAmount)
{
vec3 color3 = color.rgb;
color3 = clampColor ? saturate(color3) : color3;
color3 = color3 * rgbLevel + vec3(rgbOffset);
color3 = invert ? (vec3(1.0) - color3) : color3;
color = outputAmount * vec4(color3, color.a);
color.a = alphaFromRGB ? average(color.rgb) : color.a;
return color;
}
void node_output_map(
const bool invert, const bool clampColor, const bool alphaFromRGB,
const vec4 color, const float rgbLevel, const float rgbOffset,
const float outputAmount, const float bumpAmount,
out vec4 outColor)
{
outColor = processOutputColor(color, invert, clampColor, alphaFromRGB, rgbLevel, rgbOffset, outputAmount);
}
void node_output_map(
const bool invert, const bool clampColor, const bool alphaFromRGB, sampler2D colormap,
vec4 color, const float rgbLevel, const float rgbOffset,
const float outputAmount, const float bumpAmount,
out vec4 outColor)
{
float r = texture2D(colormap, vec2(color.r, 0.0)).r;
float g = texture2D(colormap, vec2(color.g, 0.0)).g;
float b = texture2D(colormap, vec2(color.b, 0.0)).b;
outColor = processOutputColor(vec4(r, g, b, color.a),
invert, clampColor, alphaFromRGB, rgbLevel, rgbOffset, outputAmount);
}`,oZ=`void node_output(vec4 color, out vec4 outgoingLight)
{
outgoingLight = color;
}`,aZ=`#define DEFAULT_REFLECTION_EDGE 1.0
#define DEFAULT_REFLECTION_SLOPE 5.0
void node_physical(
vec3 geometryNormal, const float emitLuminance, const bool useCustomReflCurve,
const float reflFacing, const float reflEdge, const float reflSlope,
const bool roughnessInv, const bool transRoughnessLock, const bool transRoughnessInv,
const bool thinWalled,
const float base, const vec4 baseColor, const float reflectivity,
const vec4 reflColor, const float roughness, const float metalness,
const float diffRoughness, const float anisotropy, const float anisoangle,
const float transparency, const vec4 transColor, const float transRoughness,
const float ior, const float scattering, const vec4 sssColor,
const float sssScale, const float emission, const vec4 emitColor,
const float clearcoat, const vec4 clearcoatColor, const float clearcoatRoughness,
const vec3 normal, const vec3 clearcoatNormal, const float displacement,
const float opacity,
out vec4 outColor)
{
NodeMaterial material;
vec3 baseColorWeighted = base * baseColor.rgb;
material.diffuseColor = baseColorWeighted * (1.0 - transparency);
#ifdef USE_CLEARCOAT
material.clearcoat = saturate(clearcoat);
material.clearcoatRoughness = clamp(clearcoatRoughness, 0.0, 1.0);
material.clearcoatF0 = vec3(0.04);
material.clearcoatF90 = 1.0;
#endif
float facing, edge, slope;
if (useCustomReflCurve) {
facing = reflFacing;
edge = reflEdge;
slope = reflSlope;
} else {
facing = pow2((1.0 - ior) / (1.0 + ior));
edge = DEFAULT_REFLECTION_EDGE;
slope = DEFAULT_REFLECTION_SLOPE;
}
float cosTheta = saturate(dot(normal, normalize(vViewPosition)));
float fresnelRefl = (facing + (edge - facing) * pow(1.0 - cosTheta, slope))
* saturate(reflectivity + metalness);
float kd = 1.0 - (metalness * (1.0 - fresnelRefl) + fresnelRefl);
material.specularColor = mix(metalness * baseColorWeighted, reflColor.rgb, fresnelRefl);
material.diffuseColor *= kd;
material.specularF90 = 1.0;
material.roughness = clamp(roughnessInv ? (1.0 - roughness) : roughness, 0.0, 1.0);
material.refractionColor = pow(transparency * (1.0 - metalness) * transColor.rgb, vec3(2.0));
material.refractionIOR = ior;
float tRough;
if (transRoughnessLock) {
tRough = roughnessInv ? 1.0 - roughness : roughness;
} else {
tRough = transRoughnessInv ? 1.0 - transRoughness : transRoughness;
}
material.refractionRoughness = pow2(tRough);
#if defined(ENVMAP_TYPE_CUBE) || defined(ENVMAP_TYPE_CUBE_UV)
float geomRoughness = calcGeometryRoughness(geometryNormal);
material.roughness = calcCubeUVAdjustedRoughness(
material.roughness, geomRoughness);
material.refractionRoughness = calcCubeUVAdjustedRoughness(
material.refractionRoughness, geomRoughness);
#ifdef USE_CLEARCOAT
material.clearcoatRoughness = calcCubeUVAdjustedRoughness(
material.clearcoatRoughness, geomRoughness);
#endif
#endif
ReflectedLight reflectedLight = ReflectedLight(vec3(0.0), vec3(0.0), vec3(0.0), vec3(0.0));
vec3 refractedLight = vec3(0.0);
#ifdef USE_GTAO
vec4 gtaoVisibilityBentNormal = texture2D(gtaoMap,
gl_FragCoord.xy / currResolution);
vec3 bentNormal = normalize(unpackRGBToNormal(gtaoVisibilityBentNormal.gba));
#define PROBE_NORMAL bentNormal
#endif
#define RE_Direct RE_Direct_Node
#define RE_IndirectDiffuse RE_IndirectDiffuse_Node
#define RE_IndirectSpecular RE_IndirectSpecular_Node
#define RE_Refraction RE_Refraction_Node
#include <lights_fragment_begin>
#include <lights_fragment_maps>
#include <lights_fragment_end>
#undef RE_Direct
#undef RE_IndirectDiffuse
#undef RE_IndirectSpecular
#undef RE_Refraction
#ifdef PROBE_NORMAL
#undef PROBE_NORMAL
#endif
#ifdef USE_GTAO
reflectedLight.indirectDiffuse *= gtaoVisibilityBentNormal.r;
float gtaoVisibility = gtaoVisibilityBentNormal.r;
vec3 gtaoBentNormal = bentNormal;
vec3 gtaoViewDir = geometry.viewDir;
vec3 gtaoNormal = normal;
float gtaoRoughness = material.roughness;
#endif
#include <lights_fragment_gtso>
vec3 totalEmissiveRadiance = emitLuminance / LUMENS_PER_WATT * emission * emitColor.rgb;
vec3 specular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
vec3 outColor3 = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse +
specular + totalEmissiveRadiance;
#ifdef USE_CLEARCOAT
float dotNVcc = saturate(dot(geometry.normal, geometry.viewDir));
vec3 Fcc = F_Schlick(material.clearcoatF0, material.clearcoatF90, dotNVcc);
outColor3 = outColor3 * (1.0 - material.clearcoat * Fcc) + clearcoatSpecular * material.clearcoat;
#endif
float alpha = 1.0;
if (thinWalled) {
alpha = 1.0 - saturate(transparency) + maxFromRGB(specular) * saturate(transparency);
} else {
outColor3 += refractedLight;
}
outColor = vec4(outColor3, saturate(alpha) * opacity);
}`,iZ=`vec3 perezSky(vec3 paramA, vec3 paramB, vec3 paramC, vec3 paramD, vec3 paramE,
vec3 radiance, vec3 sunDirection, vec3 direction)
{
float cosGamma = clamp(dot(direction, sunDirection), -1.0, 1.0);
float cosTheta = clamp(direction.y, 0.0, 1.0);
vec3 radInternal = (1.0 + paramA * exp(paramB / cosTheta)) * (
1.0 + paramC * exp(paramD * acos(cosGamma))
+ paramE * pow(cosGamma, 2.0)
);
float ciex = radInternal.y * radiance.y;
float ciey = radInternal.z * radiance.z;
float cieY = clamp(radInternal.x * radiance.x, 0.0, 1000000.0);
vec3 XYZ = xyY_to_XYZ(ciex, ciey, cieY);
return max(xyz_to_sRGB(XYZ), 0.0);
}
#define GROUND_SKY_SAMPLES 16
vec3 groundSky(vec3 paramA, vec3 paramB, vec3 paramC, vec3 paramD, vec3 paramE, vec3 radiance, vec3 sunDirection, vec3 sunIlluminance)
{
const int horizSamples = GROUND_SKY_SAMPLES;
const int vertSamples = GROUND_SKY_SAMPLES / 2;
vec3 result = vec3(0.0);
for (int horizSampleIdx = 0; horizSampleIdx < horizSamples; horizSampleIdx++) {
float horizSample = float(horizSampleIdx) / float(horizSamples);
float horizAngle = PI2 * horizSample;
for (int vertSampleIdx = 0; vertSampleIdx < vertSamples; vertSampleIdx++) {
float vertSample = float(vertSampleIdx) / float(vertSamples);
float y = 1.0 - vertSample;
float x = sqrt(1.0 - y*y) * cos(horizAngle);
float z = -sqrt(1.0 - y*y) * sin(horizAngle);
vec3 direction = vec3(x, y, z);
vec3 sampleColor = perezSky(paramA, paramB, paramC, paramD, paramE,
radiance, sunDirection, direction);

result += direction.y * sampleColor;
}
}
result /= float(horizSamples * vertSamples);
result += (sunIlluminance * sunDirection.y) / PI;
return result;
}
void node_phy_sun_sky_env(vec3 paramA, vec3 paramB, vec3 paramC, vec3 paramD, vec3 paramE,
vec3 radiance, vec3 sunDirection, vec3 sunIlluminance, vec3 sunLuminance, 
float globalIntensity, vec4 groundColor,
out vec4 outColor) 
{
vec3 dir = vWorldPosition;
if (length(dir) == 0.0) {
dir = vec3(0.0, 0.0, -1.0);
} else {
dir = normalize(dir);
}
if (dir.y < 0.0) {
outColor = groundColor * vec4(groundSky(paramA, paramB, paramC, paramD, paramE, radiance, sunDirection, sunIlluminance), 1.0);
} else {
outColor = vec4(perezSky(paramA, paramB, paramC, paramD, paramE,
radiance, sunDirection, dir), 1.0);
}
outColor = globalIntensity * outColor;
}`,sZ=`void node_reflect_refract(sampler2D envMap,
int reflectMode, const float IOR, const int encoding,
vec3 normal, out vec4 color)
{
vec3 cameraToVertex = normalize(vWorldPosition - cameraPosition);
vec3 worldNormal = inverseTransformDirection(normal, viewMatrix);
vec3 reflectVec;
if (reflectMode == MAX_ENV_COORDS_REFLECT)
reflectVec = reflect(cameraToVertex, worldNormal);
else {
float refrRatio = 1.0 / IOR;
reflectVec = refract(cameraToVertex, worldNormal, refrRatio);
}
reflectVec = normalize(reflectVec);
color = sampleEquirectangular(envMap, reflectVec, mat3(1.0), encoding);
}`,lZ=`void node_reflect_refract_color(const vec4 colorIn, out vec4 color)
{
color = vec4(colorIn);
}`,cZ=`void node_rgb_multiply(const vec4 color1, const vec4 color2, out vec4 color)
{
color = color1 * color2;
}`,uZ=`void node_rgb_tint(const vec4 color, const vec4 red, const vec4 green, const vec4 blue,
out vec4 outColor)
{
mat3 tintMatrix = mat3(red.rgb, green.rgb, blue.rgb);
outColor = vec4(tintMatrix * color.rgb, color.a);
}`,dZ=`uniform vec4 nodeRGB[NODE_RGB_NUM];
void node_rgb(vec4 color, out vec4 outColor)
{
outColor = color;
}`,fZ=`void node_shellac(const vec4 color1, const vec4 color2, const float amount,
out vec4 color)
{
color = mix(color1, color2, clamp(amount, 0.0, 1.0));
}`,hZ=`#define COORD_WORLD_SPACE 0
#define COORD_OBJECT_SPACE 1
void node_sub_transform(
const int coordSpace,
vec3 scale, vec3 rotate, vec3 offset,
out vec3 outVector, out vec3 outNormal)
{
vec3 norm = vNormal;
norm = (invViewMatrix * vec4(norm, 0.0)).xyz;
vec3 vector = vWorldPosition.xyz;
if (coordSpace == COORD_OBJECT_SPACE) {
vector = (invModelMatrix * vec4(vector, 1.0)).xyz;
norm = (invModelMatrix * vec4(norm, 0.0)).xyz;
}
vector -= swizzleUpY(offset.xyz);
vector *= scale.xzy;
mat3 rotX90 = mat3RotateX(PI * 0.5);
mat3 rotX = mat3RotateX(radians(rotate.x));
mat3 rotY = mat3RotateY(radians(-rotate.y));
mat3 rotZ = mat3RotateZ(radians(rotate.z));
mat3 rotMat = rotX * rotY * rotZ * rotX90;
vector = rotMat * vector;
norm = rotMat * norm;
outVector = vector;
outNormal = normalize(norm);
}`,pZ=`uniform float nodeValue[NODE_VALUE_NUM];
void node_value(float value, out float outValue)
{
outValue = value;
}`,mZ=`void node_vertex_color(vec3 color, out vec4 outColor)
{
outColor = vec4(color, 1.0);
}`,gZ=`void node_add_double_linear(
float input1, float input2,
out float outValue) {
outValue = input1 + input2;
}`,vZ=`void node_add_matrix(
mat4 matrixIn1,
out mat4 matrixSum)
{
matrixSum = matrixIn1;
}
void node_add_matrix(
mat4 matrixIn1, mat4 matrixIn2,
out mat4 matrixSum)
{
matrixSum = matrixIn1 + matrixIn2;
}
void node_add_matrix(
mat4 matrixIn1, mat4 matrixIn2, mat4 matrixIn3,
out mat4 matrixSum)
{
matrixSum = matrixIn1 + matrixIn2 + matrixIn3;
}`,_Z=`#ifndef NODE_VALUE
uniform float nodeValue[NODE_VALUE_NUM];
#endif
void node_anim_curve_ta(float val, out float outVal)
{
outVal = val;
}`,AZ=`#ifndef NODE_VALUE
uniform float nodeValue[NODE_VALUE_NUM];
#endif
void node_anim_curve_tu(float val, out float outVal)
{
outVal = val;
}`,xZ=`void node_blend_colors(float blender, vec3 color1, vec3 color2, out vec3 outColor)
{
blender = clamp(blender, 0.0, 1.0);
outColor = mix(color1, color2, 1.0 - blender);
}
void node_blend_colors(float blender, vec4 color1, vec4 color2, out vec4 outColor)
{
blender = clamp(blender, 0.0, 1.0);
outColor = mix(color1, color2, 1.0 - blender);
}`,yZ=`void node_blinn(
vec3 geometryNormal,
vec3 color, vec3 ambientColor, vec3 incandescence, float matteOpacity,
float diffuse, vec3 normal, float reflectivity, vec3 reflectedColor,
float eccentricity, vec3 specularColor, float specularRollOff, float translucence,
vec3 transparency,
out vec4 outColor) {
NodeMaterial material;
material.diffuseColor = diffuse * color;
#ifdef USE_CLEARCOAT
#undef USE_CLEARCOAT
#define _CLEARCOAT_RESTORE
#endif
vec3 dxy = max(abs(dFdx(geometryNormal)), abs(dFdy(geometryNormal)));
float geometryRoughness = max(max(dxy.x, dxy.y), dxy.z);
material.roughness = max(eccentricity, 0.0525);
material.roughness += geometryRoughness;
material.roughness = min(material.roughness, 1.0);
material.specularColor = specularColor;
ReflectedLight reflectedLight = ReflectedLight(vec3(0.0), vec3(0.0), vec3(0.0), vec3(0.0));
#define RE_Direct RE_Direct_Node
#define RE_IndirectDiffuse RE_IndirectDiffuse_Node
#define RE_IndirectSpecular RE_IndirectSpecular_Node
#include <lights_fragment_begin>
#include <lights_fragment_maps>
#include <lights_fragment_end>
#undef RE_Direct
#undef RE_IndirectDiffuse
#undef RE_IndirectSpecular
#ifdef _CLEARCOAT_RESTORE
#undef _CLEARCOAT_RESTORE
#define USE_CLEARCOAT
#endif
float alpha = 1.0 - average(transparency);
outColor = vec4(reflectedLight.directDiffuse + reflectedLight.indirectDiffuse +
reflectedLight.directSpecular + reflectedLight.indirectSpecular + incandescence, alpha);
}`,bZ=`void node_bulge(
float uWidth, float vWidth, vec2 uvCoord,
out float outAlpha, out vec3 outColor) {
uvCoord = 2.0 * fract(uvCoord); 
float bulge = 0.0;
if (uvCoord.x > uWidth && uvCoord.x < 2.0 - uWidth &&
uvCoord.y > vWidth && uvCoord.y < 2.0 - vWidth) {
uvCoord.x = (uvCoord.x - uWidth) / (1.0 - uWidth);
uvCoord.y = (uvCoord.y - vWidth) / (1.0 - vWidth);
bulge = uvCoord.x * (2.0 - uvCoord.x) * uvCoord.y * (2.0 - uvCoord.y);
}
outAlpha = bulge; 
outColor = vec3(bulge, bulge, bulge); 
}`,SZ=`void node_bump_2d(
vec3 normal,
float bumpDepth, float bumpValue,
out vec3 outNormal) {
vec3 position = vViewPosition;
vec3 dPdx = dFdx(position);
vec3 dPdy = dFdy(position);
float dHdx = dFdx(bumpValue);
float dHdy = dFdy(bumpValue);
vec3 tanX = cross(dPdy, normal);
vec3 tanY = cross(normal, dPdx);
vec3 surfaceGrad = dHdx * tanX + dHdy * tanY;
float dotPosTanX = dot(dPdx, tanX);
outNormal = normalize(normal * abs(dotPosTanX) - surfaceGrad * sign(dotPosTanX));
outNormal = normalize(mix(normal, outNormal, max(0.0, bumpDepth)));
}
void node_bump_2d(
vec3 normal, vec4 tangent,
float bumpDepth, vec3 bumpValue,
out vec3 outNormal) {
#ifdef DOUBLE_SIDED
normal = normal * (float(gl_FrontFacing) * 2.0 - 1.0);
#endif
if (length(tangent.xyz) == 0.0)
tangent.x = 1.0;
vec3 normalTex = (bumpValue.xyz * 2.0 - 1.0);
vec4 viewTangent = vec4(normalize((modelViewMatrix * vec4(tangent.xyz, 0.0)).xyz), tangent.w);
vec3 bitangent = viewTangent.w * cross(normal, viewTangent.xyz);
outNormal = normalize(normalTex.x * viewTangent.xyz + normalTex.y * bitangent
+ normalTex.z * normal);
outNormal = mix(normal, outNormal, bumpDepth);
}`,CZ=`void node_channels(
int channelR, int channelG, int channelB, int channelA,
float inAlpha, vec3 inColor,
out float outAlpha, out vec3 outColor) {
outAlpha = 1.0;
outColor = vec3(1.0);
if (channelR == 0)
outColor.r = inColor.r;
else if (channelR == 1)
outColor.r = inColor.g;
else if (channelR == 2)
outColor.r = inColor.b;
else
outColor.r = inAlpha;
if (channelG == 0)
outColor.g = inColor.r;
else if (channelG == 1)
outColor.g = inColor.g;
else if (channelG == 2)
outColor.g = inColor.b;
else
outColor.g = inAlpha;
if (channelB == 0)
outColor.b = inColor.r;
else if (channelB == 1)
outColor.b = inColor.g;
else if (channelB == 2)
outColor.b = inColor.b;
else
outColor.b = inAlpha;
if (channelA == 0)
outAlpha = inColor.r;
else if (channelA == 1)
outAlpha = inColor.g;
else if (channelA == 2)
outAlpha = inColor.b;
else
outAlpha = inAlpha;
}`,EZ=`void node_checker(
vec3 color1, vec3 color2, float contrast, vec2 uvCoord,
out float outAlpha, out vec3 outColor) {
uvCoord -= floor(uvCoord); 
vec3 deltaColor = color2 - color1;
color1 += (1.0 - contrast) * 0.5 * deltaColor;
color2 -= (1.0 - contrast) * 0.5 * deltaColor;
if ((uvCoord.x < 0.5 && uvCoord.y >= 0.5) || (uvCoord.x >= 0.5 && uvCoord.y < 0.5)) { 
outColor = color2; 
outAlpha = 1.0; 
} else {
outColor = color1; 
outAlpha = 0.0; 
}
}`,MZ=`void node_clamp(
vec3 inputValue, vec3 maxValue, vec3 minValue,
out vec3 outputValue) {
outputValue = clamp(inputValue, minValue, maxValue);
}`,wZ=`void node_cloth(
float brightSpread, vec3 gapColor, float randomness, vec3 uColor, float uWave, float uWidth,
vec3 vColor, float vWave, float vWidth, float widthSpread, vec2 uvCoord,
out float outAlpha, out vec3 outColor) {
if (abs(uWave) > -EPSILON || abs(vWave) > -EPSILON) {
uvCoord.x += - uWave * sin(PI2 * uvCoord.y);
uvCoord.y += vWave * sin(PI2 * uvCoord.x);
}
uvCoord = fract(uvCoord);
int thread = 0;
if ((uvCoord.x >= 0.5 && uvCoord.y < 0.5) || (uvCoord.x < 0.5 && uvCoord.y >= 0.5)) {
float flippedCoord;
flippedCoord = uvCoord.x;
uvCoord.x = uvCoord.y;
uvCoord.y = flippedCoord;
flippedCoord = uWidth;
uWidth = vWidth;
vWidth = flippedCoord;
thread = 1;
}
uvCoord = fract(2.0 * uvCoord);
float cloth = 1.0;
if (uvCoord.y <= vWidth) {
float clothU = uvCoord.x - 0.5 * uWidth;
float clothV = 2.0 * uvCoord.y / vWidth - 1.0;
cloth = 0.75 * (clothU * clothU + clothV * clothV);
} else if (uvCoord.x <= uWidth) {
float clothU = 2.0 * uvCoord.x / uWidth - 1.0;
float clothV = uvCoord.y - 0.5 * vWidth - 1.0;
cloth = 0.75 * (clothU * clothU + clothV * clothV);
thread = 1 - thread;
}
outColor = gapColor;
if (cloth < 1.0) {
cloth = 1.0 - cloth;
cloth = min(cloth, 1.0);
outColor *= (1.0 - cloth);
vec3 threadColor = uColor;
if (thread == 0)
threadColor = vColor;
outColor += threadColor * cloth;
}
outAlpha = dot(outColor, LUM_WEIGHTS_MAYA);
}`,TZ=`void node_color_condition(
float alphaA, float alphaB, vec3 colorA, vec3 colorB, bool condition,
out float outAlpha, out vec3 outColor) {
outAlpha = condition ? alphaA : alphaB;
outColor = condition ? colorA : colorB;
}`,RZ=`void node_color_composite(int operation,
vec3 colorA, float alphaA, vec3 colorB, float alphaB, float factor,
out vec3 outColor, out float outAlpha)
{
if (factor <= 0.0) {
outColor = colorA;
outAlpha = alphaA;
return;
}
if (operation == 0) {
outColor[0] = colorA[0] + (colorB[0] * factor);
outColor[1] = colorA[1] + (colorB[1] * factor);
outColor[2] = colorA[2] + (colorB[2] * factor);
outAlpha = alphaA + (alphaB * factor);
} else if (operation == 1) {
outColor[0] = colorA[0] + ((colorB[0] - 1.0) * factor);
outColor[1] = colorA[1] + ((colorB[1] - 1.0) * factor);
outColor[2] = colorA[2] + ((colorB[2] - 1.0) * factor);
outAlpha = alphaA + ((alphaB - 1.0) * factor);
} else if (operation == 2) {
if (factor >= 1.0) {
outColor = colorB;
outAlpha = alphaB;
return;
}
outColor[0] = mix(colorA[0], colorB[0], factor);
outColor[1] = mix(colorA[1], colorB[1], factor);
outColor[2] = mix(colorA[2], colorB[2], factor);
outAlpha = mix(alphaA, alphaB, factor);
} else if (operation == 3) {
outColor[0] = colorA[0] * (colorB[0] * factor + (1.0 - factor));
outColor[1] = colorA[1] * (colorB[1] * factor + (1.0 - factor));
outColor[2] = colorA[2] * (colorB[2] * factor + (1.0 - factor));
outAlpha = alphaA * (alphaB * factor + (1.0 - factor));
} else if (operation == 4) {
outColor[0] = 1.0 - ((1.0 - colorA[0]) * (1.0 - colorB[0] * factor));
outColor[1] = 1.0 - ((1.0 - colorA[1]) * (1.0 - colorB[1] * factor));
outColor[2] = 1.0 - ((1.0 - colorA[2]) * (1.0 - colorB[2] * factor));
outAlpha = 1.0 - ((1.0 - alphaA) * (1.0 - alphaB * factor));
} else if (operation == 5) {
outColor[0] = colorB[0] > 0.5 ? (2.0 * colorA[0] * colorB[0] * factor) + colorA[0] * (1.0 - factor) :
1.0 - ((1.0 - colorA[0]) * (1.0 - colorB[0] * factor)) * (2.0 - (1.0 - factor));
outColor[1] = colorB[1] > 0.5 ? (2.0 * colorA[1] * colorB[1] * factor) + colorA[1] * (1.0 - factor) :
1.0 - ((1.0 - colorA[1]) * (1.0 - colorB[1] * factor)) * (2.0 - (1.0 - factor));
outColor[2] = colorB[2] > 0.5 ? (2.0 * colorA[2] * colorB[2] * factor) + colorA[2] * (1.0 - factor) :
1.0 - ((1.0 - colorA[2]) * (1.0 - colorB[2] * factor)) * (2.0 - (1.0 - factor));
outAlpha = alphaB > 0.5 ? (2.0 * alphaA * alphaB * factor) + alphaA * (1.0 - factor) :
1.0 - ((1.0 - alphaA) * (1.0 - alphaB * factor)) * (2.0 - (1.0 - factor));
} else if (operation == 6) {
outColor[0] = abs(colorA[0] - (colorB[0] * factor));
outColor[1] = abs(colorA[1] - (colorB[1] * factor));
outColor[2] = abs(colorA[2] - (colorB[2] * factor));
outAlpha = abs(alphaA - (alphaB * factor));
} else if (operation == 7) {
outColor[0] = clamp(mix(colorA[0], colorA[0] / max(1.0 - colorB[0], 0.00001), factor), colorA[0], colorB[0]);
outColor[1] = clamp(mix(colorA[1], colorA[1] / max(1.0 - colorB[1], 0.00001), factor), colorA[1], colorB[1]);
outColor[2] = clamp(mix(colorA[2], colorA[2] / max(1.0 - colorB[2], 0.00001), factor), colorA[2], colorB[2]);
outAlpha = clamp(mix(alphaA, alphaA / max(1.0 - alphaB, 0.00001), factor), alphaA, alphaB);
} else if (operation == 8) {
outColor[0] = clamp(mix(colorA[0], 1.0 - (colorA[0] / max(1.0 - colorB[0], 0.00001)), factor), colorA[0], colorB[0]);
outColor[1] = clamp(mix(colorA[1], 1.0 - (colorA[1] / max(1.0 - colorB[1], 0.00001)), factor), colorA[1], colorB[1]);
outColor[2] = clamp(mix(colorA[2], 1.0 - (colorA[2] / max(1.0 - colorB[2], 0.00001)), factor), colorA[2], colorB[2]);
outAlpha = clamp(mix(alphaA, 1.0 - (alphaA / max(1.0 - alphaB, 0.00001)), factor), alphaA, alphaB);
}
}`,IZ=`void node_color_constant(vec3 inColor, float inAlpha, out vec3 outColor, out float outAlpha)
{
outColor = inColor;
outAlpha = inAlpha;
}`,LZ=`void node_color_correct(
bool colClamp, vec3 colClampMin, vec3 colClampMax,
bool alphaClamp, float alphaClampMin, float alphaClampMax,
bool unpremultInput, bool premultResult,
float alphaGain, float alphaGamma, float alphaOffset,
vec3 colGain, vec3 colGamma, vec3 colOffset, float hueShift,
float inAlpha, vec3 inColor, float satGain, float valGain,
out float outAlpha, out vec3 outColor)
{
outColor = unpremultInput ? inColor/inAlpha : inColor;
if (hueShift != 0.0 || satGain != 1.0 || valGain != 1.0) {
vec4 color = vec4(outColor, 1.0);
rgbToHSV(vec4(inColor, 1.0), color);
color.r += hueShift / 360.0;
if (color.r > 1.0)
color.r -= 1.0;
else if (color.r < 0.0)
color.r += 1.0;
color.g *= satGain;
color.b *= valGain;
hsvToRGB(color, color);
outColor = color.rgb;
}
outColor *= colGain;
outColor += colOffset;
if (any(notEqual(colGamma, vec3(1.0))))
outColor = pow(outColor, 1.0 / colGamma);
if (colClamp)
outColor = clamp(outColor, colClampMin, colClampMax);
outAlpha = inAlpha * alphaGain;
outAlpha += alphaOffset;
if (alphaGamma != 1.0)
outAlpha = pow(outAlpha, 1.0 / alphaGamma);
if (alphaClamp)
outAlpha = clamp(outAlpha, alphaClampMin, alphaClampMax);
if (premultResult)
outColor *= outAlpha;
}`,BZ=`void node_color_logic(
int operation,
vec3 colorA, vec3 colorB,
out bool outBool) {
if (operation == 0) {
outBool = all(equal(colorA, colorB));
} else if (operation == 1) {
outBool = any(notEqual(colorA, colorB));
} else if (operation == 2) {
outBool = ((colorA.x + colorA.y + colorA.z) < (colorB.x + colorB.y + colorB.z));
} else if (operation == 3) {
outBool = ((colorA.x + colorA.y + colorA.z) > (colorB.x + colorB.y + colorB.z));
} else if (operation == 4) {
outBool = ((colorA.x + colorA.y + colorA.z) <= (colorB.x + colorB.y + colorB.z));
} else {
outBool = ((colorA.x + colorA.y + colorA.z) >= (colorB.x + colorB.y + colorB.z));
}
}`,PZ=`void node_color_mask(
bool maskAlphaIsLuminance,
float inAlpha, vec3 inColor, vec3 mask, float maskAlpha,
out float outAlpha, out vec3 outColor) {
if (maskAlphaIsLuminance)
maskAlpha = 1.0 - dot(mask, LUM_WEIGHTS_MAYA);
outColor = inColor * (1.0 - maskAlpha);
}`,NZ=`void node_color_math(
int operation,
float alphaA, float alphaB, vec3 colorA, vec3 colorB,
out float outAlpha, out vec3 outColor) {
if (operation == 0) {
outColor = colorA + colorB;
outAlpha = alphaA + alphaB;
} else if (operation == 1) {
outColor = colorA - colorB;
outAlpha = alphaA - alphaB;
} else if (operation == 2) {
outColor = colorA * colorB;
outAlpha = alphaA * alphaB;
} else if (operation == 3) {
outColor = colorA / colorB;
outAlpha = alphaA / alphaB;
} else if (operation == 4) {
outColor = min(colorA, colorB);
outAlpha = min(alphaA, alphaB);
} else {
outColor = max(colorA, colorB);
outAlpha = max(alphaA, alphaB);
}
}`,DZ=`mat3 quatToMat3(vec4 quat) {
float x = quat.x,
y = quat.y,
z = quat.z,
w = quat.w;
float x2 = x + x;
float y2 = y + y;
float z2 = z + z;

float xx = x * x2;
float yx = y * x2;
float yy = y * y2;
float zx = z * x2;
float zy = z * y2;
float zz = z * z2;
float wx = w * x2;
float wy = w * y2;
float wz = w * z2;

mat3 mat;

mat[0][0] = 1.0 - yy - zz;
mat[1][0] = yx - wz;
mat[2][0] = zx + wy;

mat[0][1] = yx + wz;
mat[1][1] = 1.0 - xx - zz;
mat[2][1] = zy - wx;

mat[0][2] = zx - wy;
mat[1][2] = zy + wx;
mat[2][2] = 1.0 - xx - yy;
return mat;
}
void node_compose_matrix(
bool useEulerRotation, int inputRotateOrder,
vec4 inputQuat, vec3 inputRotate, vec3 inputScale, vec3 inputShear, vec3 inputTranslate,
out mat4 outputMatrix)
{
mat4 rotateMatrix;
inputRotate = radians(inputRotate);
if (useEulerRotation)
rotateMatrix = toMat4(mat3RotateX(inputRotate.x) * mat3RotateY(inputRotate.y) * mat3RotateZ(inputRotate.z));
else
rotateMatrix = toMat4(quatToMat3(normalize(inputQuat)));
mat4 scaleMatrix = mat4(inputScale.x, 0.0, 0.0, 0.0,
0.0, inputScale.y, 0.0, 0.0,
0.0, 0.0, inputScale.z, 0.0,
0.0, 0.0, 0.0, 1.0);
mat4 shearMatrix = mat4(1.0, 0.0, 0.0, 0.0,
inputShear.x, 1.0, 0.0, 0.0,
inputShear.y, inputShear.z, 1.0, 0.0,
0.0, 0.0, 0.0, 1.0);
mat4 transMatrix = mat4(1.0, 0.0, 0.0, 0.0,
0.0, 1.0, 0.0, 0.0,
0.0, 0.0, 1.0, 0.0,
inputTranslate.x, inputTranslate.y, inputTranslate.z, 1.0);
outputMatrix = scaleMatrix * shearMatrix * rotateMatrix * transMatrix;
}`,OZ=`void node_condition(
int operation,
vec3 colorIfFalse, vec3 colorIfTrue, float firstTerm, float secondTerm,
out vec3 outColor) {
if (operation == 0) {
if (firstTerm == secondTerm)
outColor = colorIfTrue;
else
outColor = colorIfFalse;
} else if (operation == 1) {
if (firstTerm != secondTerm)
outColor = colorIfTrue;
else
outColor = colorIfFalse;
} else if (operation == 2) {
if (firstTerm > secondTerm)
outColor = colorIfTrue;
else
outColor = colorIfFalse;
} else if (operation == 3) {
if (firstTerm >= secondTerm)
outColor = colorIfTrue;
else
outColor = colorIfFalse;
} else if (operation == 4) {
if (firstTerm < secondTerm)
outColor = colorIfTrue;
else
outColor = colorIfFalse;
} else if (operation == 5) {
if (firstTerm <= secondTerm)
outColor = colorIfTrue;
else
outColor = colorIfFalse;
}
}`,FZ=`vec4 mat3ToQuat(mat3 m) {
float trace = m[0][0] + m[1][1] + m[2][2];
vec4 q = vec4(0.0, 0.0, 0.0, 0.0);
if (trace > 0.0) {
float s = sqrt(trace + 1.0) * 2.0;
q.w = 0.25 * s;
q.x = (m[2][1] - m[1][2]) / s;
q.y = (m[0][2] - m[2][0]) / s;
q.z = (m[1][0] - m[0][1]) / s;
} else if ((m[0][0] > m[1][1]) && (m[0][0] > m[2][2])) {
float s = sqrt(1.0 + m[0][0] - m[1][1] - m[2][2]) * 2.0;
q.w = (m[2][1] - m[1][2]) / s;
q.x = 0.25 * s;
q.y = (m[0][1] + m[1][0]) / s;
q.z = (m[0][2] + m[2][0]) / s;
} else if (m[1][1] > m[2][2]) {
float s = sqrt(1.0 + m[1][1] - m[0][0] - m[2][2]) * 2.0;
q.w = (m[0][2] - m[2][0]) / s;
q.x = (m[0][1] + m[1][0]) / s;
q.y = 0.25 * s;
q.z = (m[1][2] + m[2][1]) / s;
} else {
float s = sqrt(1.0 + m[2][2] - m[0][0] - m[1][1]) * 2.0;
q.w = (m[1][0] - m[0][1]) / s;
q.x = (m[0][2] + m[2][0]) / s;
q.y = (m[1][2] + m[2][1]) / s;
q.z = 0.25 * s;
}
return q;
}
vec3 mat3ToEuler(mat3 m) {
float m11 = m[0][0], m12 = m[1][0], m13 = m[2][0];
float m21 = m[0][1], m22 = m[1][1], m23 = m[2][1];
float m31 = m[0][2], m32 = m[1][2], m33 = m[2][2];
vec3 euler;
euler.y = asin(clamp(m13, -1.0, 1.0));
if (abs(m13) < 0.9999999) {
euler.x = atan(-m23, m33);
euler.z = atan(-m12, m11);
} else {
euler.x = atan(m32, m22);
euler.z = 0.0;
}
return euler;
}
void decomposeMat4(mat4 m, out vec3 position, out vec4 quat, out vec3 euler, out vec3 scale) {
float sx = length(vec3(m[0][0], m[0][1], m[0][2]));
float sy = length(vec3(m[1][0], m[1][1], m[1][2]));
float sz = length(vec3(m[2][0], m[2][1], m[2][2]));
float det = mat3GetDeterminant(toMat3(m));
if (det < 0.0)
sx = -sx;
position.x = m[3][0];
position.y = m[3][1];
position.z = m[3][2];
float invSX = 1.0 / sx;
float invSY = 1.0 / sy;
float invSZ = 1.0 / sz;
m[0][0] *= invSX;
m[0][1] *= invSX;
m[0][2] *= invSX;
m[1][0] *= invSY;
m[1][1] *= invSY;
m[1][2] *= invSY;
m[2][0] *= invSZ;
m[2][1] *= invSZ;
m[2][2] *= invSZ;
quat = mat3ToQuat(toMat3(m));
euler = mat3ToEuler(toMat3(m));
scale.x = sx;
scale.y = sy;
scale.z = sz;
}
void node_decompose_matrix(
mat4 inputMatrix,
out vec4 outputQuat, out vec3 outputRotate, out vec3 outputScale, out vec3 outputShear, out vec3 outputTranslate)
{
decomposeMat4(inputMatrix, outputTranslate, outputQuat, outputRotate, outputScale);
outputShear = vec3(0.0, 0.0, 0.0);
}`,UZ=`void node_env_sphere(sampler2D envMap, int encoding, vec3 normal,
mat4 placementMatrix,
out float outAlpha, out vec3 outColor)
{
vec3 cameraToVertex = normalize(vWorldPosition - cameraPosition);
vec3 reflectVec;
#if WORLD_NODES
reflectVec = normalize(cameraToVertex);
#else
vec3 worldNormal = inverseTransformDirection(normal, viewMatrix);
reflectVec = reflect(cameraToVertex, worldNormal);
#endif
mat3 uvTransform = mat3(1.0);
reflectVec = toMat3(placementMatrix) * reflectVec;
vec4 tex = sampleEquirectangular(envMap, reflectVec, uvTransform, encoding);
outAlpha = tex.a;
outColor = tex.rgb;
}`,zZ=`void node_file(sampler2D ima, const int encoding, const bool rgbToAlpha,
vec2 uvCoord,
out float outAlpha, out vec3 outColor, out vec2 outSize, out vec3 outTransparency) {
vec2 uv = vec2(uvCoord.x, 1.0 - uvCoord.y);
vec4 tex = texture2D(ima, uv);
outColor = nodeTexelToLinear(tex, encoding).rgb;
if (rgbToAlpha)
outAlpha = dot(tex.rgb, LUM_WEIGHTS_MAYA);
else
outAlpha = tex.a;
outSize = vec2(0.0);
outTransparency = vec3(1.0 - outAlpha, 1.0 - outAlpha, 1.0 - outAlpha);
}`,VZ=`void node_float_condition(
bool condition, float floatA, float floatB, 
out float outFloat) {
outFloat = condition ? floatA : floatB;
}`,kZ=`void node_float_composite(int operation,
float floatA, float floatB, float factor,
out float outFloat)
{
if (factor <= 0.0) {
outFloat = floatA;
return;
}
if (operation == 0) {
outFloat = floatA + (floatB * factor);
} else if (operation == 1) {
outFloat = floatA + ((floatB - 1.0) * factor);
} else if (operation == 2) {
if (factor >= 1.0) {
outFloat = floatB;
return;
}
outFloat = mix(floatA, floatB, factor);
} else if (operation == 3) {
outFloat = floatA * (floatB * factor + (1.0 - factor));
} else if (operation == 4) {
outFloat = 1.0 - ((1.0 - floatA) * (1.0 - floatB * factor));
} else if (operation == 5) {
outFloat = floatB > 0.5 ? (2.0 * floatA * floatB * factor) + floatA * (1.0 - factor) :
1.0 - ((1.0 - floatA) * (1.0 - floatB * factor)) * (2.0 - (1.0 - factor));
} else if (operation == 6) {
outFloat = abs(floatA - (floatB * factor));
} else if (operation == 7) {
outFloat = clamp(mix(floatA, floatA / max(1.0 - floatB, 0.00001), factor), floatA, floatB);
} else if (operation == 8) {
outFloat = clamp(mix(floatA, 1.0 - (floatA / max(1.0 - floatB, 0.00001)), factor), floatA, floatB);
}
}`,GZ=`void node_float_constant(float value, out float outValue)
{
outValue = value;
}`,QZ=`void node_float_logic(
int operation,
float floatA, float floatB,
out bool outBool) {
if (operation == 0) {
outBool = (floatA == floatB);
} else if (operation == 1) {
outBool = (floatA != floatB);
} else if (operation == 2) {
outBool = (floatA < floatB);
} else if (operation == 3) {
outBool = (floatA > floatB);
} else if (operation == 4) {
outBool = (floatA <= floatB);
} else {
outBool = (floatA >= floatB);
}
}`,HZ=`void node_float_mask(
float inFloat, float mask,
out float outFloat) {
outFloat = inFloat - mask;
}`,WZ=`void node_float_math(
int operation,
float floatA, float floatB,
out float outFloat) {
if (operation == 0) {
outFloat = floatA + floatB;
} else if (operation == 1) {
outFloat = floatA - floatB;
} else if (operation == 2) {
outFloat = floatA * floatB;
} else if (operation == 3) {
outFloat = floatA / floatB;
} else if (operation == 4) {
outFloat = min(floatA, floatB);
} else if (operation == 5) {
outFloat = max(floatA, floatB);
} else {
outFloat = pow(floatA, floatB);
}
}`,YZ=`void node_four_by_four_matrix(
float in00, float in01, float in02, float in03,
float in10, float in11, float in12, float in13,
float in20, float in21, float in22, float in23,
float in30, float in31, float in32, float in33,
out mat4 outMatrix)
{
outMatrix = mat4(in00, in01, in02, in03,
in10, in11, in12, in13,
in20, in21, in22, in23,
in30, in31, in32, in33);
}`,jZ=`void node_gamma_correct(
vec3 gamma, vec3 value,
out vec3 outValue) {
outValue = pow(value, 1.0 / gamma);
}`,XZ=`void node_grid(
float contrast, vec3 fillerColor, vec3 lineColor, float uWidth, float vWidth, vec2 uvCoord,
out float outAlpha, out vec3 outColor) {
uvCoord = fract(uvCoord); 
float v0 = max(uvCoord.y, 0.5 * vWidth);
float v1 = min(uvCoord.y, 1.0 - 0.5 * vWidth);
float u0 = max(uvCoord.x, 0.5 * uWidth);
float u1 = min(uvCoord.x, 1.0 - 0.5 * uWidth);
float gridFactor = (v0 <= v1 && u0 <= u1) ? 1.0 : 0.0;
gridFactor = 0.5 - contrast * (gridFactor - 0.5);
gridFactor = max(gridFactor, 0.0);
vec3 gridColor = mix(fillerColor, lineColor, gridFactor); 
gridColor.r = max(gridColor.r, 0.0);
gridColor.g = max(gridColor.g, 0.0);
gridColor.b = max(gridColor.b, 0.0);
outAlpha = saturate(gridFactor); 
outColor = gridColor; 
}`,qZ=`
mat4 inverseMat4(mat4 m) {
float a00 = m[0][0], a01 = m[0][1], a02 = m[0][2], a03 = m[0][3],
a10 = m[1][0], a11 = m[1][1], a12 = m[1][2], a13 = m[1][3],
a20 = m[2][0], a21 = m[2][1], a22 = m[2][2], a23 = m[2][3],
a30 = m[3][0], a31 = m[3][1], a32 = m[3][2], a33 = m[3][3];
float b00 = a00 * a11 - a01 * a10,
b01 = a00 * a12 - a02 * a10,
b02 = a00 * a13 - a03 * a10,
b03 = a01 * a12 - a02 * a11,
b04 = a01 * a13 - a03 * a11,
b05 = a02 * a13 - a03 * a12,
b06 = a20 * a31 - a21 * a30,
b07 = a20 * a32 - a22 * a30,
b08 = a20 * a33 - a23 * a30,
b09 = a21 * a32 - a22 * a31,
b10 = a21 * a33 - a23 * a31,
b11 = a22 * a33 - a23 * a32;
float det = b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;
return mat4(a11 * b11 - a12 * b10 + a13 * b09,
a02 * b10 - a01 * b11 - a03 * b09,
a31 * b05 - a32 * b04 + a33 * b03,
a22 * b04 - a21 * b05 - a23 * b03,
a12 * b08 - a10 * b11 - a13 * b07,
a00 * b11 - a02 * b08 + a03 * b07,
a32 * b02 - a30 * b05 - a33 * b01,
a20 * b05 - a22 * b02 + a23 * b01,
a10 * b10 - a11 * b08 + a13 * b06,
a01 * b08 - a00 * b10 - a03 * b06,
a30 * b04 - a31 * b02 + a33 * b00,
a21 * b02 - a20 * b04 - a23 * b00,
a11 * b07 - a10 * b09 - a12 * b06,
a00 * b09 - a01 * b07 + a02 * b06,
a31 * b01 - a30 * b03 - a32 * b00,
a20 * b03 - a21 * b01 + a22 * b00) / det;
}
void node_inverse_matrix(
mat4 inputMatrix,
out mat4 outputMatrix)
{
outputMatrix = inverseMat4(inputMatrix);
}`,ZZ=`void node_lambert(
vec3 geometryNormal,
vec3 color, vec3 ambientColor, vec3 incandescence, float matteOpacity,
float diffuse, vec3 normal, float translucence, vec3 transparency,
out vec4 outColor) {
NodeMaterial material;
material.diffuseColor = diffuse * color.rgb;
ReflectedLight reflectedLight = ReflectedLight(vec3(0.0), vec3(0.0), vec3(0.0), vec3(0.0));
#ifdef USE_CLEARCOAT
#undef USE_CLEARCOAT
#define _CLEARCOAT_RESTORE
#endif
#define RE_Direct RE_DirectDiffuseOnly_Node
#define RE_IndirectDiffuse RE_IndirectDiffuse_Node
#include <lights_fragment_begin>
#include <lights_fragment_maps>
#include <lights_fragment_end>
#undef RE_Direct
#undef RE_IndirectDiffuse
#ifdef _CLEARCOAT_RESTORE
#undef _CLEARCOAT_RESTORE
#define USE_CLEARCOAT
#endif
float alpha = 1.0 - average(transparency);
outColor = vec4(reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + incandescence, alpha);
}`,KZ=`#define LAYER_BLEND_MODE_NONE 0.0
#define LAYER_BLEND_MODE_OVER 1.0
#define LAYER_BLEND_MODE_IN 2.0
#define LAYER_BLEND_MODE_OUT 3.0
#define LAYER_BLEND_MODE_ADD 4.0
#define LAYER_BLEND_MODE_SUBTRACT 5.0
#define LAYER_BLEND_MODE_MULTIPLY 6.0
#define LAYER_BLEND_MODE_DIFFERENCE 7.0
#define LAYER_BLEND_MODE_LIGHTEN 8.0
#define LAYER_BLEND_MODE_DARKEN 9.0
#define LAYER_BLEND_MODE_SATURATE 10.0
#define LAYER_BLEND_MODE_DESATURATE 11.0
#define LAYER_BLEND_MODE_ILLUMINATE 12.0
void node_layered_texture_layer(
const float alphaBG, const vec3 colorBG, 
const vec3 color, const float alpha, const float blendMode, const bool isVisible,
out float outAlpha, out vec3 outColor)
{
outAlpha = alphaBG;
outColor = colorBG;
if (!isVisible)
return;
if (blendMode == LAYER_BLEND_MODE_NONE) {
outColor = color;
} else if (blendMode == LAYER_BLEND_MODE_OVER) {
outColor = mix(colorBG, color, alpha);
} else if (blendMode == LAYER_BLEND_MODE_IN) {
outColor = alpha * colorBG;
} else if (blendMode == LAYER_BLEND_MODE_OUT) {
outColor = (1.0 - alpha) * colorBG;
} else if (blendMode == LAYER_BLEND_MODE_ADD) {
outColor = mix(colorBG, colorBG + color, alpha);
} else if (blendMode == LAYER_BLEND_MODE_SUBTRACT) {
outColor = mix(colorBG, colorBG - color, alpha);
} else if (blendMode == LAYER_BLEND_MODE_MULTIPLY) {
outColor = mix(colorBG, colorBG * color, alpha);
} else {
outColor = mix(colorBG, color, alpha);
}
}`,$Z=`void node_luminance(
vec3 value,
out float outValue) {
outValue = dot(value, LUM_WEIGHTS_MAYA);
}`,JZ=`void node_multiply_divide(
int operation,
vec3 input1, vec3 input2,
out vec3 outValue) {
if (operation == 0) {
outValue = input1;
} else if (operation == 1) {
outValue = input1 * input2;
} else if (operation == 2) {

outValue = input1 / input2;
} else {
outValue = pow(input1, input2);
}
}`,eK=`void node_mult_double_linear(
float input1, float input2,
out float outValue) {
outValue = input1 * input2;
}`,tK=`
void node_mult_matrix(
mat4 matrixIn1,
out mat4 matrixSum)
{
matrixSum = matrixIn1;
}
void node_mult_matrix(
mat4 matrixIn1, mat4 matrixIn2,
out mat4 matrixSum)
{
matrixSum = matrixIn2 * matrixIn1;
}
void node_mult_matrix(
mat4 matrixIn1, mat4 matrixIn2, mat4 matrixIn3,
out mat4 matrixSum)
{
matrixSum = matrixIn3 * matrixIn2 * matrixIn1;
}`,nK=`vec2 calcNoiseImplode(float implode, vec2 implodeCenter, vec2 uv) {
if (abs(implode) >= EPSILON) {
uv -= implodeCenter;
float len = length(uv);
if (len > EPSILON) {
float factor = pow(len, 1.0-implode) / len;
uv *= factor;
}
uv += implodeCenter;
}
return uv;
}
void node_noise(
float amplitude, int depthMax, float frequency, float frequencyRatio, float implode,
vec2 implodeCenter, bool inflection, float ratio, float threshold, float time, vec2 uvCoord,
out float outAlpha, out vec3 outColor) {
uvCoord = calcNoiseImplode(implode, implodeCenter, uvCoord);
frequency *= 0.6;
amplitude *= 0.9;
uvCoord *= frequency;
float noiseAccum = 0.0;
vec2 freqOffset = vec2(0.02, 0.3);
#if __VERSION__ == 300
for (int depthId = 0; depthId < depthMax; depthId++) {
#else
for (int depthId = 0; depthId < 3; depthId++) {
#endif
int stepVal = depthId;
float noise = noisePerlin(vec3(uvCoord + freqOffset, time + 0.5 * float(stepVal)));
if (inflection)
noise = abs(noise);
noiseAccum += amplitude * noise;
uvCoord *= frequencyRatio;
time *= sqrt(frequencyRatio);
amplitude *= ratio;
freqOffset += vec2(0.02, 0.3);
}
if (!inflection)
noiseAccum = 0.5 * noiseAccum + 0.5;
noiseAccum += threshold;
outAlpha = min(1.0, noiseAccum);
outColor = vec3(outAlpha, outAlpha, outAlpha);
}`,rK=`void node_openpbr_surface(
vec3 geometryNormal, const bool thinWalled,
const float baseWeight, const vec3 baseColor, const float baseDiffuseRoughness, const float baseMetalness,
const float specularWeight, const vec3 specularColor, const float specularRoughness, const float specularIOR,
const float transmissionWeight, const vec3 transmissionColor,
const float transmissionDepth, const vec3 transmissionScatter,
const float fuzzWeight, const vec3 fuzzColor, const float fuzzRoughness,
const float coatWeight, const vec3 coatColor, const float coatRoughness,
const float emissionLuminance, const vec3 emissionColor, const float geometryOpacity,
const vec3 normal,
out vec4 outColor)
{
NodeMaterial material;
vec3 baseColorWeighted = baseWeight * baseColor.rgb;
material.diffuseColor = baseColorWeighted * (1.0 - baseMetalness) * (1.0 - transmissionWeight);
vec3 clearcoatNormal = normal;
#ifdef USE_CLEARCOAT
material.clearcoat = saturate(coatWeight);
material.clearcoatRoughness = clamp(coatRoughness, 0.0, 1.0);
material.clearcoatF0 = vec3(0.04);
material.clearcoatF90 = 1.0;
#endif
#ifdef USE_SHEEN
material.sheenColor = saturate(fuzzWeight * fuzzColor);
material.sheenRoughness = clamp(fuzzRoughness, 0.0, 1.0);
#endif
vec3 dxy = max(abs(dFdx(geometryNormal)), abs(dFdy(geometryNormal)));
float geometryRoughness = max(max(dxy.x, dxy.y), dxy.z);
material.roughness = max(specularRoughness, 0.0525);
material.roughness += geometryRoughness;
material.roughness = min(material.roughness, 1.0);
vec3 specularColorWeighted = specularWeight * specularColor;
vec3 dielRefl = pow2((1.0 - specularIOR) / (1.0 + specularIOR)) * specularColorWeighted;
material.specularColor = mix(dielRefl, baseColorWeighted, baseMetalness);
material.fresnelRefl90 = mix(specularColorWeighted, vec3(1.0), baseMetalness);
material.specularF90 = average(material.fresnelRefl90);
material.refractionColor = pow(transmissionWeight * (1.0 - baseMetalness) * transmissionColor.rgb, vec3(2.0));
material.refractionIOR = specularIOR;
material.refractionRoughness = material.roughness;
ReflectedLight reflectedLight = ReflectedLight(vec3(0.0), vec3(0.0), vec3(0.0), vec3(0.0));
vec3 refractedLight = vec3(0.0);
#ifdef USE_GTAO
vec4 gtaoVisibilityBentNormal = texture2D(gtaoMap,
gl_FragCoord.xy / currResolution);
vec3 bentNormal = normalize(unpackRGBToNormal(gtaoVisibilityBentNormal.gba));
#define PROBE_NORMAL bentNormal
#endif
#define RE_Direct RE_Direct_Node
#define RE_IndirectDiffuse RE_IndirectDiffuse_Node
#define RE_IndirectSpecular RE_IndirectSpecular_Node
#define RE_Refraction RE_Refraction_Node
#include <lights_fragment_begin>
#include <lights_fragment_maps>
#include <lights_fragment_end>
#undef RE_Direct
#undef RE_IndirectDiffuse
#undef RE_IndirectSpecular
#undef RE_Refraction
#ifdef PROBE_NORMAL
#undef PROBE_NORMAL
#endif
#ifdef USE_GTAO
reflectedLight.indirectDiffuse *= gtaoVisibilityBentNormal.r;
float gtaoVisibility = gtaoVisibilityBentNormal.r;
vec3 gtaoBentNormal = bentNormal;
vec3 gtaoViewDir = geometry.viewDir;
vec3 gtaoNormal = normal;
float gtaoRoughness = material.roughness;
#endif
#include <lights_fragment_gtso>
vec3 totalEmissiveRadiance = emissionLuminance * OPENPBR_EMISSION_LUM_FACTOR * emissionColor;
vec3 outSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
vec3 outColor3 = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse +
outSpecular + totalEmissiveRadiance;
#ifdef USE_SHEEN
float sheenEnergyComp = 1.0 - 0.157 * max3(material.sheenColor);
outColor3 = outColor3 * sheenEnergyComp + sheenSpecular;
#endif
#ifdef USE_CLEARCOAT
float dotNVcc = saturate(dot(geometry.normal, geometry.viewDir));
vec3 Fcc = F_Schlick(material.clearcoatF0, material.clearcoatF90, dotNVcc);
outColor3 = outColor3 * (1.0 - material.clearcoat * Fcc) + clearcoatSpecular * material.clearcoat;
#endif
float alpha = 1.0;
if (thinWalled) {
alpha = geometryOpacity * (1.0 - saturate(transmissionWeight) + maxFromRGB(outSpecular) * saturate(transmissionWeight));
} else {
outColor3 += refractedLight;
}
outColor = vec4(outColor3, saturate(alpha));
}`,oK=`void node_output(vec4 rgb, out vec4 outgoingLight)
{
outgoingLight = rgb;
}`,aK=`void node_phong(
vec3 geometryNormal,
vec3 color, vec3 ambientColor, vec3 incandescence, float matteOpacity,
float diffuse, vec3 normal, float reflectivity, vec3 reflectedColor,
float cosinePower, vec3 specularColor, float translucence, vec3 transparency,
out vec4 outColor) {
NodeMaterial material;
material.diffuseColor = diffuse * color;
#ifdef USE_CLEARCOAT
#undef USE_CLEARCOAT
#define _CLEARCOAT_RESTORE
#endif
vec3 dxy = max(abs(dFdx(geometryNormal)), abs(dFdy(geometryNormal)));
float geometryRoughness = max(max(dxy.x, dxy.y), dxy.z);
float roughness = sqrt(1.0 / (0.454 * cosinePower + 3.357));
material.roughness = max(roughness, 0.0525);
material.roughness += geometryRoughness;
material.roughness = min(material.roughness, 1.0);
material.specularColor = specularColor;
ReflectedLight reflectedLight = ReflectedLight(vec3(0.0), vec3(0.0), vec3(0.0), vec3(0.0));
#define RE_Direct RE_Direct_Node
#define RE_IndirectDiffuse RE_IndirectDiffuse_Node
#define RE_IndirectSpecular RE_IndirectSpecular_Node
#include <lights_fragment_begin>
#include <lights_fragment_maps>
#include <lights_fragment_end>
#undef RE_Direct
#undef RE_IndirectDiffuse
#undef RE_IndirectSpecular
#ifdef _CLEARCOAT_RESTORE
#undef _CLEARCOAT_RESTORE
#define USE_CLEARCOAT
#endif
float alpha = 1.0 - average(transparency);
outColor = vec4(reflectedLight.directDiffuse + reflectedLight.indirectDiffuse +
reflectedLight.directSpecular + reflectedLight.indirectSpecular + incandescence, alpha);
}`,iK=`void node_phong_e(
vec3 geometryNormal,
vec3 color, vec3 ambientColor, vec3 incandescence, float matteOpacity,
float diffuse, vec3 normal, float reflectivity, vec3 reflectedColor,
float highlightSize, float roughness, vec3 specularColor, float translucence, vec3 transparency,
out vec4 outColor) {
NodeMaterial material;
material.diffuseColor = diffuse * color;
#ifdef USE_CLEARCOAT
#undef USE_CLEARCOAT
#define _CLEARCOAT_RESTORE
#endif
vec3 dxy = max(abs(dFdx(geometryNormal)), abs(dFdy(geometryNormal)));
float geometryRoughness = max(max(dxy.x, dxy.y), dxy.z);
material.roughness = max(roughness, 0.0525);
material.roughness += geometryRoughness;
material.roughness = min(material.roughness, 1.0);
material.specularColor = specularColor;
ReflectedLight reflectedLight = ReflectedLight(vec3(0.0), vec3(0.0), vec3(0.0), vec3(0.0));
#define RE_Direct RE_Direct_Node
#define RE_IndirectDiffuse RE_IndirectDiffuse_Node
#define RE_IndirectSpecular RE_IndirectSpecular_Node
#include <lights_fragment_begin>
#include <lights_fragment_maps>
#include <lights_fragment_end>
#undef RE_Direct
#undef RE_IndirectDiffuse
#undef RE_IndirectSpecular
#ifdef _CLEARCOAT_RESTORE
#undef _CLEARCOAT_RESTORE
#define USE_CLEARCOAT
#endif
float alpha = 1.0 - average(transparency);
outColor = vec4(reflectedLight.directDiffuse + reflectedLight.indirectDiffuse +
reflectedLight.directSpecular + reflectedLight.indirectSpecular + incandescence, alpha);
}`,sK=`void node_place_2d_texture(const vec2 inUv,
vec2 offset, vec2 repeatUv, float rotateUv,
out vec2 outUv)
{
outUv = (calcUvTransform(offset.x, offset.y, repeatUv.x, repeatUv.y, rotateUv) * vec3(inUv, 1.0)).xy;
outUv.y = 1.0 - outUv.y;
}`,lK=`void node_premultiply(
float inAlpha, vec3 inColor,
out float outAlpha, out vec3 outColor) {
outColor = inColor * inAlpha;
outAlpha = inAlpha;
}`,cK=`#define RAMP_WRAP_REPEAT 1000
#define RAMP_WRAP_CLAMP_TO_EDGE 1001
#define RAMP_WRAP_MIRROR 1002
float applyWrap(float coord, int wrap) {
if (coord < 0.0 || coord > 1.0) {
if (wrap == RAMP_WRAP_REPEAT)
coord = mod(coord, 1.0);
else if (wrap == RAMP_WRAP_CLAMP_TO_EDGE)
coord = clamp(coord, 0.0, 1.0);
else if (wrap == RAMP_WRAP_MIRROR) {
if (mod(floor(coord), 2.0) == 0.0)
coord = coord - floor(coord);
else
coord = 1.0 - (coord - floor(coord));
}
}
return coord;
}
void node_ramp(
sampler2D rampData, int rampType, int wrapU, int wrapV,
vec2 uvCoord,
out float outAlpha, out vec3 outColor)
{
uvCoord.x = applyWrap(uvCoord.x, wrapU);
uvCoord.y = applyWrap(uvCoord.y, wrapV);
float coord;
if (rampType == 0) {
coord = uvCoord.y;
} else if (rampType == 1) {
coord = uvCoord.x;
} else if (rampType == 2) {
coord = abs(uvCoord.x + uvCoord.y) / 2.0;
} else if (rampType == 3) {
vec2 uvSpiral = mat2(0.0, 1.0, 1.0, 0.0) * (uvCoord - vec2(0.5));
coord = atan(uvSpiral.y, uvSpiral.x) / PI2 + 0.5;
} else if (rampType == 4) {
coord = length(uvCoord - vec2(0.5)) * sqrt(2.0);
} else if (rampType == 5) {
vec2 boxUv = abs(uvCoord - vec2(0.5)) * 2.0;
coord = max(boxUv.x, boxUv.y);
} else if (rampType == 6) {
uvCoord = abs((uvCoord - vec2(0.5)) * 2.0);
coord = uvCoord.y;
} else if (rampType == 7) {
coord = uvCoord.y;
} else {
coord = uvCoord.y;
}
float offset = 0.5 / float(RAMP_TEX_SIZE);
float scale = 1.0 - (1.0 / float(RAMP_TEX_SIZE));
coord = coord * scale + offset;
vec4 tex = texture2D(rampData, vec2(coord, 0.0));
outAlpha = average(tex.xyz);
outColor = tex.xyz;
}`,uK=`void node_remap_hsv(vec3 color, out vec3 outColor)
{
outColor = color;
}`,dK=`void node_reverse(
vec3 inValue,
out vec3 outValue) {
outValue = 1.0 - inValue;
}`,fK=`void node_sampler_info(
float frontFacing, vec4 tangent, vec2 uv,
vec3 viewNorm,
out float facingRatio, out bool flippedNormal, out mat4 matrixEyeToWorld,
out vec3 normalCamera, out vec2 pixelCenter, out vec3 pointCamera,
out vec3 pointObj, out vec3 pointWorld,
out vec3 tangentUCamera, out vec3 tangentVCamera, out vec2 uvCoord)
{
vec4 worldPos = invViewMatrix * vec4(-vViewPosition, 1.0);
facingRatio = dot(normalize(viewNorm), normalize(vViewPosition));
flippedNormal = (frontFacing > 0.0);
matrixEyeToWorld = invViewMatrix;
normalCamera = viewNorm;
pixelCenter = vec2(1.0);
pointCamera = -vViewPosition;
pointObj = (invModelMatrix * worldPos).xyz;
pointWorld = worldPos.xyz;
tangentUCamera = normalize((modelViewMatrix * vec4(tangent.xyz, 0.0)).xyz);
tangentVCamera = tangent.w * cross(viewNorm, tangentUCamera);
uvCoord = vec2(uv.x, 1.0-uv.y);
}`,hK=`void node_set_range(
vec3 maxValue, vec3 minValue, vec3 oldMax, vec3 oldMin, vec3 value,
out vec3 outValue) {
outValue = minValue + (((value - oldMin) / (oldMax - oldMin)) * (maxValue - minValue));
}`,pK=`void node_shading_engine(vec4 surface, vec4 volume, vec3 displacement, out vec4 outgoingLight) {
outgoingLight = surface + volume;
}`,mK=`#define COORD_WORLD_SPACE 0
#define COORD_OBJECT_SPACE 1
void node_sub_transform(
const int coordSpace,
vec3 scale, vec3 rotate, vec3 offset,
out vec3 outVector, out vec3 outNormal)
{
vec3 norm = vNormal;
norm = (invViewMatrix * vec4(norm, 0.0)).xyz;
vec3 vector = vWorldPosition.xyz;
if (coordSpace == COORD_OBJECT_SPACE) {
vector = (invModelMatrix * vec4(vector, 1.0)).xyz;
norm = (invModelMatrix * vec4(norm, 0.0)).xyz;
}
vector -= offset;
vector *= scale;
mat3 rotX = mat3RotateX(radians(rotate.x));
mat3 rotY = mat3RotateY(radians(-rotate.y));
mat3 rotZ = mat3RotateZ(radians(rotate.z));
mat3 rotMat = rotX * rotY * rotZ;
vector = rotMat * vector;
norm = rotMat * norm;
outVector = vector;
outNormal = normalize(norm);
}`,gK=`void node_surface_shader(
vec3 color, vec3 glowColor, vec3 matteOpacity, vec3 transparency,
out vec3 outColor, out vec3 outGlowColor, out vec3 outMatteOpacity, out vec3 outTransparency)
{
outColor = color;
outGlowColor = glowColor;
outMatteOpacity = matteOpacity;
outTransparency = transparency;
}`,vK=`void node_transform(
out vec3 center, out mat4 inverseMatrix, out mat4 matrix,
out mat4 parentInverseMatrix, out mat4 parentMatrix, out mat4 worldInverseMatrix,
out mat4 worldMatrix, out mat4 xformMatrix)
{
center = modelMatrix[3].xyz;
inverseMatrix = invModelMatrix;
matrix = modelMatrix;
parentInverseMatrix = mat4(1.0);
parentMatrix = mat4(1.0);
worldInverseMatrix = invModelMatrix;
worldMatrix = modelMatrix;
xformMatrix = matrix;
}`,_K=`mat4 transposeMat4(mat4 m) {
return mat4(vec4(m[0].x, m[1].x, m[2].x, m[3].x),
vec4(m[0].y, m[1].y, m[2].y, m[3].y),
vec4(m[0].z, m[1].z, m[2].z, m[3].z),
vec4(m[0].w, m[1].w, m[2].w, m[3].w));
}
void node_transpose_matrix(
mat4 inputMatrix,
out mat4 outputMatrix)
{
outputMatrix = transposeMat4(inputMatrix);
}`,AK=`void node_unit_conversion(float conversionFactor, float inInput, out float outOutput)
{
outOutput = conversionFactor * inInput;
}
void node_unit_conversion(float conversionFactor, vec3 inInput, out vec3 outOutput)
{
outOutput = conversionFactor * inInput;
}`,xK=`void node_unpremultiply(
float inAlpha, vec3 inColor,
out float outAlpha, out vec3 outColor) {
outColor = inColor / inAlpha;
outAlpha = inAlpha;
}`,yK=`void node_vector_product(
const int operation, const bool normalizeOutput,
vec3 input1, vec3 input2, mat4 matrix,
out vec3 outVector) {
if (operation == 0) {
outVector = input1;
} else if (operation == 1) {
if (normalizeOutput) {
input1 = normalize(input1);
input2 = normalize(input2);
}
outVector = vec3(dot(input1, input2));
} else if (operation == 2) {
outVector = cross(input1, input2);
} else if (operation == 3) {
outVector = (matrix * vec4(input1, 0.0)).xyz;
} else {
outVector = (matrix * vec4(input1, 1.0)).xyz;
}

if (operation > 1 && normalizeOutput)
outVector = normalize(outVector);
}`,bK=`void node_wt_add_matrix(
mat4 matrixIn1, float weightIn1,
out mat4 matrixSum)
{
matrixSum = weightIn1 * matrixIn1;
}
void node_wt_add_matrix(
mat4 matrixIn1, float weightIn1, mat4 matrixIn2, float weightIn2,
out mat4 matrixSum)
{
matrixSum = weightIn1 * matrixIn1 + weightIn2 * matrixIn2;
}
void node_wt_add_matrix(
mat4 matrixIn1, float weightIn1, mat4 matrixIn2, float weightIn2, mat4 matrixIn3, float weightIn3,
out mat4 matrixSum)
{
matrixSum = weightIn1 * matrixIn1 + weightIn2 * matrixIn2 + weightIn3 * matrixIn3;
}`,SK=`varying vec2 vUv;
void main() {
vUv = uv;
gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
}`,CK=`varying vec2 vUv;
uniform sampler2D tRGBABuffer;
uniform sampler2D tFloatBuffer;
void main() {
vec4 color = texture2D(tRGBABuffer, vUv);
vec3 colorSum = color.rgb;
float alphaProduct = color.a;
float alphaSum = texture2D(tFloatBuffer, vUv).r;
gl_FragColor = vec4(colorSum.rgb / max(alphaSum, 1e-5), 1.0 - alphaProduct);
}`,EK=`uniform float damp;
uniform sampler2D tOld;
uniform sampler2D tNew;
varying vec2 vUv;
vec4 when_gt(vec4 x, float y) {
return max(sign(x - y), 0.0);
}
void main() {
vec4 texelOld = texture2D(tOld, vUv);
vec4 texelNew = texture2D(tNew, vUv);

texelOld *= damp * when_gt(texelOld, 0.1);
gl_FragColor = max(texelNew, texelOld);
}`,MK=`varying vec2 vUv;
uniform sampler2D blurTexture1;
uniform sampler2D blurTexture2;
uniform sampler2D blurTexture3;
uniform sampler2D blurTexture4;
uniform sampler2D blurTexture5;
uniform sampler2D dirtTexture;
uniform float bloomStrength;
uniform float bloomRadius;
uniform float bloomFactors[NUM_MIPS];
uniform vec3 bloomTintColors[NUM_MIPS];
float lerpBloomFactor(const in float factor) {
float mirrorFactor = 1.2 - factor;
return mix(factor, mirrorFactor, bloomRadius);
}
void main() {
gl_FragColor = bloomStrength * (
lerpBloomFactor(bloomFactors[0]) * vec4(bloomTintColors[0], 1.0) * texture2D(blurTexture1, vUv) +
lerpBloomFactor(bloomFactors[1]) * vec4(bloomTintColors[1], 1.0) * texture2D(blurTexture2, vUv) +
lerpBloomFactor(bloomFactors[2]) * vec4(bloomTintColors[2], 1.0) * texture2D(blurTexture3, vUv) +
lerpBloomFactor(bloomFactors[3]) * vec4(bloomTintColors[3], 1.0) * texture2D(blurTexture4, vUv) +
lerpBloomFactor(bloomFactors[4]) * vec4(bloomTintColors[4], 1.0) * texture2D(blurTexture5, vUv)
);
}`,wK=`uniform sampler2D tDiffuse;
uniform vec3 defaultColor;
uniform float defaultOpacity;
uniform float luminosityThreshold;
uniform float smoothWidth;
varying vec2 vUv;
void main() {
vec4 texel = texture2D(tDiffuse, vUv);
vec3 luma = vec3(0.299, 0.587, 0.114);
float v = dot(texel.xyz, luma);
vec4 outputColor = vec4(defaultColor.rgb, defaultOpacity);
float alpha = smoothstep(luminosityThreshold, luminosityThreshold + smoothWidth, v);
gl_FragColor = mix(outputColor, texel, alpha);
gl_FragColor = clamp(gl_FragColor, 0.0, 10.0);
}`,TK=`#include <common>
varying vec2 vUv;
uniform sampler2D colorTexture;
uniform vec2 texSize;
uniform vec2 direction;
float gaussianPdf(in float x, in float sigma) {
return 0.39894 * exp(-0.5 * x * x/(sigma * sigma)) / sigma;
}
void main() {
vec2 invSize = 1.0 / texSize;
float fSigma = float(SIGMA);
float weightSum = gaussianPdf(0.0, fSigma);
vec3 diffuseSum = texture2D(colorTexture, vUv).rgb * weightSum;
for (int i = 1; i < KERNEL_RADIUS; i++) {
float x = float(i);
float w = gaussianPdf(x, fSigma);
vec2 uvOffset = direction * invSize * x;
vec3 sample1 = texture2D(colorTexture, vUv + uvOffset).rgb;
vec3 sample2 = texture2D(colorTexture, vUv - uvOffset).rgb;
diffuseSum += (sample1 + sample2) * w;
weightSum += 2.0 * w;
}
gl_FragColor = vec4(diffuseSum/weightSum, 1.0);
}`,RK=`#include <common>
varying vec2 vUv;
uniform sampler2D colorTexture;
uniform vec2 texSize;
uniform vec2 direction;
uniform float kernelRadius;
float gaussianPdf(in float x, in float sigma) {
return 0.39894 * exp(-0.5 * x * x/(sigma * sigma))/sigma;
}
void main() {
vec2 invSize = 1.0 / texSize;
float weightSum = gaussianPdf(0.0, kernelRadius);
#if LOG_SPACE == 1
float origDiffuse = texture2D(colorTexture, vUv).r;
float diffuseSum = weightSum;
#else
float diffuseSum = texture2D(colorTexture, vUv).r * weightSum;
#endif
vec2 delta = direction * invSize * kernelRadius/float(MAX_SAMPLE_RADIUS);
vec2 uvOffset = delta;
#if OCTAHEDRAL_MAP == 1
vec3 cubeDir = normalize(octUVToCubeVec(vUv, invSize));
vec3 dirX = normalize(abs(cubeDir.y) < 0.99999 ? vec3(cubeDir.z, 0.0, -cubeDir.x)
: vec3(0.0, -cubeDir.z, cubeDir.y));
vec3 dirY = cross(cubeDir, dirX);
#endif
#pragma unroll_loop
for (int i = 1; i <= MAX_SAMPLE_RADIUS; i++) {
float w = gaussianPdf(uvOffset.x, kernelRadius);
#if OCTAHEDRAL_MAP == 1
vec3 cubeOffset = uvOffset.x * dirX + uvOffset.y * dirY;
vec2 uv1 = cubeVecToOctUV(cubeDir + cubeOffset, invSize);
vec2 uv2 = cubeVecToOctUV(cubeDir - cubeOffset, invSize);
#else
vec2 uv1 = vUv + uvOffset;
vec2 uv2 = vUv - uvOffset;
#endif
float sample1 = texture2D(colorTexture, uv1).r;
float sample2 = texture2D(colorTexture, uv2).r;
#if LOG_SPACE == 1
diffuseSum += (
clamp(exp(sample1 - origDiffuse), 0.0, 1e38) +
clamp(exp(sample2 - origDiffuse), 0.0, 1e38)
) * w;
#else
diffuseSum += ((sample1 + sample2) * w);
#endif
weightSum += 2.0 * w;
uvOffset += delta;
}
#if LOG_SPACE == 1
gl_FragColor = vec4(origDiffuse + log(diffuseSum/weightSum), 0.0, 0.0, 1.0);
#else
gl_FragColor = vec4(diffuseSum/weightSum, 0.0, 0.0, 1.0);
#endif
}`,IK=`#include <common>
varying vec2 vUv;
uniform sampler2D tColor;
uniform sampler2D tDepth;
uniform float maxblur;
uniform float aperture;
uniform float nearClip;
uniform float farClip;
uniform float focus;
uniform float aspect;
uniform float depthLeakThreshold;
#include <packing>
float getDepth(const in vec2 screenPosition) {
#if DEPTH_PACKING == 1
return unpackRGBAToDepth(texture2D(tDepth, screenPosition));
#else
return texture2D(tDepth, screenPosition).x;
#endif
}
float getViewZ(const in float depth) {
#if PERSPECTIVE_CAMERA == 1
return perspectiveDepthToViewZ(depth, nearClip, farClip);
#else
return orthoDepthToViewZ(depth, nearClip, farClip);
#endif
}
vec4 blurSample(vec2 uvOffset, vec4 centerCol, float viewZCenter) {
float viewZ = -getViewZ(getDepth(vUv + uvOffset));
float blurFactor = (viewZ >= viewZCenter) ? 1.0 : 
min(depthLeakThreshold * abs((focus - viewZ) / aperture), 1.0);
return mix(centerCol, texture2D(tColor, vUv + uvOffset), blurFactor);
}
void main() {
vec2 aspectcorrect = vec2(1.0, aspect);
float viewZ = -getViewZ(getDepth(vUv));
float factor = abs(focus - viewZ);

float dofblur = maxblur * min(factor / aperture, 1.0);
float dofblur9 = dofblur * 0.9;
float dofblur7 = dofblur * 0.7;
float dofblur4 = dofblur * 0.4;
vec4 centerCol = texture2D(tColor, vUv);
vec4 col = centerCol;
col += blurSample((vec2( 0.0, 0.4 ) * aspectcorrect) * dofblur, centerCol, viewZ);
col += blurSample((vec2( 0.15, 0.37) * aspectcorrect) * dofblur, centerCol, viewZ);
col += blurSample((vec2( 0.29, 0.29) * aspectcorrect) * dofblur, centerCol, viewZ);
col += blurSample((vec2(-0.37, 0.15) * aspectcorrect) * dofblur, centerCol, viewZ);
col += blurSample((vec2( 0.40, 0.0 ) * aspectcorrect) * dofblur, centerCol, viewZ);
col += blurSample((vec2( 0.37, -0.15) * aspectcorrect) * dofblur, centerCol, viewZ);
col += blurSample((vec2( 0.29, -0.29) * aspectcorrect) * dofblur, centerCol, viewZ);
col += blurSample((vec2(-0.15, -0.37) * aspectcorrect) * dofblur, centerCol, viewZ);
col += blurSample((vec2( 0.0, -0.4 ) * aspectcorrect) * dofblur, centerCol, viewZ);
col += blurSample((vec2(-0.15, 0.37) * aspectcorrect) * dofblur, centerCol, viewZ);
col += blurSample((vec2(-0.29, 0.29) * aspectcorrect) * dofblur, centerCol, viewZ);
col += blurSample((vec2( 0.37, 0.15) * aspectcorrect) * dofblur, centerCol, viewZ);
col += blurSample((vec2(-0.4, 0.0 ) * aspectcorrect) * dofblur, centerCol, viewZ);
col += blurSample((vec2(-0.37, -0.15) * aspectcorrect) * dofblur, centerCol, viewZ);
col += blurSample((vec2(-0.29, -0.29) * aspectcorrect) * dofblur, centerCol, viewZ);
col += blurSample((vec2( 0.15, -0.37) * aspectcorrect) * dofblur, centerCol, viewZ);

col += blurSample((vec2( 0.15, 0.37) * aspectcorrect) * dofblur9, centerCol, viewZ);
col += blurSample((vec2(-0.37, 0.15) * aspectcorrect) * dofblur9, centerCol, viewZ);
col += blurSample((vec2( 0.37, -0.15) * aspectcorrect) * dofblur9, centerCol, viewZ);
col += blurSample((vec2(-0.15, -0.37) * aspectcorrect) * dofblur9, centerCol, viewZ);
col += blurSample((vec2(-0.15, 0.37) * aspectcorrect) * dofblur9, centerCol, viewZ);
col += blurSample((vec2( 0.37, 0.15) * aspectcorrect) * dofblur9, centerCol, viewZ);
col += blurSample((vec2(-0.37, -0.15) * aspectcorrect) * dofblur9, centerCol, viewZ);
col += blurSample((vec2( 0.15, -0.37) * aspectcorrect) * dofblur9, centerCol, viewZ);

col += blurSample((vec2( 0.29, 0.29) * aspectcorrect) * dofblur7, centerCol, viewZ);
col += blurSample((vec2( 0.40, 0.0 ) * aspectcorrect) * dofblur7, centerCol, viewZ);
col += blurSample((vec2( 0.29, -0.29) * aspectcorrect) * dofblur7, centerCol, viewZ);
col += blurSample((vec2( 0.0, -0.4 ) * aspectcorrect) * dofblur7, centerCol, viewZ);
col += blurSample((vec2(-0.29, 0.29) * aspectcorrect) * dofblur7, centerCol, viewZ);
col += blurSample((vec2(-0.4, 0.0 ) * aspectcorrect) * dofblur7, centerCol, viewZ);
col += blurSample((vec2(-0.29, -0.29) * aspectcorrect) * dofblur7, centerCol, viewZ);
col += blurSample((vec2( 0.0, 0.4 ) * aspectcorrect) * dofblur7, centerCol, viewZ);

col += blurSample((vec2( 0.29, 0.29) * aspectcorrect) * dofblur4, centerCol, viewZ);
col += blurSample((vec2( 0.4, 0.0 ) * aspectcorrect) * dofblur4, centerCol, viewZ);
col += blurSample((vec2( 0.29, -0.29) * aspectcorrect) * dofblur4, centerCol, viewZ);
col += blurSample((vec2( 0.0, -0.4 ) * aspectcorrect) * dofblur4, centerCol, viewZ);
col += blurSample((vec2(-0.29, 0.29) * aspectcorrect) * dofblur4, centerCol, viewZ);
col += blurSample((vec2(-0.4, 0.0 ) * aspectcorrect) * dofblur4, centerCol, viewZ);
col += blurSample((vec2(-0.29, -0.29) * aspectcorrect) * dofblur4, centerCol, viewZ);
col += blurSample((vec2( 0.0, 0.4 ) * aspectcorrect) * dofblur4, centerCol, viewZ);
gl_FragColor = col / 41.0;
gl_FragColor.a = centerCol.a;
}`,LK=`
uniform sampler2D tDiffuse;
uniform float brightness;
uniform float contrast;
varying vec2 vUv;
void main() {
vec4 texel = texture2D(tDiffuse, vUv);
texel.rgb += brightness;
if (contrast > 0.0)
texel.rgb = (texel.rgb - 0.5) / (1.0 - contrast) + 0.5;
else
texel.rgb = (texel.rgb - 0.5) * (1.0 + contrast) + 0.5;
gl_FragColor = texel;
}`,BK=`uniform sampler2D tDiffuse;
uniform float opacity;
varying vec2 vUv;
void main() {
vec4 texel = (texture2D(tDiffuse, vUv));
gl_FragColor = opacity * texel;
}`,PK=`#include <common>
uniform samplerCube tCube;
uniform vec2 texelSize;
varying vec2 vUv;
void main() {
gl_FragColor = textureCube(tCube, octUVToCubeVec(gl_FragCoord.xy * texelSize,
texelSize));
}`,NK=`precision highp float;
uniform sampler2D tDiffuse;
uniform vec2 resolution;
varying vec2 vUv;
#ifndef FXAA_GLSL_120
#define FXAA_GLSL_120 0
#endif
#ifndef FXAA_GLSL_130
#define FXAA_GLSL_130 0
#endif
#ifndef FXAA_GREEN_AS_LUMA
#define FXAA_GREEN_AS_LUMA 0
#endif
#ifndef FXAA_EARLY_EXIT
#define FXAA_EARLY_EXIT 1
#endif
#ifndef FXAA_DISCARD
#define FXAA_DISCARD 1
#endif
#ifndef FXAA_FAST_PIXEL_OFFSET
#ifdef GL_EXT_gpu_shader4
#define FXAA_FAST_PIXEL_OFFSET 1
#endif
#ifdef GL_NV_gpu_shader5
#define FXAA_FAST_PIXEL_OFFSET 1
#endif
#ifdef GL_ARB_gpu_shader5
#define FXAA_FAST_PIXEL_OFFSET 1
#endif
#ifndef FXAA_FAST_PIXEL_OFFSET
#define FXAA_FAST_PIXEL_OFFSET 0
#endif
#endif
#ifndef FXAA_QUALITY_PRESET
#define FXAA_QUALITY_PRESET 12
#endif
#if (FXAA_QUALITY_PRESET == 10)
#define FXAA_QUALITY_PS 3
#define FXAA_QUALITY_P0 1.5
#define FXAA_QUALITY_P1 3.0
#define FXAA_QUALITY_P2 12.0
#endif
#if (FXAA_QUALITY_PRESET == 11)
#define FXAA_QUALITY_PS 4
#define FXAA_QUALITY_P0 1.0
#define FXAA_QUALITY_P1 1.5
#define FXAA_QUALITY_P2 3.0
#define FXAA_QUALITY_P3 12.0
#endif
#if (FXAA_QUALITY_PRESET == 12)
#define FXAA_QUALITY_PS 5
#define FXAA_QUALITY_P0 1.0
#define FXAA_QUALITY_P1 1.5
#define FXAA_QUALITY_P2 2.0
#define FXAA_QUALITY_P3 4.0
#define FXAA_QUALITY_P4 12.0
#endif
#if (FXAA_QUALITY_PRESET == 13)
#define FXAA_QUALITY_PS 6
#define FXAA_QUALITY_P0 1.0
#define FXAA_QUALITY_P1 1.5
#define FXAA_QUALITY_P2 2.0
#define FXAA_QUALITY_P3 2.0
#define FXAA_QUALITY_P4 4.0
#define FXAA_QUALITY_P5 12.0
#endif
#if (FXAA_QUALITY_PRESET == 14)
#define FXAA_QUALITY_PS 7
#define FXAA_QUALITY_P0 1.0
#define FXAA_QUALITY_P1 1.5
#define FXAA_QUALITY_P2 2.0
#define FXAA_QUALITY_P3 2.0
#define FXAA_QUALITY_P4 2.0
#define FXAA_QUALITY_P5 4.0
#define FXAA_QUALITY_P6 12.0
#endif
#if (FXAA_QUALITY_PRESET == 15)
#define FXAA_QUALITY_PS 8
#define FXAA_QUALITY_P0 1.0
#define FXAA_QUALITY_P1 1.5
#define FXAA_QUALITY_P2 2.0
#define FXAA_QUALITY_P3 2.0
#define FXAA_QUALITY_P4 2.0
#define FXAA_QUALITY_P5 2.0
#define FXAA_QUALITY_P6 4.0
#define FXAA_QUALITY_P7 12.0
#endif
#if (FXAA_QUALITY_PRESET == 20)
#define FXAA_QUALITY_PS 3
#define FXAA_QUALITY_P0 1.5
#define FXAA_QUALITY_P1 2.0
#define FXAA_QUALITY_P2 8.0
#endif
#if (FXAA_QUALITY_PRESET == 21)
#define FXAA_QUALITY_PS 4
#define FXAA_QUALITY_P0 1.0
#define FXAA_QUALITY_P1 1.5
#define FXAA_QUALITY_P2 2.0
#define FXAA_QUALITY_P3 8.0
#endif
#if (FXAA_QUALITY_PRESET == 22)
#define FXAA_QUALITY_PS 5
#define FXAA_QUALITY_P0 1.0
#define FXAA_QUALITY_P1 1.5
#define FXAA_QUALITY_P2 2.0
#define FXAA_QUALITY_P3 2.0
#define FXAA_QUALITY_P4 8.0
#endif
#if (FXAA_QUALITY_PRESET == 23)
#define FXAA_QUALITY_PS 6
#define FXAA_QUALITY_P0 1.0
#define FXAA_QUALITY_P1 1.5
#define FXAA_QUALITY_P2 2.0
#define FXAA_QUALITY_P3 2.0
#define FXAA_QUALITY_P4 2.0
#define FXAA_QUALITY_P5 8.0
#endif
#if (FXAA_QUALITY_PRESET == 24)
#define FXAA_QUALITY_PS 7
#define FXAA_QUALITY_P0 1.0
#define FXAA_QUALITY_P1 1.5
#define FXAA_QUALITY_P2 2.0
#define FXAA_QUALITY_P3 2.0
#define FXAA_QUALITY_P4 2.0
#define FXAA_QUALITY_P5 3.0
#define FXAA_QUALITY_P6 8.0
#endif
#if (FXAA_QUALITY_PRESET == 25)
#define FXAA_QUALITY_PS 8
#define FXAA_QUALITY_P0 1.0
#define FXAA_QUALITY_P1 1.5
#define FXAA_QUALITY_P2 2.0
#define FXAA_QUALITY_P3 2.0
#define FXAA_QUALITY_P4 2.0
#define FXAA_QUALITY_P5 2.0
#define FXAA_QUALITY_P6 4.0
#define FXAA_QUALITY_P7 8.0
#endif
#if (FXAA_QUALITY_PRESET == 26)
#define FXAA_QUALITY_PS 9
#define FXAA_QUALITY_P0 1.0
#define FXAA_QUALITY_P1 1.5
#define FXAA_QUALITY_P2 2.0
#define FXAA_QUALITY_P3 2.0
#define FXAA_QUALITY_P4 2.0
#define FXAA_QUALITY_P5 2.0
#define FXAA_QUALITY_P6 2.0
#define FXAA_QUALITY_P7 4.0
#define FXAA_QUALITY_P8 8.0
#endif
#if (FXAA_QUALITY_PRESET == 27)
#define FXAA_QUALITY_PS 10
#define FXAA_QUALITY_P0 1.0
#define FXAA_QUALITY_P1 1.5
#define FXAA_QUALITY_P2 2.0
#define FXAA_QUALITY_P3 2.0
#define FXAA_QUALITY_P4 2.0
#define FXAA_QUALITY_P5 2.0
#define FXAA_QUALITY_P6 2.0
#define FXAA_QUALITY_P7 2.0
#define FXAA_QUALITY_P8 4.0
#define FXAA_QUALITY_P9 8.0
#endif
#if (FXAA_QUALITY_PRESET == 28)
#define FXAA_QUALITY_PS 11
#define FXAA_QUALITY_P0 1.0
#define FXAA_QUALITY_P1 1.5
#define FXAA_QUALITY_P2 2.0
#define FXAA_QUALITY_P3 2.0
#define FXAA_QUALITY_P4 2.0
#define FXAA_QUALITY_P5 2.0
#define FXAA_QUALITY_P6 2.0
#define FXAA_QUALITY_P7 2.0
#define FXAA_QUALITY_P8 2.0
#define FXAA_QUALITY_P9 4.0
#define FXAA_QUALITY_P10 8.0
#endif
#if (FXAA_QUALITY_PRESET == 29)
#define FXAA_QUALITY_PS 12
#define FXAA_QUALITY_P0 1.0
#define FXAA_QUALITY_P1 1.5
#define FXAA_QUALITY_P2 2.0
#define FXAA_QUALITY_P3 2.0
#define FXAA_QUALITY_P4 2.0
#define FXAA_QUALITY_P5 2.0
#define FXAA_QUALITY_P6 2.0
#define FXAA_QUALITY_P7 2.0
#define FXAA_QUALITY_P8 2.0
#define FXAA_QUALITY_P9 2.0
#define FXAA_QUALITY_P10 4.0
#define FXAA_QUALITY_P11 8.0
#endif
#if (FXAA_QUALITY_PRESET == 39)
#define FXAA_QUALITY_PS 12
#define FXAA_QUALITY_P0 1.0
#define FXAA_QUALITY_P1 1.0
#define FXAA_QUALITY_P2 1.0
#define FXAA_QUALITY_P3 1.0
#define FXAA_QUALITY_P4 1.0
#define FXAA_QUALITY_P5 1.5
#define FXAA_QUALITY_P6 2.0
#define FXAA_QUALITY_P7 2.0
#define FXAA_QUALITY_P8 2.0
#define FXAA_QUALITY_P9 2.0
#define FXAA_QUALITY_P10 4.0
#define FXAA_QUALITY_P11 8.0
#endif
#if 1
#define FxaaBool bool
#define FxaaDiscard discard
#define FxaaFloat float
#define FxaaFloat2 vec2
#define FxaaFloat3 vec3
#define FxaaFloat4 vec4
#define FxaaHalf float
#define FxaaHalf2 vec2
#define FxaaHalf3 vec3
#define FxaaHalf4 vec4
#define FxaaInt2 ivec2
#define FxaaSat(x) clamp(x, 0.0, 1.0)
#define FxaaTex sampler2D
#endif
#if (FXAA_GLSL_100 == 1)
#define FxaaTexTop(t, p) texture2D(t, p, 0.0)
#define FxaaTexOff(t, p, o, r) texture2D(t, p + (o * r), 0.0)
#endif
#if (FXAA_GLSL_120 == 1)
#define FxaaTexTop(t, p) texture2DLod(t, p, 0.0)
#if (FXAA_FAST_PIXEL_OFFSET == 1)
#define FxaaTexOff(t, p, o, r) texture2DLodOffset(t, p, 0.0, o)
#else
#define FxaaTexOff(t, p, o, r) texture2DLod(t, p + (o * r), 0.0)
#endif
#endif
#if (FXAA_GLSL_130 == 1)
#define FxaaTexTop(t, p) textureLod(t, p, 0.0)
#define FxaaTexOff(t, p, o, r) textureLodOffset(t, p, 0.0, o)
#endif
#if (FXAA_GREEN_AS_LUMA == 0)
FxaaFloat FxaaLuma(FxaaFloat4 rgba) { return rgba.w; }
#else
FxaaFloat FxaaLuma(FxaaFloat4 rgba) { return rgba.y; }
#endif
FxaaFloat4 FxaaPixelShader(
FxaaFloat2 pos,
FxaaFloat4 fxaaConsolePosPos,
FxaaTex tex,
FxaaTex fxaaConsole360TexExpBiasNegOne,
FxaaTex fxaaConsole360TexExpBiasNegTwo,
FxaaFloat2 fxaaQualityRcpFrame,
FxaaFloat4 fxaaConsoleRcpFrameOpt,
FxaaFloat4 fxaaConsoleRcpFrameOpt2,
FxaaFloat4 fxaaConsole360RcpFrameOpt2,
FxaaFloat fxaaQualitySubpix,
FxaaFloat fxaaQualityEdgeThreshold,
FxaaFloat fxaaQualityEdgeThresholdMin
) {
FxaaFloat2 posM;
posM.x = pos.x;
posM.y = pos.y;
#if 1
FxaaFloat4 rgbyM = FxaaTexTop(tex, posM);
#if (FXAA_GREEN_AS_LUMA == 0)
#define lumaM rgbyM.w
#else
#define lumaM rgbyM.y
#endif
#if (FXAA_GLSL_100 == 1)
FxaaFloat lumaS = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2(0.0, 1.0), fxaaQualityRcpFrame.xy));
FxaaFloat lumaE = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2(1.0, 0.0), fxaaQualityRcpFrame.xy));
FxaaFloat lumaN = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2(0.0,-1.0), fxaaQualityRcpFrame.xy));
FxaaFloat lumaW = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2(-1.0, 0.0), fxaaQualityRcpFrame.xy));
#else
FxaaFloat lumaS = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(0, 1), fxaaQualityRcpFrame.xy));
FxaaFloat lumaE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(1, 0), fxaaQualityRcpFrame.xy));
FxaaFloat lumaN = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(0,-1), fxaaQualityRcpFrame.xy));
FxaaFloat lumaW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1, 0), fxaaQualityRcpFrame.xy));
#endif
#endif
FxaaFloat maxSM = max(lumaS, lumaM);
FxaaFloat minSM = min(lumaS, lumaM);
FxaaFloat maxESM = max(lumaE, maxSM);
FxaaFloat minESM = min(lumaE, minSM);
FxaaFloat maxWN = max(lumaN, lumaW);
FxaaFloat minWN = min(lumaN, lumaW);
FxaaFloat rangeMax = max(maxWN, maxESM);
FxaaFloat rangeMin = min(minWN, minESM);
FxaaFloat rangeMaxScaled = rangeMax * fxaaQualityEdgeThreshold;
FxaaFloat range = rangeMax - rangeMin;
FxaaFloat rangeMaxClamped = max(fxaaQualityEdgeThresholdMin, rangeMaxScaled);
FxaaBool earlyExit = range < rangeMaxClamped;
if(earlyExit)
#if (FXAA_DISCARD == 1)
return rgbyM;
#else
return rgbyM;
#endif
#if 1
#if (FXAA_GLSL_100 == 1)
FxaaFloat lumaNW = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2(-1.0,-1.0), fxaaQualityRcpFrame.xy));
FxaaFloat lumaSE = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2(1.0, 1.0), fxaaQualityRcpFrame.xy));
FxaaFloat lumaNE = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2(1.0,-1.0), fxaaQualityRcpFrame.xy));
FxaaFloat lumaSW = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2(-1.0, 1.0), fxaaQualityRcpFrame.xy));
#else
FxaaFloat lumaNW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1,-1), fxaaQualityRcpFrame.xy));
FxaaFloat lumaSE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(1, 1), fxaaQualityRcpFrame.xy));
FxaaFloat lumaNE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(1,-1), fxaaQualityRcpFrame.xy));
FxaaFloat lumaSW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1, 1), fxaaQualityRcpFrame.xy));
#endif
#else
FxaaFloat lumaNE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(1, -1), fxaaQualityRcpFrame.xy));
FxaaFloat lumaSW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1, 1), fxaaQualityRcpFrame.xy));
#endif
FxaaFloat lumaNS = lumaN + lumaS;
FxaaFloat lumaWE = lumaW + lumaE;
FxaaFloat subpixRcpRange = 1.0/range;
FxaaFloat subpixNSWE = lumaNS + lumaWE;
FxaaFloat edgeHorz1 = (-2.0 * lumaM) + lumaNS;
FxaaFloat edgeVert1 = (-2.0 * lumaM) + lumaWE;
FxaaFloat lumaNESE = lumaNE + lumaSE;
FxaaFloat lumaNWNE = lumaNW + lumaNE;
FxaaFloat edgeHorz2 = (-2.0 * lumaE) + lumaNESE;
FxaaFloat edgeVert2 = (-2.0 * lumaN) + lumaNWNE;
FxaaFloat lumaNWSW = lumaNW + lumaSW;
FxaaFloat lumaSWSE = lumaSW + lumaSE;
FxaaFloat edgeHorz4 = (abs(edgeHorz1) * 2.0) + abs(edgeHorz2);
FxaaFloat edgeVert4 = (abs(edgeVert1) * 2.0) + abs(edgeVert2);
FxaaFloat edgeHorz3 = (-2.0 * lumaW) + lumaNWSW;
FxaaFloat edgeVert3 = (-2.0 * lumaS) + lumaSWSE;
FxaaFloat edgeHorz = abs(edgeHorz3) + edgeHorz4;
FxaaFloat edgeVert = abs(edgeVert3) + edgeVert4;
FxaaFloat subpixNWSWNESE = lumaNWSW + lumaNESE;
FxaaFloat lengthSign = fxaaQualityRcpFrame.x;
FxaaBool horzSpan = edgeHorz >= edgeVert;
FxaaFloat subpixA = subpixNSWE * 2.0 + subpixNWSWNESE;
if(!horzSpan) lumaN = lumaW;
if(!horzSpan) lumaS = lumaE;
if(horzSpan) lengthSign = fxaaQualityRcpFrame.y;
FxaaFloat subpixB = (subpixA * (1.0/12.0)) - lumaM;
FxaaFloat gradientN = lumaN - lumaM;
FxaaFloat gradientS = lumaS - lumaM;
FxaaFloat lumaNN = lumaN + lumaM;
FxaaFloat lumaSS = lumaS + lumaM;
FxaaBool pairN = abs(gradientN) >= abs(gradientS);
FxaaFloat gradient = max(abs(gradientN), abs(gradientS));
if(pairN) lengthSign = -lengthSign;
FxaaFloat subpixC = FxaaSat(abs(subpixB) * subpixRcpRange);
FxaaFloat2 posB;
posB.x = posM.x;
posB.y = posM.y;
FxaaFloat2 offNP;
offNP.x = (!horzSpan) ? 0.0 : fxaaQualityRcpFrame.x;
offNP.y = (horzSpan) ? 0.0 : fxaaQualityRcpFrame.y;
if(!horzSpan) posB.x += lengthSign * 0.5;
if(horzSpan) posB.y += lengthSign * 0.5;
FxaaFloat2 posN;
posN.x = posB.x - offNP.x * FXAA_QUALITY_P0;
posN.y = posB.y - offNP.y * FXAA_QUALITY_P0;
FxaaFloat2 posP;
posP.x = posB.x + offNP.x * FXAA_QUALITY_P0;
posP.y = posB.y + offNP.y * FXAA_QUALITY_P0;
FxaaFloat subpixD = ((-2.0)*subpixC) + 3.0;
FxaaFloat lumaEndN = FxaaLuma(FxaaTexTop(tex, posN));
FxaaFloat subpixE = subpixC * subpixC;
FxaaFloat lumaEndP = FxaaLuma(FxaaTexTop(tex, posP));
if(!pairN) lumaNN = lumaSS;
FxaaFloat gradientScaled = gradient * 1.0/4.0;
FxaaFloat lumaMM = lumaM - lumaNN * 0.5;
FxaaFloat subpixF = subpixD * subpixE;
FxaaBool lumaMLTZero = lumaMM < 0.0;
lumaEndN -= lumaNN * 0.5;
lumaEndP -= lumaNN * 0.5;
FxaaBool doneN = abs(lumaEndN) >= gradientScaled;
FxaaBool doneP = abs(lumaEndP) >= gradientScaled;
if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P1;
if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P1;
FxaaBool doneNP = (!doneN) || (!doneP);
if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P1;
if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P1;
if(doneNP) {
if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));
if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));
if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;
if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;
doneN = abs(lumaEndN) >= gradientScaled;
doneP = abs(lumaEndP) >= gradientScaled;
if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P2;
if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P2;
doneNP = (!doneN) || (!doneP);
if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P2;
if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P2;
#if (FXAA_QUALITY_PS > 3)
if(doneNP) {
if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));
if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));
if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;
if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;
doneN = abs(lumaEndN) >= gradientScaled;
doneP = abs(lumaEndP) >= gradientScaled;
if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P3;
if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P3;
doneNP = (!doneN) || (!doneP);
if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P3;
if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P3;
#if (FXAA_QUALITY_PS > 4)
if(doneNP) {
if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));
if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));
if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;
if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;
doneN = abs(lumaEndN) >= gradientScaled;
doneP = abs(lumaEndP) >= gradientScaled;
if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P4;
if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P4;
doneNP = (!doneN) || (!doneP);
if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P4;
if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P4;
#if (FXAA_QUALITY_PS > 5)
if(doneNP) {
if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));
if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));
if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;
if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;
doneN = abs(lumaEndN) >= gradientScaled;
doneP = abs(lumaEndP) >= gradientScaled;
if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P5;
if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P5;
doneNP = (!doneN) || (!doneP);
if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P5;
if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P5;
#if (FXAA_QUALITY_PS > 6)
if(doneNP) {
if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));
if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));
if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;
if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;
doneN = abs(lumaEndN) >= gradientScaled;
doneP = abs(lumaEndP) >= gradientScaled;
if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P6;
if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P6;
doneNP = (!doneN) || (!doneP);
if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P6;
if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P6;
#if (FXAA_QUALITY_PS > 7)
if(doneNP) {
if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));
if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));
if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;
if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;
doneN = abs(lumaEndN) >= gradientScaled;
doneP = abs(lumaEndP) >= gradientScaled;
if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P7;
if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P7;
doneNP = (!doneN) || (!doneP);
if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P7;
if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P7;
#if (FXAA_QUALITY_PS > 8)
if(doneNP) {
if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));
if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));
if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;
if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;
doneN = abs(lumaEndN) >= gradientScaled;
doneP = abs(lumaEndP) >= gradientScaled;
if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P8;
if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P8;
doneNP = (!doneN) || (!doneP);
if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P8;
if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P8;
#if (FXAA_QUALITY_PS > 9)
if(doneNP) {
if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));
if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));
if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;
if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;
doneN = abs(lumaEndN) >= gradientScaled;
doneP = abs(lumaEndP) >= gradientScaled;
if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P9;
if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P9;
doneNP = (!doneN) || (!doneP);
if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P9;
if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P9;
#if (FXAA_QUALITY_PS > 10)
if(doneNP) {
if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));
if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));
if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;
if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;
doneN = abs(lumaEndN) >= gradientScaled;
doneP = abs(lumaEndP) >= gradientScaled;
if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P10;
if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P10;
doneNP = (!doneN) || (!doneP);
if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P10;
if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P10;
#if (FXAA_QUALITY_PS > 11)
if(doneNP) {
if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));
if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));
if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;
if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;
doneN = abs(lumaEndN) >= gradientScaled;
doneP = abs(lumaEndP) >= gradientScaled;
if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P11;
if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P11;
doneNP = (!doneN) || (!doneP);
if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P11;
if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P11;
#if (FXAA_QUALITY_PS > 12)
if(doneNP) {
if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));
if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));
if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;
if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;
doneN = abs(lumaEndN) >= gradientScaled;
doneP = abs(lumaEndP) >= gradientScaled;
if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P12;
if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P12;
doneNP = (!doneN) || (!doneP);
if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P12;
if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P12;
}
#endif
}
#endif
}
#endif
}
#endif
}
#endif
}
#endif
}
#endif
}
#endif
}
#endif
}
#endif
}
FxaaFloat dstN = posM.x - posN.x;
FxaaFloat dstP = posP.x - posM.x;
if(!horzSpan) dstN = posM.y - posN.y;
if(!horzSpan) dstP = posP.y - posM.y;
FxaaBool goodSpanN = (lumaEndN < 0.0) != lumaMLTZero;
FxaaFloat spanLength = (dstP + dstN);
FxaaBool goodSpanP = (lumaEndP < 0.0) != lumaMLTZero;
FxaaFloat spanLengthRcp = 1.0/spanLength;
FxaaBool directionN = dstN < dstP;
FxaaFloat dst = min(dstN, dstP);
FxaaBool goodSpan = directionN ? goodSpanN : goodSpanP;
FxaaFloat subpixG = subpixF * subpixF;
FxaaFloat pixelOffset = (dst * (-spanLengthRcp)) + 0.5;
FxaaFloat subpixH = subpixG * fxaaQualitySubpix;
FxaaFloat pixelOffsetGood = goodSpan ? pixelOffset : 0.0;
FxaaFloat pixelOffsetSubpix = max(pixelOffsetGood, subpixH);
if(!horzSpan) posM.x += pixelOffsetSubpix * lengthSign;
if(horzSpan) posM.y += pixelOffsetSubpix * lengthSign;
#if (FXAA_DISCARD == 1)
return FxaaTexTop(tex, posM);
#else
return FxaaFloat4(FxaaTexTop(tex, posM).xyz, lumaM);
#endif
}
void main() {
gl_FragColor = FxaaPixelShader(
vUv,
vec4(0.0),
tDiffuse,
tDiffuse,
tDiffuse,
resolution,
vec4(0.0),
vec4(0.0),
vec4(0.0),
0.75,
0.166,
0.0833
);
}`,DK=`uniform sampler2D tDiffuse;
varying vec2 vUv;
void main() {
vec4 texel = texture2D(tDiffuse, vUv);
float bw = texel.r * 0.35 + texel.g * 0.45 + texel.b * 0.2;
texel = vec4(bw, bw, bw, texel.a);
gl_FragColor = texel;
}`,OK=`uniform sampler2D tDiffuse;
uniform sampler2D tNormal;
uniform vec2 direction;
uniform vec2 resolution;
varying vec2 vUv;
#include <packing>
const float SIGMA_SPATIAL = 1.5;
const float SIGMA_INTENSITY = 0.01;
float gaussianPdf(float x, float sigma) {
return 0.39894 * exp(-0.5 * x * x/(sigma * sigma))/sigma;
}
void main() {
float weightSum = gaussianPdf(0.0, SIGMA_SPATIAL)
* gaussianPdf(0.0, SIGMA_INTENSITY);
vec4 diffSample = texture2D(tDiffuse, vUv);
vec4 gtaoDataSum = vec4(diffSample.r, unpackRGBToNormal(diffSample.gba)) * weightSum;
vec3 normCenter = unpackRGBToNormal(texture2D(tNormal, vUv).xyz);
vec2 delta = direction / resolution;
vec2 offset = delta;
#pragma unroll_loop
for (int i = 1; i <= BLUR_RADIUS_PX; i++) {
vec2 uvCoords0 = vUv + offset;
vec2 uvCoords1 = vUv - offset;
vec4 diffSample0 = texture2D(tDiffuse, uvCoords0);
vec4 diffSample1 = texture2D(tDiffuse, uvCoords1);
vec4 gtaoData0 = vec4(diffSample0.r, unpackRGBToNormal(diffSample0.gba));
vec4 gtaoData1 = vec4(diffSample1.r, unpackRGBToNormal(diffSample1.gba));
vec3 normSample0 = unpackRGBToNormal(texture2D(tNormal, uvCoords0).xyz);
vec3 normSample1 = unpackRGBToNormal(texture2D(tNormal, uvCoords1).xyz);
float weightSpatial = gaussianPdf(float(i), SIGMA_SPATIAL);
float weight0 = weightSpatial * gaussianPdf(1.0 - max(0.0,
dot(normCenter, normSample0)), SIGMA_INTENSITY);
float weight1 = weightSpatial * gaussianPdf(1.0 - max(0.0,
dot(normCenter, normSample1)), SIGMA_INTENSITY);
weightSum += weight0 + weight1;
gtaoDataSum += weight0 * gtaoData0 + weight1 * gtaoData1;
offset += delta;
}
float visibility = gtaoDataSum.r / weightSum;
vec3 bentNormal = normalize(gtaoDataSum.gba);
gl_FragColor = vec4(visibility, packNormalToRGB(bentNormal));
}`,FK=`uniform sampler2D tNormal;
uniform sampler2D tDepth;
uniform sampler2D tNoise;
uniform float occlDistance;
uniform float factor;
uniform float occlPrecision;
uniform mat4 mainCameraProjMat;
uniform vec2 resolution;
varying vec2 vUv;
#include <common>
#include <packing>
const vec3 AXIS_Z = vec3(0.0, 0.0, 1.0);
const float NUM_SAMPLES_HALF_MIN = 4.0;
const float NUM_SAMPLES_HALF_MAX = 8.0;
const float NOISE_TEX_SIZE = 32.0;
const float NEAR_FIELD_COEFF = 0.5;
const float SELF_OCCL_BIAS = -1e-5;
const float NORMAL_RENDER_GEOM_MAX_DIFF_ANGLE = 0.85 * PI_HALF;
float integrateArc(vec2 horizonAngles, float normalAngle) {
vec2 visCoeffs = (-cos(2.0 * horizonAngles - normalAngle) + cos(normalAngle)
+ 2.0 * horizonAngles * sin(normalAngle)) / 4.0;
return visCoeffs.x + visCoeffs.y;
}
vec3 calcViewFromUVDepth(vec2 uv, float depth, float zBias) {
vec3 ndcCo = 2.0 * vec3(uv, depth) - 1.0;
#if ORTHO_CAMERA == 1
float viewZ = (ndcCo.z - mainCameraProjMat[3][2]) / mainCameraProjMat[2][2] + zBias;
vec2 _00_11 = vec2(mainCameraProjMat[0][0], mainCameraProjMat[1][1]);
vec2 _30_31 = vec2(mainCameraProjMat[3][0], mainCameraProjMat[3][1]);
return vec3((ndcCo.xy - _30_31) / _00_11, viewZ);
#else
float viewZ = -mainCameraProjMat[3][2] / (mainCameraProjMat[2][2] + ndcCo.z) + zBias;
vec2 _00_11 = vec2(mainCameraProjMat[0][0], mainCameraProjMat[1][1]);
vec2 _20_21 = vec2(mainCameraProjMat[2][0], mainCameraProjMat[2][1]);
return vec3(-viewZ * (ndcCo.xy + _20_21) / _00_11, viewZ);
#endif
}
vec2 calcSliceRadiusUV(float viewZ) {
vec4 distView = vec4(occlDistance, occlDistance, viewZ, 1.0);
vec4 distClip = mainCameraProjMat * distView;
vec2 xyNDC = distClip.xy / distClip.w;
return clamp(0.5 * xyNDC, 0.0, 0.5);
}
vec2 calcHorizonAngles(vec3 viewPos, vec3 viewVec, vec2 sliceDir,
float offsetNoise) {
vec2 maxHorizonCos = vec2(-1.0);
vec2 sliceRadius = calcSliceRadiusUV(viewPos.z);
vec2 pxSize = 1.0 / resolution;
int NUM_SAMPLES_HALF = int(occlPrecision
* (NUM_SAMPLES_HALF_MAX - NUM_SAMPLES_HALF_MIN) + NUM_SAMPLES_HALF_MIN);
#if __VERSION__ == 300
for (int i = 0; i < NUM_SAMPLES_HALF; i++) {
#else
for (int i = 0; i < int(NUM_SAMPLES_HALF_MAX); i++) {
if (i >= NUM_SAMPLES_HALF) continue;
#endif
vec2 offset = sliceDir * (pxSize * (1.0 + float(i))
+ sliceRadius * pow((float(i) + offsetNoise) / float(NUM_SAMPLES_HALF), 2.0));
vec2 uvs = vUv - offset;
vec3 ps = calcViewFromUVDepth(uvs, texture2D(tDepth, uvs).x, SELF_OCCL_BIAS);
vec3 ds = normalize(ps - viewPos);
vec2 uvt = vUv + offset;
vec3 pt = calcViewFromUVDepth(uvt, texture2D(tDepth, uvt).x, SELF_OCCL_BIAS);
vec3 dt = normalize(pt - viewPos);
vec2 sampleLen = vec2(length(ps - viewPos), length(pt - viewPos));
vec2 blendWeight = (sampleLen / occlDistance - 1.0) / (NEAR_FIELD_COEFF - 1.0);
blendWeight = clamp(blendWeight, 0.0, 1.0);
vec2 maxHorizonCosNoBlending = max(maxHorizonCos, vec2(dot(ds, viewVec),
dot(dt, viewVec)));
maxHorizonCos = mix(maxHorizonCos, maxHorizonCosNoBlending, blendWeight);
}
vec2 horizons = acos(maxHorizonCos);
return vec2(-horizons.x, horizons.y);
}
vec2 calcNormalAngleAndProjLen(vec3 viewVec, vec3 normal, vec2 sliceDir) {
vec3 sliceVec = vec3(sliceDir, 0.0);
sliceVec = sliceVec - dot(sliceVec, viewVec) * viewVec;
vec3 sliceOrthoVec = cross(sliceVec, viewVec);
vec3 normalProj = normal - dot(normal, sliceOrthoVec) * sliceOrthoVec;
float normalProjLen = length(normalProj);
float normalAngle = acos(clamp(dot(normalProj / normalProjLen, viewVec), 0.0, 1.0));
normalAngle *= sign(dot(normalProj, sliceVec));
return vec2(normalAngle, normalProjLen);
}
#if CALC_BENT_NORMALS == 1
vec3 calcSliceBentNormal(vec2 sliceDir, vec2 h, float n) {
vec2 t = vec2(
6.0 * sin(h[0] - n) - sin(3.0 * h[0] - n) + 6.0 * sin(h[1] - n)
- sin(3.0 * h[1] - n) + 16.0 * sin(n) - 3.0 * (sin(h[0] + n) + sin(h[1] + n)),
-cos(3.0 * h[0] - n) - cos(3.0 * h[1] - n) + 8.0 * cos(n)
- 3.0 * (cos(h[0] + n) + cos(h[1] + n))
) / 12.0;
return vec3(sliceDir * t[0], t[1]);
}
#endif
vec2 clampHorizonAnglesAroundNormal(vec2 horizonAngles, float normalAngle,
float geomNormalAngle) {
horizonAngles = normalAngle + clamp(horizonAngles - normalAngle, -PI_HALF, PI_HALF);
if (abs(normalAngle - geomNormalAngle) < NORMAL_RENDER_GEOM_MAX_DIFF_ANGLE) {
horizonAngles = geomNormalAngle + clamp(horizonAngles - geomNormalAngle, -PI_HALF, PI_HALF);
}
return horizonAngles;
}
void main() {
float depth = texture2D(tDepth, vUv).x;
#ifndef GTAO_DISABLE_BKG_FIX
if (depth == 1.0) {
gl_FragColor = vec4(vec3(1.0), 1.0);
} else {
#endif
vec3 viewPos = calcViewFromUVDepth(vUv, depth, 0.0);
#if ORTHO_CAMERA == 1
vec3 viewVec = vec3(0.0, 0.0, 1.0);
#else
vec3 viewVec = normalize(-viewPos);
#endif
vec3 viewNormal = unpackRGBToNormal(texture2D(tNormal, vUv).xyz);
vec3 geomViewNormal = normalize(cross(dFdx(viewPos), dFdy(viewPos)));
vec2 noiseScale = resolution / NOISE_TEX_SIZE;
vec4 noiseData = texture2D(tNoise, vUv * noiseScale);
float randAngle = noiseData.r * PI_HALF;
float visibility = 0.0;
vec3 bentNormalAvg = viewNormal;
float normalAngle, normalProjLen, geomNormalAngle;
vec2 horizonAngles, _vec2Tmp;
vec3 sliceBentNormal;
#if CALC_BENT_NORMALS == 1
bentNormalAvg = vec3(0.0);
#if ORTHO_CAMERA == 0
vec3 bentRotAxis = cross(AXIS_Z, viewVec);
float bentRotAngle = acos(clamp(dot(AXIS_Z, viewVec), -1.0, 1.0));
#endif
#endif
vec2 sliceDir = vec2(cos(randAngle), sin(randAngle));
#pragma unroll_loop
for (int i = 0; i < 2; i++) {
_vec2Tmp = calcNormalAngleAndProjLen(viewVec, viewNormal, sliceDir);
normalAngle = _vec2Tmp[0], normalProjLen = _vec2Tmp[1];
_vec2Tmp = calcNormalAngleAndProjLen(viewVec, geomViewNormal, sliceDir);
geomNormalAngle = _vec2Tmp[0];
horizonAngles = calcHorizonAngles(viewPos, viewVec, sliceDir, noiseData.g);
horizonAngles = clampHorizonAnglesAroundNormal(horizonAngles,
normalAngle, geomNormalAngle);
visibility += normalProjLen * integrateArc(horizonAngles, normalAngle);
#if CALC_BENT_NORMALS == 1
sliceBentNormal = calcSliceBentNormal(sliceDir, horizonAngles, normalAngle);
#if ORTHO_CAMERA == 0
sliceBentNormal = vec3RotateAxisAngle(sliceBentNormal,
bentRotAxis, bentRotAngle);
#endif
bentNormalAvg += sliceBentNormal * normalProjLen;
#endif
sliceDir = vec2(-sliceDir.y, sliceDir.x);
}
visibility /= 2.0;
#if CALC_BENT_NORMALS == 1
float mixFactor = clamp((1.0 - 2.0 * visibility) / (3.0 * visibility - 4.0), 0.0, 1.0);
bentNormalAvg = normalize(mix(bentNormalAvg, viewNormal, mixFactor));
#endif
gl_FragColor = vec4(pow(visibility, factor), packNormalToRGB(bentNormalAvg));
#ifndef GTAO_DISABLE_BKG_FIX
}
#endif
}`,UK=`varying vec2 vUv;
uniform sampler2D maskTexture;
uniform vec2 texSize;
uniform vec4 visibleEdgeColor;
uniform vec4 hiddenEdgeColor;
void main() {
vec2 invSize = 1.0 / texSize;
vec4 uvOffset = vec4(1.0, 0.0, 0.0, 1.0) * vec4(invSize, invSize);
vec4 c1 = texture2D(maskTexture, vUv + uvOffset.xy);
vec4 c2 = texture2D(maskTexture, vUv - uvOffset.xy);
vec4 c3 = texture2D(maskTexture, vUv + uvOffset.yw);
vec4 c4 = texture2D(maskTexture, vUv - uvOffset.yw);
float diff1 = (c1.r - c2.r) * 0.5;
float diff2 = (c3.r - c4.r) * 0.5;
float d = length(vec2(diff1, diff2));
float a1 = min(c1.g, c2.g);
float a2 = min(c3.g, c4.g);
float visibilityFactor = min(a1, a2);
vec4 edgeColor = (1.0 - visibilityFactor > 0.001) ? visibleEdgeColor : hiddenEdgeColor;
gl_FragColor = edgeColor * vec4(d);
}`,zK=`#include <common>
varying vec2 vUv;
uniform sampler2D colorTexture;
uniform vec2 texSize;
uniform vec2 direction;
uniform float kernelRadius;
float gaussianPdf(in float x, in float sigma) {
return 0.39894 * exp(-0.5 * x * x/(sigma * sigma))/sigma;
}
void main() {
vec2 invSize = 1.0 / texSize;
float weightSum = gaussianPdf(0.0, kernelRadius);
vec4 diffuseSum = texture2D(colorTexture, vUv);
#if defined(LOG_SPACE)
diffuseSum = exp(diffuseSum);
#endif
diffuseSum *= weightSum;
vec2 delta = direction * invSize * kernelRadius/float(MAX_RADIUS);
vec2 uvOffset = delta;
for (int i = 1; i <= MAX_RADIUS; i++) {
float w = gaussianPdf(uvOffset.x, kernelRadius);
vec4 sample1 = texture2D(colorTexture, vUv + uvOffset);
vec4 sample2 = texture2D(colorTexture, vUv - uvOffset);
#if defined(LOG_SPACE)
sample1 = exp(sample1);
sample2 = exp(sample2);
#endif
diffuseSum += ((sample1 + sample2) * w);
weightSum += (2.0 * w);
uvOffset += delta;
}
vec4 finalCol = diffuseSum / weightSum;
#if defined(LOG_SPACE)
finalCol = log(finalCol);
#endif
gl_FragColor = finalCol;
}`,VK=`varying vec2 vUv;
uniform sampler2D maskTexture;
uniform sampler2D edgeTexture1;
uniform sampler2D edgeTexture2;
uniform sampler2D patternTexture;
uniform float edgeStrength;
uniform float edgeGlow;
uniform bool usePatternTexture;
void main() {
vec4 edgeValue1 = texture2D(edgeTexture1, vUv);
vec4 edgeValue2 = texture2D(edgeTexture2, vUv);
vec4 maskColor = texture2D(maskTexture, vUv);
vec4 patternColor = texture2D(patternTexture, 6.0 * vUv);
float visibilityFactor = 1.0 - maskColor.g > 0.0 ? 1.0 : 0.5;
vec4 edgeValue = edgeValue1 + edgeValue2 * edgeGlow;
vec4 finalColor = edgeStrength * maskColor.r * edgeValue;
if (usePatternTexture)
finalColor += + visibilityFactor * (1.0 - maskColor.r) * (1.0 - patternColor.r);
float maxChannel = max(finalColor.r, max(finalColor.g, finalColor.b));
if (maxChannel != 0.0) {
finalColor.rgb /= maxChannel;
}
gl_FragColor = finalColor;
}`,kK=`#include <common>
uniform sampler2D tDiffuse;
varying vec2 vUv;
void main() {
vec4 texel = texture2D(tDiffuse, vUv);
float alpha = clamp(texel.a, 0.0, 1.0);
gl_FragColor = texel;
gl_FragColor.rgb /= alpha;
#include <tonemapping_fragment>
gl_FragColor = LinearTosRGB(gl_FragColor);
gl_FragColor.rgb *= alpha;
#if ALPHA_AS_LUMA == 1
gl_FragColor.a = linearToRelativeLuminance(gl_FragColor.rgb);
#endif
}`;const GK=`precision highp float;
attribute vec3 position;
attribute vec3 previous;
attribute vec3 next;
attribute float side;
attribute float width;
attribute vec2 uv;
attribute float counters;
uniform mat4 projectionMatrix;
uniform mat4 modelViewMatrix;
uniform vec2 resolution;
uniform float lineWidth;
uniform float sizeAttenuation;
varying float vCounters;
varying vec2 vUV;
const float EQ_EPS = 0.000001;
vec2 fix(vec4 i, float aspect) {
vec2 res = i.xy / i.w;
res.x *= aspect;
return res;
}
bool posEqual(vec2 pos0, vec2 pos1) {
return length(pos0 - pos1) < EQ_EPS;
}
void main() {
float aspect = resolution.x / resolution.y;
vCounters = counters;
vUV = uv;
mat4 m = projectionMatrix * modelViewMatrix;
vec4 finalPosition = m * vec4(position, 1.0);
vec4 prevPos = m * vec4(previous, 1.0);
vec4 nextPos = m * vec4(next, 1.0);
vec2 currentP = fix(finalPosition, aspect);
vec2 prevP = fix(prevPos, aspect);
vec2 nextP = fix(nextPos, aspect);
float w = lineWidth * width;
if (sizeAttenuation == 0.0) {
w *= finalPosition.w / resolution.x;
}
vec2 dir;
if (posEqual(nextP, currentP)) {
dir = normalize(currentP - prevP);
} else if (posEqual(prevP, currentP)) {
dir = normalize(nextP - currentP);
} else {
vec2 dir1 = normalize(currentP - prevP);
vec2 dir2 = normalize(nextP - currentP);
dir = normalize(dir1 + dir2);
}
vec2 offset = vec2(-dir.y, dir.x);
offset.y *= aspect;
offset *= w;
finalPosition.xy += offset * side;
gl_Position = finalPosition;
}`,QK=`precision mediump float;
uniform sampler2D map;
uniform sampler2D alphaMap;
uniform float useMap;
uniform float useAlphaMap;
uniform float visibility;
uniform float alphaTest;
uniform vec2 repeat;
uniform vec3 color;
uniform float opacity;
varying vec2 vUV;
varying float vCounters;
#include <encodings_pars_fragment>
void main() {
vec4 c = vec4(color, opacity);
if (useMap == 1.0) {
c *= texture2D(map, vUV * repeat);
}
if (useAlphaMap == 1.0) {
c.a *= texture2D(alphaMap, vUV * repeat).a;
}
if (c.a < alphaTest) {
discard;
}
gl_FragColor = c;
gl_FragColor.a *= step(vCounters, visibility);
gl_FragColor = LinearTosRGB(gl_FragColor);
}`,Ye={alphamap_fragment:$Q,alphamap_pars_fragment:JQ,alphatest_fragment:eH,alphatest_pars_fragment:tH,aomap_fragment:nH,aomap_pars_fragment:rH,begin_vertex:oH,beginnormal_vertex:aH,bsdfs:iH,bumpmap_pars_fragment:sH,clipping_planes_fragment:lH,clipping_planes_pars_fragment:cH,clipping_planes_pars_vertex:uH,clipping_planes_vertex:dH,color_fragment:fH,color_pars_fragment:hH,color_pars_vertex:pH,color_vertex:mH,common:gH,cube_uv_reflection_fragment:vH,defaultnormal_vertex:_H,displacementmap_pars_vertex:AH,displacementmap_vertex:xH,emissivemap_fragment:yH,emissivemap_pars_fragment:bH,encodings_fragment:SH,encodings_pars_fragment:CH,envmap_fragment:EH,envmap_common_pars_fragment:MH,envmap_pars_fragment:wH,envmap_pars_vertex:TH,envmap_physical_pars_fragment:zH,envmap_vertex:RH,fog_vertex:IH,fog_pars_vertex:LH,fog_fragment:BH,fog_pars_fragment:PH,lightmap_fragment:NH,lightmap_pars_fragment:DH,lights_lambert_fragment:OH,lights_lambert_pars_fragment:FH,lights_pars_begin:UH,lights_physical_fragment:VH,lights_physical_pars_fragment:kH,lights_fragment_begin:GH,lights_fragment_maps:QH,lights_fragment_end:HH,logdepthbuf_fragment:WH,logdepthbuf_pars_fragment:YH,logdepthbuf_pars_vertex:jH,logdepthbuf_vertex:XH,map_fragment:qH,map_pars_fragment:ZH,map_particle_fragment:KH,map_particle_pars_fragment:$H,metalnessmap_fragment:JH,metalnessmap_pars_fragment:eW,morphcolor_vertex:tW,morphnormal_vertex:nW,morphtarget_pars_vertex:rW,morphtarget_vertex:oW,normal_fragment_begin:aW,normal_fragment_maps:iW,normal_pars_fragment:sW,normal_pars_vertex:lW,normal_vertex:cW,normalmap_pars_fragment:uW,clearcoat_normal_fragment_begin:dW,clearcoat_normal_fragment_maps:fW,clearcoat_pars_fragment:hW,output_fragment:pW,packing:mW,premultiplied_alpha_fragment:gW,project_vertex:vW,dithering_fragment:_W,dithering_pars_fragment:AW,roughnessmap_fragment:xW,roughnessmap_pars_fragment:yW,shadowmap_pars_fragment:bW,shadowmap_pars_vertex:SW,shadowmap_vertex:CW,shadowmask_pars_fragment:EW,skinbase_vertex:MW,skinning_pars_vertex:wW,skinning_vertex:TW,skinnormal_vertex:RW,specularmap_fragment:IW,specularmap_pars_fragment:LW,tonemapping_fragment:BW,tonemapping_pars_fragment:PW,transmission_fragment:NW,transmission_pars_fragment:DW,uv_pars_fragment:OW,uv_pars_vertex:FW,uv_vertex:UW,uv2_pars_fragment:zW,uv2_pars_vertex:VW,uv2_vertex:kW,webgl1_compat:GW,worldpos_vertex:QW,background_vert:HW,background_frag:WW,backgroundCube_vert:YW,backgroundCube_frag:jW,cube_vert:XW,cube_frag:qW,depth_vert:ZW,depth_frag:KW,distanceRGBA_vert:$W,distanceRGBA_frag:JW,equirect_vert:eY,equirect_frag:tY,linedashed_vert:nY,linedashed_frag:rY,meshbasic_vert:oY,meshbasic_frag:aY,meshlambert_vert:iY,meshlambert_frag:sY,meshnormal_vert:lY,meshnormal_frag:cY,meshphysical_vert:uY,meshphysical_frag:dY,points_vert:fY,points_frag:hY,shadow_vert:pY,shadow_frag:mY,sprite_vert:gY,sprite_frag:vY,mask_vert:_Y,mask_frag:AY,meshnode_vert:xY,meshnode_frag:yY,lights_node_pars_fragment:bY,lights_node_gtao_pars_fragment:SY,lights_fragment_gtso:CY,normal_output_fragment:EY,ssr_pars_fragment:MY,plane_reflection_pars_vertex:wY,plane_reflection_pars_fragment:TY,plane_reflection_vertex:RY,oit_weighted_pars_fragment:IY,oit_weighted_fragment:LY,node_common_frag:BY,node_osl_frag:PY,node_incident_frag:NY,node_normal_frag:DY,node_position_frag:OY,node_rgb_alpha_frag:FY,node_value_frag:UY,node_u_float_frag:zY,node_abs_ar_frag:VY,node_add_ar_frag:kY,node_atan_ar_frag:GY,node_checkerboard_ar_frag:QY,node_clamp_ar_frag:HY,node_color_convert_ar_frag:YY,node_color_correct_ar_frag:jY,node_color_to_float_ar_frag:WY,node_compare_ar_frag:XY,node_complement_ar_frag:qY,node_composite_ar_frag:ZY,node_cross_ar_frag:KY,node_divide_ar_frag:$Y,node_dot_ar_frag:JY,node_exp_ar_frag:ej,node_facing_ratio_ar_frag:tj,node_flat_ar_frag:nj,node_float_to_int_ar_frag:rj,node_float_to_matrix_ar_frag:oj,node_float_to_rgba_ar_frag:aj,node_float_to_rgb_ar_frag:ij,node_fraction_ar_frag:sj,node_is_finite_ar_frag:lj,node_image_ar_frag:cj,node_lambert_ar_frag:uj,node_length_ar_frag:dj,node_log_ar_frag:fj,node_map_to_mtl_ar_frag:hj,node_matrix_transform_ar_frag:pj,node_max_ar_frag:mj,node_min_ar_frag:gj,node_mix_shader_ar_frag:vj,node_modulo_ar_frag:_j,node_multiply_ar_frag:Aj,node_negate_ar_frag:xj,node_normalize_ar_frag:yj,node_normal_map_ar_frag:bj,node_pow_ar_frag:Sj,node_random_ar_frag:Cj,node_range_ar_frag:Ej,node_ray_switch_ar_frag:Mj,node_reciprocal_ar_frag:wj,node_rgba_to_float_ar_frag:Tj,node_rgb_to_float_ar_frag:Rj,node_rgb_to_vector_ar_frag:Ij,node_shadow_matte_ar_frag:Lj,node_shuffle_ar_frag:Bj,node_sign_ar_frag:Pj,node_skydome_light_ar_frag:Nj,node_sqrt_ar_frag:Dj,node_standard_surface_ar_frag:Oj,node_subtract_ar_frag:Fj,node_trigo_ar_frag:Uj,node_triplanar_ar_frag:zj,node_triplanar_uv_ar_frag:Vj,node_two_sided_ar_frag:kj,node_user_data_color_ar_frag:Gj,node_uv_projection_ar_frag:Qj,node_vector_to_rgb_ar_frag:Hj,node_add_shader_bl_frag:Wj,node_ambient_occlusion_bl_frag:Yj,node_attribute_bl_frag:jj,node_background_bl_frag:Xj,node_bevel_bl_frag:qj,node_blackbody_bl_frag:Zj,node_brightcontrast_bl_frag:Kj,node_bsdf_anisotropic_bl_frag:$j,node_bsdf_diffuse_bl_frag:Jj,node_bsdf_glass_bl_frag:eX,node_bsdf_glossy_bl_frag:tX,node_bsdf_metallic_bl_frag:rX,node_bsdf_hair_bl_frag:nX,node_bsdf_principled_bl_frag:oX,node_bsdf_refraction_bl_frag:aX,node_bsdf_sheen_bl_frag:iX,node_bsdf_toon_bl_frag:sX,node_bsdf_translucent_bl_frag:lX,node_bsdf_transparent_bl_frag:cX,node_bsdf_velvet_bl_frag:uX,node_bump_bl_frag:dX,node_camera_bl_frag:fX,node_clamp_bl_frag:hX,node_combhsv_bl_frag:pX,node_combine_color_bl_frag:mX,node_combrgb_bl_frag:gX,node_combxyz_bl_frag:vX,node_curve_float_bl_frag:_X,node_curve_rgb_bl_frag:AX,node_curve_vec_bl_frag:xX,node_diffuse_bsdf_bl_frag:yX,node_displacement_bl_frag:bX,node_eevee_specular_bl_frag:SX,node_emission_bl_frag:CX,node_fresnel_bl_frag:EX,node_gamma_bl_frag:MX,node_hair_info_bl_frag:wX,node_holdout_bl_frag:TX,node_hue_sat_bl_frag:RX,node_invert_bl_frag:IX,node_layer_weight_bl_frag:LX,node_light_falloff_bl_frag:BX,node_light_path_bl_frag:PX,node_mapping_bl_frag:NX,node_map_range_bl_frag:DX,node_math_bl_frag:OX,node_mix_bl_frag:FX,node_mix_rgb_bl_frag:UX,node_mix_shader_bl_frag:zX,node_new_geometry_bl_frag:VX,node_normal_bl_frag:kX,node_normal_map_bl_frag:GX,node_object_info_bl_frag:QX,node_output_lamp_bl_frag:HX,node_output_material_bl_frag:WX,node_output_world_bl_frag:YX,node_particle_info_bl_frag:jX,node_point_info_bl_frag:XX,node_principled_volume_bl_frag:qX,node_rgb_bl_frag:ZX,node_rgbtobw_bl_frag:KX,node_script_bl_frag:$X,node_sephsv_bl_frag:JX,node_separate_color_bl_frag:eq,node_seprgb_bl_frag:tq,node_sepxyz_bl_frag:nq,node_shadertorgb_bl_frag:rq,node_squeeze_bl_frag:oq,node_subsurface_scattering_bl_frag:aq,node_tangent_bl_frag:iq,node_tex_brick_bl_frag:sq,node_tex_checker_bl_frag:lq,node_tex_coord_bl_frag:cq,node_tex_environment_bl_frag:uq,node_tex_environment_none_bl_frag:dq,node_tex_gabor_bl_frag:fq,node_tex_gradient_bl_frag:hq,node_tex_ies_bl_frag:pq,node_tex_image_bl_frag:mq,node_tex_image_none_bl_frag:gq,node_tex_magic_bl_frag:vq,node_tex_musgrave_bl_frag:_q,node_tex_noise_bl_frag:Aq,node_tex_pointdensity_bl_frag:xq,node_tex_sky_bl_frag:yq,node_tex_voronoi_bl_frag:bq,node_tex_wave_bl_frag:Sq,node_tex_white_noise_bl_frag:Cq,node_uvmap_bl_frag:Eq,node_valtorgb_bl_frag:Mq,node_value_bl_frag:wq,node_vect_math_bl_frag:Tq,node_vect_transform_bl_frag:Rq,node_vector_displacement_bl_frag:Iq,node_vector_rotate_bl_frag:Lq,node_vertex_color_bl_frag:Bq,node_volume_absorption_bl_frag:Pq,node_volume_info_bl_frag:Nq,node_volume_scatter_bl_frag:Dq,node_wavelength_bl_frag:Oq,node_wireframe_bl_frag:Fq,node_bitmap_none_mx_frag:Uq,node_bitmap_env_mx_frag:zq,node_bitmap_mx_frag:Vq,node_bump_mx_frag:kq,node_blend_mx_frag:Gq,node_color_correction_mx_frag:Qq,node_color_map_mx_frag:Hq,node_composite_layer_mx_frag:Wq,node_falloff_mx_frag:Yq,node_gradient_mx_frag:jq,node_gradient_ramp_mx_frag:Xq,node_map_mx_frag:qq,node_mask_mx_frag:Zq,node_material_mx_frag:Kq,node_matte_shadow_mx_frag:$q,node_mix_mx_frag:Jq,node_noise_mx_frag:eZ,node_normal_bump_mx_frag:tZ,node_openpbr_surface_mx_frag:nZ,node_output_map_mx_frag:rZ,node_output_mx_frag:oZ,node_physical_mx_frag:aZ,node_phy_sun_sky_env_mx_frag:iZ,node_reflect_refract_mx_frag:sZ,node_reflect_refract_color_mx_frag:lZ,node_rgb_multiply_mx_frag:cZ,node_rgb_tint_mx_frag:uZ,node_rgb_mx_frag:dZ,node_shellac_mx_frag:fZ,node_sub_transform_mx_frag:hZ,node_value_mx_frag:pZ,node_vertex_color_mx_frag:mZ,node_add_double_linear_my_frag:gZ,node_add_matrix_my_frag:vZ,node_anim_curve_ta_my_frag:_Z,node_anim_curve_tu_my_frag:AZ,node_blend_colors_my_frag:xZ,node_bulge_my_frag:bZ,node_blinn_my_frag:yZ,node_bump_2d_my_frag:SZ,node_channels_my_frag:CZ,node_checker_my_frag:EZ,node_clamp_my_frag:MZ,node_cloth_my_frag:wZ,node_color_condition_my_frag:TZ,node_color_composite_my_frag:RZ,node_color_constant_my_frag:IZ,node_color_correct_my_frag:LZ,node_color_logic_my_frag:BZ,node_color_mask_my_frag:PZ,node_color_math_my_frag:NZ,node_compose_matrix_my_frag:DZ,node_condition_my_frag:OZ,node_decompose_matrix_my_frag:FZ,node_env_sphere_my_frag:UZ,node_file_my_frag:zZ,node_float_condition_my_frag:VZ,node_float_composite_my_frag:kZ,node_float_constant_my_frag:GZ,node_float_logic_my_frag:QZ,node_float_mask_my_frag:HZ,node_float_math_my_frag:WZ,node_four_by_four_matrix_my_frag:YZ,node_gamma_correct_my_frag:jZ,node_grid_my_frag:XZ,node_inverse_matrix_my_frag:qZ,node_lambert_my_frag:ZZ,node_layered_texture_layer_my_frag:KZ,node_luminance_my_frag:$Z,node_multiply_divide_my_frag:JZ,node_mult_double_linear_my_frag:eK,node_mult_matrix_my_frag:tK,node_noise_my_frag:nK,node_openpbr_surface_my_frag:rK,node_output_my_frag:oK,node_place_2d_texture_my_frag:sK,node_phong_my_frag:aK,node_phong_e_my_frag:iK,node_premultiply_my_frag:lK,node_ramp_my_frag:cK,node_remap_hsv_my_frag:uK,node_reverse_my_frag:dK,node_sampler_info_my_frag:fK,node_set_range_my_frag:hK,node_shading_engine_my_frag:pK,node_sub_transform_my_frag:mK,node_surface_shader_my_frag:gK,node_transform_my_frag:vK,node_transpose_matrix_my_frag:_K,node_unit_conversion_my_frag:AK,node_unpremultiply_my_frag:xK,node_vector_product_my_frag:yK,node_wt_add_matrix_my_frag:bK,pp_plane_vert:SK,pp_afterimage_frag:EK,pp_bloom_composite_frag:MK,pp_bloom_lum_high_pass_frag:wK,pp_bloom_separable_blur_frag:TK,pp_blur_frag:RK,pp_brightness_contrast_frag:LK,pp_bokeh_frag:IK,pp_copy_frag:BK,pp_cube_octahedral_proj_frag:PK,pp_fxaa_frag:NK,pp_grayscale_frag:DK,pp_gtao_blur_frag:OK,pp_gtao_frag:FK,pp_outline_edge_frag:UK,pp_outline_blur_frag:zK,pp_outline_overlay_frag:VK,pp_tonemap_frag:kK,pp_oit_weighted_frag:CK,raw_meshline_vert:GK,raw_meshline_frag:QK},Ze={common:{diffuse:{value:new Qe(16777215)},opacity:{value:1},map:{value:null},uvTransform:{value:new Qr},uv2Transform:{value:new Qr},alphaMap:{value:null},alphaTest:{value:0}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new Ee(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Qe(16777215)}},lights:{ambientLightColor:{value:[],needsUpdate:!0},lightProbe:{value:[],needsUpdate:!0},directionalLights:{value:[],needsUpdate:!0},directionalLightShadowsCSM:{value:[],needsUpdate:!0},directionalLightShadowsCSMCascade:{value:[],needsUpdate:!0},directionalShadowCSMMap:{value:[]},directionalShadowCSMMatrix:{value:[]},spotLights:{value:[],needsUpdate:!0},spotLightShadows:{value:[],needsUpdate:!0},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],needsUpdate:!0},pointLightShadows:{value:[],needsUpdate:!0},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],needsUpdate:!0},rectAreaLights:{value:[],needsUpdate:!0},rectAreaLightShadows:{value:[],needsUpdate:!0},rectAreaShadowMap:{value:[]},rectAreaShadowMatrix:{value:[]},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new Qe(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new Qr}},sprite:{diffuse:{value:new Qe(16777215)},opacity:{value:1},center:{value:new Ee(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new Qr}},mask:{depthTexture:{value:null},cameraNearFar:{value:new Ee(.5,.5)},textureMatrix:{value:new Ve}},node:{nodeRGB:{value:[]},nodeValue:{value:[]},nodeInputsFloat:{value:[]},nodeInputsInt:{value:[]},nodeInputsBool:{value:[]},nodeInputsVec2:{value:[]},nodeInputsVec3:{value:[]},nodeInputsVec4:{value:[]},nodeInputsMat3:{value:[]},nodeInputsMat4:{value:[]},flipCubeMap:{value:-1},materialIndex:{value:0}},nodeGTAO:{gtaoMap:{value:null}},ssr:{invProjectionMatrix:{value:new Ve},ssrSourceBuffer:{value:null},ssrDepthBuffer:{value:null},ssrBackfaceDepthBuffer:{value:null},ssrStride:{value:20},ssrResolution:{value:new Ee},ssrThickness:{value:.01},ssrJitter:{value:1},ssrMaxDistance:{value:100}},planeReflectionProbe:{planeReflTexture:{value:null},planeReflTextureMatrix:{value:new Ve},planeReflDir:{value:new B},planeReflBoundingBoxMin:{value:new B},planeReflBoundingBoxMax:{value:new B},planeReflInvModelMatrix:{value:new Ve},planeReflFalloff:{value:0}}},xt={basic:{uniforms:go([Ze.common,Ze.specularmap,Ze.envmap,Ze.aomap,Ze.lightmap,Ze.fog]),vertexShader:Ye.meshbasic_vert,fragmentShader:Ye.meshbasic_frag},lambert:{uniforms:go([Ze.common,Ze.specularmap,Ze.envmap,Ze.aomap,Ze.lightmap,Ze.emissivemap,Ze.bumpmap,Ze.normalmap,Ze.displacementmap,Ze.fog,Ze.lights,{emissive:{value:new Qe(0)}}]),vertexShader:Ye.meshlambert_vert,fragmentShader:Ye.meshlambert_frag},standard:{uniforms:go([Ze.common,Ze.envmap,Ze.aomap,Ze.lightmap,Ze.emissivemap,Ze.bumpmap,Ze.normalmap,Ze.displacementmap,Ze.roughnessmap,Ze.metalnessmap,Ze.fog,Ze.lights,Ze.planeReflectionProbe,{emissive:{value:new Qe(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1},envMapParallaxType:{value:0},envMapParallaxMatrix:{value:new Ve},envMapParallaxMatrixInv:{value:new Ve}}]),vertexShader:Ye.meshphysical_vert,fragmentShader:Ye.meshphysical_frag},points:{uniforms:go([Ze.points,Ze.fog]),vertexShader:Ye.points_vert,fragmentShader:Ye.points_frag},dashed:{uniforms:go([Ze.common,Ze.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Ye.linedashed_vert,fragmentShader:Ye.linedashed_frag},depth:{uniforms:go([Ze.common,Ze.displacementmap,{slopeScaledBias:{value:0}}]),vertexShader:Ye.depth_vert,fragmentShader:Ye.depth_frag},normal:{uniforms:go([Ze.common,Ze.bumpmap,Ze.normalmap,Ze.displacementmap,{opacity:{value:1}}]),vertexShader:Ye.meshnormal_vert,fragmentShader:Ye.meshnormal_frag},sprite:{uniforms:go([Ze.sprite,Ze.fog]),vertexShader:Ye.sprite_vert,fragmentShader:Ye.sprite_frag},background:{uniforms:{uvTransform:{value:new Qr},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:Ye.background_vert,fragmentShader:Ye.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1}},vertexShader:Ye.backgroundCube_vert,fragmentShader:Ye.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:Ye.cube_vert,fragmentShader:Ye.cube_frag},equirect:{uniforms:{tEquirect:{value:null},invertU:{value:!1},offsetU:{value:0}},vertexShader:Ye.equirect_vert,fragmentShader:Ye.equirect_frag},distanceRGBA:{uniforms:go([Ze.common,Ze.displacementmap,{referencePosition:{value:new B},nearDistance:{value:1},farDistance:{value:1e3},slopeScaledBias:{value:0}}]),vertexShader:Ye.distanceRGBA_vert,fragmentShader:Ye.distanceRGBA_frag},shadow:{uniforms:go([Ze.lights,Ze.fog,{color:{value:new Qe(0)},opacity:{value:1}}]),vertexShader:Ye.shadow_vert,fragmentShader:Ye.shadow_frag},mask:{uniforms:go([Ze.common,Ze.displacementmap,Ze.mask]),vertexShader:Ye.mask_vert,fragmentShader:Ye.mask_frag},node:{uniforms:go([Ze.common,Ze.displacementmap,Ze.envmap,Ze.fog,Ze.lights,Ze.ssr,Ze.planeReflectionProbe,Ze.node,Ze.nodeGTAO,{envMapIntensity:{value:1},envMapParallaxType:{value:0},envMapParallaxMatrix:{value:new Ve},envMapParallaxMatrixInv:{value:new Ve}}]),vertexShader:Ye.meshnode_vert,fragmentShader:Ye.meshnode_frag},cubeOctahedral:{uniforms:{tCube:{value:null},texelSize:{value:new Ee(.5,.5)}},vertexShader:Ye.pp_plane_vert,fragmentShader:Ye.pp_cube_octahedral_proj_frag}};xt.physical={uniforms:go([xt.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new Ee(1,1)},clearcoatNormalMap:{value:null},transmission:{value:0},transmissionMap:{value:null},transmissionSamplerSize:{value:new Ee},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},attenuationDistance:{value:0},attenuationColor:{value:new Qe(0)},specularIntensity:{value:1},specularIntensityMap:{value:null},specularColor:{value:new Qe(1,1,1)},specularColorMap:{value:null}}]),vertexShader:Ye.meshphysical_vert,fragmentShader:Ye.meshphysical_frag},xt.copy={uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:Ye.pp_plane_vert,fragmentShader:Ye.pp_copy_frag},xt.bokeh={defines:{DEPTH_PACKING:1,PERSPECTIVE_CAMERA:1},uniforms:{tColor:{value:null},tDepth:{value:null},focus:{value:1},aspect:{value:1},aperture:{value:.025},maxblur:{value:1},nearClip:{value:1},farClip:{value:1e3},depthLeakThreshold:{value:.2}},vertexShader:Ye.pp_plane_vert,fragmentShader:Ye.pp_bokeh_frag},xt.fxaa={defines:{FXAA_GLSL_100:1,FXAA_GLSL_130:0,FXAA_QUALITY_PRESET:12,FXAA_GREEN_AS_LUMA:1},uniforms:{tDiffuse:{value:null},resolution:{value:new Ee(1/1024,1/512)}},vertexShader:Ye.pp_plane_vert,fragmentShader:Ye.pp_fxaa_frag},xt.grayscale={uniforms:{tDiffuse:{value:null}},vertexShader:Ye.pp_plane_vert,fragmentShader:Ye.pp_grayscale_frag},xt.brightness_contrast={uniforms:{tDiffuse:{value:null},brightness:{value:0},contrast:{value:0}},vertexShader:Ye.pp_plane_vert,fragmentShader:Ye.pp_brightness_contrast_frag},xt.bloomLumHighPass={uniforms:{tDiffuse:{type:"t",value:null},luminosityThreshold:{type:"f",value:1},smoothWidth:{type:"f",value:1},defaultColor:{type:"c",value:new Qe(0)},defaultOpacity:{type:"f",value:0}},vertexShader:Ye.pp_plane_vert,fragmentShader:Ye.pp_bloom_lum_high_pass_frag},xt.blur={defines:{LOG_SPACE:0,OCTAHEDRAL_MAP:0},uniforms:{colorTexture:{value:null},texSize:{value:new Ee(.5,.5)},direction:{value:new Ee(.5,.5)},kernelRadius:{value:1}},customPrepTokens:{MAX_SAMPLE_RADIUS:4},vertexShader:Ye.pp_plane_vert,fragmentShader:Ye.pp_blur_frag},xt.tonemap={defines:{ALPHA_AS_LUMA:0},uniforms:{tDiffuse:{value:null}},vertexShader:Ye.pp_plane_vert,fragmentShader:Ye.pp_tonemap_frag},xt.afterimage={uniforms:{damp:{value:.96},tOld:{value:null},tNew:{value:null}},vertexShader:Ye.pp_plane_vert,fragmentShader:Ye.pp_afterimage_frag},xt.oitWeighted={uniforms:{tRGBABuffer:{value:null},tFloatBuffer:{value:null}},vertexShader:Ye.pp_plane_vert,fragmentShader:Ye.pp_oit_weighted_frag};const Xm={r:0,b:0,g:0};function HK(o,e,t,n,r,a,i){const s=new Qe(0);let c,u,h=a===!0?0:1,f=null,m=0,g=null;function A(_,x){_.getRGB(Xm,y5(o)),n.buffers.color.setClear(Xm.r,Xm.g,Xm.b,x,i)}return{getClearColor:function(){return s},setClearColor:function(_,x=1){s.set(_),h=x,A(s,h)},getClearAlpha:function(){return h},setClearAlpha:function(_){h=_,A(s,h)},dispose:function(){c&&(c.geometry.dispose(),c.material.dispose()),c=void 0,u&&(u.geometry.dispose(),u.material.dispose()),u=void 0},render:function(_,x){let C=!1,b=x.isScene===!0?x.background:null;b&&b.isTexture&&(b=(x.backgroundBlurriness>0?t:e).get(b));const y=o.xr,M=y.getSession&&y.getSession();M&&M.environmentBlendMode==="additive"&&(b=null),b===null?A(s,h):b&&b.isColor&&(A(b,1),C=!0),(o.autoClear||C)&&o.clear(o.autoClearColor,o.autoClearDepth,o.autoClearStencil),b&&(b.isCubeTexture||b.mapping===306)?(u===void 0&&(u=new Mt(new up(1,1,1),new An({type:"BackgroundCubeMaterial",uniforms:_d(xt.backgroundCube.uniforms),vertexShader:xt.backgroundCube.vertexShader,fragmentShader:xt.backgroundCube.fragmentShader,side:1,depthTest:!1,depthWrite:!1,fog:!1})),u.geometry.deleteAttribute("normal"),u.geometry.deleteAttribute("uv"),u.onBeforeRender=function(R,T,w){const D=w.far;this.matrixWorld.makeScale(D,D,D),this.matrixWorld.copyPosition(w.matrixWorld)},Object.defineProperty(u.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),r.update(u)),u.material.uniforms.envMap.value=b,u.material.uniforms.flipEnvMap.value=b.isCubeTexture&&b.isRenderTargetTexture===!1?-1:1,u.material.uniforms.backgroundBlurriness.value=x.backgroundBlurriness,u.material.uniforms.backgroundIntensity.value=x.backgroundIntensity,u.material.toneMapped=x.backgroundToneMapped,f===b&&m===b.version&&g===o.toneMapping||(u.material.needsUpdate=!0,f=b,m=b.version,g=o.toneMapping),u.layers.enableAll(),_.unshift(u,u.geometry,u.material,0,0,null)):b&&b.isTexture&&(c===void 0&&(c=new Mt(new ps(2,2),new An({type:"BackgroundMaterial",uniforms:_d(xt.background.uniforms),vertexShader:xt.background.vertexShader,fragmentShader:xt.background.fragmentShader,side:0,depthTest:!1,depthWrite:!1,fog:!1})),c.geometry.deleteAttribute("normal"),Object.defineProperty(c.material,"map",{get:function(){return this.uniforms.t2D.value}}),r.update(c)),c.material.uniforms.t2D.value=b,c.material.uniforms.backgroundIntensity.value=x.backgroundIntensity,c.material.toneMapped=x.backgroundToneMapped,b.matrixAutoUpdate===!0&&b.updateMatrix(),c.material.uniforms.uvTransform.value.copy(b.matrix),f===b&&m===b.version&&g===o.toneMapping||(c.material.needsUpdate=!0,f=b,m=b.version,g=o.toneMapping),c.layers.enableAll(),_.unshift(c,c.geometry,c.material,0,0,null))}}}function WK(o,e,t,n){const r=o.getParameter(34921),a=n.isWebGL2?null:e.get("OES_vertex_array_object"),i=n.isWebGL2||a!==null,s={},c=g(null);let u=c,h=!1;function f(R){return n.isWebGL2?o.bindVertexArray(R):a.bindVertexArrayOES(R)}function m(R){return n.isWebGL2?o.deleteVertexArray(R):a.deleteVertexArrayOES(R)}function g(R){const T=[],w=[],D=[];for(let z=0;z<r;z++)T[z]=0,w[z]=0,D[z]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:T,enabledAttributes:w,attributeDivisors:D,object:R,attributes:{},index:null}}function A(){const R=u.newAttributes;for(let T=0,w=R.length;T<w;T++)R[T]=0}function _(R){x(R,0)}function x(R,T){const w=u.newAttributes,D=u.enabledAttributes,z=u.attributeDivisors;w[R]=1,D[R]===0&&(o.enableVertexAttribArray(R),D[R]=1),z[R]!==T&&((n.isWebGL2?o:e.get("ANGLE_instanced_arrays"))[n.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](R,T),z[R]=T)}function C(){const R=u.newAttributes,T=u.enabledAttributes;for(let w=0,D=T.length;w<D;w++)T[w]!==R[w]&&(o.disableVertexAttribArray(w),T[w]=0)}function b(R,T,w,D,z,F){n.isWebGL2!==!0||w!==5124&&w!==5125?o.vertexAttribPointer(R,T,w,D,z,F):o.vertexAttribIPointer(R,T,w,z,F)}function y(){M(),h=!0,u!==c&&(u=c,f(u.object))}function M(){c.geometry=null,c.program=null,c.wireframe=!1}return{setup:function(R,T,w,D,z){let F=!1;if(i){const O=function(q,ne,$){const he=$.wireframe===!0;let K=s[q.id];K===void 0&&(K={},s[q.id]=K);let oe=K[ne.id];oe===void 0&&(oe={},K[ne.id]=oe);let ie=oe[he];return ie===void 0&&(ie=g(n.isWebGL2?o.createVertexArray():a.createVertexArrayOES()),oe[he]=ie),ie}(D,w,T);u!==O&&(u=O,f(u.object)),F=function(q,ne,$,he){const K=u.attributes,oe=ne.attributes;let ie=0;const L=$.getAttributes();for(const U in L)if(L[U].location>=0){const k=K[U];let J=oe[U];if(J===void 0&&(U==="instanceMatrix"&&q.instanceMatrix&&(J=q.instanceMatrix),U==="instanceColor"&&q.instanceColor&&(J=q.instanceColor)),k===void 0||k.attribute!==J||J&&k.data!==J.data)return!0;ie++}return u.attributesNum!==ie||u.index!==he}(R,D,w,z),F&&function(q,ne,$,he){const K={},oe=ne.attributes;let ie=0;const L=$.getAttributes();for(const U in L)if(L[U].location>=0){let k=oe[U];k===void 0&&(U==="instanceMatrix"&&q.instanceMatrix&&(k=q.instanceMatrix),U==="instanceColor"&&q.instanceColor&&(k=q.instanceColor));const J={};J.attribute=k,k&&k.data&&(J.data=k.data),K[U]=J,ie++}u.attributes=K,u.attributesNum=ie,u.index=he}(R,D,w,z)}else{const O=T.wireframe===!0;u.geometry===D.id&&u.program===w.id&&u.wireframe===O||(u.geometry=D.id,u.program=w.id,u.wireframe=O,F=!0)}z!==null&&t.update(z,34963),(F||h)&&(h=!1,function(O,q,ne,$){if(n.isWebGL2===!1&&(O.isInstancedMesh||$.isInstancedBufferGeometry)&&e.get("ANGLE_instanced_arrays")===null)return;A();const he=$.attributes,K=ne.getAttributes(),oe=q.defaultAttributeValues;for(const ie in K){const L=K[ie];if(L.location>=0){let U=he[ie];if(U===void 0&&(ie==="instanceMatrix"&&O.instanceMatrix&&(U=O.instanceMatrix),ie==="instanceColor"&&O.instanceColor&&(U=O.instanceColor)),U!==void 0){const k=U.normalized,J=U.itemSize,de=t.get(U);if(de===void 0)continue;const te=de.buffer,le=de.type,V=de.bytesPerElement;if(U.isInterleavedBufferAttribute){const G=U.data,ee=G.stride,X=U.offset;if(G.isInstancedInterleavedBuffer){for(let W=0;W<L.locationSize;W++)x(L.location+W,G.meshPerAttribute);O.isInstancedMesh!==!0&&$._maxInstanceCount===void 0&&($._maxInstanceCount=G.meshPerAttribute*G.count)}else for(let W=0;W<L.locationSize;W++)_(L.location+W);o.bindBuffer(34962,te);for(let W=0;W<L.locationSize;W++)b(L.location+W,J/L.locationSize,le,k,ee*V,(X+J/L.locationSize*W)*V)}else{if(U.isInstancedBufferAttribute){for(let G=0;G<L.locationSize;G++)x(L.location+G,U.meshPerAttribute);O.isInstancedMesh!==!0&&$._maxInstanceCount===void 0&&($._maxInstanceCount=U.meshPerAttribute*U.count)}else for(let G=0;G<L.locationSize;G++)_(L.location+G);o.bindBuffer(34962,te);for(let G=0;G<L.locationSize;G++)b(L.location+G,J/L.locationSize,le,k,J*V,J/L.locationSize*G*V)}}else if(oe!==void 0){const k=oe[ie];if(k!==void 0)switch(k.length){case 2:o.vertexAttrib2fv(L.location,k);break;case 3:o.vertexAttrib3fv(L.location,k);break;case 4:o.vertexAttrib4fv(L.location,k);break;default:o.vertexAttrib1fv(L.location,k)}}}}C()}(R,T,w,D),z!==null&&o.bindBuffer(34963,t.get(z).buffer))},reset:y,resetDefaultState:M,dispose:function(){y();for(const R in s){const T=s[R];for(const w in T){const D=T[w];for(const z in D)m(D[z].object),delete D[z];delete T[w]}delete s[R]}},releaseStatesOfGeometry:function(R){if(s[R.id]===void 0)return;const T=s[R.id];for(const w in T){const D=T[w];for(const z in D)m(D[z].object),delete D[z];delete T[w]}delete s[R.id]},releaseStatesOfProgram:function(R){for(const T in s){const w=s[T];if(w[R.id]===void 0)continue;const D=w[R.id];for(const z in D)m(D[z].object),delete D[z];delete w[R.id]}},initAttributes:A,enableAttribute:_,disableUnusedAttributes:C}}function YK(o,e,t,n){const r=n.isWebGL2;let a;this.setMode=function(i){a=i},this.render=function(i,s){o.drawArrays(a,i,s),t.update(s,a,1)},this.renderInstances=function(i,s,c){if(c===0)return;let u,h;if(r)u=o,h="drawArraysInstanced";else if(u=e.get("ANGLE_instanced_arrays"),h="drawArraysInstancedANGLE",u===null)return void console.error("v3d.WebGLBufferRenderer: using v3d.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");u[h](a,i,s,c),t.update(s,a,c)}}function jK(o,e,t){let n;function r(M){if(M==="highp"){if(o.getShaderPrecisionFormat(35633,36338).precision>0&&o.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";M="mediump"}return M==="mediump"&&o.getShaderPrecisionFormat(35633,36337).precision>0&&o.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}const a=typeof WebGL2RenderingContext<"u"&&o instanceof WebGL2RenderingContext||typeof WebGL2ComputeRenderingContext<"u"&&o instanceof WebGL2ComputeRenderingContext;let i=t.precision!==void 0?t.precision:"highp";const s=r(i);s!==i&&(console.warn("v3d.WebGLRenderer:",i,"not supported, using",s,"instead."),i=s);const c=a||e.has("WEBGL_draw_buffers"),u=t.logarithmicDepthBuffer===!0,h=o.getParameter(34930),f=o.getParameter(35660),m=o.getParameter(3379),g=o.getParameter(34076),A=o.getParameter(34921),_=o.getParameter(36347),x=o.getParameter(36348),C=o.getParameter(36349),b=f>0,y=a||e.has("OES_texture_float");return{isWebGL2:a,drawBuffers:c,getMaxAnisotropy:function(){if(n!==void 0)return n;if(e.has("EXT_texture_filter_anisotropic")===!0){const M=e.get("EXT_texture_filter_anisotropic");n=o.getParameter(M.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else n=0;return n},getMaxPrecision:r,precision:i,logarithmicDepthBuffer:u,maxTextures:h,maxVertexTextures:f,maxTextureSize:m,maxCubemapSize:g,maxAttributes:A,maxVertexUniforms:_,maxVaryings:x,maxFragmentUniforms:C,vertexTextures:b,floatFragmentTextures:y,floatVertexTextures:b&&y,maxSamples:a?o.getParameter(36183):0}}function XK(o){const e=this;let t=null,n=0,r=!1,a=!1;const i=new _o,s=new Qr,c={value:null,needsUpdate:!1};function u(){c.value!==t&&(c.value=t,c.needsUpdate=n>0),e.numPlanes=n,e.numIntersection=0}function h(f,m,g,A){const _=f!==null?f.length:0;let x=null;if(_!==0){if(x=c.value,A!==!0||x===null){const C=g+4*_,b=m.matrixWorldInverse;s.getNormalMatrix(b),(x===null||x.length<C)&&(x=new Float32Array(C));for(let y=0,M=g;y!==_;++y,M+=4)i.copy(f[y]).applyMatrix4(b,s),i.normal.toArray(x,M),x[M+3]=i.constant}c.value=x,c.needsUpdate=!0}return e.numPlanes=_,e.numIntersection=0,x}this.uniform=c,this.numPlanes=0,this.numIntersection=0,this.init=function(f,m,g){const A=f.length!==0||m||n!==0||r;return r=m,t=h(f,g,0),n=f.length,A},this.beginShadows=function(){a=!0,h(null)},this.endShadows=function(){a=!1,u()},this.setState=function(f,m,g){const A=f.clippingPlanes,_=f.clipIntersection,x=f.clipShadows,C=o.get(f);if(!r||A===null||A.length===0||a&&!x)a?h(null):u();else{const b=a?0:n,y=4*b;let M=C.clippingState||null;c.value=M,M=h(A,m,y,g);for(let R=0;R!==y;++R)M[R]=t[R];C.clippingState=M,this.numIntersection=_?this.numPlanes:0,this.numPlanes+=b}}}function qK(o){let e=new WeakMap;function t(r,a){return a===303?r.mapping=301:a===304&&(r.mapping=302),r}function n(r){const a=r.target;a.removeEventListener("dispose",n);const i=e.get(a);i!==void 0&&(e.delete(a),i.dispose())}return{get:function(r){if(r&&r.isTexture&&r.isRenderTargetTexture===!1){const a=r.mapping;if(a===303||a===304){if(e.has(r))return t(e.get(r).texture,r.mapping);{const i=r.image;if(i&&i.height>0){const s=new fp(i.height/2);return s.fromEquirectangularTexture(o,r),e.set(r,s),r.addEventListener("dispose",n),t(s.texture,r.mapping)}return null}}}return r},dispose:function(){e=new WeakMap}}}class yi extends dp{constructor(e=-1,t=1,n=1,r=-1,a=.1,i=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=n,this.bottom=r,this.near=a,this.far=i,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=e.view===null?null:Object.assign({},e.view),this}setViewOffset(e,t,n,r,a,i){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=r,this.view.width=a,this.view.height=i,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,r=(this.top+this.bottom)/2;let a=n-e,i=n+e,s=r+t,c=r-t;if(this.view!==null&&this.view.enabled){const u=(this.right-this.left)/this.view.fullWidth/this.zoom,h=(this.top-this.bottom)/this.view.fullHeight/this.zoom;a+=u*this.view.offsetX,i=a+u*this.view.width,s-=h*this.view.offsetY,c=s-h*this.view.height}this.projectionMatrix.makeOrthographic(a,i,s,c,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}}class pp extends An{constructor(e){super(e),this.isRawShaderMaterial=!0,this.type="RawShaderMaterial"}}let Gg=256;const id=[{relSize:1,sigma:0,origin:[0,0]},{relSize:.5,sigma:.025,origin:[0,2/3]},{relSize:1/4,sigma:.07,origin:[.5,2/3]},{relSize:1/8,sigma:.18,origin:[.75,2/3]},{relSize:1/16,sigma:.24,origin:[.875,2/3]},{relSize:1/16,sigma:.3,origin:[.875,17/24]},{relSize:1/16,sigma:.36,origin:[.875,.75]},{relSize:1/16,sigma:.42,origin:[.875,19/24]},{relSize:1/16,sigma:.48,origin:[.875,20/24]},{relSize:1/16,sigma:.54,origin:[.875,.875]},{relSize:1/16,sigma:.6,origin:[.875,22/24]}];function el(o){return id[o].relSize*Gg}function ZK(o){return id[o].origin.map(function(e){return e*Gg*3})}const qm=new yi,Eu=KK(),mM=new Qe;let IA=null;const uc=(1+Math.sqrt(5))/2,Mu=1/uc,gM=[new B(1,1,1),new B(-1,1,1),new B(1,1,-1),new B(-1,1,-1),new B(0,uc,Mu),new B(0,uc,-Mu),new B(Mu,0,uc),new B(-Mu,0,uc),new B(uc,Mu,0),new B(-uc,Mu,0)];class jh{constructor(e,t){this._renderer=e,this._pingPongRenderTarget=null,this._equirectShader=null,this._cubemapShader=null,this.flipCubemapX=!1,Object.defineProperties(this,{maxTileSize:{get:function(){return Gg},set:function(n){Gg=n}}}),t!==void 0&&(this.maxTileSize=t),this._blurMaterial=$K(20,this.maxTileSize),this._compileMaterial(this._blurMaterial)}fromScene(e,t=0,n=.1,r=100){IA=this._renderer.getRenderTarget();const a=this._allocateTargets();return this._sceneToCubeUV(e,n,r,a),t>0&&this._blur(a,0,0,t),this._applyPMREM(a),this._cleanup(a),a}fromEquirectangular(e){return e.magFilter=1006,e.minFilter=1006,e.generateMipmaps=!1,this.fromCubemap(e)}fromCubemap(e){IA=this._renderer.getRenderTarget();const t=this._allocateTargets(e);return this._textureToCubeUV(e,t,this.flipCubemapX),this._applyPMREM(t),this._cleanup(t),t}fromCubeRenderTarget(e,t){const n=this._allocateTargets(e.texture,t);return this._cubeRTToCubeUV(e,n,this.flipCubemapX),this._applyPMREM(n),this._cleanup(n),n}compileCubemapShader(){this._cubemapShader===null&&(this._cubemapShader=LA(),this._compileMaterial(this._cubemapShader))}compileEquirectangularShader(){this._equirectShader===null&&(this._equirectShader=_M(),this._compileMaterial(this._equirectShader))}dispose(){this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose(),this._cubemapShader!==null&&this._cubemapShader.dispose(),this._equirectShader!==null&&this._equirectShader.dispose();for(let e=0;e<Eu.length;e++)Eu[e].dispose();this._renderer=null}_cleanup(e){this._renderer.setRenderTarget(IA),e.scissorTest=!1,e.setSize(e.width,e.height)}_allocateTargets(e,t){const n={magFilter:1006,minFilter:1006,generateMipmaps:!1,type:e?e.type:1016,format:e?e.format:1023,encoding:e?e.encoding:3e3,depthBuffer:!1,stencilBuffer:!1};t!==void 0&&Object.assign(n,t);const r=vM(n);return r.depthBuffer=!e,this._pingPongRenderTarget===null&&(this._pingPongRenderTarget=vM(n)),r}_compileMaterial(e){const t=new Hr;t.add(new Mt(Eu[0],e)),this._renderer.compile(t,qm)}_sceneToCubeUV(e,t,n,r){const a=new ir(90,1,t,n),i=[1,1,1,1,-1,1],s=[1,1,-1,-1,-1,1],c=this._renderer,u=c.outputEncoding,h=c.toneMapping,f=c.toneMappingExposure;c.getClearColor(mM);const m=c.getClearAlpha();c.toneMapping=1,c.toneMappingExposure=1,c.outputEncoding=3e3,e.scale.z*=-1;let g=e.background;if(g&&g.isColor){g.convertSRGBToLinear();const A=Math.max(g.r,g.g,g.b),_=Math.min(Math.max(Math.ceil(Math.log2(A)),-128),127);g=g.multiplyScalar(Math.pow(2,-_));const x=(_+128)/255;c.setClearColor(g,x),e.background=null}for(let A=0;A<6;A++){const _=A%3;_===0?(a.up.set(0,i[A],0),a.lookAt(s[A],0,0)):_===1?(a.up.set(0,0,i[A]),a.lookAt(0,s[A],0)):(a.up.set(0,i[A],0),a.lookAt(0,0,s[A]));const x=el(0);Zm(r,_*x,A>2?x:0,x,x),c.setRenderTarget(r),c.render(e,a)}c.toneMapping=h,c.toneMappingExposure=f,c.outputEncoding=u,c.setClearColor(mM,m),e.scale.z*=-1}_textureToCubeUV(e,t,n){const r=this._renderer,a=new Hr;e.isCubeTexture?this._cubemapShader===null&&(this._cubemapShader=LA()):this._equirectShader===null&&(this._equirectShader=_M());const i=e.isCubeTexture?this._cubemapShader:this._equirectShader;a.add(new Mt(Eu[0],i));const s=i.uniforms;s.envMap.value=e,e.isCubeTexture?s.flipCubemapX.value=n||!1:s.texelSize.value.set(1/e.image.width,1/e.image.height);const c=el(0);Zm(t,0,0,3*c,2*c),r.setRenderTarget(t),r.render(a,qm)}_applyPMREM(e){const t=this._renderer,n=t.autoClear;t.autoClear=!1;for(let r=1;r<id.length;r++){const a=id[r].sigma,i=id[r-1].sigma,s=Math.sqrt(a*a-i*i),c=gM[(r-1)%gM.length];this._blur(e,r-1,r,s,c)}t.autoClear=n}_blur(e,t,n,r,a){const i=this._pingPongRenderTarget;this._halfBlur(e,i,t,n,r,"latitudinal",a),this._halfBlur(i,e,n,n,r,"longitudinal",a)}_halfBlur(e,t,n,r,a,i,s){const c=this._renderer,u=this._blurMaterial;i!=="latitudinal"&&i!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");const h=new Hr;h.add(new Mt(Eu[r],u));const f=u.uniforms,m=el(n)-1;let g=isFinite(a)?Math.PI/(2*m):2*Math.PI/39,A=a/g,_=isFinite(a)?1+Math.floor(3*A):20;_>20&&(_=20,A=19/3,g=a/A);const x=[];let C=0;for(let R=0;R<20;++R){const T=R/A,w=Math.exp(-T*T/2);x.push(w),R===0?C+=w:R<_&&(C+=2*w)}for(let R=0;R<x.length;R++)x[R]=x[R]/C;f.envMap.value=e.texture,f.samples.value=_,f.weights.value=x,f.latitudinal.value=i==="latitudinal",s&&(f.poleAxis.value=s),f.dTheta.value=g,f.lodIdx.value=n,u.defines.cubeUV_maxTileSize=al(el(0));const[b,y]=ZK(r),M=el(r);Zm(t,b,y,3*M,2*M),c.setRenderTarget(t),c.render(h,qm)}_cubeRTToCubeUV(e,t,n){const r=this._renderer,a=new Hr;this._cubemapShader==null&&(this._cubemapShader=LA());const i=this._cubemapShader;a.add(new Mt(Eu[0],i));const s=i.uniforms;s.envMap.value=e.texture,s.flipCubemapX.value=n||!1;const c=el(0);Zm(t,0,0,3*c,2*c),r.setRenderTarget(t),r.render(a,qm)}}function KK(){return id.map(function(o,e){const t=1/(el(e)-1),n=-t/2,r=1+t/2,a=[n,n,r,n,r,r,n,n,r,r,n,r],i=new Float32Array(108),s=new Float32Array(72),c=new Float32Array(36);for(let h=0;h<6;h++){const f=h%3*2/3-1,m=h>2?0:-1,g=[f,m,0,f+2/3,m,0,f+2/3,m+1,0,f,m,0,f+2/3,m+1,0,f,m+1,0];i.set(g,18*h),s.set(a,12*h);const A=[h,h,h,h,h,h];c.set(A,6*h)}const u=new mt;return u.setAttribute("position",new $e(i,3)),u.setAttribute("uv",new $e(s,2)),u.setAttribute("faceIndex",new $e(c,1)),u})}function vM(o){const e=el(0),t=new qt(3*e,3*e,o);return t.texture.mapping=306,t.texture.name="PMREM.cubeUV",t.scissorTest=!0,t}function Zm(o,e,t,n,r){o.viewport.set(e,t,n,r),o.scissor.set(e,t,n,r)}function $K(o,e){const t=new Float32Array(o),n=new B(0,1,0),r=new pp({defines:{n:o,cubeUV_maxTileSize:al(e)},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:t},latitudinal:{value:!1},dTheta:{value:0},lodIdx:{value:0},poleAxis:{value:n}},vertexShader:Qy(),fragmentShader:`

            precision highp float;
            precision highp int;

            varying vec3 vOutputDirection;

            uniform sampler2D envMap;
            uniform int samples;
            uniform float weights[n];
            uniform bool latitudinal;
            uniform float dTheta;
            uniform float lodIdx;
            uniform vec3 poleAxis;

            #define ENVMAP_TYPE_CUBE_UV
            #include <cube_uv_reflection_fragment>

            vec3 getSample(float theta, vec3 axis) {

                float cosTheta = cos(theta);
                // Rodrigues' axis-angle rotation
                vec3 sampleDirection = vOutputDirection * cosTheta
                    + cross(axis, vOutputDirection) * sin(theta)
                    + axis * dot(axis, vOutputDirection) * (1.0 - cosTheta);

                return bilinearCubeUV(envMap, sampleDirection, lodIdx);

            }

            void main() {

                vec3 axis = latitudinal ? poleAxis : cross(poleAxis, vOutputDirection);

                if (all(equal(axis, vec3(0.0)))) {

                    axis = vec3(vOutputDirection.z, 0.0, - vOutputDirection.x);

                }

                axis = normalize(axis);

                gl_FragColor = vec4(0.0);
                gl_FragColor.rgb += weights[0] * getSample(0.0, axis);

                for (int i = 1; i < n; i++) {

                    if (i >= samples) {

                        break;

                    }

                    float theta = dTheta * float(i);
                    gl_FragColor.rgb += weights[i] * getSample(-1.0 * theta, axis);
                    gl_FragColor.rgb += weights[i] * getSample(theta, axis);

                }

            }
        `,blending:0,depthTest:!1,depthWrite:!1});return r.type="SphericalGaussianBlur",r}function _M(){const o=new Ee(1,1),e=new pp({uniforms:{envMap:{value:null},texelSize:{value:o}},vertexShader:Qy(),fragmentShader:`

            precision mediump float;
            precision mediump int;

            varying vec3 vOutputDirection;

            uniform sampler2D envMap;
            uniform vec2 texelSize;

            #define RECIPROCAL_PI 0.31830988618
            #define RECIPROCAL_PI2 0.15915494

            void main() {

                gl_FragColor = vec4(0.0);

                vec3 outputDirection = normalize(vOutputDirection);
                vec2 uv;
                uv.y = asin(clamp(outputDirection.y, -1.0, 1.0)) * RECIPROCAL_PI + 0.5;
                uv.x = atan(outputDirection.z, outputDirection.x) * RECIPROCAL_PI2 + 0.5;

                vec2 f = fract(uv / texelSize - 0.5);
                uv -= f * texelSize;
                vec3 tl = texture2D(envMap, uv).rgb;
                uv.x += texelSize.x;
                vec3 tr = texture2D(envMap, uv).rgb;
                uv.y += texelSize.y;
                vec3 br = texture2D(envMap, uv).rgb;
                uv.x -= texelSize.x;
                vec3 bl = texture2D(envMap, uv).rgb;

                vec3 tm = mix(tl, tr, f.x);
                vec3 bm = mix(bl, br, f.x);
                gl_FragColor.rgb = mix(tm, bm, f.y);

            }
        `,blending:0,depthTest:!1,depthWrite:!1});return e.type="EquirectangularToCubeUV",e}function LA(){const o=new pp({uniforms:{envMap:{value:null},flipCubemapX:{value:!1}},vertexShader:Qy(),fragmentShader:`

            precision mediump float;
            precision mediump int;

            uniform bool flipCubemapX;

            varying vec3 vOutputDirection;

            uniform samplerCube envMap;

            void main() {

                gl_FragColor = textureCube(envMap, vec3(vOutputDirection.x * (flipCubemapX ? -1.0 : 1.0), vOutputDirection.yz));

            }
        `,blending:0,depthTest:!1,depthWrite:!1});return o.type="CubemapToCubeUV",o}function Qy(){return`

        precision mediump float;
        precision mediump int;

        attribute vec3 position;
        attribute vec2 uv;
        attribute float faceIndex;

        varying vec3 vOutputDirection;

        // RH coordinate system; PMREM face-indexing convention
        vec3 getDirection(vec2 uv, float face) {

            uv = 2.0 * uv - 1.0;

            vec3 direction = vec3(uv, 1.0);

            if (face == 0.0) {

                direction = direction.zyx;
                direction.z *= -1.0;

            } else if (face == 1.0) {

                direction = direction.xzy;
                direction.z *= -1.0;

            } else if (face == 3.0) {

                direction = direction.zyx;
                direction.x *= -1.0;

            } else if (face == 4.0) {

                direction = direction.xzy;
                direction.y *= -1.0;

            } else if (face == 5.0) {

                direction.xz *= -1.0;

            }

            return direction;

        }

        void main() {

            vOutputDirection = getDirection(uv, faceIndex);
            gl_Position = vec4(position, 1.0);

        }
    `}function JK(o){let e=new WeakMap,t=null;function n(r){const a=r.target;a.removeEventListener("dispose",n);const i=e.get(a);i!==void 0&&(e.delete(a),i.dispose())}return{get:function(r){if(r&&r.isTexture){const a=r.mapping,i=a===303||a===304,s=a===301||a===302;if(i||s){if(r.isRenderTargetTexture&&r.needsPMREMUpdate===!0){r.needsPMREMUpdate=!1;let c=e.get(r);return t===null&&(t=new jh(o)),c=i?t.fromEquirectangular(r,c):t.fromCubemap(r,c),e.set(r,c),c.texture}if(e.has(r))return e.get(r).texture;{const c=r.image;if(i&&c&&c.height>0||s&&c&&function(u){let h=0;const f=6;for(let m=0;m<f;m++)u[m]!==void 0&&h++;return h===f}(c)){t===null&&(t=new jh(o));const u=i?t.fromEquirectangular(r):t.fromCubemap(r);return e.set(r,u),r.addEventListener("dispose",n),u.texture}return null}}}return r},dispose:function(){e=new WeakMap,t!==null&&(t.dispose(),t=null)}}}function e$(o){const e={};function t(n){if(e[n]!==void 0)return e[n];let r;switch(n){case"WEBGL_depth_texture":r=o.getExtension("WEBGL_depth_texture")||o.getExtension("MOZ_WEBGL_depth_texture")||o.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":r=o.getExtension("EXT_texture_filter_anisotropic")||o.getExtension("MOZ_EXT_texture_filter_anisotropic")||o.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":r=o.getExtension("WEBGL_compressed_texture_s3tc")||o.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||o.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":r=o.getExtension("WEBGL_compressed_texture_pvrtc")||o.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:r=o.getExtension(n)}return e[n]=r,r}return{has:function(n){return t(n)!==null},init:function(n){n.isWebGL2?t("EXT_color_buffer_float"):(t("WEBGL_depth_texture"),t("OES_texture_float"),t("OES_texture_half_float"),t("OES_texture_half_float_linear"),t("OES_standard_derivatives"),t("OES_element_index_uint"),t("OES_vertex_array_object"),t("ANGLE_instanced_arrays")),t("OES_texture_float_linear"),t("EXT_color_buffer_half_float"),t("WEBGL_multisampled_render_to_texture")},get:function(n){const r=t(n);return r===null&&console.warn("v3d.WebGLRenderer: "+n+" extension not supported."),r}}}function t$(o,e,t,n){const r={},a=new WeakMap;function i(c){const u=c.target;u.index!==null&&e.remove(u.index);for(const f in u.attributes)e.remove(u.attributes[f]);u.removeEventListener("dispose",i),delete r[u.id];const h=a.get(u);h&&(e.remove(h),a.delete(u)),n.releaseStatesOfGeometry(u),u.isInstancedBufferGeometry===!0&&delete u._maxInstanceCount,t.memory.geometries--}function s(c){const u=[],h=c.index,f=c.attributes.position;let m=0;if(h!==null){const _=h.array;m=h.version;for(let x=0,C=_.length;x<C;x+=3){const b=_[x+0],y=_[x+1],M=_[x+2];u.push(b,y,y,M,M,b)}}else{const _=f.array;m=f.version;for(let x=0,C=_.length/3-1;x<C;x+=3){const b=x+0,y=x+1,M=x+2;u.push(b,y,y,M,M,b)}}const g=new(f5(u)?x5:A5)(u,1);g.version=m;const A=a.get(c);A&&e.remove(A),a.set(c,g)}return{get:function(c,u){return r[u.id]===!0||(u.addEventListener("dispose",i),r[u.id]=!0,t.memory.geometries++),u},update:function(c){const u=c.attributes;for(const f in u)e.update(u[f],34962);const h=c.morphAttributes;for(const f in h){const m=h[f];for(let g=0,A=m.length;g<A;g++)e.update(m[g],34962)}},getWireframeAttribute:function(c){const u=a.get(c);if(u){const h=c.index;h!==null&&u.version<h.version&&s(c)}else s(c);return a.get(c)}}}function n$(o,e,t,n){const r=n.isWebGL2;let a,i,s;this.setMode=function(c){a=c},this.setIndex=function(c){i=c.type,s=c.bytesPerElement},this.render=function(c,u){o.drawElements(a,u,i,c*s),t.update(u,a,1)},this.renderInstances=function(c,u,h){if(h===0)return;let f,m;if(r)f=o,m="drawElementsInstanced";else if(f=e.get("ANGLE_instanced_arrays"),m="drawElementsInstancedANGLE",f===null)return void console.error("v3d.WebGLIndexedBufferRenderer: using v3d.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");f[m](a,u,i,c*s,h),t.update(u,a,h)}}function r$(o){const e={geometries:0,textures:0,textureSpecs:new Map},t={frame:0,calls:0,triangles:0,points:0,lines:0,customCounter:0};return{memory:e,render:t,programs:null,numShaderCompiles:0,reset:function(){t.calls=0,t.triangles=0,t.points=0,t.lines=0,t.customCounter=0},update:function(n,r,a){switch(t.calls++,r){case 4:t.triangles+=a*(n/3);break;case 1:t.lines+=a*(n/2);break;case 3:t.lines+=a*(n-1);break;case 2:t.lines+=a*n;break;case 0:t.points+=a*n;break;default:console.error("v3d.WebGLInfo: Unknown draw mode:",r)}},count:function(){t.customCounter++},addTextureSpec:function(n){let r,a,i,s,c,u;n.isWebGLRenderTarget?(r=n.texture.name,a="RenderTarget",i=n.width,s=n.height,c=n.texture.format,u=!!n.texture.isCubeTexture):(r=n.name,a="Texture",i=n.image.width,s=n.image.height,c=n.format,u=!!n.isCubeTexture),e.textureSpecs.set(n,{name:r,type:a,width:i,height:s,format:c,isCube:u})},removeTextureSpec:function(n){e.textureSpecs.delete(n)}}}function o$(o,e){function t(n,r){n.opacity.value=r.opacity,r.color&&n.diffuse.value.copy(r.color),r.emissive&&n.emissive.value.copy(r.emissive).multiplyScalar(r.emissiveIntensity),r.map&&(n.map.value=r.map),r.alphaMap&&(n.alphaMap.value=r.alphaMap),r.bumpMap&&(n.bumpMap.value=r.bumpMap,n.bumpScale.value=r.bumpScale,r.side===1&&(n.bumpScale.value*=-1)),r.displacementMap&&(n.displacementMap.value=r.displacementMap,n.displacementScale.value=r.displacementScale,n.displacementBias.value=r.displacementBias),r.emissiveMap&&(n.emissiveMap.value=r.emissiveMap),r.normalMap&&(n.normalMap.value=r.normalMap,n.normalScale.value.copy(r.normalScale),r.side===1&&n.normalScale.value.negate()),r.specularMap&&(n.specularMap.value=r.specularMap),r.alphaTest>0&&(n.alphaTest.value=r.alphaTest);const a=e.get(r).envMap;let i,s;a&&(n.envMap.value=a,n.flipEnvMap.value=a.isCubeTexture&&a.isRenderTargetTexture===!1?-1:1,n.reflectivity.value=r.reflectivity,n.ior.value=r.ior,n.refractionRatio.value=r.refractionRatio),r.lightMap&&(n.lightMap.value=r.lightMap,n.lightMapIntensity.value=r.lightMapIntensity),r.aoMap&&(n.aoMap.value=r.aoMap,n.aoMapIntensity.value=r.aoMapIntensity),r.map?i=r.map:r.specularMap?i=r.specularMap:r.displacementMap?i=r.displacementMap:r.normalMap?i=r.normalMap:r.bumpMap?i=r.bumpMap:r.roughnessMap?i=r.roughnessMap:r.metalnessMap?i=r.metalnessMap:r.alphaMap?i=r.alphaMap:r.emissiveMap?i=r.emissiveMap:r.clearcoatMap?i=r.clearcoatMap:r.clearcoatNormalMap?i=r.clearcoatNormalMap:r.clearcoatRoughnessMap?i=r.clearcoatRoughnessMap:r.specularIntensityMap?i=r.specularIntensityMap:r.specularColorMap?i=r.specularColorMap:r.transmissionMap?i=r.transmissionMap:r.thicknessMap&&(i=r.thicknessMap),i!==void 0&&(i.isWebGLRenderTarget&&(i=i.texture),i.matrixAutoUpdate===!0&&i.updateMatrix(),n.uvTransform.value.copy(i.matrix)),r.aoMap?s=r.aoMap:r.lightMap&&(s=r.lightMap),s!==void 0&&(s.isWebGLRenderTarget&&(s=s.texture),s.matrixAutoUpdate===!0&&s.updateMatrix(),n.uv2Transform.value.copy(s.matrix))}return{refreshFogUniforms:function(n,r){r.color.getRGB(n.fogColor.value,y5(o)),r.isFog?(n.fogNear.value=r.near,n.fogFar.value=r.far):r.isFogExp2&&(n.fogDensity.value=r.density)},refreshMaterialUniforms:function(n,r,a,i,s){r.ssrParams&&function(c,u){c.invProjectionMatrix.value=u.ssrParams.invProjectionMatrix,c.ssrSourceBuffer.value=u.ssrParams.sourceBuffer.texture,c.ssrDepthBuffer.value=u.ssrParams.depthBuffer.texture,c.ssrBackfaceDepthBuffer.value=u.ssrParams.backfaceDepthBuffer.texture,c.ssrResolution.value.set(u.ssrParams.sourceBuffer.width,u.ssrParams.sourceBuffer.height),c.ssrStride.value=u.ssrParams.stride,c.ssrThickness.value=u.ssrParams.thickness,c.ssrMaxDistance.value=u.ssrParams.maxDistance,c.ssrJitter.value=u.ssrParams.jitter}(n,r),r.isMeshBasicMaterial||r.isMeshLambertMaterial?t(n,r):r.isMeshStandardMaterial?(t(n,r),function(c,u){c.roughness.value=u.roughness,c.metalness.value=u.metalness,u.roughnessMap&&(c.roughnessMap.value=u.roughnessMap),u.metalnessMap&&(c.metalnessMap.value=u.metalnessMap),e.get(u).envMap&&(c.envMapIntensity.value=u.envMapIntensity,c.envMapParallaxType.value=u.envMapParallaxType,c.envMapParallaxMatrix.value.copy(u.envMapParallaxMatrix),c.envMapParallaxMatrixInv.value.copy(u.envMapParallaxMatrixInv))}(n,r),r.isMeshPhysicalMaterial&&function(c,u,h){c.ior.value=u.ior,u.clearcoat>0&&(c.clearcoat.value=u.clearcoat,c.clearcoatRoughness.value=u.clearcoatRoughness,u.clearcoatMap&&(c.clearcoatMap.value=u.clearcoatMap),u.clearcoatRoughnessMap&&(c.clearcoatRoughnessMap.value=u.clearcoatRoughnessMap),u.clearcoatNormalMap&&(c.clearcoatNormalScale.value.copy(u.clearcoatNormalScale),c.clearcoatNormalMap.value=u.clearcoatNormalMap,u.side===1&&c.clearcoatNormalScale.value.negate())),u.transmission>0&&(c.transmission.value=u.transmission,c.transmissionSamplerMap.value=h.texture,c.transmissionSamplerSize.value.set(h.width,h.height),u.transmissionMap&&(c.transmissionMap.value=u.transmissionMap),c.thickness.value=u.thickness,u.thicknessMap&&(c.thicknessMap.value=u.thicknessMap),c.attenuationDistance.value=u.attenuationDistance,c.attenuationColor.value.copy(u.attenuationColor)),c.specularIntensity.value=u.specularIntensity,c.specularColor.value.copy(u.specularColor),u.specularIntensityMap&&(c.specularIntensityMap.value=u.specularIntensityMap),u.specularColorMap&&(c.specularColorMap.value=u.specularColorMap)}(n,r,s)):r.isMeshDepthMaterial?(t(n,r),function(c,u){c.slopeScaledBias.value=u.slopeScaledBias}(n,r)):r.isMeshDistanceMaterial?(t(n,r),function(c,u){c.referencePosition.value.copy(u.referencePosition),c.nearDistance.value=u.nearDistance,c.farDistance.value=u.farDistance,c.slopeScaledBias.value=u.slopeScaledBias}(n,r)):r.isMeshNormalMaterial?t(n,r):r.isLineBasicMaterial?(function(c,u){c.diffuse.value.copy(u.color),c.opacity.value=u.opacity}(n,r),r.isLineDashedMaterial&&function(c,u){c.dashSize.value=u.dashSize,c.totalSize.value=u.dashSize+u.gapSize,c.scale.value=u.scale}(n,r)):r.isPointsMaterial?function(c,u,h,f){c.diffuse.value.copy(u.color),c.opacity.value=u.opacity,c.size.value=u.size*h,c.scale.value=.5*f,u.map&&(c.map.value=u.map),u.alphaMap&&(c.alphaMap.value=u.alphaMap),u.alphaTest>0&&(c.alphaTest.value=u.alphaTest);let m;u.map?m=u.map:u.alphaMap&&(m=u.alphaMap),m!==void 0&&(m.matrixAutoUpdate===!0&&m.updateMatrix(),c.uvTransform.value.copy(m.matrix))}(n,r,a,i):r.isSpriteMaterial?function(c,u){c.diffuse.value.copy(u.color),c.opacity.value=u.opacity,c.rotation.value=u.rotation,u.map&&(c.map.value=u.map),u.alphaMap&&(c.alphaMap.value=u.alphaMap),u.alphaTest>0&&(c.alphaTest.value=u.alphaTest);let h;u.map?h=u.map:u.alphaMap&&(h=u.alphaMap),h!==void 0&&(h.matrixAutoUpdate===!0&&h.updateMatrix(),c.uvTransform.value.copy(h.matrix))}(n,r):r.isShadowMaterial?(n.color.value.copy(r.color),n.opacity.value=r.opacity):r.isMeshMaskMaterial?(t(n,r),function(c,u){u.cameraNearFar&&(c.cameraNearFar.value=u.cameraNearFar),c.depthTexture.value=u.depthTexture,u.textureMatrix&&(c.textureMatrix.value=u.textureMatrix)}(n,r)):r.isMeshNodeMaterial?function(c,u){u.alphaTest>0&&(c.alphaTest.value=u.alphaTest);for(let f=0;f<u.nodeValue.length;f++)c.nodeValue.value[f]=u.nodeValue[f];for(let f=0;f<u.nodeRGB.length;f++)u.nodeRGB[f].toArray(c.nodeRGB.value,4*f);const h=e.get(u).envMap;h&&(c.envMap.value=h,c.flipEnvMap.value=h.isCubeTexture&&h.isRenderTargetTexture?-1:1,c.envMapIntensity.value=u.envMapIntensity,c.envMapParallaxType.value=u.envMapParallaxType,c.envMapParallaxMatrix.value.copy(u.envMapParallaxMatrix),c.envMapParallaxMatrixInv.value.copy(u.envMapParallaxMatrixInv)),u.displacementMap&&(c.displacementMap.value=u.displacementMap,c.displacementScale.value=u.displacementScale,c.displacementBias.value=u.displacementBias),c.materialIndex.value=u.materialIndex}(n,r):r.isMeshLineMaterial?function(c,u){c.lineWidth.value=u.lineWidth,c.sizeAttenuation.value=u.sizeAttenuation,c.color.value=u.color,c.opacity.value=u.opacity,c.useMap.value=u.useMap,u.map&&(c.map.value=u.map),c.useAlphaMap.value=u.useAlphaMap,u.alphaMap&&(c.alphaMap.value=u.alphaMap),c.visibility.value=u.visibility,c.alphaTest.value=u.alphaTest,c.repeat.value=u.repeat}(n,r):r.isShaderMaterial&&(r.uniformsNeedUpdate=!1)},refreshGTAOUniforms:function(n,r){n.gtaoMap.value=r},refreshPlaneReflProbeUniforms:function(n,r){n.planeReflTexture.value=r.renderTarget.texture,n.planeReflTextureMatrix.value.copy(r.textureMatrix),n.planeReflDir.value.copy(r.normal),n.planeReflBoundingBoxMin.value.copy(r.boundingBox.min),n.planeReflBoundingBoxMax.value.copy(r.boundingBox.max),n.planeReflInvModelMatrix.value.copy(r.matrixWorldInverse),n.planeReflFalloff.value=r.falloff}}}function a$(o,e){return o[0]-e[0]}function i$(o,e){return Math.abs(e[1])-Math.abs(o[1])}function s$(o,e,t){const n={},r=new Float32Array(12),a=new WeakMap,i=new ct,s=[];for(let c=0;c<12;c++)s[c]=[c,0];return{update:function(c,u,h,f){const m=c.morphTargetInfluences;if(e.isWebGL2===!0){const g=u.morphAttributes.position||u.morphAttributes.normal||u.morphAttributes.color,A=g!==void 0?g.length:0;let _=a.get(u);if(_===void 0||_.count!==A){_!==void 0&&_.texture.dispose();const b=u.morphAttributes.position!==void 0,y=u.morphAttributes.normal!==void 0,M=u.morphAttributes.color!==void 0,R=u.morphAttributes.position||[],T=u.morphAttributes.normal||[],w=u.morphAttributes.color||[];let D=0;b===!0&&(D=1),y===!0&&(D=2),M===!0&&(D=3);let z=u.attributes.position.count*D,F=1;z>e.maxTextureSize&&(F=Math.ceil(z/e.maxTextureSize),z=e.maxTextureSize);const O=new Float32Array(z*F*4*A),q=new xv(O,z,F,A);q.type=1015,q.needsUpdate=!0;const ne=4*D;for(let $=0;$<A;$++){const he=R[$],K=T[$],oe=w[$],ie=z*F*4*$;for(let L=0;L<he.count;L++){const U=L*ne;b===!0&&(i.fromBufferAttribute(he,L),O[ie+U+0]=i.x,O[ie+U+1]=i.y,O[ie+U+2]=i.z,O[ie+U+3]=0),y===!0&&(i.fromBufferAttribute(K,L),O[ie+U+4]=i.x,O[ie+U+5]=i.y,O[ie+U+6]=i.z,O[ie+U+7]=0),M===!0&&(i.fromBufferAttribute(oe,L),O[ie+U+8]=i.x,O[ie+U+9]=i.y,O[ie+U+10]=i.z,O[ie+U+11]=oe.itemSize===4?i.w:1)}}_={count:A,texture:q,size:new Ee(z,F)},a.set(u,_),u.addEventListener("dispose",function $(){q.dispose(),a.delete(u),u.removeEventListener("dispose",$)})}let x=0;for(let b=0;b<m.length;b++)x+=m[b];const C=u.morphTargetsRelative?1:1-x;f.getUniforms().setValue(o,"morphTargetBaseInfluence",C),f.getUniforms().setValue(o,"morphTargetInfluences",m),f.getUniforms().setValue(o,"morphTargetsTexture",_.texture,t),f.getUniforms().setValue(o,"morphTargetsTextureSize",_.size)}else{const g=m===void 0?0:m.length;let A=n[u.id];if(A===void 0||A.length!==g){A=[];for(let y=0;y<g;y++)A[y]=[y,0];n[u.id]=A}for(let y=0;y<g;y++){const M=A[y];M[0]=y,M[1]=m[y]}A.sort(i$);for(let y=0;y<12;y++)y<g&&A[y][1]?(s[y][0]=A[y][0],s[y][1]=A[y][1]):(s[y][0]=Number.MAX_SAFE_INTEGER,s[y][1]=0);s.sort(a$);const _=u.morphAttributes.position,x=u.morphAttributes.normal;let C=0;for(let y=0;y<12;y++){const M=s[y],R=M[0],T=M[1];R!==Number.MAX_SAFE_INTEGER&&T?(_&&u.getAttribute("morphTarget"+y)!==_[R]&&u.setAttribute("morphTarget"+y,_[R]),x&&u.getAttribute("morphNormal"+y)!==x[R]&&u.setAttribute("morphNormal"+y,x[R]),r[y]=T,C+=T):(_&&u.hasAttribute("morphTarget"+y)===!0&&u.deleteAttribute("morphTarget"+y),x&&u.hasAttribute("morphNormal"+y)===!0&&u.deleteAttribute("morphNormal"+y),r[y]=0)}const b=u.morphTargetsRelative?1:1-C;f.getUniforms().setValue(o,"morphTargetBaseInfluence",b),f.getUniforms().setValue(o,"morphTargetInfluences",r)}}}}class Hy extends In{constructor(e,t,n,r,a,i,s,c,u,h){if((h=h!==void 0?h:1026)!==1026&&h!==1027)throw new Error("DepthTexture format must be either v3d.DepthFormat or v3d.DepthStencilFormat");n===void 0&&h===1026&&(n=1014),n===void 0&&h===1027&&(n=1020),super(null,r,a,i,s,c,h,n,u),this.isDepthTexture=!0,this.image={width:e,height:t},this.magFilter=s!==void 0?s:1003,this.minFilter=c!==void 0?c:1003,this.flipY=!1,this.generateMipmaps=!1}}class pa extends oo{constructor(){super(),this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1}setSize(){}render(){console.error("v3d.Pass: .render() must be implemented in derived pass.")}setCamera(e){}dispose(){}}const l$=new yi(-1,1,1,-1,0,1),Qg=new mt;Qg.setAttribute("position",new $e(new Float32Array([-1,3,0,-1,-1,0,3,-1,0]),3)),Qg.setAttribute("uv",new $e(new Float32Array([0,2,0,0,2,0]),2));class Ga{constructor(e){this._mesh=new Mt(Qg,e)}dispose(){this._mesh.geometry.dispose()}render(e){e.render(this._mesh,l$)}get material(){return this._mesh.material}set material(e){this._mesh.material=e}static dispose(){Qg.dispose()}}const c$=new Qe,AM=new Rd;class u${constructor(e,t){this.isWebGLOITMethod=!0,this.resolution=e,this.textureType=t,this.type="WebGLOITMethod",this.mute=!1}render(){this.mute}dispose(){}setSize(e,t){this.resolution.set(e,t)}_ensureProperBuffersClearing(e){e.state.buffers.depth.setTest(!0),e.state.buffers.depth.setMask(!0),e.state.buffers.color.setMask(!0)}}class d$ extends u${constructor(e,t,n){super(e,t),this.isWebGLOITWeighted=!0,this.type="WebGLOITWeighted",this.shader=xt.oitWeighted,this.uniforms=no.clone(this.shader.uniforms),this.scene=null,this.camera=null,this.aaSamples=n||0,this.renderTargetMRT=new A2(this.resolution.x,this.resolution.y,2),this.renderTargetMRT.texture[0].name="wboit_rgba",this.renderTargetMRT.texture[0].format=1023,this.renderTargetMRT.texture[0].type=t,this.renderTargetMRT.texture[1].name="wboit_r",this.renderTargetMRT.texture[1].format=1028,this.renderTargetMRT.texture[1].type=t,this.aaSamples>0&&(this.renderTargetMRTMSAA=new A2(this.resolution.x,this.resolution.y,2,{samples:n}),this.renderTargetMRTMSAA.texture[0].name="wboit_rgba",this.renderTargetMRTMSAA.texture[0].format=1023,this.renderTargetMRTMSAA.texture[0].type=t,this.renderTargetMRTMSAA.texture[1].name="wboit_r",this.renderTargetMRTMSAA.texture[1].format=1028,this.renderTargetMRTMSAA.texture[1].type=t),this.fsQuadSolver=new Ga(new An({defines:Object.assign({},this.shader.defines),uniforms:no.clone(this.shader.uniforms),vertexShader:this.shader.vertexShader,fragmentShader:this.shader.fragmentShader,depthTest:!1,depthWrite:!1,blending:5,blendEquation:100,blendSrc:204,blendDst:205,blendEquationAlpha:100,blendSrcAlpha:201,blendDstAlpha:205})),this._layerMasks={},this._matSettings={},this._savedCameraLayers=new Rd}dispose(){super.dispose(),this.renderTargetMRT.dispose(),this.renderTargetMRTMSAA&&this.renderTargetMRTMSAA.dispose()}setSize(e,t){super.setSize(e,t),this.renderTargetMRT.setSize(e,t),this.renderTargetMRTMSAA&&this.renderTargetMRTMSAA.setSize(e,t)}render(e,t,n,r,a){if(this.mute)return;this._ensureProperBuffersClearing(e);const i=e.getRenderTarget();if(i.isWebGLCubeRenderTarget)return void t(n,r,a);const s=r.overrideMaterial;if(s&&!this.isSupportedMaterial(s))return void t(n,r,a);if(this.resolution.x!==i.width&&this.resolution.y!==i.height)return console.warn("v3d.WebGLOITRenderer: render target size mismatch in v3d.WebGLOITWeighted."),void t(n,r,a);this.scene=r,this.camera=a,this._savedCameraLayers.mask=this.camera.layers.mask;const c=e.getClearColor(c$),u=e.getClearAlpha(),h=e.autoClear,f=e.useOIT,m=e.sortObjects;e.setClearColor(0),e.setClearAlpha(0),e.autoClear=!1,e.sortObjects=!1,e.useOIT=!1;const g=this.renderTargetMRTMSAA&&this.renderTargetMRTMSAA.samples==i.samples;if(s){const A=[{object:r,material:s}];this._accumulationPass(e,t,g,n,A);const _=s.colorWrite;s.colorWrite=!1,s.needsUpdate=!0,e.setRenderTarget(i),t(n,r,a),s.colorWrite=_,s.needsUpdate=!0}else this._saveLayers(n),this._setupLayers(n),a.layers.disableAll(),a.layers.enable(2),t(n,r,a),a.layers.disableAll(),a.layers.enable(1),this._accumulationPass(e,t,g,n),e.setRenderTarget(i),this._renderOnlyDepth(e,t,n,r,a),this._restoreLayers(n);e.setRenderTarget(i),this._solverPass(e,g),e.setClearColor(c),e.setClearAlpha(u),e.sortObjects=m,e.autoClear=h,e.useOIT=f}isSupportedMaterial(e){return!(!e||!e.isMeshStandardMaterial&&!e.isMeshNodeMaterial)}_accumulationPass(e,t,n,r,a){a||(a=r);const i=e.getContext(),s=e.getRenderTarget(),c=e.getClearAlpha();if(this._saveMatSettings(a),this._setupMatSettings(a),e.setClearAlpha(1),s)if(n){e.setRenderTarget(this.renderTargetMRTMSAA),e.clear();const u=e.properties.get(this.renderTargetMRTMSAA).__webglDepthRenderbuffer,h=e.properties.get(s).__webglDepthRenderbuffer;if(h&&(i.framebufferRenderbuffer(36160,36096,36161,h),i.checkFramebufferStatus(36160)!==36053)||(t(r,this.scene,this.camera),e.getTextureUtils().updateMultisampleRenderTarget(this.renderTargetMRTMSAA),h&&(i.framebufferRenderbuffer(36160,36096,36161,u||null),i.checkFramebufferStatus(36160)!==36053)))return void console.error("v3d.WebGLOITRenderer: incomplete framebuffer in v3d.WebGLOITWeighted.")}else if(s.samples>0){e.setRenderTarget(this.renderTargetMRT),e.clear();const u=e.properties.get(this.renderTargetMRT).__webglFramebuffer,h=e.properties.get(s).__webglMultisampledFramebuffer;if(h&&(i.bindFramebuffer(36008,h),i.bindFramebuffer(36009,u),i.blitFramebuffer(0,0,this.resolution.x,this.resolution.y,0,0,this.resolution.x,this.resolution.y,256,9728),i.bindFramebuffer(36160,u),i.checkFramebufferStatus(36160)!==36053))return void console.error("v3d.WebGLOITRenderer: incomplete framebuffer in v3d.WebGLOITWeighted. Can not blit depth buffer from multisample render target.");t(r,this.scene,this.camera)}else{e.setRenderTarget(this.renderTargetMRT),e.clear();const u=e.properties.get(this.renderTargetMRT),h=u.__webglDepthRenderbuffer||u.__webglDepthbuffer,f=e.properties.get(s),m=f.__webglDepthRenderbuffer||f.__webglDepthbuffer;if(m){if(i.framebufferRenderbuffer(36160,36096,36161,m),i.checkFramebufferStatus(36160)!==36053)return void console.error("v3d.WebGLOITRenderer: incomplete framebuffer in v3d.WebGLOITWeighted.")}else if(s.depthTexture){const g=e.properties.get(s.depthTexture).__webglTexture;i.framebufferTexture2D(36160,36096,3553,g,0)}if(t(r,this.scene,this.camera),m){if(i.framebufferRenderbuffer(36160,36096,36161,h||null),i.checkFramebufferStatus(36160)!==36053)return void console.error("v3d.WebGLOITRenderer: incomplete framebuffer in v3d.WebGLOITWeighted.")}else if(s.depthTexture&&(i.framebufferRenderbuffer(36160,36096,36161,h||null),i.checkFramebufferStatus(36160)!==36053))return void console.error("v3d.WebGLOITRenderer: incomplete framebuffer in v3d.WebGLOITWeighted.")}else console.error("v3d.WebGLOITRenderer: undefined render target in v3d.WebGLOITWeighted.");this._restoreMatSettings(a),e.setClearAlpha(c),e.setRenderTarget(s)}_solverPass(e,t){const n=t?this.renderTargetMRTMSAA:this.renderTargetMRT;this.fsQuadSolver.material.uniforms.tRGBABuffer.value=n.texture[0],this.fsQuadSolver.material.uniforms.tFloatBuffer.value=n.texture[1],this.fsQuadSolver.render(e)}_testInitialLayersWithInitialCameraLayers(e){const t=this._layerMasks[e.id];return AM.mask=t!==void 0?t:e.layers.mask,this._savedCameraLayers.test(AM)}_saveLayers(e){this._layerMasks[this.camera.id]=this.camera.layers.mask;for(let t=0,n=e.length;t<n;t++){const r=e[t].object;this._layerMasks[r.id]=r.layers.mask}}_setupLayers(e){for(let t=0,n=e.length;t<n;t++){const r=e[t],a=r.object,i=r.material;this._testInitialLayersWithInitialCameraLayers(a)?(a.layers.disableAll(),this.isSupportedMaterial(i)?a.layers.enable(1):a.layers.enable(2)):a.layers.disableAll()}}_restoreLayers(e){for(let t=0,n=e.length;t<n;t++){const r=e[t].object;r.layers.mask=this._layerMasks[r.id],delete this._layerMasks[r.id]}this.camera.layers.mask=this._layerMasks[this.camera.id],delete this._layerMasks[this.camera.id]}_saveMatSettings(e){for(let t=0,n=e.length;t<n;t++){const r=e[t],a=r.object,i=r.material;i&&i.id in this._matSettings||this._testInitialLayersWithInitialCameraLayers(a)&&this.isSupportedMaterial(i)&&(this._matSettings[i.id]={defines:{PREMULTIPLIED_ALPHA:i.defines.PREMULTIPLIED_ALPHA},properties:{blending:i.blending,blendEquation:i.blendEquation,blendSrc:i.blendSrc,blendDst:i.blendDst,blendEquationAlpha:i.blendEquationAlpha,blendSrcAlpha:i.blendSrcAlpha,blendDstAlpha:i.blendDstAlpha,depthTest:i.depthTest,depthWrite:i.depthWrite}})}}_setupMatSettings(e){for(let t=0,n=e.length;t<n;t++){const r=e[t],a=r.object,i=r.material;this._testInitialLayersWithInitialCameraLayers(a)&&this.isSupportedMaterial(i)&&(i.defines.PREMULTIPLIED_ALPHA="",i.defines.USE_OIT_WEIGHTED="",i.blending=5,i.blendEquation=100,i.blendSrc=201,i.blendDst=201,i.blendEquationAlpha=100,i.blendSrcAlpha=200,i.blendDstAlpha=205,i.depthTest=!0,i.depthWrite=!1,i.needsUpdate=!0)}}_restoreMatSettings(e){for(let t=0,n=e.length;t<n;t++){const r=e[t],a=r.object,i=r.material;if(!i||!(i.id in this._matSettings)||!this._testInitialLayersWithInitialCameraLayers(a)||!this.isSupportedMaterial(i))continue;delete i.defines.USE_OIT_WEIGHTED;const s=this._matSettings[i.id];for(let c in s.properties)i[c]=s.properties[c];for(let c in s.defines)s.defines[c]?i.defines[c]=s.defines[c]:delete i.defines[c];i.needsUpdate=!0,delete this._matSettings[i.id]}}_renderOnlyDepth(e,t,n,r,a){const i={};for(let s=0,c=n.length;s<c;s++){const u=n[s],h=u.object,f=u.material;f&&f.id in i||this._testInitialLayersWithInitialCameraLayers(h)&&this.isSupportedMaterial(f)&&(i[f.id]={properties:{colorWrite:f.colorWrite}},f.colorWrite=!1,f.needsUpdate=!0)}t(n,r,a);for(let s=0,c=n.length;s<c;s++){const u=n[s];u.object;const h=u.material;if(!h||!(h.id in i))continue;const f=i[h.id];for(let m in f.properties)h[m]=f.properties[m];h.needsUpdate=!0,delete i[h.id]}}}class f${constructor(e){this.isWebGLOITRenderer=!0,this.resolution=e,this.texType=1009,this.mute=!1,this.method=0,this.oitRenderer=null}render(e,t,n,r,a){this.mute||this.oitRenderer&&this.oitRenderer.render(e,t,n,r,a)}setMethod(e,t){this.method!==e&&(this.oitRenderer&&this.oitRenderer.dispose(),this.oitRenderer=null,this.method=e,e!==0&&e===1&&(this.oitRenderer=new d$(this.resolution,this.texType,t)))}isMethodCompatible(e,t){return e===0||!(e!==1||!t.isWebGL2)}dispose(){this.oitRenderer&&this.oitRenderer.dispose(),this.method=0}setSize(e,t){this.resolution.set(e,t),this.oitRenderer&&this.oitRenderer.setSize(e,t)}}function h$(o,e,t,n){let r=new WeakMap;function a(i){const s=i.target;s.removeEventListener("dispose",a),t.remove(s.instanceMatrix),s.instanceColor!==null&&t.remove(s.instanceColor)}return{update:function(i){const s=n.render.frame,c=i.geometry,u=e.get(i,c);return r.get(u)!==s&&(e.update(u),r.set(u,s)),i.isInstancedMesh&&(i.hasEventListener("dispose",a)===!1&&i.addEventListener("dispose",a),t.update(i.instanceMatrix,34962),i.instanceColor!==null&&t.update(i.instanceColor,34962)),u},dispose:function(){r=new WeakMap}}}const S5=new In,C5=new xv,E5=new Gy,M5=new yv,xM=[],yM=[],bM=new Float32Array(16),SM=new Float32Array(9),CM=new Float32Array(4);function Id(o,e,t){const n=o[0];if(n<=0||n>0)return o;const r=e*t;let a=xM[r];if(a===void 0&&(a=new Float32Array(r),xM[r]=a),e!==0){n.toArray(a,0);for(let i=1,s=0;i!==e;++i)s+=t,o[i].toArray(a,s)}return a}function pr(o,e){if(o.length!==e.length)return!1;for(let t=0,n=o.length;t<n;t++)if(o[t]!==e[t])return!1;return!0}function mr(o,e){for(let t=0,n=e.length;t<n;t++)o[t]=e[t]}function bv(o,e){let t=yM[e];t===void 0&&(t=new Int32Array(e),yM[e]=t);for(let n=0;n!==e;++n)t[n]=o.allocateTextureUnit();return t}function p$(o,e){const t=this.cache;t[0]!==e&&(o.uniform1f(this.addr,e),t[0]=e)}function m$(o,e){const t=this.cache;if(e.x!==void 0)t[0]===e.x&&t[1]===e.y||(o.uniform2f(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(pr(t,e))return;o.uniform2fv(this.addr,e),mr(t,e)}}function g$(o,e){const t=this.cache;if(e.x!==void 0)t[0]===e.x&&t[1]===e.y&&t[2]===e.z||(o.uniform3f(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else if(e.r!==void 0)t[0]===e.r&&t[1]===e.g&&t[2]===e.b||(o.uniform3f(this.addr,e.r,e.g,e.b),t[0]=e.r,t[1]=e.g,t[2]=e.b);else{if(pr(t,e))return;o.uniform3fv(this.addr,e),mr(t,e)}}function v$(o,e){const t=this.cache;if(e.x!==void 0)t[0]===e.x&&t[1]===e.y&&t[2]===e.z&&t[3]===e.w||(o.uniform4f(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(pr(t,e))return;o.uniform4fv(this.addr,e),mr(t,e)}}function _$(o,e){const t=this.cache,n=e.elements;if(n===void 0){if(pr(t,e))return;o.uniformMatrix2fv(this.addr,!1,e),mr(t,e)}else{if(pr(t,n))return;CM.set(n),o.uniformMatrix2fv(this.addr,!1,CM),mr(t,n)}}function A$(o,e){const t=this.cache,n=e.elements;if(n===void 0){if(pr(t,e))return;o.uniformMatrix3fv(this.addr,!1,e),mr(t,e)}else{if(pr(t,n))return;SM.set(n),o.uniformMatrix3fv(this.addr,!1,SM),mr(t,n)}}function x$(o,e){const t=this.cache,n=e.elements;if(n===void 0){if(pr(t,e))return;o.uniformMatrix4fv(this.addr,!1,e),mr(t,e)}else{if(pr(t,n))return;bM.set(n),o.uniformMatrix4fv(this.addr,!1,bM),mr(t,n)}}function y$(o,e){const t=this.cache;t[0]!==e&&(o.uniform1i(this.addr,e),t[0]=e)}function b$(o,e){const t=this.cache;if(e.x!==void 0)t[0]===e.x&&t[1]===e.y||(o.uniform2i(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(pr(t,e))return;o.uniform2iv(this.addr,e),mr(t,e)}}function S$(o,e){const t=this.cache;if(e.x!==void 0)t[0]===e.x&&t[1]===e.y&&t[2]===e.z||(o.uniform3i(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(pr(t,e))return;o.uniform3iv(this.addr,e),mr(t,e)}}function C$(o,e){const t=this.cache;if(e.x!==void 0)t[0]===e.x&&t[1]===e.y&&t[2]===e.z&&t[3]===e.w||(o.uniform4i(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(pr(t,e))return;o.uniform4iv(this.addr,e),mr(t,e)}}function E$(o,e){const t=this.cache;t[0]!==e&&(o.uniform1ui(this.addr,e),t[0]=e)}function M$(o,e){const t=this.cache;if(e.x!==void 0)t[0]===e.x&&t[1]===e.y||(o.uniform2ui(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(pr(t,e))return;o.uniform2uiv(this.addr,e),mr(t,e)}}function w$(o,e){const t=this.cache;if(e.x!==void 0)t[0]===e.x&&t[1]===e.y&&t[2]===e.z||(o.uniform3ui(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(pr(t,e))return;o.uniform3uiv(this.addr,e),mr(t,e)}}function T$(o,e){const t=this.cache;if(e.x!==void 0)t[0]===e.x&&t[1]===e.y&&t[2]===e.z&&t[3]===e.w||(o.uniform4ui(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(pr(t,e))return;o.uniform4uiv(this.addr,e),mr(t,e)}}function R$(o,e,t){const n=this.cache,r=t.allocateTextureUnit();n[0]!==r&&(o.uniform1i(this.addr,r),n[0]=r),t.setTexture2D(e||S5,r)}function I$(o,e,t){const n=this.cache,r=t.allocateTextureUnit();n[0]!==r&&(o.uniform1i(this.addr,r),n[0]=r),t.setTexture3D(e||E5,r)}function L$(o,e,t){const n=this.cache,r=t.allocateTextureUnit();n[0]!==r&&(o.uniform1i(this.addr,r),n[0]=r),t.setTextureCube(e||M5,r)}function B$(o,e,t){const n=this.cache,r=t.allocateTextureUnit();n[0]!==r&&(o.uniform1i(this.addr,r),n[0]=r),t.setTexture2DArray(e||C5,r)}function P$(o){switch(o){case 5126:return p$;case 35664:return m$;case 35665:return g$;case 35666:return v$;case 35674:return _$;case 35675:return A$;case 35676:return x$;case 5124:case 35670:return y$;case 35667:case 35671:return b$;case 35668:case 35672:return S$;case 35669:case 35673:return C$;case 5125:return E$;case 36294:return M$;case 36295:return w$;case 36296:return T$;case 35678:case 36198:case 36298:case 36306:case 35682:return R$;case 35679:case 36299:case 36307:return I$;case 35680:case 36300:case 36308:case 36293:return L$;case 36289:case 36303:case 36311:case 36292:return B$}}function N$(o,e){o.uniform1fv(this.addr,e)}function D$(o,e){const t=Id(e,this.size,2);o.uniform2fv(this.addr,t)}function O$(o,e){const t=Id(e,this.size,3);o.uniform3fv(this.addr,t)}function F$(o,e){const t=Id(e,this.size,4);o.uniform4fv(this.addr,t)}function U$(o,e){const t=Id(e,this.size,4);o.uniformMatrix2fv(this.addr,!1,t)}function z$(o,e){const t=Id(e,this.size,9);o.uniformMatrix3fv(this.addr,!1,t)}function V$(o,e){const t=Id(e,this.size,16);o.uniformMatrix4fv(this.addr,!1,t)}function k$(o,e){o.uniform1iv(this.addr,e)}function G$(o,e){o.uniform2iv(this.addr,e)}function Q$(o,e){o.uniform3iv(this.addr,e)}function H$(o,e){o.uniform4iv(this.addr,e)}function W$(o,e){o.uniform1uiv(this.addr,e)}function Y$(o,e){o.uniform2uiv(this.addr,e)}function j$(o,e){o.uniform3uiv(this.addr,e)}function X$(o,e){o.uniform4uiv(this.addr,e)}function q$(o,e,t){const n=this.cache,r=e.length,a=bv(t,r);pr(n,a)||(o.uniform1iv(this.addr,a),mr(n,a));for(let i=0;i!==r;++i)t.setTexture2D(e[i]||S5,a[i])}function Z$(o,e,t){const n=this.cache,r=e.length,a=bv(t,r);pr(n,a)||(o.uniform1iv(this.addr,a),mr(n,a));for(let i=0;i!==r;++i)t.setTexture3D(e[i]||E5,a[i])}function K$(o,e,t){const n=this.cache,r=e.length,a=bv(t,r);pr(n,a)||(o.uniform1iv(this.addr,a),mr(n,a));for(let i=0;i!==r;++i)t.setTextureCube(e[i]||M5,a[i])}function $$(o,e,t){const n=this.cache,r=e.length,a=bv(t,r);pr(n,a)||(o.uniform1iv(this.addr,a),mr(n,a));for(let i=0;i!==r;++i)t.setTexture2DArray(e[i]||C5,a[i])}function J$(o){switch(o){case 5126:return N$;case 35664:return D$;case 35665:return O$;case 35666:return F$;case 35674:return U$;case 35675:return z$;case 35676:return V$;case 5124:case 35670:return k$;case 35667:case 35671:return G$;case 35668:case 35672:return Q$;case 35669:case 35673:return H$;case 5125:return W$;case 36294:return Y$;case 36295:return j$;case 36296:return X$;case 35678:case 36198:case 36298:case 36306:case 35682:return q$;case 35679:case 36299:case 36307:return Z$;case 35680:case 36300:case 36308:case 36293:return K$;case 36289:case 36303:case 36311:case 36292:return $$}}class eJ{constructor(e,t,n){this.id=e,this.addr=n,this.cache=[],this.setValue=P$(t.type)}}class tJ{constructor(e,t,n){this.id=e,this.addr=n,this.cache=[],this.size=t.size,this.setValue=J$(t.type)}}class nJ{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,t,n){const r=this.seq;for(let a=0,i=r.length;a!==i;++a){const s=r[a];s.setValue(e,t[s.id],n)}}}const BA=/(\w+)(\])?(\[|\.)?/g;function EM(o,e){o.seq.push(e),o.map[e.id]=e}function rJ(o,e,t){const n=o.name,r=n.length;for(BA.lastIndex=0;;){const a=BA.exec(n),i=BA.lastIndex;let s=a[1];const c=a[2]==="]",u=a[3];if(c&&(s|=0),u===void 0||u==="["&&i+2===r){EM(t,u===void 0?new eJ(s,o,e):new tJ(s,o,e));break}{let h=t.map[s];h===void 0&&(h=new nJ(s),EM(t,h)),t=h}}}class fg{constructor(e,t){this.seq=[],this.map={};const n=e.getProgramParameter(t,35718);for(let r=0;r<n;++r){const a=e.getActiveUniform(t,r);rJ(a,e.getUniformLocation(t,a.name),this)}}setValue(e,t,n,r){const a=this.map[t];a!==void 0&&a.setValue(e,n,r)}setOptional(e,t,n){const r=t[n];r!==void 0&&this.setValue(e,n,r)}static upload(e,t,n,r){for(let a=0,i=t.length;a!==i;++a){const s=t[a],c=n[s.id];c.needsUpdate!==!1&&s.setValue(e,c.value,r)}}static seqWithValue(e,t){const n=[];for(let r=0,a=e.length;r!==a;++r){const i=e[r];i.id in t&&n.push(i)}return n}}function MM(o,e,t){const n=o.createShader(e);return o.shaderSource(n,t),o.compileShader(n),n}let oJ=0;function aJ(o,e){const t=o.split(`
`),n=[],r=Math.max(e-6,0),a=Math.min(e+6,t.length);for(let i=r;i<a;i++){const s=i+1;n.push(`${s===e?">":" "} ${s}: ${t[i]}`)}return n.join(`
`)}function iJ(o){switch(o){case 3e3:return["Linear","(value)"];case 3001:return["sRGB","(value)"];default:return console.warn("v3d.WebGLProgram: Unsupported encoding:",o),["Linear","(value)"]}}function wM(o,e,t){const n=o.getShaderParameter(e,35713),r=o.getShaderInfoLog(e).trim();if(n&&r==="")return"";const a=/ERROR: 0:(\d+)/.exec(r);if(a){const i=parseInt(a[1]);return t.toUpperCase()+`

`+r+`

`+aJ(o.getShaderSource(e),i)}return r}function sJ(o,e){const t=iJ(e);return"vec4 "+o+"(vec4 value) { return LinearTo"+t[0]+t[1]+"; }"}function lJ(o,e){let t;switch(e){case 1:t="Linear";break;case 2:t="Reinhard";break;case 3:t="OptimizedCineon";break;case 4:t="ACESFilmic";break;case 5:t="Custom";break;case 6:t="LogarithmicMax";break;case 7:t="PhysicalMax";break;case 8:t="FilmicBlender";break;case 9:t="AgX";break;case 10:t="PbrNeutral";break;default:console.warn("v3d.WebGLProgram: Unsupported toneMapping:",e),t="Linear"}return"vec3 "+o+"(vec3 color) { return "+t+"ToneMapping(color); }"}function cJ(o){let e="TONE_MAPPING_LOOK_NONE";return o===1&&(e="TONE_MAPPING_LOOK_AGX_PUNCHY"),e}function uJ(o){return[o.extensionDerivatives||o.bumpMap||o.tangentSpaceNormalMap||o.clearcoatNormalMap||o.flatShading||o.shaderID==="physical"||o.shaderID==="node"||o.useSlopeScaledBias?"#extension GL_OES_standard_derivatives : enable":"",(o.extensionFragDepth||o.logarithmicDepthBuffer)&&o.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",o.extensionDrawBuffers&&o.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(o.extensionShaderTextureLOD||o.envMap||o.transmission)&&o.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(ch).join(`
`)}function TM(o,e){const t=[];for(const n in o){const r=o[n];r===!1||e&&e.has(n)||t.push("#define "+n+" "+r)}return t.join(`
`)}function dJ(o,e){const t={},n=o.getProgramParameter(e,35721);for(let r=0;r<n;r++){const a=o.getActiveAttrib(e,r),i=a.name;let s=1;a.type===35674&&(s=2),a.type===35675&&(s=3),a.type===35676&&(s=4),t[i]={type:a.type,location:o.getAttribLocation(e,i),locationSize:s}}return t}function ch(o){return o!==""}function RM(o,e){return o.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows).replace(/NUM_RECT_AREA_LIGHT_SHADOWS/g,e.numRectAreaLightShadows).replace(/NUM_DIR_LIGHT_SHADOWS_CSM_WITH_FADE/g,e.numDirLightShadowsCSMWithFade).replace(/NUM_DIR_LIGHT_SHADOWS_CSM/g,e.numDirLightShadowsCSM).replace(/NUM_DIR_LIGHT_SHADOW_CASCADES_CSM/g,e.numDirLightShadowCSMCascades)}function IM(o,e){return o.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}function LM(o,e){const t=Object.keys(e);if(t.length){const n=new RegExp(t.join("|"),"g");return o.replace(n,function(r){return e[r]})}return o}function fJ(o){switch(o){case"blender":return"#define MT_BLENDER";case"max":return"#define MT_MAX";case"maya":return"#define MT_MAYA";default:return""}}function BM(o,e){for(const t in e){const n=typeof __V3D_DEVTOOLS__<"u"?`// included: "${t}"
`:"";o=o.replace(`#include <${t}>`,n+e[t])}return o}const hJ=/^[ \t]*#include +<([\w\d./]+)>/gm;function x2(o){return o.replace(hJ,pJ)}function pJ(o,e){const t=Ye[e];if(t===void 0)throw new Error("Can not resolve #include <"+e+">");return x2((typeof __V3D_DEVTOOLS__<"u"?`// included: "${e}"
`:"")+t)}function PM(o){const e=new RegExp("#pragma unroll_loop[\\s]+?for \\(int (\\w+) \\= (\\d+)\\; (\\w+) <(=?) (\\w+)\\; (\\w+)\\+\\+\\) \\{"),t=new RegExp("\\{|\\}","g");let n;for(;n=e.exec(o);){let r,a;r=a=t.lastIndex=n.index+n[0].length;let i,s=1;do(i=t.exec(o))&&(i[0]=="{"?s++:i[0]=="}"&&s--,a=i.index);while(i&&s>0);if(s==0){const c=o.substring(n.index,t.lastIndex),u=o.substring(r,a),h=new RegExp(`\\[${n[1]}\\]`,"g"),f=new RegExp(`\\(${n[1]}\\)`,"g");let m="";const g=parseInt(n[2]),A=parseInt(n[5])+(n[4]==="="?1:0);for(let _=g;_<A;_++)m+="{"+u.replace(h,`[${_}]`).replace(f,`(${_})`)+"}";o=o.replace(c,m)}}return o}function NM(o){let e="precision "+o.precision+` float;
precision `+o.precision+" int;";return o.precision==="highp"?e+=`
#define HIGH_PRECISION`:o.precision==="mediump"?e+=`
#define MEDIUM_PRECISION`:o.precision==="lowp"&&(e+=`
#define LOW_PRECISION`),e}function mJ(o){let e="SHADOWMAP_TYPE_BASIC";return o.shadowMapType===1?e="SHADOWMAP_TYPE_BILINEAR":o.shadowMapType===2?e="SHADOWMAP_TYPE_PCF":o.shadowMapType===3&&(e="SHADOWMAP_TYPE_ESM"),e}function gJ(o){let e="ENVMAP_TYPE_CUBE";if(o.envMap)switch(o.envMapMode){case 301:case 302:e="ENVMAP_TYPE_CUBE";break;case 306:e="ENVMAP_TYPE_CUBE_UV"}return e}function vJ(o){let e="ENVMAP_MODE_REFLECTION";return o.envMap&&o.envMapMode===302&&(e="ENVMAP_MODE_REFRACTION"),e}function _J(o){let e="ENVMAP_BLENDING_NONE";if(o.envMap)switch(o.combine){case 0:e="ENVMAP_BLENDING_MULTIPLY";break;case 1:e="ENVMAP_BLENDING_MIX";break;case 2:e="ENVMAP_BLENDING_ADD"}return e}function AJ(o,e,t,n){const r=o.getContext(),a=t.defines;let i=t.vertexShader,s=t.fragmentShader;const c=mJ(t),u=gJ(t),h=vJ(t),f=_J(t),m=t.unitsScaleFactor%1?String(t.unitsScaleFactor):String(t.unitsScaleFactor)+".0",g=t.isWebGL2?"":uJ(t),A=TM(a),_=TM(a,t.definesFragOnly),x=r.createProgram(),C=this;let b,y,M=t.glslVersion?"#version "+t.glslVersion+`
`:"";t.isRawShaderMaterial?(b=[_].filter(ch).join(`
`),b.length>0&&(b+=`
`),y=[g,A].filter(ch).join(`
`),y.length>0&&(y+=`
`)):(b=[NM(t),"#define SHADER_NAME "+t.shaderName,_,t.instancing?"#define USE_INSTANCING":"",t.instancingColor?"#define USE_INSTANCING_COLOR":"",t.supportsVertexTextures?"#define VERTEX_TEXTURES":"",t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+h:"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMap&&t.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",t.normalMap&&t.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.displacementMap&&t.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",t.specularColorMap?"#define USE_SPECULARCOLORMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.vertexTangents?"#define USE_TANGENT":"",t.vertexColors?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUvs?"#define USE_UV":"",t.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",t.flatShading?"#define FLAT_SHADED":"",t.skinning?"#define USE_SKINNING":"",t.morphTargets?"#define USE_MORPHTARGETS":"",t.morphNormals&&t.flatShading===!1?"#define USE_MORPHNORMALS":"",t.morphColors&&t.isWebGL2?"#define USE_MORPHCOLORS":"",t.morphTargetsCount>0&&t.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",t.morphTargetsCount>0&&t.isWebGL2?"#define MORPHTARGETS_TEXTURE_STRIDE "+t.morphTextureStride:"",t.morphTargetsCount>0?"#define MORPHTARGETS_COUNT "+t.morphTargetsCount:"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+c:"",t.sizeAttenuation?"#define USE_SIZEATTENUATION":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.logarithmicDepthBuffer&&t.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"",t.planeReflProbe?"#define USE_PLANE_REFLECTION":"",`
            uniform mat4 modelMatrix;
            uniform mat4 modelViewMatrix;
            uniform mat4 projectionMatrix;
            uniform mat4 viewMatrix;
            uniform mat3 normalMatrix;
            uniform vec3 cameraPosition;
            uniform bool isOrthographic;

            #ifdef USE_INSTANCING
                attribute mat4 instanceMatrix;
            #endif

            #ifdef USE_INSTANCING_COLOR
                attribute vec3 instanceColor;
            #endif

            attribute vec3 position;
            attribute vec3 normal;
            attribute vec2 uv;

            #ifdef USE_TANGENT
                attribute vec4 tangent;
            #endif

            #if defined(USE_COLOR_ALPHA)
                attribute vec4 color;
            #elif defined(USE_COLOR)
                attribute vec3 color;
            #endif

            #if (defined(USE_MORPHTARGETS) && !defined(MORPHTARGETS_TEXTURE))
                #if MORPHTARGETS_COUNT > 0
                    attribute vec3 morphTarget0;
                #endif
                #if MORPHTARGETS_COUNT > 1
                    attribute vec3 morphTarget1;
                #endif
                #if MORPHTARGETS_COUNT > 2
                    attribute vec3 morphTarget2;
                #endif
                #if MORPHTARGETS_COUNT > 3
                    attribute vec3 morphTarget3;
                #endif
                #if MORPHTARGETS_COUNT > 4
                    attribute vec3 morphTarget4;
                #endif
                #if MORPHTARGETS_COUNT > 5
                    attribute vec3 morphTarget5;
                #endif

                #ifdef USE_MORPHNORMALS
                    #if MORPHTARGETS_COUNT > 0
                        attribute vec3 morphNormal0;
                    #endif
                    #if MORPHTARGETS_COUNT > 1
                        attribute vec3 morphNormal1;
                    #endif
                    #if MORPHTARGETS_COUNT > 2
                        attribute vec3 morphNormal2;
                    #endif
                    #if MORPHTARGETS_COUNT > 3
                        attribute vec3 morphNormal3;
                    #endif
                    #if MORPHTARGETS_COUNT > 4
                        attribute vec3 morphNormal4;
                    #endif
                    #if MORPHTARGETS_COUNT > 5
                        attribute vec3 morphNormal5;
                    #endif
                #else
                    #if MORPHTARGETS_COUNT > 6
                        attribute vec3 morphTarget6;
                    #endif
                    #if MORPHTARGETS_COUNT > 7
                        attribute vec3 morphTarget7;
                    #endif
                    #if MORPHTARGETS_COUNT > 8
                        attribute vec3 morphTarget8;
                    #endif
                    #if MORPHTARGETS_COUNT > 9
                        attribute vec3 morphTarget9;
                    #endif
                    #if MORPHTARGETS_COUNT > 10
                        attribute vec3 morphTarget10;
                    #endif
                    #if MORPHTARGETS_COUNT > 11
                        attribute vec3 morphTarget11;
                    #endif
                #endif
            #endif

            #ifdef USE_SKINNING
                attribute vec4 skinIndex;
                attribute vec4 skinWeight;
            #endif
            `].filter(ch).join(`
`),y=[g,NM(t),"#define SHADER_NAME "+t.shaderName,A,fJ(t.materialProfile),t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+u:"",t.envMap?"#define "+h:"",t.envMap?"#define "+f:"",t.envMapCubeUVTileSize!==0?`#define cubeUV_maxTileSize ${al(t.envMapCubeUVTileSize)}`:"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMap&&t.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",t.normalMap&&t.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",t.clearcoat?"#define USE_CLEARCOAT":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",t.specularColorMap?"#define USE_SPECULARCOLORMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaTest?"#define USE_ALPHATEST":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",t.vertexTangents?"#define USE_TANGENT":"",t.vertexColors||t.instancingColor?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUvs?"#define USE_UV":"",t.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",t.flatShading?"#define FLAT_SHADED":"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+c:"",t.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.logarithmicDepthBuffer&&t.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"",(t.extensionShaderTextureLOD||t.envMap)&&t.rendererExtensionShaderTextureLod?"#define TEXTURE_LOD_EXT":"","#define UNITS_SCALE_FACTOR "+m,"uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",t.toneMapping!==0?"#define TONE_MAPPING":"",t.toneMapping!==0?"#define TONE_MAPPING_LOOK "+cJ(t.toneMappingLook):"",t.toneMapping!==0?Ye.tonemapping_pars_fragment:"",t.toneMapping!==0?lJ("toneMapping",t.toneMapping):"",t.dithering?"#define DITHERING":"",t.opaque&&!t.alphaToCoverage?"#define OPAQUE":"",Ye.encodings_pars_fragment,sJ("linearToOutputTexel",t.outputEncoding),t.useDepthPacking?"#define DEPTH_PACKING "+t.depthPacking:"",t.distancePacking?"#define DISTANCE_PACKING "+t.distancePacking:"",t.useSlopeScaledBias?"#define USE_SLOPE_SCALED_BIAS":"",`#define ESM_DISTANCE_SCALE ${al(t.esmDistanceScale)}`,t.planeReflProbe?"#define USE_PLANE_REFLECTION":"",t.useGTAO?"#define USE_GTAO":"",o.compatSettings.gtaoDisableBkgFix?"#define GTAO_DISABLE_BKG_FIX":"",t.dirLightShadowsCSMLUT&&t.isWebGL2?`#define LUT_DIR_LIGHT_SHADOWS_CSM int[](${t.dirLightShadowsCSMLUT})`:"",`
`].filter(ch).join(`
`)),t.isWebGL2||t.isRawShaderMaterial===!0||(i=`#include <webgl1_compat>
`+i,s=`#include <webgl1_compat>
`+s),t.isMeshNodeMaterial&&(i=BM(i,t.nodeChunks),s=BM(s,t.nodeChunks)),i=x2(i),i=RM(i,t),i=IM(i,t),t.customPrepTokens&&(i=LM(i,t.customPrepTokens)),s=x2(s),s=RM(s,t),s=IM(s,t),t.customPrepTokens&&(s=LM(s,t.customPrepTokens)),i=PM(i),s=PM(s),t.isWebGL2&&t.isRawShaderMaterial!==!0&&(M=`#version 300 es
`,b=["precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+b,y=["#define varying in",t.glslVersion===v2?"":"layout(location = 0) out highp vec4 pc_fragColor;",t.glslVersion===v2?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+y);let R=M+b+i,T=M+y+s;if(o.debug.disableCompiledShaderCache){const ne=T.lastIndexOf("}");T=T.substr(0,ne)+"    gl_FragColor += vec4("+.001*Math.random()+`);
`+T.substr(ne)}const w=MM(r,35633,R),D=MM(r,35632,T);typeof __V3D_DEVTOOLS__<"u"&&__V3D_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:{shaderName:t.shaderName,materialName:t.materialName,vertex:R,fragment:T}})),r.attachShader(x,w),r.attachShader(x,D),t.index0AttributeName!==void 0?r.bindAttribLocation(x,0,t.index0AttributeName):t.morphTargets===!0&&r.bindAttribLocation(x,0,"position"),r.linkProgram(x);let z,F,O=!0;function q(){if(O=!1,o.debug.checkShaderErrors){const ne=r.getProgramInfoLog(x).trim(),$=r.getShaderInfoLog(w).trim(),he=r.getShaderInfoLog(D).trim();let K=!0,oe=!0;if(r.getProgramParameter(x,35714)===!1){K=!1;const ie=wM(r,w,"vertex"),L=wM(r,D,"fragment");console.error("v3d.WebGLProgram: shader error: ",r.getError(),"35715",r.getProgramParameter(x,35715),"gl.getProgramInfoLog",ne,ie,L)}else ne!==""?console.warn("v3d.WebGLProgram: gl.getProgramInfoLog()",ne):$!==""&&he!==""||(oe=!1);oe&&(C.diagnostics={runnable:K,programLog:ne,vertexShader:{log:$,prefix:b},fragmentShader:{log:he,prefix:y}})}r.deleteShader(w),r.deleteShader(D)}return this.getUniforms=function(){return z===void 0&&(O&&q(),z=new fg(r,x)),z},this.getAttributes=function(){return F===void 0&&(O&&q(),F=dJ(r,x)),F},this.destroy=function(){n.releaseStatesOfProgram(this),r.deleteProgram(x),this.program=void 0},this.name=t.shaderName,this.id=oJ++,this.cacheKey=e,this.usedTimes=1,this.program=x,this.vertexShader=w,this.fragmentShader=D,this.profile={calcRenderTime:!1,renderTime:0,timerQueries:[],materials:new Set},this.getTexUniformCount=function(){return this.getUniforms().seq.reduce(function(ne,$){if($.info)switch($.info.type){case 35678:case 35679:case 35680:case 35682:case 36289:case 36292:case 36293:case 36298:case 36299:case 36300:case 36303:case 36306:case 36307:case 36308:case 36311:ne+=$.info.size}return ne},0)},this.beginTimerQuery=function(ne,$){if(!this.profile.calcRenderTime)return;const he=ne.getExtension($?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query");if(!he)return;let K;$?(K=ne.createQuery(),ne.beginQuery(he.TIME_ELAPSED_EXT,K)):(K=he.createQueryEXT(),he.beginQueryEXT(he.TIME_ELAPSED_EXT,K)),this.profile.timerQueries.push(K)},this.endTimerQuery=function(ne,$){if(!this.profile.calcRenderTime)return;const he=ne.getExtension($?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query");if(!he)return;$?ne.endQuery(he.TIME_ELAPSED_EXT):he.endQueryEXT(he.TIME_ELAPSED_EXT);const K=this.profile.timerQueries;for(let oe=K.length-1;oe>=0;oe--){const ie=K[oe],L=$?ne.getQueryParameter(ie,34919):he.getQueryObjectEXT(ie,he.QUERY_RESULT_AVAILABLE_EXT),U=ne.getParameter(he.GPU_DISJOINT_EXT);if(L&&!U){const k=$?ne.getQueryParameter(ie,34918):he.getQueryObjectEXT(ie,he.QUERY_RESULT_EXT);this.profile.renderTime+=k/1e6,K.splice(oe,1)}}},this}let xJ=0;class yJ{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){const t=e.vertexShader,n=e.fragmentShader,r=this._getShaderStage(t),a=this._getShaderStage(n),i=this._getShaderCacheForMaterial(e);return i.has(r)===!1&&(i.add(r),r.usedTimes++),i.has(a)===!1&&(i.add(a),a.usedTimes++),this}remove(e){const t=this.materialCache.get(e);for(const n of t)n.usedTimes--,n.usedTimes===0&&this.shaderCache.delete(n.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){const t=this.materialCache;let n=t.get(e);return n===void 0&&(n=new Set,t.set(e,n)),n}_getShaderStage(e){const t=this.shaderCache;let n=t.get(e);return n===void 0&&(n=new bJ(e),t.set(e,n)),n}}class bJ{constructor(e){this.id=xJ++,this.code=e,this.usedTimes=0}}function SJ(o,e,t,n,r,a,i){const s=new Rd,c=new yJ,u=[],h=r.isWebGL2,f=r.logarithmicDepthBuffer,m=r.vertexTextures;let g=r.precision,A=0;const _={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite",MeshMaskMaterial:"mask",MeshNodeMaterial:"node"};return{getParameters:function(x,C,b,y,M,R){const T=y.fog,w=M.geometry,D=x.isMeshNodeMaterial||x.isMeshStandardMaterial?y.environment:null,z=(x.isMeshNodeMaterial||x.isMeshStandardMaterial?t:e).get(x.envMap||D),F=_[x.type];x.precision!==null&&(g=r.getMaxPrecision(x.precision),g!==x.precision&&console.warn("v3d.WebGLProgram.getParameters:",x.precision,"not supported, using",g,"instead."));const O=w.morphAttributes.position||w.morphAttributes.normal||w.morphAttributes.color,q=O!==void 0?O.length:0;let ne,$,he,K,oe=0;if(w.morphAttributes.position!==void 0&&(oe=1),w.morphAttributes.normal!==void 0&&(oe=2),w.morphAttributes.color!==void 0&&(oe=3),F){const k=xt[F];ne=k.vertexShader,$=k.fragmentShader}else ne=x.vertexShader,$=x.fragmentShader,c.update(x),he=c.getVertexShaderID(x),K=c.getFragmentShaderID(x);const ie=o.getRenderTarget(),L=x.alphaTest>0,U=x.clearcoat>0;return{isWebGL2:h,shaderID:F,shaderName:x.type,vertexShader:ne,fragmentShader:$,defines:x.defines,customVertexShaderID:he,customFragmentShaderID:K,isRawShaderMaterial:x.isRawShaderMaterial===!0,glslVersion:x.glslVersion,precision:g,instancing:M.isInstancedMesh===!0,instancingColor:M.isInstancedMesh===!0&&M.instanceColor!==null,supportsVertexTextures:m,outputEncoding:ie===null?o.outputEncoding:ie.isXRRenderTarget===!0?ie.texture.encoding:3e3,map:!!x.map,envMap:!!z,envMapMode:z&&z.mapping,lightMap:!!x.lightMap,aoMap:!!x.aoMap,emissiveMap:!!x.emissiveMap,bumpMap:!!x.bumpMap,normalMap:!!x.normalMap,objectSpaceNormalMap:x.normalMapType===1,tangentSpaceNormalMap:x.normalMapType===0,decodeVideoTexture:!!x.map&&x.map.isVideoTexture===!0&&x.map.encoding===3001,clearcoat:U,clearcoatMap:U&&!!x.clearcoatMap,clearcoatRoughnessMap:U&&!!x.clearcoatRoughnessMap,clearcoatNormalMap:U&&!!x.clearcoatNormalMap,displacementMap:!!x.displacementMap,roughnessMap:!!x.roughnessMap,metalnessMap:!!x.metalnessMap,specularMap:!!x.specularMap,specularIntensityMap:!!x.specularIntensityMap,specularColorMap:!!x.specularColorMap,opaque:x.transparent===!1&&x.blending===1,alphaMap:!!x.alphaMap,alphaTest:L,transmission:x.transmission>0,transmissionMap:!!x.transmissionMap,thicknessMap:!!x.thicknessMap,combine:x.combine,vertexTangents:!!x.normalMap&&!!w.attributes.tangent,vertexColors:x.vertexColors,vertexAlphas:x.vertexColors===!0&&!!w.attributes.color&&w.attributes.color.itemSize===4,vertexUvs:!!(x.map||x.bumpMap||x.normalMap||x.specularMap||x.alphaMap||x.emissiveMap||x.roughnessMap||x.metalnessMap||x.clearcoatMap||x.clearcoatRoughnessMap||x.clearcoatNormalMap||x.displacementMap||x.transmissionMap||x.thicknessMap||x.specularIntensityMap||x.specularColorMap),uvsVertexOnly:!(x.map||x.bumpMap||x.normalMap||x.specularMap||x.alphaMap||x.emissiveMap||x.roughnessMap||x.metalnessMap||x.clearcoatNormalMap||x.transmission>0||x.transmissionMap||x.thicknessMap||x.specularIntensityMap||x.specularColorMap||!x.displacementMap),fog:!!T,useFog:x.fog===!0,fogExp2:T&&T.isFogExp2,flatShading:!!x.flatShading,sizeAttenuation:x.sizeAttenuation,logarithmicDepthBuffer:f,skinning:M.isSkinnedMesh===!0,morphTargets:w.morphAttributes.position!==void 0,morphNormals:w.morphAttributes.normal!==void 0,morphColors:w.morphAttributes.color!==void 0,morphTargetsCount:q,morphTextureStride:oe,numDirLights:C.directional.length,numPointLights:C.point.length,numSpotLights:C.spot.length,numRectAreaLights:C.rectArea.length,numHemiLights:C.hemi.length,numPointLightShadows:C.pointShadowMap.length,numSpotLightShadows:C.spotShadowMap.length,numClippingPlanes:i.numPlanes,numClipIntersection:i.numIntersection,dithering:x.dithering,shadowMapEnabled:o.shadowMap.enabled&&b.length>0,shadowMapType:o.shadowMap.type,toneMapping:x.toneMapped?o.toneMapping:0,toneMappingLook:x.toneMapped?o.toneMappingLook:0,premultipliedAlpha:x.premultipliedAlpha,doubleSided:x.side===2,flipSided:x.side===1,useDepthPacking:!!x.depthPacking,depthPacking:x.depthPacking||0,envMapCubeUVTileSize:z&&z.mapping===306&&z.image!==void 0?z.image.width/3:0,distancePacking:x.distancePacking!==void 0&&x.distancePacking,useSlopeScaledBias:x.useSlopeScaledBias!==void 0&&x.useSlopeScaledBias,esmDistanceScale:o.shadowMap.esmDistanceScale,numRectAreaLightShadows:C.rectAreaShadowMap.length,numDirLightShadowsCSM:C.directionalShadowCSM.length,numDirLightShadowCSMCascades:C.directionalShadowCSMCascade.length,numDirLightShadowsCSMWithFade:C.numDirectionalShadowsCSMWithFade,dirLightShadowsCSMLUT:C.directionalShadowCSMLUT,planeReflProbe:!!R,materialName:x.name,materialProfile:x.profile,unitsScaleFactor:o.unitsScaleFactor,alphaToCoverage:!!x.alphaToCoverage,customPrepTokens:x.customPrepTokens,definesFragOnly:x.definesFragOnly,isMeshNodeMaterial:x.isMeshNodeMaterial,nodeChunks:x.nodeChunks,nodeChunksHash:x.nodeChunksHash,useGTAO:o.canUseGTAO()&&x.isMeshNodeMaterial&&x.canUseGTAO(),index0AttributeName:x.index0AttributeName,extensionDerivatives:x.extensions&&x.extensions.derivatives,extensionFragDepth:x.extensions&&x.extensions.fragDepth,extensionDrawBuffers:x.extensions&&x.extensions.drawBuffers,extensionShaderTextureLOD:x.extensions&&x.extensions.shaderTextureLOD,rendererExtensionFragDepth:h||n.has("EXT_frag_depth"),rendererExtensionDrawBuffers:h||n.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:h||n.has("EXT_shader_texture_lod"),customProgramCacheKey:x.customProgramCacheKey()}},getProgramCacheKey:function(x){const C=[];x.shaderID?C.push(x.shaderID):(C.push(x.customVertexShaderID),C.push(x.customFragmentShaderID));for(const b in x.defines)C.push(b),C.push(x.defines[b]);if(x.customPrepTokens!==void 0)for(const b in x.customPrepTokens)C.push(b),C.push(x.customPrepTokens[b]);return x.isRawShaderMaterial===!1&&(function(b,y){b.push(y.precision),b.push(y.outputEncoding),b.push(y.envMapMode),b.push(y.combine),b.push(y.vertexUvs),b.push(y.fogExp2),b.push(y.sizeAttenuation),b.push(y.morphTargetsCount),b.push(y.morphAttributeCount),b.push(y.numDirLights),b.push(y.numPointLights),b.push(y.numSpotLights),b.push(y.numHemiLights),b.push(y.numRectAreaLights),b.push(y.numPointLightShadows),b.push(y.numSpotLightShadows),b.push(y.shadowMapType),b.push(y.toneMapping),b.push(y.toneMappingLook),b.push(y.numClippingPlanes),b.push(y.numClipIntersection),b.push(y.depthPacking),b.push(y.envMapCubeUVTileSize),b.push(y.unitsScaleFactor),b.push(y.esmDistanceScale),b.push(y.numRectAreaLightShadows),b.push(y.numDirLightShadowsCSM),b.push(y.numDirLightShadowCSMCascades),b.push(y.numDirLightShadowsCSMWithFade),b.push(y.dirLightShadowsCSMLUT)}(C,x),function(b,y){s.disableAll(),y.isWebGL2&&s.enable(0),y.supportsVertexTextures&&s.enable(1),y.instancing&&s.enable(2),y.instancingColor&&s.enable(3),y.map&&s.enable(4),y.envMap&&s.enable(5),y.lightMap&&s.enable(6),y.aoMap&&s.enable(7),y.emissiveMap&&s.enable(8),y.bumpMap&&s.enable(9),y.normalMap&&s.enable(10),y.objectSpaceNormalMap&&s.enable(11),y.tangentSpaceNormalMap&&s.enable(12),y.clearcoat&&s.enable(13),y.clearcoatMap&&s.enable(14),y.clearcoatRoughnessMap&&s.enable(15),y.clearcoatNormalMap&&s.enable(16),y.displacementMap&&s.enable(17),y.specularMap&&s.enable(18),y.roughnessMap&&s.enable(19),y.metalnessMap&&s.enable(20),y.alphaMap&&s.enable(21),y.alphaTest&&s.enable(22),y.vertexColors&&s.enable(23),y.vertexAlphas&&s.enable(24),y.vertexUvs&&s.enable(25),y.vertexTangents&&s.enable(26),y.uvsVertexOnly&&s.enable(27),b.push(s.mask),s.disableAll(),y.fog&&s.enable(0),y.useFog&&s.enable(1),y.flatShading&&s.enable(2),y.logarithmicDepthBuffer&&s.enable(3),y.skinning&&s.enable(4),y.morphTargets&&s.enable(5),y.morphNormals&&s.enable(6),y.morphColors&&s.enable(7),y.premultipliedAlpha&&s.enable(8),y.shadowMapEnabled&&s.enable(9),y.doubleSided&&s.enable(10),y.flipSided&&s.enable(11),y.useDepthPacking&&s.enable(12),y.dithering&&s.enable(13),y.specularIntensityMap&&s.enable(14),y.specularColorMap&&s.enable(15),y.transmission&&s.enable(16),y.transmissionMap&&s.enable(17),y.thicknessMap&&s.enable(18),y.decodeVideoTexture&&s.enable(19),y.opaque&&s.enable(20),y.distancePacking&&s.enable(21),y.useSlopeScaledBias&&s.enable(22),y.useGTAO&&s.enable(23),y.planeReflProbe&&s.enable(24),y.alphaToCoverage&&s.enable(25),b.push(s.mask)}(C,x),C.push(o.outputEncoding)),C.push(x.customProgramCacheKey),x.nodeChunksHash!==void 0&&C.push(x.nodeChunksHash),C.join()},getUniforms:function(x){const C=_[x.type];let b;if(C){const y=xt[C];b=no.clone(y.uniforms)}else b=x.uniforms;return b},acquireProgram:function(x,C){let b;for(let M=0,R=u.length;M<R;M++){const T=u[M];if(T.cacheKey===C){b=T,++b.usedTimes;break}}b===void 0&&(b=new AJ(o,C,x,a),u.push(b),A++);const y=b.profile.materials;return x.materialName&&!y.has(x.materialName)&&y.add(x.materialName),b},releaseProgram:function(x){if(--x.usedTimes==0){const C=u.indexOf(x);u[C]=u[u.length-1],u.pop(),x.destroy()}},releaseShaderCache:function(x){c.remove(x)},programs:u,getNumShaderCompiles:function(){return A},dispose:function(){c.dispose()}}}function CJ(){let o=new WeakMap;return{get:function(e){let t=o.get(e);return t===void 0&&(t={},o.set(e,t)),t},remove:function(e){o.delete(e)},update:function(e,t,n){o.get(e)[t]=n},dispose:function(){o=new WeakMap}}}function EJ(o,e){return o.groupOrder!==e.groupOrder?o.groupOrder-e.groupOrder:o.renderOrder!==e.renderOrder?o.renderOrder-e.renderOrder:o.material.id!==e.material.id?o.material.id-e.material.id:o.z!==e.z?o.z-e.z:o.id-e.id}function DM(o,e){return o.groupOrder!==e.groupOrder?o.groupOrder-e.groupOrder:o.renderOrder!==e.renderOrder?o.renderOrder-e.renderOrder:o.z!==e.z?e.z-o.z:o.id-e.id}function OM(){const o=[];let e=0;const t=[],n=[],r=[];function a(i,s,c,u,h,f){let m=o[e];return m===void 0?(m={id:i.id,object:i,geometry:s,material:c,groupOrder:u,renderOrder:i.renderOrder,z:h,group:f},o[e]=m):(m.id=i.id,m.object=i,m.geometry=s,m.material=c,m.groupOrder=u,m.renderOrder=i.renderOrder,m.z=h,m.group=f),e++,m}return{opaque:t,transmissive:n,transparent:r,init:function(){e=0,t.length=0,n.length=0,r.length=0},push:function(i,s,c,u,h,f){const m=a(i,s,c,u,h,f);c.transmission>0?n.push(m):c.transparent===!0?r.push(m):t.push(m)},unshift:function(i,s,c,u,h,f){const m=a(i,s,c,u,h,f);c.transmission>0?n.unshift(m):c.transparent===!0?r.unshift(m):t.unshift(m)},finish:function(){for(let i=e,s=o.length;i<s;i++){const c=o[i];if(c.id===null)break;c.id=null,c.object=null,c.geometry=null,c.material=null,c.group=null}},sort:function(i,s){t.length>1&&t.sort(i||EJ),n.length>1&&n.sort(s||DM),r.length>1&&r.sort(s||DM)}}}function MJ(){let o=new WeakMap;return{get:function(e,t){const n=o.get(e);let r;return n===void 0?(r=new OM,o.set(e,[r])):t>=n.length?(r=new OM,n.push(r)):r=n[t],r},dispose:function(){o=new WeakMap}}}function wJ(){const o={};return{get:function(e){if(o[e.id]!==void 0)return o[e.id];let t;switch(e.type){case"DirectionalLight":t={direction:new B,color:new Qe};break;case"SpotLight":t={position:new B,direction:new B,color:new Qe,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":t={position:new B,color:new Qe,distance:0,decay:0};break;case"HemisphereLight":t={direction:new B,skyColor:new Qe,groundColor:new Qe};break;case"RectAreaLight":t={color:new Qe,position:new B,halfWidth:new B,halfHeight:new B}}return o[e.id]=t,t}}}function TJ(){const o={};return{get:function(e){if(o[e.id]!==void 0)return o[e.id];let t;switch(e.type){case"DirectionalLight":t={cascadeIdxEnd:1,cameraNear:1,shadowFar:0,fade:.25};break;case"SpotLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Ee,shadow:0,shadowCameraNear:1,shadowCameraFar:1e3,expBias:1};break;case"PointLight":case"RectAreaLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Ee,shadowCameraNear:1,shadowCameraFar:1e3,expBias:1}}return o[e.id]=t,t}}}let RJ=0;function IJ(o,e){const t=o.shadow,n=e.shadow;let r=0;return t&&t.isDirectionalLightShadowCSM&&n&&n.isDirectionalLightShadowCSM&&(r+=(n.fade!=0?1:0)-(t.fade!=0?1:0)),(e.castShadow?4:0)-(o.castShadow?4:0)+(e.map?2:0)-(o.map?2:0)+r}function LJ(o,e){const t=new wJ,n=TJ(),r={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numPointShadows:-1,numSpotShadows:-1,numRectAreaShadows:-1,numDirectionalShadowsCSM:-1,numDirectionalShadowsCSMCascade:-1,numDirectionalShadowsCSMWithFade:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadow:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],rectAreaShadow:[],rectAreaShadowMap:[],rectAreaShadowMatrix:[],directionalShadowCSM:[],directionalShadowCSMMap:[],directionalShadowCSMMatrix:[],directionalShadowCSMCascade:[],directionalShadowCSMLUT:[],numDirectionalShadowsCSMWithFade:0};for(let c=0;c<9;c++)r.probe.push(new B);const a=new B,i=new Ve,s=new Ve;return{setup:function(c){let u=0,h=0,f=0;for(let D=0;D<9;D++)r.probe[D].set(0,0,0);let m=0,g=0,A=0,_=0,x=0,C=0,b=0,y=0,M=0,R=0,T=0;c.sort(IJ);for(let D=0,z=c.length;D<z;D++){const F=c[D],O=F.color,q=F.intensity,ne=F.distance,$=F.shadow&&F.shadow.map?F.shadow.map.texture:null;if(F.isAmbientLight)u+=O.r*q,h+=O.g*q,f+=O.b*q;else if(F.isLightProbe)for(let he=0;he<9;he++)r.probe[he].addScaledVector(F.sh.coefficients[he],q);else if(F.isDirectionalLight){const he=t.get(F);if(he.color.copy(F.color).multiplyScalar(F.intensity),F.castShadow){const K=F.shadow,oe=n.get(F);oe.cascadeIdxEnd=T+K.numCascades,oe.fade=K.fade,R+=K.fade!=0?K.numCascades:0;for(let ie=0;ie<K.numCascades;ie++){let L=T+ie;r.directionalShadowCSMCascade[L]||(r.directionalShadowCSMCascade[L]={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Ee,shadowCameraNear:1,shadowCameraFar:1,cascade:new Ee,expBias:1,position:new B,csmIdx:0},r.directionalShadowCSMMap[L]=null,r.directionalShadowCSMMatrix[L]=K.matrix)}for(let ie=0;ie<K.numCascades;ie++){const L=T+ie,U=r.directionalShadowCSMCascade[L],k=K._cascades[ie],J=k.map?k.map.texture:null;r.directionalShadowCSMMap[L]=J,r.directionalShadowCSMMatrix[L]=k.matrix,U.shadowBias=k.bias,U.shadowNormalBias=k.normalBias,U.shadowRadius=k.radius,U.shadowMapSize=k.mapSize,U.position.setFromMatrixPosition(k.camera.matrixWorld),U.shadowCameraNear=k.camera.near,U.shadowCameraFar=k.camera.far,K.getCascadeRange(U.cascade,ie),U.expBias=k.expBias,U.csmIdx=M,r.directionalShadowCSMLUT[L]=M}T+=K.numCascades,r.directionalShadowCSM[M]=oe,M++}r.directional[m]=he,m++}else if(F.isSpotLight){const he=t.get(F);if(he.position.setFromMatrixPosition(F.matrixWorld),he.color.copy(O).multiplyScalar(q),he.distance=ne,he.coneCos=Math.cos(F.angle),he.penumbraCos=Math.cos(F.angle*(1-F.penumbra)),he.decay=F.decay,r.spot[A]=he,F.castShadow){const K=F.shadow,oe=n.get(F);oe.shadowBias=K.bias,oe.shadowNormalBias=K.normalBias,oe.shadowRadius=K.radius,oe.shadowMapSize=K.mapSize,r.spotShadow[A]=oe,r.spotShadowMap[A]=$,r.spotShadowMatrix[A]=K.matrix,oe.shadow=F.castShadow?K.calcUseOmniMaps(F.angle)?2:1:0,oe.shadowCameraNear=K.camera.near,oe.shadowCameraFar=K.camera.far,oe.expBias=K.expBias,b++}A++}else if(F.isRectAreaLight){const he=t.get(F);if(he.color.copy(O).multiplyScalar(q),he.halfWidth.set(.5*F.width,0,0),he.halfHeight.set(0,.5*F.height,0),F.castShadow){const K=F.shadow,oe=n.get(F);oe.shadowBias=K.bias,oe.shadowNormalBias=K.normalBias,oe.shadowRadius=K.radius,oe.shadowMapSize=K.mapSize,oe.shadowCameraNear=K.camera.near,oe.shadowCameraFar=K.camera.far,oe.expBias=K.expBias,r.rectAreaShadow[_]=oe,r.rectAreaShadowMap[_]=$,r.rectAreaShadowMatrix[_]=K.matrix,y++}r.rectArea[_]=he,_++}else if(F.isPointLight){const he=t.get(F);if(he.color.copy(F.color).multiplyScalar(F.intensity),he.distance=F.distance,he.decay=F.decay,F.castShadow){const K=F.shadow,oe=n.get(F);oe.shadowBias=K.bias,oe.shadowNormalBias=K.normalBias,oe.shadowRadius=K.radius,oe.shadowMapSize=K.mapSize,oe.shadowCameraNear=K.camera.near,oe.shadowCameraFar=K.camera.far,oe.expBias=K.expBias,r.pointShadow[g]=oe,r.pointShadowMap[g]=$,r.pointShadowMatrix[g]=K.matrix,C++}r.point[g]=he,g++}else if(F.isHemisphereLight){const he=t.get(F);he.skyColor.copy(F.color).multiplyScalar(q),he.groundColor.copy(F.groundColor).multiplyScalar(q),r.hemi[x]=he,x++}}_>0&&(e.isWebGL2||o.has("OES_texture_float_linear")===!0?(r.rectAreaLTC1=Ze.LTC_FLOAT_1,r.rectAreaLTC2=Ze.LTC_FLOAT_2):o.has("OES_texture_half_float_linear")===!0?(r.rectAreaLTC1=Ze.LTC_HALF_1,r.rectAreaLTC2=Ze.LTC_HALF_2):console.error("v3d.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),r.ambient[0]=u,r.ambient[1]=h,r.ambient[2]=f;const w=r.hash;w.directionalLength===m&&w.pointLength===g&&w.spotLength===A&&w.rectAreaLength===_&&w.hemiLength===x&&w.numPointShadows===C&&w.numSpotShadows===b&&w.numRectAreaShadows===y&&w.numDirectionalShadowsCSM===M&&w.numDirectionalShadowsCSMCascade===T&&w.numDirectionalShadowsCSMWithFade===R||(r.directional.length=m,r.spot.length=A,r.rectArea.length=_,r.point.length=g,r.hemi.length=x,r.pointShadow.length=C,r.pointShadowMap.length=C,r.spotShadow.length=b,r.spotShadowMap.length=b,r.pointShadowMatrix.length=C,r.spotShadowMatrix.length=b,w.directionalLength=m,w.pointLength=g,w.spotLength=A,w.rectAreaLength=_,w.hemiLength=x,w.numPointShadows=C,w.numSpotShadows=b,r.rectAreaShadow.length=y,r.rectAreaShadowMap.length=y,r.rectAreaShadowMatrix.length=y,r.directionalShadowCSM.length=M,r.directionalShadowCSMMap.length=T,r.directionalShadowCSMMatrix.length=T,r.directionalShadowCSMCascade.length=T,r.directionalShadowCSMLUT.length=T,r.numDirectionalShadowsCSMWithFade=R,w.numRectAreaShadows=y,w.numDirectionalShadowsCSM=M,w.numDirectionalShadowsCSMCascade=T,w.numDirectionalShadowsCSMWithFade=R,r.version=RJ++)},setupView:function(c,u){let h=0,f=0,m=0,g=0,A=0,_=0;const x=u.matrixWorldInverse;for(let C=0,b=c.length;C<b;C++){const y=c[C];if(y.isDirectionalLight){const M=r.directional[h];if(M.direction.setFromMatrixPosition(y.matrixWorld),a.setFromMatrixPosition(y.target.matrixWorld),M.direction.sub(a),M.direction.transformDirection(x),y.castShadow){const R=y.shadow,T=n.get(y);T.cameraNear=Math.min(R.maxDistance,u.near),T.shadowFar=Math.min(R.maxDistance,u.far);for(let w=0;w<R.numCascades;w++){const D=_+w,z=r.directionalShadowCSMCascade[D],F=R._cascades[w];z.shadowCameraFar=F.camera.far,z.position.setFromMatrixPosition(F.camera.matrixWorld),z.position.applyMatrix4(x)}_+=R.numCascades}h++}else if(y.isSpotLight){const M=r.spot[m];M.position.setFromMatrixPosition(y.matrixWorld),M.position.applyMatrix4(x),M.direction.setFromMatrixPosition(y.matrixWorld),a.setFromMatrixPosition(y.target.matrixWorld),M.direction.sub(a),M.direction.transformDirection(x),m++}else if(y.isRectAreaLight){const M=r.rectArea[g];M.position.setFromMatrixPosition(y.matrixWorld),M.position.applyMatrix4(x),s.identity(),i.copy(y.matrixWorld),i.premultiply(x),s.extractRotation(i),M.halfWidth.set(.5*y.width,0,0),M.halfHeight.set(0,.5*y.height,0),M.halfWidth.applyMatrix4(s),M.halfHeight.applyMatrix4(s),g++}else if(y.isPointLight){const M=r.point[f];M.position.setFromMatrixPosition(y.matrixWorld),M.position.applyMatrix4(x),f++}else if(y.isHemisphereLight){const M=r.hemi[A];M.direction.setFromMatrixPosition(y.matrixWorld),M.direction.transformDirection(x),A++}}},state:r}}function y2(o,e){const t=new LJ(o,e),n=[],r=[],a=[],i=[];return{init:function(){n.length=0,r.length=0,a.length=0,i.length=0},state:{lightsArray:n,shadowsArray:r,envMapProbeArray:a,planeReflProbeArray:i,lights:t},setupLights:function(){t.setup(n)},setupLightsView:function(s){t.setupView(n,s)},pushLight:function(s){n.push(s)},pushShadow:function(s){r.push(s)},pushEnvMapProbe:function(s){a.push(s)},sortEnvMapProbes:function(){a.sort((s,c)=>s.influenceDistance-c.influenceDistance)},pushPlaneReflProbe:function(s){i.push(s)}}}function BJ(o,e){let t=new WeakMap;return{get:function(n,r=0){const a=t.get(n);let i;return a===void 0?(i=new y2(o,e),t.set(n,[i])):r>=a.length?(i=new y2(o,e),a.push(i)):i=a[r],i},dispose:function(){t=new WeakMap}}}class Ad extends Er{constructor(e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=3200,this.useSlopeScaledBias=!1,this.slopeScaledBias=0,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.useSlopeScaledBias=e.useSlopeScaledBias,this.slopeScaledBias=e.slopeScaledBias,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}class w5 extends Er{constructor(e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.referencePosition=new B,this.nearDistance=1,this.farDistance=1e3,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.defines={DISTANCE_SCALE:"1.0"},this.distancePacking=3301,this.useSlopeScaledBias=!1,this.slopeScaledBias=0,this.setValues(e)}copy(e){return super.copy(e),this.referencePosition.copy(e.referencePosition),this.nearDistance=e.nearDistance,this.farDistance=e.farDistance,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.distancePacking=e.distancePacking,this.useSlopeScaledBias=e.useSlopeScaledBias,this.slopeScaledBias=e.slopeScaledBias,this}}const PA=new Ve,FM=new B,UM=new B;class Sv{constructor(e){this.camera=e,this.bias=0,this.normalBias=0,this.radius=1,this.mapSize=new Ee(512,512),this.map=null,this.mapPass=null,this.matrix=new Ve,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new hp,this._frameExtents=new Ee(1,1),this._viewportCount=1,this._viewports=[new ct(0,0,1,1)],this.expBias=1,this.slopeScaledBias=0,this._additionalMap2D=null,this._additionalMapCube=null,this.isLightShadow=!0}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const t=this.camera,n=this.matrix;FM.setFromMatrixPosition(e.matrixWorld),t.position.copy(FM),UM.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(UM),t.updateMatrixWorld(),PA.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(PA),n.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),n.multiply(PA)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose(),this._additionalMap2D!==null&&this._additionalMap2D.dispose(),this._additionalMapCube!==null&&this._additionalMapCube.dispose()}copy(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this.expBias=e.expBias,this.slopeScaledBias=e.slopeScaledBias,this}clone(){return new this.constructor().copy(this)}}const PJ=Math.PI/4,zM=new Ve,Df=new B,NA=new B;class NJ extends Sv{constructor(){super(new ir(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1,this.useOmniMaps=!1,this.useMinFov90=!1,this._frameExtentsOmni=new Ee(4,2),this._viewportCountOmni=6,this._viewportsOmni=[new ct(2,1,1,1),new ct(0,1,1,1),new ct(3,1,1,1),new ct(1,1,1,1),new ct(3,0,1,1),new ct(1,0,1,1)],this._cubeDirections=[new B(1,0,0),new B(-1,0,0),new B(0,0,1),new B(0,0,-1),new B(0,1,0),new B(0,-1,0)],this._cubeUps=[new B(0,1,0),new B(0,1,0),new B(0,1,0),new B(0,1,0),new B(0,0,1),new B(0,0,-1)]}updateMatrices(e,t=0){if(this.useOmniMaps){const n=this.camera,r=this.matrix;Df.setFromMatrixPosition(e.matrixWorld),n.position.copy(Df),NA.copy(n.position),NA.add(this._cubeDirections[t]),n.up.copy(this._cubeUps[t]),n.lookAt(NA),n.updateMatrixWorld(),r.makeTranslation(-Df.x,-Df.y,-Df.z),zM.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),this._frustum.setFromProjectionMatrix(zM)}else{const n=this.camera,r=2*gd*e.angle*this.focus,a=this.mapSize.width/this.mapSize.height,i=e.distance||n.far;r===n.fov&&a===n.aspect&&i===n.far||(n.fov=r,n.aspect=a,n.far=i,n.updateProjectionMatrix()),super.updateMatrices(e)}}getViewportCount(){return this.useOmniMaps?this._viewportCountOmni:super.getViewportCount()}getViewport(e){return this.useOmniMaps?this._viewportsOmni[e]:super.getViewport(e)}getFrameExtents(){return this.useOmniMaps?this._frameExtentsOmni:super.getFrameExtents()}calcUseOmniMaps(e){return this.useOmniMaps=e>PJ,this.useOmniMaps}copy(e){return super.copy(e),this.focus=e.focus,this.useOmniMaps=e.useOmniMaps,this.useMinFov90=e.useMinFov90,this}}function DJ(o,e,t){let n=new hp;const r=new Ee,a=new Ee,i=new ct,s=new Ad({depthPacking:3201}),c=new w5,u={},h=t.maxTextureSize,f=t.isWebGL2,m={0:1,1:0,2:2},g=new Ve;new Ve;const A=new Ee(h,h),_=new B,x=new B;new B;const C=[new B(1,0,0),new B(-1,0,0),new B(0,1,0),new B(0,-1,0),new B(0,0,1),new B(0,0,-1)],b=[new B(0,1,0),new B(0,1,0),new B(0,0,1),new B(0,0,-1),new B(0,1,0),new B(0,1,0)];new ct,new ct,new ct,new ct,new ct,new ct,new Yo,new B,new B,new B,new B,new B,new B,new B,new B;const y=new Mt(new ps(1,1,1,1));y.name="esmFarPlane",y.castShadow=!0,y.material.shadowSide=0;const M=new yi(-1,1,1,-1,0,10),R=new Mt(new ps(2,2)),T=new An({type:"ShadowCubeOctahedral",defines:Object.assign({},xt.cubeOctahedral.defines),uniforms:no.clone(xt.cubeOctahedral.uniforms),vertexShader:xt.cubeOctahedral.vertexShader,fragmentShader:xt.cubeOctahedral.fragmentShader}),w={},D={},z=this;function F(oe,ie,L,U,k,J,de,te,le){let V=null;const G=te||de===3?oe.customDistanceMaterial:oe.customDepthMaterial;if(V=G!==void 0?G:te||de===3?c:s,o.localClippingEnabled&&L.clipShadows===!0&&Array.isArray(L.clippingPlanes)&&L.clippingPlanes.length!==0||L.displacementMap&&L.displacementScale!==0||L.alphaMap&&L.alphaTest>0||L.map&&L.alphaTest>0){const ee=V.uuid,X=L.uuid;let W=u[ee];W===void 0&&(W={},u[ee]=W);let Y=W[X];Y===void 0&&(Y=V.clone(),W[X]=Y),V=Y}switch(V.visible=L.visible,V.wireframe=L.wireframe,V.side=L.shadowSide!==null?L.shadowSide:m[L.side],V.alphaMap=L.alphaMap,V.alphaTest=L.alphaTest,V.map=L.map,V.clipShadows=L.clipShadows,V.clippingPlanes=L.clippingPlanes,V.clipIntersection=L.clipIntersection,V.displacementMap=L.displacementMap,V.displacementScale=L.displacementScale,V.displacementBias=L.displacementBias,V.wireframeLinewidth=L.wireframeLinewidth,V.linewidth=L.linewidth,!te&&de!==3||V.isMeshDistanceMaterial!==!0||(V.referencePosition.copy(le),V.nearDistance=k,V.farDistance=J,V.distancePacking=de===3?3302:3301),de===3&&(V.defines.DISTANCE_SCALE=al(z.esmDistanceScale)),U.shadow.isDirectionalLightShadowCascade&&U.shadow.pancakeDepth&&(V.defines.PANCAKE_DEPTH="",V.defines.CAM_WIDTH=al(U.shadow.camera.right),V.defines.CAM_HEIGHT=al(U.shadow.camera.top)),de){case 0:case 1:case 2:V.useSlopeScaledBias=!0,V.slopeScaledBias=U.shadow.slopeScaledBias;break;case 3:V.useSlopeScaledBias=!0,V.slopeScaledBias=.5}return V}function O(oe,ie,L,U,k,J){if(oe.visible===!1)return;if((ie.ignoreShadowLayers||oe.layers.test(ie.layers))&&(oe.isMesh||oe.isLine||oe.isPoints)&&oe.castShadow&&(!oe.frustumCulled||n.intersectsObject(oe))){oe.modelViewMatrix.multiplyMatrices(L.matrixWorldInverse,oe.matrixWorld);const te=e.update(oe),le=oe.material;if(Array.isArray(le)){const V=te.groups;for(let G=0,ee=V.length;G<ee;G++){const X=V[G],W=le[X.materialIndex];if(W&&W.visible){const Y=F(oe,0,W,U,L.near,L.far,k,J,x);o.renderBufferDirect(L,null,te,Y,oe,X)}}}else if(le.visible){const V=F(oe,0,le,U,L.near,L.far,k,J,x);o.renderBufferDirect(L,null,te,V,oe,null)}}const de=oe.children;for(let te=0,le=de.length;te<le;te++)O(de[te],ie,L,U,k,J)}function q(oe,ie,L,U){const k=L.shadow,J=k.camera;k.isDirectionalLightShadowCascade?x.setFromMatrixPosition(J.matrixWorld):x.setFromMatrixPosition(L.matrixWorld),r.copy(k.mapSize);const de=k.getFrameExtents();if(r.multiply(de),a.copy(k.mapSize),(r.x>h||r.y>h)&&(r.x>h&&(a.x=Math.floor(h/de.x),r.x=a.x*de.x,k.mapSize.x=a.x),r.y>h&&(a.y=Math.floor(h/de.y),r.y=a.y*de.y,k.mapSize.y=a.y)),L.isSpotLight&&k.map&&k.map.width/k.map.height!=2){const V=k.map;k.map=k._additionalMap2D,k._additionalMap2D=V}const te=L.isPointLight||L.isRectAreaLight||L.isSpotLight&&k.useOmniMaps;if(te?L.isSpotLight&&(J.fov=90,J.updateProjectionMatrix()):L.isSpotLight&&k.useMinFov90&&(J.fov=90,J.updateProjectionMatrix()),k.map===null){const V={minFilter:1003,magFilter:1003,format:1023};k.map=new qt(r.x,r.y,V),k.map.texture.name=L.name+".shadowMap",J.updateProjectionMatrix()}o.state.buffers.color.setClear(1,1,1,1),o.setRenderTarget(k.map),o.clear();const le=k.getViewportCount();for(let V=0;V<le;V++){const G=k.getViewport(V);i.set(a.x*G.x,a.y*G.y,a.x*G.z,a.y*G.w),o.state.viewport(i),k.updateMatrices(L,V),n.copy(k.getFrustum()),O(oe,ie,k.camera,L,U,te)}}function ne(oe,ie,L,U){const k=L.shadow,J=k.camera,de=k.matrix,te=L.isPointLight||L.isRectAreaLight?2:1,le=r.copy(k.mapSize).multiplyScalar(te).min(A).multiplyScalar(1/te);k._additionalMapCube===null&&(k._additionalMapCube=new fp(le.x,{minFilter:1006,magFilter:1006,format:f?1028:1023,type:1016}),k._additionalMapCube.texture.name=L.name+".shadowMap.tmpCube"),k._additionalMap2D===null&&(k._additionalMap2D=new qt(le.x*te,le.y*te,{minFilter:1006,magFilter:1006,format:f?1028:1023,type:1016}),k._additionalMap2D.texture.name=L.name+".shadowMap.tmp2D"),k.map===null&&(k.map=new qt(le.x*te,le.y*te,{minFilter:1006,magFilter:1006,format:f?1028:1023,type:1016}),k.map.texture.name=L.name+".shadowMap"),x.setFromMatrixPosition(L.matrixWorld),J.position.copy(x),L.isSpotLight&&(J.fov=90,J.updateProjectionMatrix()),de.makeTranslation(-x.x,-x.y,-x.z);for(let ee=0;ee<6;ee++)_.copy(J.position),_.add(C[ee]),J.up.copy(b[ee]),ee!==2&&ee!==3&&J.up.multiplyScalar(-1),J.lookAt(_),J.updateMatrixWorld(),g.multiplyMatrices(J.projectionMatrix,J.matrixWorldInverse),n.setFromProjectionMatrix(g),o.setRenderTarget(k._additionalMapCube,ee),o.clearDepth(),K(ie,J,L,U),O(oe,ie,J,L,U,!0);const V=Math.max(k.radius*te,.001),G=function(ee){return Math.ceil(.2*ee)}(V);(function(ee,X,W){const Y=R.material=T;Y.uniforms.tCube.value=X.texture,Y.uniforms.texelSize.value.set(1/W.width,1/W.height),Y.uniformsNeedUpdate=!0,ee.setRenderTarget(W),ee.clear(),ee.updateGeometry(R),ee.renderBufferDirect(M,null,R.geometry,Y,R,null)})(o,k._additionalMapCube,k.map),$(o,k.map,k._additionalMap2D,G,V,1,0),$(o,k._additionalMap2D,k.map,G,V,0,0)}function $(oe,ie,L,U,k,J,de){const te=R.material=de===0?function(le){return le in w||((w[le]=new An({type:"ShadowBlur",defines:Object.assign({},xt.blur.defines,{LOG_SPACE:1,OCTAHEDRAL_MAP:1}),uniforms:no.clone(xt.blur.uniforms),customPrepTokens:Object.assign({},xt.blur.customPrepTokens),vertexShader:xt.blur.vertexShader,fragmentShader:xt.blur.fragmentShader})).customPrepTokens.MAX_SAMPLE_RADIUS=le),w[le]}(U):function(le){return le in D||((D[le]=new An({type:"ShadowBlur",defines:Object.assign({},xt.blur.defines,{LOG_SPACE:1}),uniforms:no.clone(xt.blur.uniforms),customPrepTokens:Object.assign({},xt.blur.customPrepTokens),vertexShader:xt.blur.vertexShader,fragmentShader:xt.blur.fragmentShader})).customPrepTokens.MAX_SAMPLE_RADIUS=le),D[le]}(U);te.uniforms.direction.value.set(+(J===0),+(J===1)),te.uniforms.colorTexture.value=ie.texture,te.uniforms.texSize.value.set(ie.width,ie.height),te.uniforms.kernelRadius.value=k,te.uniformsNeedUpdate=!0,oe.setRenderTarget(L),oe.clear(),oe.updateGeometry(R),oe.renderBufferDirect(M,null,R.geometry,te,R,null)}function he(oe,ie,L,U){const k=L.shadow,J=k.camera,de=k.matrix,te=r.copy(k.mapSize).min(A);let le;k._additionalMap2D===null&&(k._additionalMap2D=new qt(te.x,te.y,{minFilter:1006,magFilter:1006,format:f?1028:1023,type:1016}),k._additionalMap2D.texture.name=L.name+".shadowMap.tmp2D"),k.map===null&&(k.map=new qt(te.x,te.y,{minFilter:1006,magFilter:1006,format:f?1028:1023,type:1016}),k.map.texture.name=L.name+".shadowMap"),k.isDirectionalLightShadowCascade?x.setFromMatrixPosition(J.matrixWorld):(x.setFromMatrixPosition(L.matrixWorld),J.position.copy(x),_.setFromMatrixPosition(L.target.matrixWorld),J.lookAt(_),J.updateMatrixWorld()),L.isSpotLight&&k.useMinFov90&&(J.fov=90,J.updateProjectionMatrix()),k.isDirectionalLightShadowCascade?(k.updateMatrices(L),n.copy(k.getFrustum())):(de.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),de.multiply(J.projectionMatrix),de.multiply(J.matrixWorldInverse),g.multiplyMatrices(J.projectionMatrix,J.matrixWorldInverse),n.setFromProjectionMatrix(g)),o.setRenderTarget(k.map),o.clearDepth(),K(ie,J,L,U),O(oe,ie,J,L,U,!1),le=L.isDirectionalLight&&L.shadow.isDirectionalLightShadowCascade?50*k.esmBlurRadius:L.isSpotLight?.8*k.radius:k.radius,le=Math.max(le,.001);const V=function(G){return Math.ceil(.8*G)}(le);$(o,k.map,k._additionalMap2D,V,le,0,1),$(o,k._additionalMap2D,k.map,V,le,1,1)}function K(oe,ie,L,U){let k,J,de,te,le,V;ie.isPerspectiveCamera?(k=J=0,de=-.999*ie.far,te=le=2*-de*Math.tan(cp(ie.fov)/2),V=1):ie.isOrthographicCamera&&(k=(ie.right+ie.left)/2,J=(ie.top+ie.bottom)/2,de=-.999*ie.far,te=ie.right-ie.left,le=ie.top-ie.bottom,V=1),ie.add(y),y.scale.set(te,le,V),y.position.set(k,J,de),y.updateMatrixWorld(),O(y,oe,ie,L,U,!0)}this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=2,this.esmDistanceScale=1,this.render=function(oe,ie,L){if(z.enabled===!1||z.autoUpdate===!1&&z.needsUpdate===!1||oe.length===0)return;const U=o.getRenderTarget(),k=o.getActiveCubeFace(),J=o.getActiveMipmapLevel(),de=o.state;de.setBlending(0),de.buffers.color.setClear(1,1,1,1),de.buffers.depth.setTest(!0),de.setScissorTest(!1);for(let te=0,le=oe.length;te<le;te++){const V=oe[te],G=V.shadow;if(G!==void 0){if(G.autoUpdate!==!1||G.needsUpdate!==!1){if(V.isSpotLight&&G.calcUseOmniMaps(V.angle),V.isPointLight||V.isRectAreaLight||V.isSpotLight&&G.useOmniMaps)switch(z.type){case 0:case 1:case 2:q(ie,L,V,z.type);break;case 3:ne(ie,L,V,z.type);break;default:continue}else{if(!V.isSpotLight&&!V.isDirectionalLight)continue;switch(z.type){case 0:case 1:case 2:if(G.isDirectionalLightShadowCSM){G.update(L,V);const ee=V.shadow;for(let X=0;X<ee.numCascades;X++)V.shadow=ee._cascades[X],q(ie,L,V,z.type);V.shadow=ee}else q(ie,L,V,z.type);break;case 3:if(G.isDirectionalLightShadowCSM){G.update(L,V);const ee=V.shadow;for(let X=0;X<ee.numCascades;X++)V.shadow=ee._cascades[X],he(ie,L,V,z.type);V.shadow=ee}else he(ie,L,V,z.type);break;default:continue}}G.needsUpdate=!1}}else console.warn("v3d.WebGLShadowMap:",V,"has no shadow.")}z.needsUpdate=!1,o.setRenderTarget(U,k,J)}}function OJ(o,e,t){const n=t.isWebGL2,r=new function(){let P=!1;const Q=new ct;let I=null;const N=new ct(0,0,0,0);return{setMask:function(se){I===se||P||(o.colorMask(se,se,se,se),I=se)},getMask:function(){return I},setLocked:function(se){P=se},setClear:function(se,ce,fe,ve,xe){xe===!0&&(se*=ve,ce*=ve,fe*=ve),Q.set(se,ce,fe,ve),N.equals(Q)===!1&&(o.clearColor(se,ce,fe,ve),N.copy(Q))},reset:function(){P=!1,I=null,N.set(-1,0,0,0)}}},a=new function(){let P=!1,Q=null,I=null,N=null,se=null;return{setTest:function(ce){ce!==se&&(ce?te(2929):le(2929),se=ce)},getTest:function(){return se},setMask:function(ce){Q===ce||P||(o.depthMask(ce),Q=ce)},setFunc:function(ce){if(I!==ce){switch(ce){case 0:o.depthFunc(512);break;case 1:o.depthFunc(519);break;case 2:o.depthFunc(513);break;case 3:default:o.depthFunc(515);break;case 4:o.depthFunc(514);break;case 5:o.depthFunc(518);break;case 6:o.depthFunc(516);break;case 7:o.depthFunc(517)}I=ce}},setLocked:function(ce){P=ce},setClear:function(ce){N!==ce&&(o.clearDepth(ce),N=ce)},reset:function(){P=!1,Q=null,I=null,N=null}}},i=new function(){let P=!1,Q=null,I=null,N=null,se=null,ce=null,fe=null,ve=null,xe=null;return{setTest:function(Ie){P||(Ie?te(2960):le(2960))},setMask:function(Ie){Q===Ie||P||(o.stencilMask(Ie),Q=Ie)},setFunc:function(Ie,re,me){I===Ie&&N===re&&se===me||(o.stencilFunc(Ie,re,me),I=Ie,N=re,se=me)},setOp:function(Ie,re,me){ce===Ie&&fe===re&&ve===me||(o.stencilOp(Ie,re,me),ce=Ie,fe=re,ve=me)},setLocked:function(Ie){P=Ie},setClear:function(Ie){xe!==Ie&&(o.clearStencil(Ie),xe=Ie)},reset:function(){P=!1,Q=null,I=null,N=null,se=null,ce=null,fe=null,ve=null,xe=null}}},s=new WeakMap,c=new WeakMap;let u={},h={},f=new WeakMap,m=[],g=null,A=!1,_=null,x=null,C=null,b=null,y=null,M=null,R=null,T=!1,w=null,D=null,z=null,F=null,O=null;const q=o.getParameter(35661);let ne=!1,$=0;const he=o.getParameter(7938);he.indexOf("WebGL")!==-1?($=parseFloat(/^WebGL (\d)/.exec(he)[1]),ne=$>=1):he.indexOf("OpenGL ES")!==-1&&($=parseFloat(/^OpenGL ES (\d)/.exec(he)[1]),ne=$>=2);let K=null,oe={};const ie=o.getParameter(3088),L=o.getParameter(2978),U=new ct().fromArray(ie),k=new ct().fromArray(L);function J(P,Q,I){const N=new Uint8Array(4),se=o.createTexture();o.bindTexture(P,se),o.texParameteri(P,10241,9728),o.texParameteri(P,10240,9728);for(let ce=0;ce<I;ce++)o.texImage2D(Q+ce,0,6408,1,1,0,6408,5121,N);return se}const de={};function te(P){u[P]!==!0&&(o.enable(P),u[P]=!0)}function le(P){u[P]!==!1&&(o.disable(P),u[P]=!1)}de[3553]=J(3553,3553,1),de[34067]=J(34067,34069,6),r.setClear(0,0,0,1),a.setClear(1),i.setClear(0),te(2929),a.setFunc(3),X(!1),W(1),te(2884),ee(0);const V={[RL]:32774,[IL]:32778,[LL]:32779};if(n)V[103]=32775,V[104]=32776;else{const P=e.get("EXT_blend_minmax");P!==null&&(V[103]=P.MIN_EXT,V[104]=P.MAX_EXT)}const G={[BL]:0,[PL]:1,[NL]:768,[OL]:770,[GL]:776,[VL]:774,[UL]:772,[DL]:769,[FL]:771,[kL]:775,[zL]:773};function ee(P,Q,I,N,se,ce,fe,ve){if(P!==0){if(A===!1&&(te(3042),A=!0),P===5)se=se||Q,ce=ce||I,fe=fe||N,Q===x&&se===y||(o.blendEquationSeparate(V[Q],V[se]),x=Q,y=se),I===C&&N===b&&ce===M&&fe===R||(o.blendFuncSeparate(G[I],G[N],G[ce],G[fe]),C=I,b=N,M=ce,R=fe),_=P,T=!1;else if(P!==_||ve!==T){if(x===100&&y===100||(o.blendEquation(32774),x=100,y=100),ve)switch(P){case 1:o.blendFuncSeparate(1,771,1,771);break;case 2:o.blendFunc(1,1);break;case 3:o.blendFuncSeparate(0,769,0,1);break;case 4:o.blendFuncSeparate(0,768,0,770);break;default:console.error("v3d.WebGLState: Invalid blending: ",P)}else switch(P){case 1:o.blendFuncSeparate(770,771,1,771);break;case 2:o.blendFunc(770,1);break;case 3:o.blendFuncSeparate(0,769,0,1);break;case 4:o.blendFunc(0,768);break;default:console.error("v3d.WebGLState: Invalid blending: ",P)}C=null,b=null,M=null,R=null,_=P,T=ve}}else A===!0&&(le(3042),A=!1)}function X(P){w!==P&&(P?o.frontFace(2304):o.frontFace(2305),w=P)}function W(P){P!==0?(te(2884),P!==D&&(P===1?o.cullFace(1029):P===2?o.cullFace(1028):o.cullFace(1032))):le(2884),D=P}function Y(P,Q,I){P?(te(32823),F===Q&&O===I||(o.polygonOffset(Q,I),F=Q,O=I)):le(32823)}return{buffers:{color:r,depth:a,stencil:i},enable:te,disable:le,bindFramebuffer:function(P,Q){return h[P]!==Q&&(o.bindFramebuffer(P,Q),h[P]=Q,n&&(P===36009&&(h[36160]=Q),P===36160&&(h[36009]=Q)),!0)},drawBuffers:function(P,Q){let I=m,N=!1;if(P)if(I=f.get(Q),I===void 0&&(I=[],f.set(Q,I)),P.isWebGLMultipleRenderTargets){const se=P.texture;if(I.length!==se.length||I[0]!==36064){for(let ce=0,fe=se.length;ce<fe;ce++)I[ce]=36064+ce;I.length=se.length,N=!0}}else I[0]!==36064&&(I[0]=36064,N=!0);else I[0]!==1029&&(I[0]=1029,N=!0);N&&(t.isWebGL2?o.drawBuffers(I):e.get("WEBGL_draw_buffers").drawBuffersWEBGL(I))},useProgram:function(P){return g!==P&&(o.useProgram(P),g=P,!0)},setBlending:ee,setMaterial:function(P,Q){P.side===2?le(2884):te(2884);let I=P.side===1;Q&&(I=!I),X(I),P.blending===1&&P.transparent===!1?ee(0):ee(P.blending,P.blendEquation,P.blendSrc,P.blendDst,P.blendEquationAlpha,P.blendSrcAlpha,P.blendDstAlpha,P.premultipliedAlpha),a.setFunc(P.depthFunc),a.setTest(P.depthTest),a.setMask(P.depthWrite),r.setMask(P.colorWrite);const N=P.stencilWrite;i.setTest(N),N&&(i.setMask(P.stencilWriteMask),i.setFunc(P.stencilFunc,P.stencilRef,P.stencilFuncMask),i.setOp(P.stencilFail,P.stencilZFail,P.stencilZPass)),Y(P.polygonOffset,P.polygonOffsetFactor,P.polygonOffsetUnits),P.alphaToCoverage===!0?te(32926):le(32926)},setFlipSided:X,setCullFace:W,setLineWidth:function(P){P!==z&&(ne&&o.lineWidth(P),z=P)},setPolygonOffset:Y,setScissorTest:function(P){P?te(3089):le(3089)},activeTexture:function(P){P===void 0&&(P=33984+q-1),K!==P&&(o.activeTexture(P),K=P)},bindTexture:function(P,Q,I){I===void 0&&(I=K===null?33984+q-1:K);let N=oe[I];N===void 0&&(N={type:void 0,texture:void 0},oe[I]=N),N.type===P&&N.texture===Q||(K!==I&&(o.activeTexture(I),K=I),o.bindTexture(P,Q||de[P]),N.type=P,N.texture=Q)},unbindTexture:function(){const P=oe[K];P!==void 0&&P.type!==void 0&&(o.bindTexture(P.type,null),P.type=void 0,P.texture=void 0)},compressedTexImage2D:function(){try{o.compressedTexImage2D.apply(o,arguments)}catch(P){console.error("v3d.WebGLState:",P)}},compressedTexImage3D:function(){try{o.compressedTexImage3D.apply(o,arguments)}catch(P){console.error("v3d.WebGLState:",P)}},texImage2D:function(){try{o.texImage2D.apply(o,arguments)}catch(P){console.error("v3d.WebGLState:",P)}},texImage3D:function(){try{o.texImage3D.apply(o,arguments)}catch(P){console.error("v3d.WebGLState:",P)}},updateUBOMapping:function(P,Q){let I=c.get(Q);I===void 0&&(I=new WeakMap,c.set(Q,I));let N=I.get(P);N===void 0&&(N=o.getUniformBlockIndex(Q,P.name),I.set(P,N))},uniformBlockBinding:function(P,Q){const I=c.get(Q).get(P);s.get(P)!==I&&(o.uniformBlockBinding(Q,I,P.__bindingPointIndex),s.set(P,I))},texStorage2D:function(){try{o.texStorage2D.apply(o,arguments)}catch(P){console.error("v3d.WebGLState:",P)}},texStorage3D:function(){try{o.texStorage3D.apply(o,arguments)}catch(P){console.error("v3d.WebGLState:",P)}},texSubImage2D:function(){try{o.texSubImage2D.apply(o,arguments)}catch(P){console.error("v3d.WebGLState:",P)}},texSubImage3D:function(){try{o.texSubImage3D.apply(o,arguments)}catch(P){console.error("v3d.WebGLState:",P)}},compressedTexSubImage2D:function(){try{o.compressedTexSubImage2D.apply(o,arguments)}catch(P){console.error("v3d.WebGLState:",P)}},compressedTexSubImage3D:function(){try{o.compressedTexSubImage3D.apply(o,arguments)}catch(P){console.error("v3d.WebGLState:",P)}},scissor:function(P){U.equals(P)===!1&&(o.scissor(P.x,P.y,P.z,P.w),U.copy(P))},viewport:function(P){k.equals(P)===!1&&(o.viewport(P.x,P.y,P.z,P.w),k.copy(P))},reset:function(){o.disable(3042),o.disable(2884),o.disable(2929),o.disable(32823),o.disable(3089),o.disable(2960),o.disable(32926),o.blendEquation(32774),o.blendFunc(1,0),o.blendFuncSeparate(1,0,1,0),o.colorMask(!0,!0,!0,!0),o.clearColor(0,0,0,0),o.depthMask(!0),o.depthFunc(513),o.clearDepth(1),o.stencilMask(4294967295),o.stencilFunc(519,0,4294967295),o.stencilOp(7680,7680,7680),o.clearStencil(0),o.cullFace(1029),o.frontFace(2305),o.polygonOffset(0,0),o.activeTexture(33984),o.bindFramebuffer(36160,null),n===!0&&(o.bindFramebuffer(36009,null),o.bindFramebuffer(36008,null)),o.useProgram(null),o.lineWidth(1),o.scissor(0,0,o.canvas.width,o.canvas.height),o.viewport(0,0,o.canvas.width,o.canvas.height),u={},K=null,oe={},h={},f=new WeakMap,m=[],g=null,A=!1,_=null,x=null,C=null,b=null,y=null,M=null,R=null,T=!1,w=null,D=null,z=null,F=null,O=null,U.set(0,0,o.canvas.width,o.canvas.height),k.set(0,0,o.canvas.width,o.canvas.height),r.reset(),a.reset(),i.reset()}}}function FJ(o,e,t,n,r,a,i){const s=r.isWebGL2,c=r.maxTextures,u=r.maxCubemapSize,h=r.maxTextureSize,f=r.maxSamples,m=e.has("WEBGL_multisampled_render_to_texture")?e.get("WEBGL_multisampled_render_to_texture"):null,g=typeof navigator<"u"&&/OculusBrowser/g.test(navigator.userAgent),A=new WeakMap;let _;const x=new WeakMap;let C=!1;try{C=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function b(V,G){return C?new OffscreenCanvas(V,G):Wh("canvas")}function y(V,G,ee,X){let W=1;if((V.width>X||V.height>X)&&(W=X/Math.max(V.width,V.height)),W<1||G===!0){if(typeof HTMLImageElement<"u"&&V instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&V instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&V instanceof ImageBitmap){const Y=G?Vg:Math.floor,P=Y(W*V.width),Q=Y(W*V.height);_===void 0&&(_=b(P,Q));const I=ee?b(P,Q):_;return I.width=P,I.height=Q,I.getContext("2d").drawImage(V,0,0,P,Q),console.warn("v3d.WebGLRenderer: Texture has been resized from ("+V.width+"x"+V.height+") to ("+P+"x"+Q+")."),I}return"data"in V&&console.warn("v3d.WebGLRenderer: Image in DataTexture is too big ("+V.width+"x"+V.height+")."),V}return V}function M(V){return _2(V.width)&&_2(V.height)}function R(V,G){return V.generateMipmaps&&G&&V.minFilter!==1003&&V.minFilter!==1006}function T(V){o.generateMipmap(V)}function w(V,G,ee,X,W=!1){if(s===!1)return G;if(V!==null){if(o[V]!==void 0)return o[V];console.warn("v3d.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+V+"'")}let Y=G;return G===6403&&(ee===5126&&(Y=33326),ee===5131&&(Y=33325),ee===5121&&(Y=33321)),G===33319&&(ee===5126&&(Y=33328),ee===5131&&(Y=33327),ee===5121&&(Y=33323)),G===6408&&(ee===5126&&(Y=34836),ee===5131&&(Y=34842),ee===5121&&(Y=X===3001&&W===!1?35907:32856),ee===32819&&(Y=32854),ee===32820&&(Y=32855)),Y!==33325&&Y!==33326&&Y!==33327&&Y!==33328&&Y!==34842&&Y!==34836||e.get("EXT_color_buffer_float"),Y}function D(V,G,ee){return R(V,ee)===!0||V.isFramebufferTexture&&V.minFilter!==1003&&V.minFilter!==1006?Math.log2(Math.max(G.width,G.height))+1:V.mipmaps!==void 0&&V.mipmaps.length>0?V.mipmaps.length:V.isCompressedTexture&&Array.isArray(V.image)?G.mipmaps.length:1}function z(V){return V===1003||V===1004||V===1005?9728:9729}function F(V){const G=V.target;G.removeEventListener("dispose",F),function(ee){const X=n.get(ee);if(X.__webglInit===void 0)return;const W=ee.source,Y=x.get(W);if(Y){const P=Y[X.__cacheKey];P.usedTimes--,P.usedTimes===0&&q(ee),Object.keys(Y).length===0&&x.delete(W)}n.remove(ee)}(G),G.isVideoTexture&&A.delete(G)}function O(V){const G=V.target;G.removeEventListener("dispose",O),function(ee){const X=ee.texture,W=n.get(ee),Y=n.get(X);if(Y.__webglTexture!==void 0&&(o.deleteTexture(Y.__webglTexture),i.memory.textures--),ee.depthTexture&&ee.depthTexture.dispose(),ee.isWebGLCubeRenderTarget)for(let P=0;P<6;P++)o.deleteFramebuffer(W.__webglFramebuffer[P]),W.__webglDepthbuffer&&o.deleteRenderbuffer(W.__webglDepthbuffer[P]);else{if(o.deleteFramebuffer(W.__webglFramebuffer),W.__webglDepthbuffer&&o.deleteRenderbuffer(W.__webglDepthbuffer),W.__webglMultisampledFramebuffer&&o.deleteFramebuffer(W.__webglMultisampledFramebuffer),W.__webglColorRenderbuffer)for(let P=0;P<W.__webglColorRenderbuffer.length;P++)W.__webglColorRenderbuffer[P]&&o.deleteRenderbuffer(W.__webglColorRenderbuffer[P]);W.__webglDepthRenderbuffer&&o.deleteRenderbuffer(W.__webglDepthRenderbuffer)}if(ee.isWebGLMultipleRenderTargets)for(let P=0,Q=X.length;P<Q;P++){const I=n.get(X[P]);I.__webglTexture&&(o.deleteTexture(I.__webglTexture),i.memory.textures--),n.remove(X[P])}n.remove(X),n.remove(ee)}(G),i.removeTextureSpec(G)}function q(V){const G=n.get(V);o.deleteTexture(G.__webglTexture);const ee=V.source;delete x.get(ee)[G.__cacheKey],i.memory.textures--,i.removeTextureSpec(V)}let ne=0;function $(V,G){const ee=n.get(V);if(V.isVideoTexture&&function(X){const W=i.render.frame;A.get(X)!==W&&(A.set(X,W),X.update())}(V),V.isRenderTargetTexture===!1&&V.version>0&&ee.__version!==V.version){const X=V.image;if(X===null)console.warn("v3d.WebGLRenderer: Texture marked for update but no image data found.");else{if(X.complete!==!1)return void L(ee,V,G);console.warn("v3d.WebGLRenderer: Texture marked for update but image is incomplete")}}t.bindTexture(3553,ee.__webglTexture,33984+G)}const he={[QL]:10497,[HL]:33071,[WL]:33648},K={[YL]:9728,[jL]:9984,[XL]:9986,[qL]:9729,[ZL]:9985,[KL]:9987};function oe(V,G,ee){if(ee?(o.texParameteri(V,10242,he[G.wrapS]),o.texParameteri(V,10243,he[G.wrapT]),V!==32879&&V!==35866||o.texParameteri(V,32882,he[G.wrapR]),o.texParameteri(V,10240,K[G.magFilter]),o.texParameteri(V,10241,K[G.minFilter])):(o.texParameteri(V,10242,33071),o.texParameteri(V,10243,33071),V!==32879&&V!==35866||o.texParameteri(V,32882,33071),G.wrapS===1001&&G.wrapT===1001||console.warn("v3d.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to v3d.ClampToEdgeWrapping."),o.texParameteri(V,10240,z(G.magFilter)),o.texParameteri(V,10241,z(G.minFilter)),G.minFilter!==1003&&G.minFilter!==1006&&console.warn("v3d.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to v3d.NearestFilter or v3d.LinearFilter.")),e.has("EXT_texture_filter_anisotropic")===!0){const X=e.get("EXT_texture_filter_anisotropic");if(G.magFilter===1003||G.minFilter!==1005&&G.minFilter!==1008||G.type===1015&&e.has("OES_texture_float_linear")===!1||s===!1&&G.type===1016&&e.has("OES_texture_half_float_linear")===!1)return;(G.anisotropy>1||n.get(G).__currentAnisotropy)&&(o.texParameterf(V,X.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(G.anisotropy,r.getMaxAnisotropy())),n.get(G).__currentAnisotropy=G.anisotropy)}}function ie(V,G){let ee=!1;V.__webglInit===void 0&&(V.__webglInit=!0,G.addEventListener("dispose",F));const X=G.source;let W=x.get(X);W===void 0&&(W={},x.set(X,W));const Y=function(P){const Q=[];return Q.push(P.wrapS),Q.push(P.wrapT),Q.push(P.wrapR||0),Q.push(P.magFilter),Q.push(P.minFilter),Q.push(P.anisotropy),Q.push(P.internalFormat),Q.push(P.format),Q.push(P.type),Q.push(P.generateMipmaps),Q.push(P.premultiplyAlpha),Q.push(P.flipY),Q.push(P.unpackAlignment),Q.push(P.encoding),Q.join()}(G);if(Y!==V.__cacheKey){W[Y]===void 0&&(W[Y]={texture:o.createTexture(),usedTimes:0},i.memory.textures++,i.addTextureSpec(G),ee=!0),W[Y].usedTimes++;const P=W[V.__cacheKey];P!==void 0&&(W[V.__cacheKey].usedTimes--,P.usedTimes===0&&q(G)),V.__cacheKey=Y,V.__webglTexture=W[Y].texture}return ee}function L(V,G,ee){let X=3553;(G.isDataArrayTexture||G.isCompressedArrayTexture)&&(X=35866),G.isData3DTexture&&(X=32879);const W=ie(V,G),Y=G.source;t.bindTexture(X,V.__webglTexture,33984+ee);const P=n.get(Y);if(Y.version!==P.__version||W===!0){t.activeTexture(33984+ee),o.pixelStorei(37440,G.flipY),o.pixelStorei(37441,G.premultiplyAlpha),o.pixelStorei(3317,G.unpackAlignment),o.pixelStorei(37443,0);const Q=function(pe){return!s&&(pe.wrapS!==1001||pe.wrapT!==1001||pe.minFilter!==1003&&pe.minFilter!==1006)}(G)&&M(G.image)===!1;let I=y(G.image,Q,!1,h);I=le(G,I);const N=M(I)||s,se=a.convert(G.format,G.encoding);let ce,fe=a.convert(G.type),ve=w(G.internalFormat,se,fe,G.encoding,G.isVideoTexture);oe(X,G,N);const xe=G.mipmaps,Ie=s&&G.isVideoTexture!==!0,re=P.__version===void 0||W===!0,me=D(G,I,N);if(G.isDepthTexture)ve=6402,s?ve=G.type===1015?36012:G.type===1014?33190:G.type===1020?35056:33189:G.type===1015&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),G.format===1026&&ve===6402&&G.type!==1012&&G.type!==1014&&(console.warn("v3d.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),G.type=1014,fe=a.convert(G.type)),G.format===1027&&ve===6402&&(ve=34041,G.type!==1020&&(console.warn("v3d.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),G.type=1020,fe=a.convert(G.type))),re&&(Ie?t.texStorage2D(3553,1,ve,I.width,I.height):t.texImage2D(3553,0,ve,I.width,I.height,0,se,fe,null));else if(G.isDataTexture)if(xe.length>0&&N){Ie&&re&&t.texStorage2D(3553,me,ve,xe[0].width,xe[0].height);for(let pe=0,Ce=xe.length;pe<Ce;pe++)ce=xe[pe],Ie?t.texSubImage2D(3553,pe,0,0,ce.width,ce.height,se,fe,ce.data):t.texImage2D(3553,pe,ve,ce.width,ce.height,0,se,fe,ce.data);G.generateMipmaps=!1}else Ie?(re&&t.texStorage2D(3553,me,ve,I.width,I.height),t.texSubImage2D(3553,0,0,0,I.width,I.height,se,fe,I.data)):t.texImage2D(3553,0,ve,I.width,I.height,0,se,fe,I.data);else if(G.isCompressedTexture)if(G.isCompressedArrayTexture){Ie&&re&&t.texStorage3D(35866,me,ve,xe[0].width,xe[0].height,I.depth);for(let pe=0,Ce=xe.length;pe<Ce;pe++)ce=xe[pe],G.format!==1023?se!==null?Ie?t.compressedTexSubImage3D(35866,pe,0,0,0,ce.width,ce.height,I.depth,se,ce.data,0,0):t.compressedTexImage3D(35866,pe,ve,ce.width,ce.height,I.depth,0,ce.data,0,0):console.warn("v3d.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):Ie?t.texSubImage3D(35866,pe,0,0,0,ce.width,ce.height,I.depth,se,fe,ce.data):t.texImage3D(35866,pe,ve,ce.width,ce.height,I.depth,0,se,fe,ce.data)}else{Ie&&re&&t.texStorage2D(3553,me,ve,xe[0].width,xe[0].height);for(let pe=0,Ce=xe.length;pe<Ce;pe++)ce=xe[pe],G.format!==1023?se!==null?Ie?t.compressedTexSubImage2D(3553,pe,0,0,ce.width,ce.height,se,ce.data):t.compressedTexImage2D(3553,pe,ve,ce.width,ce.height,0,ce.data):console.warn("v3d.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):Ie?t.texSubImage2D(3553,pe,0,0,ce.width,ce.height,se,fe,ce.data):t.texImage2D(3553,pe,ve,ce.width,ce.height,0,se,fe,ce.data)}else if(G.isDataArrayTexture)Ie?(re&&t.texStorage3D(35866,me,ve,I.width,I.height,I.depth),t.texSubImage3D(35866,0,0,0,0,I.width,I.height,I.depth,se,fe,I.data)):t.texImage3D(35866,0,ve,I.width,I.height,I.depth,0,se,fe,I.data);else if(G.isData3DTexture)Ie?(re&&t.texStorage3D(32879,me,ve,I.width,I.height,I.depth),t.texSubImage3D(32879,0,0,0,0,I.width,I.height,I.depth,se,fe,I.data)):t.texImage3D(32879,0,ve,I.width,I.height,I.depth,0,se,fe,I.data);else if(G.isFramebufferTexture){if(re)if(Ie)t.texStorage2D(3553,me,ve,I.width,I.height);else{let pe=I.width,Ce=I.height;for(let we=0;we<me;we++)t.texImage2D(3553,we,ve,pe,Ce,0,se,fe,null),pe>>=1,Ce>>=1}}else if(xe.length>0&&N){Ie&&re&&t.texStorage2D(3553,me,ve,xe[0].width,xe[0].height);for(let pe=0,Ce=xe.length;pe<Ce;pe++)ce=xe[pe],Ie?t.texSubImage2D(3553,pe,0,0,se,fe,ce):t.texImage2D(3553,pe,ve,se,fe,ce);G.generateMipmaps=!1}else Ie?(re&&t.texStorage2D(3553,me,ve,I.width,I.height),t.texSubImage2D(3553,0,0,0,se,fe,I)):t.texImage2D(3553,0,ve,se,fe,I);R(G,N)&&T(X),P.__version=Y.version,G.onUpdate&&G.onUpdate(G)}V.__version=G.version}function U(V,G,ee,X,W){const Y=a.convert(ee.format,ee.encoding),P=a.convert(ee.type),Q=w(ee.internalFormat,Y,P,ee.encoding);n.get(G).__hasExternalTextures||(W===32879||W===35866?t.texImage3D(W,0,Q,G.width,G.height,G.depth,0,Y,P,null):t.texImage2D(W,0,Q,G.width,G.height,0,Y,P,null)),t.bindFramebuffer(36160,V),te(G)?m.framebufferTexture2DMultisampleEXT(36160,X,W,n.get(ee).__webglTexture,0,de(G)):(W===3553||W>=34069&&W<=34074)&&o.framebufferTexture2D(36160,X,W,n.get(ee).__webglTexture,0),t.bindFramebuffer(36160,null)}function k(V,G,ee){if(o.bindRenderbuffer(36161,V),G.depthBuffer&&!G.stencilBuffer){let X=33189;if(s&&(X=33190),ee||te(G)){const W=G.depthTexture;W&&W.isDepthTexture&&(W.type===1015?X=36012:W.type===1014&&(X=33190));const Y=de(G);te(G)?m.renderbufferStorageMultisampleEXT(36161,Y,X,G.width,G.height):o.renderbufferStorageMultisample(36161,Y,X,G.width,G.height)}else o.renderbufferStorage(36161,X,G.width,G.height);o.framebufferRenderbuffer(36160,36096,36161,V)}else if(G.depthBuffer&&G.stencilBuffer){const X=de(G);ee&&te(G)===!1?o.renderbufferStorageMultisample(36161,X,35056,G.width,G.height):te(G)?m.renderbufferStorageMultisampleEXT(36161,X,35056,G.width,G.height):o.renderbufferStorage(36161,34041,G.width,G.height),o.framebufferRenderbuffer(36160,33306,36161,V)}else{const X=G.isWebGLMultipleRenderTargets===!0?G.texture:[G.texture];for(let W=0;W<X.length;W++){const Y=X[W],P=a.convert(Y.format,Y.encoding),Q=a.convert(Y.type),I=w(Y.internalFormat,P,Q,Y.encoding),N=de(G);ee&&te(G)===!1?o.renderbufferStorageMultisample(36161,N,I,G.width,G.height):te(G)?m.renderbufferStorageMultisampleEXT(36161,N,I,G.width,G.height):o.renderbufferStorage(36161,I,G.width,G.height)}}o.bindRenderbuffer(36161,null)}function J(V){const G=n.get(V),ee=V.isWebGLCubeRenderTarget===!0;if(V.depthTexture&&!G.__autoAllocateDepthBuffer){if(ee)throw new Error("target.depthTexture not supported in Cube render targets");(function(X,W){if(W&&W.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(t.bindFramebuffer(36160,X),!W.depthTexture||!W.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of v3d.DepthTexture");n.get(W.depthTexture).__webglTexture&&W.depthTexture.image.width===W.width&&W.depthTexture.image.height===W.height||(W.depthTexture.image.width=W.width,W.depthTexture.image.height=W.height,W.depthTexture.needsUpdate=!0),$(W.depthTexture,0);const Y=n.get(W.depthTexture).__webglTexture,P=de(W);if(W.depthTexture.format===1026)te(W)?m.framebufferTexture2DMultisampleEXT(36160,36096,3553,Y,0,P):o.framebufferTexture2D(36160,36096,3553,Y,0);else{if(W.depthTexture.format!==1027)throw new Error("Unknown depthTexture format");te(W)?m.framebufferTexture2DMultisampleEXT(36160,33306,3553,Y,0,P):o.framebufferTexture2D(36160,33306,3553,Y,0)}})(G.__webglFramebuffer,V)}else if(ee){G.__webglDepthbuffer=[];for(let X=0;X<6;X++)t.bindFramebuffer(36160,G.__webglFramebuffer[X]),G.__webglDepthbuffer[X]=o.createRenderbuffer(),k(G.__webglDepthbuffer[X],V,!1)}else t.bindFramebuffer(36160,G.__webglFramebuffer),G.__webglDepthbuffer=o.createRenderbuffer(),k(G.__webglDepthbuffer,V,!1);t.bindFramebuffer(36160,null)}function de(V){return Math.min(f,V.samples)}function te(V){const G=n.get(V);return s&&V.samples>0&&e.has("WEBGL_multisampled_render_to_texture")===!0&&G.__useRenderToTexture!==!1}function le(V,G){const ee=V.encoding,X=V.format,W=V.type;return V.isCompressedTexture===!0||V.isVideoTexture===!0||V.format===1035||ee!==3e3&&(ee===3001?s===!1?e.has("EXT_sRGB")===!0&&X===1023?(V.format=1035,V.minFilter=1006,V.generateMipmaps=!1):G=_5.sRGBToLinear(G):X===1023&&W===1009||console.warn("v3d.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType. Perhaps you've set sRGB color space for an HDR image?"):console.error("v3d.WebGLTextures: Unsupported texture encoding:",ee)),G}this.allocateTextureUnit=function(){const V=ne;return V>=c&&console.warn("v3d.WebGLTextures: Trying to use "+V+" texture units while this GPU supports only "+c),ne+=1,V},this.resetTextureUnits=function(){ne=0},this.setTexture2D=$,this.setTexture2DArray=function(V,G){const ee=n.get(V);V.version>0&&ee.__version!==V.version?L(ee,V,G):t.bindTexture(35866,ee.__webglTexture,33984+G)},this.setTexture3D=function(V,G){const ee=n.get(V);V.version>0&&ee.__version!==V.version?L(ee,V,G):t.bindTexture(32879,ee.__webglTexture,33984+G)},this.setTextureCube=function(V,G){const ee=n.get(V);V.version>0&&ee.__version!==V.version?function(X,W,Y){if(W.image.length!==6)return;const P=ie(X,W),Q=W.source;t.bindTexture(34067,X.__webglTexture,33984+Y);const I=n.get(Q);if(Q.version!==I.__version||P===!0){t.activeTexture(33984+Y),o.pixelStorei(37440,W.flipY),o.pixelStorei(37441,W.premultiplyAlpha),o.pixelStorei(3317,W.unpackAlignment),o.pixelStorei(37443,0);const N=W.isCompressedTexture||W.image[0].isCompressedTexture,se=W.image[0]&&W.image[0].isDataTexture,ce=[];for(let be=0;be<6;be++)ce[be]=N||se?se?W.image[be].image:W.image[be]:y(W.image[be],!1,!0,u),ce[be]=le(W,ce[be]);const fe=ce[0],ve=M(fe)||s,xe=a.convert(W.format,W.encoding),Ie=a.convert(W.type),re=w(W.internalFormat,xe,Ie,W.encoding),me=s&&W.isVideoTexture!==!0,pe=I.__version===void 0||P===!0;let Ce,we=D(W,fe,ve);if(oe(34067,W,ve),N){me&&pe&&t.texStorage2D(34067,we,re,fe.width,fe.height);for(let be=0;be<6;be++){Ce=ce[be].mipmaps;for(let Pe=0;Pe<Ce.length;Pe++){const Ge=Ce[Pe];W.format!==1023?xe!==null?me?t.compressedTexSubImage2D(34069+be,Pe,0,0,Ge.width,Ge.height,xe,Ge.data):t.compressedTexImage2D(34069+be,Pe,re,Ge.width,Ge.height,0,Ge.data):console.warn("v3d.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):me?t.texSubImage2D(34069+be,Pe,0,0,Ge.width,Ge.height,xe,Ie,Ge.data):t.texImage2D(34069+be,Pe,re,Ge.width,Ge.height,0,xe,Ie,Ge.data)}}}else{Ce=W.mipmaps,me&&pe&&(Ce.length>0&&we++,t.texStorage2D(34067,we,re,ce[0].width,ce[0].height));for(let be=0;be<6;be++)if(se){me?t.texSubImage2D(34069+be,0,0,0,ce[be].width,ce[be].height,xe,Ie,ce[be].data):t.texImage2D(34069+be,0,re,ce[be].width,ce[be].height,0,xe,Ie,ce[be].data);for(let Pe=0;Pe<Ce.length;Pe++){const Ge=Ce[Pe].image[be].image;me?t.texSubImage2D(34069+be,Pe+1,0,0,Ge.width,Ge.height,xe,Ie,Ge.data):t.texImage2D(34069+be,Pe+1,re,Ge.width,Ge.height,0,xe,Ie,Ge.data)}}else{me?t.texSubImage2D(34069+be,0,0,0,xe,Ie,ce[be]):t.texImage2D(34069+be,0,re,xe,Ie,ce[be]);for(let Pe=0;Pe<Ce.length;Pe++){const Ge=Ce[Pe];me?t.texSubImage2D(34069+be,Pe+1,0,0,xe,Ie,Ge.image[be]):t.texImage2D(34069+be,Pe+1,re,xe,Ie,Ge.image[be])}}}R(W,ve)&&T(34067),I.__version=Q.version,W.onUpdate&&W.onUpdate(W)}X.__version=W.version}(ee,V,G):t.bindTexture(34067,ee.__webglTexture,33984+G)},this.rebindTextures=function(V,G,ee){const X=n.get(V);G!==void 0&&U(X.__webglFramebuffer,V,V.texture,36064,3553),ee!==void 0&&J(V)},this.setupRenderTarget=function(V){const G=V.texture,ee=n.get(V),X=n.get(G);V.addEventListener("dispose",O),V.isWebGLMultipleRenderTargets!==!0&&(X.__webglTexture===void 0&&(X.__webglTexture=o.createTexture()),X.__version=G.version,i.memory.textures++),i.addTextureSpec(V);const W=V.isWebGLCubeRenderTarget===!0,Y=V.isWebGLMultipleRenderTargets===!0,P=M(V)||s;if(W){ee.__webglFramebuffer=[];for(let Q=0;Q<6;Q++)ee.__webglFramebuffer[Q]=o.createFramebuffer()}else{if(ee.__webglFramebuffer=o.createFramebuffer(),Y)if(r.drawBuffers){const Q=V.texture;for(let I=0,N=Q.length;I<N;I++){const se=n.get(Q[I]);se.__webglTexture===void 0&&(se.__webglTexture=o.createTexture(),i.memory.textures++)}}else console.warn("v3d.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");if(s&&V.samples>0&&te(V)===!1){const Q=Y?G:[G];ee.__webglMultisampledFramebuffer=o.createFramebuffer(),ee.__webglColorRenderbuffer=[],t.bindFramebuffer(36160,ee.__webglMultisampledFramebuffer);for(let I=0;I<Q.length;I++){const N=Q[I];ee.__webglColorRenderbuffer[I]=o.createRenderbuffer(),o.bindRenderbuffer(36161,ee.__webglColorRenderbuffer[I]);const se=a.convert(N.format,N.encoding),ce=a.convert(N.type),fe=w(N.internalFormat,se,ce,N.encoding,V.isXRRenderTarget===!0),ve=de(V);o.renderbufferStorageMultisample(36161,ve,fe,V.width,V.height),o.framebufferRenderbuffer(36160,36064+I,36161,ee.__webglColorRenderbuffer[I])}o.bindRenderbuffer(36161,null),V.depthBuffer&&(ee.__webglDepthRenderbuffer=o.createRenderbuffer(),k(ee.__webglDepthRenderbuffer,V,!0)),t.bindFramebuffer(36160,null)}}if(W){t.bindTexture(34067,X.__webglTexture),oe(34067,G,P);for(let Q=0;Q<6;Q++)U(ee.__webglFramebuffer[Q],V,G,36064,34069+Q);R(G,P)&&T(34067),t.unbindTexture()}else if(Y){const Q=V.texture;for(let I=0,N=Q.length;I<N;I++){const se=Q[I],ce=n.get(se);t.bindTexture(3553,ce.__webglTexture),oe(3553,se,P),U(ee.__webglFramebuffer,V,se,36064+I,3553),R(se,P)&&T(3553)}t.unbindTexture()}else{let Q=3553;(V.isWebGL3DRenderTarget||V.isWebGLArrayRenderTarget)&&(s?Q=V.isWebGL3DRenderTarget?32879:35866:console.error("v3d.WebGLTextures: v3d.Data3DTexture and v3d.DataArrayTexture only supported with WebGL2.")),t.bindTexture(Q,X.__webglTexture),oe(Q,G,P),U(ee.__webglFramebuffer,V,G,36064,Q),R(G,P)&&T(Q),t.unbindTexture()}V.depthBuffer&&J(V)},this.updateRenderTargetMipmap=function(V){const G=M(V)||s,ee=V.isWebGLMultipleRenderTargets===!0?V.texture:[V.texture];for(let X=0,W=ee.length;X<W;X++){const Y=ee[X];if(R(Y,G)){const P=V.isWebGLCubeRenderTarget?34067:3553,Q=n.get(Y).__webglTexture;t.bindTexture(P,Q),T(P),t.unbindTexture()}}},this.updateMultisampleRenderTarget=function(V){if(s&&V.samples>0&&te(V)===!1){const G=V.isWebGLMultipleRenderTargets?V.texture:[V.texture],ee=V.width,X=V.height;let W=16384;const Y=[],P=V.stencilBuffer?33306:36096,Q=n.get(V),I=V.isWebGLMultipleRenderTargets===!0;if(I)for(let N=0;N<G.length;N++)t.bindFramebuffer(36160,Q.__webglMultisampledFramebuffer),o.framebufferRenderbuffer(36160,36064+N,36161,null),t.bindFramebuffer(36160,Q.__webglFramebuffer),o.framebufferTexture2D(36009,36064+N,3553,null,0);t.bindFramebuffer(36008,Q.__webglMultisampledFramebuffer),t.bindFramebuffer(36009,Q.__webglFramebuffer);for(let N=0;N<G.length;N++){Y.push(36064+N),V.depthBuffer&&Y.push(P);const se=Q.__ignoreDepthValues!==void 0&&Q.__ignoreDepthValues;if(se===!1&&(V.depthBuffer&&(W|=256),V.stencilBuffer&&(W|=1024)),I&&o.framebufferRenderbuffer(36008,36064,36161,Q.__webglColorRenderbuffer[N]),se===!0&&(o.invalidateFramebuffer(36008,[P]),o.invalidateFramebuffer(36009,[P])),I){const ce=n.get(G[N]).__webglTexture;o.framebufferTexture2D(36009,36064,3553,ce,0)}o.blitFramebuffer(0,0,ee,X,0,0,ee,X,W,9728),g&&o.invalidateFramebuffer(36008,Y)}if(t.bindFramebuffer(36008,null),t.bindFramebuffer(36009,null),I)for(let N=0;N<G.length;N++){t.bindFramebuffer(36160,Q.__webglMultisampledFramebuffer),o.framebufferRenderbuffer(36160,36064+N,36161,Q.__webglColorRenderbuffer[N]);const se=n.get(G[N]).__webglTexture;t.bindFramebuffer(36160,Q.__webglFramebuffer),o.framebufferTexture2D(36009,36064+N,3553,se,0)}t.bindFramebuffer(36009,Q.__webglMultisampledFramebuffer)}},this.setupDepthRenderbuffer=J,this.setupFrameBufferTexture=U,this.useMultisampledRTT=te}function UJ(o,e,t,n){let r={},a={},i=[];const s=t.isWebGL2?o.getParameter(35375):0;function c(f,m,g){const A=f.value;if(g[m]===void 0){if(typeof A=="number")g[m]=A;else{const _=Array.isArray(A)?A:[A],x=[];for(let C=0;C<_.length;C++)x.push(_[C].clone());g[m]=x}return!0}if(typeof A=="number"){if(g[m]!==A)return g[m]=A,!0}else{const _=Array.isArray(g[m])?g[m]:[g[m]],x=Array.isArray(A)?A:[A];for(let C=0;C<_.length;C++){const b=_[C];if(b.equals(x[C])===!1)return b.copy(x[C]),!0}}return!1}function u(f){const m={boundary:0,storage:0};return typeof f=="number"?(m.boundary=4,m.storage=4):f.isVector2?(m.boundary=8,m.storage=8):f.isVector3||f.isColor?(m.boundary=16,m.storage=12):f.isVector4?(m.boundary=16,m.storage=16):f.isMatrix3?(m.boundary=48,m.storage=48):f.isMatrix4?(m.boundary=64,m.storage=64):f.isTexture?console.warn("v3d.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("v3d.WebGLRenderer: Unsupported uniform value type.",f),m}function h(f){const m=f.target;m.removeEventListener("dispose",h);const g=i.indexOf(m.__bindingPointIndex);i.splice(g,1),o.deleteBuffer(r[m.id]),delete r[m.id],delete a[m.id]}return{bind:function(f,m){const g=m.program;n.uniformBlockBinding(f,g)},update:function(f,m){let g=r[f.id];g===void 0&&(function(x){const C=x.uniforms;let b=0;const y=16;let M=0;for(let R=0,T=C.length;R<T;R++){const w=C[R],D={boundary:0,storage:0},z=Array.isArray(w.value)?w.value:[w.value];for(let F=0,O=z.length;F<O;F++){const q=u(z[F]);D.boundary+=q.boundary,D.storage+=q.storage}w.__data=new Float32Array(D.storage/Float32Array.BYTES_PER_ELEMENT),w.__offset=b,R>0&&(M=b%y,M!==0&&y-M-D.boundary<0&&(b+=y-M,w.__offset=b)),b+=D.storage}M=b%y,M>0&&(b+=y-M),x.__size=b,x.__cache={}}(f),g=function(x){const C=function(){for(let R=0;R<s;R++)if(i.indexOf(R)===-1)return i.push(R),R;return console.error("v3d.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}();x.__bindingPointIndex=C;const b=o.createBuffer(),y=x.__size,M=x.usage;return o.bindBuffer(35345,b),o.bufferData(35345,y,M),o.bindBuffer(35345,null),o.bindBufferBase(35345,C,b),b}(f),r[f.id]=g,f.addEventListener("dispose",h));const A=m.program;n.updateUBOMapping(f,A);const _=e.render.frame;a[f.id]!==_&&(function(x){const C=r[x.id],b=x.uniforms,y=x.__cache;o.bindBuffer(35345,C);for(let M=0,R=b.length;M<R;M++){const T=b[M];if(c(T,M,y)===!0){const w=T.__offset,D=Array.isArray(T.value)?T.value:[T.value];let z=0;for(let F=0;F<D.length;F++){const O=D[F],q=u(O);typeof O=="number"?(T.__data[0]=O,o.bufferSubData(35345,w+z,T.__data)):O.isMatrix3?(T.__data[0]=O.elements[0],T.__data[1]=O.elements[1],T.__data[2]=O.elements[2],T.__data[3]=O.elements[0],T.__data[4]=O.elements[3],T.__data[5]=O.elements[4],T.__data[6]=O.elements[5],T.__data[7]=O.elements[0],T.__data[8]=O.elements[6],T.__data[9]=O.elements[7],T.__data[10]=O.elements[8],T.__data[11]=O.elements[0]):(O.toArray(T.__data,z),z+=q.storage/Float32Array.BYTES_PER_ELEMENT)}o.bufferSubData(35345,w,T.__data)}}o.bindBuffer(35345,null)}(f),a[f.id]=_)},dispose:function(){for(const f in r)o.deleteBuffer(r[f]);i=[],r={},a={}}}}function T5(o,e,t){const n=t.isWebGL2;return{convert:function(r,a=null){let i;if(r===1009)return 5121;if(r===1017)return 32819;if(r===1018)return 32820;if(r===1010)return 5120;if(r===1011)return 5122;if(r===1012)return 5123;if(r===1013)return 5124;if(r===1014)return 5125;if(r===1015)return 5126;if(r===1016)return n?5131:(i=e.get("OES_texture_half_float"),i!==null?i.HALF_FLOAT_OES:null);if(r===1021)return 6406;if(r===1023)return 6408;if(r===1024)return 6409;if(r===1025)return 6410;if(r===1026)return 6402;if(r===1027)return 34041;if(r===1035)return i=e.get("EXT_sRGB"),i!==null?i.SRGB_ALPHA_EXT:null;if(r===1028)return 6403;if(r===1029)return 36244;if(r===1030)return 33319;if(r===1031)return 33320;if(r===1033)return 36249;if(r===33776||r===33777||r===33778||r===33779)if(a===3001){if(i=e.get("WEBGL_compressed_texture_s3tc_srgb"),i===null)return null;if(r===33776)return i.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(r===33777)return i.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(r===33778)return i.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(r===33779)return i.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else{if(i=e.get("WEBGL_compressed_texture_s3tc"),i===null)return null;if(r===33776)return i.COMPRESSED_RGB_S3TC_DXT1_EXT;if(r===33777)return i.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(r===33778)return i.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(r===33779)return i.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(r===35840||r===35841||r===35842||r===35843){if(i=e.get("WEBGL_compressed_texture_pvrtc"),i===null)return null;if(r===35840)return i.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(r===35841)return i.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(r===35842)return i.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(r===35843)return i.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(r===36196)return i=e.get("WEBGL_compressed_texture_etc1"),i!==null?i.COMPRESSED_RGB_ETC1_WEBGL:null;if(r===37492||r===37496){if(i=e.get("WEBGL_compressed_texture_etc"),i===null)return null;if(r===37492)return a===3001?i.COMPRESSED_SRGB8_ETC2:i.COMPRESSED_RGB8_ETC2;if(r===37496)return a===3001?i.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:i.COMPRESSED_RGBA8_ETC2_EAC}if(r===37808||r===37809||r===37810||r===37811||r===37812||r===37813||r===37814||r===37815||r===37816||r===37817||r===37818||r===37819||r===37820||r===37821){if(i=e.get("WEBGL_compressed_texture_astc"),i===null)return null;if(r===37808)return a===3001?i.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:i.COMPRESSED_RGBA_ASTC_4x4_KHR;if(r===37809)return a===3001?i.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:i.COMPRESSED_RGBA_ASTC_5x4_KHR;if(r===37810)return a===3001?i.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:i.COMPRESSED_RGBA_ASTC_5x5_KHR;if(r===37811)return a===3001?i.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:i.COMPRESSED_RGBA_ASTC_6x5_KHR;if(r===37812)return a===3001?i.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:i.COMPRESSED_RGBA_ASTC_6x6_KHR;if(r===37813)return a===3001?i.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:i.COMPRESSED_RGBA_ASTC_8x5_KHR;if(r===37814)return a===3001?i.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:i.COMPRESSED_RGBA_ASTC_8x6_KHR;if(r===37815)return a===3001?i.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:i.COMPRESSED_RGBA_ASTC_8x8_KHR;if(r===37816)return a===3001?i.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:i.COMPRESSED_RGBA_ASTC_10x5_KHR;if(r===37817)return a===3001?i.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:i.COMPRESSED_RGBA_ASTC_10x6_KHR;if(r===37818)return a===3001?i.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:i.COMPRESSED_RGBA_ASTC_10x8_KHR;if(r===37819)return a===3001?i.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:i.COMPRESSED_RGBA_ASTC_10x10_KHR;if(r===37820)return a===3001?i.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:i.COMPRESSED_RGBA_ASTC_12x10_KHR;if(r===37821)return a===3001?i.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:i.COMPRESSED_RGBA_ASTC_12x12_KHR}if(r===36492){if(i=e.get("EXT_texture_compression_bptc"),i===null)return null;if(r===36492)return a===3001?i.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:i.COMPRESSED_RGBA_BPTC_UNORM_EXT}return r===1020?n?34042:(i=e.get("WEBGL_depth_texture"),i!==null?i.UNSIGNED_INT_24_8_WEBGL:null):o[r]!==void 0?o[r]:null}}}class R5 extends ir{constructor(e=[]){super(),this.isArrayCamera=!0,this.cameras=e}}class Da extends Tt{constructor(){super(),this.isGroup=!0,this.type="Group"}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}}const zJ={type:"move"};class DA{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new Da,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(e){return this._targetRay===null&&(this._targetRay=new Da,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new B,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new B,this._targetRay.name="XR_CONTROLLER_"+String(e)),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new Da,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new B,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new B),this._grip}dispatchEvent(e){return this._targetRay!==null&&this._targetRay.dispatchEvent(e),this._grip!==null&&this._grip.dispatchEvent(e),this._hand!==null&&this._hand.dispatchEvent(e),this}connect(e){if(e&&e.hand){const t=this._hand;if(t)for(const n of e.hand.values())this._getHandJoint(t,n)}return this.dispatchEvent({type:"connected",data:e}),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(e,t,n){let r=null,a=null,i=null;const s=this._targetRay,c=this._grip,u=this._hand;if(e&&t.session.visibilityState!=="visible-blurred"){if(u&&e.hand){i=!0;for(const _ of e.hand.values()){const x=t.getJointPose(_,n),C=this._getHandJoint(u,_);x!==null&&(C.matrix.fromArray(x.transform.matrix),C.matrix.decompose(C.position,C.rotation,C.scale),C.jointRadius=x.radius),C.visible=x!==null}const h=u.joints["index-finger-tip"],f=u.joints["thumb-tip"],m=h.position.distanceTo(f.position),g=.02,A=.005;u.inputState.pinching&&m>g+A?(u.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!u.inputState.pinching&&m<=g-A&&(u.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else c!==null&&e.gripSpace&&(a=t.getPose(e.gripSpace,n),a!==null&&(c.matrix.fromArray(a.transform.matrix),c.matrix.decompose(c.position,c.rotation,c.scale),a.linearVelocity?(c.hasLinearVelocity=!0,c.linearVelocity.copy(a.linearVelocity)):c.hasLinearVelocity=!1,a.angularVelocity?(c.hasAngularVelocity=!0,c.angularVelocity.copy(a.angularVelocity)):c.hasAngularVelocity=!1));s!==null&&(r=t.getPose(e.targetRaySpace,n),r===null&&a!==null&&(r=a),r!==null&&(s.matrix.fromArray(r.transform.matrix),s.matrix.decompose(s.position,s.rotation,s.scale),r.linearVelocity?(s.hasLinearVelocity=!0,s.linearVelocity.copy(r.linearVelocity)):s.hasLinearVelocity=!1,r.angularVelocity?(s.hasAngularVelocity=!0,s.angularVelocity.copy(r.angularVelocity)):s.hasAngularVelocity=!1,this.dispatchEvent(zJ)))}return s!==null&&(s.visible=r!==null),c!==null&&(c.visible=a!==null),u!==null&&(u.visible=i!==null),this}_getHandJoint(e,t){if(e.joints[t.jointName]===void 0){const n=new Da;n.matrixAutoUpdate=!1,n.visible=!1,e.joints[t.jointName]=n,e.add(n)}return e.joints[t.jointName]}}class Cv{constructor(e,t,n=0,r=1/0){this.ray=new Td(e,t),this.near=n,this.far=r,this.camera=null,this.layers=new Rd,this.params={Mesh:{omitGeometry:!1},Line:{threshold:.1},LOD:{},Points:{threshold:.1},Sprite:{},checkVisibility:!0},this.layers.enable(3),this.layers.enable(4),this.layers.enable(5),this.layers.enable(6),this.layers.enable(7)}set(e,t){this.ray.set(e,t)}setFromCamera(e,t){t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):console.error("v3d.Raycaster: Unsupported camera type: "+t.type)}intersectObject(e,t=!0,n=[]){return b2(e,this,n,t,this.params.checkVisibility),n.sort(VM),n}intersectObjects(e,t=!0,n=[]){for(let r=0,a=e.length;r<a;r++)b2(e[r],this,n,t,this.params.checkVisibility);return n.sort(VM),n}}function VM(o,e){return o.distance-e.distance}function b2(o,e,t,n,r){if(!(r&&(o.visible===!1||o.isMesh&&o.isMaterialGeneratedMesh&&o.parent&&!o.parent.visible)||(o.layers.test(e.layers)&&o.raycast(e,t),n!==!0))){const a=o.children;for(let i=0,s=a.length;i<s;i++)b2(a[i],e,t,!0,r)}}class VJ extends oo{constructor(e,t){super();const n=this;let r=null,a=1,i=null,s="local-floor",c=null,u=null,h=null,f=null,m=null,g=null;const A=t.getContextAttributes();let _=null,x=null;const C=[],b=[],y=new Set,M=new Map,R=new Ee;let T=null;const w=new ir;w.layers.enable(1),w.viewport=new ct;const D=new ir;D.layers.enable(2),D.viewport=new ct;const z=[w,D],F=new R5;F.layers.enable(1),F.layers.enable(2),F.matrixAutoUpdate=!1;let O=null,q=null,ne=null,$=null,he=null,K=new Ve;const oe=new B,ie=new B,L=new Ct;function U(X){const W=b.indexOf(X.inputSource);if(W===-1)return;const Y=C[W];Y!==void 0&&Y.dispatchEvent({type:X.type,data:X.inputSource})}function k(){r.removeEventListener("select",U),r.removeEventListener("selectstart",U),r.removeEventListener("selectend",U),r.removeEventListener("squeeze",U),r.removeEventListener("squeezestart",U),r.removeEventListener("squeezeend",U),r.removeEventListener("end",k),r.removeEventListener("inputsourceschange",J);for(let X=0;X<C.length;X++){const W=b[X];W!==null&&(b[X]=null,C[X].disconnect(W))}O=null,q=null,e.setRenderTarget(_),m=null,f=null,h=null,r=null,x=null,ne=null,G.stop(),n.isPresenting=!1,e.setPixelRatio(T),e.setSize(R.width,R.height,!1),n.dispatchEvent({type:"sessionend"})}function J(X){for(let W=0;W<X.removed.length;W++){const Y=X.removed[W],P=b.indexOf(Y);P>=0&&(b[P]=null,C[P].disconnect(Y))}for(let W=0;W<X.added.length;W++){const Y=X.added[W];let P=b.indexOf(Y);if(P===-1){for(let I=0;I<C.length;I++){if(I>=b.length){b.push(Y),P=I;break}if(b[I]===null){b[I]=Y,P=I;break}}if(P===-1)break}const Q=C[P];Q&&Q.connect(Y)}}this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(X){let W=C[X];return W===void 0&&(W=new DA,C[X]=W),W.getTargetRaySpace(X)},this.getControllerGrip=function(X){let W=C[X];return W===void 0&&(W=new DA,C[X]=W),W.getGripSpace()},this.getHand=function(X){let W=C[X];return W===void 0&&(W=new DA,C[X]=W),W.getHandSpace()},this.setFramebufferScaleFactor=function(X){a=X,n.isPresenting===!0&&console.warn("v3d.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(X){s=X,n.isPresenting===!0&&console.warn("v3d.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return c||i},this.setReferenceSpace=function(X){c=X},this.getBaseLayer=function(){return f!==null?f:m},this.getBinding=function(){return h},this.getFrame=function(){return g},this.getSession=function(){return r},this.setSession=async function(X){if(r=X,r!==null){if(_=e.getRenderTarget(),r.addEventListener("select",U),r.addEventListener("selectstart",U),r.addEventListener("selectend",U),r.addEventListener("squeeze",U),r.addEventListener("squeezestart",U),r.addEventListener("squeezeend",U),r.addEventListener("end",k),r.addEventListener("inputsourceschange",J),A.xrCompatible!==!0&&await t.makeXRCompatible(),T=e.getPixelRatio(),e.getSize(R),r.renderState.layers===void 0||e.capabilities.isWebGL2===!1){const W={antialias:r.renderState.layers!==void 0||A.antialias,alpha:A.alpha,depth:A.depth,stencil:A.stencil,framebufferScaleFactor:a};m=new XRWebGLLayer(r,t,W),r.updateRenderState({baseLayer:m}),e.setPixelRatio(1),e.setSize(m.framebufferWidth,m.framebufferHeight,!1),x=new qt(m.framebufferWidth,m.framebufferHeight,{format:1023,type:1009,encoding:e.outputEncoding,stencilBuffer:A.stencil})}else{let W=null,Y=null,P=null;A.depth&&(P=A.stencil?35056:33190,W=A.stencil?1027:1026,Y=A.stencil?1020:1014);const Q={colorFormat:32856,depthFormat:P,scaleFactor:a};h=new XRWebGLBinding(r,t),f=h.createProjectionLayer(Q),r.updateRenderState({layers:[f]}),e.setPixelRatio(1),e.setSize(f.textureWidth,f.textureHeight,!1),x=new qt(f.textureWidth,f.textureHeight,{format:1023,type:1009,depthTexture:new Hy(f.textureWidth,f.textureHeight,Y,void 0,void 0,void 0,void 0,void 0,void 0,W),stencilBuffer:A.stencil,encoding:e.outputEncoding,samples:A.antialias?4:0}),e.properties.get(x).__ignoreDepthValues=f.ignoreDepthValues}x.isXRRenderTarget=!0,this.setFoveation(1),c=null,i=await r.requestReferenceSpace(s),G.setContext(r),G.start(),n.isPresenting=!0,n.dispatchEvent({type:"sessionstart"})}};const de=new B,te=new B;function le(X,W){if(W===null)X.matrixWorld.copy(X.matrix),K.identity(),c=null;else{X.matrixWorld.copy(X.matrix),K.copy(W.matrixWorld).invert().decompose(oe,L,ie);var Y=new XRRigidTransform({x:oe.x,y:oe.y,z:oe.z},{x:L.x,y:L.y,z:L.z,w:L.w});c=i.getOffsetReferenceSpace(Y)}X.matrixWorldInverse.copy(X.matrixWorld).invert()}this.updateCamera=function(X){if(r===null)return;F.near=D.near=w.near=X.near,F.far=D.far=w.far=X.far,O===F.near&&q===F.far||(r.updateRenderState({depthNear:F.near,depthFar:F.far}),O=F.near,q=F.far);const W=X.parent,Y=F.cameras;le(F,W);for(let I=0;I<Y.length;I++)le(Y[I],W);F.matrixWorld.decompose(F.position,F.quaternion,F.scale),X.matrixWorld.copy(F.matrixWorld),W===null?X.matrix.copy(X.matrixWorld):(X.matrix.copy(W.matrixWorld).invert(),X.matrix.multiply(X.matrixWorld)),X.matrix.decompose(X.position,X.quaternion,X.scale);const P=X.children;for(let I=0,N=P.length;I<N;I++)P[I].updateWorldMatrix(!1,!0);Y.length===2?function(I,N,se){de.setFromMatrixPosition(N.matrixWorld),te.setFromMatrixPosition(se.matrixWorld);const ce=de.distanceTo(te),fe=N.projectionMatrix.elements,ve=se.projectionMatrix.elements,xe=fe[14]/(fe[10]-1),Ie=fe[14]/(fe[10]+1),re=(fe[9]+1)/fe[5],me=(fe[9]-1)/fe[5],pe=(fe[8]-1)/fe[0],Ce=(ve[8]+1)/ve[0],we=xe*pe,be=xe*Ce,Pe=ce/(-pe+Ce),Ge=Pe*-pe;N.matrixWorld.decompose(I.position,I.quaternion,I.scale),I.translateX(Ge),I.translateZ(Pe),I.matrixWorld.compose(I.position,I.quaternion,I.scale),I.matrixWorldInverse.copy(I.matrixWorld).invert();const tt=xe+Pe,ot=Ie+Pe,Pt=we-Ge,$t=be+(ce-Ge),St=re*Ie/ot*tt,De=me*Ie/ot*tt;I.projectionMatrix.makePerspective(Pt,$t,St,De,tt,ot)}(F,w,D):F.projectionMatrix.copy(w.projectionMatrix);const Q=F.projectionMatrix.elements;F.fov=vv(2*Math.atan(1/Q[5])),F.aspect=Q[5]/Q[0],F.projectionMatrixInverse.copy(F.projectionMatrix).invert()},this.getCamera=function(){return F},this.getFoveation=function(){return f!==null?f.fixedFoveation:m!==null?m.fixedFoveation:void 0},this.setFoveation=function(X){f!==null&&(f.fixedFoveation=X),m!==null&&m.fixedFoveation!==void 0&&(m.fixedFoveation=X)},this.getPlanes=function(){return y};let V=null;const G=new b5;function ee(X){if(ne){const W=X.getHitTestResults(ne);if(W.length){const Y=W[0].getPose(n.getReferenceSpace()),P=new Ve().fromArray(Y.transform.matrix),Q=new B;Q.setFromMatrixPosition(P);const I=new B(0,1,0);I.applyNormalMatrix(new Qr().setFromMatrix4(P)),$(Q,I)}else he()}}G.setAnimationLoop(function(X,W){if(u=W.getViewerPose(c||i),g=W,u!==null){const Y=u.views;m!==null&&(e.setRenderTargetFramebuffer(x,m.framebuffer),e.setRenderTarget(x));let P=!1;Y.length!==F.cameras.length&&(F.cameras.length=0,P=!0);for(let Q=0;Q<Y.length;Q++){const I=Y[Q];let N=null;if(m!==null)N=m.getViewport(I);else{const ce=h.getViewSubImage(f,I);N=ce.viewport,Q===0&&(e.setRenderTargetTextures(x,ce.colorTexture,f.ignoreDepthValues?void 0:ce.depthStencilTexture),e.setRenderTarget(x))}let se=z[Q];se===void 0&&(se=new ir,se.layers.enable(Q),se.viewport=new ct,z[Q]=se),se.matrix.fromArray(I.transform.matrix),se.projectionMatrix.fromArray(I.projectionMatrix),se.viewport.set(N.x,N.y,N.width,N.height),Q===0&&F.matrix.copy(se.matrix),P===!0&&F.cameras.push(se)}}for(let Y=0;Y<C.length;Y++){const P=b[Y],Q=C[Y];P!==null&&Q!==void 0&&Q.update(P,W,c||i),ee(W)}if(V&&V(X,W),W.detectedPlanes){n.dispatchEvent({type:"planesdetected",data:W.detectedPlanes});let Y=null;for(const P of y)W.detectedPlanes.has(P)||(Y===null&&(Y=[]),Y.push(P));if(Y!==null)for(const P of Y)y.delete(P),M.delete(P),n.dispatchEvent({type:"planeremoved",data:P});for(const P of W.detectedPlanes)if(y.has(P)){const Q=M.get(P);P.lastChangedTime>Q&&(M.set(P,P.lastChangedTime),n.dispatchEvent({type:"planechanged",data:P}))}else y.add(P),M.set(P,W.lastChangedTime),n.dispatchEvent({type:"planeadded",data:P})}g=null}),this.setAnimationLoop=function(X){V=X},this.dispose=function(){},this.arHitTest=function(X,W,Y,P){if(!r||!XRSession.prototype.requestHitTestSource)return;$=Y||function(){},he=P||function(){},this.raycaster=this.raycaster||new Cv,this.raycaster.setFromCamera({x:X,y:W},z[0]);const Q=this.raycaster.ray;new XRRay(Q.origin,Q.direction),r.requestReferenceSpace("viewer").then(function(I){const N={space:I};r.requestHitTestSource(N).then(function(se){ne=se})})}}}function kJ(){const o=Wh("canvas");return o.style.display="block",o}function Wy(o={}){this.isWebGLRenderer=!0;const e=o.canvas!==void 0?o.canvas:kJ(),t=o.context!==void 0?o.context:null,n=o.depth===void 0||o.depth,r=o.stencil===void 0||o.stencil,a=o.antialias!==void 0&&o.antialias,i=o.premultipliedAlpha===void 0||o.premultipliedAlpha,s=o.preserveDrawingBuffer!==void 0&&o.preserveDrawingBuffer,c=o.powerPreference!==void 0?o.powerPreference:"default",u=o.failIfMajorPerformanceCaveat!==void 0&&o.failIfMajorPerformanceCaveat;let h;h=t!==null?t.getContextAttributes().alpha:o.alpha!==void 0&&o.alpha;let f=null,m=null;const g=[],A=[];this.domElement=e,this.debug={checkShaderErrors:!0,disableCompiledShaderCache:!1},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.outputEncoding=3e3,this.unitsScaleFactor=1,this.toneMapping=0,this.toneMappingLook=0,this.toneMappingExposure=1,this.gtaoMap=null,this.gtaoMapEnabled=!1,this.compatSettings={gtaoDisableBkgFix:!1};const _=this;let x=!1,C=0,b=0,y=null,M=-1,R=null;const T=new ct,w=new ct;let D=null,z=e.width,F=e.height,O=1,q=null,ne=null;const $=new ct(0,0,z,F),he=new ct(0,0,z,F);let K=!1;const oe=new hp;let ie=!1,L=!1,U=null;const k=new Ve,J=new Ee,de=new B,te=new Hr,le=new Ve,V=new Ve,G=new ct,ee=new Ve;new mn;let X=!1;function W(){return y===null?O:1}this.oitRenderer=new f$(new Ee(z,F));let Y,P,Q,I,N,se,ce,fe,ve,xe,Ie,re,me,pe,Ce,we,be,Pe,Ge,tt,ot,Pt,$t,St,De=t;function Un(Z,Te){for(let Le=0;Le<Z.length;Le++){const Ue=Z[Le],Ne=e.getContext(Ue,Te);if(Ne!==null)return Ne}return null}try{const Z={alpha:!0,depth:n,stencil:r,antialias:a,premultipliedAlpha:i,preserveDrawingBuffer:s,powerPreference:c,xrCompatible:!Wn.checkSafari(),failIfMajorPerformanceCaveat:u};if("setAttribute"in e&&e.setAttribute("data-engine","Verge3D 4.9.0"),e.addEventListener("webglcontextlost",rn,!1),e.addEventListener("webglcontextrestored",Bn,!1),e.addEventListener("webglcontextcreationerror",io,!1),De===null){const Te=["webgl2","webgl","experimental-webgl"];if(De=Un(Te,Z),De===null)throw Un(Te)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.");const Le=typeof WebGL2RenderingContext<"u"&&De instanceof WebGL2RenderingContext;console.log("Verge3D 4.9.0 "+CQ()+" ("+(vd(zg)==3483952072?"Trial":"License")+", "+(Le?"WebGL 2.0":"WebGL 1.0")+")")}De.getShaderPrecisionFormat===void 0&&(De.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(Z){throw console.error("v3d.WebGLRenderer: "+Z.message),Z}function dn(){Y=new e$(De),P=new jK(De,Y,o),Y.init(P),Pt=new T5(De,Y,P),Q=new OJ(De,Y,P),I=new r$,N=new CJ,se=new FJ(De,Y,Q,N,P,Pt,I),ce=new qK(_),fe=new JK(_),ve=new KQ(De,P),$t=new WK(De,Y,ve,P),xe=new t$(De,ve,I,$t),Ie=new h$(De,xe,ve,I),Ge=new s$(De,P,se),we=new XK(N),re=new SJ(_,ce,fe,Y,P,$t,we),me=new o$(_,N),pe=new MJ,Ce=new BJ(Y,P),Pe=new HK(_,ce,fe,Q,Ie,h,i),be=new DJ(_,Ie,P),St=new UJ(De,I,P,Q),tt=new YK(De,Y,I,P),ot=new n$(De,Y,I,P),I.programs=re.programs,_.capabilities=P,_.extensions=Y,_.properties=N,_.renderLists=pe,_.shadowMap=be,_.state=Q,_.info=I}dn();const Nt=new VJ(_,De);function rn(Z){Z.preventDefault(),console.log("v3d.WebGLRenderer: Context Lost."),x=!0}function Bn(){console.log("v3d.WebGLRenderer: Context Restored."),x=!1;const Z=be.enabled,Te=be.autoUpdate,Le=be.needsUpdate,Ue=be.type;dn(),be.enabled=Z,be.autoUpdate=Te,be.needsUpdate=Le,be.type=Ue}function io(Z){console.error("v3d.WebGLRenderer: A WebGL context could not be created. Reason:",Z.statusMessage)}function Mr(Z){const Te=Z.target;Te.removeEventListener("dispose",Mr),function(Le){(function(Ue){const Ne=N.get(Ue).programs;Ne!==void 0&&(Ne.forEach(function(We){re.releaseProgram(We)}),Ue.isShaderMaterial&&re.releaseShaderCache(Ue))})(Le),N.remove(Le)}(Te)}this.xr=Nt,this.getContext=function(){return De},this.getContextAttributes=function(){return De.getContextAttributes()},this.forceContextLoss=function(){const Z=Y.get("WEBGL_lose_context");Z&&Z.loseContext()},this.forceContextRestore=function(){const Z=Y.get("WEBGL_lose_context");Z&&Z.restoreContext()},this.getTextureUtils=function(){return se},this.getPixelRatio=function(){return O},this.setPixelRatio=function(Z){Z!==void 0&&(O=Z,this.setSize(z,F,!1))},this.getSize=function(Z){return Z.set(z,F)},this.setSize=function(Z,Te,Le){Nt.isPresenting?console.warn("v3d.WebGLRenderer: Can't change size while VR device is presenting."):(z=Z,F=Te,e.width=Math.floor(Z*O),e.height=Math.floor(Te*O),Le!==!1&&(e.style.width=Z+"px",e.style.height=Te+"px"),this.setViewport(0,0,Z,Te),this.oitRenderer&&(this.getDrawingBufferSize(J),this.oitRenderer.setSize(J.x,J.y)))},this.getDrawingBufferSize=function(Z){return Z.set(z*O,F*O).floor()},this.setDrawingBufferSize=function(Z,Te,Le){z=Z,F=Te,O=Le,e.width=Math.floor(Z*Le),e.height=Math.floor(Te*Le),this.setViewport(0,0,Z,Te)},this.getCurrentViewport=function(Z){return Z.copy(T)},this.getViewport=function(Z){return Z.copy($)},this.setViewport=function(Z,Te,Le,Ue){Z.isVector4?$.set(Z.x,Z.y,Z.z,Z.w):$.set(Z,Te,Le,Ue),Q.viewport(T.copy($).multiplyScalar(O).floor())},this.getScissor=function(Z){return Z.copy(he)},this.setScissor=function(Z,Te,Le,Ue){Z.isVector4?he.set(Z.x,Z.y,Z.z,Z.w):he.set(Z,Te,Le,Ue),Q.scissor(w.copy(he).multiplyScalar(O).floor())},this.getScissorTest=function(){return K},this.setScissorTest=function(Z){Q.setScissorTest(K=Z)},this.setOpaqueSort=function(Z){q=Z},this.setTransparentSort=function(Z){ne=Z},this.getClearColor=function(Z){return Z.copy(Pe.getClearColor())},this.setClearColor=function(){Pe.setClearColor.apply(Pe,arguments)},this.getClearAlpha=function(){return Pe.getClearAlpha()},this.setClearAlpha=function(){Pe.setClearAlpha.apply(Pe,arguments)},this.clear=function(Z=!0,Te=!0,Le=!0){let Ue=0;Z&&(Ue|=16384),Te&&(Ue|=256),Le&&(Ue|=1024),De.clear(Ue)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){e.removeEventListener("webglcontextlost",rn,!1),e.removeEventListener("webglcontextrestored",Bn,!1),e.removeEventListener("webglcontextcreationerror",io,!1),this.disposeGTAO(),this.disposeOIT(),this.disposeInternalCaches(),Nt.dispose(),Nt.removeEventListener("sessionstart",gn),Nt.removeEventListener("sessionend",Wa),U&&(U.dispose(),U=null),ga.stop()},this.canUseGTAO=function(){return this.gtaoMap&&this.gtaoMapEnabled},this.disposeGTAO=function(){var Z;(Z=this.gtaoMap)==null||Z.dispose(),this.gtaoMap=null},this.disposeOIT=function(){this.oitRenderer&&this.oitRenderer.dispose(),this.useOIT=!1},this.disposeInternalCaches=function(){pe.dispose(),Ce.dispose(),N.dispose(),ce.dispose(),fe.dispose(),Ie.dispose(),$t.dispose(),re.dispose(),St.dispose(),Pe.dispose(),ve.dispose()},this.renderBufferDirect=function(Z,Te,Le,Ue,Ne,We){Te===null&&(Te=te);const gt=Ne.isMesh&&Ne.matrixWorld.determinant()<0,vt=function(Pn,Mo,Cn,qe,Wt){var Ml;Mo.isScene!==!0&&(Mo=te),se.resetTextureUnits();const Nd=Mo.fog,vp=qe.isMeshNodeMaterial||qe.isMeshStandardMaterial?Mo.environment:null,_p=y===null?_.outputEncoding:y.isXRRenderTarget===!0?y.texture.encoding:3e3;if(qe.envMapAutoAssign&&(qe.isMeshNodeMaterial||qe.isMeshStandardMaterial)){const Jt=m.state.envMapProbeArray.find(En=>En.influenceGroup===null?En.intersectsMesh(Wt):Wt.groupNames.includes(En.influenceGroup)^En.influenceGroupInv)||Mo.worldEnvMapProbe;if(Jt){qe.envMap=((Ml=Jt.renderTarget)==null?void 0:Ml.texture)||null;const En=Jt.parallaxDistance;qe.envMapParallaxMatrix.copy(Jt.matrixWorldInverse).premultiply(ee.makeScale(1/En,1/En,1/En)),qe.envMapParallaxMatrixInv.copy(Jt.matrixWorld).multiply(ee.makeScale(En,En,En)),qe.envMapParallaxType=Jt.parallaxType}}const Uv=(qe.isMeshNodeMaterial||qe.isMeshStandardMaterial?fe:ce).get(qe.envMap||vp),Nc=qe.vertexColors===!0&&!!Cn.attributes.color&&Cn.attributes.color.itemSize===4,Dc=!!qe.normalMap&&!!Cn.attributes.tangent,va=!!Cn.morphAttributes.position,lo=!!Cn.morphAttributes.normal,Ap=!!Cn.morphAttributes.color,zv=qe.toneMapped?_.toneMapping:0,Sl=Cn.morphAttributes.position||Cn.morphAttributes.normal||Cn.morphAttributes.color,xp=Sl!==void 0?Sl.length:0,Oc=qe.side===1,jt=N.get(qe),co=m.state.lights;if(ie===!0&&(L===!0||Pn!==R)){const Jt=Pn===R&&qe.id===M;we.setState(qe,Pn,Jt)}const Cl=Eo(Wt,qe,m),yp=_.canUseGTAO()&&qe.isMeshNodeMaterial&&qe.canUseGTAO();let uo=!1,Ei=!1;qe.version===jt.__version?jt.needsLights&&jt.lightsStateVersion!==co.state.version||jt.outputEncoding!==_p||Wt.isInstancedMesh&&jt.instancing===!1?uo=!0:Wt.isInstancedMesh||jt.instancing!==!0?Wt.isSkinnedMesh&&jt.skinning===!1?uo=!0:Wt.isSkinnedMesh||jt.skinning!==!0?jt.envMap!==Uv?(uo=!0,Ei=!0):qe.fog===!0&&jt.fog!==Nd?uo=!0:jt.numClippingPlanes===void 0||jt.numClippingPlanes===we.numPlanes&&jt.numIntersection===we.numIntersection?(jt.vertexAlphas!==Nc||jt.vertexTangents!==Dc||jt.morphTargets!==va||jt.morphNormals!==lo||jt.morphColors!==Ap||jt.toneMapping!==zv||P.isWebGL2===!0&&jt.morphTargetsCount!==xp||jt.planeReflProbe!==Cl||qe.isMeshNormalMaterial&&jt.flipSided!==Oc||jt.useGTAO!==yp)&&(uo=!0):uo=!0:uo=!0:uo=!0:uo=!0;let Ya=jt.currentProgram;uo===!0&&(Ya=Ci(qe,Mo,Wt,m));let Dd=!1,wo=!1,Od=!1;const At=Ya.getUniforms(),ja=jt.uniforms;if(Q.useProgram(Ya.program)&&(Dd=!0,wo=!0,Od=!0),qe.id!==M&&(M=qe.id,wo=!0),Ei&&(wo=!0),Dd||R!==Pn){if(At.setValue(De,"projectionMatrix",Pn.projectionMatrix),P.logarithmicDepthBuffer&&At.setValue(De,"logDepthBufFC",2/(Math.log(Pn.far+1)/Math.LN2)),R!==Pn&&(R=Pn,wo=!0,Od=!0),qe.isMeshNodeMaterial||qe.isShaderMaterial||qe.isMeshStandardMaterial||qe.envMap){const Jt=At.map.cameraPosition;Jt!==void 0&&Jt.setValue(De,de.setFromMatrixPosition(Pn.matrixWorld))}(qe.isMeshNodeMaterial||qe.isMeshLambertMaterial||qe.isMeshBasicMaterial||qe.isMeshStandardMaterial||qe.isShaderMaterial)&&At.setValue(De,"isOrthographic",Pn.isOrthographicCamera===!0),(qe.isMeshNodeMaterial||qe.isMeshLambertMaterial||qe.isMeshBasicMaterial||qe.isMeshStandardMaterial||qe.isShaderMaterial||qe.isShadowMaterial||Wt.isSkinnedMesh)&&At.setValue(De,"viewMatrix",Pn.matrixWorldInverse),(qe.isMeshNodeMaterial||qe.isMeshLambertMaterial||qe.isMeshStandardMaterial||qe.isShadowMaterial)&&At.setValue(De,"invViewMatrix",Pn.matrixWorld)}if(Wt.isSkinnedMesh){At.setOptional(De,Wt,"bindMatrix"),At.setOptional(De,Wt,"bindMatrixInverse");const Jt=Wt.skeleton;Jt&&(P.floatVertexTextures?(Jt.boneTexture===null&&Jt.computeBoneTexture(),At.setValue(De,"boneTexture",Jt.boneTexture,se),At.setValue(De,"boneTextureSize",Jt.boneTextureSize)):console.warn("v3d.WebGLRenderer: SkinnedMesh can only be used with WebGL 2. With WebGL 1 OES_texture_float and vertex textures support is required."))}const El=Cn.morphAttributes;if((El.position!==void 0||El.normal!==void 0||El.color!==void 0&&P.isWebGL2===!0)&&Ge.update(Wt,Cn,qe,Ya),(wo||jt.receiveShadow!==Wt.receiveShadow)&&(jt.receiveShadow=Wt.receiveShadow,At.setValue(De,"receiveShadow",Wt.receiveShadow)),wo){if(At.setValue(De,"toneMappingExposure",_.toneMappingExposure),_.toneMapping==6?(At.setValue(De,"toneMappingBrightness",_.toneMappingBrightness),At.setValue(De,"toneMappingContrast",_.toneMappingContrast),At.setValue(De,"toneMappingMidTones",_.toneMappingMidTones),At.setValue(De,"toneMappingPhysicalScale",_.toneMappingPhysicalScale),At.setValue(De,"toneMappingChromaticAdaptation",_.toneMappingChromaticAdaptation),At.setValue(De,"toneMappingWhiteColor",_.toneMappingWhiteColor),At.setValue(De,"toneMappingColorDifferentiation",_.toneMappingColorDifferentiation),At.setValue(De,"toneMappingExteriorDaylight",_.toneMappingExteriorDaylight)):_.toneMapping==7&&(At.setValue(De,"toneMappingResolution",J.set(z,F)),At.setValue(De,"toneMappingWhiteBalance",_.toneMappingWhiteBalance),At.setValue(De,"toneMappingHighlights",_.toneMappingHighlights),At.setValue(De,"toneMappingMidTones",_.toneMappingMidTones),At.setValue(De,"toneMappingShadows",_.toneMappingShadows),At.setValue(De,"toneMappingSaturation",_.toneMappingSaturation),At.setValue(De,"toneMappingPhysicalScale",_.toneMappingPhysicalScale),At.setValue(De,"toneMappingAperture",_.toneMappingAperture),At.setValue(De,"toneMappingShutter",_.toneMappingShutter),At.setValue(De,"toneMappingISO",_.toneMappingISO),At.setValue(De,"toneMappingVignetting",_.toneMappingVignetting)),jt.needsLights&&(jr=Od,(fo=ja).ambientLightColor.needsUpdate=jr,fo.lightProbe.needsUpdate=jr,fo.directionalLights.needsUpdate=jr,fo.directionalLightShadowsCSM.needsUpdate=jr,fo.directionalLightShadowsCSMCascade.needsUpdate=jr,fo.pointLights.needsUpdate=jr,fo.pointLightShadows.needsUpdate=jr,fo.spotLights.needsUpdate=jr,fo.spotLightShadows.needsUpdate=jr,fo.rectAreaLights.needsUpdate=jr,fo.rectAreaLightShadows.needsUpdate=jr,fo.hemisphereLights.needsUpdate=jr),Nd&&qe.fog===!0&&me.refreshFogUniforms(ja,Nd),jt.useGTAO){const Jt=(y==null?void 0:y.width)??z,En=(y==null?void 0:y.height)??F;At.setValue(De,"currResolution",J.set(Jt,En)),me.refreshGTAOUniforms(ja,_.gtaoMap)}if(me.refreshMaterialUniforms(ja,qe,O,F,U),Cl&&me.refreshPlaneReflProbeUniforms(ja,Cl),qe.isMeshNodeMaterial)for(const Jt in qe.nodeTextures)At.setValue(De,Jt,qe.nodeTextures[Jt],se);qe.isMeshLineMaterial&&At.setValue(De,"resolution",J.set(z,F)),fg.upload(De,yl(jt),ja,se)}var fo,jr;if(qe.isShaderMaterial&&qe.uniformsNeedUpdate===!0&&(fg.upload(De,yl(jt),ja,se),qe.uniformsNeedUpdate=!1),qe.isSpriteMaterial&&At.setValue(De,"center",Wt.center),qe.isMeshNodeMaterial){qe.needsBoundingBox&&(Cn.boundingBox===null&&Cn.computeBoundingBox(),At.setValue(De,"boundingBoxMin",Cn.boundingBox.min),At.setValue(De,"boundingBoxMax",Cn.boundingBox.max)),At.setValue(De,"viewWidthHeight",J.set(T.z-T.x,T.w-T.y));const Jt=At.map.invModelMatrix;(Jt||qe.nodeTexCoordObject.includes(null))&&(le.copy(Wt.matrixWorld).invert(),Jt&&Jt.setValue(De,le)),qe.nodeTexCoordObject.forEach(function(_a,Aa){(_a===null?le:V.copy(_a.matrixWorld).invert()).toArray(jt.nodeTexCoordObjectMatrices,16*Aa)}),At.setValue(De,"nodeTexCoordObjectMatrices",jt.nodeTexCoordObjectMatrices),At.setValue(De,"objectIndex",Wt.objectIndex);const En=Wt.objectColor;At.setValue(De,"objectColor",G.set(En.r,En.g,En.b,Wt.objectAlpha)),At.setValue(De,"objectRandom",vd(Wt.uuid)/Math.pow(2,32))}if(At.setValue(De,"modelViewMatrix",Wt.modelViewMatrix),At.setValue(De,"normalMatrix",Wt.normalMatrix),At.setValue(De,"modelMatrix",Wt.matrixWorld),qe.isShaderMaterial||qe.isRawShaderMaterial){const Jt=qe.uniformsGroups;for(let En=0,_a=Jt.length;En<_a;En++)if(P.isWebGL2){const Aa=Jt[En];St.update(Aa,Ya),St.bind(Aa,Ya)}else console.warn("v3d.WebGLRenderer: Uniform Buffer Objects can only be used with WebGL 2.")}return Ya}(Z,Te,Le,Ue,Ne);Q.setMaterial(Ue,gt);let Rt=Le.index,Lt=1;Ue.wireframe===!0&&(Rt=xe.getWireframeAttribute(Le),Lt=2);const zt=Le.drawRange,Sn=Le.attributes.position;let Dt=zt.start*Lt,ht=(zt.start+zt.count)*Lt;We!==null&&(Dt=Math.max(Dt,We.start*Lt),ht=Math.min(ht,(We.start+We.count)*Lt)),Rt!==null?(Dt=Math.max(Dt,0),ht=Math.min(ht,Rt.count)):Sn!=null&&(Dt=Math.max(Dt,0),ht=Math.min(ht,Sn.count));const on=ht-Dt;if(on<0||on===1/0)return;let so;$t.setup(Ne,Ue,vt,Le,Rt);let Ot=tt;if(Rt!==null&&(so=ve.get(Rt),Ot=ot,Ot.setIndex(so)),Ne.isMesh)Ue.wireframe===!0?(Q.setLineWidth(Ue.wireframeLinewidth*W()),Ot.setMode(1)):Ot.setMode(4);else if(Ne.isLine){let Pn=Ue.linewidth;Pn===void 0&&(Pn=1),Q.setLineWidth(Pn*W()),Ne.isLineSegments?Ot.setMode(1):Ne.isLineLoop?Ot.setMode(2):Ot.setMode(3)}else Ne.isPoints?Ot.setMode(0):Ne.isSprite&&Ot.setMode(4);if(vt.beginTimerQuery(De,P.isWebGL2),Ue.depthPrepass&&Ue.transparent){const Pn=Q.buffers.depth.getTest(),Mo=Q.buffers.color.getMask();if(Q.buffers.depth.setTest(!0),Q.buffers.color.setMask(0),Ne.isInstancedMesh)Ot.renderInstances(Dt,on,Ne.count);else if(Le.isInstancedBufferGeometry){const Cn=Le._maxInstanceCount!==void 0?Le._maxInstanceCount:1/0,qe=Math.min(Le.instanceCount,Cn);Ot.renderInstances(Dt,on,qe)}else Ot.render(Dt,on);Q.buffers.depth.setTest(Pn),Q.buffers.color.setMask(Mo)}if(Ne.isInstancedMesh)Ot.renderInstances(Dt,on,Ne.count);else if(Le.isInstancedBufferGeometry){const Pn=Le._maxInstanceCount!==void 0?Le._maxInstanceCount:1/0,Mo=Math.min(Le.instanceCount,Pn);Ot.renderInstances(Dt,on,Mo)}else Ot.render(Dt,on);vt.endTimerQuery(De,P.isWebGL2)},this._compilePrepareRenderState=function(Z,Te,Le){Le.init(),Z.traverse(Ne=>{Ne.isLight?(Le.pushLight(Ne),Ne.castShadow&&Le.pushShadow(Ne)):Ne.isCubeReflectionProbe?Le.pushEnvMapProbe(Ne):Ne.isPlaneReflectionProbe&&Le.pushPlaneReflProbe(Ne)}),Le.setupLights(),Le.sortEnvMapProbes();let Ue=null;return Z.worldEnvMapProbe&&Z.worldEnvMapProbe.renderTarget!==null&&(Ue=Z.worldEnvMapProbe.renderTarget.texture),Z.traverse(Ne=>{Ne.material&&(Array.isArray(Ne.material)?Ne.material:[Ne.material]).forEach(We=>{(We.isMeshNodeMaterial||We.isMeshStandardMaterial)&&(Ne.material.envMap=Ue,Ne.material.needsUpdate=!0)})}),Le},this.compile=function(Z,Te){this.gtaoMapEnabled=!0;const Le=Ce.get(Z,A.length);this._compilePrepareRenderState(Z,Te,Le);const Ue={};Z.traverse(function(Ne){const We=Ne.material;if(We)if(Array.isArray(We))for(let gt=0;gt<We.length;gt++){const vt=We[gt];!(vt.uuid in Ue)&&(Ci(vt,Z,Ne,Le),Ue[vt.uuid]=!0)}else!(We.uuid in Ue)&&(Ci(We,Z,Ne,Le),Ue[We.uuid]=!0)}),this.gtaoMapEnabled=!1},this.compileAsync=function(Z,Te,Le){const Ue=new y2(Y,P);this._compilePrepareRenderState(Z,Te,Ue);const Ne=[];if(Z.traverse(function(We){We.material&&(Array.isArray(We.material)?We.material:[We.material]).forEach(function(gt){Ne.push({scene:Z,obj:We,mat:gt})})}),Ne.length===0)Le(1);else{const We=Y.get("KHR_parallel_shader_compile"),gt=(We===null?1:2)*Ne.length;let vt=0,Rt=0;const Lt={};if(EQ(Ne,function(zt,Sn,Dt){_.gtaoMapEnabled=!0;var ht=Ci(zt.mat,zt.scene,zt.obj,Ue);if(_.gtaoMapEnabled=!1,We){const on=ht.id;on in Lt||(Lt[on]={program:ht,weight:0}),Lt[on].weight++}Le&&(vt++,Le((vt+Rt)/gt))},16),We){const zt=setInterval(function(){let Sn=0;for(let Dt in Lt){const ht=Lt[Dt];(ht.program.program===void 0||De.getProgramParameter(ht.program.program,We.COMPLETION_STATUS_KHR))&&(Sn+=ht.weight)}Rt=Math.max(Rt,Sn),Le&&Le((vt+Rt)/gt),Rt===Ne.length&&clearInterval(zt)},16)}}};let Xn=null;function gn(){ga.stop()}function Wa(){ga.start()}const ga=new b5;function xl(Z,Te,Le,Ue){Z.isAnnotationControl&&Z.update(Te);let Ne=!1;if(Z.visible&&(Ne=Z.layers.test(Te.layers),Ne)){if(Z.isGroup)Le=Z.renderOrder;else if(Z.isLOD)Z.autoUpdate===!0&&Z.update(Te);else if(Z.isLight)m.pushLight(Z),Z.castShadow&&m.pushShadow(Z);else if(Z.isCubeReflectionProbe)m.pushEnvMapProbe(Z);else if(Z.isPlaneReflectionProbe)m.pushPlaneReflProbe(Z);else if(Z.isSprite){if(!Z.frustumCulled||oe.intersectsSprite(Z)){Ue&&de.setFromMatrixPosition(Z.matrixWorld).applyMatrix4(k);const gt=Ie.update(Z),vt=Z.material;f.push(Z,gt,vt,Le,de.z,null)}}else if((Z.isMesh||Z.isLine||Z.isPoints)&&(Z.isSkinnedMesh&&Z.skeleton.frame!==I.render.frame&&(Z.skeleton.update(),Z.skeleton.frame=I.render.frame),!Z.frustumCulled||oe.intersectsObject(Z))){Ue&&de.setFromMatrixPosition(Z.matrixWorld).applyMatrix4(k);const gt=Ie.update(Z),vt=Z.material;if(Array.isArray(vt)){const Rt=gt.groups;for(let Lt=0,zt=Rt.length;Lt<zt;Lt++){const Sn=Rt[Lt],Dt=vt[Sn.materialIndex];Dt&&Dt.visible&&f.push(Z,gt,Dt,Le,de.z,Sn)}}else vt.visible&&f.push(Z,gt,vt,Le,de.z,null)}}if(Z.disableChildRendering)return;const We=Z.children;for(let gt=0,vt=We.length;gt<vt;gt++){const Rt=We[gt];!Ne&&Rt.isMesh&&Rt.isMaterialGeneratedMesh||xl(Rt,Te,Le,Ue)}}function So(Z,Te,Le,Ue){const Ne=Z.opaque,We=Z.transmissive,gt=Z.transparent;m.setupLightsView(Le),We.length>0&&function(vt,Rt,Lt){const zt=P.isWebGL2;U===null&&(U=new qt(1,1,{generateMipmaps:!0,type:Y.has("EXT_color_buffer_half_float")?1016:1009,minFilter:1008,samples:zt&&a===!0?4:0})),_.getDrawingBufferSize(J),zt?U.setSize(J.x,J.y):U.setSize(Vg(J.x),Vg(J.y));const Sn=_.getRenderTarget();_.setRenderTarget(U),_.clear();const Dt=_.toneMapping;_.toneMapping=0,Co(vt,Rt,Lt),_.toneMapping=Dt,se.updateMultisampleRenderTarget(U),se.updateRenderTargetMipmap(U),_.setRenderTarget(Sn)}(Ne,Te,Le),Ue&&Q.viewport(T.copy(Ue)),Ne.length>0&&Co(Ne,Te,Le),We.length>0&&Co(We,Te,Le),gt.length>0&&(X&&_.oitRenderer.method!==0?_.oitRenderer.render(_,Co,gt,Te,Le):Co(gt,Te,Le)),Q.buffers.depth.setTest(!0),Q.buffers.depth.setMask(!0),Q.buffers.color.setMask(!0),Q.setPolygonOffset(!1)}function Co(Z,Te,Le){const Ue=Te.isScene===!0?Te.overrideMaterial:null;for(let Ne=0,We=Z.length;Ne<We;Ne++){const gt=Z[Ne],vt=gt.object,Rt=gt.geometry,Lt=Ue===null?gt.material:Ue,zt=gt.group;vt.layers.test(Le.layers)&&Si(vt,Te,Le,Rt,Lt,zt)}}function Si(Z,Te,Le,Ue,Ne,We){Z.onBeforeRender(_,Te,Le,Ue,Ne,We),Z.modelViewMatrix.multiplyMatrices(Le.matrixWorldInverse,Z.matrixWorld),Z.normalMatrix.getNormalMatrix(Z.modelViewMatrix),Ne.onBeforeRender(_,Te,Le,Ue,Z,We),Ne.transparent===!0&&Ne.side===3?(Ne.side=1,Ne.needsUpdate=!0,_.renderBufferDirect(Le,Te,Ue,Ne,Z,We),Ne.side=0,Ne.needsUpdate=!0,_.renderBufferDirect(Le,Te,Ue,Ne,Z,We),Ne.side=3):_.renderBufferDirect(Le,Te,Ue,Ne,Z,We),Z.onAfterRender(_,Te,Le,Ue,Ne,We)}function Ci(Z,Te,Le,Ue){Te.isScene!==!0&&(Te=te);const Ne=N.get(Z);Ne.__version=Z.version;const We=Ue.state.lights,gt=Ue.state.shadowsArray,vt=We.state.version,Rt=Eo(Le,Z,Ue);Ne.planeReflProbe=Rt;const Lt=re.getParameters(Z,We.state,gt,Te,Le,Rt),zt=re.getProgramCacheKey(Lt);let Sn=Ne.programs;Ne.environment=Z.isMeshNodeMaterial||Z.isMeshStandardMaterial?Te.environment:null,Ne.fog=Te.fog,Ne.envMap=(Z.isMeshNodeMaterial||Z.isMeshStandardMaterial?fe:ce).get(Z.envMap||Ne.environment),Ne.useGTAO=_.canUseGTAO()&&Z.isMeshNodeMaterial&&Z.canUseGTAO(),Sn===void 0&&(Z.addEventListener("dispose",Mr),Sn=new Map,Ne.programs=Sn);let Dt=Sn.get(zt);if(Dt!==void 0){if(Ne.currentProgram===Dt&&Ne.lightsStateVersion===vt)return bl(Z,Lt),Dt}else Lt.uniforms=re.getUniforms(Z),Z.onBuild(Le,Lt,_),Z.onBeforeCompile(Lt,_),Dt=re.acquireProgram(Lt,zt),Sn.set(zt,Dt),I.numShaderCompiles=re.getNumShaderCompiles(),Ne.uniforms=Lt.uniforms;const ht=Ne.uniforms;if((Z.isShaderMaterial||Z.isRawShaderMaterial)&&Z.clipping!==!0||Z.defines.WORLD_NODES||(ht.clippingPlanes=we.uniform),bl(Z,Lt),Ne.needsLights=function(on){return on.isMeshNodeMaterial||on.isMeshLambertMaterial||on.isMeshStandardMaterial||on.isShadowMaterial||on.isShaderMaterial&&on.lights===!0}(Z),Ne.lightsStateVersion=vt,Ne.needsLights&&(ht.ambientLightColor.value=We.state.ambient,ht.lightProbe.value=We.state.probe,ht.directionalLights.value=We.state.directional,ht.spotLights.value=We.state.spot,ht.spotLightShadows.value=We.state.spotShadow,ht.rectAreaLights.value=We.state.rectArea,ht.ltc_1.value=We.state.rectAreaLTC1,ht.ltc_2.value=We.state.rectAreaLTC2,ht.pointLights.value=We.state.point,ht.pointLightShadows.value=We.state.pointShadow,ht.hemisphereLights.value=We.state.hemi,ht.spotShadowMap.value=We.state.spotShadowMap,ht.spotShadowMatrix.value=We.state.spotShadowMatrix,ht.pointShadowMap.value=We.state.pointShadowMap,ht.pointShadowMatrix.value=We.state.pointShadowMatrix,ht.rectAreaLightShadows.value=We.state.rectAreaShadow,ht.rectAreaShadowMap.value=We.state.rectAreaShadowMap,ht.rectAreaShadowMatrix.value=We.state.rectAreaShadowMatrix,ht.directionalLightShadowsCSM.value=We.state.directionalShadowCSM,ht.directionalShadowCSMMap.value=We.state.directionalShadowCSMMap,ht.directionalShadowCSMMatrix.value=We.state.directionalShadowCSMMatrix,ht.directionalLightShadowsCSMCascade.value=We.state.directionalShadowCSMCascade),Z.isMeshNodeMaterial){ht.nodeRGB.value!==4*Z.nodeRGB.length&&(ht.nodeRGB.value=new Float32Array(4*Z.nodeRGB.length)),ht.nodeValue.value.length!==Z.nodeValue.length&&(ht.nodeValue.value=new Float32Array(Z.nodeValue.length));for(const on in Z.nodeInputs){const so=`nodeInputs${ug(on)}`;ht[so].value.length!==Z.nodeInputs[on]&&(ht[so].value=Z.nodeInputs[on])}Ne.nodeTexCoordObjectMatrices&&Ne.nodeTexCoordObjectMatrices.length===16*Z.nodeTexCoordObject.length||(Ne.nodeTexCoordObjectMatrices=new Float32Array(16*Z.nodeTexCoordObject.length))}else Ne.nodeTexCoordObjectMatrices=new Float32Array(0);return Ne.currentProgram=Dt,Ne.uniformsList=null,Dt}function yl(Z){if(Z.uniformsList===null){const Te=Z.currentProgram.getUniforms();Z.uniformsList=fg.seqWithValue(Te.seq,Z.uniforms)}return Z.uniformsList}function bl(Z,Te){const Le=N.get(Z);Le.outputEncoding=Te.outputEncoding,Le.instancing=Te.instancing,Le.skinning=Te.skinning,Le.morphTargets=Te.morphTargets,Le.morphNormals=Te.morphNormals,Le.morphColors=Te.morphColors,Le.morphTargetsCount=Te.morphTargetsCount,Le.numClippingPlanes=Te.numClippingPlanes,Le.numIntersection=Te.numClipIntersection,Le.vertexAlphas=Te.vertexAlphas,Le.vertexTangents=Te.vertexTangents,Le.toneMapping=Te.toneMapping,Le.flipSided=Te.flipSided}function Eo(Z,Te,Le){return(Te.isMeshNodeMaterial||Te.isMeshStandardMaterial)&&Le.state.planeReflProbeArray.find(Ue=>Ue.intersectsMesh(Z))||null}ga.setAnimationLoop(function(Z){Xn&&Xn(Z)}),typeof self<"u"&&ga.setContext(self),this.setAnimationLoop=function(Z){Xn=Z,Nt.setAnimationLoop(Z),Z===null?ga.stop():ga.start()},Nt.addEventListener("sessionstart",gn),Nt.addEventListener("sessionend",Wa),this.render=function(Z,Te){if(Te!==void 0&&Te.isCamera!==!0)return void console.error("v3d.WebGLRenderer.render: camera is not an instance of v3d.Camera.");if(x===!0)return;Z.matrixWorldAutoUpdate===!0&&Z.updateMatrixWorld(),Te.parent===null&&Te.matrixWorldAutoUpdate===!0&&Te.updateMatrixWorld(),Nt.enabled===!0&&Nt.isPresenting===!0&&(Nt.cameraAutoUpdate===!0&&Nt.updateCamera(Te),Te=Nt.getCamera()),Z.isScene===!0&&Z.onBeforeRender(_,Z,Te,y),m=Ce.get(Z,A.length),m.init(),A.push(m),k.multiplyMatrices(Te.projectionMatrix,Te.matrixWorldInverse),oe.setFromProjectionMatrix(k),L=this.localClippingEnabled,ie=we.init(this.clippingPlanes,L,Te),f=pe.get(Z,g.length),f.init(),g.push(f),xl(Z,Te,0,_.sortObjects),f.finish(),_.sortObjects===!0&&f.sort(q,ne),ie===!0&&we.beginShadows();const Le=m.state.shadowsArray;if(be.render(Le,Z,Te),ie===!0&&we.endShadows(),this.info.render.frame++,Pe.render(f,Z),m.setupLights(),m.sortEnvMapProbes(),Te.isArrayCamera){const Ue=Te.cameras;for(let Ne=0,We=Ue.length;Ne<We;Ne++){const gt=Ue[Ne];So(f,Z,gt,gt.viewport)}}else So(f,Z,Te);y!==null&&(se.updateMultisampleRenderTarget(y),se.updateRenderTargetMipmap(y)),Z.isScene===!0&&Z.onAfterRender(_,Z,Te),$t.resetDefaultState(),M=-1,R=null,A.pop(),m=A.length>0?A[A.length-1]:null,g.pop(),f=g.length>0?g[g.length-1]:null},this.getActiveCubeFace=function(){return C},this.getActiveMipmapLevel=function(){return b},this.getRenderTarget=function(){return y},this.setRenderTargetTextures=function(Z,Te,Le){N.get(Z.texture).__webglTexture=Te,N.get(Z.depthTexture).__webglTexture=Le;const Ue=N.get(Z);Ue.__hasExternalTextures=!0,Ue.__hasExternalTextures&&(Ue.__autoAllocateDepthBuffer=Le===void 0,Ue.__autoAllocateDepthBuffer||Y.has("WEBGL_multisampled_render_to_texture")===!0&&(console.warn("v3d.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),Ue.__useRenderToTexture=!1))},this.setRenderTargetFramebuffer=function(Z,Te){const Le=N.get(Z);Le.__webglFramebuffer=Te,Le.__useDefaultFramebuffer=Te===void 0},this.setRenderTarget=function(Z,Te=0,Le=0){y=Z,C=Te,b=Le;let Ue=!0,Ne=null,We=!1,gt=!1;if(Z){const vt=N.get(Z);vt.__useDefaultFramebuffer!==void 0?(Q.bindFramebuffer(36160,null),Ue=!1):vt.__webglFramebuffer===void 0?se.setupRenderTarget(Z):vt.__hasExternalTextures&&se.rebindTextures(Z,N.get(Z.texture).__webglTexture,N.get(Z.depthTexture).__webglTexture);const Rt=Z.texture;(Rt.isData3DTexture||Rt.isDataArrayTexture||Rt.isCompressedArrayTexture)&&(gt=!0);const Lt=N.get(Z).__webglFramebuffer;Z.isWebGLCubeRenderTarget?(Ne=Lt[Te],We=!0):Ne=P.isWebGL2&&Z.samples>0&&se.useMultisampledRTT(Z)===!1?N.get(Z).__webglMultisampledFramebuffer:Lt,T.copy(Z.viewport),w.copy(Z.scissor),D=Z.scissorTest}else T.copy($).multiplyScalar(O).floor(),w.copy(he).multiplyScalar(O).floor(),D=K;if(Q.bindFramebuffer(36160,Ne)&&P.drawBuffers&&Ue&&Q.drawBuffers(Z,Ne),Q.viewport(T),Q.scissor(w),Q.setScissorTest(D),We){const vt=N.get(Z.texture);De.framebufferTexture2D(36160,36064,34069+Te,vt.__webglTexture,Le)}else if(gt){const vt=N.get(Z.texture),Rt=Te||0;De.framebufferTextureLayer(36160,36064,vt.__webglTexture,Le||0,Rt)}M=-1},this.readRenderTargetPixels=function(Z,Te,Le,Ue,Ne,We,gt){if(!Z||!Z.isWebGLRenderTarget)return void console.error("v3d.WebGLRenderer.readRenderTargetPixels: renderTarget is not v3d.WebGLRenderTarget.");let vt=N.get(Z).__webglFramebuffer;if(Z.isWebGLCubeRenderTarget&&gt!==void 0&&(vt=vt[gt]),vt){Q.bindFramebuffer(36160,vt);try{const Rt=Z.texture,Lt=Rt.format,zt=Rt.type;if(Lt!==1023&&Pt.convert(Lt)!==De.getParameter(35739))return void console.error("v3d.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");const Sn=zt===1016&&(Y.has("EXT_color_buffer_half_float")||P.isWebGL2&&Y.has("EXT_color_buffer_float"));if(!(zt===1009||Pt.convert(zt)===De.getParameter(35738)||zt===1015&&(P.isWebGL2||Y.has("OES_texture_float")||Y.has("WEBGL_color_buffer_float"))||Sn))return void console.error("v3d.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");Te>=0&&Te<=Z.width-Ue&&Le>=0&&Le<=Z.height-Ne&&De.readPixels(Te,Le,Ue,Ne,Pt.convert(Lt),Pt.convert(zt),We)}finally{const Rt=y!==null?N.get(y).__webglFramebuffer:null;Q.bindFramebuffer(36160,Rt)}}},this.copyFramebufferToTexture=function(Z,Te,Le=0){const Ue=Math.pow(2,-Le),Ne=Math.floor(Te.image.width*Ue),We=Math.floor(Te.image.height*Ue);se.setTexture2D(Te,0),De.copyTexSubImage2D(3553,Le,0,0,Z.x,Z.y,Ne,We),Q.unbindTexture()},this.copyTextureToTexture=function(Z,Te,Le,Ue=0){const Ne=Te.image.width,We=Te.image.height,gt=Pt.convert(Le.format),vt=Pt.convert(Le.type);se.setTexture2D(Le,0),De.pixelStorei(37440,Le.flipY),De.pixelStorei(37441,Le.premultiplyAlpha),De.pixelStorei(3317,Le.unpackAlignment),Te.isDataTexture?De.texSubImage2D(3553,Ue,Z.x,Z.y,Ne,We,gt,vt,Te.image.data):Te.isCompressedTexture?De.compressedTexSubImage2D(3553,Ue,Z.x,Z.y,Te.mipmaps[0].width,Te.mipmaps[0].height,gt,Te.mipmaps[0].data):De.texSubImage2D(3553,Ue,Z.x,Z.y,gt,vt,Te.image),Ue===0&&Le.generateMipmaps&&De.generateMipmap(3553),Q.unbindTexture()},this.copyTextureToTexture3D=function(Z,Te,Le,Ue,Ne=0){if(!P.isWebGL2)return void console.warn("v3d.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");const We=Z.max.x-Z.min.x+1,gt=Z.max.y-Z.min.y+1,vt=Z.max.z-Z.min.z+1,Rt=Pt.convert(Ue.format),Lt=Pt.convert(Ue.type);let zt;if(Ue.isData3DTexture)se.setTexture3D(Ue,0),zt=32879;else{if(!Ue.isDataArrayTexture)return void console.warn("v3d.WebGLRenderer.copyTextureToTexture3D: only supports v3d.DataTexture3D and v3d.DataTexture2DArray.");se.setTexture2DArray(Ue,0),zt=35866}De.pixelStorei(37440,Ue.flipY),De.pixelStorei(37441,Ue.premultiplyAlpha),De.pixelStorei(3317,Ue.unpackAlignment);const Sn=De.getParameter(3314),Dt=De.getParameter(32878),ht=De.getParameter(3316),on=De.getParameter(3315),so=De.getParameter(32877),Ot=Le.isCompressedTexture?Le.mipmaps[0]:Le.image;De.pixelStorei(3314,Ot.width),De.pixelStorei(32878,Ot.height),De.pixelStorei(3316,Z.min.x),De.pixelStorei(3315,Z.min.y),De.pixelStorei(32877,Z.min.z),Le.isDataTexture||Le.isData3DTexture?De.texSubImage3D(zt,Ne,Te.x,Te.y,Te.z,We,gt,vt,Rt,Lt,Ot.data):Le.isCompressedArrayTexture?(console.warn("v3d.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),De.compressedTexSubImage3D(zt,Ne,Te.x,Te.y,Te.z,We,gt,vt,Rt,Ot.data)):De.texSubImage3D(zt,Ne,Te.x,Te.y,Te.z,We,gt,vt,Rt,Lt,Ot),De.pixelStorei(3314,Sn),De.pixelStorei(32878,Dt),De.pixelStorei(3316,ht),De.pixelStorei(3315,on),De.pixelStorei(32877,so),Ne===0&&Ue.generateMipmaps&&De.generateMipmap(zt),Q.unbindTexture()},this.initTexture=function(Z){Z.isCubeTexture?se.setTextureCube(Z,0):Z.isData3DTexture?se.setTexture3D(Z,0):Z.isDataArrayTexture||Z.isCompressedArrayTexture?se.setTexture2DArray(Z,0):se.setTexture2D(Z,0),Q.unbindTexture()},this.resetState=function(){C=0,b=0,y=null,Q.reset(),$t.reset()},typeof __V3D_DEVTOOLS__<"u"&&__V3D_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this})),this.updateGeometry=function(Z){return Ie.update(Z)},this.setOIT=function(Z,Te){this.oitRenderer.setSize(z,F),this.oitRenderer.texType=Pt.convert(1016)!==null?1016:1009;let Le=Te||(a===!0?4:0);this.oitRenderer.isMethodCompatible(Z,P)?this.oitRenderer.setMethod(Z,Le):console.log("v3d.WebGLRenderer: the OIT method is not compatible.")},this.getOIT=function(){return this.oitRenderer.method},Object.defineProperty(this,"useOIT",{get:function(){return X},set:function(Z){this.setTransparentSort(Z?function(){}:null),X=Z}})}class Yy{constructor(e,t=25e-5){this.isFogExp2=!0,this.name="",this.color=new Qe(e),this.density=t}clone(){return new Yy(this.color,this.density)}}class jy{constructor(e,t=1,n=1e3){this.isFog=!0,this.name="",this.color=new Qe(e),this.near=t,this.far=n}clone(){return new jy(this.color,this.near,this.far)}}class mp{constructor(e,t){this.isInterleavedBuffer=!0,this.array=e,this.stride=t,this.count=e!==void 0?e.length/t:0,this.usage=35044,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=Wo()}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,t,n){e*=this.stride,n*=t.stride;for(let r=0,a=this.stride;r<a;r++)this.array[e+r]=t.array[n+r];return this}set(e,t=0){return this.array.set(e,t),this}clone(e){e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=Wo()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const t=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),n=new this.constructor(t,this.stride);return n.setUsage(this.usage),n}onUpload(e){return this.onUploadCallback=e,this}}const Zr=new B;class Lc{constructor(e,t,n,r=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=e,this.itemSize=t,this.offset=n,this.normalized=r}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let t=0,n=this.data.count;t<n;t++)Zr.fromBufferAttribute(this,t),Zr.applyMatrix4(e),this.setXYZ(t,Zr.x,Zr.y,Zr.z);return this}applyNormalMatrix(e){for(let t=0,n=this.count;t<n;t++)Zr.fromBufferAttribute(this,t),Zr.applyNormalMatrix(e),this.setXYZ(t,Zr.x,Zr.y,Zr.z);return this}transformDirection(e){for(let t=0,n=this.count;t<n;t++)Zr.fromBufferAttribute(this,t),Zr.transformDirection(e),this.setXYZ(t,Zr.x,Zr.y,Zr.z);return this}setX(e,t){return this.normalized&&(t=cn(t,this.array)),this.data.array[e*this.data.stride+this.offset]=t,this}setY(e,t){return this.normalized&&(t=cn(t,this.array)),this.data.array[e*this.data.stride+this.offset+1]=t,this}setZ(e,t){return this.normalized&&(t=cn(t,this.array)),this.data.array[e*this.data.stride+this.offset+2]=t,this}setW(e,t){return this.normalized&&(t=cn(t,this.array)),this.data.array[e*this.data.stride+this.offset+3]=t,this}getX(e){let t=this.data.array[e*this.data.stride+this.offset];return this.normalized&&(t=is(t,this.array)),t}getY(e){let t=this.data.array[e*this.data.stride+this.offset+1];return this.normalized&&(t=is(t,this.array)),t}getZ(e){let t=this.data.array[e*this.data.stride+this.offset+2];return this.normalized&&(t=is(t,this.array)),t}getW(e){let t=this.data.array[e*this.data.stride+this.offset+3];return this.normalized&&(t=is(t,this.array)),t}setXY(e,t,n){return e=e*this.data.stride+this.offset,this.normalized&&(t=cn(t,this.array),n=cn(n,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=n,this}setXYZ(e,t,n,r){return e=e*this.data.stride+this.offset,this.normalized&&(t=cn(t,this.array),n=cn(n,this.array),r=cn(r,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=r,this}setXYZW(e,t,n,r,a){return e=e*this.data.stride+this.offset,this.normalized&&(t=cn(t,this.array),n=cn(n,this.array),r=cn(r,this.array),a=cn(a,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=r,this.data.array[e+3]=a,this}clone(e){if(e===void 0){console.log("v3d.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");const t=[];for(let n=0;n<this.count;n++){const r=n*this.data.stride+this.offset;for(let a=0;a<this.itemSize;a++)t.push(this.data.array[r+a])}return new $e(new this.array.constructor(t),this.itemSize,this.normalized)}return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new Lc(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}}class Xy extends Er{constructor(e){super(),this.isSpriteMaterial=!0,this.type="SpriteMaterial",this.color=new Qe(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}let wu;const Of=new B,Tu=new B,Ru=new B,Iu=new Ee,Ff=new Ee,I5=new Ve,Km=new B,Uf=new B,$m=new B,kM=new Ee,OA=new Ee,GM=new Ee;class L5 extends Tt{constructor(e){if(super(),this.isSprite=!0,this.type="Sprite",wu===void 0){wu=new mt;const t=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),n=new mp(t,5);wu.setIndex([0,1,2,0,2,3]),wu.setAttribute("position",new Lc(n,3,0,!1)),wu.setAttribute("uv",new Lc(n,2,3,!1))}this.geometry=wu,this.material=e!==void 0?e:new Xy,this.center=new Ee(.5,.5)}raycast(e,t){if(e.camera===null)return void console.error('v3d.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.');Tu.setFromMatrixScale(this.matrixWorld),I5.copy(e.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld),Ru.setFromMatrixPosition(this.modelViewMatrix),e.camera.isPerspectiveCamera&&this.material.sizeAttenuation===!1&&Tu.multiplyScalar(-Ru.z);const n=this.material.rotation;let r,a;n!==0&&(a=Math.cos(n),r=Math.sin(n));const i=this.center;Jm(Km.set(-.5,-.5,0),Ru,i,Tu,r,a),Jm(Uf.set(.5,-.5,0),Ru,i,Tu,r,a),Jm($m.set(.5,.5,0),Ru,i,Tu,r,a),kM.set(0,0),OA.set(1,0),GM.set(1,1);let s=e.ray.intersectTriangle(Km,Uf,$m,!1,Of);if(s===null&&(Jm(Uf.set(-.5,.5,0),Ru,i,Tu,r,a),OA.set(0,1),s=e.ray.intersectTriangle(Km,$m,Uf,!1,Of),s===null))return;const c=e.ray.origin.distanceTo(Of);c<e.near||c>e.far||t.push({distance:c,point:Of.clone(),uv:Cr.getInterpolation(Of,Km,Uf,$m,kM,OA,GM,new Ee),face:null,object:this})}copy(e,t){return super.copy(e,t),e.center!==void 0&&this.center.copy(e.center),this.material=e.material,this}}function Jm(o,e,t,n,r,a){Iu.subVectors(o,t).addScalar(.5).multiply(n),r!==void 0?(Ff.x=a*Iu.x-r*Iu.y,Ff.y=r*Iu.x+a*Iu.y):Ff.copy(Iu),o.copy(e),o.x+=Ff.x,o.y+=Ff.y,o.applyMatrix4(I5)}const e0=new B,QM=new B;class GJ extends Tt{constructor(){super(),this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]},isLOD:{value:!0}}),this.autoUpdate=!0}copy(e){super.copy(e,!1);const t=e.levels;for(let n=0,r=t.length;n<r;n++){const a=t[n];this.addLevel(a.object.clone(),a.distance,a.hysteresis)}return this.autoUpdate=e.autoUpdate,this}addLevel(e,t=0,n=0){t=Math.abs(t);const r=this.levels;let a;for(a=0;a<r.length&&!(t<r[a].distance);a++);return r.splice(a,0,{distance:t,hysteresis:n,object:e}),this.add(e),this}getCurrentLevel(){return this._currentLevel}getObjectForDistance(e){const t=this.levels;if(t.length>0){let n,r;for(n=1,r=t.length;n<r;n++){let a=t[n].distance;if(t[n].object.visible&&(a-=a*t[n].hysteresis),e<a)break}return t[n-1].object}return null}raycast(e,t){if(this.levels.length>0){e0.setFromMatrixPosition(this.matrixWorld);const n=e.ray.origin.distanceTo(e0);this.getObjectForDistance(n).raycast(e,t)}}update(e){const t=this.levels;if(t.length>1){e0.setFromMatrixPosition(e.matrixWorld),QM.setFromMatrixPosition(this.matrixWorld);const n=e0.distanceTo(QM)/e.zoom;let r,a;for(t[0].object.visible=!0,r=1,a=t.length;r<a;r++){let i=t[r].distance;if(t[r].object.visible&&(i-=i*t[r].hysteresis),!(n>=i))break;t[r-1].object.visible=!1,t[r].object.visible=!0}for(this._currentLevel=r-1;r<a;r++)t[r].object.visible=!1}}}const HM=new B,WM=new ct,YM=new ct,QJ=new B,jM=new Ve;class Hg extends Mt{constructor(e,t){super(e,t),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new Ve,this.bindMatrixInverse=new Ve,this.normalizeSkinWeights()}copy(e,t){return super.copy(e,t),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,this}bind(e,t){this.skeleton=e,t===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.copy(t).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const e=new ct,t=this.geometry.attributes.skinWeight;for(let n=0,r=t.count;n<r;n++){e.fromBufferAttribute(t,n);const a=1/e.manhattanLength();a!==1/0?e.multiplyScalar(a):e.set(1,0,0,0),t.setXYZW(n,e.x,e.y,e.z,e.w)}}updateMatrixWorld(e){super.updateMatrixWorld(e),this.bindMode==="attached"?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode==="detached"?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("v3d.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}boneTransform(e,t){const n=this.skeleton,r=this.geometry;WM.fromBufferAttribute(r.attributes.skinIndex,e),YM.fromBufferAttribute(r.attributes.skinWeight,e),HM.copy(t).applyMatrix4(this.bindMatrix),t.set(0,0,0);for(let a=0;a<4;a++){const i=YM.getComponent(a);if(i!==0){const s=WM.getComponent(a);jM.multiplyMatrices(n.bones[s].matrixWorld,n.boneInverses[s]),t.addScaledVector(QJ.copy(HM).applyMatrix4(jM),i)}}return t.applyMatrix4(this.bindMatrixInverse)}}class B5 extends Tt{constructor(){super(),this.isBone=!0,this.type="Bone"}}class ss extends In{constructor(e=null,t=1,n=1,r,a,i,s,c,u=1003,h=1003,f,m){super(null,i,s,c,u,h,r,a,f,m),this.isDataTexture=!0,this.image={data:e,width:t,height:n},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}const XM=new Ve,HJ=new Ve;class Ev{constructor(e=[],t=[]){this.uuid=Wo(),this.bones=e.slice(0),this.boneInverses=t,this.boneMatrices=null,this.boneTexture=null,this.boneTextureSize=0,this.frame=-1,this.init()}init(){const e=this.bones,t=this.boneInverses;if(this.boneMatrices=new Float32Array(16*e.length),t.length===0)this.calculateInverses();else if(e.length!==t.length){console.warn("v3d.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let n=0,r=this.bones.length;n<r;n++)this.boneInverses.push(new Ve)}}calculateInverses(){this.boneInverses.length=0;for(let e=0,t=this.bones.length;e<t;e++){const n=new Ve;this.bones[e]&&n.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(n)}}pose(){for(let e=0,t=this.bones.length;e<t;e++){const n=this.bones[e];n&&n.matrixWorld.copy(this.boneInverses[e]).invert()}for(let e=0,t=this.bones.length;e<t;e++){const n=this.bones[e];n&&(n.parent&&n.parent.isBone?(n.matrix.copy(n.parent.matrixWorld).invert(),n.matrix.multiply(n.matrixWorld)):n.matrix.copy(n.matrixWorld),n.matrix.decompose(n.position,n.quaternion,n.scale))}}update(){const e=this.bones,t=this.boneInverses,n=this.boneMatrices,r=this.boneTexture;for(let a=0,i=e.length;a<i;a++){const s=e[a]?e[a].matrixWorld:HJ;XM.multiplyMatrices(s,t[a]),XM.toArray(n,16*a)}r!==null&&(r.needsUpdate=!0)}clone(){return new Ev(this.bones,this.boneInverses)}computeBoneTexture(){let e=Math.sqrt(4*this.bones.length);e=c5(e),e=Math.max(e,4);const t=new Float32Array(e*e*4);t.set(this.boneMatrices);const n=new ss(t,e,e,1023,1015);return n.name="Skeleton.bone",n.needsUpdate=!0,this.boneMatrices=t,this.boneTexture=n,this.boneTextureSize=e,this}getBoneByName(e){for(let t=0,n=this.bones.length;t<n;t++){const r=this.bones[t];if(r.name===e)return r}}dispose(){this.boneTexture!==null&&(this.boneTexture.dispose(),this.boneTexture=null)}}let S2=class extends $e{constructor(o,e,t,n=1){super(o,e,t),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=n}copy(o){return super.copy(o),this.meshPerAttribute=o.meshPerAttribute,this}};const qM=new Ve,ZM=new Ve,t0=[],WJ=new Ve,zf=new Mt;class YJ extends Mt{constructor(e,t,n){super(e,t),this.isInstancedMesh=!0,this.instanceMatrix=new S2(new Float32Array(16*n),16),this.instanceColor=null,this.count=n,this.frustumCulled=!1;for(let r=0;r<n;r++)this.setMatrixAt(r,WJ)}copy(e,t){return super.copy(e,t),this.instanceMatrix.copy(e.instanceMatrix),e.instanceColor!==null&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,this}getColorAt(e,t){t.fromArray(this.instanceColor.array,3*e)}getMatrixAt(e,t){t.fromArray(this.instanceMatrix.array,16*e)}raycast(e,t){const n=this.matrixWorld,r=this.count;if(zf.geometry=this.geometry,zf.material=this.material,zf.material!==void 0)for(let a=0;a<r;a++){this.getMatrixAt(a,qM),ZM.multiplyMatrices(n,qM),zf.matrixWorld=ZM,zf.raycast(e,t0);for(let i=0,s=t0.length;i<s;i++){const c=t0[i];c.instanceId=a,c.object=this,t.push(c)}t0.length=0}}setColorAt(e,t){this.instanceColor===null&&(this.instanceColor=new S2(new Float32Array(3*this.instanceMatrix.count),3)),t.toArray(this.instanceColor.array,3*e)}setMatrixAt(e,t){t.toArray(this.instanceMatrix.array,16*e)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"})}}class gr extends Er{constructor(e){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new Qe(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.fog=e.fog,this}}const KM=new B,$M=new B,JM=new Ve,FA=new Td,n0=new Yo;class vi extends Tt{constructor(e=new mt,t=new gr){super(),this.isLine=!0,this.type="Line",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=e.material,this.geometry=e.geometry,this}computeLineDistances(){const e=this.geometry;if(e.index===null){const t=e.attributes.position,n=[0];for(let r=1,a=t.count;r<a;r++)KM.fromBufferAttribute(t,r-1),$M.fromBufferAttribute(t,r),n[r]=n[r-1],n[r]+=KM.distanceTo($M);e.setAttribute("lineDistance",new ut(n,1))}else console.warn("v3d.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(e,t){const n=this.geometry,r=this.matrixWorld,a=e.params.Line.threshold,i=n.drawRange;if(n.boundingSphere===null&&n.computeBoundingSphere(),n0.copy(n.boundingSphere),n0.applyMatrix4(r),n0.radius+=a,e.ray.intersectsSphere(n0)===!1)return;JM.copy(r).invert(),FA.copy(e.ray).applyMatrix4(JM);const s=a/((this.scale.x+this.scale.y+this.scale.z)/3),c=s*s,u=new B,h=new B,f=new B,m=new B,g=this.isLineSegments?2:1,A=n.index,_=n.attributes.position;if(A!==null)for(let x=Math.max(0,i.start),C=Math.min(A.count,i.start+i.count)-1;x<C;x+=g){const b=A.getX(x),y=A.getX(x+1);if(u.fromBufferAttribute(_,b),h.fromBufferAttribute(_,y),FA.distanceSqToSegment(u,h,m,f)>c)continue;m.applyMatrix4(this.matrixWorld);const M=e.ray.origin.distanceTo(m);M<e.near||M>e.far||t.push({distance:M,point:f.clone().applyMatrix4(this.matrixWorld),index:x,face:null,faceIndex:null,object:this})}else for(let x=Math.max(0,i.start),C=Math.min(_.count,i.start+i.count)-1;x<C;x+=g){if(u.fromBufferAttribute(_,x),h.fromBufferAttribute(_,x+1),FA.distanceSqToSegment(u,h,m,f)>c)continue;m.applyMatrix4(this.matrixWorld);const b=e.ray.origin.distanceTo(m);b<e.near||b>e.far||t.push({distance:b,point:f.clone().applyMatrix4(this.matrixWorld),index:x,face:null,faceIndex:null,object:this})}}updateMorphTargets(){const e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){const n=e[t[0]];if(n!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let r=0,a=n.length;r<a;r++){const i=n[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[i]=r}}}}}const ew=new B,tw=new B;class jo extends vi{constructor(e,t){super(e,t),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const e=this.geometry;if(e.index===null){const t=e.attributes.position,n=[];for(let r=0,a=t.count;r<a;r+=2)ew.fromBufferAttribute(t,r),tw.fromBufferAttribute(t,r+1),n[r]=r===0?0:n[r-1],n[r+1]=n[r]+ew.distanceTo(tw);e.setAttribute("lineDistance",new ut(n,1))}else console.warn("v3d.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class P5 extends vi{constructor(e,t){super(e,t),this.isLineLoop=!0,this.type="LineLoop"}}class qy extends Er{constructor(e){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new Qe(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}const nw=new Ve,C2=new Td,r0=new Yo,o0=new B;class N5 extends Tt{constructor(e=new mt,t=new qy){super(),this.isPoints=!0,this.type="Points",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=e.material,this.geometry=e.geometry,this}raycast(e,t){const n=this.geometry,r=this.matrixWorld,a=e.params.Points.threshold,i=n.drawRange;if(n.boundingSphere===null&&n.computeBoundingSphere(),r0.copy(n.boundingSphere),r0.applyMatrix4(r),r0.radius+=a,e.ray.intersectsSphere(r0)===!1)return;nw.copy(r).invert(),C2.copy(e.ray).applyMatrix4(nw);const s=a/((this.scale.x+this.scale.y+this.scale.z)/3),c=s*s,u=n.index,h=n.attributes.position;if(u!==null)for(let f=Math.max(0,i.start),m=Math.min(u.count,i.start+i.count);f<m;f++){const g=u.getX(f);o0.fromBufferAttribute(h,g),rw(o0,g,c,r,e,t,this)}else for(let f=Math.max(0,i.start),m=Math.min(h.count,i.start+i.count);f<m;f++)o0.fromBufferAttribute(h,f),rw(o0,f,c,r,e,t,this)}updateMorphTargets(){const e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){const n=e[t[0]];if(n!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let r=0,a=n.length;r<a;r++){const i=n[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[i]=r}}}}}function rw(o,e,t,n,r,a,i){const s=C2.distanceSqToPoint(o);if(s<t){const c=new B;C2.closestPointToPoint(o,c),c.applyMatrix4(n);const u=r.ray.origin.distanceTo(c);if(u<r.near||u>r.far)return;a.push({distance:u,distanceToRay:Math.sqrt(s),point:c,index:e,face:null,object:i})}}class jJ extends In{constructor(e,t,n,r,a,i,s,c,u){super(e,t,n,r,a,i,s,c,u),this.isVideoTexture=!0,this.minFilter=i!==void 0?i:1006,this.magFilter=a!==void 0?a:1006,this.generateMipmaps=!1;const h=this;"requestVideoFrameCallback"in e&&e.requestVideoFrameCallback(function f(){h.needsUpdate=!0,e.requestVideoFrameCallback(f)})}clone(){return new this.constructor(this.image).copy(this)}update(){const e=this.image;!("requestVideoFrameCallback"in e)&&e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}class XJ extends In{constructor(e,t,n){super({width:e,height:t}),this.isFramebufferTexture=!0,this.format=n,this.magFilter=1003,this.minFilter=1003,this.generateMipmaps=!1,this.needsUpdate=!0}}class il extends In{constructor(e,t,n,r,a,i,s,c,u,h,f,m){super(null,i,s,c,u,h,r,a,f,m),this.isCompressedTexture=!0,this.image={width:t,height:n},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}}class qJ extends il{constructor(e,t,n,r,a,i){super(e,t,n,a,i),this.isCompressedArrayTexture=!0,this.image.depth=r,this.wrapR=1001}}class D5 extends In{constructor(e,t,n,r,a,i,s,c,u){super(e,t,n,r,a,i,s,c,u),this.isCanvasTexture=!0,this.needsUpdate=!0}}class Ha{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("v3d.Curve: .getPoint() not implemented."),null}getPointAt(e,t){const n=this.getUtoTmapping(e);return this.getPoint(n,t)}getPoints(e=5){const t=[];for(let n=0;n<=e;n++)t.push(this.getPoint(n/e));return t}getSpacedPoints(e=5){const t=[];for(let n=0;n<=e;n++)t.push(this.getPointAt(n/e));return t}getLength(){const e=this.getLengths();return e[e.length-1]}getLengths(e=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const t=[];let n,r=this.getPoint(0),a=0;t.push(0);for(let i=1;i<=e;i++)n=this.getPoint(i/e),a+=n.distanceTo(r),t.push(a),r=n;return this.cacheArcLengths=t,t}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e,t){const n=this.getLengths();let r=0;const a=n.length;let i;i=t||e*n[a-1];let s,c=0,u=a-1;for(;c<=u;)if(r=Math.floor(c+(u-c)/2),s=n[r]-i,s<0)c=r+1;else{if(!(s>0)){u=r;break}u=r-1}if(r=u,n[r]===i)return r/(a-1);const h=n[r];return(r+(i-h)/(n[r+1]-h))/(a-1)}getTangent(e,t){let r=e-1e-4,a=e+1e-4;r<0&&(r=0),a>1&&(a=1);const i=this.getPoint(r),s=this.getPoint(a),c=t||(i.isVector2?new Ee:new B);return c.copy(s).sub(i).normalize(),c}getTangentAt(e,t){const n=this.getUtoTmapping(e);return this.getTangent(n,t)}computeFrenetFrames(e,t){const n=new B,r=[],a=[],i=[],s=new B,c=new Ve;for(let g=0;g<=e;g++){const A=g/e;r[g]=this.getTangentAt(A,new B)}a[0]=new B,i[0]=new B;let u=Number.MAX_VALUE;const h=Math.abs(r[0].x),f=Math.abs(r[0].y),m=Math.abs(r[0].z);h<=u&&(u=h,n.set(1,0,0)),f<=u&&(u=f,n.set(0,1,0)),m<=u&&n.set(0,0,1),s.crossVectors(r[0],n).normalize(),a[0].crossVectors(r[0],s),i[0].crossVectors(r[0],a[0]);for(let g=1;g<=e;g++){if(a[g]=a[g-1].clone(),i[g]=i[g-1].clone(),s.crossVectors(r[g-1],r[g]),s.length()>Number.EPSILON){s.normalize();const A=Math.acos(Ft(r[g-1].dot(r[g]),-1,1));a[g].applyMatrix4(c.makeRotationAxis(s,A))}i[g].crossVectors(r[g],a[g])}if(t===!0){let g=Math.acos(Ft(a[0].dot(a[e]),-1,1));g/=e,r[0].dot(s.crossVectors(a[0],a[e]))>0&&(g=-g);for(let A=1;A<=e;A++)a[A].applyMatrix4(c.makeRotationAxis(r[A],g*A)),i[A].crossVectors(r[A],a[A])}return{tangents:r,normals:a,binormals:i}}clone(){return new this.constructor().copy(this)}copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}class Zy extends Ha{constructor(e=0,t=0,n=1,r=1,a=0,i=2*Math.PI,s=!1,c=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=e,this.aY=t,this.xRadius=n,this.yRadius=r,this.aStartAngle=a,this.aEndAngle=i,this.aClockwise=s,this.aRotation=c}getPoint(e,t){const n=t||new Ee,r=2*Math.PI;let a=this.aEndAngle-this.aStartAngle;const i=Math.abs(a)<Number.EPSILON;for(;a<0;)a+=r;for(;a>r;)a-=r;a<Number.EPSILON&&(a=i?0:r),this.aClockwise!==!0||i||(a===r?a=-r:a-=r);const s=this.aStartAngle+e*a;let c=this.aX+this.xRadius*Math.cos(s),u=this.aY+this.yRadius*Math.sin(s);if(this.aRotation!==0){const h=Math.cos(this.aRotation),f=Math.sin(this.aRotation),m=c-this.aX,g=u-this.aY;c=m*h-g*f+this.aX,u=m*f+g*h+this.aY}return n.set(c,u)}copy(e){return super.copy(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}}class ZJ extends Zy{constructor(e,t,n,r,a,i){super(e,t,n,n,r,a,i),this.isArcCurve=!0,this.type="ArcCurve"}}function Ky(){let o=0,e=0,t=0,n=0;function r(a,i,s,c){o=a,e=s,t=-3*a+3*i-2*s-c,n=2*a-2*i+s+c}return{initCatmullRom:function(a,i,s,c,u){r(i,s,u*(s-a),u*(c-i))},initNonuniformCatmullRom:function(a,i,s,c,u,h,f){let m=(i-a)/u-(s-a)/(u+h)+(s-i)/h,g=(s-i)/h-(c-i)/(h+f)+(c-s)/f;m*=h,g*=h,r(i,s,m,g)},calc:function(a){const i=a*a;return o+e*a+t*i+n*(i*a)}}}const a0=new B,UA=new Ky,zA=new Ky,VA=new Ky;class KJ extends Ha{constructor(e=[],t=!1,n="centripetal",r=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=e,this.closed=t,this.curveType=n,this.tension=r}getPoint(e,t=new B){const n=t,r=this.points,a=r.length,i=(a-(this.closed?0:1))*e;let s,c,u=Math.floor(i),h=i-u;this.closed?u+=u>0?0:(Math.floor(Math.abs(u)/a)+1)*a:h===0&&u===a-1&&(u=a-2,h=1),this.closed||u>0?s=r[(u-1)%a]:(a0.subVectors(r[0],r[1]).add(r[0]),s=a0);const f=r[u%a],m=r[(u+1)%a];if(this.closed||u+2<a?c=r[(u+2)%a]:(a0.subVectors(r[a-1],r[a-2]).add(r[a-1]),c=a0),this.curveType==="centripetal"||this.curveType==="chordal"){const g=this.curveType==="chordal"?.5:.25;let A=Math.pow(s.distanceToSquared(f),g),_=Math.pow(f.distanceToSquared(m),g),x=Math.pow(m.distanceToSquared(c),g);_<1e-4&&(_=1),A<1e-4&&(A=_),x<1e-4&&(x=_),UA.initNonuniformCatmullRom(s.x,f.x,m.x,c.x,A,_,x),zA.initNonuniformCatmullRom(s.y,f.y,m.y,c.y,A,_,x),VA.initNonuniformCatmullRom(s.z,f.z,m.z,c.z,A,_,x)}else this.curveType==="catmullrom"&&(UA.initCatmullRom(s.x,f.x,m.x,c.x,this.tension),zA.initCatmullRom(s.y,f.y,m.y,c.y,this.tension),VA.initCatmullRom(s.z,f.z,m.z,c.z,this.tension));return n.set(UA.calc(h),zA.calc(h),VA.calc(h)),n}copy(e){super.copy(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const r=e.points[t];this.points.push(r.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}}function ow(o,e,t,n,r){const a=.5*(n-e),i=.5*(r-t),s=o*o;return(2*t-2*n+a+i)*(o*s)+(-3*t+3*n-2*a-i)*s+a*o+t}function $J(o,e){const t=1-o;return t*t*e}function JJ(o,e){return 2*(1-o)*o*e}function eee(o,e){return o*o*e}function xh(o,e,t,n){return $J(o,e)+JJ(o,t)+eee(o,n)}function tee(o,e){const t=1-o;return t*t*t*e}function nee(o,e){const t=1-o;return 3*t*t*o*e}function ree(o,e){return 3*(1-o)*o*o*e}function oee(o,e){return o*o*o*e}function yh(o,e,t,n,r){return tee(o,e)+nee(o,t)+ree(o,n)+oee(o,r)}class O5 extends Ha{constructor(e=new Ee,t=new Ee,n=new Ee,r=new Ee){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=e,this.v1=t,this.v2=n,this.v3=r}getPoint(e,t=new Ee){const n=t,r=this.v0,a=this.v1,i=this.v2,s=this.v3;return n.set(yh(e,r.x,a.x,i.x,s.x),yh(e,r.y,a.y,i.y,s.y)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}}class aee extends Ha{constructor(e=new B,t=new B,n=new B,r=new B){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=e,this.v1=t,this.v2=n,this.v3=r}getPoint(e,t=new B){const n=t,r=this.v0,a=this.v1,i=this.v2,s=this.v3;return n.set(yh(e,r.x,a.x,i.x,s.x),yh(e,r.y,a.y,i.y,s.y),yh(e,r.z,a.z,i.z,s.z)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}}class $y extends Ha{constructor(e=new Ee,t=new Ee){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=e,this.v2=t}getPoint(e,t=new Ee){const n=t;return e===1?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(e).add(this.v1)),n}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t){const n=t||new Ee;return n.copy(this.v2).sub(this.v1).normalize(),n}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}}class iee extends Ha{constructor(e=new B,t=new B){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=e,this.v2=t}getPoint(e,t=new B){const n=t;return e===1?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(e).add(this.v1)),n}getPointAt(e,t){return this.getPoint(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}}class F5 extends Ha{constructor(e=new Ee,t=new Ee,n=new Ee){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=e,this.v1=t,this.v2=n}getPoint(e,t=new Ee){const n=t,r=this.v0,a=this.v1,i=this.v2;return n.set(xh(e,r.x,a.x,i.x),xh(e,r.y,a.y,i.y)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}}class U5 extends Ha{constructor(e=new B,t=new B,n=new B){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=e,this.v1=t,this.v2=n}getPoint(e,t=new B){const n=t,r=this.v0,a=this.v1,i=this.v2;return n.set(xh(e,r.x,a.x,i.x),xh(e,r.y,a.y,i.y),xh(e,r.z,a.z,i.z)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}}class z5 extends Ha{constructor(e=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=e}getPoint(e,t=new Ee){const n=t,r=this.points,a=(r.length-1)*e,i=Math.floor(a),s=a-i,c=r[i===0?i:i-1],u=r[i],h=r[i>r.length-2?r.length-1:i+1],f=r[i>r.length-3?r.length-1:i+2];return n.set(ow(s,c.x,u.x,h.x,f.x),ow(s,c.y,u.y,h.y,f.y)),n}copy(e){super.copy(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const r=e.points[t];this.points.push(r.clone())}return this}}class V5 extends Ha{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(e){this.curves.push(e)}closePath(){const e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new $y(t,e))}getPoint(e,t){const n=e*this.getLength(),r=this.getCurveLengths();let a=0;for(;a<r.length;){if(r[a]>=n){const i=r[a]-n,s=this.curves[a],c=s.getLength(),u=c===0?0:1-i/c;return s.getPointAt(u,t)}a++}return null}getLength(){const e=this.getCurveLengths();return e[e.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const e=[];let t=0;for(let n=0,r=this.curves.length;n<r;n++)t+=this.curves[n].getLength(),e.push(t);return this.cacheLengths=e,e}getSpacedPoints(e=40){const t=[];for(let n=0;n<=e;n++)t.push(this.getPoint(n/e));return this.autoClose&&t.push(t[0]),t}getPoints(e=12){const t=[];let n;for(let r=0,a=this.curves;r<a.length;r++){const i=a[r],s=i.isEllipseCurve?2*e:i.isLineCurve||i.isLineCurve3?1:i.isSplineCurve?e*i.points.length:e,c=i.getPoints(s);for(let u=0;u<c.length;u++){const h=c[u];n&&n.equals(h)||(t.push(h),n=h)}}return this.autoClose&&t.length>1&&!t[t.length-1].equals(t[0])&&t.push(t[0]),t}copy(e){super.copy(e),this.curves=[];for(let t=0,n=e.curves.length;t<n;t++){const r=e.curves[t];this.curves.push(r.clone())}return this.autoClose=e.autoClose,this}}class Mv extends V5{constructor(e){super(),this.type="Path",this.currentPoint=new Ee,e&&this.setFromPoints(e)}setFromPoints(e){this.moveTo(e[0].x,e[0].y);for(let t=1,n=e.length;t<n;t++)this.lineTo(e[t].x,e[t].y);return this}moveTo(e,t){return this.currentPoint.set(e,t),this}lineTo(e,t){const n=new $y(this.currentPoint.clone(),new Ee(e,t));return this.curves.push(n),this.currentPoint.set(e,t),this}quadraticCurveTo(e,t,n,r){const a=new F5(this.currentPoint.clone(),new Ee(e,t),new Ee(n,r));return this.curves.push(a),this.currentPoint.set(n,r),this}bezierCurveTo(e,t,n,r,a,i){const s=new O5(this.currentPoint.clone(),new Ee(e,t),new Ee(n,r),new Ee(a,i));return this.curves.push(s),this.currentPoint.set(a,i),this}splineThru(e){const t=[this.currentPoint.clone()].concat(e),n=new z5(t);return this.curves.push(n),this.currentPoint.copy(e[e.length-1]),this}arc(e,t,n,r,a,i){const s=this.currentPoint.x,c=this.currentPoint.y;return this.absarc(e+s,t+c,n,r,a,i),this}absarc(e,t,n,r,a,i){return this.absellipse(e,t,n,n,r,a,i),this}ellipse(e,t,n,r,a,i,s,c){const u=this.currentPoint.x,h=this.currentPoint.y;return this.absellipse(e+u,t+h,n,r,a,i,s,c),this}absellipse(e,t,n,r,a,i,s,c){const u=new Zy(e,t,n,r,a,i,s,c);if(this.curves.length>0){const f=u.getPoint(0);f.equals(this.currentPoint)||this.lineTo(f.x,f.y)}this.curves.push(u);const h=u.getPoint(1);return this.currentPoint.copy(h),this}copy(e){return super.copy(e),this.currentPoint.copy(e.currentPoint),this}}class k5 extends mt{constructor(e=[new Ee(0,-.5),new Ee(.5,0),new Ee(0,.5)],t=12,n=0,r=2*Math.PI){super(),this.type="LatheGeometry",this.parameters={points:e,segments:t,phiStart:n,phiLength:r},t=Math.floor(t),r=Ft(r,0,2*Math.PI);const a=[],i=[],s=[],c=[],u=[],h=1/t,f=new B,m=new Ee,g=new B,A=new B,_=new B;let x=0,C=0;for(let b=0;b<=e.length-1;b++)switch(b){case 0:x=e[b+1].x-e[b].x,C=e[b+1].y-e[b].y,g.x=1*C,g.y=-x,g.z=0*C,_.copy(g),g.normalize(),c.push(g.x,g.y,g.z);break;case e.length-1:c.push(_.x,_.y,_.z);break;default:x=e[b+1].x-e[b].x,C=e[b+1].y-e[b].y,g.x=1*C,g.y=-x,g.z=0*C,A.copy(g),g.x+=_.x,g.y+=_.y,g.z+=_.z,g.normalize(),c.push(g.x,g.y,g.z),_.copy(A)}for(let b=0;b<=t;b++){const y=n+b*h*r,M=Math.sin(y),R=Math.cos(y);for(let T=0;T<=e.length-1;T++){f.x=e[T].x*M,f.y=e[T].y,f.z=e[T].x*R,i.push(f.x,f.y,f.z),m.x=b/t,m.y=T/(e.length-1),s.push(m.x,m.y);const w=c[3*T+0]*M,D=c[3*T+1],z=c[3*T+0]*R;u.push(w,D,z)}}for(let b=0;b<t;b++)for(let y=0;y<e.length-1;y++){const M=y+b*e.length,R=M,T=M+e.length,w=M+e.length+1,D=M+1;a.push(R,T,D),a.push(w,D,T)}this.setIndex(a),this.setAttribute("position",new ut(i,3)),this.setAttribute("uv",new ut(s,2)),this.setAttribute("normal",new ut(u,3))}}class see extends k5{constructor(e=1,t=1,n=4,r=8){const a=new Mv;a.absarc(0,-t/2,e,1.5*Math.PI,0),a.absarc(0,t/2,e,0,.5*Math.PI),super(a.getPoints(n),r),this.type="CapsuleGeometry",this.parameters={radius:e,height:t,capSegments:n,radialSegments:r}}}class lee extends mt{constructor(e=1,t=32,n=0,r=2*Math.PI){super(),this.type="CircleGeometry",this.parameters={radius:e,segments:t,thetaStart:n,thetaLength:r},t=Math.max(3,t);const a=[],i=[],s=[],c=[],u=new B,h=new Ee;i.push(0,0,0),s.push(0,0,1),c.push(.5,.5);for(let f=0,m=3;f<=t;f++,m+=3){const g=n+f/t*r;u.x=e*Math.cos(g),u.y=e*Math.sin(g),i.push(u.x,u.y,u.z),s.push(0,0,1),h.x=(i[m]/e+1)/2,h.y=(i[m+1]/e+1)/2,c.push(h.x,h.y)}for(let f=1;f<=t;f++)a.push(f,f+1,0);this.setIndex(a),this.setAttribute("position",new ut(i,3)),this.setAttribute("normal",new ut(s,3)),this.setAttribute("uv",new ut(c,2))}}class Jy extends mt{constructor(e=1,t=1,n=1,r=32,a=1,i=!1,s=0,c=2*Math.PI){super(),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:n,radialSegments:r,heightSegments:a,openEnded:i,thetaStart:s,thetaLength:c};const u=this;r=Math.floor(r),a=Math.floor(a);const h=[],f=[],m=[],g=[];let A=0;const _=[],x=n/2;let C=0;function b(y){const M=A,R=new Ee,T=new B;let w=0;const D=y===!0?e:t,z=y===!0?1:-1;for(let O=1;O<=r;O++)f.push(0,x*z,0),m.push(0,z,0),g.push(.5,.5),A++;const F=A;for(let O=0;O<=r;O++){const q=O/r*c+s,ne=Math.cos(q),$=Math.sin(q);T.x=D*$,T.y=x*z,T.z=D*ne,f.push(T.x,T.y,T.z),m.push(0,z,0),R.x=.5*ne+.5,R.y=.5*$*z+.5,g.push(R.x,R.y),A++}for(let O=0;O<r;O++){const q=M+O,ne=F+O;y===!0?h.push(ne,ne+1,q):h.push(ne+1,ne,q),w+=3}u.addGroup(C,w,y===!0?1:2),C+=w}(function(){const y=new B,M=new B;let R=0;const T=(t-e)/n;for(let w=0;w<=a;w++){const D=[],z=w/a,F=z*(t-e)+e;for(let O=0;O<=r;O++){const q=O/r,ne=q*c+s,$=Math.sin(ne),he=Math.cos(ne);M.x=F*$,M.y=-z*n+x,M.z=F*he,f.push(M.x,M.y,M.z),y.set($,T,he).normalize(),m.push(y.x,y.y,y.z),g.push(q,1-z),D.push(A++)}_.push(D)}for(let w=0;w<r;w++)for(let D=0;D<a;D++){const z=_[D][w],F=_[D+1][w],O=_[D+1][w+1],q=_[D][w+1];h.push(z,F,q),h.push(F,O,q),R+=6}u.addGroup(C,R,0),C+=R})(),i===!1&&(e>0&&b(!0),t>0&&b(!1)),this.setIndex(h),this.setAttribute("position",new ut(f,3)),this.setAttribute("normal",new ut(m,3)),this.setAttribute("uv",new ut(g,2))}}class cee extends Jy{constructor(e=1,t=1,n=32,r=1,a=!1,i=0,s=2*Math.PI){super(0,e,t,n,r,a,i,s),this.type="ConeGeometry",this.parameters={radius:e,height:t,radialSegments:n,heightSegments:r,openEnded:a,thetaStart:i,thetaLength:s}}}class gp extends mt{constructor(e=[],t=[],n=1,r=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:n,detail:r};const a=[],i=[];function s(m,g,A,_){const x=_+1,C=[];for(let b=0;b<=x;b++){C[b]=[];const y=m.clone().lerp(A,b/x),M=g.clone().lerp(A,b/x),R=x-b;for(let T=0;T<=R;T++)C[b][T]=T===0&&b===x?y:y.clone().lerp(M,T/R)}for(let b=0;b<x;b++)for(let y=0;y<2*(x-b)-1;y++){const M=Math.floor(y/2);y%2==0?(c(C[b][M+1]),c(C[b+1][M]),c(C[b][M])):(c(C[b][M+1]),c(C[b+1][M+1]),c(C[b+1][M]))}}function c(m){a.push(m.x,m.y,m.z)}function u(m,g){const A=3*m;g.x=e[A+0],g.y=e[A+1],g.z=e[A+2]}function h(m,g,A,_){_<0&&m.x===1&&(i[g]=m.x-1),A.x===0&&A.z===0&&(i[g]=_/2/Math.PI+.5)}function f(m){return Math.atan2(m.z,-m.x)}(function(m){const g=new B,A=new B,_=new B;for(let x=0;x<t.length;x+=3)u(t[x+0],g),u(t[x+1],A),u(t[x+2],_),s(g,A,_,m)})(r),function(m){const g=new B;for(let A=0;A<a.length;A+=3)g.x=a[A+0],g.y=a[A+1],g.z=a[A+2],g.normalize().multiplyScalar(m),a[A+0]=g.x,a[A+1]=g.y,a[A+2]=g.z}(n),function(){const m=new B;for(let A=0;A<a.length;A+=3){m.x=a[A+0],m.y=a[A+1],m.z=a[A+2];const _=f(m)/2/Math.PI+.5,x=(g=m,Math.atan2(-g.y,Math.sqrt(g.x*g.x+g.z*g.z))/Math.PI+.5);i.push(_,1-x)}var g;(function(){const A=new B,_=new B,x=new B,C=new B,b=new Ee,y=new Ee,M=new Ee;for(let R=0,T=0;R<a.length;R+=9,T+=6){A.set(a[R+0],a[R+1],a[R+2]),_.set(a[R+3],a[R+4],a[R+5]),x.set(a[R+6],a[R+7],a[R+8]),b.set(i[T+0],i[T+1]),y.set(i[T+2],i[T+3]),M.set(i[T+4],i[T+5]),C.copy(A).add(_).add(x).divideScalar(3);const w=f(C);h(b,T+0,A,w),h(y,T+2,_,w),h(M,T+4,x,w)}})(),function(){for(let A=0;A<i.length;A+=6){const _=i[A+0],x=i[A+2],C=i[A+4],b=Math.max(_,x,C),y=Math.min(_,x,C);b>.9&&y<.1&&(_<.2&&(i[A+0]+=1),x<.2&&(i[A+2]+=1),C<.2&&(i[A+4]+=1))}}()}(),this.setAttribute("position",new ut(a,3)),this.setAttribute("normal",new ut(a.slice(),3)),this.setAttribute("uv",new ut(i,2)),r===0?this.computeVertexNormals():this.normalizeNormals()}}class uee extends gp{constructor(e=1,t=0){const n=(1+Math.sqrt(5))/2,r=1/n;super([-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-r,-n,0,-r,n,0,r,-n,0,r,n,-r,-n,0,-r,n,0,r,-n,0,r,n,0,-n,0,-r,n,0,-r,-n,0,r,n,0,r],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],e,t),this.type="DodecahedronGeometry",this.parameters={radius:e,detail:t}}}const i0=new B,s0=new B,kA=new B,l0=new Cr;class dee extends mt{constructor(e=null,t=1){if(super(),this.type="EdgesGeometry",this.parameters={geometry:e,thresholdAngle:t},e!==null){const r=Math.pow(10,4),a=Math.cos(ls*t),i=e.getIndex(),s=e.getAttribute("position"),c=i?i.count:s.count,u=[0,0,0],h=["a","b","c"],f=new Array(3),m={},g=[];for(let A=0;A<c;A+=3){i?(u[0]=i.getX(A),u[1]=i.getX(A+1),u[2]=i.getX(A+2)):(u[0]=A,u[1]=A+1,u[2]=A+2);const{a:_,b:x,c:C}=l0;if(_.fromBufferAttribute(s,u[0]),x.fromBufferAttribute(s,u[1]),C.fromBufferAttribute(s,u[2]),l0.getNormal(kA),f[0]=`${Math.round(_.x*r)},${Math.round(_.y*r)},${Math.round(_.z*r)}`,f[1]=`${Math.round(x.x*r)},${Math.round(x.y*r)},${Math.round(x.z*r)}`,f[2]=`${Math.round(C.x*r)},${Math.round(C.y*r)},${Math.round(C.z*r)}`,f[0]!==f[1]&&f[1]!==f[2]&&f[2]!==f[0])for(let b=0;b<3;b++){const y=(b+1)%3,M=f[b],R=f[y],T=l0[h[b]],w=l0[h[y]],D=`${M}_${R}`,z=`${R}_${M}`;z in m&&m[z]?(kA.dot(m[z].normal)<=a&&(g.push(T.x,T.y,T.z),g.push(w.x,w.y,w.z)),m[z]=null):D in m||(m[D]={index0:u[b],index1:u[y],normal:kA.clone()})}}for(const A in m)if(m[A]){const{index0:_,index1:x}=m[A];i0.fromBufferAttribute(s,_),s0.fromBufferAttribute(s,x),g.push(i0.x,i0.y,i0.z),g.push(s0.x,s0.y,s0.z)}this.setAttribute("position",new ut(g,3))}}}class sd extends Mv{constructor(e){super(e),this.uuid=Wo(),this.type="Shape",this.holes=[]}getPointsHoles(e){const t=[];for(let n=0,r=this.holes.length;n<r;n++)t[n]=this.holes[n].getPoints(e);return t}extractPoints(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}}copy(e){super.copy(e),this.holes=[];for(let t=0,n=e.holes.length;t<n;t++){const r=e.holes[t];this.holes.push(r.clone())}return this}}const fee={triangulate:function(o,e,t=2){const n=e&&e.length,r=n?e[0]*t:o.length;let a=G5(o,0,r,t,!0);const i=[];if(!a||a.next===a.prev)return i;let s,c,u,h,f,m,g;if(n&&(a=vee(o,e,a,t)),o.length>80*t){s=u=o[0],c=h=o[1];for(let A=t;A<r;A+=t)f=o[A],m=o[A+1],f<s&&(s=f),m<c&&(c=m),f>u&&(u=f),m>h&&(h=m);g=Math.max(u-s,h-c),g=g!==0?32767/g:0}return Xh(a,i,t,s,c,g,0),i}};function G5(o,e,t,n,r){let a,i;if(r===Tee(o,e,t,n)>0)for(a=e;a<t;a+=n)i=aw(a,o[a],o[a+1],i);else for(a=t-n;a>=e;a-=n)i=aw(a,o[a],o[a+1],i);return i&&wv(i,i.next)&&(Zh(i),i=i.next),i}function Bc(o,e){if(!o)return o;e||(e=o);let t,n=o;do if(t=!1,n.steiner||!wv(n,n.next)&&Fn(n.prev,n,n.next)!==0)n=n.next;else{if(Zh(n),n=e=n.prev,n===n.next)break;t=!0}while(t||n!==e);return e}function Xh(o,e,t,n,r,a,i){if(!o)return;!i&&a&&bee(o,n,r,a);let s,c,u=o;for(;o.prev!==o.next;)if(s=o.prev,c=o.next,a?pee(o,n,r,a):hee(o))e.push(s.i/t|0),e.push(o.i/t|0),e.push(c.i/t|0),Zh(o),o=c.next,u=c.next;else if((o=c)===u){i?i===1?Xh(o=mee(Bc(o),e,t),e,t,n,r,a,2):i===2&&gee(o,e,t,n,r,a):Xh(Bc(o),e,t,n,r,a,1);break}}function hee(o){const e=o.prev,t=o,n=o.next;if(Fn(e,t,n)>=0)return!1;const r=e.x,a=t.x,i=n.x,s=e.y,c=t.y,u=n.y,h=r<a?r<i?r:i:a<i?a:i,f=s<c?s<u?s:u:c<u?c:u,m=r>a?r>i?r:i:a>i?a:i,g=s>c?s>u?s:u:c>u?c:u;let A=n.next;for(;A!==e;){if(A.x>=h&&A.x<=m&&A.y>=f&&A.y<=g&&Ku(r,s,a,c,i,u,A.x,A.y)&&Fn(A.prev,A,A.next)>=0)return!1;A=A.next}return!0}function pee(o,e,t,n){const r=o.prev,a=o,i=o.next;if(Fn(r,a,i)>=0)return!1;const s=r.x,c=a.x,u=i.x,h=r.y,f=a.y,m=i.y,g=s<c?s<u?s:u:c<u?c:u,A=h<f?h<m?h:m:f<m?f:m,_=s>c?s>u?s:u:c>u?c:u,x=h>f?h>m?h:m:f>m?f:m,C=E2(g,A,e,t,n),b=E2(_,x,e,t,n);let y=o.prevZ,M=o.nextZ;for(;y&&y.z>=C&&M&&M.z<=b;){if(y.x>=g&&y.x<=_&&y.y>=A&&y.y<=x&&y!==r&&y!==i&&Ku(s,h,c,f,u,m,y.x,y.y)&&Fn(y.prev,y,y.next)>=0||(y=y.prevZ,M.x>=g&&M.x<=_&&M.y>=A&&M.y<=x&&M!==r&&M!==i&&Ku(s,h,c,f,u,m,M.x,M.y)&&Fn(M.prev,M,M.next)>=0))return!1;M=M.nextZ}for(;y&&y.z>=C;){if(y.x>=g&&y.x<=_&&y.y>=A&&y.y<=x&&y!==r&&y!==i&&Ku(s,h,c,f,u,m,y.x,y.y)&&Fn(y.prev,y,y.next)>=0)return!1;y=y.prevZ}for(;M&&M.z<=b;){if(M.x>=g&&M.x<=_&&M.y>=A&&M.y<=x&&M!==r&&M!==i&&Ku(s,h,c,f,u,m,M.x,M.y)&&Fn(M.prev,M,M.next)>=0)return!1;M=M.nextZ}return!0}function mee(o,e,t){let n=o;do{const r=n.prev,a=n.next.next;!wv(r,a)&&Q5(r,n,n.next,a)&&qh(r,a)&&qh(a,r)&&(e.push(r.i/t|0),e.push(n.i/t|0),e.push(a.i/t|0),Zh(n),Zh(n.next),n=o=a),n=n.next}while(n!==o);return Bc(n)}function gee(o,e,t,n,r,a){let i=o;do{let s=i.next.next;for(;s!==i.prev;){if(i.i!==s.i&&Eee(i,s)){let c=H5(i,s);return i=Bc(i,i.next),c=Bc(c,c.next),Xh(i,e,t,n,r,a,0),void Xh(c,e,t,n,r,a,0)}s=s.next}i=i.next}while(i!==o)}function vee(o,e,t,n){const r=[];let a,i,s,c,u;for(a=0,i=e.length;a<i;a++)s=e[a]*n,c=a<i-1?e[a+1]*n:o.length,u=G5(o,s,c,n,!1),u===u.next&&(u.steiner=!0),r.push(Cee(u));for(r.sort(_ee),a=0;a<r.length;a++)t=Aee(r[a],t);return t}function _ee(o,e){return o.x-e.x}function Aee(o,e){const t=xee(o,e);if(!t)return e;const n=H5(t,o);return Bc(n,n.next),Bc(t,t.next)}function xee(o,e){let t,n=e,r=-1/0;const a=o.x,i=o.y;do{if(i<=n.y&&i>=n.next.y&&n.next.y!==n.y){const m=n.x+(i-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(m<=a&&m>r&&(r=m,t=n.x<n.next.x?n:n.next,m===a))return t}n=n.next}while(n!==e);if(!t)return null;const s=t,c=t.x,u=t.y;let h,f=1/0;n=t;do a>=n.x&&n.x>=c&&a!==n.x&&Ku(i<u?a:r,i,c,u,i<u?r:a,i,n.x,n.y)&&(h=Math.abs(i-n.y)/(a-n.x),qh(n,o)&&(h<f||h===f&&(n.x>t.x||n.x===t.x&&yee(t,n)))&&(t=n,f=h)),n=n.next;while(n!==s);return t}function yee(o,e){return Fn(o.prev,o,e.prev)<0&&Fn(e.next,o,o.next)<0}function bee(o,e,t,n){let r=o;do r.z===0&&(r.z=E2(r.x,r.y,e,t,n)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next;while(r!==o);r.prevZ.nextZ=null,r.prevZ=null,See(r)}function See(o){let e,t,n,r,a,i,s,c,u=1;do{for(t=o,o=null,a=null,i=0;t;){for(i++,n=t,s=0,e=0;e<u&&(s++,n=n.nextZ,n);e++);for(c=u;s>0||c>0&&n;)s!==0&&(c===0||!n||t.z<=n.z)?(r=t,t=t.nextZ,s--):(r=n,n=n.nextZ,c--),a?a.nextZ=r:o=r,r.prevZ=a,a=r;t=n}a.nextZ=null,u*=2}while(i>1);return o}function E2(o,e,t,n,r){return(o=1431655765&((o=858993459&((o=252645135&((o=16711935&((o=(o-t)*r|0)|o<<8))|o<<4))|o<<2))|o<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-n)*r|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function Cee(o){let e=o,t=o;do(e.x<t.x||e.x===t.x&&e.y<t.y)&&(t=e),e=e.next;while(e!==o);return t}function Ku(o,e,t,n,r,a,i,s){return(r-i)*(e-s)>=(o-i)*(a-s)&&(o-i)*(n-s)>=(t-i)*(e-s)&&(t-i)*(a-s)>=(r-i)*(n-s)}function Eee(o,e){return o.next.i!==e.i&&o.prev.i!==e.i&&!Mee(o,e)&&(qh(o,e)&&qh(e,o)&&wee(o,e)&&(Fn(o.prev,o,e.prev)||Fn(o,e.prev,e))||wv(o,e)&&Fn(o.prev,o,o.next)>0&&Fn(e.prev,e,e.next)>0)}function Fn(o,e,t){return(e.y-o.y)*(t.x-e.x)-(e.x-o.x)*(t.y-e.y)}function wv(o,e){return o.x===e.x&&o.y===e.y}function Q5(o,e,t,n){const r=u0(Fn(o,e,t)),a=u0(Fn(o,e,n)),i=u0(Fn(t,n,o)),s=u0(Fn(t,n,e));return r!==a&&i!==s||!(r!==0||!c0(o,t,e))||!(a!==0||!c0(o,n,e))||!(i!==0||!c0(t,o,n))||!(s!==0||!c0(t,e,n))}function c0(o,e,t){return e.x<=Math.max(o.x,t.x)&&e.x>=Math.min(o.x,t.x)&&e.y<=Math.max(o.y,t.y)&&e.y>=Math.min(o.y,t.y)}function u0(o){return o>0?1:o<0?-1:0}function Mee(o,e){let t=o;do{if(t.i!==o.i&&t.next.i!==o.i&&t.i!==e.i&&t.next.i!==e.i&&Q5(t,t.next,o,e))return!0;t=t.next}while(t!==o);return!1}function qh(o,e){return Fn(o.prev,o,o.next)<0?Fn(o,e,o.next)>=0&&Fn(o,o.prev,e)>=0:Fn(o,e,o.prev)<0||Fn(o,o.next,e)<0}function wee(o,e){let t=o,n=!1;const r=(o.x+e.x)/2,a=(o.y+e.y)/2;do t.y>a!=t.next.y>a&&t.next.y!==t.y&&r<(t.next.x-t.x)*(a-t.y)/(t.next.y-t.y)+t.x&&(n=!n),t=t.next;while(t!==o);return n}function H5(o,e){const t=new M2(o.i,o.x,o.y),n=new M2(e.i,e.x,e.y),r=o.next,a=e.prev;return o.next=e,e.prev=o,t.next=r,r.prev=t,n.next=t,t.prev=n,a.next=n,n.prev=a,n}function aw(o,e,t,n){const r=new M2(o,e,t);return n?(r.next=n.next,r.prev=n,n.next.prev=r,n.next=r):(r.prev=r,r.next=r),r}function Zh(o){o.next.prev=o.prev,o.prev.next=o.next,o.prevZ&&(o.prevZ.nextZ=o.nextZ),o.nextZ&&(o.nextZ.prevZ=o.prevZ)}function M2(o,e,t){this.i=o,this.x=e,this.y=t,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Tee(o,e,t,n){let r=0;for(let a=e,i=t-n;a<t;a+=n)r+=(o[i]-o[a])*(o[a+1]+o[i+1]),i=a;return r}class di{static area(e){const t=e.length;let n=0;for(let r=t-1,a=0;a<t;r=a++)n+=e[r].x*e[a].y-e[a].x*e[r].y;return .5*n}static isClockWise(e){return di.area(e)<0}static triangulateShape(e,t){const n=[],r=[],a=[];iw(e),sw(n,e);let i=e.length;t.forEach(iw);for(let c=0;c<t.length;c++)r.push(i),i+=t[c].length,sw(n,t[c]);const s=fee.triangulate(n,r);for(let c=0;c<s.length;c+=3)a.push(s.slice(c,c+3));return a}}function iw(o){const e=o.length;e>2&&o[e-1].equals(o[0])&&o.pop()}function sw(o,e){for(let t=0;t<e.length;t++)o.push(e[t].x),o.push(e[t].y)}class W5 extends mt{constructor(e=new sd([new Ee(.5,.5),new Ee(-.5,.5),new Ee(-.5,-.5),new Ee(.5,-.5)]),t={}){super(),this.type="ExtrudeGeometry",this.parameters={shapes:e,options:t},e=Array.isArray(e)?e:[e];const n=this,r=[],a=[];for(let s=0,c=e.length;s<c;s++)i(e[s]);function i(s){const c=[],u=t.curveSegments!==void 0?t.curveSegments:12,h=t.steps!==void 0?t.steps:1,f=t.depth!==void 0?t.depth:1;let m=t.bevelEnabled===void 0||t.bevelEnabled,g=t.bevelThickness!==void 0?t.bevelThickness:.2,A=t.bevelSize!==void 0?t.bevelSize:g-.1,_=t.bevelOffset!==void 0?t.bevelOffset:0,x=t.bevelSegments!==void 0?t.bevelSegments:3;const C=t.extrudePath,b=t.UVGenerator!==void 0?t.UVGenerator:Ree;let y,M,R,T,w,D=!1;C&&(y=C.getSpacedPoints(h),D=!0,m=!1,M=C.computeFrenetFrames(h,!1),R=new B,T=new B,w=new B),m||(x=0,g=0,A=0,_=0);const z=s.extractPoints(u);let F=z.shape;const O=z.holes;if(!di.isClockWise(F)){F=F.reverse();for(let X=0,W=O.length;X<W;X++){const Y=O[X];di.isClockWise(Y)&&(O[X]=Y.reverse())}}const q=di.triangulateShape(F,O),ne=F;for(let X=0,W=O.length;X<W;X++){const Y=O[X];F=F.concat(Y)}function $(X,W,Y){return W||console.error("v3d.ExtrudeGeometry: vec does not exist"),W.clone().multiplyScalar(Y).add(X)}const he=F.length,K=q.length;function oe(X,W,Y){let P,Q,I;const N=X.x-W.x,se=X.y-W.y,ce=Y.x-X.x,fe=Y.y-X.y,ve=N*N+se*se,xe=N*fe-se*ce;if(Math.abs(xe)>Number.EPSILON){const Ie=Math.sqrt(ve),re=Math.sqrt(ce*ce+fe*fe),me=W.x-se/Ie,pe=W.y+N/Ie,Ce=((Y.x-fe/re-me)*fe-(Y.y+ce/re-pe)*ce)/(N*fe-se*ce);P=me+N*Ce-X.x,Q=pe+se*Ce-X.y;const we=P*P+Q*Q;if(we<=2)return new Ee(P,Q);I=Math.sqrt(we/2)}else{let Ie=!1;N>Number.EPSILON?ce>Number.EPSILON&&(Ie=!0):N<-Number.EPSILON?ce<-Number.EPSILON&&(Ie=!0):Math.sign(se)===Math.sign(fe)&&(Ie=!0),Ie?(P=-se,Q=N,I=Math.sqrt(ve)):(P=N,Q=se,I=Math.sqrt(ve/2))}return new Ee(P/I,Q/I)}const ie=[];for(let X=0,W=ne.length,Y=W-1,P=X+1;X<W;X++,Y++,P++)Y===W&&(Y=0),P===W&&(P=0),ie[X]=oe(ne[X],ne[Y],ne[P]);const L=[];let U,k=ie.concat();for(let X=0,W=O.length;X<W;X++){const Y=O[X];U=[];for(let P=0,Q=Y.length,I=Q-1,N=P+1;P<Q;P++,I++,N++)I===Q&&(I=0),N===Q&&(N=0),U[P]=oe(Y[P],Y[I],Y[N]);L.push(U),k=k.concat(U)}for(let X=0;X<x;X++){const W=X/x,Y=g*Math.cos(W*Math.PI/2),P=A*Math.sin(W*Math.PI/2)+_;for(let Q=0,I=ne.length;Q<I;Q++){const N=$(ne[Q],ie[Q],P);te(N.x,N.y,-Y)}for(let Q=0,I=O.length;Q<I;Q++){const N=O[Q];U=L[Q];for(let se=0,ce=N.length;se<ce;se++){const fe=$(N[se],U[se],P);te(fe.x,fe.y,-Y)}}}const J=A+_;for(let X=0;X<he;X++){const W=m?$(F[X],k[X],J):F[X];D?(T.copy(M.normals[0]).multiplyScalar(W.x),R.copy(M.binormals[0]).multiplyScalar(W.y),w.copy(y[0]).add(T).add(R),te(w.x,w.y,w.z)):te(W.x,W.y,0)}for(let X=1;X<=h;X++)for(let W=0;W<he;W++){const Y=m?$(F[W],k[W],J):F[W];D?(T.copy(M.normals[X]).multiplyScalar(Y.x),R.copy(M.binormals[X]).multiplyScalar(Y.y),w.copy(y[X]).add(T).add(R),te(w.x,w.y,w.z)):te(Y.x,Y.y,f/h*X)}for(let X=x-1;X>=0;X--){const W=X/x,Y=g*Math.cos(W*Math.PI/2),P=A*Math.sin(W*Math.PI/2)+_;for(let Q=0,I=ne.length;Q<I;Q++){const N=$(ne[Q],ie[Q],P);te(N.x,N.y,f+Y)}for(let Q=0,I=O.length;Q<I;Q++){const N=O[Q];U=L[Q];for(let se=0,ce=N.length;se<ce;se++){const fe=$(N[se],U[se],P);D?te(fe.x,fe.y+y[h-1].y,y[h-1].x+Y):te(fe.x,fe.y,f+Y)}}}function de(X,W){let Y=X.length;for(;--Y>=0;){const P=Y;let Q=Y-1;Q<0&&(Q=X.length-1);for(let I=0,N=h+2*x;I<N;I++){const se=he*I,ce=he*(I+1);V(W+P+se,W+Q+se,W+Q+ce,W+P+ce)}}}function te(X,W,Y){c.push(X),c.push(W),c.push(Y)}function le(X,W,Y){G(X),G(W),G(Y);const P=r.length/3,Q=b.generateTopUV(n,r,P-3,P-2,P-1);ee(Q[0]),ee(Q[1]),ee(Q[2])}function V(X,W,Y,P){G(X),G(W),G(P),G(W),G(Y),G(P);const Q=r.length/3,I=b.generateSideWallUV(n,r,Q-6,Q-3,Q-2,Q-1);ee(I[0]),ee(I[1]),ee(I[3]),ee(I[1]),ee(I[2]),ee(I[3])}function G(X){r.push(c[3*X+0]),r.push(c[3*X+1]),r.push(c[3*X+2])}function ee(X){a.push(X.x),a.push(X.y)}(function(){const X=r.length/3;if(m){let W=0,Y=he*W;for(let P=0;P<K;P++){const Q=q[P];le(Q[2]+Y,Q[1]+Y,Q[0]+Y)}W=h+2*x,Y=he*W;for(let P=0;P<K;P++){const Q=q[P];le(Q[0]+Y,Q[1]+Y,Q[2]+Y)}}else{for(let W=0;W<K;W++){const Y=q[W];le(Y[2],Y[1],Y[0])}for(let W=0;W<K;W++){const Y=q[W];le(Y[0]+he*h,Y[1]+he*h,Y[2]+he*h)}}n.addGroup(X,r.length/3-X,0)})(),function(){const X=r.length/3;let W=0;de(ne,W),W+=ne.length;for(let Y=0,P=O.length;Y<P;Y++){const Q=O[Y];de(Q,W),W+=Q.length}n.addGroup(X,r.length/3-X,1)}()}this.setAttribute("position",new ut(r,3)),this.setAttribute("uv",new ut(a,2)),this.computeVertexNormals()}}const Ree={generateTopUV:function(o,e,t,n,r){const a=e[3*t],i=e[3*t+1],s=e[3*n],c=e[3*n+1],u=e[3*r],h=e[3*r+1];return[new Ee(a,i),new Ee(s,c),new Ee(u,h)]},generateSideWallUV:function(o,e,t,n,r,a){const i=e[3*t],s=e[3*t+1],c=e[3*t+2],u=e[3*n],h=e[3*n+1],f=e[3*n+2],m=e[3*r],g=e[3*r+1],A=e[3*r+2],_=e[3*a],x=e[3*a+1],C=e[3*a+2];return Math.abs(s-h)<Math.abs(i-u)?[new Ee(i,1-c),new Ee(u,1-f),new Ee(m,1-A),new Ee(_,1-C)]:[new Ee(s,1-c),new Ee(h,1-f),new Ee(g,1-A),new Ee(x,1-C)]}};class Iee extends gp{constructor(e=1,t=0){const n=(1+Math.sqrt(5))/2;super([-1,n,0,1,n,0,-1,-n,0,1,-n,0,0,-1,n,0,1,n,0,-1,-n,0,1,-n,n,0,-1,n,0,1,-n,0,-1,-n,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],e,t),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:t}}}class Y5 extends gp{constructor(e=1,t=0){super([1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],e,t),this.type="OctahedronGeometry",this.parameters={radius:e,detail:t}}}class Lee extends mt{constructor(e=.5,t=1,n=32,r=1,a=0,i=2*Math.PI){super(),this.type="RingGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:n,phiSegments:r,thetaStart:a,thetaLength:i},n=Math.max(3,n);const s=[],c=[],u=[],h=[];let f=e;const m=(t-e)/(r=Math.max(1,r)),g=new B,A=new Ee;for(let _=0;_<=r;_++){for(let x=0;x<=n;x++){const C=a+x/n*i;g.x=f*Math.cos(C),g.y=f*Math.sin(C),c.push(g.x,g.y,g.z),u.push(0,0,1),A.x=(g.x/t+1)/2,A.y=(g.y/t+1)/2,h.push(A.x,A.y)}f+=m}for(let _=0;_<r;_++){const x=_*(n+1);for(let C=0;C<n;C++){const b=C+x,y=b,M=b+n+1,R=b+n+2,T=b+1;s.push(y,M,T),s.push(M,R,T)}}this.setIndex(s),this.setAttribute("position",new ut(c,3)),this.setAttribute("normal",new ut(u,3)),this.setAttribute("uv",new ut(h,2))}}class Bee extends mt{constructor(e=new sd([new Ee(0,.5),new Ee(-.5,-.5),new Ee(.5,-.5)]),t=12){super(),this.type="ShapeGeometry",this.parameters={shapes:e,curveSegments:t};const n=[],r=[],a=[],i=[];let s=0,c=0;if(Array.isArray(e)===!1)u(e);else for(let h=0;h<e.length;h++)u(e[h]),this.addGroup(s,c,h),s+=c,c=0;function u(h){const f=r.length/3,m=h.extractPoints(t);let g=m.shape;const A=m.holes;di.isClockWise(g)===!1&&(g=g.reverse());for(let x=0,C=A.length;x<C;x++){const b=A[x];di.isClockWise(b)===!0&&(A[x]=b.reverse())}const _=di.triangulateShape(g,A);for(let x=0,C=A.length;x<C;x++){const b=A[x];g=g.concat(b)}for(let x=0,C=g.length;x<C;x++){const b=g[x];r.push(b.x,b.y,0),a.push(0,0,1),i.push(b.x,b.y)}for(let x=0,C=_.length;x<C;x++){const b=_[x],y=b[0]+f,M=b[1]+f,R=b[2]+f;n.push(y,M,R),c+=3}}this.setIndex(n),this.setAttribute("position",new ut(r,3)),this.setAttribute("normal",new ut(a,3)),this.setAttribute("uv",new ut(i,2))}}class j5 extends mt{constructor(e=1,t=32,n=16,r=0,a=2*Math.PI,i=0,s=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:n,phiStart:r,phiLength:a,thetaStart:i,thetaLength:s},t=Math.max(3,Math.floor(t)),n=Math.max(2,Math.floor(n));const c=Math.min(i+s,Math.PI);let u=0;const h=[],f=new B,m=new B,g=[],A=[],_=[],x=[];for(let C=0;C<=n;C++){const b=[],y=C/n;let M=0;C==0&&i==0?M=.5/t:C==n&&c==Math.PI&&(M=-.5/t);for(let R=0;R<=t;R++){const T=R/t;f.x=-e*Math.cos(r+T*a)*Math.sin(i+y*s),f.y=e*Math.cos(i+y*s),f.z=e*Math.sin(r+T*a)*Math.sin(i+y*s),A.push(f.x,f.y,f.z),m.copy(f).normalize(),_.push(m.x,m.y,m.z),x.push(T+M,1-y),b.push(u++)}h.push(b)}for(let C=0;C<n;C++)for(let b=0;b<t;b++){const y=h[C][b+1],M=h[C][b],R=h[C+1][b],T=h[C+1][b+1];(C!==0||i>0)&&g.push(y,M,T),(C!==n-1||c<Math.PI)&&g.push(M,R,T)}this.setIndex(g),this.setAttribute("position",new ut(A,3)),this.setAttribute("normal",new ut(_,3)),this.setAttribute("uv",new ut(x,2))}}class Pee extends gp{constructor(e=1,t=0){super([1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],e,t),this.type="TetrahedronGeometry",this.parameters={radius:e,detail:t}}}class Nee extends mt{constructor(e=1,t=.4,n=12,r=48,a=2*Math.PI){super(),this.type="TorusGeometry",this.parameters={radius:e,tube:t,radialSegments:n,tubularSegments:r,arc:a},n=Math.floor(n),r=Math.floor(r);const i=[],s=[],c=[],u=[],h=new B,f=new B,m=new B;for(let g=0;g<=n;g++)for(let A=0;A<=r;A++){const _=A/r*a,x=g/n*Math.PI*2;f.x=(e+t*Math.cos(x))*Math.cos(_),f.y=(e+t*Math.cos(x))*Math.sin(_),f.z=t*Math.sin(x),s.push(f.x,f.y,f.z),h.x=e*Math.cos(_),h.y=e*Math.sin(_),m.subVectors(f,h).normalize(),c.push(m.x,m.y,m.z),u.push(A/r),u.push(g/n)}for(let g=1;g<=n;g++)for(let A=1;A<=r;A++){const _=(r+1)*g+A-1,x=(r+1)*(g-1)+A-1,C=(r+1)*(g-1)+A,b=(r+1)*g+A;i.push(_,x,b),i.push(x,C,b)}this.setIndex(i),this.setAttribute("position",new ut(s,3)),this.setAttribute("normal",new ut(c,3)),this.setAttribute("uv",new ut(u,2))}}class eb extends mt{constructor(e=1,t=.4,n=64,r=8,a=2,i=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:t,tubularSegments:n,radialSegments:r,p:a,q:i},n=Math.floor(n),r=Math.floor(r);const s=[],c=[],u=[],h=[],f=new B,m=new B,g=new B,A=new B,_=new B,x=new B,C=new B;for(let y=0;y<=n;++y){const M=y/n*a*Math.PI*2;b(M,a,i,e,g),b(M+.01,a,i,e,A),x.subVectors(A,g),C.addVectors(A,g),_.crossVectors(x,C),C.crossVectors(_,x),_.normalize(),C.normalize();for(let R=0;R<=r;++R){const T=R/r*Math.PI*2,w=-t*Math.cos(T),D=t*Math.sin(T);f.x=g.x+(w*C.x+D*_.x),f.y=g.y+(w*C.y+D*_.y),f.z=g.z+(w*C.z+D*_.z),c.push(f.x,f.y,f.z),m.subVectors(f,g).normalize(),u.push(m.x,m.y,m.z),h.push(y/n),h.push(R/r)}}for(let y=1;y<=n;y++)for(let M=1;M<=r;M++){const R=(r+1)*(y-1)+(M-1),T=(r+1)*y+(M-1),w=(r+1)*y+M,D=(r+1)*(y-1)+M;s.push(R,T,D),s.push(T,w,D)}function b(y,M,R,T,w){const D=Math.cos(y),z=Math.sin(y),F=R/M*y,O=Math.cos(F);w.x=T*(2+O)*.5*D,w.y=T*(2+O)*z*.5,w.z=T*Math.sin(F)*.5}this.setIndex(s),this.setAttribute("position",new ut(c,3)),this.setAttribute("normal",new ut(u,3)),this.setAttribute("uv",new ut(h,2))}static fromJSON(e){return new eb(e.radius,e.tube,e.tubularSegments,e.radialSegments,e.p,e.q)}}class Dee extends mt{constructor(e=new U5(new B(-1,-1,0),new B(-1,1,0),new B(1,1,0)),t=64,n=1,r=8,a=!1){super(),this.type="TubeGeometry",this.parameters={path:e,tubularSegments:t,radius:n,radialSegments:r,closed:a};const i=e.computeFrenetFrames(t,a);this.tangents=i.tangents,this.normals=i.normals,this.binormals=i.binormals;const s=new B,c=new B,u=new Ee;let h=new B;const f=[],m=[],g=[],A=[];function _(x){h=e.getPointAt(x/t,h);const C=i.normals[x],b=i.binormals[x];for(let y=0;y<=r;y++){const M=y/r*Math.PI*2,R=Math.sin(M),T=-Math.cos(M);c.x=T*C.x+R*b.x,c.y=T*C.y+R*b.y,c.z=T*C.z+R*b.z,c.normalize(),m.push(c.x,c.y,c.z),s.x=h.x+n*c.x,s.y=h.y+n*c.y,s.z=h.z+n*c.z,f.push(s.x,s.y,s.z)}}(function(){for(let x=0;x<t;x++)_(x);_(a===!1?t:0),function(){for(let x=0;x<=t;x++)for(let C=0;C<=r;C++)u.x=x/t,u.y=C/r,g.push(u.x,u.y)}(),function(){for(let x=1;x<=t;x++)for(let C=1;C<=r;C++){const b=(r+1)*(x-1)+(C-1),y=(r+1)*x+(C-1),M=(r+1)*x+C,R=(r+1)*(x-1)+C;A.push(b,y,R),A.push(y,M,R)}}()})(),this.setIndex(A),this.setAttribute("position",new ut(f,3)),this.setAttribute("normal",new ut(m,3)),this.setAttribute("uv",new ut(g,2))}}class X5 extends mt{constructor(e=null){if(super(),this.type="WireframeGeometry",this.parameters={geometry:e},e!==null){const t=[],n=new Set,r=new B,a=new B;if(e.index!==null){const i=e.attributes.position,s=e.index;let c=e.groups;c.length===0&&(c=[{start:0,count:s.count,materialIndex:0}]);for(let u=0,h=c.length;u<h;++u){const f=c[u],m=f.start;for(let g=m,A=m+f.count;g<A;g+=3)for(let _=0;_<3;_++){const x=s.getX(g+_),C=s.getX(g+(_+1)%3);r.fromBufferAttribute(i,x),a.fromBufferAttribute(i,C),lw(r,a,n)===!0&&(t.push(r.x,r.y,r.z),t.push(a.x,a.y,a.z))}}}else{const i=e.attributes.position;for(let s=0,c=i.count/3;s<c;s++)for(let u=0;u<3;u++){const h=3*s+u,f=3*s+(u+1)%3;r.fromBufferAttribute(i,h),a.fromBufferAttribute(i,f),lw(r,a,n)===!0&&(t.push(r.x,r.y,r.z),t.push(a.x,a.y,a.z))}}this.setAttribute("position",new ut(t,3))}}}function lw(o,e,t){const n=`${o.x},${o.y},${o.z}-${e.x},${e.y},${e.z}`,r=`${e.x},${e.y},${e.z}-${o.x},${o.y},${o.z}`;return t.has(n)!==!0&&t.has(r)!==!0&&(t.add(n),t.add(r),!0)}class Oee extends mt{constructor(e=50,t=10,n=!0,r=!0,a=!0,i=!0,s=!0){const c=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,3,16,17,18,7,19,20,21,11,22,23,24,15,25,26,27,18,28,29,30,21,31,32,33,24,34,35,36,27,37,38,39,30,40,41,0,33,42,43,4,36,44,45,8,39,46,47,12,12,13,14,15,48,49,50,51,52,53,54,55,56,57,58,59,15,25,26,27,51,60,61,62,55,63,64,65,59,66,67,68,27,37,38,39,62,69,70,71,65,72,73,74,68,75,76,77,39,46,47,12,71,78,79,48,74,80,81,52,77,82,83,56,56,57,58,59,84,85,86,87,88,89,90,91,92,93,94,95,59,66,67,68,87,96,97,98,91,99,100,101,95,102,103,104,68,75,76,77,98,105,106,107,101,108,109,110,104,111,112,113,77,82,83,56,107,114,115,84,110,116,117,88,113,118,119,92,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,123,136,137,120,127,138,139,124,131,140,141,128,135,142,143,132,132,133,134,135,144,145,146,147,148,149,150,151,68,152,153,154,135,142,143,132,147,155,156,144,151,157,158,148,154,159,160,68,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,164,177,178,161,168,179,180,165,172,181,182,169,176,183,184,173,173,174,175,176,185,186,187,188,189,190,191,192,193,194,195,196,176,183,184,173,188,197,198,185,192,199,200,189,196,201,202,193,203,203,203,203,204,205,206,207,208,208,208,208,209,210,211,212,203,203,203,203,207,213,214,215,208,208,208,208,212,216,217,218,203,203,203,203,215,219,220,221,208,208,208,208,218,222,223,224,203,203,203,203,221,225,226,204,208,208,208,208,224,227,228,209,209,210,211,212,229,230,231,232,233,234,235,236,237,238,239,240,212,216,217,218,232,241,242,243,236,244,245,246,240,247,248,249,218,222,223,224,243,250,251,252,246,253,254,255,249,256,257,258,224,227,228,209,252,259,260,229,255,261,262,233,258,263,264,237,265,265,265,265,266,267,268,269,270,271,272,273,92,119,118,113,265,265,265,265,269,274,275,276,273,277,278,279,113,112,111,104,265,265,265,265,276,280,281,282,279,283,284,285,104,103,102,95,265,265,265,265,282,286,287,266,285,288,289,270,95,94,93,92],u=[1.4,0,2.4,1.4,-.784,2.4,.784,-1.4,2.4,0,-1.4,2.4,1.3375,0,2.53125,1.3375,-.749,2.53125,.749,-1.3375,2.53125,0,-1.3375,2.53125,1.4375,0,2.53125,1.4375,-.805,2.53125,.805,-1.4375,2.53125,0,-1.4375,2.53125,1.5,0,2.4,1.5,-.84,2.4,.84,-1.5,2.4,0,-1.5,2.4,-.784,-1.4,2.4,-1.4,-.784,2.4,-1.4,0,2.4,-.749,-1.3375,2.53125,-1.3375,-.749,2.53125,-1.3375,0,2.53125,-.805,-1.4375,2.53125,-1.4375,-.805,2.53125,-1.4375,0,2.53125,-.84,-1.5,2.4,-1.5,-.84,2.4,-1.5,0,2.4,-1.4,.784,2.4,-.784,1.4,2.4,0,1.4,2.4,-1.3375,.749,2.53125,-.749,1.3375,2.53125,0,1.3375,2.53125,-1.4375,.805,2.53125,-.805,1.4375,2.53125,0,1.4375,2.53125,-1.5,.84,2.4,-.84,1.5,2.4,0,1.5,2.4,.784,1.4,2.4,1.4,.784,2.4,.749,1.3375,2.53125,1.3375,.749,2.53125,.805,1.4375,2.53125,1.4375,.805,2.53125,.84,1.5,2.4,1.5,.84,2.4,1.75,0,1.875,1.75,-.98,1.875,.98,-1.75,1.875,0,-1.75,1.875,2,0,1.35,2,-1.12,1.35,1.12,-2,1.35,0,-2,1.35,2,0,.9,2,-1.12,.9,1.12,-2,.9,0,-2,.9,-.98,-1.75,1.875,-1.75,-.98,1.875,-1.75,0,1.875,-1.12,-2,1.35,-2,-1.12,1.35,-2,0,1.35,-1.12,-2,.9,-2,-1.12,.9,-2,0,.9,-1.75,.98,1.875,-.98,1.75,1.875,0,1.75,1.875,-2,1.12,1.35,-1.12,2,1.35,0,2,1.35,-2,1.12,.9,-1.12,2,.9,0,2,.9,.98,1.75,1.875,1.75,.98,1.875,1.12,2,1.35,2,1.12,1.35,1.12,2,.9,2,1.12,.9,2,0,.45,2,-1.12,.45,1.12,-2,.45,0,-2,.45,1.5,0,.225,1.5,-.84,.225,.84,-1.5,.225,0,-1.5,.225,1.5,0,.15,1.5,-.84,.15,.84,-1.5,.15,0,-1.5,.15,-1.12,-2,.45,-2,-1.12,.45,-2,0,.45,-.84,-1.5,.225,-1.5,-.84,.225,-1.5,0,.225,-.84,-1.5,.15,-1.5,-.84,.15,-1.5,0,.15,-2,1.12,.45,-1.12,2,.45,0,2,.45,-1.5,.84,.225,-.84,1.5,.225,0,1.5,.225,-1.5,.84,.15,-.84,1.5,.15,0,1.5,.15,1.12,2,.45,2,1.12,.45,.84,1.5,.225,1.5,.84,.225,.84,1.5,.15,1.5,.84,.15,-1.6,0,2.025,-1.6,-.3,2.025,-1.5,-.3,2.25,-1.5,0,2.25,-2.3,0,2.025,-2.3,-.3,2.025,-2.5,-.3,2.25,-2.5,0,2.25,-2.7,0,2.025,-2.7,-.3,2.025,-3,-.3,2.25,-3,0,2.25,-2.7,0,1.8,-2.7,-.3,1.8,-3,-.3,1.8,-3,0,1.8,-1.5,.3,2.25,-1.6,.3,2.025,-2.5,.3,2.25,-2.3,.3,2.025,-3,.3,2.25,-2.7,.3,2.025,-3,.3,1.8,-2.7,.3,1.8,-2.7,0,1.575,-2.7,-.3,1.575,-3,-.3,1.35,-3,0,1.35,-2.5,0,1.125,-2.5,-.3,1.125,-2.65,-.3,.9375,-2.65,0,.9375,-2,-.3,.9,-1.9,-.3,.6,-1.9,0,.6,-3,.3,1.35,-2.7,.3,1.575,-2.65,.3,.9375,-2.5,.3,1.125,-1.9,.3,.6,-2,.3,.9,1.7,0,1.425,1.7,-.66,1.425,1.7,-.66,.6,1.7,0,.6,2.6,0,1.425,2.6,-.66,1.425,3.1,-.66,.825,3.1,0,.825,2.3,0,2.1,2.3,-.25,2.1,2.4,-.25,2.025,2.4,0,2.025,2.7,0,2.4,2.7,-.25,2.4,3.3,-.25,2.4,3.3,0,2.4,1.7,.66,.6,1.7,.66,1.425,3.1,.66,.825,2.6,.66,1.425,2.4,.25,2.025,2.3,.25,2.1,3.3,.25,2.4,2.7,.25,2.4,2.8,0,2.475,2.8,-.25,2.475,3.525,-.25,2.49375,3.525,0,2.49375,2.9,0,2.475,2.9,-.15,2.475,3.45,-.15,2.5125,3.45,0,2.5125,2.8,0,2.4,2.8,-.15,2.4,3.2,-.15,2.4,3.2,0,2.4,3.525,.25,2.49375,2.8,.25,2.475,3.45,.15,2.5125,2.9,.15,2.475,3.2,.15,2.4,2.8,.15,2.4,0,0,3.15,.8,0,3.15,.8,-.45,3.15,.45,-.8,3.15,0,-.8,3.15,0,0,2.85,.2,0,2.7,.2,-.112,2.7,.112,-.2,2.7,0,-.2,2.7,-.45,-.8,3.15,-.8,-.45,3.15,-.8,0,3.15,-.112,-.2,2.7,-.2,-.112,2.7,-.2,0,2.7,-.8,.45,3.15,-.45,.8,3.15,0,.8,3.15,-.2,.112,2.7,-.112,.2,2.7,0,.2,2.7,.45,.8,3.15,.8,.45,3.15,.112,.2,2.7,.2,.112,2.7,.4,0,2.55,.4,-.224,2.55,.224,-.4,2.55,0,-.4,2.55,1.3,0,2.55,1.3,-.728,2.55,.728,-1.3,2.55,0,-1.3,2.55,1.3,0,2.4,1.3,-.728,2.4,.728,-1.3,2.4,0,-1.3,2.4,-.224,-.4,2.55,-.4,-.224,2.55,-.4,0,2.55,-.728,-1.3,2.55,-1.3,-.728,2.55,-1.3,0,2.55,-.728,-1.3,2.4,-1.3,-.728,2.4,-1.3,0,2.4,-.4,.224,2.55,-.224,.4,2.55,0,.4,2.55,-1.3,.728,2.55,-.728,1.3,2.55,0,1.3,2.55,-1.3,.728,2.4,-.728,1.3,2.4,0,1.3,2.4,.224,.4,2.55,.4,.224,2.55,.728,1.3,2.55,1.3,.728,2.55,.728,1.3,2.4,1.3,.728,2.4,0,0,0,1.425,0,0,1.425,.798,0,.798,1.425,0,0,1.425,0,1.5,0,.075,1.5,.84,.075,.84,1.5,.075,0,1.5,.075,-.798,1.425,0,-1.425,.798,0,-1.425,0,0,-.84,1.5,.075,-1.5,.84,.075,-1.5,0,.075,-1.425,-.798,0,-.798,-1.425,0,0,-1.425,0,-1.5,-.84,.075,-.84,-1.5,.075,0,-1.5,.075,.798,-1.425,0,1.425,-.798,0,.84,-1.5,.075,1.5,-.84,.075];super(),t=Math.max(2,Math.floor(t));const h=3.15*(s?1:1.3)/2,f=e/h;let m=n?(8*t-4)*t:0;m+=r?(16*t-4)*t:0,m+=a?40*t*t:0;const g=new Uint32Array(3*m);let A=n?4:0;A+=r?8:0,A+=a?20:0,A*=(t+1)*(t+1);const _=new Float32Array(3*A),x=new Float32Array(3*A),C=new Float32Array(2*A),b=new Ve;b.set(-1,3,-3,1,3,-6,3,0,-3,3,0,0,1,0,0,0);const y=[],M=[],R=[],T=[],w=[],D=[],z=[],F=[],O=[],q=new B;let ne,$,he,K,oe=0,ie=0;const L=new B,U=new Ve,k=new Ve,J=new ct,de=new ct,te=new ct,le=new ct,V=new B,G=new B,ee=b.clone();ee.transpose();const X=(ce,fe,ve)=>!(_[3*ce]===_[3*fe]&&_[3*ce+1]===_[3*fe+1]&&_[3*ce+2]===_[3*fe+2]||_[3*ce]===_[3*ve]&&_[3*ce+1]===_[3*ve+1]&&_[3*ce+2]===_[3*ve+2]||_[3*fe]===_[3*ve]&&_[3*fe+1]===_[3*ve+1]&&_[3*fe+2]===_[3*ve+2]);for(let ce=0;ce<3;ce++)D[ce]=new Ve;const W=n?32:28,Y=t+1;let P=0,Q=0,I=0,N=0,se=0;for(let ce=a?0:20;ce<W;ce++)if(r||ce<20||ce>=28){for(let fe=0;fe<3;fe++){for(let ve=0;ve<4;ve++)for(let xe=0;xe<4;xe++)y[4*xe+ve]=u[3*c[16*ce+4*ve+xe]+fe],i&&ce>=20&&ce<28&&fe!==2&&(y[4*xe+ve]*=1.077),s||fe!==2||(y[4*xe+ve]*=1.3);U.set(y[0],y[1],y[2],y[3],y[4],y[5],y[6],y[7],y[8],y[9],y[10],y[11],y[12],y[13],y[14],y[15]),k.multiplyMatrices(U,b),D[fe].multiplyMatrices(ee,k)}for(let fe=0;fe<=t;fe++){const ve=fe/t;for(let xe=0;xe<=t;xe++){const Ie=xe/t;for(K=4,$=he=1;K--;)M[K]=$,R[K]=he,$*=ve,he*=Ie,K===3?(T[K]=w[K]=0,oe=ie=1):(T[K]=oe*(3-K),w[K]=ie*(3-K),oe*=ve,ie*=Ie);J.fromArray(M),de.fromArray(R),te.fromArray(T),le.fromArray(w);for(let re=0;re<3;re++)ne=J.clone(),ne.applyMatrix4(D[re]),z[re]=ne.dot(de),ne=te.clone(),ne.applyMatrix4(D[re]),F[re]=ne.dot(de),ne=J.clone(),ne.applyMatrix4(D[re]),O[re]=ne.dot(le);V.fromArray(F),G.fromArray(O),q.crossVectors(G,V),q.normalize(),z[0]===0&&z[1]===0?L.set(0,z[2]>h?1:-1,0):L.set(q.x,q.z,-q.y),_[Q++]=f*z[0],_[Q++]=f*(z[2]-h),_[Q++]=-f*z[1],x[I++]=L.x,x[I++]=L.y,x[I++]=L.z,C[N++]=1-Ie,C[N++]=1-ve}}for(let fe=0;fe<t;fe++)for(let ve=0;ve<t;ve++){const xe=P*Y*Y+fe*Y+ve,Ie=xe+1,re=Ie+Y,me=xe+Y;X(xe,Ie,re)&&(g[se++]=xe,g[se++]=Ie,g[se++]=re),X(xe,re,me)&&(g[se++]=xe,g[se++]=re,g[se++]=me)}P++}this.setIndex(new $e(g,1)),this.setAttribute("position",new $e(_,3)),this.setAttribute("normal",new $e(x,3)),this.setAttribute("uv",new $e(C,2)),this.computeBoundingSphere()}}class Tv extends W5{constructor(e,t={}){const n=t.font;if(!n||!n.isFont)return console.error("v3d.TextGeometry: font parameter is not an instance of v3d.Font."),new mt;t.alignX===void 0&&(t.alignX="left"),t.alignY===void 0&&(t.alignY="topBaseline"),t.lineHeight===void 0&&(t.lineHeight=-1),t.scaledEmSize===void 0&&(t.scaledEmSize=!1);const r=n.generateShapes(e,t.size,t.alignX,t.alignY,t.lineHeight,t.scaledEmSize);t.depth=t.height!==void 0?t.height:50,t.bevelThickness===void 0&&(t.bevelThickness=10),t.bevelSize===void 0&&(t.bevelSize=8),t.bevelEnabled===void 0&&(t.bevelEnabled=!1),super(r,t),this.type="TextGeometry",this.parameters={text:e,parameters:t}}cloneWithText(e){const t=this.parameters.parameters;return new Tv(e,{font:t.font,size:t.size,height:t.height,curveSegments:t.curveSegments,bevelEnabled:t.bevelEnabled,bevelThickness:t.bevelThickness,bevelSize:t.bevelSize,alignX:t.alignX,alignY:t.alignY,lineHeight:t.lineHeight,scaledEmSize:t.scaledEmSize})}}class Fee extends Er{constructor(e){super(),this.isShadowMaterial=!0,this.type="ShadowMaterial",this.color=new Qe(0),this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.fog=e.fog,this}}class Rv extends Er{constructor(e){super(),this.isMeshStandardMaterial=!0,this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new Qe(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Qe(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new Ee(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.fog=!0,this.envMapParallaxType=0,this.envMapParallaxMatrix=new Ve,this.envMapParallaxMatrixInv=new Ve,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapIntensity=e.envMapIntensity,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.flatShading=e.flatShading,this.fog=e.fog,this.envMapParallaxType=e.envMapParallaxType,this.envMapParallaxMatrix.copy(e.envMapParallaxMatrix),this.envMapParallaxMatrixInv.copy(e.envMapParallaxMatrixInv),this}}class w2 extends Rv{constructor(e){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new Ee(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return Ft(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(t){this.ior=(1+.4*t)/(1-.4*t)}}),this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new Qe(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new Qe(1,1,1),this.specularColorMap=null,this._clearcoat=0,this._transmission=0,this.setValues(e)}get clearcoat(){return this._clearcoat}set clearcoat(e){this._clearcoat>0!=e>0&&this.version++,this._clearcoat=e}get transmission(){return this._transmission}set transmission(e){this._transmission>0!=e>0&&this.version++,this._transmission=e}copy(e){return super.copy(e),this.defines={STANDARD:"",PHYSICAL:""},this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.ior=e.ior,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,this.attenuationColor.copy(e.attenuationColor),this.specularIntensity=e.specularIntensity,this.specularIntensityMap=e.specularIntensityMap,this.specularColor.copy(e.specularColor),this.specularColorMap=e.specularColorMap,this}}class q5 extends Er{constructor(e){super(),this.isMeshNormalMaterial=!0,this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new Ee(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.flatShading=e.flatShading,this}}class Iv extends Er{constructor(e){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new Qe(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Qe(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new Ee(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.flatShading=e.flatShading,this.fog=e.fog,this}}class Uee extends gr{constructor(e){super(),this.isLineDashedMaterial=!0,this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}copy(e){return super.copy(e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this}}class tb extends pp{constructor(e){super(),this.isMeshLineMaterial=!0,this.type="MeshLineMaterial",this.lineWidth=1,this.sizeAttenuation=1,this.color=new Qe(16777215),this.opacity=1,this.useMap=0,this.map=null,this.useAlphaMap=0,this.alphaMap=null,this.visibility=1,this.alphaTest=0,this.repeat=new Ee(1,1),this.uniforms={lineWidth:{value:1},sizeAttenuation:{value:1},color:{value:new Qe(16777215)},opacity:{value:1},useMap:{value:0},map:{value:null},alphaMap:{value:null},useAlphaMap:{value:0},visibility:{value:1},alphaTest:{value:0},repeat:{value:new Ee(1,1)}},this.vertexShader=Ye.raw_meshline_vert,this.fragmentShader=Ye.raw_meshline_frag,this.setValues(e)}copy(e){return super.copy(e),this.lineWidth=e.lineWidth,this.sizeAttenuation=e.sizeAttenuation,this.color.copy(e.color),this.opacity=e.opacity,this.useMap=e.useMap,this.map=e.map,this.useAlphaMap=e.useAlphaMap,this.alphaMap=e.alphaMap,this.visibility=e.visibility,this.alphaTest=e.alphaTest,this.repeat.copy(e.repeat),this}}class Z5 extends Er{constructor(e){super(),this.isMeshMaskMaterial=!0,this.type="MeshMaskMaterial",this.side=2,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.lights=!1,this.cameraNearFar=null,this.depthTexture=null,this.textureMatrix=null,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,e.cameraNearFar&&(this.cameraNearFar=e.cameraNearFar.clone()),e.textureMatrix&&(this.textureMatrix=e.textureMatrix.clone()),e.depthTexture&&(this.depthTexture=e.depthTexture),this}}class Ld{constructor(e,t,n,r){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=r!==void 0?r:new t.constructor(n),this.sampleValues=t,this.valueSize=n,this.settings=null,this.DefaultSettings_={}}evaluate(e){const t=this.parameterPositions;let n=this._cachedIndex,r=t[n],a=t[n-1];e:{t:{let i;n:{r:if(!(e<r)){for(let s=n+2;;){if(r===void 0){if(e<a)break r;return n=t.length,this._cachedIndex=n,this.copySampleValue_(n-1)}if(n===s)break;if(a=r,r=t[++n],e<r)break t}i=t.length;break n}if(e>=a)break e;{const s=t[1];e<s&&(n=2,a=s);for(let c=n-2;;){if(a===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(n===c)break;if(r=a,a=t[--n-1],e>=a)break t}i=n,n=0}}for(;n<i;){const s=n+i>>>1;e<t[s]?i=s:n=s+1}if(r=t[n],a=t[n-1],a===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(r===void 0)return n=t.length,this._cachedIndex=n,this.copySampleValue_(n-1)}this._cachedIndex=n,this.intervalChanged_(n,a,r)}return this.interpolate_(n,a,e,r)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){const t=this.resultBuffer,n=this.sampleValues,r=this.valueSize,a=e*r;for(let i=0;i!==r;++i)t[i]=n[a+i];return t}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class nb extends Ld{constructor(e,t,n,r){super(e,t,n,r)}interpolate_(e){return this.copySampleValue_(e-1)}}const cw=function(o){this.value=o,this.next=null},rs=function(){this.N=0,this.first=null};rs.prototype.push=function(o){this.first=this._push(this.first,o)},rs.prototype._push=function(o,e){if(o==null)return this.N++,new cw(e);const t=o;return this.N++,(o=new cw(e)).next=t,o},rs.prototype.pop=function(){if(this.first==null)return;const o=this.first,e=o.value;return this.first=o.next,this.N--,e},rs.prototype.size=function(){return this.N},rs.prototype.isEmpty=function(){return this.N==0},rs.prototype.peep=function(){if(this.first!=null)return this.first.value},rs.prototype.toArray=function(){const o=[];let e=this.first;for(;e!=null;)o.push(e.value),e=e.next;return o};const K5=function(o){this.value=o,this.prev=null,this.next=null},Wg=function(){this.first=null,this.last=null,this.map={}};Wg.prototype.push=function(o,e){this.map[e]=o,this.first===null?(this.first=o,this.last=o):(this.last.next=o,o.prev=this.last,this.last=o)},Wg.prototype.removeNodeByKey=function(o){const e=this.map[o],t=e.prev,n=e.next;t!==null&&n!==null?(t.next=n,n.prev=t):t===null&&n!==null?(this.first=n,n.prev=null):t!==null&&n===null?(this.last=t,t.next=null):(this.first=null,this.last=null),delete this.map[o]};const bn=function(o=0){this.V=o,this.adjList=[],this.nodeInfo=[],this.edges={};for(let e=0;e<o;++e)this.adjList.push([]),this.nodeInfo.push({})};bn.prototype.removeAll=function(){this.V=0,this.adjList=[],this.nodeInfo=[],this.edges={}},bn.prototype.addNode=function(o){o=o||{},this.V++,this.adjList.push([]),this.nodeInfo.push(o)},bn.prototype.addNewEdge=function(o,e){this.adjList[o].push(e);const t=o+"_"+e,n=new ko(o,e,0);return this.edges[t]=n,n},bn.prototype.addEdge=function(o){const e=o.v,t=o.w;this.adjList[e].push(t);const n=e+"_"+t;this.edges[n]=o},bn.prototype.removeEdge=function(o,e){const t=this.adjList[o];for(let r=0;r<t.length;r++)t[r]==e&&(t.splice(r,1),r--);const n=o+"_"+e;n in this.edges&&delete this.edges[n]},bn.prototype.edge=function(o,e){const t=o+"_"+e;return t in this.edges?this.edges[t]:null},bn.prototype.adj=function(o){return this.adjList[o]},bn.prototype.node=function(o){return this.nodeInfo[o]},bn.prototype.nodeIndex=function(o){for(let e=0;e<this.V;++e)if(this.nodeInfo[e]==o)return e;return-1},bn.prototype.reverse=function(){const o=new bn(this.V);for(let e=0;e<this.V;++e){const t=this.adjList[e];for(let n=0;n<t.length;++n){const r=t[n];o.addNewEdge(r,e)}}return o},bn.prototype.len=function(){return this.V},bn.prototype.findInEdges=function(o){const e=[];for(let t=0;t<this.V;t++){const n=this.adjList[t];for(let r=0;r<n.length;r++)n[r]==o&&e.push(this.edge(t,o))}return e},bn.prototype.findOutEdges=function(o){const e=[],t=this.adjList[o];for(let n=0;n<t.length;n++)e.push(this.edge(o,t[n]));return e},bn.prototype.disconnect=function(o,e){this.adjList[o].splice(0);for(let t=0;t<this.V;t++){const n=this.adjList[t];for(let a=0;a<n.length;a++)n[a]==o&&(n.splice(a,1),a--);let r=t+"_"+o;r in this.edges&&delete this.edges[r],r=o+"_"+t,r in this.edges&&delete this.edges[r]}if(e){const t=new bn(this.V-1);for(let n=0;n<this.V;n++){if(n==o)continue;const r=this.adjList[n];for(let a=0;a<r.length;a++){const i=r[a],s=n>o?n-1:n,c=i>o?i-1:i,u=this.edge(n,i).copy();u.v=s,u.w=c,t.addEdge(u)}}this.V--,this.adjList=t.adjList,this.nodeInfo.splice(o,1),this.edges=t.edges}},bn.prototype.insert=function(o,e,t,n=a=>a,r=a=>a){const a=this.V,i=o.V;for(let s=0;s<i;s++){this.adjList.push([]),this.nodeInfo.push(n(o.nodeInfo[s]));const c=o.adjList[s];for(let u=0;u<c.length;u++){const h=c[u],f=o.edge(s,h).copy(r);f.v+=a,f.w+=a,this.addEdge(f)}}this.V+=i;for(let s=0;s<e.length;s++){const c=e[s].copy(r);c.w+=a,this.addEdge(c)}for(let s=0;s<t.length;s++){const c=t[s].copy(r);c.v+=a,this.addEdge(c)}},bn.prototype.vis=function(o){o=o||function(t,n){return String(t)};let e="digraph G {";for(let t=0;t<this.V;t++){e+=t+' [label="'+o(t,this.nodeInfo[t])+'"];';const n=this.adjList[t];for(let r=0;r<n.length;r++)e+=t+" -> "+n[r]+";"}e+="}",console.log(e)};const ko=function(o,e,t=0){this.v=o,this.w=e,this.weight=t};ko.prototype.either=function(){return this.v},ko.prototype.other=function(o){return o==this.v?this.w:this.v},ko.prototype.from=function(){return this.v},ko.prototype.to=function(){return this.w},ko.prototype.copy=function(o=e=>e){const e=new ko(0,0,0);for(const t in this)this.hasOwnProperty(t)&&(typeof this[t]=="object"?e[t]=o(this[t]):e[t]=this[t]);return e};const $u=function(o){this.V=o,this.adjList=[],this.nodeInfo=[];for(let e=0;e<o;++e)this.adjList.push([]),this.nodeInfo.push({})};$u.prototype.adj=function(o){return this.adjList[o]},$u.prototype.edge=function(o,e){const t=this.adjList[o];for(let n=0;n<t.length;++n)if(t[n].other(o)==e)return t[n];return null},$u.prototype.node=function(o){return this.nodeInfo[o]},$u.prototype.addNewEdge=function(o){const e=o.either(),t=o.other(e);this.adjList[e].push(o),this.adjList[t].push(o)};const GA=function(o){$u.call(this,o)};(GA.prototype=Object.create($u.prototype)).addNewEdge=function(o){const e=o.from();this.adjList[e].push(o)},GA.prototype.edge=function(o,e){const t=this.adjList[o];for(let n=0;n<t.length;++n)if(t[n].other(o)==e)return t[n];return null},GA.prototype.toDiGraph=function(){const o=new bn(this.V);for(let e=0;e<this.V;++e){const t=this.adjList[e];for(let n=0;n<t.length;++n){const r=t[n].other(e);o.addNewEdge(e,r)}}return o};const bh=function(o,e){this.s=e;const t=o.V;this.marked=[],this.edgeTo=[];for(let n=0;n<t;++n)this.marked.push(!1),this.edgeTo.push(-1);this.dfs(o,e)};bh.prototype.dfs=function(o,e){this.marked[e]=!0;const t=o.adj(e);for(let n=0;n<t.length;++n){const r=t[n];this.marked[r]||(this.edgeTo[r]=e,this.dfs(o,r))}},bh.prototype.hasPathTo=function(o){return this.marked[o]},bh.prototype.pathTo=function(o){const e=new rs;if(o==this.s)return[o];for(let t=o;t!=this.s;t=this.edgeTo[t])e.push(t);return e.push(this.s),e.toArray()};const Yg=function(o){this.postOrder=new rs,this.marked=[];const e=o.V;for(let t=0;t<e;++t)this.marked.push(!1);for(let t=0;t<e;++t)this.marked[t]||this.dfs(o,t)};Yg.prototype.dfs=function(o,e){this.marked[e]=!0;const t=o.adj(e);for(let n=0;n<t.length;++n){const r=t[n];this.marked[r]||this.dfs(o,r)}this.postOrder.push(e)},Yg.prototype.order=function(){return this.postOrder.toArray()};var zee=Object.freeze({__proto__:null,DepthFirstSearch:bh,DiGraph:bn,Edge:ko,LinkMap:Wg,LinkMapNode:K5,TopologicalSort:Yg}),Vee=[-1.117001,-.1867262,-11.13505,12.59865,-.03937339,1.167571,.007100686,3.592678,.6083296,-1.152006,-.1926669,6.152049,-4.770802,-.08704701,.7483626,.03372718,4.464592,.4036546,-1.072371,-.2696632,.2816168,1.820571,-.3742666,2.080607,-.07675295,-2.835366,1.129329,-1.109935,-.1532764,1.198787,-.9015183,.005173015,.5749178,.1075633,4.387949,.2650413,-1.052297,-.2229452,1.952347,.5727205,-4.88507,1.984016,-.1106197,-.4898361,.8907873,-1.070108,-.1600465,1.593886,-4479251e-11,-3.306541,.9390193,.09513168,2.343583,.5335404,-1.113253,-.16996,-10.38822,11.37513,-.04040911,1.037455,.04991792,4.801919,.630271,-1.135747,-.1678594,4.970755,-4.43023,-.06657408,.3636161,.1558009,6.01337,.3959601,-1.095892,-.2732595,.7666496,1.350731,-.4401401,2.470135,-.1707929,-3.260793,1.170337,-1.073668,-.02603929,-.1944589,.4575207,.6878164,-.139077,.3690299,7.885781,.1877694,-1.070091,-.2798957,2.338478,-2.647221,-7.387808,2.32921,-.1644639,-2.00371,.9874527,-1.06712,-.1418866,1.25409,6.053048,-2.918892,.5322812,.1613053,3.018161,.527409,-1.129483,-.1890619,-9.065101,9.659923,-.03607819,.8314359,.08181661,4.768868,.6339777,-1.14642,-.1883579,3.309173,-3.127882,-.06938176,.3987113,.1400581,6.283042,.5267076,-1.128348,-.2641305,1.223176,.05514952,-.3490649,1.997784,-.04123709,-2.251251,.9483466,-1.02582,.0140469,-1.187406,2.7299,.5877588,-.276114,.4602633,8.305125,.3945001,-1.083957,-.2606679,2.207108,-7.202803,-5.968103,2.129455,-.07789512,-1.137688,.8871769,-1.062465,-.1512189,1.042881,14.27839,-4.242214,.40381,.199778,2.814449,.5803196,-1.175099,-.2410789,-11.08587,11.33404,-.018193,.6772942,.09605043,4.231166,.6239972,-1.224207,-.2883527,3.002206,-2.649612,-.04795418,.4984398,.03251434,4.851611,.6551019,-1.136955,-.2423048,1.058823,-.2489236,-.2462179,1.93314,.09106828,-.1905869,.8171065,-1.014535,-.0082625,-1.448017,2.295788,.3510334,-1.477418,.5432449,5.762796,.4908751,-1.070666,-.237978,1.844589,-5.442448,-4.012768,2.945275,.009854725,.08455959,.814503,-1.071525,-.1777132,.807659,9.925865,-3.324623,-.6367437,.2844581,2.248384,.6544022,-1.218818,-.2952382,-13.45975,13.47153,-.006814585,.5079068,.119723,3.776949,.5836961,-1.409868,-.511433,2.776539,-2.039001,-.02673769,.4145288,.0007829342,2.275883,.6629691,-1.069151,-.09434247,.7293972,-1.222473,-.1533461,2.160357,.04626837,3.852415,.859357,-1.021306,-.1149551,-1.108414,4.178343,.4013665,-2.222814,.6929462,1.392652,.4401662,-1.074251,-.2224002,1.372356,-8.858704,-3.92266,3.020018,-.01458724,1.511186,.8288064,-1.062048,-.1526582,.4921067,14.85522,-3.229936,-.8426604,.3916243,2.678994,.6689264,-1.257023,-.33647,-15.27795,15.04223,.002717715,.302991,.1636851,3.561663,.5283161,-1.635124,-.7329993,3.523939,-2.566337,-.01902543,.5505483,-.06242176,1.065992,.6654236,-.9295823,.04845834,-.299299,-.2001327,-.08019339,1.807806,.09020277,5.095372,.8639936,-1.09374,-.2148608,-.521624,2.119777,.09506454,-1.831439,.6961204,.1102084,.4384319,-1.044181,-.1849257,.9071246,-4.648901,-2.279385,2.356502,-.04169147,1.932557,.829655,-1.061451,-.1458745,.2952267,8.967214,-3.726228,-.5022316,.5684877,3.102347,.6658443,-1.332391,-.4127769,-9.328643,9.046194,.003457775,.3377425,.1530909,3.301209,.4997917,-1.932002,-.9947777,-2.042329,3.58694,-.05642182,.8130478,-.08195988,.1118294,.5617231,-.8707374,.1286999,1.820054,-4.674706,.003317471,.5919018,.1975278,6.686519,.9631727,-1.070378,-.3030579,-.9041938,6.200201,.1232207,-.3650628,.5029403,-2.903162,.3811408,-1.063035,-.1637545,.5853072,-7.889906,-1.200641,1.035018,.1192093,3.267054,.8416151,-1.053655,-.1562286,.2423683,11.28575,-4.363262,-.0731416,.5642088,2.514023,.6670457,-1.366112,-.4718287,-7.876222,7.7469,-.009182309,.4716076,.08320252,3.165603,.5392334,-2.468204,-1.33634,-5.386723,7.072672,-.08329266,.8636876,-.01978177,-.1326218,.2979222,-.9653522,-.02373416,1.81025,-6.467262,.1410706,-.4753717,.3003095,6.551163,1.151083,-.8943186,-.2487152,-.230896,8.512648,.1298402,1.034705,.2303509,-3.924095,.2982717,-1.146999,-.2318784,.08992419,-9.933614,-.886092,-.03071656,.2852012,3.046199,.8599001,-1.032399,-.1645145,.2683599,13.27701,-4.40767,.07709869,.4951727,1.957277,.6630943,-1.46907,-.6135092,-6.506263,6.661315,-.03835383,.7150413,.007784318,2.820577,.6756784,-2.501583,-1.247404,-15.23462,16.33191,-.01204803,.5896471,-.02002023,1.144647,.06177874,-2.438672,-1.127291,5.731172,-10.2135,.0616561,-.7752641,.4708254,4.176847,1.200881,-.1513427,.09792731,-1.612349,9.814289,.05188921,1.716403,-.07039255,-2.815115,.3291874,-1.318511,-.3650554,.4221268,-9.294529,-.0439752,-.8100625,.3742719,1.834166,.822345,-1.016009,-.1820264,.1278426,11.82696,-4.801528,.4947899,.4660378,1.601254,.6702359,-1.84131,-.9781779,-4.610903,4.824662,-.05100806,.6463776,-6377724e-12,2.216875,.861853,-2.376373,-1.108657,-14.89799,15.46458,.04091025,.0976178,-.01048958,2.165834,-.1609171,-4.710318,-2.261963,6.947327,-10.34828,-.1325542,.7508674,.2247553,2.873142,1.2971,.216375,-.1944345,-2.43786,10.11314,.44505,.3111492,.2751323,-1.627906,.2531213,-1.258794,-.3524641,.8425444,-10.85313,-1.154381,-.4638014,-.002781115,.4344498,.8507091,-1.018938,-.1804153,-.06354054,15.7315,-4.386999,.6211115,.5294648,1.580749,.6586655,-1.116416,-.1917524,-10.68233,12.22221,-.03668978,1.054022,.01592132,3.180583,.562737,-1.132341,-.1671286,5.976499,-4.227366,-.09542489,.8664938,.008351793,4.876068,.4492779,-1.087635,-.3173679,.4314407,1.100555,-.4410057,1.677253,-.03005925,-4.201249,1.070902,-1.083031,-.08847705,1.291773,.4546776,.3091894,.726176,.04203659,5.990615,.3704756,-1.057899,-.2246706,2.329563,-1.219656,-5.33526,.8545378,-.03906209,-.9025499,.7797348,-1.073305,-.1522553,1.767063,1.90428,-3.101673,.3995856,.02905192,2.563977,.5753067,-1.113674,-.1759694,-9.754125,10.87391,-.03841093,.9524272,.05680219,4.227034,.6029571,-1.126496,-.1680281,5.332352,-4.575579,-.06761755,.3295335,.1194896,5.570901,.4536185,-1.103074,-.2681801,.06571479,2.396522,-.455128,2.466331,-.1232022,-3.023201,1.086379,-1.053299,-.02697173,.8379121,-.9681458,.5890692,-.4872027,.2936929,7.510139,.3079122,-1.079553,-.2710448,2.462379,-.3713554,-8.534512,1.828242,-.1686398,-1.96134,.8941077,-1.069741,-.1396394,1.657868,3.236313,-2.706344,-.2948122,.1314816,2.868457,.5413403,-1.131649,-.1954455,-7.751595,8.685861,-.04910871,.8992952,.04710143,4.254818,.6821116,-1.156689,-.1884324,3.163519,-3.091522,-.06613927,-.02575883,.1640065,6.073643,.4453468,-1.079224,-.2621389,.9446437,1.448479,-.3969384,2.626638,-.08101186,-3.016355,1.076295,-1.080832,.01033057,-.3500156,-.03281419,.5655512,-1.156742,.453471,8.774122,.2772869,-1.051202,-.2679975,2.719109,-2.190316,-6.878798,2.250481,-.2030252,-2.026527,.9701096,-1.089849,-.1598589,1.564748,6.869187,-3.05367,-.6110435,.1644472,2.370452,.551177,-1.171419,-.2429746,-8.991334,9.571216,-.02772861,.6688262,.07683478,3.785611,.6347635,-1.228554,-.2917562,2.753986,-2.49178,-.04663434,.3118303,.07546506,4.463096,.5955071,-1.093124,-.2447767,.9097406,.5448296,-.2957824,2.024167,-.0005152333,-1.069081,.9369565,-1.056994,.01569507,-.8217491,1.870818,.706193,-1.483928,.5978206,6.864902,.3673332,-1.054871,-.2758129,2.712807,-5.95011,-6.554039,2.447523,-.1895171,-1.454292,.9131738,-1.100218,-.1746241,1.438505,11.15481,-3.266076,-.8837357,.19701,1.991595,.5907821,-1.207267,-.291361,-11.03767,11.40724,-.014168,.5564047,.08476262,3.371255,.6221335,-1.429698,-.5374218,2.837524,-2.221936,-.02422337,.09313758,.0719025,1.869022,.5609035,-1.002274,-.0697281,.4031308,-.3932997,-.1521923,2.390646,-.0689399,2.999661,1.017843,-1.081168,-.1178666,-.496808,3.919299,.6046866,-2.440615,.7891538,2.140835,.274047,-1.050727,-.2307688,2.276396,-9.454407,-5.505176,2.99262,-.2450942,.6078372,.9606765,-1.103752,-.1810202,1.375044,15.89095,-3.438954,-1.265669,.2475172,1.680768,.5978056,-1.244324,-.3378542,-11.11001,11.37784,-.007896794,.4808023,.09249904,3.025816,.5880239,-1.593165,-.7027621,2.220896,-1.437709,-.01534738,.06286958,.06644555,1.091727,.547008,-.9136506,.01344874,.7772636,-1.209396,-.1408978,2.433718,-.1041938,3.791244,1.037916,-1.134968,-.1803315,-.9267335,4.57667,.6851928,-2.805,.8687208,1.161483,.2571688,-1.017037,-.2053943,2.36164,-9.887818,-5.122889,3.287088,-.2594102,.8578927,.959234,-1.118723,-.1934942,1.226023,16.7414,-3.277335,-1.629809,.2765232,1.637713,.6113963,-1.314779,-.4119915,-12.4115,12.41578,.002344284,.2980837,.1414613,2.781731,.4998556,-1.926199,-1.020038,2.5692,-1.081159,-.02266833,.3588668,.008750078,-.2452171,.4796758,-.7780002,.1850647,.04445456,-2.409297,-.07816346,1.54679,-.02807227,5.998176,1.132396,-1.179326,-.357833,-.2392933,6.467883,.5904596,-1.869975,.8045839,-2.498121,.1610633,-1.009956,-.1311896,1.726577,-12.19356,-3.466239,2.343602,-.2252205,2.573681,1.027109,-1.11246,-.2063093,1.233051,20.58946,-4.578074,-1.145643,.3160192,1.420159,.5860212,-1.371689,-.4914196,-10.7661,11.07405,-.01485077,.5936218,.03685482,2.599968,.6002204,-2.436997,-1.377939,.02130141,1.079593,-.01796232,-.03933248,.1610711,-.6901181,.1206416,-.8743368,.0733137,.8734259,-3.743126,-.03151167,1.297596,-.07634926,6.532873,1.435737,-.9810197,-.3521634,-.2855205,7.134674,.6839748,-1.394841,.6952036,-4.633104,-.02173401,-1.122958,-.1691536,1.38236,-11.02913,-2.608171,1.865111,-.1345154,3.112342,1.094134,-1.075586,-.2077415,1.171477,17.9327,-4.656858,-1.036839,.3338295,1.042793,.5739374,-1.465871,-.6364486,-8.833718,9.34365,-.032236,.7552848,-3121341e-12,2.249164,.8094662,-2.448924,-1.270878,-4.823703,5.853058,-.02149127,.03581132,-.001230276,.4892553,-.1597657,-2.419809,-1.071337,1.575648,-4.98358,.009545185,.5032615,.4186266,4.634147,1.433517,-.1383278,-.02797095,-.1943067,6.679623,.411828,-.2744289,-.02118722,-4.337025,.1505072,-1.341872,-.2518572,1.027009,-6.527103,-1.081271,1.015465,.2845789,2.470371,.927812,-1.04064,-.2367454,1.100744,8.827253,-4.560794,-.7287017,.2842503,.6336593,.6327335,-1.877993,-1.025135,-4.311037,4.715016,-.04711631,.6335844,-7665398e-12,1.788017,.9001409,-2.28154,-1.137668,-10.36869,11.36254,.01961739,-.09836174,-.006734567,1.320918,-.2400807,-4.904054,-2.315781,5.735999,-8.626257,-.1255643,1.545446,.139686,2.972897,1.429934,.4077067,-.1833688,-2.450939,9.119433,.4505361,-1.340828,.397369,-1.78537,.09628711,-1.296052,-.3250526,1.813294,-10.31485,-1.38869,1.239733,-.08989196,-.3389637,.963956,-1.062181,-.2423444,.7577592,15.66938,-4.462264,-.574281,.3262259,.9461672,.6232887],kee=[-1.127942,-.1905548,-12.52356,13.75799,-.03624732,1.055453,.01385036,4.17697,.5928345,-1.15526,-.1778135,6.216056,-5.254116,-.08787445,.8434621,.04025734,6.195322,.3111856,-1.125624,-.3217593,.5043919,1.686284,-.3536071,1.476321,-.07899019,-4.522531,1.271691,-1.081801,-.1033234,.999555,.007482946,-.06776018,1.463141,.09492021,5.612723,.1298846,-1.07532,-.2402711,2.141284,-1.203359,-4.945188,1.437221,-.0809675,-1.028378,1.004164,-1.073337,-.1516517,1.639379,2.304669,-3.214244,1.286245,.05613957,2.480902,.4999363,-1.128399,-.1857793,-10.89863,11.72984,-.03768099,.9439285,.04869335,4.845114,.6119211,-1.114002,-.139928,4.9638,-4.6855,-.07780879,.4049736,.1586297,7.770264,.3449006,-1.185472,-.3403543,.6588322,1.133713,-.4118674,2.061191,-.1882768,-4.372586,1.22353,-1.002272,.02000703,.07073269,1.485075,.5005589,.4301494,.3626541,7.921098,.1574766,-1.121006,-.3007777,2.242051,-4.571561,-7.761071,2.053404,-.1524018,-1.886162,1.018208,-1.058864,-.1358673,1.389667,8.633409,-3.437249,.7295429,.15147,2.842513,.5014325,-1.144464,-.2043799,-10.20188,10.71247,-.03256693,.7860205,.06872719,4.824771,.6259836,-1.170104,-.2118626,4.391405,-4.1989,-.07111559,.3890442,.1024831,6.282535,.5365688,-1.129171,-.255288,.2238298,.7314295,-.356273,1.881931,-.03078716,-1.03912,.9096301,-1.042294,.004450203,-.5116033,2.627589,.6098996,-.1264638,.4325281,7.080503,.4583646,-1.082293,-.2723056,2.065076,-8.143133,-7.892212,2.142231,-.0710624,-1.122398,.8338505,-1.071715,-.1426568,1.095351,17.29783,-3.851931,.4360514,.211444,2.970832,.5944389,-1.195909,-.2590449,-11.91037,12.07947,-.01589842,.6297846,.09054772,4.285959,.5933752,-1.245763,-.3316637,4.29366,-3.694011,-.04699947,.4843684,.02130425,4.097549,.6530809,-1.148742,-.1902509,-.2393233,-.2441254,-.2610918,1.846988,.03532866,2.660106,.8358294,-1.01608,-.0744496,-.5053436,4.388855,.6054987,-1.2083,.5817215,2.54357,.4726568,-1.072027,-.210144,1.518378,-10.60119,-6.016546,2.649475,-.05166992,1.571269,.8344622,-1.072365,-.1511201,.747801,19.00732,-3.950387,-.3473907,.3797211,2.782949,.6296808,-1.239423,-.3136289,-13.511,13.49468,-.007070423,.5012315,.1106008,3.803619,.5577948,-1.452524,-.5676944,2.993153,-2.277288,-.02168954,.305672,.01152338,1.852697,.6427228,-1.061421,-.04590521,.6057022,-1.096835,-.1504952,2.344921,-.05491832,5.268322,.9082253,-1.042373,-.1769498,-1.075388,3.831712,.315414,-2.416458,.7909032,-.01492892,.3854049,-1.064159,-.1892684,1.438685,-8.166362,-3.616364,3.275206,-.1203825,2.039491,.8688057,-1.07012,-.1569508,.412476,13.99683,-3.547085,-1.046326,.4973825,2.791231,.6503286,-1.283579,-.3609518,-13.35397,13.15248,-.0004431938,.3769526,.1429824,3.573613,.4998696,-1.657952,-.7627948,1.958222,-.7949816,-.02882837,.5356149,-.05191946,.8869955,.626332,-.95276,.06494189,.5361303,-2.12959,-.0925863,1.604776,.0506777,6.376055,.9138052,-1.080827,-.252312,-.7154262,4.120085,.1878228,-1.492158,.6881655,-1.446611,.4040631,-1.054075,-.1665498,.9191052,-6.636943,-1.894826,2.10781,-.03680499,2.655452,.841384,-1.061127,-.1448849,.2667493,10.34103,-4.285769,-.3874504,.5998752,3.132426,.6652753,-1.347345,-.4287832,-9.305553,9.133813,-.003173527,.3977564,.115142,3.320564,.4998134,-1.927296,-.9901372,-2.593499,4.087421,-.05833993,.8158929,-.04681279,.2423716,.4938052,-.9470092,.07325237,2.064735,-5.16754,-.01313751,.4832169,.1126295,6.970522,1.035022,-1.022557,-.2762616,-.9375748,6.696739,.2200765,-.1133253,.5492505,-3.109391,.3321914,-1.087444,-.1836263,.6225024,-8.576765,-1.107637,.7859427,.09910909,3.112938,.8596261,-1.051544,-.1546262,.2371731,12.00502,-4.527291,.07268862,.5571478,2.532873,.6662,-1.375576,-.4840019,-8.12129,8.05814,-.01445661,.5123314,.05813321,3.203219,.5442318,-2.325221,-1.241463,-7.06343,8.741369,-.0782995,.8844273,-.03471106,.1740583,.2814079,-1.2287,-.2013412,2.949042,-7.371945,.1071753,-.249197,.2265223,6.391504,1.172389,-.7601786,-.1680631,-.7584444,8.541356,.08222291,.6729633,.3206615,-3.70094,.2710054,-1.191166,-.2672347,.2927498,-9.713613,-.4783721,.2352803,.2161949,2.691481,.8745447,-1.030135,-.1653301,.2263443,12.96157,-4.650644,.007055709,.5091975,2.00037,.6603839,-1.508018,-.6460933,-6.402745,6.545995,-.0375032,.6921803,.003309819,2.797527,.6978446,-2.333308,-1.167837,-17.46787,18.6863,-.008948229,.5621946,-.03402626,1.217943,.01149865,-2.665953,-1.226307,7.169725,-11.59434,.0358342,-.3074378,.3412248,4.422122,1.283791,-.09705116,.08312991,-2.160462,10.28235,.03543357,1.032049,.105831,-2.972898,.2418628,-1.329617,-.3699557,.5560117,-9.730113,.09938865,-.3071488,.2510691,1.777111,.8705142,-1.019387,-.1893247,.1194079,12.39436,-4.799224,.2940213,.4841268,1.529724,.6582615,-1.896737,-1.005442,-6.411032,6.54822,-.03227596,.5717262,-8115192e-12,2.296704,.9000749,-2.411116,-1.225587,-17.53629,18.29393,.01247555,.2364616,-.005114637,1.603778,-.2224156,-4.707121,-2.074977,7.9423,-11.32407,-.05415654,.5446811,.1032493,4.010235,1.369802,.1010482,-.4013305,-2.674579,9.779409,.1782506,.7053045,.4200002,-2.400671,.1953165,-1.243526,-.3391255,.8848882,-9.789025,-.3997324,-.9546227,-.1044017,.6010593,.8714462,-1.014633,-.1730009,-.07738934,13.90903,-4.847307,1.076059,.5685743,1.572992,.6561432,-1.122998,-.1881183,-10.30709,11.58932,-.04079495,.9603774,.03079436,4.009235,.5060745,-1.13479,-.1539688,5.478405,-4.21727,-.1043858,.7165008,.01524765,6.473623,.4207882,-1.134957,-.3513318,.7393837,1.354415,-.4764078,1.690441,-.0549264,-5.563523,1.145743,-1.058344,-.05758503,1.16823,.3269824,.1795193,.7849011,.07441853,6.904804,.281879,-1.075194,-.2355813,2.463685,-1.536505,-7.505771,.9619712,-.06465851,-1.355492,.8489847,-1.07903,-.1465328,1.773838,2.310131,-3.136065,.3507952,.04435014,2.819225,.5689008,-1.125833,-.1870849,-9.555833,10.59713,-.04225402,.9164663,.04338796,4.40098,.6056119,-1.12744,-.1551891,4.755621,-4.408806,-.07851763,.2268284,.146007,7.048003,.3525997,-1.143788,-.3170178,.5480669,2.04183,-.4532139,2.302233,-.1887419,-4.489221,1.250967,-1.032849,.007376031,.5666073,-.2312203,.4862894,-.1748294,.357287,8.380522,.1302333,-1.093728,-.2786977,2.641272,-1.507494,-8.731243,1.684055,-.2023377,-2.176398,1.013249,-1.076578,-.1456205,1.693935,2.945003,-2.822673,-.2520033,.1517034,2.649109,.5179094,-1.146417,-.2119353,-7.187525,8.058599,-.05256438,.8375733,.03887093,4.222111,.6695347,-1.173674,-.2067025,2.899359,-2.804918,-.08473899,.003944225,.1340641,6.160887,.4527141,-1.090098,-.2599633,.9180856,1.09271,-.4215019,2.42766,-.09277667,-2.123523,1.058159,-1.08446,.008056181,-.245351,.6619567,.4668118,-.9526719,.4648454,8.001572,.3054194,-1.053728,-.2765784,2.792388,-3.489517,-8.150535,2.195757,-.2017234,-2.128017,.9326589,-1.099348,-.1593939,1.568292,7.247853,-2.933,-.5890481,.172444,2.433484,.5736558,-1.185983,-.2581184,-7.761056,8.317053,-.03351773,.6676667,.05941733,3.820727,.6324032,-1.268591,-.3398067,2.348503,-2.023779,-.05368458,.1083282,.08402858,3.910254,.5577481,-1.071353,-.1992459,.7878387,.1974702,-.3033058,2.335298,-.08205259,.7954454,.9972312,-1.089513,-.03104364,-.5995746,2.330281,.6581939,-1.821467,.6679973,5.090195,.3125161,-1.040214,-.2570934,2.660489,-6.506045,-7.053586,2.763153,-.2433632,-.7648176,.9452937,-1.116052,-.1831993,1.457694,11.63608,-3.216426,-1.045594,.2285002,1.817407,.5810396,-1.230134,-.3136264,-8.909301,9.145006,-.01055387,.4467317,.1016826,3.342964,.563384,-1.442907,-.5593147,2.156447,-1.241657,-.0351213,.3050274,.01797175,1.742358,.5977153,-1.027627,-.06481539,.4351975,-1.051677,-.2030672,1.942684,-.03615993,4.050266,.9801624,-1.08211,-.1578209,-.3397511,4.163851,.6650368,-1.84173,.7062544,.6789881,.3172623,-1.047447,-.197756,2.183364,-8.805249,-5.483962,2.551309,-.177964,1.519501,.9212536,-1.111853,-.1935736,1.394408,13.92405,-3.46543,-1.068432,.2388671,1.455336,.6233425,-1.262238,-.3546341,-10.08703,10.20084,-.001852187,.353758,.1239199,3.056093,.5132052,-1.61381,-.7355585,2.760123,-1.685253,-.02517552,.2914258,.004743448,.8689596,.5674192,-.9462336,.02950767,-.2613816,-.7398653,-.1315558,1.901042,-.06447844,4.969341,1.027342,-1.111481,-.2194054,-.09004538,3.983442,.4871278,-1.965315,.7956121,-.2363225,.2718037,-1.036397,-.1827106,1.964747,-8.870759,-4.208011,2.461215,-.2158905,1.561676,.9436866,-1.113769,-.1947819,1.30072,15.16476,-4.088732,-1.069384,.2836434,1.671451,.6229612,-1.328069,-.4244047,-8.41704,8.552244,-.006813504,.4127422,.09619897,2.854227,.505988,-1.927552,-1.02529,.9529576,.425595,-.03738779,.2584586,.04911004,-.2640913,.4138626,-.8488094,.1435988,.6356807,-2.895732,-.08473961,1.701305,-.1323908,6.499338,1.210928,-1.128313,-.3397048,-.404314,6.265097,.5482395,-2.057614,.8884087,-2.943879,.09760301,-1.039764,-.1494772,1.781915,-11.53012,-3.379232,2.517231,-.2764393,2.588849,1.05212,-1.108447,-.2012251,1.19864,19.25331,-4.423892,-1.257122,.339569,1.48122,.5880175,-1.374185,-.4967434,-7.401318,7.724021,-.02345723,.5979653,.02436346,2.65897,.6014891,-2.310933,-1.29029,-1.301909,2.557806,-.03744449,.08982861,.1090613,-.4398363,.1184329,-1.12473,-.0992183,1.366902,-4.172489,-.05078016,1.393597,-.09323843,6.452721,1.435913,-.8468477,-.2744819,-.43472,6.713362,.6127133,-1.685634,.7360941,-4.535502,-.02920866,-1.165242,-.2008697,1.438778,-10.08936,-2.214771,2.102909,-.1763085,2.859075,1.09347,-1.074614,-.2066374,1.131891,16.30063,-4.801441,-1.11259,.3595785,1.122227,.579461,-1.521515,-.6835604,-5.571044,6.028774,-.04253715,.6875746,-5279456e-12,2.18015,.8487705,-2.240415,-1.171166,-7.182771,8.417068,-.01932866,.1101887,-.01098862,.6242195,-.2393875,-2.712354,-1.19883,3.1802,-6.76813,-.002563386,.7984607,.2764376,4.695358,1.557045,-.03655172,-.02142321,-.913812,7.932786,.3516542,-.7994343,.1786761,-4.208399,.01820576,-1.36861,-.2656212,1.249397,-8.317818,-.8962772,1.423249,.1478381,2.19166,1.007748,-1.041753,-.2453366,1.061102,11.30172,-4.739312,-.9223334,.2982776,.6162931,.6080302,-1.989159,-1.09516,-2.91555,3.275339,-.05735765,.5742174,-7683288e-12,1.7634,.9001342,-2.07002,-1.086338,-10.95898,12.0696,.03780123,-.01774699,-.0005881348,1.333819,-.2605423,-5.249653,-2.38304,6.160406,-9.097138,-.1955319,1.651785,.0006016463,3.021824,1.493574,.4685432,-.2358662,-2.666433,9.685763,.5804928,-1.521875,.5668989,-1.548136,.01688642,-1.296891,-.3449031,1.928548,-11.6756,-1.627615,1.355603,-.1929074,-.6568952,1.009774,-1.067288,-.2410392,.7147961,17.8384,-4.374399,-.6588777,.3329831,1.012066,.6118645],Gee=[-1.310023,-.4407658,-36.4034,36.83292,-.008124762,.5297961,.01188633,3.13832,.5134778,-1.4241,-.5501606,-17.5351,18.22769,-.01539272,.6366826,.002661996,2.659915,.4071138,-1.103436,-.1884105,6.425322,-6.910579,-.02019861,.3553271,-.01589061,5.345985,.8790218,-1.1862,-.4307514,-3.957947,5.979352,-.05348869,1.736117,.03491346,-2.692261,.5610506,-1.006038,-.1305995,4.473513,-3.806719,.1419407,-.02148238,-.05081185,3.735362,.535828,-1.078507,-.1633754,-3.812368,4.3817,.02988122,1.754224,.1472376,3.722798,.4999157,-1.333582,-.4649908,-33.59528,34.04375,-.009384242,.5587511,.00572631,3.073145,.5425529,-1.562624,-.7107068,-14.7817,15.59839,-.01462375,.5050133,.02516017,1.604696,.2902403,-.8930158,.04068077,1.373481,-2.342752,-.02098058,.6248686,-.05258363,7.058214,1.150373,-1.262823,-.4818353,889261e-9,1.92312,-.04979718,1.040693,.1558103,-2.85248,.2420691,-.9968383,-.1200648,1.324342,-.9430889,.1931098,.4436916,-.07320456,4.215931,.7898019,-1.078185,-.1718192,-1.720191,2.358918,.02765637,1.260245,.2021941,3.395483,.5173628,-1.353023,-.4813523,-31.0492,31.40156,-.009510741,.554203,.008135471,3.136646,.5215989,-1.624704,-.7990201,-21.67125,22.46341,-.01163533,.5415746,.02618378,1.139214,.3444357,-.798361,.1417476,9.914841,-10.81503,-.01218845,.3411392,-.06137698,7.445848,1.18008,-1.266679,-.4288977,-5.818701,6.986437,-.08180711,1.397403,.2016916,-1.275731,.2592773,-1.009707,-.1537754,3.496378,-3.013726,.242115,-.2831925,.03003395,3.702862,.774632,-1.075646,-.1768747,-1.347762,1.989004,.01375836,1.76481,.1330018,3.230864,.662621,-1.375269,-.5103569,-34.42661,34.78703,-.008460009,.5408643,.004813323,3.016078,.5062069,-1.821679,-.9766461,-19.26488,19.97912,-.009822567,.3649556,.04316092,.893019,.4166527,-.6633542,.1997841,2.395592,-3.117175,-.01080884,.8983814,-.1375825,6.673463,1.115663,-1.30324,-.3612712,.08292959,.3381364,-.06078648,.3229247,.3680987,.7046755,.3144924,-.9952598,-.2039076,.4026851,.2686684,.1640712,.5186341,-.0120552,2.659613,.8030394,-1.098579,-.2151992,.6558198,-74369e-8,-.001421817,1.073701,.1886875,2.536857,.6673923,-1.457986,-.5906842,-38.12464,38.38539,-.006024357,.4741484,.01209223,2.818432,.5012433,-1.835728,-1.003405,-6.848129,7.601943,-.01277375,.4785598,.03366853,1.097701,.4636635,-.8491348,.009466365,-2.685226,2.00406,-.01168708,.6752316,-.1543371,5.674759,1.039534,-1.083379,-.150679,.7328236,-.5095568,-.08609153,.444882,.4174662,1.481556,.3942551,-1.117089,-.3337605,.2502281,.4036323,.2673899,.2829817,.0224245,2.043207,.7706902,-1.071648,-.21262,.6069466,-.00145629,-.551596,1.046755,.1985021,2.290245,.6876058,-1.483903,-.6309647,-43.80213,44.10537,-.005712161,.5195992,.002028428,2.687114,.5098321,-2.053976,-1.141473,.5109183,.08060391,-.01033983,.4066532,.04869627,1.161722,.4039525,-.6348185,.07651292,-10.31327,10.07598,-.02083688,.7359516,-.2029459,5.013257,1.077649,-1.22863,-.1650496,.04077157,-.7189167,-.0509222,.2959814,.5111496,2.540433,.361533,-1.041883,-.3278413,-.06691911,1.307364,.2166663,.3000595,-.003157136,1.389208,.7999026,-1.103556,-.2443602,.4705347,-.0009296482,-.530992,.9654511,.2142587,2.244723,.6839976,-1.555684,-.6962113,-46.47983,46.7427,-.005034895,.475509,-9502561e-13,2.626569,.5056194,-1.998288,-1.12472,-1.629586,2.187993,-.008284384,.3845258,.0572624,1.185644,.4255812,-1.03257,-.251385,-3.721112,3.506967,-.02186561,.9436049,-.2451412,4.725724,1.039256,-.8597532,.09073332,-2.553741,1.993237,-.04390891,-.2046928,.5515623,1.909127,.3948212,-1.210482,-.4477622,-.2267805,1.219488,.1336186,.6866897,.02808997,1.600403,.7816409,-1.078168,-.2699261,.2537282,.3820684,-.4425103,.5298235,.2185217,1.728679,.6882743,-1.697968,-.8391488,-57.90105,58.1412,-.00340476,.426514,-1796301e-12,2.368442,.5324429,-2.141552,-1.17223,16.77872,-16.4147,-.005732425,.2002199,.06841834,1.485338,.3215763,-1.442946,-.7264245,-9.503706,9.650462,-.02120995,1.419263,-.2893098,3.860731,1.120857,-.5696752,.3411279,-.2931035,-.6512552,-.1068437,-1.085661,.6107549,1.459503,.3210336,-1.313839,-.5921371,-.2332222,1.648196,.2492787,1.381033,-.01993392,.981256,.8316329,-1.087464,-.3195534,.2902095,.3383709,-.8798482,.01494668,.2529703,1.452644,.669387,-2.068582,-1.118605,-50.81598,50.97486,-.003280669,.4067371,-2544951e-12,2.179497,.5778017,-1.744693,-.8537207,22.34361,-22.08318,-.005932616,.1035049,.05742772,1.97788,.2124846,-3.287515,-2.140268,-12.49566,12.40091,-.02409349,1.397821,-.2371627,2.771192,1.170496,.5502311,1.04663,2.193517,-2.2204,-.1064394,-1.017926,.4795457,1.030644,.3177516,-1.719734,-.9536198,-.6586821,1.386361,-.02513065,1.187011,.06542539,.5296055,.808266,-1.0057,-.3028096,.04470957,1.00776,-.8119016,.03153338,.2311321,1.182208,.6824758,-2.728867,-1.580388,-30.79627,30.92586,-.004197673,.3154759,-3897675e-12,1.920567,.6664791,-1.322495,-.7249275,14.7766,-14.68154,-.009044857,.05624314,.06498392,2.047389,.0636754,-6.102376,-3.473018,-9.926071,9.637797,-.01097909,1.103498,-.2424521,2.520748,1.24026,1.351796,1.018588,2.009081,-1.333394,-.1979125,-.3318292,.4476624,.9095235,.2955611,-1.774467,-1.07988,-.0808468,.2577697,-.1149295,.4975303,.002931611,-.3803171,.8002794,-.9898401,-.2542513,-.07530911,1.870355,-1.521918,.2405164,.2964615,1.3348,.6789053,-1.27973,-.4290674,-42.77972,43.43305,-.006541826,.4945086,.01425338,2.685244,.5011313,-1.449506,-.5766374,-16.88496,17.81118,-.01121649,.354502,.02287338,1.904281,.4936998,-1.02198,-.1897574,2.482462,-2.941725,-.01570448,.7532578,-.042568,5.23966,.4983116,-1.162608,-.3428049,3.974358,-1.527935,-.03919201,.8758593,.07291363,-3.455257,.8007426,-.9929985,-.08712006,-.7397313,1.348372,.09511685,.3233584,-.07549148,5.806452,.4990042,-1.084996,-.1739767,.1580475,.908818,.06871433,.5933079,.1188921,3.074079,.4999327,-1.317009,-.4661946,-42.55347,43.12782,-.005727235,.4285447,.02189854,2.60831,.51907,-1.469236,-.6282139,-12.41404,13.48765,-.0120477,.5070285,-.0007280216,1.491533,.3635064,-.9713808,-.08138038,.3709854,-1.041174,-.01814075,.506086,-.02053756,6.161431,1.093736,-1.159057,-.3698074,2.711209,-.6006479,-.04896926,.9273957,.1137712,-3.496828,.2867109,-1.011601,-.0820189,.2105725,.459752,.1478925,.213894,-.0566067,6.057755,.7859121,-1.07802,-.181158,.1646622,.8348426,.1149064,.4985738,.1376605,2.746607,.4999626,-1.325672,-.4769313,-41.11215,41.68293,-.006274997,.4649469,.01119411,2.631267,.5234546,-1.619391,-.8000253,-15.34098,16.32706,-.01012023,.4242255,.02931597,.8925807,.3314765,-.7356979,.1368406,2.972579,-3.535359,-.01318948,.460762,-.07182778,6.2541,1.236299,-1.316217,-.4194427,.03489902,1.289849,-.0475596,1.138222,.1975992,-.8991542,.2290572,-.9502188,-.1172703,1.405202,-.3061919,.1058772,-.3760592,-.01983179,3.562353,.7895959,-1.100117,-.1900567,.492503,.5250225,.1576804,1.042701,.07330743,2.796064,.6749783,-1.354183,-.5130625,-42.19268,42.71772,-.005365373,.4136743,.01235172,2.520122,.5187269,-1.741434,-.9589761,-8.230339,9.296799,-.009600162,.4994969,.02955452,.3667099,.3526999,-.6917347,.2154887,-.8760264,.2334121,-.01909621,.4748033,-.1138514,6.51536,1.225097,-1.293189,-.42187,1.620952,-.7858597,-.0376941,.6636786,.3364945,-.5341017,.2128347,-.9735521,-.1325495,1.007517,.2598258,.06762169,.001421018,-.06915987,3.185897,.8641956,-1.0948,-.1962062,.5755591,.2906259,.2625748,.7644049,.1347492,2.677126,.646546,-1.393063,-.5578338,-41.85249,42.33504,-.00543564,.4743765,.007422477,2.442801,.5211707,-1.939487,-1.128509,-8.974257,9.978383,-.007965597,.294883,.04436763,.2839868,.3440424,-.6011562,.2354877,-3.07982,2.585094,-.02002701,.7793909,-.1598414,5.834678,1.202856,-1.315676,-.3903446,1.7019,-1.304609,-.01045121,.2747707,.4143967,.3197102,.263758,-.9618628,-.1625841,1.187138,.1497802,-5590954e-12,.03178475,-.04153145,2.496096,.8195082,-1.111554,-.2365546,.7831875,.2018684,.2074369,.7395978,.122573,1.876478,.6821167,-1.427879,-.5994879,-35.31016,35.81581,-.006431497,.4554192,.0007348731,2.334619,.5233377,-1.998177,-1.206633,-21.4651,22.42237,-.005857596,.2755663,.06384795,.1358244,.3328437,-.644063,.2058571,2.155499,-2.587968,-.01840023,.8826555,-.2222452,5.847073,1.228387,-1.229071,-.3360441,-.3429599,.6179469,.00202961,.08899319,.5041624,.1882964,.225204,-1.022905,-.2101621,1.915689,-.6498794,-.03463651,.08954605,-.06797854,2.417705,.8568618,-1.082538,-.2007723,.4731009,.4077267,.1324289,.651488,.1702912,2.309383,.6600895,-1.472139,-.6499815,-34.28465,34.69659,-.005747023,.4174167,.001688597,2.323046,.5395191,-2.161176,-1.353089,-22.26827,23.29138,-.005583808,.2364793,.06096656,.001944666,.2861624,-.6593044,.1393558,4.698373,-5.193883,-.0199839,1.095635,-.2391254,5.598103,1.236193,-1.195717,-.2972715,.04648953,.3024588,.005003313,-.3754741,.5247265,-.1381312,.2493896,-1.020139,-.2253524,.3548437,.7030485,-.02107076,.4581395,-.03243757,2.453259,.8323623,-1.09877,-.243578,.8761614,.1941613,-.1990692,.3761139,.1657412,1.590503,.6741417,-1.648007,-.8205121,-44.35106,44.79801,-.004181353,.385483,-1842385e-12,2.000281,.5518363,-2.140986,-1.282239,-3.979213,4.672459,-.005008582,.242192,.06253602,.6612713,.2555851,-1.300502,-.5137898,.5179821,-.4032341,-.02066785,1.087929,-.2615309,4.225887,1.229237,-.696334,.0924106,.06936356,-.3588571,-.05461843,-.5616643,.5484166,-.04776267,.2414935,-1.233179,-.4325498,.6479813,.8368356,.2458875,.6464752,-.02897097,1.561773,.8518598,-1.051023,-.253369,1.004294,.3028083,-1.520108,.1607013,.1619975,1.131094,.6706655,-1.948249,-1.097383,-44.53697,44.94902,-.003579939,.3491605,-2500253e-12,1.740442,.6188022,-2.154253,-1.209559,4.144894,-3.562411,-.005638843,.1067169,.07594858,1.00528,.1072543,-2.513259,-1.507208,-1.602979,1.404154,-.00556075,1.24049,-.2852117,3.485252,1.349321,-.07832214,.3655626,.3856288,.6867894,-.1609523,-.6704306,.5357301,-.6457935,.1479503,-1.354784,-.5454375,.8797469,-1.466514,.713442,.5934903,-.02911178,.8643737,.9030724,-1.048324,-.2738736,.8783074,3.246188,-4.435369,.1251791,.1783486,1.064657,.6522878,-2.770408,-1.618911,-25.04031,25.31674,-.004239279,.3241013,-3764484e-12,1.586843,.7035906,-1.9135,-1.144014,-10.80587,11.53677,-.01003197,.1577515,.05217789,1.225278,.005172771,-5.293208,-2.876463,2.087053,-3.201552,.003892964,.532393,-.2034512,2.61776,1.273597,.906034,.3773409,-.6399945,3.213979,-.09112172,.6494055,.395328,.5047796,.2998695,-1.482179,-.677831,1.161775,-3.004872,.4774797,-.4969248,-.003512074,-1.30719,.7927378,-.9863181,-.1803364,.5810824,4.58057,-3.863454,.5328174,.2272821,1.771114,.6791814],Qee=[1.560219,1.417388,1.206927,10.91949,5.931416,7.304788,1.533049,1.560532,.3685059,13.5504,5.543711,7.792189,1.471043,1.746088,-.9299697,17.20362,5.473384,8.336416,1.355991,2.109348,-3.295855,22.64843,5.454607,9.304656,1.244963,2.547533,-5.841485,27.56879,5.576104,10.43287,1.175532,2.784634,-7.212225,29.75347,6.47298,10.92331,1.082973,3.118094,-8.934293,31.86879,8.473885,11.74019,.96925,3.349574,-10.0381,31.47654,13.38931,12.72547,.8547044,3.151538,-9.095567,25.54995,22.73219,14.10398,.758034,2.311153,-5.170814,12.29669,36.86529,15.98882,1.664273,1.574468,1.422078,9.768247,14.47338,16.44988,1.638295,1.719586,.5786675,12.39846,14.15419,17.28605,1.572623,1.921559,-.7714802,16.09246,14.20954,18.25908,1.468395,2.21197,-2.845869,20.75027,15.24822,19.37622,1.355047,2.556469,-4.96092,24.60237,16.4836,20.65648,1.291642,2.742036,-6.061967,26.02002,18.19144,21.16712,1.194565,2.97212,-7.295779,26.91805,21.2488,22.01819,1.083631,3.047021,-7.766096,24.96261,27.44264,22.91875,.9707994,2.736459,-6.308284,17.6086,37.76291,23.9215,.8574294,1.865155,-2.364707,4.337793,50.92831,25.23432],Hee=[1.632341,1.39523,1.375634,12.38193,5.921102,7.766508,1.597115,1.554617,.3932382,15.05284,5.725234,8.158155,1.522034,1.844545,-1.322862,19.18382,5.440769,8.837119,1.403048,2.290852,-4.013792,24.851,5.521888,9.845547,1.286364,2.774498,-6.648221,29.64151,5.923777,10.97075,1.213544,3.040195,-8.092676,31.86082,6.789782,11.58899,1.122622,3.347465,-9.649016,33.43824,9.347715,12.31374,1.007356,3.543858,-10.5352,32.39842,14.83962,13.31718,.8956642,3.2787,-9.254933,25.57923,24.89677,14.76166,.7985143,2.340404,-4.928274,11.41787,39.61501,16.82448,1.745162,1.639467,1.342721,11.66033,14.90124,17.74031,1.708439,1.819144,.2834399,14.48066,14.59214,18.58679,1.63172,2.094799,-1.378825,18.43198,14.63173,19.62881,1.516536,2.438729,-3.624121,22.98621,15.99782,20.70027,1.405863,2.785191,-5.705236,26.45121,17.6833,21.91903,1.344052,2.951807,-6.683851,27.44271,19.85706,22.29452,1.245827,3.182923,-7.82296,27.91395,23.27254,23.1591,1.132305,3.202593,-8.008429,25.21093,30.00014,24.05306,1.02033,2.820556,-6.238704,17.09276,40.77916,25.09949,.903157,1.863917,-1.955738,3.032665,54.3429,26.4178],Wee=[1.168084,2.156455,-3.980314,19.89302,13.28335,14.35621,1.135488,2.294701,-4.585886,20.90208,13.4784,14.67658,1.107408,2.382765,-5.112357,21.47823,14.93128,14.60882,1.054193,2.592891,-6.115,22.68967,16.35672,15.18999,1.006946,2.70542,-6.69893,22.9183,18.34324,15.70651,.9794044,2.74244,-6.805283,22.25271,20.50797,15.6313,.9413577,2.722009,-6.760707,20.98242,23.42588,16.05011,.8917923,2.59278,-6.152635,17.74141,28.58324,16.5791,.8288391,2.153434,-4.118327,10.78118,36.8171,17.38139,.7623528,1.418187,-.8845235,.7590129,46.29859,19.21657,1.352858,2.048862,-2.053393,14.05874,30.45344,30.4443,1.330497,2.126497,-2.466296,14.67559,30.90738,30.69707,1.286344,2.200436,-2.877228,14.92701,32.36288,30.77223,1.234428,2.289628,-3.404699,14.99436,34.6839,30.84842,1.17866,2.306071,-3.549159,14.11006,37.54188,30.7973,1.151366,2.333005,-3.728627,13.63374,39.05894,30.92599,1.101593,2.299422,-3.565787,11.96745,41.88472,31.02755,1.038322,2.083539,-2.649585,8.037389,47.00869,30.65948,.9596146,1.67147,-.8751538,1.679772,53.45784,30.5452,.8640731,.9858301,1.854956,-6.798097,59.36468,31.10255],Yee=[Vee,kee,Gee],jee=[Qee,Hee,Wee],$5={getTableValue:function(o,e,t,n,r){var a=540*e,i=54*(t-1),s=9*n;return Yee[o][a+i+s+r]},getTableValueRad:function(o,e,t,n){var r=60*e,a=6*(t-1);return jee[o][r+a+n]}},uw=9;function d0(o,e,t,n,r){return J5(o).reduce(function(a,i,s){return a+i*$5.getTableValue(e,t,n,s,r)},0)}function f0(o,e,t,n){return J5(o).reduce(function(r,a,i){return r+a*$5.getTableValueRad(e,t,n,i)},0)}function J5(o){var e=Math.pow(2*o/Math.PI,.3333333333333333);return[Math.pow(1-e,5),5*Math.pow(1-e,4)*e,10*Math.pow(1-e,3)*Math.pow(e,2),10*Math.pow(1-e,2)*Math.pow(e,3),5*(1-e)*Math.pow(e,4),Math.pow(e,5)]}var Lu={getDistParams:function(o,e,t,n){for(var r=new Array(uw),a=Math.trunc(o),i=o-a,s=0;s<uw;s++){var c=d0(t,n,0,a,s),u=d0(t,n,1,a,s);if(r[s]=(1-e)*(1-i)*c+e*(1-i)*u,a!=10){var h=d0(t,n,0,a+1,s),f=d0(t,n,1,a+1,s);r[s]+=(1-e)*i*h+e*i*f}}return r},getRadiance:function(o,e,t,n){var r=Math.trunc(o),a=o-r,i=(1-e)*(1-a)*f0(t,n,0,r)+e*(1-a)*f0(t,n,1,r);return r!=10&&(i+=(1-e)*a*f0(t,n,0,r+1)+e*a*f0(t,n,1,r+1)),i}};class Lv extends Ld{constructor(e,t,n,r){super(e,t,n,r)}interpolate_(e,t,n,r){const a=this.resultBuffer,i=this.sampleValues,s=this.valueSize,c=e*s,u=c-s,h=(n-t)/(r-t),f=1-h;for(let m=0;m!==s;++m)a[m]=i[u+m]*f+i[c+m]*h;return a}}var Xee=[.1787,-1.463,-.3554,.4275,-.0227,5.3251,.1206,-2.5771,-.067,.3703],qee=[-.0193,-.2592,-.0665,8e-4,-4e-4,.2125,-.0641,-.8989,-.0033,.0452],Zee=[-.0167,-.2608,-.095,.0092,-.0079,.2102,-.0441,-1.6537,-.0109,.0529],Kee=[4.0453,-4.971,-.2155,2.4192],$ee=[.00166,-.00375,.00209,0,-.02903,.06377,-.03202,.00394,.11693,-.21196,.06052,.25886],Jee=[.00275,-.0061,.00317,0,-.04214,.0897,-.04153,.00516,.15346,-.26756,.0667,.26688],ete=[Xee,qee,Zee],tte=[Kee,$ee,Jee],h0={getTableValue:function(o,e,t){return ete[o][2*e+t]},getTableDataZenith:function(o){return tte[o]}},dw=5,nte=.06;function fw(o,e,t){return(1+o[0]*Math.exp(o[1]/Math.cos(e)))*(1+o[2]*Math.exp(o[3]*t)+o[4]*Math.pow(Math.cos(t),2))}function rte(o){return .212671*o+.71516*o+.072169*o}var Oo={getDistParams:function(o,e){for(var t=new Array(dw),n=0;n<dw;n++)t[n]=h0.getTableValue(e,n,0)*o+h0.getTableValue(e,n,1);return t},getZenithParams:function(o,e,t){switch(t){case 0:var n=h0.getTableDataZenith(t),r=new ct(n[0],n[1],n[2],n[3]),a=Math.tan((4/9-o/120)*(Math.PI-2*e)),i=new ct(o*a,a,o,1);return r.dot(i)*nte/fw(this.getDistParams(o,t),0,e);case 1:case 2:n=h0.getTableDataZenith(t);var s=Math.pow(e,2),c=Math.pow(e,3),u=n[0]*c+n[1]*s+n[2]*e+n[3],h=n[4]*c+n[5]*s+n[6]*e+n[7],f=n[8]*c+n[9]*s+n[10]*e+n[11];return r=new B(u,h,f),new B(Math.pow(o,2),o,1).dot(r)/fw(this.getDistParams(o,t),0,e)}},getSunIlluminance:function(o,e){var t=[0,0,0];if(o[1]<0)return t;for(var n=[.605,.54,.445],r=[12.25,7.5,.3],a=.04608*e-.04586,i=1/(o[1]+.15*Math.pow(93.885-Math.acos(o[1])*(180/Math.PI),-1.253)),s=[1.05513096,.993359745,.903543472],c=0;c<3;c++){var u=Math.exp(.008735*-i*Math.pow(n[c],-4.08)),h=Math.exp(-i*a*Math.pow(n[c],-1.3)),f=Math.exp(.0035*-r[c]*i);t[c]=128e3*s[c]/rte(s[c]),t[c]*=u*h*f}return t},getSunIntegral:function(o,e,t,n){var r=o,a=e,i=t;function s(f){return f*f}var c=1-cos(r),u=((s(Math.PI)-2*s(r-a))*cos(r)-s(Math.PI)*cos(a))/(2*(r-a+Math.PI)*(-r+a+Math.PI)),h=i*((.0892351-.00247875*s(i))*sin(i)+cube(i)+24*i+.029745*i*cos(i))/s(s(i)+36);return 2*Math.PI*(c+u+n*h)}};class _i{constructor(e=1,t=0,n=0){return this.radius=e,this.phi=t,this.theta=n,this}set(e,t,n){return this.radius=e,this.phi=t,this.theta=n,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,n){return this.radius=Math.sqrt(e*e+t*t+n*n),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,n),this.phi=Math.acos(Ft(t/this.radius,-1,1))),this}clone(){return new this.constructor().copy(this)}}const Ae={BACKGROUND_BL:{color:0,strength:1},BSDF_DIFFUSE_BL:{color:0,roughness:1,normal:2},BSDF_GLOSSY_BL:{color:0,roughness:1,anisotropy:2,rotation:3,normal:4,tangent:5},BSDF_METALLIC_BL:{baseColor:0,edgeTint:1,ior:2,extinction:3,roughness:4,anisotropy:5,rotation:6,normal:7,tangent:8},BSDF_PRINCIPLED_BL:{baseColor:0,metallic:1,roughness:2,ior:3,alpha:4,normal:5,diffuseRoughness:6,subsurface:7,subsurfaceRadius:8,subsurfaceScale:9,subsurfaceIor:10,subsurfaceAnisotropy:11,specularIORLevel:12,specularTint:13,anisotropic:14,anisotropicRotation:15,tangent:16,transmission:17,clearcoat:18,clearcoatRoughness:19,clearcoatIor:20,clearcoatTint:21,clearcoatNormal:22,sheen:23,sheenRoughness:24,sheenTint:25,emission:26,emissionStrength:27,thinFilmThickness:28,thinFilmIOR:29},BSDF_PRINCIPLED_BF43_BL:{baseColor:0,metallic:1,roughness:2,ior:3,alpha:4,normal:5,subsurface:6,subsurfaceRadius:7,subsurfaceScale:8,subsurfaceIor:9,subsurfaceAnisotropy:10,specularIORLevel:11,specularTint:12,anisotropic:13,anisotropicRotation:14,tangent:15,transmission:16,clearcoat:17,clearcoatRoughness:18,clearcoatIor:19,clearcoatTint:20,clearcoatNormal:21,sheen:22,sheenRoughness:23,sheenTint:24,emission:25,emissionStrength:26},BSDF_PRINCIPLED_BF40_BL:{baseColor:0,subsurface:1,subsurfaceRadius:2,subsurfaceColor:3,subsurfaceIOR:4,subsurfaceAnisotropy:5,metallic:6,specular:7,specularTint:8,roughness:9,anisotropic:10,anisotropicRotation:11,sheen:12,sheenTint:13,clearcoat:14,clearcoatRoughness:15,ior:16,transmission:17,transmissionRoughness:18,emission:19,emissionStrength:20,alpha:21,normal:22,clearcoatNormal:23,tangent:24},BSDF_TRANSLUCENT_BL:{color:0,normal:1},BSDF_TRANSPARENT_BL:{color:0},DIFFUSE_BSDF_BL:{color:0,roughness:1,normal:2},EEVEE_SPECULAR_BL:{baseColor:0,specular:1,roughness:2,emissiveColor:3,transparency:4,normal:5,clearcoat:6,clearcoatRoughness:7,clearcoatNormal:8,ambientOcclusion:9},EMISSION_BL:{color:0,strength:1},LIGHT_PATH_BL:{},MIX_BL:{fac:0,col1:1,col2:2},MIX_SHADER_BL:{fac:0,color1:1,color2:2},NEW_GEOMETRY_BL:{},NORMAL_MAP_BL:{strength:0,normalColor:1},OUTPUT_MATERIAL_BL:{surface:0,volume:1,displacement:2,thickness:3},OUTPUT_WORLD_BL:{surface:0,volume:1},RGB_BL:{},SEPARATE_COLOR_BL:{color:0},TEX_COORD_BL:{},TEX_ENVIRONMENT_BL:{vector:0},TEX_IMAGE_BL:{vector:0},UVMAP_BL:{uv:0},VALUE_BL:{},BITMAP_MX:{uOffset:0,vOffset:1,uTiling:2,vTiling:3,wAngle:4},BITMAP_ENV_MX:{uOffset:0,vOffset:1,uTiling:2,vTiling:3,wAngle:4,normal:5},FALLOFF_MX:{normal:2},MATERIAL_MX:{ambientColor:0,diffuseColor:1,specularColor:2,glossiness:3,specularLevel:4,selfIllum:5,opacity:6,filterColor:7,normal:8,reflection:9,refraction:10,displacement:11},NORMAL_BUMP_MX:{normalColor:0,additionalBump:1,normalMult:2,addBumpMult:3},OPENPBR_SURFACE_MX:{baseWeight:0,baseColor:1,baseMetalness:2,baseDiffuseRoughness:3,specularWeight:4,specularColor:5,specularRoughness:6,specularIOR:7,transmissionWeight:8,transmissionColor:9,transmissionDepth:10,fuzzWeight:11,fuzzColor:12,fuzzRoughness:13,coatWeight:14,coatColor:15,coatRoughness:16,emissionWeight:17,emissionColor:18,emissionLuminance:19,geometryOpacity:20,normal:21,clearcoatNormal:22},OUTPUT_MX:{color:0},PHYSICAL_MX:{base:0,baseColor:1,reflectivity:2,reflColor:3,roughness:4,metalness:5,diffRoughness:6,anisotropy:7,anisoangle:8,transparency:9,transColor:10,transRoughness:11,ior:12,scattering:13,sssColor:14,sssScale:15,emission:16,emitColor:17,clearcoat:18,clearcoatColor:19,clearcoatRoughness:20,normal:21,clearcoatNormal:22,displacement:23,opacity:24},REFLECT_REFRACT_MX:{normal:0},RGB_MX:{},SUB_TRANSFORM_MX:{scale:0,rotate:1,offset:2},VALUE_MX:{},BUMP_2D_MY:{bumpDepth:0,bumpValue:1},COLOR_CONSTANT_MY:{color:0,alpha:1},FILE_MY:{uvCoord:0},FLOAT_CONSTANT_MY:{value:0},LAMBERT_MY:{color:0,ambientColor:1,incandescence:2,matteOpacity:3,diffuse:4,normal:5,translucence:6,transparency:7},OPENPBR_SURFACE_MY:{baseWeight:0,baseColor:1,baseDiffuseRoughness:2,baseMetalness:3,specularWeight:4,specularColor:5,specularRoughness:6,specularIOR:7,transmissionWeight:8,transmissionColor:9,transmissionDepth:10,transmissionScatter:11,fuzzWeight:12,fuzzColor:13,fuzzRoughness:14,coatWeight:15,coatColor:16,coatRoughness:17,emissionLuminance:18,emissionColor:19,geometryOpacity:20,normal:21},PLACE_2D_TEXTURE_MY:{offset:0,repeatUv:1,rotateUv:2},RAMP_MY:{uvCoord:0},SAMPLER_INFO_MY:{viewNorm:0},SHADING_ENGINE_MY:{surface:0,volume:1,displacement:2},SUB_TRANSFORM_MY:{scale:0,rotate:1,offset:2},SURFACE_SHADER_MY:{color:0,glowColor:1,matteOpacity:2,transparency:3},IMAGE_AR:{multiply:0,offset:1,uvcoords:2,soffset:3,toffset:4,sscale:5,tscale:6,sflip:7,tflip:8,swapSt:9,duvdx:10,duvdy:11},LAMBERT_AR:{base:0,baseColor:1,normalCamera:2,opacity:3},MAP_TO_MTL_AR:{color:0},NORMAL_MAP_AR:{inputVal:0,normal:1,strength:2,tangent:3},STANDARD_SURFACE_AR:{base:0,baseColor:1,diffuseRoughness:2,metalness:3,specular:4,specularColor:5,specularRoughness:6,trans:7,transColor:8,transDepth:9,transScatter:10,transExtraRoughness:11,subsurface:12,subsurfaceColor:13,subsurfaceRadius:14,clearcoat:15,clearcoatColor:16,clearcoatRoughness:17,sheen:18,sheenColor:19,sheenRoughness:20,emission:21,emissionColor:22,opacity:23,normal:24,clearcoatNormal:25,specularIOR:26},TRIPLANAR_AR:{inputColor:0,inputColorY:1,inputColorZ:2,scale:3,rotate:4,offset:5,normal:6},TRIPLANAR_UV_AR:{vector:0,normal:1},UV_PROJECTION_AR:{projectionColor:0,uAngle:1,vAngle:2,matrix:3},NORMAL:{},RGB_ALPHA:{},VALUE:{}},st={BACKGROUND_BL:{color:0},BSDF_DIFFUSE_BL:{color:0},BSDF_GLOSSY_BL:{color:0},BSDF_METALLIC_BL:{color:0},BSDF_PRINCIPLED_BL:{color:0},BSDF_PRINCIPLED_BF40_BL:{color:0},BSDF_TRANSLUCENT_BL:{color:0},BSDF_TRANSPARENT_BL:{color:0},EEVEE_SPECULAR_BL:{color:0},EMISSION_BL:{color:0},DIFFUSE_BSDF_BL:{color:0},LIGHT_PATH_BL:{isCameraRay:0,isShadowRay:1,isDiffuseRay:2,isGlossyRay:3,isSingularRay:4,isReflectionRay:5,isTransmissionRay:6,rayLength:7,rayDepth:8,diffuseDepth:9,glossyDepth:10,transparentDepth:11,transmissionDepth:12},MIX_BL:{col:0},MIX_SHADER_BL:{color:0},NEW_GEOMETRY_BL:{position:0,normal:1,tangent:2,trueNormal:3,incoming:4,parametric:5,backfacing:6,pointiness:7,randomPerIsland:8},NORMAL_MAP_BL:{normal:0},OUTPUT_MATERIAL_BL:{outgoingLight:0},OUTPUT_WORLD_BL:{outgoingLight:0},RGB_BL:{color:0},SEPARATE_COLOR_BL:{r:0,g:1,b:2},TEX_COORD_BL:{generated:0,normal:1,uv:2,object:3,camera:4,window:5,reflection:6},TEX_ENVIRONMENT_BL:{color:0},TEX_IMAGE_BL:{color:0,alpha:0},UVMAP_BL:{uv:0},VALUE_BL:{value:0},BITMAP_MX:{color:0,value:1},BITMAP_ENV_MX:{color:0,value:1},FALLOFF_MX:{color:0},MATERIAL_MX:{color:0},NORMAL_BUMP_MX:{normal:0},OPENPBR_SURFACE_MX:{color:0},OUTPUT_MX:{outgoingLight:0},PHYSICAL_MX:{color:0},RGB_MX:{color:0},REFLECT_REFRACT_MX:{color:0},SUB_TRANSFORM_MX:{vector:0,normal:1},VALUE_MX:{value:0},BUMP_2D_MY:{normal:0},COLOR_CONSTANT_MY:{color:0,alpha:1},FILE_MY:{alpha:0,color:1,size:2,transparency:3},FLOAT_CONSTANT_MY:{value:0},LAMBERT_MY:{color:0},OPENPBR_SURFACE_MY:{color:0},PLACE_2D_TEXTURE_MY:{uv:0},RAMP_MY:{alpha:0,color:1},SAMPLER_INFO_MY:{facingRatio:0,flippedNormal:1,matrixEyeToWorld:2,normalCamera:3,pixelCenter:4,pointCamera:5,pointObj:6,pointWorld:7,tangentUCamera:8,tangentVCamera:9,uvCoord:10},SHADING_ENGINE_MY:{outgoingLight:0},SUB_TRANSFORM_MY:{vector:0,normal:1},SURFACE_SHADER_MY:{color:0,glowColor:1,matteOpacity:2,transparency:3},IMAGE_AR:{color:0,alpha:1,transparency:2},LAMBERT_AR:{color:0,alpha:1,transparency:2},MAP_TO_MTL_AR:{color:0},NORMAL_MAP_AR:{value:0},STANDARD_SURFACE_AR:{color:0,transparency:1},TRIPLANAR_AR:{color:0},TRIPLANAR_UV_AR:{uv:0,duvdx:1,duvdy:2},UV_PROJECTION_AR:{uv:0},NORMAL:{normal:0},RGB_ALPHA:{color:0,alpha:1},VALUE:{value:0}};function Et(o,e="",t={}){let n;switch(o){case"BACKGROUND_BL":n={inputs:[[0,0,0,1],1],outputs:[[0,0,0,0]]};break;case"BSDF_DIFFUSE_BL":case"DIFFUSE_BSDF_BL":n={inputs:[[.8,.8,.8,1],0,[0,0,0]],outputs:[[0,0,0,0]]};break;case"BSDF_PRINCIPLED_BL":n={inputs:[[.8,.8,.8,1],0,.5,1.5,1,[0,0,0],0,[1,.2,.1],.05,1.4,0,.5,[1,1,1,1],0,0,[0,0,0],0,0,.03,1.5,[1,1,1,1],[0,0,0],0,.5,[0,0,0,1],[1,1,1,1],0],outputs:[[0,0,0,0]]};break;case"BSDF_TRANSPARENT_BL":n={inputs:[[1,1,1,1]],outputs:[[0,0,0,0]]};break;case"LIGHT_PATH_BL":n={inputs:[],outputs:[0,0,0,0,0,0,0,0,0,0,0,0,0]};break;case"MIX_BL":n={dataType:"RGBA",clampFactor:!0,blendType:"MIX",clampResult:!1,factorMode:"UNIFORM",inputs:[.5,[.5,.5,.5,1],[.5,.5,.5,1]],outputs:[[0,0,0,0]]};break;case"MIX_SHADER_BL":n={inputs:[.5,[0,0,0,0],[0,0,0,0]],outputs:[[0,0,0,0]]};break;case"OUTPUT_MATERIAL_BL":n={inputs:[[0,0,0,0],[0,0,0,0],[0,0,0],0],outputs:[]};break;case"OUTPUT_WORLD_BL":n={inputs:[[0,0,0,1],[0,0,0,0]],outputs:[]};break;case"RGB_BL":n={inputs:[],outputs:[[.5,.5,.5,1]]};break;case"TEX_ENVIRONMENT_BL":n={projection:"EQUIRECTANGULAR",texture:-1,inputs:[[0,0,0]],outputs:[[0,0,0,0]]};break;case"TEX_IMAGE_BL":n={alphaMode:"STRAIGHT",clampToEdgeNoExtend:!1,projection:"FLAT",projectionBlend:0,texture:-1,inputs:[[0,0,0]],outputs:[[0,0,0,0],0]};break;case"UVMAP_BL":n={uvLayer:"",inputs:[],outputs:[[0,0,0]]};break;case"VALUE_BL":case"VALUE_MX":case"VALUE":n={inputs:[],outputs:[0]};break;case"BITMAP_MX":n={alphaAsMono:!1,alphaAsRGB:!1,alphaSource:"NONE",axis:"XY",clampToEdgeNoExtend:[!1,!1],mapping:"EXPLICIT_MAP_CHANNEL",texture:-1,uvIndex:0,inputs:[0,0,1,1,0],outputs:[[0,0,0,0]]};break;case"PHYSICAL_MX":n={brdfCurve:5,brdfHigh:1,brdfLow:.05,brdfMode:!0,emitLuminance:1500,roughnessInv:!1,thinWalled:!1,transRoughnessInv:!1,transRoughnessLock:!0,inputFactors:[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],inputs:[1,[1,1,1,1],1,[1,1,1,1],.5,0,0,0,0,0,[1,1,1,1],0,1.5,0,[0,0,0,0],0,0,[1,1,1,1],0,[1,1,1,1],0,[0,0,0],[0,0,0],0,1],outputs:[[0,0,0,0]]};break;case"OUTPUT_MX":n={inputs:[[0,0,0,0]],outputs:[]};break;case"RGB_MX":n={inputs:[],outputs:[[0,0,0,1]]};break;case"COLOR_CONSTANT_MY":n={inputs:[[0,0,0],1],outputs:[[0,0,0],0]};break;case"FILE_MY":n={fileHasAlpha:!1,texture:-1,inputs:[[0,0]],outputs:[1,[0,0,0],[2048,2048],[0,0,0]]};break;case"FLOAT_CONSTANT_MY":n={inputs:[0],outputs:[0]};break;case"LAMBERT_MY":n={inputs:[[.5,.5,.5],[0,0,0],[0,0,0],1,.8,[0,0,0],0,[0,0,0]],outputs:[[0,0,0,0]]};break;case"PLACE_2D_TEXTURE_MY":n={uvIndex:0,inputs:[[0,0],[1,1],0],outputs:[[0,0]]};break;case"SHADING_ENGINE_MY":n={inputs:[[0,0,0,0],[0,0,0,0],[0,0,0]],outputs:[]};break;case"LAMBERT_AR":n={inputs:[.7,[1,1,1],[0,0,0],[0,0,0]],outputs:[[0,0,0,0],0,[0,0,0]]};break;case"STANDARD_SURFACE_AR":n={thinWalled:!0,inputs:[1,[.8,.8,.8],0,0,1,[1,1,1],.2,0,[0,0,0],0,[0,0,0],0,0,[1,1,1],[1,1,1],0,[1,1,1],.1,0,[1,1,1],.3,0,[1,1,1],[1,1,1],[0,0,0],[0,0,0],1.5],outputs:[[0,0,0,0],[0,0,0]]};break;case"RGB_ALPHA":n={inputs:[],outputs:[[0,0,0],1]};break;default:console.error("v3d.NodeUtils.createNode: Invalid node:",o)}return n?(n.name=e,n.type=o,["OUTPUT_MATERIAL_BL","OUTPUT_WORLD_BL","OUTPUT_MX","SHADING_ENGINE_MY"].includes(o)?n.is_active_output=!0:n.is_active_output=!1,Object.assign(n,t),{originData:n}):void 0}function sa(o){return o.originData.type}function QA(o){let e=sa(o);const t=o.originData;if(e=="BSDF_PRINCIPLED_BL")switch(t.inputs.length){case 27:case 29:e="BSDF_PRINCIPLED_BF43_BL";break;case 25:e="BSDF_PRINCIPLED_BF40_BL"}return e=="BSDF_GLOSSY_BL"&&t.inputs.length===3&&(e="BSDF_GLOSSY_BF40_BL"),e=="BUMP_BL"&&t.inputs.length===6&&(e="BUMP_BF32_BL"),e}function Ra(o,e){const t=sa(o);return Array.isArray(e)?e.includes(t):e===t}function Ma(o,e){for(let t=0;t<o.len();t++)if(sa(o.node(t))==e)return t;return-1}function hw(o,e){for(let t=0;t<o.len();t++)if(o.node(t).originData.name==e)return t;return-1}function pt(o,e,t,n=""){if(!Number.isFinite(t))return console.error("v3d.NodeUtils.findConnectedNode: Invalid input index"),null;typeof e=="object"&&(e=o.nodeIndex(e));for(let r in o.edges){const a=o.edges[r];if(a.to()==e){const i=o.node(a.from());for(let s=0;s<a.connections.length;s++)if(a.connections[s].to===t&&(n===""||Ra(i,n)))return i}}return null}function ote(o,e,t,n=""){if(!Number.isFinite(t))return console.error("v3d.NodeUtils.findAllConnectedNodes: Invalid input index"),null;typeof e=="object"&&(e=o.nodeIndex(e));const r=[];for(let a in o.edges){const i=o.edges[a];if(i.to()==e){const s=o.node(i.from());if(n&&!Ra(s,n))continue;for(let c=0;c<i.connections.length;c++){const u=i.connections[c];u.to===t&&r.push({node:s,nodeIdx:i.from(),outputIdx:u.from,channelMatrix:u.channelMatrix})}}}return r}function nn(o,e,t){if(!Number.isFinite(t))return console.error("v3d.NodeUtils.isConnInput: Invalid input index"),!1;const n=o.findInEdges(e);for(let r=0;r<n.length;r++){const a=n[r];for(let i=0;i<a.connections.length;i++)if(a.connections[i].to==t)return!0}return!1}function Bu(o,e,t){if(!Number.isFinite(t))return console.error("v3d.NodeUtils.isConnOutput: Invalid output index"),!1;for(let n in o.edges){const r=o.edges[n];if(r.from()==e){for(let a=0;a<r.connections.length;a++)if(r.connections[a].from==t)return!0}}return!1}function Ke(o,e,t,n,r,a){if(!Number.isFinite(t)||!Number.isFinite(r))return void console.error("v3d.NodeUtils.connectNodes: Invalid input/output index");o.edge(e,n)||o.addNewEdge(e,n);const i=o.edge(e,n);i.connections=i.connections||[];const s={from:t,to:r};a&&(s.channelMatrix=a),i.connections.push(s)}function T2(o){return o.endsWith("_AR")||o.endsWith("_BL")||o.endsWith("_MX")||o.endsWith("_MY")?o.slice(0,-3):o}function kr(o,e){return p5("NODE_"+T2(o))+"Uni"+e}function pw(o){const e=new bn(o.len());for(let t=0;t<e.len();t++)eB(o.node(t),e.node(t));for(let t in o.edges){const n=o.edges[t];e.addNewEdge(n.from(),n.to()).connections=n.connections.slice()}return e}function eB(o,e){e||(e={}),e.originData={};for(const t in o.originData)e.originData[t]=t=="texture"?o.originData[t]:JSON.parse(JSON.stringify(o.originData[t]));return o.attributes&&(e.attributes=JSON.parse(JSON.stringify(o.attributes))),o.params&&(e.params=JSON.parse(JSON.stringify(o.params))),o.inputFactors&&(e.inputFactors=o.inputFactors.slice(0)),o.inputs&&(e.inputs=JSON.parse(JSON.stringify(o.inputs))),o.outputs&&(e.outputs=JSON.parse(JSON.stringify(o.outputs))),e}function mw(o){let e=-1;for(let t=0;t<o.len();t++)if(o.node(t).originData.is_active_output){e=t;break}if(e==-1)o.removeAll();else{const t=new bh(o.reverse(),e),n=[];for(let r=0;r<o.len();r++)t.hasPathTo(r)||n.push(o.node(r));n.forEach(function(r){o.disconnect(o.nodeIndex(r),!0)})}}function Pu(o,e,t,n=""){if(!Number.isFinite(t))return console.error("v3d.NodeUtils.disconnectInputNode: Invalid input index"),null;typeof e=="object"&&(e=o.nodeIndex(e));for(let r in o.edges){const a=o.edges[r];if(a.to()==e){const i=o.node(a.from());if(n&&!Ra(i,n))continue;for(let s=0;s<a.connections.length;s++){const c=a.connections[s];if(c.to===t)return o.removeEdge(a.from(),e),{node:i,outputIdx:c.from}}}}return null}function ate(o,e,t,n=""){if(!Number.isFinite(t))return console.error("v3d.NodeUtils.disconnectOutputNode: Invalid output index"),null;typeof e=="object"&&(e=o.nodeIndex(e));for(let r in o.edges){const a=o.edges[r];if(a.from()==e){const i=o.node(a.to());if(n&&!Ra(i,n))continue;for(let s=0;s<a.connections.length;s++){const c=a.connections[s];if(c.from==t)return o.removeEdge(e,a.to()),{node:i,inputIdx:c.to}}}}return null}const ite=1500/Math.PI,HA={LAMBERT_AR:2,STANDARD_SURFACE_AR:24,BEVEL_BL:1,BSDF_DIFFUSE_BL:2,BSDF_GLASS_BL:3,BSDF_GLOSSY_BL:4,BSDF_GLOSSY_BF40_BL:2,BSDF_METALLIC_BL:7,BSDF_PRINCIPLED_BL:5,BSDF_PRINCIPLED_BF43_BL:5,BSDF_PRINCIPLED_BF40_BL:22,BSDF_REFRACTION_BL:3,BSDF_SHEEN_BL:2,BSDF_TRANSLUCENT_BL:1,BUMP_BL:3,BUMP_BF32_BL:5,DIFFUSE_BSDF_BL:2,EEVEE_SPECULAR_BL:5,FRESNEL_BL:1,LAYER_WEIGHT_BL:1,BLINN_MY:5,LAMBERT_MY:5,OPENPBR_SURFACE_MY:21,PHONG_MY:5,PHONG_E_MY:5,SAMPLER_INFO_MY:0},Zi=["BSDF_DIFFUSE_BL","BSDF_GLOSSY_BL","BSDF_METALLIC_BL","BSDF_PRINCIPLED_BL","DIFFUSE_BSDF_BL","EEVEE_SPECULAR_BL","EMISSION_BL"],ste=["PHYSICAL_MX","LAMBERT_AR","OPENPBR_SURFACE_MX","STANDARD_SURFACE_AR","MAP_TO_MTL_AR"],WA=["STANDARD_SURFACE_AR","LAMBERT_MY","LAMBERT_AR","OPENPBR_SURFACE_MY","SURFACE_SHADER_MY"],Vf={color:new Qe(16777215),map:null,opacity:1,alphaMap:null,metalness:.5,metalnessMap:null,roughness:.5,roughnessMap:null,normalMap:null,normalScale:new Ee(1,1),aoMap:null,aoMapIntensity:1,emissive:new Qe(0),emissiveMap:null,emissiveIntensity:0};class Ba extends Er{constructor(e){super();const t=this;function n(L,U){const k=L.node(U);k.originData.type;for(let J=0;J<k.originData.inputs.length;J++)r(L,U,k.originData,J)}function r(L,U,k,J,de){if(nn(L,U,J))return!1;const te=k.name+" "+(de||"Input "+J),le=k.inputs[J],V=$(le);let G,ee,X=k.type.slice(-3);switch(X!="_BL"&&X!="_MX"&&(X=V=="float"?"":"_ALPHA"),V){case"float":G=Et("VALUE"+X,te),ee=st[sa(G)].value,G.originData.outputs[ee]=le;break;case"vec3":G=Et("RGB"+X,te),ee=st[sa(G)].color,G.originData.outputs[ee][0]=le[0],G.originData.outputs[ee][1]=le[1],G.originData.outputs[ee][2]=le[2];break;case"vec4":G=Et("RGB"+X,te),ee=st[sa(G)].color,G.originData.outputs[ee][0]=le[0],G.originData.outputs[ee][1]=le[1],G.originData.outputs[ee][2]=le[2],Ra(G,"RGB_ALPHA")?G.originData.outputs[st[sa(G)].alpha]=le[3]:G.originData.outputs[ee][3]=le[3];break;default:throw new Error("Unsupported group input")}return L.addNode(G),Ke(L,L.len()-1,ee,U,J),!0}function a(L,U,k){const J={inputs:[],outputs:[],removedNodes:[]};J.removedNodes.push(k);const de=Ma(U,"GROUP_INPUT_BL");if(de>-1){J.removedNodes.push(de+L.len());const G=L.findInEdges(k),ee=U.findOutEdges(de);for(let X=0;X<G.length;X++){const W=G[X];for(let Y=0;Y<ee.length;Y++){const P=ee[Y];for(let Q=0;Q<W.connections.length;Q++){const I=W.connections[Q];for(let N=0;N<P.connections.length;N++){const se=P.connections[N];if(I.to==se.from){let ce=s(J.inputs,W.from(),P.to());ce||(ce=new ko(W.from(),P.to()),ce.connections=[],J.inputs.push(ce));const fe={from:I.from,to:se.to};ce.connections.push(fe)}}}}}}const te=Ma(U,"GROUP_OUTPUT_BL");J.removedNodes.push(te+L.len());const le=L.findOutEdges(k),V=U.findInEdges(te);for(let G=0;G<le.length;G++){const ee=le[G];for(let X=0;X<V.length;X++){const W=V[X];for(let Y=0;Y<ee.connections.length;Y++){const P=ee.connections[Y];for(let Q=0;Q<W.connections.length;Q++){const I=W.connections[Q];if(P.from==I.to){let N=s(J.outputs,W.from(),ee.to());N||(N=new ko(W.from(),ee.to()),N.connections=[],J.outputs.push(N));const se={from:I.from,to:P.to};N.connections.push(se)}}}}}return J}function i(L,U){Array.isArray(U)||(U=[U]);let k=0;for(let J=0;J<L.len();J++){const de=L.node(J);for(let te=0;te<U.length;te++){const le=U[te];de.originData.type==le&&k++}}return k}function s(L,U,k){for(let J=0;J<L.length;J++){const de=L[J];if(de.from()==U&&de.to()==k)return de}return null}function c(L,U,k){const J=k.type;let de=L.findInEdges(U);for(let te=0;te<de.length;te++){const le=de[te];let V=L.node(le.from()).originData;for(let G=0;G<le.connections.length;G++){const ee=le.connections[G];if(J=="MATERIAL_MX"&&h(V.type)&&(ee.to==Ae[J].reflection?V.reflectMode="MAX_ENV_COORDS_REFLECT":ee.to==Ae[J].refraction&&(V.reflectMode="MAX_ENV_COORDS_REFRACT")),f(J,ee.to)){if(V.type=="BITMAP_MX"||V.type=="OUTPUT_MAP_MX"){L.removeEdge(le.from(),le.to()),V.type=="OUTPUT_MAP_MX"&&(V=pt(L,le.from(),0).originData);const X={originData:{name:V.name+"Bump"+te,type:"BUMP_MX",texture:V.texture,uvIndex:V.uvIndex,inputs:JSON.parse(JSON.stringify(V.inputs)),outputs:[[0,0,0]]}};L.addNode(X),Ke(L,L.len()-1,0,U,ee.to),te=-1,de=L.findInEdges(U);break}for(let X=0;X<L.len();X++){const W=L.node(X).originData;if(u(W.type)){const Y=W.inputs.length-1;Ke(L,le.from(),ee.from,X,Y),W.inputFactors[Y]=k.inputFactors[ee.to]}}}}}}function u(L){return!(!h(L)&&L!="FALLOFF_MX")}function h(L){return L=="BITMAP_ENV_MX"||L=="REFLECT_REFRACT_MX"}function f(L,U){switch(L){case"BITMAP_ENV_MX":case"FALLOFF_MX":case"MATERIAL_MX":case"REFLECT_REFRACT_MX":return U==Ae[L].normal;case"OPENPBR_SURFACE_MX":case"PHYSICAL_MX":return U==Ae[L].normal||U==Ae[L].clearcoatNormal;default:return!1}}function m(L,U,k){const J=k.blendMode.length,de=L.findInEdges(U),te=L.findOutEdges(U);for(let le=0;le<J;le++){const V={originData:{name:k.name+"Layer"+le,type:"COMPOSITE_LAYER_MX",blendMode:le!=0?k.blendMode[le]:0,opacity:k.opacity[le],inputs:[[0,0,0,0]].concat(k.inputs.slice(2*le,2*le+2)),outputs:[k.outputs[le]]}};L.addNode(V);for(let G=0;G<de.length;G++){const ee=de[G];for(let X=0;X<ee.connections.length;X++){const W=ee.connections[X];W.to==2*le&&k.mapEnabled[le]?Ke(L,ee.from(),W.from,L.len()-1,1):W.to==2*le+1&&k.maskEnabled[le]&&Ke(L,ee.from(),W.from,L.len()-1,2)}}le>0&&Ke(L,L.len()-2,0,L.len()-1,0)}for(let le=0;le<te.length;le++){const V=te[le];for(let G=0;G<V.connections.length;G++){const ee=V.connections[G];Ke(L,L.len()-1,0,V.to(),ee.to)}}}function g(L,U,k){const J=k.output,de=L.findInEdges(U),te=L.findOutEdges(U),le={originData:{name:k.name+"Output",type:"OUTPUT_MAP_MX",invert:J.invert,clamp:J.clamp,alphaFromRGB:J.alphaFromRGB,inputs:[[0,0,0,0],J.rgbLevel,J.rgbOffset,J.outputAmount,J.bumpAmount],outputs:[[0,0,0,0]]}};_e(J.colorMap)&&(le.originData.colorMap=J.colorMap),L.addNode(le);for(let V=0;V<te.length;V++){const G=te[V];for(let ee=0;ee<G.connections.length;ee++){const X=G.connections[ee];Ke(L,L.len()-1,0,G.to(),X.to)}}L.disconnect(U,!1);for(let V=0;V<de.length;V++)L.addEdge(de[V]);Ke(L,U,0,L.len()-1,0),delete k.output}function A(L,U,k){const J=k.inputs.length/4,de=L.findInEdges(U),te=L.findOutEdges(U);for(let le=0;le<J;le++){const V={originData:{name:k.name+"Layer"+le,type:"LAYERED_TEXTURE_LAYER_MY",inputs:[0,[0,0,0]].concat(k.inputs.slice(4*le,4*le+4)),outputs:[0,[0,0,0]]}};L.addNode(V);for(let G=0;G<de.length;G++){const ee=de[G];for(let X=0;X<ee.connections.length;X++){const W=ee.connections[X];W.to==4*le?Ke(L,ee.from(),W.from,L.len()-1,2,W.channelMatrix):W.to==4*le+1?Ke(L,ee.from(),W.from,L.len()-1,3,W.channelMatrix):W.to==4*le+2?Ke(L,ee.from(),W.from,L.len()-1,4,W.channelMatrix):W.to==4*le+3&&Ke(L,ee.from(),W.from,L.len()-1,5,W.channelMatrix)}}le>0&&(Ke(L,L.len()-1,0,L.len()-2,0),Ke(L,L.len()-1,1,L.len()-2,1))}for(let le=0;le<te.length;le++){const V=te[le];for(let G=0;G<V.connections.length;G++){const ee=V.connections[G];Ke(L,L.len()-J,ee.from,V.to(),ee.to,ee.channelMatrix)}}}function _(L){return L.type.indexOf("uniform")>-1}function x(L){return L.type.indexOf("varying")>-1}function C(L,U){return U=_e(U)?U:"color",t.nodeVCAliases[L]||U}function b(L,U,k,J){const de=new ss(L,U,1,k,J,In.DEFAULT_MAPPING,1001,1001,1006,1006);return de.name="Node.parametric",de.needsUpdate=!0,de}function y(L){return L.isVideoTexture===!0&&L.encoding===3001?"1":!L.isDataTexture||L.encoding!==3001||L.type!=1015&&L.type!=1016?"0":"1"}function M(L,U,k,J,de){let te;return U==k?te=L:U=="float"&&k=="vec3"?te="vec3("+[L,L,L].join(",")+")":U=="float"&&k=="vec4"?te="vec4("+[L,L,L,L].join(",")+")":U=="vec3"&&k=="float"||U=="vec4"&&k=="float"?te="("+[L+"[0]",L+"[1]",L+"[2]"].join("+")+")/3.0":U=="vec3"&&k=="vec4"?te="vec4("+L+", 1.0)":U=="vec4"&&k=="vec3"?te="vec3("+[L+"[0]",L+"[1]",L+"[2]"].join(",")+")":U=="float"&&k=="int"?te="int("+L+")":U=="int"&&k=="float"||U=="bool"&&k=="float"?te="float("+L+")":console.error("MeshNodeMaterial: Missing type conversion: "+U+" -> "+k),(de<1||de!=1&&J=="normal")&&(te="mix("+J+","+te+","+ie(de)+")",J=="normal"&&(te="normalize("+te+")")),te}function R(L,U,k,J,de){let te;const le=[],V=K(k),G=K(J);for(let ee=0;ee<G;ee++){let X=G==1?de:de+"["+ee+"]";for(let W=0;W<L.length;W++){const Y=L[W],P=U[W];for(let Q=0;Q<V;Q++)P[Q][ee]&&(X=V==1?Y:Y+"["+Q+"]")}le.push(X)}return te=J+"("+le.join(",")+")",te}function T(L,U,k,J,de,te){for(let le in L.edges){const V=L.edges[le];if(V.to()==U){const G=L.node(V.from());for(let ee=0;ee<V.connections.length;ee++){const X=V.connections[ee];if(X.to==k){const W=G.originData.type;W!="BITMAP_MX"&&W!="BITMAP_ENV_MX"||$(J)!="float"?de.push(G.outputs[X.from]):de.push(G.outputs[X.from+1]),X.channelMatrix&&te.push(X.channelMatrix)}}}}}function w(L){return{name:"",type:$(L),value:L}}function D(L,U){const k=kr(L,U);return{name:k,type:t.nodeTextures[k].isCubeTexture?"uniform samplerCube":"uniform sampler2D",value:""}}function z(L){return{name:"",type:"int",value:L}}function F(L){return O(L?"true":"false")}function O(L){return{name:L,type:"",value:""}}function q(L,U,k){return k=k||L,{name:"nodeVaryParam"+ug(L),type:"varying "+he(U),value:"",attrBindName:k}}function ne(L){return L?1:0}function $(L){return typeof L=="number"?"float":typeof L=="boolean"?"bool":he(L.length)}function he(L){switch(L){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";case 9:return"mat3";case 16:return"mat4"}}function K(L){switch(L){case"float":case"int":case"bool":return 1;case"vec2":return 2;case"vec3":return 3;case"vec4":return 4;case"mat3":return 9;case"mat4":return 16}}function oe(L,U){switch(L){case"float":return ie(U);case"bool":case"int":return String(U);default:const k=[];for(let J=0;J<U.length;J++)k.push(ie(U[J]));return L+"("+k.join(",")+")"}}function ie(L){return L%1?String(L):String(L)+".0"}this.isMeshNodeMaterial=!0,this.type="MeshNodeMaterial",this.defines={LIGHT_PATH_IS_CAM_RAY:1,WORLD_NODES:0,NORMAL_OUTPUT:0},this.definesFragOnly=new Set(["LIGHT_PATH_IS_CAM_RAY","WORLD_NODES","NORMAL_OUTPUT"]),this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.fog=!0,this.profile="blender",this.nodeTextures={},this.nodeValue=[],this.nodeValueMap={},this.nodeRGB=[],this.nodeRGBMap={},this.nodeTexCoordObject=[],this.nodeTexCoordObjectMap={},this.nodeInputs={},this.needsBoundingBox=!1,this.useFloatTex=!1,this.nodeGraph=null,this.additionalNodeGraphs={},this.nodeChunks={},this.nodeChunksHash=0,this.nodeVCAliases={},this.nodeUVAliases={},this.envMap=null,this.envMapIntensity=1,this.envMapParallaxType=0,this.envMapParallaxMatrix=new Ve,this.envMapParallaxMatrixInv=new Ve,this.materialIndex=0,this.ssrParams=null,_e(e)&&this.setValues(e),this.nodeGraph||(this.nodeGraph=function(){const L=new bn(1),U=t.color;return L.node(0).originData={name:"ShadelessOutput",type:"OUTPUT_MATERIAL_BL",inputs:[[U.r,U.g,U.b,1],[0,0,0,0],[0,0,0]],outputs:[],is_active_output:!0},L}()),this.updateNodeGraph=function(L=!1){const U=this.nodeValue,k=this.nodeRGB,J=this.nodeTexCoordObject;this.nodeTextures={},this.nodeRGB=[],this.nodeRGBMap={},this.nodeValue=[],this.nodeValueMap={},this.nodeTexCoordObject=[],this.nodeTexCoordObjectMap={},this.needsBoundingBox=!1,this.nodeChunks={};const de=this.nodeGraph;if(function(te){let le=0,V=0,G=0,ee=0,X=0;for(let Q=0;Q<te.len();Q++){const I=te.node(Q),N=I.originData,se=N.type;let ce,fe,ve,xe,Ie,re,me,pe,Ce,we,be,Pe,Ge,tt,ot,Pt,$t;I.attributes=[],I.params=[],I.inputFactors=[],I.inputs=[],I.outputs=[],_e(N.inputFactors)&&(I.inputFactors=N.inputFactors.slice(0));for(let St=0;St<N.outputs.length;St++){const De=N.outputs[St],Un=N.outputTypes?N.outputTypes[St]:$(De);I.outputs.push({name:p5(T2(se))+Q+"Out"+St,type:Un,clamp:!1,normalize:!1})}switch(se!="OUTPUT_MATERIAL_BL"&&se!="OUTPUT_WORLD_BL"&&se!="OUTPUT_MX"&&se!="SHADING_ENGINE_MY"&&se!="SKYDOME_LIGHT_AR"||I.outputs.push({name:"outgoingLight",type:"",clamp:!1,normalize:!1}),se){case"ATAN_AR":I.params.push(O(N.units));break;case"CLAMP_AR":case"COLOR_TO_FLOAT_AR":case"COLOR_TO_FLOAT_AR":case"FLOAT_TO_INT_AR":case"LENGTH_AR":case"MIX_SHADER_AR":case"RGB_TO_FLOAT_AR":case"RGB_TO_VECTOR_AR":case"RGBA_TO_FLOAT_AR":case"RGB_TO_VECTOR_AR":case"VECTOR_TO_RGB_AR":I.params.push(O(N.mode));break;case"COLOR_CONVERT_AR":I.params.push(O(N.from)),I.params.push(O(N.to));break;case"CHECKERBOARD_AR":case"PLACE_2D_TEXTURE_MY":ce=N.uvIndex?"uv"+String(N.uvIndex+1):"uv",fe=q(ce,2),I.attributes.push({name:ce,type:"attribute vec2"}),I.params.push(fe);break;case"COMPOSITE_AR":I.params.push(O(N.operation)),I.params.push(O(N.alphaOperation));break;case"FACING_RATIO_AR":case"FACING_RATIO_AR":case"SHADOW_MATTE_AR":case"NORMAL":I.params.push(O("normal"));break;case"COMPARE_AR":I.params.push(O(N.test));break;case"IMAGE_AR":re=N.texture,t.nodeTextures[kr(se,le)]=re,I.params.push(D(se,le)),le++,I.params.push(O(y(re)));break;case"LAMBERT_AR":case"BSDF_GLASS_BL":case"BSDF_GLOSSY_BL":case"BLINN_MY":case"LAMBERT_MY":case"PHONG_MY":case"PHONG_E_MY":I.params.push(O("geometryNormal"));break;case"MAP_TO_MTL_AR":I.params.push(F(N.opaqueEnabled));break;case"MATRIX_TRANSFORM_AR":I.params.push(O(N.transformOrder)),I.params.push(O(N.rotationType)),I.params.push(O(N.rotationUnits)),I.params.push(O(N.rotationOrder));break;case"NORMAL_MAP_AR":ce="tangent",fe=q(ce,4),I.attributes.push({name:ce,type:"attribute vec4"}),I.params.push(fe);break;case"SHUFFLE_AR":case"CHANNELS_MY":I.params.push(O(N.channelR)),I.params.push(O(N.channelG)),I.params.push(O(N.channelB)),I.params.push(O(N.channelA));break;case"STANDARD_SURFACE_AR":I.params.push(O("geometryNormal")),I.params.push(F(N.thinWalled)),(N.inputs[Ae[se].clearcoat]>0||nn(te,Q,Ae[se].clearcoat))&&(t.defines.USE_CLEARCOAT=""),(N.inputs[Ae[se].sheen]>0||nn(te,Q,Ae[se].sheen))&&(t.defines.USE_SHEEN=""),I.inputFactors.length=0;break;case"TRIGO_AR":I.params.push(O(N.function)),I.params.push(O(N.units));break;case"TRIPLANAR_AR":I.params.push(O(N.coordSpace)),I.params.push(F(N.inputPerAxis)),I.params.push(F(N.flipOnOppositeDirection)),I.params.push(w(N.blendFactor));break;case"TRIPLANAR_UV_AR":I.params.push(F(N.flipOnOppositeDirection)),N.blendFactor!==void 0&&I.params.push(w(N.blendFactor)),N.projectionAxis!==void 0&&I.params.push(O(N.projectionAxis));break;case"TWO_SIDED_AR":I.params.push(O("faceDirection"));break;case"USER_DATA_COLOR_AR":ce=C(N.colorLayer,""),ce?(fe=q(ce,4),I.attributes.push({name:ce,type:"attribute vec4"}),I.params.push(fe)):I.params.push(O(oe("vec4",N.defaultColor)));break;case"UV_PROJECTION_AR":I.params.push(O(N.projectionType)),I.params.push(O(N.coordSpace));break;case"ATTRIBUTE_BL":case"VERTEX_COLOR_BL":ce=C(N.colorLayer,""),ce?(fe=q(ce,4),I.attributes.push({name:ce,type:"attribute vec4"}),I.params.push(fe)):I.params.push(O("vec4(0.0, 0.0, 0.0, 1.0)"));break;case"BSDF_METALLIC_BL":I.params.push(O("geometryNormal")),I.params.push(O("BSDF_METALLIC_"+N.distribution)),I.params.push(F(N.fresnelType==="PHYSICAL_CONDUCTOR"));break;case"BSDF_PRINCIPLED_BL":I.params.push(O("geometryNormal"));const St=QA(I);(N.inputs[Ae[St].clearcoat]>0||nn(te,Q,Ae[St].clearcoat))&&(t.defines.USE_CLEARCOAT=""),(N.inputs[Ae[St].sheen]>0||nn(te,Q,Ae[St].sheen))&&(t.defines.USE_SHEEN_BLENDER="");break;case"BSDF_REFRACTION_BL":I.params.push(O("geometryNormal")),I.params.push(O("BSDF_REFRACTION_"+N.distribution));break;case"BUMP_BL":I.params.push(w(N.invert));break;case"CAMERA_BL":I.params.push(O("vViewPosition")),i(te,"OUTPUT_MATERIAL_BL")>0||i(te,"OUTPUT_WORLD_BL")>0?I.params.push(F(!0)):I.params.push(F(!1));break;case"CLAMP_BL":I.params.push(O(N.clampType=="RANGE"));break;case"COMBINE_COLOR_BL":I.params.push(O("NODE_COMB_COL_"+N.mode));break;case"CURVE_FLOAT_BL":t.useFloatTex?(ve=new Float32Array(1024),xe=1):(ve=new Uint8Array(1024),xe=255);for(let Z=0;Z<256;Z++){let Te=xe*(N.curveData[Z]/2+.5);ve[4*Z]=Ft(Te,0,xe)}re=b(ve,256,1023,t.useFloatTex?1015:1009),me=kr(se,V),t.nodeTextures[me]=re,I.params.push(D(se,V)),V++;break;case"CURVE_RGB_BL":case"CURVE_VEC_BL":t.useFloatTex?(ve=new Float32Array(1024),xe=1):(ve=new Uint8Array(1024),xe=255);for(let Z=0;Z<256;Z++){let Te,Le,Ue,Ne;Ce=N.curveData.length/256,Ce>3?(Te=xe*N.curveData[Ce*Z],Le=xe*N.curveData[Ce*Z+1],Ue=xe*N.curveData[Ce*Z+2],Ne=xe*N.curveData[Ce*Z+3]):(Te=xe*(N.curveData[Ce*Z]/2+.5),Le=xe*(N.curveData[Ce*Z+1]/2+.5),Ue=xe*(N.curveData[Ce*Z+2]/2+.5),Ne=xe),ve[4*Z]=Ft(Te,0,xe),ve[4*Z+1]=Ft(Le,0,xe),ve[4*Z+2]=Ft(Ue,0,xe),ve[4*Z+3]=Ft(Ne,0,xe)}re=b(ve,256,1023,t.useFloatTex?1015:1009),me=kr(se,V),t.nodeTextures[me]=re,I.params.push(D(se,V)),V++;break;case"EEVEE_SPECULAR_BL":I.params.push(O("geometryNormal")),(N.inputs[Ae[se].clearcoat]>0||nn(te,Q,Ae[se].clearcoat))&&(t.defines.USE_CLEARCOAT="");break;case"FRESNEL_BL":case"LAYER_WEIGHT_BL":case"INCIDENT":case"POSITION":I.params.push(O("vViewPosition"));break;case"GRADIENT_MX":I.params.push(O(oe("float",N.color2Pos))),I.params.push(O(oe("int",N.gradientType))),ce=N.uvIndex?"uv"+String(N.uvIndex+1):"uv",fe=q(ce,2),I.attributes.push({name:ce,type:"attribute vec2"}),I.params.push(fe),I.params.push(O("vViewPosition")),I.params.push(O("MAPPING_"+N.mapping)),I.params.push(O("AXIS_"+N.axis)),I.params.push(O(oe("ivec2",[ne(N.clampToEdgeNoExtend[0]),ne(N.clampToEdgeNoExtend[1])])));break;case"GRADIENT_RAMP_MX":t.useFloatTex?(ve=new Float32Array(2048),xe=1):(ve=new Uint8Array(2048),xe=255);for(let Z=0;Z<512;Z++){let Te,Le,Ue,Ne;Te=xe*N.gradientData[3*Z],Le=xe*N.gradientData[3*Z+1],Ue=xe*N.gradientData[3*Z+2],Ne=1,ve[4*Z]=Ft(Te,0,xe),ve[4*Z+1]=Ft(Le,0,xe),ve[4*Z+2]=Ft(Ue,0,xe),ve[4*Z+3]=Ft(Ne,0,xe)}re=b(ve,512,1023,t.useFloatTex?1015:1009),me=kr(se,V),t.nodeTextures[me]=re,I.params.push(D(se,V)),V++,I.params.push(O(oe("int",N.gradientType))),ce=N.uvIndex?"uv"+String(N.uvIndex+1):"uv",fe=q(ce,2),I.attributes.push({name:ce,type:"attribute vec2"}),I.params.push(fe),I.params.push(O("geometryNormal")),I.params.push(O("vViewPosition")),["SPHERICAL_ENVIRONMENT","CYLINDRICAL_ENVIRONMENT","SHRINK_WRAP_ENVIRONMENT","SCREEN"].indexOf(N.mapping)>-1?I.params.push(O("MAPPING_EXPLICIT_MAP_CHANNEL")):I.params.push(O("MAPPING_"+N.mapping)),I.params.push(O("AXIS_"+N.axis)),I.params.push(O(oe("ivec2",[ne(N.clampToEdgeNoExtend[0]),ne(N.clampToEdgeNoExtend[1])])));break;case"MAPPING_BL":I.params.push(O("NODE_MAPPING_"+N.vectorType));break;case"MAP_RANGE_BL":_e(N.dataType)&&I.params.push(O("NODE_MAP_RANGE_TYPE_"+N.dataType)),I.params.push(O("NODE_MAP_RANGE_INTERP_"+N.interpolationType)),I.params.push(F(N.clamp));break;case"NEW_GEOMETRY_BL":I.params.push(O("faceDirection")),I.params.push(O("vViewPosition")),I.params.push(O("normal")),Bu(te,Q,st.NEW_GEOMETRY_BL.tangent)&&(t.needsBoundingBox=!0);break;case"NORMAL_MAP_BL":ce="tangent",fe=q(ce,4),I.attributes.push({name:ce,type:"attribute vec4"}),I.params.push(fe),I.params.push(O("vNormal"));break;case"SEPARATE_COLOR_BL":I.params.push(O("NODE_SEP_COL_"+N.mode));break;case"TANGENT_BL":N.directionType==="RADIAL"?(I.params.push(O("TANGENT_AXIS_"+N.axis)),I.params.push(O("vViewPosition")),I.params.push(O("normal")),t.needsBoundingBox=!0):N.directionType==="UV_MAP"&&(ce="tangent",fe=q(ce,4),I.attributes.push({name:ce,type:"attribute vec4"}),I.params.push(fe));break;case"TEX_BRICK_BL":I.params.push(O(oe("float",N.offset))),I.params.push(O(oe("int",N.offsetFrequency))),I.params.push(O(oe("float",N.squash))),I.params.push(O(oe("int",N.squashFrequency)));break;case"TEX_COORD_BL":I.params.push(O(`nodeTexCoordObjectMatrices[${ee}]`)),I.params.push(O("vViewPosition")),I.params.push(O("normal")),ce="uv",fe=q(ce,2),I.attributes.push({name:ce,type:"attribute vec2"}),I.params.push(fe),Bu(te,Q,st.TEX_COORD_BL.generated)&&(t.needsBoundingBox=!0),t.nodeTexCoordObject.push(null),t.nodeTexCoordObjectMap[N.name]=ee,ee++;break;case"TEX_ENVIRONMENT_BL":case"TEX_IMAGE_BL":if(re=N.texture,t.nodeTextures[kr(se,le)]=re,I.params.push(D(se,le)),le++,I.params.push(O(y(re))),se=="TEX_ENVIRONMENT_BL"){const Z=N.projection;I.params.push(O("TEX_PROJ_"+Z))}else if(se=="TEX_IMAGE_BL"){let Z;switch(N.alphaMode||"STRAIGHT"){case"STRAIGHT":Z=Bu(te,Q,1)?"TEX_ALPHA_CLEAR":"TEX_ALPHA_PREMUL";break;case"PREMUL":Z=Bu(te,Q,1)?"TEX_ALPHA_UNPREMUL":"TEX_ALPHA_CLEAR";break;case"CHANNEL_PACKED":Z="TEX_ALPHA_CLEAR";break;case"NONE":Z="TEX_ALPHA_ONE";break;default:console.error("MeshNodeMaterial: incorrect TEX_IMAGE_BL alpha mode"),Z="TEX_ALPHA_ONE"}I.params.push(O(Z)),I.params.push(O("normal"));const Te=N.projection;I.params.push(O("TEX_PROJ_"+Te)),I.params.push(w(N.projectionBlend)),I.params.push(F(N.clampToEdgeNoExtend))}break;case"TEX_GABOR_BL":I.params.push(O("TEX_GABOR_"+N.gaborType));break;case"TEX_GRADIENT_BL":I.params.push(O("TEX_GRAD_"+N.gradientType));break;case"TEX_NOISE_BL":_e(N.noiseType)&&I.params.push(O("TEX_NOISE_"+N.noiseType)),I.params.push(O(oe("float",N.falloffFactor))),I.params.push(O(oe("float",N.dispersionFactor)));break;case"TEX_SKY_BL":if(be=new B().fromArray(N.sunDirection).angleTo(new B(0,0,1)),N.skyType=="PREETHAM")Pe=Oo.getDistParams(N.turbidity,0).concat([0,0,0,0]),Ge=Oo.getDistParams(N.turbidity,1).concat([0,0,0,0]),tt=Oo.getDistParams(N.turbidity,2).concat([0,0,0,0]),ot=Oo.getZenithParams(N.turbidity,be,0),Pt=Oo.getZenithParams(N.turbidity,be,1),$t=Oo.getZenithParams(N.turbidity,be,2);else if(N.skyType=="HOSEK_WILKIE"){const Z=Math.max(Math.PI/2-be,0);Pe=Lu.getDistParams(N.turbidity,N.groundAlbedo,Z,0),Ge=Lu.getDistParams(N.turbidity,N.groundAlbedo,Z,1),tt=Lu.getDistParams(N.turbidity,N.groundAlbedo,Z,2),ot=Lu.getRadiance(N.turbidity,N.groundAlbedo,Z,0),Pt=Lu.getRadiance(N.turbidity,N.groundAlbedo,Z,1),$t=Lu.getRadiance(N.turbidity,N.groundAlbedo,Z,2)}else Pe=Ge=tt=new Array(9).fill(0),ot=Pt=$t=0;I.params.push(O("TEX_SKY_"+N.skyType)),I.params.push(w([Pe[0],Ge[0],tt[0]])),I.params.push(w([Pe[1],Ge[1],tt[1]])),I.params.push(w([Pe[2],Ge[2],tt[2]])),I.params.push(w([Pe[3],Ge[3],tt[3]])),I.params.push(w([Pe[4],Ge[4],tt[4]])),I.params.push(w([Pe[5],Ge[5],tt[5]])),I.params.push(w([Pe[6],Ge[6],tt[6]])),I.params.push(w([Pe[7],Ge[7],tt[7]])),I.params.push(w([Pe[8],Ge[8],tt[8]])),I.params.push(w([ot,Pt,$t])),I.params.push(w(N.sunDirection));break;case"TEX_VORONOI_BL":I.params.push(O("DISTANCE_"+N.distance)),I.params.push(O("FEATURE_"+N.feature));break;case"TEX_WAVE_BL":I.params.push(O("TEX_WAVE_TYPE_"+N.waveType)),I.params.push(O("TEX_WAVE_PROFILE_"+N.waveProfile)),I.params.push(O(`TEX_WAVE_BANDS_DIR_${N.bandsDirection}`)),I.params.push(O(`TEX_WAVE_RINGS_DIR_${N.ringsDirection}`));break;case"MATH_BL":I.outputs[0].clamp=N.useClamp;break;case"MIX_BL":switch(I.originData.blendType){case"HUE":case"SATURATION":case"VALUE":case"COLOR":t.defines.HSV_NODES=""}N.dataType=="RGBA"&&(I.outputs[0].clamp=N.clampResult);break;case"MIX_RGB_BL":switch(I.originData.blendType){case"HUE":case"SATURATION":case"VALUE":case"COLOR":t.defines.HSV_NODES=""}I.outputs[0].clamp=N.useClamp;break;case"MIX_SHADER_BL":let De=-1;for(let Z=1;Z<3;Z++){const Te=pt(te,Q,Z);Te&&Te.originData.type=="BSDF_TRANSPARENT_BL"&&(De=Z-1)}I.params.push(O(String(De)));break;case"NORMAL_BL":I.params.push(w(N.outputs[0]));break;case"RGB_BL":case"RGB_MX":pe=new ct().fromArray(N.outputs[0]),t.nodeRGB.push(pe),t.nodeRGBMap[N.name]=G,I.params.push(O("nodeRGB["+G+"]")),G++;break;case"SUB_TRANSFORM_MX":case"SUB_TRANSFORM_MY":I.params.push(O(N.coordSpace));break;case"UVMAP_BL":W=N.uvLayer,ce=t.nodeUVAliases[W]||"uv",fe=q(ce,2),I.attributes.push({name:ce,type:"attribute vec2"}),I.params.push(fe);break;case"VALUE_BL":case"VALUE_MX":case"ANIM_CURVE_TA_MY":case"ANIM_CURVE_TU_MY":case"VALUE":pe=N.outputs[0],t.nodeValue.push(pe),t.nodeValueMap[N.name]=X,I.params.push(O("nodeValue["+X+"]")),X++;break;case"VALTORGB_BL":we=N.curve;const Un=new(we.interpolation=="STEP"?nb:Lv)(new Float32Array(we.input),new Float32Array(we.output),4);t.useFloatTex?(ve=new Float32Array(1024),xe=1):(ve=new Uint8Array(1024),xe=255);for(let Z=0;Z<256;Z++){const Te=Un.evaluate(Z/255);ve[4*Z]=xe*Te[0],ve[4*Z+1]=xe*Te[1],ve[4*Z+2]=xe*Te[2],ve[4*Z+3]=xe*Te[3]}re=b(ve,256,1023,t.useFloatTex?1015:1009),we.interpolation=="STEP"&&(re.minFilter=1003,re.magFilter=1003),me=kr(se,V),t.nodeTextures[me]=re,I.params.push(D(se,V)),V++;break;case"VECTOR_ROTATE_BL":I.params.push(O(oe("float",N.invert?-1:1)));break;case"VECT_TRANSFORM_BL":const dn=N.vectorType,Nt=N.convertFrom,rn=N.convertTo;dn=="NORMAL"&&(I.outputs[0].normalize=!0);let Bn="";Nt==rn?Bn="VEC_TRANS_NONE":(Bn="VEC_TRANS_"+Nt[0]+"_"+rn[0],dn!="VECTOR"&&dn!="NORMAL"||(Bn+="_DIR")),I.params.push(O(Bn)),i(te,"OUTPUT_MATERIAL_BL")>0||i(te,"OUTPUT_WORLD_BL")>0?I.params.push(F(!0)):I.params.push(F(!1));break;case"BITMAP_MX":case"BITMAP_ENV_MX":case"REFLECT_REFRACT_MX":if(re=N.texture,t.nodeTextures[kr(se,le)]=re,I.params.push(D(se,le)),le++,se=="BITMAP_MX"){ce=N.uvIndex?"uv"+String(N.uvIndex+1):"uv",fe=q(ce,2),I.attributes.push({name:ce,type:"attribute vec2"}),I.params.push(fe),I.params.push(O("MAPPING_"+N.mapping)),I.params.push(O("AXIS_"+N.axis));const Z=oe("ivec2",[ne(N.clampToEdgeNoExtend[0]),ne(N.clampToEdgeNoExtend[1])]);I.params.push(O(Z))}else I.params.push(O(N.reflectMode)),I.params.push(w(N.IOR));I.params.push(O(y(re))),se!="BITMAP_MX"&&se!="BITMAP_ENV_MX"||(I.params.push(F(N.alphaAsMono)),I.params.push(F(N.alphaAsRGB)),I.outputs.push({name:se.toLowerCase()+"_out1_n"+Q,type:"float",clamp:!1,normalize:!1}));break;case"BLEND_MX":I.params.push(F(N.useCurve)),I.params.push(w(N.curveLower)),I.params.push(w(N.curveUpper));break;case"BUMP_MX":re=N.texture,t.nodeTextures[kr(se,le)]=re,I.params.push(D(se,le)),le++,I.params.push(O("-vViewPosition")),I.params.push(O("normal")),ce=N.uvIndex?"uv"+String(N.uvIndex+1):"uv",fe=q(ce,2),I.attributes.push({name:ce,type:"attribute vec2"}),I.params.push(fe);break;case"COLOR_CORRECTION_MX":const io=oe("ivec4",[N.rewireR,N.rewireG,N.rewireB,N.rewireA]);I.params.push(O(io)),N.gainPivotGammaLift&&(I.params.push(w(N.gainPivotGammaLift)),I.params.push(F(N.enableR)),I.params.push(F(N.enableG)),I.params.push(F(N.enableB)),I.params.push(z(N.exposureMode)),I.params.push(w(N.printerLights)));break;case"COMPOSITE_LAYER_MX":I.params.push(O(oe("int",N.blendMode)));const Mr=nn(te,Q,1)?N.opacity:0;I.params.push(w(Mr));break;case"COLOR_MAP_MX":I.params.push(F(N.reverseGamma));break;case"FALLOFF_MX":if(I.params.push(O("-vViewPosition")),N.falloffType!=4)I.params.push(w(N.IOR)),I.params.push(z(N.falloffType));else{const Z=N.extrapolateOn!==void 0&&N.extrapolateOn,Te=N.nearDistance===void 0?0:N.nearDistance,Le=N.farDistance===void 0?100:N.farDistance;I.params.push(F(Z)),I.params.push(w(Te)),I.params.push(w(Le))}break;case"MASK_MX":I.params.push(F(N.maskInverted));break;case"MATERIAL_MX":I.params.push(w(N.inputFactors[Ae[se].reflection])),I.params.push(w(N.inputFactors[Ae[se].refraction])),N.inputFactors[Ae[se].reflection]=1,N.inputFactors[Ae[se].refraction]=1,I.params.push(F(N.selfIllumColorOn));break;case"MATTE_SHADOW_MX":I.params.push(O("normal")),I.params.push(F(N.receiveShadows)),I.params.push(w(N.shadowBrightness)),I.params.push(w(N.color));break;case"NOISE_MX":N.coordType==2?(ce=N.uvIndex?"uv"+String(N.uvIndex+1):"uv",fe=q(ce,2),I.attributes.push({name:ce,type:"attribute vec2"}),I.params.push(fe)):I.params.push(O("vViewPosition")),I.params.push(z(N.noiseType)),I.params.push(z(N.coordType));break;case"NORMAL_BUMP_MX":ce="tangent",fe=q(ce,4),I.attributes.push({name:ce,type:"attribute vec4"}),I.params.push(fe),I.params.push(O("normal"));const Xn="ivec2("+ne(N.flip[0])+","+ne(N.flip[1])+")";I.params.push(O(Xn));break;case"OPENPBR_SURFACE_MX":case"OPENPBR_SURFACE_MY":I.params.push(O("geometryNormal")),I.params.push(F(N.thinWalled)),(N.inputs[Ae[se].coatWeight]>0||nn(te,Q,Ae[se].coatWeight))&&(t.defines.USE_CLEARCOAT=""),(N.inputs[Ae[se].fuzzWeight]>0||nn(te,Q,Ae[se].fuzzWeight))&&(t.defines.USE_SHEEN="");break;case"OUTPUT_MAP_MX":if(I.params.push(F(N.invert)),I.params.push(F(N.clamp)),I.params.push(F(N.alphaFromRGB)),N.colorMap){t.useFloatTex?(Ie=N.colorMap,ve=new Float32Array(1024),xe=1):(Ie=h5(N.colorMap.slice(),0,1),ve=new Uint8Array(1024),xe=255),Ce=Ie.length/256;for(let Z=0;Z<256;Z++)ve[4*Z]=xe*Ie[Ce*Z],Ce==3?(ve[4*Z+1]=xe*Ie[Ce*Z+1],ve[4*Z+2]=xe*Ie[Ce*Z+2]):(ve[4*Z+1]=ve[4*Z],ve[4*Z+2]=ve[4*Z]),ve[4*Z+3]=xe;re=b(ve,256,1023,t.useFloatTex?1015:1009),me=kr(se,V),t.nodeTextures[me]=re,I.params.push(D(se,V)),V++}break;case"PHYSICAL_MX":I.params.push(O("geometryNormal")),I.params.push(w(N.emitLuminance));const gn=N.brdfMode===void 0||N.brdfMode,Wa=N.brdfLow===void 0?0:N.brdfLow,ga=N.brdfHigh===void 0?0:N.brdfHigh,xl=N.brdfCurve===void 0?0:N.brdfCurve;I.params.push(F(!gn)),I.params.push(O(oe("float",Wa))),I.params.push(O(oe("float",ga))),I.params.push(O(oe("float",xl))),I.params.push(F(_e(N.roughnessInv)&&N.roughnessInv)),I.params.push(F(_e(N.transRoughnessLock)&&N.transRoughnessLock)),I.params.push(F(_e(N.transRoughnessInv)&&N.transRoughnessInv)),I.params.push(F(_e(N.thinWalled)&&N.thinWalled)),(N.inputs[Ae[se].clearcoat]>0||nn(te,Q,Ae[se].clearcoat))&&(t.defines.USE_CLEARCOAT="");break;case"PHY_SUN_SKY_ENV_MX":const So=15*N.haze+2,Co=new _i;be=Math.PI/2-N.sunPolarAngle;const Si=Math.PI-N.sunAzimuthAngle;Co.phi=be,Co.theta=Si;const Ci=new B().setFromSpherical(Co).toArray();Pe=Oo.getDistParams(So,0),Ge=Oo.getDistParams(So,1),tt=Oo.getDistParams(So,2),ot=Oo.getZenithParams(So,be,0),Pt=Oo.getZenithParams(So,be,1),$t=Oo.getZenithParams(So,be,2),ot/=.06,ot*=1e3,I.params.push(w([Pe[0],Ge[0],tt[0]])),I.params.push(w([Pe[1],Ge[1],tt[1]])),I.params.push(w([Pe[2],Ge[2],tt[2]])),I.params.push(w([Pe[3],Ge[3],tt[3]])),I.params.push(w([Pe[4],Ge[4],tt[4]])),I.params.push(w([ot,Pt,$t]));const yl=Oo.getSunIlluminance(Ci,So),bl=[0,0,0];I.params.push(w(Ci)),I.params.push(w(yl)),I.params.push(w(bl)),I.params.push(w(N.globalIntensity/ite)),I.params.push(w(N.groundColor));break;case"REFLECT_REFRACT_COLOR_MX":pe=N.outputs[0],I.params.push(w(pe));break;case"VERTEX_COLOR_MX":ce="color",fe=q(ce,3),I.attributes.push({name:ce,type:"attribute vec3"}),I.params.push(fe);break;case"BUMP_2D_MY":I.params.push(O("vNormal")),N.bumpInterp>0&&(ce="tangent",fe=q(ce,4),I.attributes.push({name:ce,type:"attribute vec4"}),I.params.push(fe));break;case"COLOR_COMPOSITE_MY":case"COLOR_LOGIC_MY":case"COLOR_MATH_MY":case"CONDITION_MY":case"FLOAT_COMPOSITE_MY":case"FLOAT_LOGIC_MY":case"FLOAT_MATH_MY":case"MULTIPLY_DIVIDE_MY":I.params.push(O(N.operation));break;case"COLOR_CORRECT_MY":I.params.push(F(N.colClamp)),I.params.push(w(N.colClampMin)),I.params.push(w(N.colClampMax)),I.params.push(F(N.alphaClamp)),I.params.push(w(N.alphaClampMin)),I.params.push(w(N.alphaClampMax)),I.params.push(F(N.unpremultiplyInput)),I.params.push(F(N.premultiplyResult));break;case"COLOR_MASK_MY":I.params.push(F(N.maskAlphaIsLuminance));break;case"COMPOSE_MATRIX_MY":I.params.push(F(N.useEulerRotation)),I.params.push(O(N.inputRotateOrder));break;case"FILE_MY":case"ENV_SPHERE_MY":if(re=N.texture,t.nodeTextures[kr(se,le)]=re,I.params.push(D(se,le)),le++,I.params.push(O(y(re))),se=="ENV_SPHERE_MY")I.params.push(O("normal"));else{const Z=N.fileHasAlpha===!1;I.params.push(F(Z&&Bu(te,Q,st.FILE_MY.alpha)))}break;case"RAMP_MY":t.useFloatTex?(ve=new Float32Array(2048),xe=1):(ve=new Uint8Array(2048),xe=255);for(let Z=0;Z<512;Z++){const Te=xe*N.rampData[3*Z],Le=xe*N.rampData[3*Z+1],Ue=xe*N.rampData[3*Z+2];ve[4*Z]=Ft(Te,0,xe),ve[4*Z+1]=Ft(Le,0,xe),ve[4*Z+2]=Ft(Ue,0,xe),ve[4*Z+3]=xe}re=b(ve,512,1023,t.useFloatTex?1015:1009),me=kr(se,V),t.nodeTextures[me]=re,I.params.push(D(se,V)),V++,I.params.push(O(oe("int",N.rampType))),I.params.push(O(oe("int",N.wrapS))),I.params.push(O(oe("int",N.wrapT))),t.defines.RAMP_TEX_SIZE=512,t.definesFragOnly.add("RAMP_TEX_SIZE");break;case"SAMPLER_INFO_MY":I.params.push(O("faceDirection")),ce="tangent",fe=q(ce,4),I.attributes.push({name:ce,type:"attribute vec4"}),I.params.push(fe),ce="uv",fe=q(ce,2),I.attributes.push({name:ce,type:"attribute vec2"}),I.params.push(fe);break;case"UNIT_CONVERSION_MY":I.params.push(w(N.conversionFactor));break;case"VECTOR_PRODUCT_MY":I.params.push(O(N.operation)),I.params.push(F(N.normalizeOutput));break;case"OSL_NODE":_e(N.texture)&&(re=N.texture,t.nodeTextures[kr(se,le)]=re,I.params.push(D(se,le)),le++);const Eo=N.globalVariables||[];Eo.indexOf("P")>-1&&I.params.push(O("oslGetP(vViewPosition)")),Eo.indexOf("I")>-1&&I.params.push(O("oslGetI(vViewPosition)")),Eo.indexOf("N")>-1&&I.params.push(O("oslGetN(normal)")),(Eo.indexOf("u")>-1||Eo.indexOf("v")>-1)&&(ce="uv",I.attributes.push({name:ce,type:"attribute vec2"}),Eo.indexOf("u")>-1&&I.params.push(q(ce+"_u",1,ce+".x")),Eo.indexOf("v")>-1&&I.params.push(q(ce+"_v",1,"1.0 - "+ce+".y")));break;case"RGB_ALPHA":pe=new ct().fromArray(N.outputs[0].concat([N.outputs[1]])),t.nodeRGB.push(pe),t.nodeRGBMap[N.name]=G,I.params.push(O("nodeRGB["+G+"]")),G++;break;case"U_FLOAT":ce="uv",fe=q(ce,2),I.attributes.push({name:ce,type:"attribute vec2"}),I.params.push(fe)}}var W;const Y={},P={};for(let Q=0;Q<te.len();Q++){const I=te.node(Q),N=I.originData,se=N.type;for(let ce=0;ce<N.inputs.length;ce++){const fe=N.inputs[ce],ve=N.inputTypes?N.inputTypes[ce]:$(fe),xe=[],Ie=[];T(te,Q,ce,fe,xe,Ie);const re=f(se,ce);if(xe.length){let me,pe;if(me=I.inputFactors.length?I.inputFactors[ce]:1,pe=re?"normal":oe(ve,fe),Ie.length){const Ce=xe.map(function(we){return we.name});I.inputs.push({code:R(Ce,Ie,xe[0].type,ve,pe)})}else xe.length==1||console.error(`MeshNodeMaterial: wrong ${se} node connections`),I.inputs.push({code:M(xe[0].name,xe[0].type,ve,pe,me)})}else if(re)I.inputs.push({code:"normal"});else if(typeof fe=="string")I.inputs.push({code:fe});else{Y[ve]=Y[ve]||[],Array.isArray(fe)?Y[ve].push(...fe):Y[ve].push(fe),ve in P||(P[ve]=0);let me=P[ve];I.inputs.push({code:`nodeInputs${ug(ve)}[${me}]`}),P[ve]++}}}t.nodeInputs={};for(const Q in Y)t.nodeInputs[Q]=Q=="int"||Q=="bool"?new Int32Array(Y[Q]):new Float32Array(Y[Q])}(de),function(te){const le=[],V=[],G=[],ee=[],X=new Yg(te).order();t.defines.NODE_RGB_NUM=t.nodeRGB.length,t.defines.NODE_VALUE_NUM=t.nodeValue.length,t.defines.NODE_TEX_COORD_NUM=t.nodeTexCoordObject.length,t.definesFragOnly.add("NODE_RGB_NUM"),t.definesFragOnly.add("NODE_VALUE_NUM"),t.definesFragOnly.add("NODE_TEX_COORD_NUM");for(let W=0;W<X.length;W++){const Y=te.node(X[W]),P=Y.originData.type;let Q,I;if(t.defines["NODE_"+P]="",P!="REFLECT_REFRACT_MX"&&P!="BITMAP_ENV_MX"&&P!="BUMP_BL"&&P!="PHY_SUN_SKY_ENV_MX"&&P!="ENV_SPHERE_MY"&&P!="UV_PROJECTION_AR"&&P!="TRIPLANAR_AR"&&P!="TRIPLANAR_UV_AR"&&P!="SUB_TRANSFORM_MX"&&P!="SUB_TRANSFORM_MY"&&t.definesFragOnly.add("NODE_"+P),P=="OSL_NODE"&&(t.defines.USE_OSL=""),P!="OSL_NODE"){const N="node_"+P.toLowerCase()+"_vert";Q=Ye[N]}else Q=Y.originData.vertCode;if(Q&&le.indexOf(Q)<0&&le.push(Q),P!="OSL_NODE"){const N="node_"+P.toLowerCase()+"_frag";I=Ye[N]}else I=Y.originData.fragCode;I&&G.indexOf(I)<0&&G.push(I);for(let N=0;N<Y.attributes.length;N++){const se=Y.attributes[N],ce=se.type+" "+se.name+";";se.name!="uv"&&le.indexOf(ce)<0&&le.push(ce)}for(let N=0;N<Y.params.length;N++){const se=Y.params[N];if(_(se)){const ce=se.type+" "+se.name+";";G.indexOf(ce)<0&&G.push(ce)}else if(x(se)){const ce=se.type+" "+se.name+";";le.indexOf(ce)<0&&le.push(ce);const fe=se.type+" "+se.name+";";G.indexOf(fe)<0&&G.push(fe)}}}for(const W in t.nodeInputs){const Y=t.nodeInputs[W].length/K(W);G.push(`uniform ${W} nodeInputs${ug(W)}[${Y}];`)}_e(t.defines.USE_OSL)&&G.unshift("#include <node_osl_frag>");for(let W=0;W<X.length;W++){const Y=te.node(X[W]),P=Y.originData.type;if(P=="CHECKERBOARD_AR"||P=="IMAGE_AR"||P=="TWO_SIDED_AR"||P=="USER_DATA_COLOR_AR"||P=="ATTRIBUTE_BL"||P=="NEW_GEOMETRY_BL"||P=="NORMAL_MAP_BL"||P=="TANGENT_BL"||P=="TEX_COORD_BL"||P=="UVMAP_BL"||P=="VERTEX_COLOR_BL"||P=="BITMAP_MX"||P=="NOISE_MX"||P=="NORMAL_BUMP_MX"||P=="BUMP_MX"||P=="VERTEX_COLOR_MX"||P=="GRADIENT_MX"||P=="GRADIENT_RAMP_MX"||P=="BUMP_2D_MY"||P=="PLACE_2D_TEXTURE_MY"||P=="SAMPLER_INFO_MY"||P=="OSL_NODE"||P=="U_FLOAT")for(let N=0;N<Y.params.length;N++){const se=Y.params[N];if(x(se)){const ce=se.name+"="+se.attrBindName+";";V.includes(ce)||(V.push(ce),se.name.includes("Tangent")&&V.push(["#ifdef USE_SKINNING",`    ${se.name}.xyz = vec4(skinMatrix * vec4(${se.name}.xyz, 0.0)).xyz;`,"#endif"].join(`
`)))}}for(let N=0;N<Y.outputs.length;N++){const se=Y.outputs[N];se.type&&ee.push(se.type+" "+se.name+";")}const Q=[];for(let N=0;N<Y.params.length;N++){const se=Y.params[N];!se.type||_(se)||x(se)?Q.push(se.name):Q.push(oe(se.type,se.value))}for(let N=0;N<Y.inputs.length;N++){const se=Y.inputs[N];Q.push(se.code)}for(let N=0;N<Y.outputs.length;N++){const se=Y.outputs[N];Q.push(se.name)}let I;switch(I=P!="OSL_NODE"?"node_"+T2(P).toLowerCase():Y.originData.shaderName,P){case"MATH_BL":case"VECT_MATH_BL":I+="_"+Y.originData.operation.toLowerCase();break;case"VECTOR_ROTATE_BL":I+="_"+Y.originData.rotationType.toLowerCase();break;case"MIX_BL":I+="_"+Y.originData.dataType.toLowerCase(),Y.originData.dataType=="RGBA"?I+="_"+Y.originData.blendType.toLowerCase():Y.originData.dataType=="VECTOR"&&(I+="_"+Y.originData.factorMode.toLowerCase());break;case"MIX_RGB_BL":I+="_"+Y.originData.blendType.toLowerCase();break;case"TEX_WHITE_NOISE_BL":I+="_"+Y.originData.noise_dimension.toLowerCase()}ee.push(I+"("+Q.join(",")+");");for(let N=0;N<Y.outputs.length;N++){const se=Y.outputs[N],ce=se.name;if(se.clamp){const fe=se.type;ee.push(ce+"=clamp("+ce+","+fe+"(0.0),"+fe+"(1.0));")}se.normalize&&ee.push(ce+"=normalize("+ce+");")}}t.nodeChunks.node_pars_vertex=le.join(`
`),t.nodeChunks.node_vertex=V.join(`
`),t.nodeChunks.node_pars_fragment=G.join(`
`),t.nodeChunks.node_fragment=ee.join(`
`),t.nodeChunksHash=vd(JSON.stringify(t.nodeChunks))}(de),L)if(this.nodeValue.length==U.length&&this.nodeRGB.length==k.length&&this.nodeTexCoordObject.length==J.length){for(let te=0;te<this.nodeValue.length;te++)this.nodeValue[te]=U[te];for(let te=0;te<this.nodeRGB.length;te++)this.nodeRGB[te]=k[te];for(let te=0;te<this.nodeTexCoordObject.length;te++)this.nodeTexCoordObject[te]=J[te]}else console.error("v3d.MeshNodeMaterial: Unable to preserve node variables");this.needsUpdate=!0},function(L){for(let U=0;U<L.len();U++){const k=L.node(U),J=k.originData.type;if(J!="GROUP_BL")if(J!="REROUTE_BL"){if(J=="OSL_OUTPUT_SELECTOR_MX"){const de=L.findInEdges(U),te=L.findOutEdges(U),le=de[0],V=le.connections[0];for(let G=0;G<te.length;G++){const ee=te[G],X=new ko(le.from(),ee.to());X.connections=[];for(let W=0;W<ee.connections.length;W++){const Y=ee.connections[W],P={from:V.from,to:Y.to};X.connections.push(P)}L.addEdge(X)}L.disconnect(U,!0),U=-1}}else{L.findInEdges(U).length<1&&n(L,U);const de=L.findInEdges(U),te=L.findOutEdges(U),le=de[0],V=le.connections[0];for(let G=0;G<te.length;G++){const ee=te[G];let X=L.edge(le.from(),ee.to());X||(X=new ko(le.from(),ee.to()),X.connections=[],L.addEdge(X));for(let W=0;W<ee.connections.length;W++){const Y=ee.connections[W],P={from:V.from,to:Y.to};X.connections.push(P)}}L.disconnect(U,!0),U=-1}else{const de=k.originData.nodeGraph,te=t.additionalNodeGraphs[de];if(n(L,U),te.len()<=2){const G=L.findInEdges(U),ee=L.findOutEdges(U),X=Math.min(G.length,ee.length);for(let W=0;W<X;W++){const Y=G[W],P=ee[W],Q=new ko(Y.from(),P.to());Q.connections=[];const I=Math.min(Y.connections.length,P.connections.length);for(let N=0;N<I;N++){const se=Y.connections[N],ce=P.connections[N],fe={from:se.from,to:ce.to};Q.connections.push(fe)}L.addEdge(Q)}L.disconnect(U,!0),U=-1;continue}const le=a(L,te,U);L.insert(te,le.inputs,le.outputs);const V=le.removedNodes.sort(function(G,ee){return ee-G});for(let G=0;G<V.length;G++)L.disconnect(V[G],!0);U=-1}}}(t.nodeGraph),function(L){for(let k=0;k<L.len();k++){const J=L.node(k),de=J.originData,te=de.type;if(te=="TEX_IMAGE_BL"&&!nn(L,k,0)){const V={originData:{name:"UVMapGenerated",type:"UVMAP_BL",uvLayer:"",inputs:[],outputs:[[0,0,0]]}};L.addNode(V),Ke(L,L.len()-1,0,k,0)}if((te=="TEX_BRICK_BL"||te=="TEX_CHECKER_BL"||te=="TEX_GABOR_BL"||te=="TEX_GRADIENT_BL"||te=="TEX_NOISE_BL"||te=="TEX_WAVE_BL"||te=="TEX_VORONOI_BL"||te=="TEX_SKY_BL")&&!nn(L,k,0)){const V={originData:{name:"TexCoordGenerated",type:"TEX_COORD_BL",inputs:[],outputs:[[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0]]}};L.addNode(V),Ke(L,L.len()-1,0,k,0)}if(te=="TEX_ENVIRONMENT_BL"&&!nn(L,k,0)){const V={originData:{name:"TexCoordObject",type:"TEX_COORD_BL",inputs:[],outputs:[[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0]]}};L.addNode(V),Ke(L,L.len()-1,3,k,0)}const le=QA(J);if(le=="STANDARD_SURFACE_AR"&&de.inputs.length==25&&(console.warn("v3d.MeshNodeMaterial: adding missing params to standard surface node, please reexport your scene"),de.inputs.push([0,0,0])),le in HA&&!nn(L,k,HA[le])){const V={originData:{name:"Normal",type:"NORMAL",inputs:[],outputs:[[0,0,0]]}};L.addNode(V),Ke(L,L.len()-1,st.NORMAL.normal,k,HA[le])}if(["BSDF_PRINCIPLED_BL","BSDF_PRINCIPLED_BF43_BL","BSDF_PRINCIPLED_BF40_BL","EEVEE_SPECULAR_BL"].includes(le)&&!nn(L,k,Ae[le].clearcoatNormal)&&(de.inputs[Ae[le].clearcoat]>0||nn(L,k,Ae[le].clearcoat))){const V={originData:{name:"CoatNormal",type:"NORMAL",inputs:[],outputs:[[0,0,0]]}};L.addNode(V),Ke(L,L.len()-1,st.NORMAL.normal,k,Ae[le].clearcoatNormal)}if(le!="EEVEE_SPECULAR_BL"||nn(L,k,Ae.EEVEE_SPECULAR_BL.ambientOcclusion)||(de.inputs[Ae.EEVEE_SPECULAR_BL.ambientOcclusion]=1),le=="OSL_NODE"){const V=de.initializers;for(let G=0;G<V.length;G++){const ee=V[G];if(ee&&!nn(L,k,G)){const X={originData:{name:le+"init"+G,type:"OSL_NODE",shaderName:de.shaderName+"_init_"+G,inputs:[],outputs:[de.inputs[0]],fragCode:ee[0],globalVariables:ee[1],initializers:[]}};L.addNode(X),Ke(L,L.len()-1,0,k,G)}}}if(!(le!="NORMAL_MAP_AR"||nn(L,k,Ae.NORMAL_MAP_AR.normal)&&nn(L,k,Ae.NORMAL_MAP_AR.tangent))){const V={originData:{name:"SamplerInfo",type:"SAMPLER_INFO_MY",inputs:[[0,0,0]],outputs:[0,!1,[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0],[0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0]]}};L.addNode(V),nn(L,k,Ae.NORMAL_MAP_AR.normal)||Ke(L,L.len()-1,st.SAMPLER_INFO_MY.normalCamera,k,Ae.NORMAL_MAP_AR.normal),nn(L,k,Ae.NORMAL_MAP_AR.tangent)||Ke(L,L.len()-1,st.SAMPLER_INFO_MY.tangentUCamera,k,Ae.NORMAL_MAP_AR.tangent)}if(le=="IMAGE_AR"&&!nn(L,k,Ae.IMAGE_AR.uvcoords)){const V={originData:{name:"place2dTexture",type:"PLACE_2D_TEXTURE_MY",inputs:[[0,0],[1,1],0],outputs:[[0,0]],uvIndex:0}};L.addNode(V),Ke(L,L.len()-1,st.PLACE_2D_TEXTURE_MY.uv,k,Ae.IMAGE_AR.uvcoords)}if(le=="FILE_MY"&&!nn(L,k,Ae.FILE_MY.uvCoord)){const V={originData:{name:"place2dTexture",type:"PLACE_2D_TEXTURE_MY",inputs:[[0,0],[1,1],0],outputs:[[0,0]],uvIndex:0}};L.addNode(V),Ke(L,L.len()-1,st.PLACE_2D_TEXTURE_MY.uv,k,Ae.FILE_MY.uvCoord)}if(le=="RAMP_MY"&&!nn(L,k,Ae.RAMP_MY.uvCoord)){const V={originData:{name:"place2dTexture",type:"PLACE_2D_TEXTURE_MY",inputs:[[0,0],[1,1],0],outputs:[[0,0]],uvIndex:0}};L.addNode(V),Ke(L,L.len()-1,st.PLACE_2D_TEXTURE_MY.uv,k,Ae.RAMP_MY.uvCoord)}if(_e(de.output)&&g(L,k,de),u(te)){if(!_e(de.inputFactors)){de.inputFactors=[];for(let V=0;V<de.inputs.length;V++)de.inputFactors.push(1)}de.inputs.push([0,0,0]),de.inputFactors.push(0)}if(le=="STANDARD_SURFACE_AR"&&!nn(L,k,Ae[le].clearcoatNormal)&&(de.inputs[Ae[le].clearcoat]>0||nn(L,k,Ae[le].clearcoat))){const V={originData:{name:"CoatNormal",type:"NORMAL",inputs:[],outputs:[[0,0,0]]}};L.addNode(V),Ke(L,L.len()-1,0,k,Ae[le].clearcoatNormal)}if(le=="MIX_BL"&&de.outputs.length>1){const V=[-1,-1,-1,-1,-1,-1,-1,-1],G=[-1,-1,-1];switch(de.dataType){case"RGBA":de.inputs=[de.inputs[0],de.inputs[6],de.inputs[7]],V[0]=0,V[6]=1,V[7]=2,de.outputs=[de.outputs[2]],G[2]=0;break;case"VECTOR":de.inputs=[de.inputs[0],de.inputs[1],de.inputs[4],de.inputs[5]],V[0]=0,V[1]=1,V[4]=2,V[5]=3,de.outputs=[de.outputs[1]],G[1]=0;break;case"FLOAT":de.inputs=[de.inputs[0],de.inputs[2],de.inputs[3]],V[0]=0,V[2]=1,V[3]=2,de.outputs=[de.outputs[0]],G[0]=0}const ee=L.findInEdges(k);for(let W=0;W<ee.length;W++){const Y=ee[W];for(let P=Y.connections.length-1;P>=0;P--){const Q=Y.connections[P];V[Q.to]>-1?Q.to=V[Q.to]:Y.connections.splice(P,1)}}const X=L.findOutEdges(k);for(let W=0;W<X.length;W++){const Y=X[W];for(let P=Y.connections.length-1;P>=0;P--){const Q=Y.connections[P];G[Q.from]>-1?Q.from=G[Q.from]:Y.connections.splice(P,1)}}}if(te=="BUMP_2D_MY"&&de.bumpInterp>0){de.inputs[Ae.BUMP_2D_MY.bumpValue]=[0,0,0];const V=L.findInEdges(k);for(let G=0;G<V.length;G++){const ee=V[G],X=L.node(ee.from()).originData;for(let W=0;W<ee.connections.length;W++){const Y=ee.connections[W];Y.to==Ae.BUMP_2D_MY.bumpValue&&X.type=="FILE_MY"?Y.from=st.FILE_MY.color:Y.to==Ae.BUMP_2D_MY.bumpValue&&X.type=="IMAGE_AR"&&(Y.from=st.IMAGE_AR.color)}}}if(te!="COLOR_CONSTANT_MY"||nn(L,k,0)||nn(L,k,1)||(de.type="RGB_ALPHA",de.inputs=[]),te!="FLOAT_CONSTANT_MY"||nn(L,k,0)||(de.type="VALUE",de.inputs=[]),te=="TRIPLANAR_AR"){const V=function(){const ee=["scale","rotate","offset"],X=ee.map(Q=>ote(L,k,Ae.TRIPLANAR_AR[Q])),W=de.coordSystem==="Y_UP_RIGHT"?"SUB_TRANSFORM_MY":"SUB_TRANSFORM_MX",Y={originData:{name:"subTransform",type:W,inputs:ee.map(Q=>de.inputs[Ae.TRIPLANAR_AR[Q]]),outputs:[[0,0,0],[0,0,0]],coordSpace:de.coordSpace}};L.addNode(Y);const P=L.len()-1;return X.forEach((Q,I)=>{Q.forEach(N=>{const se=N.nodeIdx,ce=N.outputIdx,fe=N.channelMatrix;Ke(L,se,ce,P,Ae[W][ee[I]],fe)})}),Q=>{const I=L.node(Q);I.originData.type=="TRIPLANAR_AR"?Ke(L,P,st[W].normal,Q,Ae.TRIPLANAR_AR.normal):I.originData.type=="TRIPLANAR_UV_AR"&&(Ke(L,P,st[W].vector,Q,Ae.TRIPLANAR_UV_AR.vector),Ke(L,P,st[W].normal,Q,Ae.TRIPLANAR_UV_AR.normal))}}();de.inputs.push([0,0,0]),V(k);const G=ee=>{const X={originData:{name:"triplanarUV",type:"TRIPLANAR_UV_AR",inputs:[[0,0,0],[0,0,0]],outputs:ee==4?[[0,0],[0,0],[0,0]]:[[0,0]],flipOnOppositeDirection:de.flipOnOppositeDirection}};ee==4?X.originData.blendFactor=de.blendFactor:X.originData.projectionAxis=ee,L.addNode(X);const W=L.len()-1;return V(W),W};if(de.inputPerAxis){const ee=[Ae.TRIPLANAR_AR.inputColor,Ae.TRIPLANAR_AR.inputColorY,Ae.TRIPLANAR_AR.inputColorZ];for(let X=0;X<3;X++){const W=ee[X],Y=pt(L,k,W,"IMAGE_AR");if(!Y){pt(L,k,W)&&console.error("MeshNodeMaterial: TRIPLANAR_AR texture inputs accept only IMAGE_AR or color.");continue}const P=L.nodeIndex(Y);Pu(L,P,Ae.IMAGE_AR.uvcoords);const Q=G(X);Ke(L,Q,st.TRIPLANAR_UV_AR.uv,P,Ae.IMAGE_AR.uvcoords)}}else{const ee=pt(L,k,Ae.TRIPLANAR_AR.inputColor,"IMAGE_AR");if(!ee){pt(L,k,Ae.TRIPLANAR_AR.inputColor)&&console.error("MeshNodeMaterial: TRIPLANAR_AR texture inputs accept only IMAGE_AR or color.");continue}const X=L.nodeIndex(ee);if(Pu(L,X,Ae.IMAGE_AR.uvcoords),Pu(L,k,Ae.TRIPLANAR_AR.inputColorY),Pu(L,k,Ae.TRIPLANAR_AR.inputColorZ),de.blendFactor<.001){const W=G(3);Ke(L,W,st.TRIPLANAR_UV_AR.uv,X,Ae.IMAGE_AR.uvcoords)}else{const W=G(4);Ke(L,W,st.TRIPLANAR_UV_AR.uv,X,Ae.IMAGE_AR.uvcoords),ee.originData.inputs.push([0,0],[0,0]),Ke(L,W,st.TRIPLANAR_UV_AR.duvdx,X,Ae.IMAGE_AR.duvdx),Ke(L,W,st.TRIPLANAR_UV_AR.duvdy,X,Ae.IMAGE_AR.duvdy)}}}if(te=="UV_PROJECTION_AR"){const V=ate(L,k,st.UV_PROJECTION_AR.uv),G=Pu(L,k,Ae.UV_PROJECTION_AR.projectionColor,"IMAGE_AR");if(!G){console.error("MeshNodeMaterial: UV_PROJECTION_AR.projectionColor input accepts only IMAGE_AR.");continue}const ee=G.node;if(V){const X=L.nodeIndex(ee);Ke(L,X,G.outputIdx,L.nodeIndex(V.node),V.inputIdx),Pu(L,X,Ae.IMAGE_AR.uvcoords),Ke(L,k,st.UV_PROJECTION_AR.uv,X,Ae.IMAGE_AR.uvcoords)}}}let U=0;for(let k=0;k<L.len();k++){const J=L.node(k).originData,de=J.type;de!="MATERIAL_MX"&&de!="PHYSICAL_MX"&&de!="OPENPBR_SURFACE_MX"||(c(L,k,J),de=="MATERIAL_MX"&&(U=J.IOR))}for(let k=0;k<L.len();k++){const J=L.node(k).originData,de=J.type;h(de)&&(J.IOR=U),h(de)&&!_e(J.reflectMode)&&(J.reflectMode="MAX_ENV_COORDS_REFLECT")}for(let k=0;k<L.len();k++){const J=L.node(k).originData;J.type=="COMPOSITE_MX"&&(m(L,k,J),L.disconnect(k,!0))}for(let k=0;k<L.len();k++){const J=L.node(k).originData;J.type=="LAYERED_TEXTURE_MY"&&(A(L,k,J),L.disconnect(k,!0))}if(t.hasNode("SKYDOME_LIGHT_AR"))for(let k=0;k<L.len();k++){const J=L.node(k).originData;if(J.type=="FILE_MY"||J.type=="IMAGE_AR"){const de={originData:{name:"envSphere",type:"ENV_SPHERE_MY",inputs:[[-1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]],outputs:[0,[0,0,0]],texture:J.texture}};L.addNode(de);const te=L.findOutEdges(k);for(let le=0;le<te.length;le++){const V=te[le];for(let G=0;G<V.connections.length;G++){const ee=V.connections[G];ee.from<2&&Ke(L,L.len()-1,ee.from,V.to(),ee.to)}}L.disconnect(k,!0),k=-1}}for(let k=0;k<L.len();k++){const J=L.node(k).originData;if(J.type=="ENV_SPHERE_MY"&&J.inputs.length==2){const de=L.findInEdges(k);for(let te=0;te<de.length;te++){const le=de[te],V=L.node(le.from()).originData;V.type!="FILE_MY"&&V.type!="IMAGE_AR"||(J.inputs.splice(0,1),J.texture=V.texture,L.removeEdge(le.from(),le.to()))}}}for(let k=0;k<L.len();k++){const J=L.node(k).originData;switch(J.type){case"BSDF_DIFFUSE_BL":case"BSDF_GLOSSY_BL":case"BSDF_TRANSLUCENT_BL":case"DIFFUSE_BSDF_BL":r(L,k,J,Ae[J.type].color,"Color");break;case"BSDF_METALLIC_BL":r(L,k,J,Ae[J.type].baseColor,"Base Color");break;case"BSDF_PRINCIPLED_BL":r(L,k,J,Ae.BSDF_PRINCIPLED_BL.baseColor,"Color");break;case"MATERIAL_MX":r(L,k,J,Ae.MATERIAL_MX.ambientColor,"Ambient Color")&&(J.inputFactors[0]=1),r(L,k,J,Ae.MATERIAL_MX.diffuseColor,"Diffuse Color")&&(J.inputFactors[1]=1);break;case"PHYSICAL_MX":r(L,k,J,Ae.PHYSICAL_MX.baseColor,"Base Color")&&(J.inputFactors[1]=1);break;case"OPENPBR_SURFACE_MX":r(L,k,J,Ae.OPENPBR_SURFACE_MY.baseColor,"Base Color")&&(J.inputFactors[1]=1);break;case"OPENPBR_SURFACE_MY":r(L,k,J,Ae.OPENPBR_SURFACE_MY.baseColor,"Base Color");break;case"STANDARD_SURFACE_AR":r(L,k,J,Ae.STANDARD_SURFACE_AR.baseColor,"Base Color")}}}(t.nodeGraph),mw(t.nodeGraph),this.updateNodeGraph()}static nodeGraphFromExtGraph(e){let t=e.nodes,n=e.edges;const r=t.slice().sort(function(s,c){return s.name.localeCompare(c.name)}),a=[];for(let s=0;s<n.length;s++){const c=n[s],u=Object.assign({},c);u.fromNode=r.indexOf(t[c.fromNode]),u.toNode=r.indexOf(t[c.toNode]),a.push(u)}t=r,n=a;const i=new bn(t.length);for(let s=0;s<t.length;s++)t[s],eB({originData:t[s]},i.node(s));for(let s=0;s<n.length;s++){const c=n[s];i.edge(c.fromNode,c.toNode)||i.addNewEdge(c.fromNode,c.toNode);const u=i.edge(c.fromNode,c.toNode);if(u.connections=u.connections||[],_e(c.fromChannel)||_e(c.toChannel)){let h=null;for(let g=0;g<u.connections.length;g++){const A=u.connections[g];if(A.from==c.fromOutput&&A.to==c.toInput&&A.channelMatrix){h=A.channelMatrix;break}}if(!h){h=[[0,0,0],[0,0,0],[0,0,0]];const g={from:c.fromOutput,to:c.toInput,channelMatrix:h};u.connections.push(g)}const f=c.fromChannel||0,m=c.toChannel||0;h[f][m]=1}else{const h={from:c.fromOutput,to:c.toInput};u.connections.push(h)}}return mw(i),i}static nodeGraphTraverse(e,t){for(let n=0;n<e.len();n++)t(e.node(n))}hasNode(e){for(let t=0;t<this.nodeGraph.len();t++)if(this.nodeGraph.node(t).originData.type==e)return!0;return!1}traverseNodes(e){for(let t=0;t<this.nodeGraph.len();t++)e(this.nodeGraph.node(t))}findNodeByName(e){for(let t=0;t<this.nodeGraph.len();t++){const n=this.nodeGraph.node(t);if(n.originData.name===e)return n}return null}get color(){return this.getStandardProp("color")}set color(e){}get opacity(){return this.getStandardProp("opacity")}set opacity(e){}connectTexture(e,t,n){let r,a,i;switch(this.profile){case"blender":r="TEX_IMAGE_BL",a="UVMAP_BL",i="vector";break;case"max":r="BITMAP_MX";break;case"maya":r="FILE_MY",a="PLACE_2D_TEXTURE_MY",i="uvCoord";break;default:return void console.error("v3d.connectTexture: Invalid material profile:",this.profile)}const s=Et(r,e.name||"Texture",{texture:e}),c=kr(r,Object.keys(this.nodeTextures).length);this.nodeTextures[c]=e;const u=this.nodeGraph;if(u){let h=hw(u,t);const f=Ae[sa(u.node(h))][n],m=pt(u,h,f);m&&(u.disconnect(u.nodeIndex(m),!0),h=hw(u,t)),u.addNode(s),Ke(u,u.len()-1,st[r].color,h,f),a&&(u.addNode(Et(a,s.name+"UV")),Ke(u,u.len()-1,st[a].uv,u.len()-2,Ae[r][i]))}else console.error("v3d.connectTexture: Unable to connect texture to empty graph")}needsLightPathDir(){return!!(this.hasNode("LIGHT_PATH_BL")||this.hasNode("RAY_SWITCH_AR")||"USE_OSL"in this.defines)}canUseGTAO(){return(this.hasNode("DIFFUSE_BSDF_BL")||this.hasNode("BSDF_DIFFUSE_BL")||this.hasNode("SUBSURFACE_SCATTERING_BL")||this.hasNode("PHYSICAL_MX")||this.hasNode("OPENPBR_SURFACE_MX")||this.hasNode("OPENPBR_SURFACE_MY")||this.hasNode("STANDARD_SURFACE_AR")||this.hasNode("BSDF_GLASS_BL")||this.hasNode("BSDF_GLOSSY_BL")||this.hasNode("BSDF_METALLIC_BL")||this.hasNode("BSDF_PRINCIPLED_BL")||this.hasNode("EEVEE_SPECULAR_BL"))&&this.gtaoVisible}worldMaterialColor(){const e=this.nodeGraph;let t=Ma(e,"OUTPUT_WORLD_BL");if(t>=0){const n=pt(e,t,0);if(!n||n.originData.type!="BACKGROUND_BL")return null;if(e.findInEdges(e.nodeIndex(n)).length==0)return new Qe().fromArray(n.originData.inputs[0]).multiplyScalar(n.originData.inputs[1]);if(nn(e,e.nodeIndex(n),1))return null;const r=pt(e,e.nodeIndex(n),0);if(!r||(r.originData.type!="MIX_BL"||r.originData.dataType!="RGBA")&&r.originData.type!="MIX_RGB_BL"||r.originData.blendType!="MIX")return null;const a=pt(e,e.nodeIndex(r),0);return a&&a.originData.type=="LIGHT_PATH_BL"?nn(e,e.nodeIndex(r),2)?null:Bu(e,e.nodeIndex(a),0)?new Qe().fromArray(r.originData.inputs[2]):null:null}if(t=Ma(e,"OUTPUT_MX"),t>=0&&e.findInEdges(t).length==0)return new Qe().fromArray(e.node(t).originData.inputs[0]);if(t=Ma(e,"SKYDOME_LIGHT_AR"),t>=0){if(e.findInEdges(t).length==0){const r=e.node(t);return new Qe().fromArray(r.originData.inputs[0]).multiplyScalar(r.originData.inputs[1])}const n=pt(e,t,0);if(!n||n.originData.type!="RAY_SWITCH_AR")return null;if(e.findInEdges(e.nodeIndex(n)).length==0)return new Qe().fromArray(n.originData.inputs[0])}return null}useAddTransparency(){const e=this.nodeGraph,t=Ma(e,"OUTPUT_MATERIAL_BL");if(t>=0){const n=pt(e,t,0);if(n&&n.originData.type=="ADD_SHADER_BL"){const r=pt(e,e.nodeIndex(n),0),a=pt(e,e.nodeIndex(n),1);if(r&&a&&(r.originData.type=="BSDF_TRANSPARENT_BL"||a.originData.type=="BSDF_TRANSPARENT_BL"))return!0}}return!1}getMainShaderNode(){const e=this.nodeGraph;if(!e)return null;let t=Ma(e,"OUTPUT_MATERIAL_BL");if(t>=0){const n=pt(e,t,Ae.OUTPUT_MATERIAL_BL.surface);if(n){if(Ra(n,"MIX_SHADER_BL")){let r=pt(e,n,Ae.MIX_SHADER_BL.fac,"SEPARATE_COLOR_BL"),a=pt(e,n,Ae.MIX_SHADER_BL.color1,["DIFFUSE_BSDF_BL","BSDF_DIFFUSE_BL"]),i=pt(e,n,Ae.MIX_SHADER_BL.color2,Zi);if(r&&a&&i||(r=pt(e,n,Ae.MIX_SHADER_BL.fac,"LIGHT_PATH_BL"),a=pt(e,n,Ae.MIX_SHADER_BL.color1,"BSDF_TRANSPARENT_BL"),i=pt(e,n,Ae.MIX_SHADER_BL.color2,"EMISSION_BL"),r&&a&&i)||(r=pt(e,n,Ae.MIX_SHADER_BL.fac),a=pt(e,n,Ae.MIX_SHADER_BL.color1,"BSDF_TRANSPARENT_BL"),i=pt(e,n,Ae.MIX_SHADER_BL.color2,Zi),!r&&a&&i))return i}else if(Ra(n,Zi))return n}}if(t=Ma(e,"OUTPUT_MX"),t>=0){const n=pt(e,t,Ae.OUTPUT_MX.color,ste);if(n)return n}if(t=Ma(e,"SHADING_ENGINE_MY"),t>=0){const n=pt(e,t,Ae.SHADING_ENGINE_MY.surface,WA);if(n)return n}return null}getInputColor(e,t){const n=pt(this.nodeGraph,e,t);if(!n)return new Qe().fromArray(e.originData.inputs[t]);if(Ra(n,["RGB_BL","RGB_MX","RGB_ALPHA"])){const r=this.nodeRGB[this.nodeRGBMap[n.originData.name]];return new Qe().fromArray(r.toArray())}}getInputValue(e,t){const n=pt(this.nodeGraph,e,t);if(n){if(Ra(n,["VALUE_BL","VALUE_MX","VALUE"]))return this.nodeValue[this.nodeValueMap[n.originData.name]]}else{const r=e.originData.inputs[t];if(typeof r=="number")return r;console.error(`v3d.MeshNodeMaterial: Invalid ${sa(e)} input value at index ${t}`)}}getInputTexture(e,t){const n=pt(this.nodeGraph,e,t);if(n&&Ra(n,["TEX_IMAGE_BL","BITMAP_MX","FILE_MY","IMAGE_AR"]))return n.originData.texture}getStandardProp(e){if(!(e in Vf))return void console.error(`v3d.MeshNodeMaterial: Invalid standard property: "${e}"`);const t=this.getMainShaderNode();if(!t)return Vf[e];const n=sa(t),r=QA(t),a=this.nodeGraph;let i,s,c,u,h,f,m,g,A;switch(e){case"color":if(i=Zi.includes(n)&&pt(a,t,Ae[r].baseColor??Ae[r].color,"MIX_BL"),i&&i.originData.blendType=="MULTIPLY"){const b=pt(a,i,Ae.MIX_BL.fac),y=pt(a,i,Ae.MIX_BL.col1),M=pt(a,i,Ae.MIX_BL.col2);if(!b&&(y&&!M||!y&&M)){const R=this.getInputColor(i,y?Ae.MIX_BL.col2:Ae.MIX_BL.col1);if(R)return R}}else{let b,y;switch(n){case"BSDF_PRINCIPLED_BL":case"EEVEE_SPECULAR_BL":b=this.getInputColor(t,Ae[r].baseColor);break;case"PHYSICAL_MX":case"STANDARD_SURFACE_AR":case"LAMBERT_AR":b=this.getInputColor(t,Ae[r].baseColor),b||(b=Vf.color.clone()),y=this.getInputValue(t,Ae[r].base),_e(y)&&b.multiplyScalar(y);break;case"OPENPBR_SURFACE_MX":case"OPENPBR_SURFACE_MY":b=this.getInputColor(t,Ae[r].baseColor),b||(b=Vf.color.clone()),y=this.getInputValue(t,Ae[r].baseWeight),_e(y)&&b.multiplyScalar(y);break;default:b=this.getInputColor(t,Ae[r].color)}if(b)return b}break;case"map":if(i=Zi.includes(n)&&pt(a,t,Ae[r].baseColor??Ae[r].color,"MIX_BL"),i&&i.originData.blendType=="MULTIPLY"){const b=pt(a,i,Ae.MIX_BL.fac),y=pt(a,i,Ae.MIX_BL.col1),M=pt(a,i,Ae.MIX_BL.col2);if(!b&&(y&&!M||!y&&M)){const R=this.getInputTexture(i,y?Ae.MIX_BL.col1:Ae.MIX_BL.col2);if(R)return R}}else if(["BSDF_PRINCIPLED_BL","EEVEE_SPECULAR_BL","PHYSICAL_MX","OPENPBR_SURFACE_MX","OPENPBR_SURFACE_MY","STANDARD_SURFACE_AR","LAMBERT_AR"].includes(n)){const b=this.getInputTexture(t,Ae[r].baseColor);if(b)return b}else{const b=this.getInputTexture(t,Ae[r].color);if(b)return b}break;case"opacity":if(A=Ma(a,"OUTPUT_MATERIAL_BL"),A>=0){const b=pt(a,A,Ae.OUTPUT_MATERIAL_BL.surface,"MIX_SHADER_BL");if(b){const y=pt(a,b,Ae.MIX_SHADER_BL.fac),M=pt(a,b,Ae.MIX_SHADER_BL.color1,"BSDF_TRANSPARENT_BL"),R=pt(a,b,Ae.MIX_SHADER_BL.color2,Zi);if(!y&&M&&R){const T=this.getInputValue(b,Ae.MIX_SHADER_BL.fac);if(_e(T))return T}}}switch(n){case"BSDF_PRINCIPLED_BL":const b=this.getInputValue(t,Ae[r].alpha);if(_e(b))return b;break;case"EEVEE_SPECULAR_BL":case"PHYSICAL_MX":if(c=this.getInputValue(t,Ae[r].transparency),_e(c))return 1-c;break;case"OPENPBR_SURFACE_MX":case"OPENPBR_SURFACE_MY":if(u=this.getInputValue(t,Ae[r].geometryOpacity),_e(u))return u;break;case"LAMBERT_MY":case"SURFACE_SHADER_MY":if(c=this.getInputColor(t,Ae[r].transparency),c)return 1-(c.r+c.g+c.b)/3;break;case"STANDARD_SURFACE_AR":case"LAMBERT_AR":if(u=this.getInputColor(t,Ae[r].opacity),u)return(u.r+u.g+u.b)/3}break;case"metalness":if(this.getStandardProp("metalnessMap"))return 1;switch(n){case"BSDF_PRINCIPLED_BL":if(h=this.getInputValue(t,Ae[r].metallic),_e(h))return h;break;case"PHYSICAL_MX":case"STANDARD_SURFACE_AR":if(h=this.getInputValue(t,Ae[r].metalness),_e(h))return h;break;case"OPENPBR_SURFACE_MX":case"OPENPBR_SURFACE_MY":if(h=this.getInputValue(t,Ae[r].baseMetalness),_e(h))return h;break;case"BSDF_DIFFUSE_BL":case"DIFFUSE_BSDF_BL":case"LAMBERT_MY":case"LAMBERT_AR":case"EMISSION_BL":case"SURFACE_SHADER_MY":case"MAP_TO_MTL_AR":return 0;case"BSDF_GLOSSY_BL":case"BSDF_METALLIC_BL":return 1;case"EEVEE_SPECULAR_BL":return .5}break;case"metalnessMap":switch(n){case"BSDF_PRINCIPLED_BL":if(s=pt(a,t,Ae[r].metallic,"SEPARATE_COLOR_BL"),s&&(f=this.getInputTexture(s,Ae.SEPARATE_COLOR_BL.color),f))return f;break;case"PHYSICAL_MX":case"STANDARD_SURFACE_AR":if(f=this.getInputTexture(t,Ae[r].metalness),f)return f;break;case"OPENPBR_SURFACE_MX":case"OPENPBR_SURFACE_MY":if(f=this.getInputTexture(t,Ae[r].baseMetalness),f)return f;break;case"BSDF_DIFFUSE_BL":case"BSDF_GLOSSY_BL":case"BSDF_METALLIC_BL":case"DIFFUSE_BSDF_BL":case"EEVEE_SPECULAR_BL":case"EMISSION_BL":case"LAMBERT_MY":case"LAMBERT_AR":case"SURFACE_SHADER_MY":case"MAP_TO_MTL_AR":return null}break;case"roughness":if(this.getStandardProp("roughnessMap"))return 1;switch(n){case"BSDF_PRINCIPLED_BL":case"BSDF_GLOSSY_BL":case"BSDF_METALLIC_BL":case"EEVEE_SPECULAR_BL":case"PHYSICAL_MX":if(m=this.getInputValue(t,Ae[r].roughness),_e(m))return m;break;case"OPENPBR_SURFACE_MX":case"OPENPBR_SURFACE_MY":case"STANDARD_SURFACE_AR":if(m=this.getInputValue(t,Ae[r].specularRoughness),_e(m))return m;break;case"BSDF_DIFFUSE_BL":case"DIFFUSE_BSDF_BL":case"LAMBERT_MY":case"LAMBERT_AR":return 1;case"EMISSION_BL":case"SURFACE_SHADER_MY":case"MAP_TO_MTL_AR":return .9}break;case"roughnessMap":switch(n){case"BSDF_PRINCIPLED_BL":case"BSDF_GLOSSY_BL":case"BSDF_METALLIC_BL":case"EEVEE_SPECULAR_BL":if(s=pt(a,t,Ae[r].roughness,"SEPARATE_COLOR_BL"),s&&(g=this.getInputTexture(s,Ae.SEPARATE_COLOR_BL.color),g))return g;break;case"PHYSICAL_MX":if(g=this.getInputTexture(t,Ae[r].roughness),g)return g;break;case"OPENPBR_SURFACE_MX":case"OPENPBR_SURFACE_MY":case"STANDARD_SURFACE_AR":if(g=this.getInputTexture(t,Ae[r].specularRoughness),g)return g;break;case"BSDF_DIFFUSE_BL":case"DIFFUSE_BSDF_BL":case"EMISSION_BL":case"LAMBERT_MY":case"SURFACE_SHADER_MY":case"MAP_TO_MTL_AR":return null}break;case"aoMap":if(A=Ma(a,"OUTPUT_MATERIAL_BL"),A>=0){const b=pt(a,A,Ae.OUTPUT_MATERIAL_BL.surface,"MIX_SHADER_BL");if(b){const y=pt(a,b,Ae.MIX_SHADER_BL.fac,"SEPARATE_COLOR_BL"),M=pt(a,b,Ae.MIX_SHADER_BL.color1,["DIFFUSE_BSDF_BL","BSDF_DIFFUSE_BL"]),R=pt(a,b,Ae.MIX_SHADER_BL.color2,Zi);if(y&&M&&R){const T=this.getInputTexture(y,Ae.SEPARATE_COLOR_BL.color);if(T)return T}}}else{let b;switch(n){case"PHYSICAL_MX":case"STANDARD_SURFACE_AR":if(b=this.getInputTexture(t,Ae[r].base),b)return b;break;case"OPENPBR_SURFACE_MX":case"OPENPBR_SURFACE_MY":if(b=this.getInputTexture(t,Ae[r].baseWeight),b)return b}}break;case"aoMapIntensity":break;case"normalMap":if(Zi.includes(n)){const b=Ae[r].normal;if(_e(b)){const y=pt(a,t,b,"NORMAL_MAP_BL");if(y){const M=this.getInputTexture(y,Ae.NORMAL_MAP_BL.normalColor);if(M)return M}}}else if(WA.includes(n)){const b=Ae[r].normal;if(_e(b)){const y=pt(a,t,b,"BUMP_2D_MY");if(y){const M=this.getInputTexture(y,Ae.BUMP_2D_MY.bumpValue);if(M)return M}}}else if(n=="PHYSICAL_MX"||n=="OPENPBR_SURFACE_MX"){const b=pt(a,t,Ae[r].normal,"NORMAL_BUMP_MX");if(b){const y=this.getInputTexture(b,Ae.NORMAL_BUMP_MX.normalColor);if(y)return y}}break;case"normalScale":if(Zi.includes(n)){const b=Ae[r].normal;if(_e(b)){const y=pt(a,t,b,"NORMAL_MAP_BL");if(y){const M=this.getInputValue(y,Ae.NORMAL_MAP_BL.strength);if(_e(M))return new Ee(M,M)}}}else if(WA.includes(n)){const b=Ae[r].normal;if(_e(b)){const y=pt(a,t,b,"BUMP_2D_MY");if(y){const M=this.getInputValue(y,Ae.BUMP_2D_MY.bumpDepth);if(_e(M))return new Ee(M,M)}}}else if(n=="PHYSICAL_MX"||n=="OPENPBR_SURFACE_MX"){const b=pt(a,t,Ae[r].normal,"NORMAL_BUMP_MX");if(b){const y=this.getInputValue(b,Ae.NORMAL_BUMP_MX.normalMult);if(_e(y))return new Ee(y,y)}}break;case"emissive":if(this.getStandardProp("emissiveMap"))return new Qe(1,1,1);let _;switch(n){case"BSDF_PRINCIPLED_BL":_=this.getInputColor(t,Ae[r].emission);break;case"EEVEE_SPECULAR_BL":_=this.getInputColor(t,Ae[r].emissiveColor);break;case"PHYSICAL_MX":_=this.getInputColor(t,Ae[r].emitColor);break;case"OPENPBR_SURFACE_MX":case"OPENPBR_SURFACE_MY":case"STANDARD_SURFACE_AR":_=this.getInputColor(t,Ae[r].emissionColor)}if(_)return _;break;case"emissiveMap":let x;switch(n){case"BSDF_PRINCIPLED_BL":x=this.getInputTexture(t,Ae[r].emission);break;case"EEVEE_SPECULAR_BL":x=this.getInputTexture(t,Ae[r].emissiveColor);break;case"PHYSICAL_MX":x=this.getInputTexture(t,Ae[r].emitColor);break;case"OPENPBR_SURFACE_MX":case"OPENPBR_SURFACE_MY":case"STANDARD_SURFACE_AR":x=this.getInputTexture(t,Ae[r].emissionColor)}if(x)return x;break;case"emissiveIntensity":let C;switch(n){case"BSDF_PRINCIPLED_BL":C=this.getInputValue(t,Ae[r].emissionStrength);break;case"EEVEE_SPECULAR_BL":C=1;break;case"PHYSICAL_MX":case"STANDARD_SURFACE_AR":C=this.getInputValue(t,Ae[r].emission);break;case"OPENPBR_SURFACE_MX":C=this.getInputValue(t,Ae[r].emissionWeight);break;case"OPENPBR_SURFACE_MY":C=this.getInputValue(t,Ae[r].emissionLuminance/1e3)}if(_e(C))return C}return Vf[e]}isUnlit(){const e=this.getMainShaderNode();return!(!e||!Ra(e,["EMISSION_BL","SURFACE_SHADER_MY","MAP_TO_MTL_AR"]))}copy(e){super.copy(e),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.flatShading=e.flatShading,this.fog=e.fog,this.envMap=e.envMap,this.envMapIntensity=e.envMapIntensity,this.envMapParallaxType=e.envMapParallaxType,this.envMapParallaxMatrix.copy(e.envMapParallaxMatrix),this.envMapParallaxMatrixInv.copy(e.envMapParallaxMatrixInv),this.materialIndex=e.materialIndex,this.profile=e.profile,this.nodeTextures=Object.assign({},e.nodeTextures),this.nodeRGB=[];for(let t=0;t<e.nodeRGB.length;t++)this.nodeRGB.push(e.nodeRGB[t].clone());this.nodeRGBMap=Object.assign({},e.nodeRGBMap),this.nodeTexCoordObject=e.nodeTexCoordObject.slice(),this.nodeTexCoordObjectMap=Object.assign({},e.nodeTexCoordObjectMap),this.nodeValue=e.nodeValue.slice(),this.nodeValueMap=Object.assign({},e.nodeValueMap),this.nodeInputs={};for(const t in e.nodeInputs)this.nodeInputs[t]=e.nodeInputs[t].slice();this.needsBoundingBox=e.needsBoundingBox,this.useFloatTex=e.useFloatTex,this.nodeGraph=pw(e.nodeGraph),this.additionalNodeGraphs={};for(const t in e.additionalNodeGraphs)this.additionalNodeGraphs[t]=pw(e.additionalNodeGraphs[t]);return this.nodeChunks=Object.assign({},e.nodeChunks),this.nodeChunksHash=e.nodeChunksHash,this.nodeVCAliases=Object.assign({},e.nodeVCAliases),this.nodeUVAliases=Object.assign({},e.nodeUVAliases),this}}const Qa={enabled:!1,files:{},add:function(o,e){this.enabled!==!1&&(this.files[o]=e)},get:function(o){if(this.enabled!==!1)return this.files[o]},remove:function(o){delete this.files[o]},clear:function(){this.files={}}};class tB{constructor(e,t,n){const r=this;let a,i=!1,s=0,c=0;const u=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=n,this.itemStart=function(h){c++,i===!1&&r.onStart!==void 0&&r.onStart(h,s,c),i=!0},this.itemEnd=function(h){s++,r.onProgress!==void 0&&r.onProgress(h,s,c),s===c&&(i=!1,r.onLoad!==void 0&&r.onLoad())},this.itemError=function(h){r.onError!==void 0&&r.onError(h)},this.resolveURL=function(h){return a?a(h):h},this.setURLModifier=function(h){return a=h,this},this.addHandler=function(h,f){return u.push(h,f),this},this.removeHandler=function(h){const f=u.indexOf(h);return f!==-1&&u.splice(f,2),this},this.getHandler=function(h){for(let f=0,m=u.length;f<m;f+=2){const g=u[f],A=u[f+1];if(g.global&&(g.lastIndex=0),g.test(h))return A}return null}}}const rb=new tB;class ma{constructor(e){this.manager=e!==void 0?e:rb,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,t){const n=this;return new Promise(function(r,a){n.load(e,r,t,a)})}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}}const Ki={};class lte extends Error{constructor(e,t){super(e),this.response=t}}class fa extends ma{constructor(e){super(e)}load(e,t,n,r){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const a=Qa.get(e);if(a!==void 0)return this.manager.itemStart(e),setTimeout(()=>{t&&t(a),this.manager.itemEnd(e)},0),a;if(Ki[e]!==void 0)return void Ki[e].push({onLoad:t,onProgress:n,onError:r});Ki[e]=[],Ki[e].push({onLoad:t,onProgress:n,onError:r});const i=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),s=this.mimeType,c=this.responseType;fetch(i).then(u=>{if(u.status===200||u.status===0){if(u.status===0&&console.warn("v3d.FileLoader: HTTP Status 0 received."),typeof ReadableStream>"u"||u.body===void 0||u.body.getReader===void 0)return u;const h=Ki[e],f=u.body.getReader(),m=u.headers.get("Content-Length")||u.headers.get("X-File-Size"),g=m?parseInt(m):0,A=g!==0;let _=0;const x=new ReadableStream({start(C){(function b(){f.read().then(({done:y,value:M})=>{if(y)C.close();else{_+=M.byteLength;const R=new ProgressEvent("progress",{lengthComputable:A,loaded:_,total:g});for(let T=0,w=h.length;T<w;T++){const D=h[T];D.onProgress&&D.onProgress(R)}C.enqueue(M),b()}})})()}});return new Response(x)}throw new lte(`fetch for "${u.url}" responded with ${u.status}: ${u.statusText}`,u)}).then(u=>{switch(c){case"arraybuffer":return u.arrayBuffer();case"blob":return u.blob();case"document":return u.text().then(h=>new DOMParser().parseFromString(h,s));case"json":return u.json();default:if(s===void 0)return u.text();{const h=/charset="?([^;"\s]*)"?/i.exec(s),f=h&&h[1]?h[1].toLowerCase():void 0,m=new TextDecoder(f);return u.arrayBuffer().then(g=>m.decode(g))}}}).then(u=>{Qa.add(e,u);const h=Ki[e];delete Ki[e];for(let f=0,m=h.length;f<m;f++){const g=h[f];g.onLoad&&g.onLoad(u)}}).catch(u=>{const h=Ki[e];if(h===void 0)throw this.manager.itemError(e),u;delete Ki[e];for(let f=0,m=h.length;f<m;f++){const g=h[f];g.onError&&g.onError(u)}this.manager.itemError(e)}).finally(()=>{this.manager.itemEnd(e)}),this.manager.itemStart(e)}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}}class cte extends ma{constructor(e){super(e)}load(e,t,n,r){const a=this,i=[],s=new il,c=new fa(this.manager);c.setPath(this.path),c.setResponseType("arraybuffer"),c.setRequestHeader(this.requestHeader),c.setWithCredentials(a.withCredentials);let u=0;function h(f){c.load(e[f],function(m){const g=a.parse(m,!0);i[f]={width:g.width,height:g.height,format:g.format,mipmaps:g.mipmaps},u+=1,u===6&&(g.mipmapCount===1&&(s.minFilter=1006),s.image=i,s.format=g.format,s.needsUpdate=!0,t&&t(s))},n,r)}if(Array.isArray(e))for(let f=0,m=e.length;f<m;++f)h(f);else c.load(e,function(f){const m=a.parse(f,!0);if(m.isCubemap){const g=m.mipmaps.length/m.mipmapCount;for(let A=0;A<g;A++){i[A]={mipmaps:[]};for(let _=0;_<m.mipmapCount;_++)i[A].mipmaps.push(m.mipmaps[A*m.mipmapCount+_]),i[A].format=m.format,i[A].width=m.width,i[A].height=m.height}s.image=i}else s.image.width=m.width,s.image.height=m.height,s.mipmaps=m.mipmaps;m.mipmapCount===1&&(s.minFilter=1006),s.format=m.format,s.needsUpdate=!0,t&&t(s)},n,r);return s}}class ob extends ma{constructor(e){super(e)}load(e,t,n,r){this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const a=this,i=Qa.get(e);if(i!==void 0)return a.manager.itemStart(e),setTimeout(function(){t&&t(i),a.manager.itemEnd(e)},0),i;const s=Wh("img");function c(){h(),Qa.add(e,this),t&&t(this),a.manager.itemEnd(e)}function u(f){h(),r&&r(f),a.manager.itemError(e),a.manager.itemEnd(e)}function h(){s.removeEventListener("load",c,!1),s.removeEventListener("error",u,!1)}return s.addEventListener("load",c,!1),s.addEventListener("error",u,!1),e.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(s.crossOrigin=this.crossOrigin),a.manager.itemStart(e),s.src=e,s}}class ute extends ma{constructor(e){super(e)}load(e,t,n,r){const a=new yv,i=new ob(this.manager);i.setCrossOrigin(this.crossOrigin),i.setPath(this.path);let s=0;function c(u){i.load(e[u],function(h){a.images[u]=h,s++,s===6&&(a.needsUpdate=!0,t&&t(a))},void 0,r)}for(let u=0;u<e.length;++u)c(u);return a}}class nB extends ma{constructor(e){super(e)}load(e,t,n,r){const a=this,i=new ss,s=new fa(this.manager);return s.setResponseType("arraybuffer"),s.setRequestHeader(this.requestHeader),s.setPath(this.path),s.setWithCredentials(a.withCredentials),s.load(e,function(c){const u=a.parse(c);u&&(u.image!==void 0?i.image=u.image:u.data!==void 0&&(i.image.width=u.width,i.image.height=u.height,i.image.data=u.data),i.wrapS=u.wrapS!==void 0?u.wrapS:1001,i.wrapT=u.wrapT!==void 0?u.wrapT:1001,i.magFilter=u.magFilter!==void 0?u.magFilter:1006,i.minFilter=u.minFilter!==void 0?u.minFilter:1006,i.anisotropy=u.anisotropy!==void 0?u.anisotropy:1,u.encoding!==void 0&&(i.encoding=u.encoding),u.flipY!==void 0&&(i.flipY=u.flipY),u.format!==void 0&&(i.format=u.format),u.type!==void 0&&(i.type=u.type),u.mipmaps!==void 0&&(i.mipmaps=u.mipmaps,i.minFilter=1008),u.mipmapCount===1&&(i.minFilter=1006),u.generateMipmaps!==void 0&&(i.generateMipmaps=u.generateMipmaps),i.needsUpdate=!0,t&&t(i,u))},n,r),i}}class ab extends ma{constructor(e){super(e)}load(e,t,n,r){const a=new In,i=new ob(this.manager);return i.setCrossOrigin(this.crossOrigin),i.setPath(this.path),i.load(e,function(s){a.image=s,a.needsUpdate=!0,t!==void 0&&t(a)},n,r),a}}class rB extends ma{constructor(e){super(e),this.isImageBitmapLoader=!0,typeof createImageBitmap>"u"&&console.warn("v3d.ImageBitmapLoader: createImageBitmap() not supported."),typeof fetch>"u"&&console.warn("v3d.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(e){return this.options=e,this}load(e,t,n,r){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const a=this,i=Qa.get(e);if(i!==void 0)return a.manager.itemStart(e),setTimeout(function(){t&&t(i),a.manager.itemEnd(e)},0),i;const s={};s.credentials=this.crossOrigin==="anonymous"?"same-origin":"include",s.headers=this.requestHeader,fetch(e,s).then(function(c){return c.blob()}).then(function(c){return createImageBitmap(c,Object.assign(a.options,{colorSpaceConversion:"none"}))}).then(function(c){Qa.add(e,c),t&&t(c),a.manager.itemEnd(e)}).catch(function(c){r&&r(c),a.manager.itemError(e),a.manager.itemEnd(e)}),a.manager.itemStart(e)}}class fi{static decodeText(e){if(typeof TextDecoder<"u")return new TextDecoder().decode(e);let t="";for(let n=0,r=e.length;n<r;n++)t+=String.fromCharCode(e[n]);try{return decodeURIComponent(escape(t))}catch{return t}}static extractUrlBase(e){const t=e.lastIndexOf("/");return t===-1?"./":e.slice(0,t+1)}static resolveURL(e,t){return typeof e!="string"||e===""?"":(/^https?:\/\//i.test(t)&&/^\//.test(e)&&(t=t.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:t+e)}}let p0;class ib{static getContext(){return p0===void 0&&(p0=new(window.AudioContext||window.webkitAudioContext)),p0}static setContext(e){p0=e}}class dte extends ma{constructor(e){super(e)}load(e,t,n,r){const a=this,i=new fa(this.manager);i.setResponseType("arraybuffer"),i.setPath(this.path),i.setRequestHeader(this.requestHeader),i.setWithCredentials(this.withCredentials),i.load(e,function(s){try{const c=s.slice(0);ib.getContext().decodeAudioData(c,function(u){t(u)})}catch(c){r?r(c):console.error(c),a.manager.itemError(e)}},n,r)}}class Al extends Tt{constructor(e,t=1){super(),this.isLight=!0,this.type="Light",this.color=new Qe(e),this.intensity=t}dispose(){}copy(e,t){return super.copy(e,t),this.color.copy(e.color),this.intensity=e.intensity,this}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(-t[8],-t[9],-t[10]).normalize()}}const gw=new B;class oB extends Al{constructor(e,t,n=0,r=Math.PI/3,a=0,i=2){super(e,t),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(Tt.DefaultUp),this.updateMatrix(),this.target=new Tt,this.distance=n,this.angle=r,this.penumbra=a,this.decay=i,this.shadow=new NJ,this.isFreeLight=!1}get power(){return 4*this.intensity*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this.isFreeLight=e.isFreeLight,this}updateMatrixWorld(e){super.updateMatrixWorld(e),this.isFreeLight&&this.updateFreeLightTarget()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.isFreeLight&&this.updateFreeLightTarget()}updateFreeLightTarget(){gw.set(0,0,-1).applyQuaternion(this.quaternion).normalize(),this.target.position.addVectors(this.position,gw),this.target.updateMatrixWorld()}}const vw=new Ve,kf=new B,YA=new B;class aB extends Sv{constructor(){super(new ir(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new Ee(4,2),this._viewportCount=6,this._viewports=[new ct(2,1,1,1),new ct(0,1,1,1),new ct(3,1,1,1),new ct(1,1,1,1),new ct(3,0,1,1),new ct(1,0,1,1)],this._cubeDirections=[new B(1,0,0),new B(-1,0,0),new B(0,0,1),new B(0,0,-1),new B(0,1,0),new B(0,-1,0)],this._cubeUps=[new B(0,1,0),new B(0,1,0),new B(0,1,0),new B(0,1,0),new B(0,0,1),new B(0,0,-1)]}updateMatrices(e,t=0){const n=this.camera,r=this.matrix,a=e.distance||n.far;a!==n.far&&(n.far=a,n.updateProjectionMatrix()),kf.setFromMatrixPosition(e.matrixWorld),n.position.copy(kf),YA.copy(n.position),YA.add(this._cubeDirections[t]),n.up.copy(this._cubeUps[t]),n.lookAt(YA),n.updateMatrixWorld(),r.makeTranslation(-kf.x,-kf.y,-kf.z),vw.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),this._frustum.setFromProjectionMatrix(vw)}}class iB extends Al{constructor(e,t,n=0,r=2){super(e,t),this.isPointLight=!0,this.type="PointLight",this.distance=n,this.decay=r,this.shadow=new aB}get power(){return 4*this.intensity*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}class fte extends aB{constructor(){super(),this.isRectAreaLightShadow=!0}}class sB extends Al{constructor(e,t,n=10,r=10){super(e,t),this.isRectAreaLight=!0,this.type="RectAreaLight",this.width=n,this.height=r,this.shadow=new fte}get power(){return 2*this.intensity*Math.PI}set power(e){this.intensity=e/(2*Math.PI)}copy(e){return super.copy(e),this.width=e.width,this.height=e.height,this.shadow=e.shadow.clone(),this}}class hte extends Al{constructor(e,t,n){super(e,n),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(Tt.DefaultUp),this.updateMatrix(),this.groundColor=new Qe(t)}copy(e,t){return super.copy(e,t),this.groundColor.copy(e.groundColor),this}}class Ju{constructor(){this.isSphericalHarmonics3=!0,this.coefficients=[];for(let e=0;e<9;e++)this.coefficients.push(new B)}set(e){for(let t=0;t<9;t++)this.coefficients[t].copy(e[t]);return this}zero(){for(let e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this}getAt(e,t){const n=e.x,r=e.y,a=e.z,i=this.coefficients;return t.copy(i[0]).multiplyScalar(.282095),t.addScaledVector(i[1],.488603*r),t.addScaledVector(i[2],.488603*a),t.addScaledVector(i[3],.488603*n),t.addScaledVector(i[4],n*r*1.092548),t.addScaledVector(i[5],r*a*1.092548),t.addScaledVector(i[6],.315392*(3*a*a-1)),t.addScaledVector(i[7],n*a*1.092548),t.addScaledVector(i[8],.546274*(n*n-r*r)),t}getIrradianceAt(e,t){const n=e.x,r=e.y,a=e.z,i=this.coefficients;return t.copy(i[0]).multiplyScalar(.886227),t.addScaledVector(i[1],1.023328*r),t.addScaledVector(i[2],1.023328*a),t.addScaledVector(i[3],1.023328*n),t.addScaledVector(i[4],.858086*n*r),t.addScaledVector(i[5],.858086*r*a),t.addScaledVector(i[6],.743125*a*a-.247708),t.addScaledVector(i[7],.858086*n*a),t.addScaledVector(i[8],.429043*(n*n-r*r)),t}add(e){for(let t=0;t<9;t++)this.coefficients[t].add(e.coefficients[t]);return this}addScaledSH(e,t){for(let n=0;n<9;n++)this.coefficients[n].addScaledVector(e.coefficients[n],t);return this}scale(e){for(let t=0;t<9;t++)this.coefficients[t].multiplyScalar(e);return this}lerp(e,t){for(let n=0;n<9;n++)this.coefficients[n].lerp(e.coefficients[n],t);return this}equals(e){for(let t=0;t<9;t++)if(!this.coefficients[t].equals(e.coefficients[t]))return!1;return!0}copy(e){return this.set(e.coefficients)}clone(){return new this.constructor().copy(this)}fromArray(e,t=0){const n=this.coefficients;for(let r=0;r<9;r++)n[r].fromArray(e,t+3*r);return this}toArray(e=[],t=0){const n=this.coefficients;for(let r=0;r<9;r++)n[r].toArray(e,t+3*r);return e}static getBasisAt(e,t){const n=e.x,r=e.y,a=e.z;t[0]=.282095,t[1]=.488603*r,t[2]=.488603*a,t[3]=.488603*n,t[4]=1.092548*n*r,t[5]=1.092548*r*a,t[6]=.315392*(3*a*a-1),t[7]=1.092548*n*a,t[8]=.546274*(n*n-r*r)}}class Kh extends Al{constructor(e=new Ju,t=1){super(void 0,t),this.isLightProbe=!0,this.type="LightProbe",this.sh=e}copy(e){return super.copy(e),this.sh.copy(e.sh),this}}class pte extends Kh{constructor(e,t,n=1){super(void 0,n),this.isHemisphereLightProbe=!0,this.type="HemisphereLightProbe";const r=new Qe().set(e),a=new Qe().set(t),i=new B(r.r,r.g,r.b),s=new B(a.r,a.g,a.b),c=Math.sqrt(Math.PI),u=c*Math.sqrt(.75);this.sh.coefficients[0].copy(i).add(s).multiplyScalar(c),this.sh.coefficients[1].copy(i).sub(s).multiplyScalar(u)}}const jA=new Ve;class Bv{constructor({maxFar:e=1e5,projectionMatrix:t=null}={}){this.vertices={near:[new B,new B,new B,new B],far:[new B,new B,new B,new B]},t&&this.setFromProjectionMatrix(t,e)}setFromProjectionMatrix(e,t){const n=e.elements[11]===0;return jA.copy(e).invert(),this.vertices.near[0].set(1,1,-1),this.vertices.near[1].set(1,-1,-1),this.vertices.near[2].set(-1,-1,-1),this.vertices.near[3].set(-1,1,-1),this.vertices.near.forEach(function(r){r.applyMatrix4(jA)}),this.vertices.far[0].set(1,1,1),this.vertices.far[1].set(1,-1,1),this.vertices.far[2].set(-1,-1,1),this.vertices.far[3].set(-1,1,1),this.vertices.far.forEach(function(r){r.applyMatrix4(jA);const a=Math.abs(r.z);n?r.z*=Math.min(t/a,1):r.multiplyScalar(Math.min(t/a,1))}),this.vertices}split(e,t,n){for(;e.length>t.length;)t.push(new Bv);t.length=e.length;for(let r=0;r<e.length;r++){const a=t[r];if(r===0||n)for(let i=0;i<4;i++)a.vertices.near[i].copy(this.vertices.near[i]);else for(let i=0;i<4;i++)a.vertices.near[i].lerpVectors(this.vertices.near[i],this.vertices.far[i],e[r-1]);if(r===e.length-1)for(let i=0;i<4;i++)a.vertices.far[i].copy(this.vertices.far[i]);else for(let i=0;i<4;i++)a.vertices.far[i].lerpVectors(this.vertices.near[i],this.vertices.far[i],e[r])}}toSpace(e,t){for(let n=0;n<4;n++)t.vertices.near[n].copy(this.vertices.near[n]).applyMatrix4(e),t.vertices.far[n].copy(this.vertices.far[n]).applyMatrix4(e)}}const lB=new B,mte=new B,gte=new B,cB=new Ve;new Ve;const Gf=new mn,XA=new Bv,qA=[],ZA=[];class vte extends Sv{constructor(){super(new yi(-5,5,5,-5,.5,500)),this.esmBlurRadius=0,this.pancakeDepth=!0,this.isDirectionalLightShadowCascade=!0}updateMatrices(e){const t=this.camera,n=this.matrix,r=lB.setFromMatrixPosition(t.matrixWorld),a=mte.setFromMatrixPosition(e.matrixWorld);t.position.copy(a);const i=gte.setFromMatrixPosition(e.target.matrixWorld);t.lookAt(i),t.position.copy(r),t.updateMatrixWorld();const s=cB.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse);this._frustum.setFromProjectionMatrix(s),this.pancakeDepth&&(this._frustum.planes[5].constant=1/0),n.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),n.multiply(s)}}class _te extends Sv{constructor({numCascades:e=1,maxDistance:t=500,fade:n=0,lightMargin:r=1,noLastCascadeCutOff:a=!0,customSplitsCallback:i=null}={}){super(new yi(-5,5,5,-5,.5,500)),this.numCascades=e,this.exponent=.5,this.customSplitsCallback=i,this.maxDistance=t,this.fade=n,this.lightMargin=r,this.noLastCascadeCutOff=a,this.cascadesFitToScene=!1,this.mainFrustum=new Bv,this._frustums=[],this._breaks=[],this._cascades=[],this._sceneViewProjectionMatrix=new Ve,this._sceneViewCamera=null,this._needsCascadeFrustumsUpdate=!0,this.createCascades(),this.isDirectionalLightShadowCSM=!0}createCascades(){const e=this._cascades;for(;e.length>this.numCascades;)e.pop().dispose();for(let t=e.length;t<this.numCascades;t++){const n=new vte;n.mapSize.copy(this.mapSize),n.copy(this),e.push(n)}for(let t=0;t<e.length;t++){const n=e[t];n.mapSize.copy(this.mapSize),n.copy(this)}this.updateMapSize()}initCascades(e){e.updateProjectionMatrix(),this.mainFrustum.setFromProjectionMatrix(e.projectionMatrix,this.maxDistance),this.mainFrustum.split(this._breaks,this._frustums,this.cascadesFitToScene)}updateShadowBounds(e){const t=this._frustums;for(let n=0;n<t.length;n++){const r=this._cascades[n],a=this._cascades[n].camera,i=t[n],s=i.vertices.near,c=i.vertices.far,u=c[0];let h;h=u.distanceTo(c[2])>u.distanceTo(s[2])?c[2]:s[2];let f=u.distanceTo(h);if(this.fade>0){const m=Math.min(e.far,this.maxDistance),g=e.near,A=i.vertices.far[0].z/(m-g);f+=this.fade*Math.pow(A,2)*(m-g)}a.left=-f/2,a.right=f/2,a.top=f/2,a.bottom=-f/2,a.near=0,a.far=f+this.lightMargin,a.updateProjectionMatrix(),r.bias=this.bias,r.normalBias=this.normalBias,r.esmBlurRadius=r.radius/((a.right-a.left)/2)}}getBreaks(e){const t=e.near,n=Math.min(e.far,this.maxDistance),r=this.numCascades,a=this.exponent,i=this._breaks;i.length=0,this.customSplitsCallback?this.customSplitsCallback(r,t,n,i,a):function(s,c,u,h,f){qA.length=0,ZA.length=0,function(m,g,A,_){for(let x=1;x<m;x++)_.push(g*(A/g)**(x/m)/A);_.push(1)}(s,c,u,ZA),function(m,g,A,_){for(let x=1;x<m;x++)_.push((g+(A-g)*x/m)/A);_.push(1)}(s,c,u,qA);for(let m=1;m<s;m++)f.push(ui(qA[m-1],ZA[m-1],h));f.push(1)}(r,t,n,a,i)}updateCascadePositions(e){const t=this._frustums;for(let n=0;n<t.length;n++){const r=this._cascades[n],a=this._cascades[n].camera,i=(a.right-a.left)/r.mapSize.x,s=(a.top-a.bottom)/r.mapSize.y;a.updateMatrixWorld(!0);const c=cB.multiplyMatrices(a.matrixWorldInverse,e.matrixWorld);t[n].toSpace(c,XA);const u=XA.vertices.near,h=XA.vertices.far;Gf.makeEmpty();for(let m=0;m<4;m++)Gf.expandByPoint(u[m]),Gf.expandByPoint(h[m]);const f=Gf.getCenter(lB);f.z=Gf.max.z+this.lightMargin,f.x=Math.floor(f.x/i)*i,f.y=Math.floor(f.y/s)*s,f.applyMatrix4(a.matrixWorld),a.position.copy(f),a.updateMatrixWorld()}}update(e,t){!this._needsCascadeFrustumsUpdate&&this._sceneViewCamera===e&&this._sceneViewProjectionMatrix.equals(e.projectionMatrix)||(this.updateFrustums(e),this.updateMatrices(t),this._sceneViewCamera=e,this._sceneViewProjectionMatrix.copy(e.projectionMatrix),this._needsCascadeFrustumsUpdate=!1),this.updateCascadePositions(e)}getCascadeRange(e,t){const n=this._breaks,r=n[t],a=n[t-1]||0;e.x=a,e.y=r,this.noLastCascadeCutOff&&t==n.length-1&&(e.y=1/0)}updateFrustums(e){this.getBreaks(e),this.initCascades(e),this.updateShadowBounds(e)}updateMatrices(e){for(let t=0;t<this._cascades.length;t++)this._cascades[t].updateMatrices(e)}updateMapSize(e){e&&this.mapSize.copy(e);const t=this.mapSize;for(let n=0;n<this._cascades.length;n++)this._cascades[n].mapSize.copy(t);this.updateMaps()}updateMaps(){for(let e=0;e<this._cascades.length;e++){const t=this._cascades[e];t.dispose(),t.map=null,t._additionalMap2D=null,t._additionalMapCube=null}}dispose(){for(let e=0;e<this._cascades.length;e++)this._cascades[e].dispose();super.dispose()}copy(e){return super.copy(e),this.numCascades=e.numCascades,this.exponent=e.exponent,this.maxDistance=e.maxDistance,this.fade=e.fade,this.lightMargin=e.lightMargin,this.noLastCascadeCutOff=e.noLastCascadeCutOff,this.createCascades(),this}clone(){return new this.constructor().copy(this)}setCascadesFitToScene(e){this.cascadesFitToScene=e,this._needsCascadeFrustumsUpdate=!0}setExponent(e){this.exponent=e,this._needsCascadeFrustumsUpdate=!0}setFade(e){this.fade=e,this._needsCascadeFrustumsUpdate=!0}setMaxDistance(e){this.maxDistance=e,this._needsCascadeFrustumsUpdate=!0}setNoLastCascadeCutOff(e){this.noLastCascadeCutOff=e,this._needsCascadeFrustumsUpdate=!0}setNumCascades(e){this.numCascades=e,this._needsCascadeFrustumsUpdate=!0,this.createCascades()}setLightMargin(e){this.lightMargin=e,this._needsCascadeFrustumsUpdate=!0}}const _w=new B;class uB extends Al{constructor(e,t){super(e,t),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(Tt.DefaultUp),this.updateMatrix(),this.target=new Tt,this.shadow=new _te,this.isFreeLight=!1}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this.isFreeLight=e.isFreeLight,this}updateMatrixWorld(e){super.updateMatrixWorld(e),this.isFreeLight&&this.updateFreeLightTarget()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.isFreeLight&&this.updateFreeLightTarget()}updateFreeLightTarget(){_w.set(0,0,-1).applyQuaternion(this.quaternion).normalize(),this.target.position.addVectors(this.position,_w),this.target.updateMatrixWorld()}}class dB extends Al{constructor(e,t){super(e,t),this.isAmbientLight=!0,this.type="AmbientLight"}}class Ate extends Kh{constructor(e,t=1){super(void 0,t),this.isAmbientLightProbe=!0,this.type="AmbientLightProbe";const n=new Qe().set(e);this.sh.coefficients[0].set(n.r,n.g,n.b).multiplyScalar(2*Math.sqrt(Math.PI))}}const Aw=new Ve,xw=new Ve,Jl=new Ve;class xte{constructor(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new ir,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new ir,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}update(e){const t=this._cache;if(t.focus!==e.focus||t.fov!==e.fov||t.aspect!==e.aspect*this.aspect||t.near!==e.near||t.far!==e.far||t.zoom!==e.zoom||t.eyeSep!==this.eyeSep){t.focus=e.focus,t.fov=e.fov,t.aspect=e.aspect*this.aspect,t.near=e.near,t.far=e.far,t.zoom=e.zoom,t.eyeSep=this.eyeSep,Jl.copy(e.projectionMatrix);const n=t.eyeSep/2,r=n*t.near/t.focus,a=t.near*Math.tan(ls*t.fov*.5)/t.zoom;let i,s;xw.elements[12]=-n,Aw.elements[12]=n,i=-a*t.aspect+r,s=a*t.aspect+r,Jl.elements[0]=2*t.near/(s-i),Jl.elements[8]=(s+i)/(s-i),this.cameraL.projectionMatrix.copy(Jl),i=-a*t.aspect-r,s=a*t.aspect-r,Jl.elements[0]=2*t.near/(s-i),Jl.elements[8]=(s+i)/(s-i),this.cameraR.projectionMatrix.copy(Jl)}this.cameraL.matrixWorld.copy(e.matrixWorld).multiply(xw),this.cameraR.matrixWorld.copy(e.matrixWorld).multiply(Aw)}}class bi{constructor(e=!0){this.autoStart=e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=yw(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const t=yw();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}}function yw(){return(typeof performance>"u"?Date:performance).now()}const ec=new B,bw=new Ct,yte=new B,tc=new B;class fB extends Tt{constructor(){super(),this.type="AudioListener",this.context=ib.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new bi}getInput(){return this.gain}removeFilter(){return this.filter!==null&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}getFilter(){return this.filter}setFilter(e){return this.filter!==null?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=e,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}getMasterVolume(){return this.gain.gain.value}setMasterVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}updateMatrixWorld(e){super.updateMatrixWorld(e);const t=this.context.listener,n=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(ec,bw,yte),tc.set(0,0,-1).applyQuaternion(bw),t.positionX){const r=this.context.currentTime+this.timeDelta;t.positionX.linearRampToValueAtTime(ec.x,r),t.positionY.linearRampToValueAtTime(ec.y,r),t.positionZ.linearRampToValueAtTime(ec.z,r),t.forwardX.linearRampToValueAtTime(tc.x,r),t.forwardY.linearRampToValueAtTime(tc.y,r),t.forwardZ.linearRampToValueAtTime(tc.z,r),t.upX.linearRampToValueAtTime(n.x,r),t.upY.linearRampToValueAtTime(n.y,r),t.upZ.linearRampToValueAtTime(n.z,r)}else t.setPosition(ec.x,ec.y,ec.z),t.setOrientation(tc.x,tc.y,tc.z,n.x,n.y,n.z)}}class hB extends Tt{constructor(e){super(),this.type="Audio",this.listener=e,this.context=e.context,this.gain=this.context.createGain(),this.gain.connect(e.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this}setMediaElementSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(e),this.connect(),this}setMediaStreamSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(e),this.connect(),this}setBuffer(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this}play(e=0){if(this.isPlaying===!0)return void console.warn("v3d.Audio: Audio is already playing.");if(this.hasPlaybackControl===!1)return void console.warn("v3d.Audio: this Audio has no playback control.");this._startedAt=this.context.currentTime+e;const t=this.context.createBufferSource();return t.buffer=this.buffer,t.loop=this.loop,t.loopStart=this.loopStart,t.loopEnd=this.loopEnd,t.onended=this.onEnded.bind(this),t.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=t,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(this.hasPlaybackControl!==!1)return this.isPlaying===!0&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,this.loop===!0&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this;console.warn("v3d.Audio: this Audio has no playback control.")}stop(){if(this.hasPlaybackControl!==!1)return this._progress=0,this.source.stop(),this.source.onended=null,this.isPlaying=!1,this;console.warn("v3d.Audio: this Audio has no playback control.")}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}getFilters(){return this.filters}setFilters(e){return e||(e=[]),this._connected===!0?(this.disconnect(),this.filters=e.slice(),this.connect()):this.filters=e.slice(),this}setDetune(e){if(this.detune=e,this.source.detune!==void 0)return this.isPlaying===!0&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(e){return this.setFilters(e?[e]:[])}setPlaybackRate(e){if(this.hasPlaybackControl!==!1)return this.playbackRate=e,this.isPlaying===!0&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this;console.warn("v3d.Audio: this Audio has no playback control.")}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1}getLoop(){return this.hasPlaybackControl===!1?(console.warn("v3d.Audio: this Audio has no playback control."),!1):this.loop}setLoop(e){if(this.hasPlaybackControl!==!1)return this.loop=e,this.isPlaying===!0&&(this.source.loop=this.loop),this;console.warn("v3d.Audio: this Audio has no playback control.")}setLoopStart(e){return this.loopStart=e,this}setLoopEnd(e){return this.loopEnd=e,this}getVolume(){return this.gain.gain.value}setVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}}const nc=new B,Sw=new Ct,bte=new B,rc=new B;class Ste extends hB{constructor(e){super(e),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}fromAudio(e){return this.panner.disconnect(this.gain),this.listener=e.listener,this.context=e.context,this.gain=e.gain,this.autoplay=e.autoplay,this.buffer=e.buffer,this.detune=e.detune,this.loop=e.loop,this.loopStart=e.loopStart,this.loopEnd=e.loopEnd,this.offset=e.offset,this.duration=e.duration,this.playbackRate=e.playbackRate,this.isPlaying=e.isPlaying,this.hasPlaybackControl=e.hasPlaybackControl,this.audio=e.audio,this.sourceType=e.sourceType,this._startedAt=e._startedAt,this._progress=e._progress,this._connected=e._connected,this.filters=e.filters.slice(0),this.panner.connect(this.gain),this}disconnect(){super.disconnect(),this.panner.disconnect(this.gain)}getOutput(){return this.panner}getRefDistance(){return this.panner.refDistance}setRefDistance(e){return this.panner.refDistance=e,this}getRolloffFactor(){return this.panner.rolloffFactor}setRolloffFactor(e){return this.panner.rolloffFactor=e,this}getDistanceModel(){return this.panner.distanceModel}setDistanceModel(e){return this.panner.distanceModel=e,this}getMaxDistance(){return this.panner.maxDistance}setMaxDistance(e){return this.panner.maxDistance=e,this}setDirectionalCone(e,t,n){return this.panner.coneInnerAngle=e,this.panner.coneOuterAngle=t,this.panner.coneOuterGain=n,this}updateMatrixWorld(e){if(super.updateMatrixWorld(e),this.hasPlaybackControl===!0&&this.isPlaying===!1)return;this.matrixWorld.decompose(nc,Sw,bte),rc.set(0,0,1).applyQuaternion(Sw);const t=this.panner;if(t.positionX){const n=this.context.currentTime+this.listener.timeDelta;t.positionX.linearRampToValueAtTime(nc.x,n),t.positionY.linearRampToValueAtTime(nc.y,n),t.positionZ.linearRampToValueAtTime(nc.z,n),t.orientationX.linearRampToValueAtTime(rc.x,n),t.orientationY.linearRampToValueAtTime(rc.y,n),t.orientationZ.linearRampToValueAtTime(rc.z,n)}else t.setPosition(nc.x,nc.y,nc.z),t.setOrientation(rc.x,rc.y,rc.z)}}class Cte{constructor(e,t=2048){this.analyser=e.context.createAnalyser(),this.analyser.fftSize=t,this.data=new Uint8Array(this.analyser.frequencyBinCount),e.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let e=0;const t=this.getFrequencyData();for(let n=0;n<t.length;n++)e+=t[n];return e/t.length}}class pB extends Ld{constructor(e,t,n,r){super(e,t,n,r),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:2400,endingEnd:2400}}intervalChanged_(e,t,n){const r=this.parameterPositions;let a=e-2,i=e+1,s=r[a],c=r[i];if(s===void 0)switch(this.getSettings_().endingStart){case 2401:a=e,s=2*t-n;break;case 2402:a=r.length-2,s=t+r[a]-r[a+1];break;default:a=e,s=n}if(c===void 0)switch(this.getSettings_().endingEnd){case 2401:i=e,c=2*n-t;break;case 2402:i=1,c=n+r[1]-r[0];break;default:i=e-1,c=t}const u=.5*(n-t),h=this.valueSize;this._weightPrev=u/(t-s),this._weightNext=u/(c-n),this._offsetPrev=a*h,this._offsetNext=i*h}interpolate_(e,t,n,r){const a=this.resultBuffer,i=this.sampleValues,s=this.valueSize,c=e*s,u=c-s,h=this._offsetPrev,f=this._offsetNext,m=this._weightPrev,g=this._weightNext,A=(n-t)/(r-t),_=A*A,x=_*A,C=-m*x+2*m*_-m*A,b=(1+m)*x+(-1.5-2*m)*_+(-.5+m)*A+1,y=(-1-g)*x+(1.5+g)*_+.5*A,M=g*x-g*_;for(let R=0;R!==s;++R)a[R]=C*i[h+R]+b*i[u+R]+y*i[c+R]+M*i[f+R];return a}}function ia(o,e,t){return mc(o)?new o.constructor(o.subarray(e,t!==void 0?t:o.length)):o.slice(e,t)}function R2(o,e,t){return!o||!t&&o.constructor===e?o:typeof e.BYTES_PER_ELEMENT=="number"?new e(o):Array.prototype.slice.call(o)}function mc(o){return ArrayBuffer.isView(o)&&!(o instanceof DataView)}function mB(o){const e=o.length,t=new Array(e);for(let n=0;n!==e;++n)t[n]=n;return t.sort(function(n,r){return o[n]-o[r]}),t}function I2(o,e,t){const n=o.length,r=new o.constructor(n);for(let a=0,i=0;i!==n;++a){const s=t[a]*e;for(let c=0;c!==e;++c)r[i++]=o[s+c]}return r}function gB(o,e,t,n){let r=1,a=o[0];for(;a!==void 0&&a[n]===void 0;)a=o[r++];if(a===void 0)return;let i=a[n];if(i!==void 0)if(Array.isArray(i))do i=a[n],i!==void 0&&(e.push(a.time),t.push.apply(t,i)),a=o[r++];while(a!==void 0);else if(i.toArray!==void 0)do i=a[n],i!==void 0&&(e.push(a.time),i.toArray(t,t.length)),a=o[r++];while(a!==void 0);else do i=a[n],i!==void 0&&(e.push(a.time),t.push(i)),a=o[r++];while(a!==void 0)}function Ete(o,e,t,n,r=30){const a=o.clone();a.name=e;const i=[];a.tracks.forEach(c=>{if(c.times.length===0)return;const u=[Math.max(t/r,c.times[0]),Math.min(n/r,c.times[c.times.length-1])];if(u[0]>u[1])return;const h=c.times.findIndex(T=>T>=u[0]),f=c.times.findLastIndex(T=>T<=u[1]),m=c.getValueSize();let g=[],A=mc(c.times)?c.times.subarray(h,f+1):c.times.slice(h,f+1),_=[],x=[],C=mc(c.values)?c.values.subarray(h*m,(f+1)*m):c.values.slice(h*m,(f+1)*m),b=[];const y=h>f;let M,R;(y||u[0]<c.times[h])&&(g=[u[0]],x=c.createInterpolant().evaluate(g[0])),u[0]!==u[1]&&(y||u[1]>c.times[f])&&(_=[u[1]],b=c.createInterpolant().evaluate(_[0])),mc(c.times)?(M=new c.times.constructor(g.length+A.length+_.length),M.set(g),M.set(A,g.length),M.set(_,g.length+A.length)):M=g.concat(A,_),mc(c.values)?(R=new c.values.constructor(x.length+C.length+b.length),R.set(x),R.set(C,x.length),R.set(b,x.length+C.length)):R=x.concat(C,b),c.times=M,c.values=R,i.push(c)});const s=i.reduce((c,u)=>Math.min(c,u.times[0]),1/0);return i.forEach(c=>c.shift(-s)),a.tracks=i,a.resetDuration(),a}function Mte(o,e=0,t=o,n=30){n<=0&&(n=30);const r=t.tracks.length,a=e/n;for(let i=0;i<r;++i){const s=t.tracks[i],c=s.ValueTypeName;if(c==="bool"||c==="string")continue;const u=o.tracks.find(function(C){return C.name===s.name&&C.ValueTypeName===c});if(u===void 0)continue;let h=0;const f=s.getValueSize();s.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(h=f/3);let m=0;const g=u.getValueSize();u.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(m=g/3);const A=s.times.length-1;let _;if(a<=s.times[0]){const C=h,b=f-h;_=ia(s.values,C,b)}else if(a>=s.times[A]){const C=A*f+h,b=C+f-h;_=ia(s.values,C,b)}else{const C=s.createInterpolant(),b=h,y=f-h;C.evaluate(a),_=ia(C.resultBuffer,b,y)}c==="quaternion"&&new Ct().fromArray(_).normalize().conjugate().toArray(_);const x=u.times.length;for(let C=0;C<x;++C){const b=C*g+m;if(c==="quaternion")Ct.multiplyQuaternionsFlat(u.values,b,_,0,u.values,b);else{const y=g-2*m;for(let M=0;M<y;++M)u.values[b+M]-=_[M]}}}return o.blendMode=2501,o}var wte=Object.freeze({__proto__:null,arraySlice:ia,convertArray:R2,flattenJSON:gB,getKeyframeOrder:mB,isTypedArray:mc,makeClipAdditive:Mte,sortedArray:I2,subclip:Ete});class hi{constructor(e,t,n,r){if(e===void 0)throw new Error("v3d.KeyframeTrack: track name is undefined");if(t===void 0||t.length===0)throw new Error("v3d.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=R2(t,this.TimeBufferType),this.values=R2(n,this.ValueBufferType),this.setInterpolation(r||this.DefaultInterpolation)}InterpolantFactoryMethodDiscrete(e){return new nb(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new Lv(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new pB(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let t;switch(e){case 2300:t=this.InterpolantFactoryMethodDiscrete;break;case 2301:t=this.InterpolantFactoryMethodLinear;break;case 2302:t=this.InterpolantFactoryMethodSmooth}if(t===void 0){const n="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0){if(e===this.DefaultInterpolation)throw new Error(n);this.setInterpolation(this.DefaultInterpolation)}return console.warn("v3d.KeyframeTrack:",n),this}return this.createInterpolant=t,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return 2300;case this.InterpolantFactoryMethodLinear:return 2301;case this.InterpolantFactoryMethodSmooth:return 2302}}getValueSize(){return this.values.length/this.times.length}shift(e){if(e!==0){const t=this.times;for(let n=0,r=t.length;n!==r;++n)t[n]+=e}return this}scale(e){if(e!==1){const t=this.times;for(let n=0,r=t.length;n!==r;++n)t[n]*=e}return this}trim(e,t){const n=this.times,r=n.length;let a=0,i=r-1;for(;a!==r&&n[a]<e;)++a;for(;i!==-1&&n[i]>t;)--i;if(++i,a!==0||i!==r){a>=i&&(i=Math.max(i,1),a=i-1);const s=this.getValueSize();this.times=ia(n,a,i),this.values=ia(this.values,a*s,i*s)}return this}validate(){let e=!0;const t=this.getValueSize();t-Math.floor(t)!=0&&(console.error("v3d.KeyframeTrack: Invalid value size in track.",this),e=!1);const n=this.times,r=this.values,a=n.length;a===0&&(console.error("v3d.KeyframeTrack: Track is empty.",this),e=!1);let i=null;for(let s=0;s!==a;s++){const c=n[s];if(typeof c=="number"&&isNaN(c)){console.error("v3d.KeyframeTrack: Time is not a valid number.",this,s,c),e=!1;break}if(i!==null&&i>c){console.error("v3d.KeyframeTrack: Out of order keys.",this,s,c,i),e=!1;break}i=c}if(r!==void 0&&mc(r))for(let s=0,c=r.length;s!==c;++s){const u=r[s];if(isNaN(u)){console.error("v3d.KeyframeTrack: Value is not a valid number.",this,s,u),e=!1;break}}return e}optimize(){const e=ia(this.times),t=ia(this.values),n=this.getValueSize(),r=this.getInterpolation()===2302,a=e.length-1;let i=1;for(let s=1;s<a;++s){let c=!1;const u=e[s];if(u!==e[s+1]&&(s!==1||u!==e[0]))if(r)c=!0;else{const h=s*n,f=h-n,m=h+n;for(let g=0;g!==n;++g){const A=t[h+g];if(A!==t[f+g]||A!==t[m+g]){c=!0;break}}}if(c){if(s!==i){e[i]=e[s];const h=s*n,f=i*n;for(let m=0;m!==n;++m)t[f+m]=t[h+m]}++i}}if(a>0){e[i]=e[a];for(let s=a*n,c=i*n,u=0;u!==n;++u)t[c+u]=t[s+u];++i}return i!==e.length?(this.times=ia(e,0,i),this.values=ia(t,0,i*n)):(this.times=e,this.values=t),this}clone(){const e=ia(this.times,0),t=ia(this.values,0),n=new this.constructor(this.name,e,t);return n.createInterpolant=this.createInterpolant,n}}hi.prototype.TimeBufferType=Float32Array,hi.prototype.ValueBufferType=Float32Array,hi.prototype.DefaultInterpolation=2301;class $h extends hi{}$h.prototype.ValueTypeName="vector";class fc extends hi{}fc.prototype.ValueTypeName="string",fc.prototype.ValueBufferType=Array,fc.prototype.DefaultInterpolation=2300,fc.prototype.InterpolantFactoryMethodLinear=void 0,fc.prototype.InterpolantFactoryMethodSmooth=void 0;class vB extends Ld{constructor(e,t,n,r){super(e,t,n,r)}interpolate_(e,t,n,r){const a=this.resultBuffer,i=this.sampleValues,s=this.valueSize,c=(n-t)/(r-t);let u=e*s;for(let h=u+s;u!==h;u+=4)Ct.slerpFlat(a,0,i,u-s,i,u,c);return a}}class bc extends hi{InterpolantFactoryMethodLinear(e){return new vB(this.times,this.values,this.getValueSize(),e)}}bc.prototype.ValueTypeName="quaternion",bc.prototype.DefaultInterpolation=2301,bc.prototype.InterpolantFactoryMethodSmooth=void 0;class Sc extends hi{}Sc.prototype.ValueTypeName="number";class sb extends hi{}sb.prototype.ValueTypeName="color";class hc extends hi{}hc.prototype.ValueTypeName="bool",hc.prototype.ValueBufferType=Array,hc.prototype.DefaultInterpolation=2300,hc.prototype.InterpolantFactoryMethodLinear=void 0,hc.prototype.InterpolantFactoryMethodSmooth=void 0;class _B{constructor(e,t,n){let r,a,i;switch(this.binding=e,this.valueSize=n,t){case"quaternion":r=this._slerp,a=this._slerpAdditive,i=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(6*n),this._workIndex=5;break;case"string":case"bool":r=this._select,a=this._select,i=this._setAdditiveIdentityOther,this.buffer=new Array(5*n);break;default:r=this._lerp,a=this._lerpAdditive,i=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(5*n)}this._mixBufferRegion=r,this._mixBufferRegionAdditive=a,this._setIdentity=i,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(e,t){const n=this.buffer,r=this.valueSize,a=e*r+r;let i=this.cumulativeWeight;if(i===0){for(let s=0;s!==r;++s)n[a+s]=n[s];i=t}else{i+=t;const s=t/i;this._mixBufferRegion(n,a,0,s,r)}this.cumulativeWeight=i}accumulateAdditive(e){const t=this.buffer,n=this.valueSize,r=n*this._addIndex;this.cumulativeWeightAdditive===0&&this._setIdentity(),this._mixBufferRegionAdditive(t,r,0,e,n),this.cumulativeWeightAdditive+=e}apply(e){const t=this.valueSize,n=this.buffer,r=e*t+t,a=this.cumulativeWeight,i=this.cumulativeWeightAdditive,s=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,a<1){const c=t*this._origIndex;this._mixBufferRegion(n,r,c,1-a,t)}i>0&&this._mixBufferRegionAdditive(n,r,this._addIndex*t,1,t);for(let c=t,u=t+t;c!==u;++c)if(n[c]!==n[c+t]){s.setValue(n,r);break}}saveOriginalState(){const e=this.binding,t=this.buffer,n=this.valueSize,r=n*this._origIndex;e.getValue(t,r);for(let a=n,i=r;a!==i;++a)t[a]=t[r+a%n];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const e=3*this.valueSize;this.binding.setValue(this.buffer,e)}_setAdditiveIdentityNumeric(){const e=this._addIndex*this.valueSize,t=e+this.valueSize;for(let n=e;n<t;n++)this.buffer[n]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const e=this._origIndex*this.valueSize,t=this._addIndex*this.valueSize;for(let n=0;n<this.valueSize;n++)this.buffer[t+n]=this.buffer[e+n]}_select(e,t,n,r,a){if(r>=.5)for(let i=0;i!==a;++i)e[t+i]=e[n+i]}_slerp(e,t,n,r){Ct.slerpFlat(e,t,e,t,e,n,r)}_slerpAdditive(e,t,n,r,a){const i=this._workIndex*a;Ct.multiplyQuaternionsFlat(e,i,e,t,e,n),Ct.slerpFlat(e,t,e,t,e,i,r)}_lerp(e,t,n,r,a){const i=1-r;for(let s=0;s!==a;++s){const c=t+s;e[c]=e[c]*i+e[n+s]*r}}_lerpAdditive(e,t,n,r,a){for(let i=0;i!==a;++i){const s=t+i;e[s]=e[s]+e[n+i]*r}}}const Tte=new RegExp("[\\[\\]\\.]","g"),lb="[^\\[\\]\\.]",Rte="[^"+"\\[\\]\\.".replace("\\.","")+"]";/((?:WC+[\/:])*)/.source.replace("WC",lb);const Ite=/(WCOD+)?/.source.replace("WCOD",Rte),Lte=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",lb),Bte=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",lb),Pte=new RegExp("^"+Ite+Lte+Bte+"$"),Nte=["material","materials","bones","map"];class Dte{constructor(e,t,n){const r=n||Ht.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,r)}getValue(e,t){this.bind();const n=this._targetGroup.nCachedObjects_,r=this._bindings[n];r!==void 0&&r.getValue(e,t)}setValue(e,t){const n=this._bindings;for(let r=this._targetGroup.nCachedObjects_,a=n.length;r!==a;++r)n[r].setValue(e,t)}bind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].bind()}unbind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].unbind()}}class Ht{constructor(e,t,n){this.path=t,this.parsedPath=n||Ht.parseTrackName(t),this.node=Ht.findNode(e,this.parsedPath.nodeName)||e,this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,t,n){return e&&e.isAnimationObjectGroup?new Ht.Composite(e,t,n):new Ht(e,t,n)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(Tte,"")}static parseTrackName(e){const t=Pte.exec(e);if(t===null)throw new Error("PropertyBinding: Cannot parse trackName: "+e);const n={nodeName:t[1],objectName:t[2],objectIndex:t[3],propertyName:t[4],propertyIndex:t[5]},r=n.nodeName&&n.nodeName.lastIndexOf(".");if(r!==void 0&&r!==-1){const a=n.nodeName.substring(r+1);Nte.indexOf(a)!==-1&&(n.nodeName=n.nodeName.substring(0,r),n.objectName=a)}if(n.propertyName===null||n.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return n}static findNode(e,t){if(t===void 0||t===""||t==="."||t===-1||t===e.name||t===e.uuid)return e;if(e.skeleton){const n=e.skeleton.getBoneByName(t);if(n!==void 0)return n}if(e.children){const n=function(a){for(let i=0;i<a.length;i++){const s=a[i];if(s.name===t||s.uuid===t)return s;const c=n(s.children);if(c)return c}return null},r=n(e.children);if(r)return r}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,t){e[t]=this.targetObject[this.propertyName]}_getValue_array(e,t){const n=this.resolvedProperty;for(let r=0,a=n.length;r!==a;++r)e[t++]=n[r]}_getValue_arrayElement(e,t){e[t]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,t){this.resolvedProperty.toArray(e,t)}_setValue_direct(e,t){this.targetObject[this.propertyName]=e[t]}_setValue_direct_setNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(e,t){const n=this.resolvedProperty;for(let r=0,a=n.length;r!==a;++r)n[r]=e[t++]}_setValue_array_setNeedsUpdate(e,t){const n=this.resolvedProperty;for(let r=0,a=n.length;r!==a;++r)n[r]=e[t++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(e,t){const n=this.resolvedProperty;for(let r=0,a=n.length;r!==a;++r)n[r]=e[t++];if(this.targetObject.matrixWorldNeedsUpdate=!0,this.propertyName==="morphTargetInfluences"){const r=this.targetObject.getAuxClippingMeshes();for(let a=0;a<r.length;a++){const i=r[a];if(i.morphTargetInfluences){const s=this.targetObject.morphTargetInfluences;for(let c=0;c<s.length;c++){const u=s[c];i.morphTargetInfluences[c]=u}}}}}_setValue_arrayElement(e,t){this.resolvedProperty[this.propertyIndex]=e[t]}_setValue_arrayElement_setNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,t){this.resolvedProperty.fromArray(e,t)}_setValue_fromArray_setNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,t){this.bind(),this.getValue(e,t)}_setValue_unbound(e,t){this.bind(),this.setValue(e,t)}bind(){let e=this.node;const t=this.parsedPath,n=t.objectName,r=t.propertyName;let a=t.propertyIndex;if(e||(e=Ht.findNode(this.rootNode,t.nodeName)||this.rootNode,this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e)return void console.error("v3d.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");if(n){let u=t.objectIndex;switch(n){case"materials":if(!e.material)return void console.error("v3d.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!e.material.materials)return void console.error("v3d.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);e=e.material.materials;break;case"bones":if(!e.skeleton)return void console.error("v3d.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);e=e.skeleton.bones;for(let h=0;h<e.length;h++)if(e[h].name===u){u=h;break}break;case"map":if("map"in e){e=e.map;break}if(!e.material)return void console.error("v3d.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!e.material.map)return void console.error("v3d.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);e=e.material.map;break;case"constraints":if(e.constraints===void 0)return void console.error("v3d.PropertyBinding: Can not bind to constraints of node undefined.",this);e=e.constraints,u=u.replace(/"/g,"");for(let h=0;h<e.length;h++)if(e[h].name===u){u=h;break}break;default:if(e[n]===void 0)return void console.error("v3d.PropertyBinding: Can not bind to objectName of node undefined.",this);e=e[n]}if(u!==void 0){if(e[u]===void 0)return void console.error("v3d.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);e=e[u]}}let i=e[r];if(i===void 0){const u=t.nodeName;return void console.error("v3d.PropertyBinding: Trying to update property for track: "+u+"."+r+" but it wasn't found.",e)}let s=this.Versioning.None;this.targetObject=e,e.isMeshNodeMaterial||e.needsUpdate===void 0?e.matrixWorldNeedsUpdate!==void 0&&(s=this.Versioning.MatrixWorldNeedsUpdate):s=this.Versioning.NeedsUpdate;let c=this.BindingType.Direct;if(a!==void 0){if(r==="morphTargetInfluences"){if(!e.geometry)return void console.error("v3d.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!e.geometry.morphAttributes)return void console.error("v3d.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);e.morphTargetDictionary[a]!==void 0&&(a=e.morphTargetDictionary[a]),this.propertyName=r}else if(r=="nodeValue"){if(a=a.replace(/"/g,""),!e.nodeValueMap)return void console.error("v3d.PropertyBinding: Trying to animate nodes in non-node material",this);if(a=e.nodeValueMap[a],a===void 0)return void console.error("v3d.PropertyBinding: Animated node not found ",this)}if(c=this.BindingType.ArrayElement,r=="nodeRGB"){if(a=a.replace(/"/g,""),!e.nodeRGBMap)return void console.error("v3d.PropertyBinding: Trying to animate nodes in non-node material",this);if(a=e.nodeRGBMap[a],a===void 0)return void console.error("v3d.PropertyBinding: Animated node not found ",this);c=this.BindingType.HasFromToArray,i=e.nodeRGB[a]}this.resolvedProperty=i,this.propertyIndex=a}else i.fromArray!==void 0&&i.toArray!==void 0?(c=this.BindingType.HasFromToArray,this.resolvedProperty=i):Array.isArray(i)?(c=this.BindingType.EntireArray,this.resolvedProperty=i,r==="morphTargetInfluences"&&(this.propertyName=r)):this.propertyName=r;this.getValue=this.GetterByBindingType[c],this.setValue=this.SetterByBindingTypeAndVersioning[c][s]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}Ht.Composite=Dte,Ht.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Ht.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},Ht.prototype.GetterByBindingType=[Ht.prototype._getValue_direct,Ht.prototype._getValue_array,Ht.prototype._getValue_arrayElement,Ht.prototype._getValue_toArray],Ht.prototype.SetterByBindingTypeAndVersioning=[[Ht.prototype._setValue_direct,Ht.prototype._setValue_direct_setNeedsUpdate,Ht.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[Ht.prototype._setValue_array,Ht.prototype._setValue_array_setNeedsUpdate,Ht.prototype._setValue_array_setMatrixWorldNeedsUpdate],[Ht.prototype._setValue_arrayElement,Ht.prototype._setValue_arrayElement_setNeedsUpdate,Ht.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[Ht.prototype._setValue_fromArray,Ht.prototype._setValue_fromArray_setNeedsUpdate,Ht.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class Ote{constructor(){this.isAnimationObjectGroup=!0,this.uuid=Wo(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;const e={};this._indicesByUUID=e;for(let n=0,r=arguments.length;n!==r;++n)e[arguments[n].uuid]=n;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};const t=this;this.stats={objects:{get total(){return t._objects.length},get inUse(){return this.total-t.nCachedObjects_}},get bindingsPerObject(){return t._bindings.length}}}add(){const e=this._objects,t=this._indicesByUUID,n=this._paths,r=this._parsedPaths,a=this._bindings,i=a.length;let s,c=e.length,u=this.nCachedObjects_;for(let h=0,f=arguments.length;h!==f;++h){const m=arguments[h],g=m.uuid;let A=t[g];if(A===void 0){A=c++,t[g]=A,e.push(m);for(let _=0,x=i;_!==x;++_)a[_].push(new Ht(m,n[_],r[_]))}else if(A<u){s=e[A];const _=--u,x=e[_];t[x.uuid]=A,e[A]=x,t[g]=_,e[_]=m;for(let C=0,b=i;C!==b;++C){const y=a[C],M=y[_];let R=y[A];y[A]=M,R===void 0&&(R=new Ht(m,n[C],r[C])),y[_]=R}}else e[A]!==s&&console.error("v3d.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=u}remove(){const e=this._objects,t=this._indicesByUUID,n=this._bindings,r=n.length;let a=this.nCachedObjects_;for(let i=0,s=arguments.length;i!==s;++i){const c=arguments[i],u=c.uuid,h=t[u];if(h!==void 0&&h>=a){const f=a++,m=e[f];t[m.uuid]=h,e[h]=m,t[u]=f,e[f]=c;for(let g=0,A=r;g!==A;++g){const _=n[g],x=_[f],C=_[h];_[h]=x,_[f]=C}}}this.nCachedObjects_=a}uncache(){const e=this._objects,t=this._indicesByUUID,n=this._bindings,r=n.length;let a=this.nCachedObjects_,i=e.length;for(let s=0,c=arguments.length;s!==c;++s){const u=arguments[s].uuid,h=t[u];if(h!==void 0)if(delete t[u],h<a){const f=--a,m=e[f],g=--i,A=e[g];t[m.uuid]=h,e[h]=m,t[A.uuid]=f,e[f]=A,e.pop();for(let _=0,x=r;_!==x;++_){const C=n[_],b=C[f],y=C[g];C[h]=b,C[f]=y,C.pop()}}else{const f=--i,m=e[f];f>0&&(t[m.uuid]=h),e[h]=m,e.pop();for(let g=0,A=r;g!==A;++g){const _=n[g];_[h]=_[f],_.pop()}}}this.nCachedObjects_=a}subscribe_(e,t){const n=this._bindingsIndicesByPath;let r=n[e];const a=this._bindings;if(r!==void 0)return a[r];const i=this._paths,s=this._parsedPaths,c=this._objects,u=c.length,h=this.nCachedObjects_,f=new Array(u);r=a.length,n[e]=r,i.push(e),s.push(t),a.push(f);for(let m=h,g=c.length;m!==g;++m){const A=c[m];f[m]=new Ht(A,e,t)}return f}unsubscribe_(e){const t=this._bindingsIndicesByPath,n=t[e];if(n!==void 0){const r=this._paths,a=this._parsedPaths,i=this._bindings,s=i.length-1,c=i[s];t[e[s]]=n,i[n]=c,i.pop(),a[n]=a[s],a.pop(),r[n]=r[s],r.pop()}}}class Fte{constructor(e,t,n=null,r=t.blendMode){this._mixer=e,this._clip=t,this._localRoot=n,this.blendMode=r;const a=t.tracks,i=a.length,s=new Array(i),c={endingStart:2400,endingEnd:2400};for(let u=0;u!==i;++u){const h=a[u].createInterpolant(null);s[u]=h,h.settings=c}this._interpolantSettings=c,this._interpolants=s,this._propertyBindings=new Array(i),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=2201,this._loopCount=-1,this._pingIsEven=!0,this._startTime=null,this.time=0,this.timeStart=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this._pingIsEven=!0,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&this.timeScale!==0&&this._startTime===null&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(e){return this._startTime=e,this}setLoop(e,t){return this.loop=e,this.repetitions=t,this}setEffectiveWeight(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(e){return this._scheduleFading(e,0,1)}fadeOut(e){return this._scheduleFading(e,1,0)}crossFadeFrom(e,t,n){if(e.fadeOut(t),this.fadeIn(t),n){const r=this._clip.duration,a=e._clip.duration,i=a/r,s=r/a;e.warp(1,i,t),this.warp(s,1,t)}return this}crossFadeTo(e,t,n){return e.crossFadeFrom(this,t,n)}stopFading(){const e=this._weightInterpolant;return e!==null&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}setEffectiveTimeScale(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(e){return this.timeScale=this._clip.duration/e,this.stopWarping()}syncWith(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()}halt(e){return this.warp(this._effectiveTimeScale,0,e)}warp(e,t,n){const r=this._mixer,a=r.time,i=this.timeScale;let s=this._timeScaleInterpolant;s===null&&(s=r._lendControlInterpolant(),this._timeScaleInterpolant=s);const c=s.parameterPositions,u=s.sampleValues;return c[0]=a,c[1]=a+n,u[0]=e/i,u[1]=t/i,this}stopWarping(){const e=this._timeScaleInterpolant;return e!==null&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(e,t,n,r){if(!this.enabled)return void this._updateWeight(e);const a=this._startTime;if(a!==null){const c=(e-a)*n;if(c<0||n===0)return;this._startTime=null,t=n*c}t*=this._updateTimeScale(e);const i=this._updateTime(t),s=this._updateWeight(e);if(s>0){const c=this._interpolants,u=this._propertyBindings;if(this.blendMode===2501)for(let h=0,f=c.length;h!==f;++h)c[h].evaluate(i),u[h].accumulateAdditive(s);else for(let h=0,f=c.length;h!==f;++h)c[h].evaluate(i),u[h].accumulate(r,s)}}_updateWeight(e){let t=0;if(this.enabled){t=this.weight;const n=this._weightInterpolant;if(n!==null){const r=n.evaluate(e)[0];t*=r,e>n.parameterPositions[1]&&(this.stopFading(),r===0&&(this.enabled=!1))}}return this._effectiveWeight=t,t}_updateTimeScale(e){let t=0;if(!this.paused){t=this.timeScale;const n=this._timeScaleInterpolant;n!==null&&(t*=n.evaluate(e)[0],e>n.parameterPositions[1]&&(this.stopWarping(),t===0?this.paused=!0:this.timeScale=t))}return this._effectiveTimeScale=t,t}_loopIsPing(e){return this.loop!==2202||e==-1?!0:!(1&e)===this._pingIsEven}_updateTime(e){if(e===0)return this.time;if(this.loop!==2200&&this.repetitions<=0)return this.clampWhenFinished?this.paused=!0:this.enabled=!1,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1}),this.time;var t=this.timeStart,n=Math.max(t,this._clip.duration),r=n-t;if(this.loop===2200)return this.time+=e,this._loopCount===-1&&(this._loopCount=0,this._setEndings(!0,!0,!1)),(this.time<t||this.time>n)&&(this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=Ft(this.time,t,n),this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})),this.time;var a=this.loop===2202,i=this._loopIsPing(this._loopCount)?1:-1;this.time+=i*e;var s=this.time<t||this.time>n,c=!1;if(this._loopCount===-1&&(c=s,this._loopCount=c?-1:0,this._pingIsEven=!c,e>=0?this._setEndings(!0,this.repetitions===0,a):this._setEndings(this.repetitions===0,!0,a)),s){var u=Math.floor((this.time-t)/r);this._loopCount+=Math.abs(u);var h=this.repetitions-this._loopCount;if(h<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=Ft(this.time,t,n),this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1});else{if(h==1){var f=e<0;this._setEndings(f,!f,a)}else this._setEndings(!1,!1,a);var m=(this.time-t)%r;m<0&&(m+=r),this.time=a?n-m:m+t,c||this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:u})}}return this.time}_setEndings(e,t,n){const r=this._interpolantSettings;n?(r.endingStart=2401,r.endingEnd=2401):(r.endingStart=e?this.zeroSlopeAtStart?2401:2400:2402,r.endingEnd=t?this.zeroSlopeAtEnd?2401:2400:2402)}_scheduleFading(e,t,n){const r=this._mixer,a=r.time;let i=this._weightInterpolant;i===null&&(i=r._lendControlInterpolant(),this._weightInterpolant=i);const s=i.parameterPositions,c=i.sampleValues;return s[0]=a,c[0]=t,s[1]=a+e,c[1]=n,this}}class jg{constructor(e,t=-1,n,r=2500){this.name=e,this.tracks=n,this.duration=t,this.blendMode=r,this.uuid=Wo(),this.duration<0&&this.resetDuration()}static parse(e){const t=[],n=e.tracks,r=1/(e.fps||1);for(let i=0,s=n.length;i!==s;++i)t.push(zte(n[i]).scale(r));const a=new this(e.name,e.duration,t,e.blendMode);return a.uuid=e.uuid,a}static CreateFromMorphTargetSequence(e,t,n,r){const a=t.length,i=[];for(let s=0;s<a;s++){let c=[],u=[];c.push((s+a-1)%a,s,(s+1)%a),u.push(0,1,0);const h=mB(c);c=I2(c,1,h),u=I2(u,1,h),r||c[0]!==0||(c.push(a),u.push(u[0])),i.push(new Sc(".morphTargetInfluences["+t[s].name+"]",c,u).scale(1/n))}return new this(e,-1,i)}static findByName(e,t){let n=e;if(!Array.isArray(e)){const r=e;n=r.geometry&&r.geometry.animations||r.animations}for(let r=0;r<n.length;r++)if(n[r].name===t)return n[r];return null}static CreateClipsFromMorphTargetSequences(e,t,n){const r={},a=/^([\w-]*?)([\d]+)$/;for(let s=0,c=e.length;s<c;s++){const u=e[s],h=u.name.match(a);if(h&&h.length>1){const f=h[1];let m=r[f];m||(r[f]=m=[]),m.push(u)}}const i=[];for(const s in r)i.push(this.CreateFromMorphTargetSequence(s,r[s],t,n));return i}resetDuration(){let e=0;for(let t=0,n=this.tracks.length;t!==n;++t){const r=this.tracks[t];e=Math.max(e,r.times[r.times.length-1])}return this.duration=e,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let e=!0;for(let t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){const e=[];for(let t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new this.constructor(this.name,this.duration,e,this.blendMode)}}function Ute(o){switch(o.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return Sc;case"vector":case"vector2":case"vector3":case"vector4":return $h;case"color":return sb;case"quaternion":return bc;case"bool":case"boolean":return hc;case"string":return fc}throw new Error("v3d.KeyframeTrack: Unsupported typeName: "+o)}function zte(o){if(o.type===void 0)throw new Error("v3d.KeyframeTrack: track type undefined, can not parse");const e=Ute(o.type);if(o.times===void 0){const t=[],n=[];gB(o.keys,t,n,"value"),o.times=t,o.values=n}return e.parse!==void 0?e.parse(o):new e(o.name,o.times,o.values,o.interpolation)}const Vte=new Float32Array(1);class AB extends oo{constructor(e){super(),this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(e,t){const n=e._localRoot||this._root,r=e._clip.tracks,a=r.length,i=e._propertyBindings,s=e._interpolants,c=n.uuid,u=this._bindingsByRootAndName;let h=u[c];h===void 0&&(h={},u[c]=h);for(let f=0;f!==a;++f){const m=r[f],g=m.name;let A=h[g];if(A!==void 0)++A.referenceCount,i[f]=A;else{if(A=i[f],A!==void 0){A._cacheIndex===null&&(++A.referenceCount,this._addInactiveBinding(A,c,g));continue}const _=t&&t._propertyBindings[f].binding.parsedPath;A=new _B(Ht.create(n,g,_),m.ValueTypeName,m.getValueSize()),++A.referenceCount,this._addInactiveBinding(A,c,g),i[f]=A}s[f].resultBuffer=A.buffer}}_activateAction(e){if(!this._isActiveAction(e)){if(e._cacheIndex===null){const n=(e._localRoot||this._root).uuid,r=e._clip.uuid,a=this._actionsByClip[r];this._bindAction(e,a&&a.knownActions[0]),this._addInactiveAction(e,r,n)}const t=e._propertyBindings;for(let n=0,r=t.length;n!==r;++n){const a=t[n];a.useCount++==0&&(this._lendBinding(a),a.saveOriginalState())}this._lendAction(e)}}_deactivateAction(e){if(this._isActiveAction(e)){const t=e._propertyBindings;for(let n=0,r=t.length;n!==r;++n){const a=t[n];--a.useCount==0&&(a.restoreOriginalState(),this._takeBackBinding(a))}this._takeBackAction(e)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}}_isActiveAction(e){const t=e._cacheIndex;return t!==null&&t<this._nActiveActions}_addInactiveAction(e,t,n){const r=this._actions,a=this._actionsByClip;let i=a[t];if(i===void 0)i={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,a[t]=i;else{const s=i.knownActions;e._byClipCacheIndex=s.length,s.push(e)}e._cacheIndex=r.length,r.push(e),i.actionByRoot[n]=e}_removeInactiveAction(e){const t=this._actions,n=t[t.length-1],r=e._cacheIndex;n._cacheIndex=r,t[r]=n,t.pop(),e._cacheIndex=null;const a=e._clip.uuid,i=this._actionsByClip,s=i[a],c=s.knownActions,u=c[c.length-1],h=e._byClipCacheIndex;u._byClipCacheIndex=h,c[h]=u,c.pop(),e._byClipCacheIndex=null,delete s.actionByRoot[(e._localRoot||this._root).uuid],c.length===0&&delete i[a],this._removeInactiveBindingsForAction(e)}_removeInactiveBindingsForAction(e){const t=e._propertyBindings;for(let n=0,r=t.length;n!==r;++n){const a=t[n];--a.referenceCount==0&&this._removeInactiveBinding(a)}}_lendAction(e){const t=this._actions,n=e._cacheIndex,r=this._nActiveActions++,a=t[r];e._cacheIndex=r,t[r]=e,a._cacheIndex=n,t[n]=a}_takeBackAction(e){const t=this._actions,n=e._cacheIndex,r=--this._nActiveActions,a=t[r];e._cacheIndex=r,t[r]=e,a._cacheIndex=n,t[n]=a}_addInactiveBinding(e,t,n){const r=this._bindingsByRootAndName,a=this._bindings;let i=r[t];i===void 0&&(i={},r[t]=i),i[n]=e,e._cacheIndex=a.length,a.push(e)}_removeInactiveBinding(e){const t=this._bindings,n=e.binding,r=n.rootNode.uuid,a=n.path,i=this._bindingsByRootAndName,s=i[r],c=t[t.length-1],u=e._cacheIndex;c._cacheIndex=u,t[u]=c,t.pop(),delete s[a],Object.keys(s).length===0&&delete i[r]}_lendBinding(e){const t=this._bindings,n=e._cacheIndex,r=this._nActiveBindings++,a=t[r];e._cacheIndex=r,t[r]=e,a._cacheIndex=n,t[n]=a}_takeBackBinding(e){const t=this._bindings,n=e._cacheIndex,r=--this._nActiveBindings,a=t[r];e._cacheIndex=r,t[r]=e,a._cacheIndex=n,t[n]=a}_lendControlInterpolant(){const e=this._controlInterpolants,t=this._nActiveControlInterpolants++;let n=e[t];return n===void 0&&(n=new Lv(new Float32Array(2),new Float32Array(2),1,Vte),n.__cacheIndex=t,e[t]=n),n}_takeBackControlInterpolant(e){const t=this._controlInterpolants,n=e.__cacheIndex,r=--this._nActiveControlInterpolants,a=t[r];e.__cacheIndex=r,t[r]=e,a.__cacheIndex=n,t[n]=a}clipAction(e,t,n){const r=t||this._root,a=r.uuid;let i=typeof e=="string"?jg.findByName(r,e):e;const s=i!==null?i.uuid:e,c=this._actionsByClip[s];let u=null;if(n===void 0&&(n=i!==null?i.blendMode:2500),c!==void 0){const f=c.actionByRoot[a];if(f!==void 0&&f.blendMode===n)return f;u=c.knownActions[0],i===null&&(i=u._clip)}if(i===null)return null;const h=new Fte(this,i,t,n);return this._bindAction(h,u),this._addInactiveAction(h,s,a),h}existingAction(e,t){const n=t||this._root,r=n.uuid,a=typeof e=="string"?jg.findByName(n,e):e,i=a?a.uuid:e,s=this._actionsByClip[i];return s!==void 0&&s.actionByRoot[r]||null}stopAllAction(){const e=this._actions;for(let t=this._nActiveActions-1;t>=0;--t)e[t].stop();return this}update(e){e*=this.timeScale;const t=this._actions,n=this._nActiveActions,r=this.time+=e,a=Math.sign(e),i=this._accuIndex^=1;for(let u=0;u!==n;++u)t[u]._update(r,e,a,i);const s=this._bindings,c=this._nActiveBindings;for(let u=0;u!==c;++u)s[u].apply(i);return this}setTime(e){this.time=0;for(let t=0;t<this._actions.length;t++)this._actions[t].time=0;return this.update(e)}getRoot(){return this._root}uncacheClip(e){const t=this._actions,n=e.uuid,r=this._actionsByClip,a=r[n];if(a!==void 0){const i=a.knownActions;for(let s=0,c=i.length;s!==c;++s){const u=i[s];this._deactivateAction(u);const h=u._cacheIndex,f=t[t.length-1];u._cacheIndex=null,u._byClipCacheIndex=null,f._cacheIndex=h,t[h]=f,t.pop(),this._removeInactiveBindingsForAction(u)}delete r[n]}}uncacheRoot(e){const t=e.uuid,n=this._actionsByClip;for(const a in n){const i=n[a].actionByRoot[t];i!==void 0&&(this._deactivateAction(i),this._removeInactiveAction(i))}const r=this._bindingsByRootAndName[t];if(r!==void 0)for(const a in r){const i=r[a];i.restoreOriginalState(),this._removeInactiveBinding(i)}}uncacheAction(e,t){const n=this.existingAction(e,t);n!==null&&(this._deactivateAction(n),this._removeInactiveAction(n))}}class Pv{constructor(e){this.value=e}clone(){return new Pv(this.value.clone===void 0?this.value:this.value.clone())}}let kte=0;class Gte extends oo{constructor(){super(),this.isUniformsGroup=!0,Object.defineProperty(this,"id",{value:kte++}),this.name="",this.usage=35044,this.uniforms=[]}add(e){return this.uniforms.push(e),this}remove(e){const t=this.uniforms.indexOf(e);return t!==-1&&this.uniforms.splice(t,1),this}setName(e){return this.name=e,this}setUsage(e){return this.usage=e,this}dispose(){return this.dispatchEvent({type:"dispose"}),this}copy(e){this.name=e.name,this.usage=e.usage;const t=e.uniforms;this.uniforms.length=0;for(let n=0,r=t.length;n<r;n++)this.uniforms.push(t[n].clone());return this}clone(){return new this.constructor().copy(this)}}class Qte extends mt{constructor(){super(),this.isInstancedBufferGeometry=!0,this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(e){return super.copy(e),this.instanceCount=e.instanceCount,this}}class Hte extends mp{constructor(e,t,n=1){super(e,t),this.isInstancedInterleavedBuffer=!0,this.meshPerAttribute=n}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}clone(e){const t=super.clone(e);return t.meshPerAttribute=this.meshPerAttribute,t}}class Wte{constructor(e,t,n,r,a){this.isGLBufferAttribute=!0,this.buffer=e,this.type=t,this.itemSize=n,this.elementSize=r,this.count=a,this.version=0}set needsUpdate(e){e===!0&&this.version++}setBuffer(e){return this.buffer=e,this}setType(e,t){return this.type=e,this.elementSize=t,this}setItemSize(e){return this.itemSize=e,this}setCount(e){return this.count=e,this}}class Yte{constructor(e=1,t=0,n=0){return this.radius=e,this.theta=t,this.y=n,this}set(e,t,n){return this.radius=e,this.theta=t,this.y=n,this}copy(e){return this.radius=e.radius,this.theta=e.theta,this.y=e.y,this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,n){return this.radius=Math.sqrt(e*e+n*n),this.theta=Math.atan2(e,n),this.y=t,this}clone(){return new this.constructor().copy(this)}}const Cw=new Ee;class jte{constructor(e=new Ee(1/0,1/0),t=new Ee(-1/0,-1/0)){this.isBox2=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromPoints(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const n=Cw.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(e){return this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y)}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return Cw.copy(e).clamp(this.min,this.max).sub(e).length()}intersect(e){return this.min.max(e.min),this.max.min(e.max),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const Ew=new B,m0=new B;class ri{constructor(e=new B,t=new B){this.start=e,this.end=t}set(e,t){return this.start.copy(e),this.end.copy(t),this}copy(e){return this.start.copy(e.start),this.end.copy(e.end),this}getCenter(e){return e.addVectors(this.start,this.end).multiplyScalar(.5)}delta(e){return e.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(e,t){return this.delta(t).multiplyScalar(e).add(this.start)}closestPointToPointParameter(e,t){Ew.subVectors(e,this.start),m0.subVectors(this.end,this.start);const n=m0.dot(m0);let r=m0.dot(Ew)/n;return t&&(r=Ft(r,0,1)),r}closestPointToPoint(e,t,n){const r=this.closestPointToPointParameter(e,t);return this.delta(n).multiplyScalar(r).add(this.start)}applyMatrix4(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this}equals(e){return e.start.equals(this.start)&&e.end.equals(this.end)}clone(){return new this.constructor().copy(this)}}const Mw=new B;class xB extends Tt{constructor(e,t){super(),this.light=e,this.matrixAutoUpdate=!1,this.color=t,this.type="SpotLightHelper";const n=new mt,r=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let i=0,s=1,c=32;i<c;i++,s++){const u=i/c*Math.PI*2,h=s/c*Math.PI*2;r.push(Math.cos(u),Math.sin(u),1,Math.cos(h),Math.sin(h),1)}n.setAttribute("position",new ut(r,3));const a=new gr({fog:!1,toneMapped:!1});this.cone=new jo(n,a),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),this.parent?(this.parent.updateWorldMatrix(!0),this.matrix.copy(this.parent.matrixWorld).invert().multiply(this.light.matrixWorld)):this.matrix.copy(this.light.matrixWorld),this.matrixWorld.copy(this.light.matrixWorld);const e=this.light.distance?this.light.distance:1e3,t=e*Math.tan(this.light.angle);this.cone.scale.set(t,t,e),Mw.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(Mw),this.color!==void 0?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}const js=new B,g0=new Ve,KA=new Ve;class yB extends jo{constructor(e){const t=bB(e),n=new mt,r=[],a=[],i=new Qe(0,0,1),s=new Qe(0,1,0);for(let c=0;c<t.length;c++){const u=t[c];u.parent&&u.parent.isBone&&(r.push(0,0,0),r.push(0,0,0),a.push(i.r,i.g,i.b),a.push(s.r,s.g,s.b))}n.setAttribute("position",new ut(r,3)),n.setAttribute("color",new ut(a,3)),super(n,new gr({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0})),this.isSkeletonHelper=!0,this.type="SkeletonHelper",this.root=e,this.bones=t,this.matrixAutoUpdate=!1}updateMatrixWorld(e){this.parent?this.matrix.copy(this.parent.matrixWorld).invert().multiply(this.root.matrixWorld):this.matrix.copy(this.root.matrixWorld);const t=this.bones,n=this.geometry,r=n.getAttribute("position");KA.copy(this.root.matrixWorld).invert();for(let a=0,i=0;a<t.length;a++){const s=t[a];s.parent&&s.parent.isBone&&(g0.multiplyMatrices(KA,s.matrixWorld),js.setFromMatrixPosition(g0),r.setXYZ(i,js.x,js.y,js.z),g0.multiplyMatrices(KA,s.parent.matrixWorld),js.setFromMatrixPosition(g0),r.setXYZ(i+1,js.x,js.y,js.z),i+=2)}n.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(e)}dispose(){this.geometry.dispose(),this.material.dispose()}}function bB(o){const e=[];o.isBone===!0&&e.push(o);for(let t=0;t<o.children.length;t++)e.push.apply(e,bB(o.children[t]));return e}class SB extends Mt{constructor(e,t,n){super(new j5(t,4,3),new hr({wireframe:!0,fog:!1,toneMapped:!1})),this.light=e,this.color=n,this.type="PointLightHelper",this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.parent?(this.parent.updateWorldMatrix(!0),this.matrix.copy(this.parent.matrixWorld).invert().multiply(this.light.matrixWorld)):this.matrix.copy(this.light.matrixWorld),this.color!==void 0?this.material.color.set(this.color):this.material.color.copy(this.light.color)}}const Xte=new B,ww=new Qe,Tw=new Qe;class qte extends Tt{constructor(e,t,n){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=n,this.type="HemisphereLightHelper";const r=new Y5(t);r.rotateY(.5*Math.PI),this.material=new hr({wireframe:!0,fog:!1,toneMapped:!1}),this.color===void 0&&(this.material.vertexColors=!0);const a=r.getAttribute("position"),i=new Float32Array(3*a.count);r.setAttribute("color",new $e(i,3)),this.add(new Mt(r,this.material)),this.update()}dispose(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}update(){const e=this.children[0];if(this.color!==void 0)this.material.color.set(this.color);else{const t=e.geometry.getAttribute("color");ww.copy(this.light.color),Tw.copy(this.light.groundColor);for(let n=0,r=t.count;n<r;n++){const a=n<r/2?ww:Tw;t.setXYZ(n,a.r,a.g,a.b)}t.needsUpdate=!0}this.light.updateWorldMatrix(!0,!1),e.lookAt(Xte.setFromMatrixPosition(this.light.matrixWorld).negate())}}class Zte extends jo{constructor(e=10,t=10,n=4473924,r=8947848){n=new Qe(n),r=new Qe(r);const a=t/2,i=e/t,s=e/2,c=[],u=[];for(let f=0,m=0,g=-s;f<=t;f++,g+=i){c.push(-s,0,g,s,0,g),c.push(g,0,-s,g,0,s);const A=f===a?n:r;A.toArray(u,m),m+=3,A.toArray(u,m),m+=3,A.toArray(u,m),m+=3,A.toArray(u,m),m+=3}const h=new mt;h.setAttribute("position",new ut(c,3)),h.setAttribute("color",new ut(u,3)),super(h,new gr({vertexColors:!0,toneMapped:!1})),this.type="GridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}class Kte extends jo{constructor(e=10,t=16,n=8,r=64,a=4473924,i=8947848){a=new Qe(a),i=new Qe(i);const s=[],c=[];if(t>1)for(let h=0;h<t;h++){const f=h/t*(2*Math.PI),m=Math.sin(f)*e,g=Math.cos(f)*e;s.push(0,0,0),s.push(m,0,g);const A=1&h?a:i;c.push(A.r,A.g,A.b),c.push(A.r,A.g,A.b)}for(let h=0;h<n;h++){const f=1&h?a:i,m=e-e/n*h;for(let g=0;g<r;g++){let A=g/r*(2*Math.PI),_=Math.sin(A)*m,x=Math.cos(A)*m;s.push(_,0,x),c.push(f.r,f.g,f.b),A=(g+1)/r*(2*Math.PI),_=Math.sin(A)*m,x=Math.cos(A)*m,s.push(_,0,x),c.push(f.r,f.g,f.b)}}const u=new mt;u.setAttribute("position",new ut(s,3)),u.setAttribute("color",new ut(c,3)),super(u,new gr({vertexColors:!0,toneMapped:!1})),this.type="PolarGridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}class L2 extends jo{constructor(e,t=16776960){const n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),r=new mt;r.setIndex(new $e(n,1)),r.setAttribute("position",new ut([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3)),super(r,new gr({color:t,toneMapped:!1})),this.box=e,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(e){const t=this.box;t.isEmpty()||(t.getCenter(this.position),t.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(e))}dispose(){this.geometry.dispose(),this.material.dispose()}}const Rw=new B,v0=new B,Iw=new B;class CB extends Tt{constructor(e,t,n){super(),this.light=e,this.matrixAutoUpdate=!1,this.color=n,this.type="DirectionalLightHelper",t===void 0&&(t=1);let r=new mt;r.setAttribute("position",new ut([-t,t,0,t,t,0,t,-t,0,-t,-t,0,-t,t,0],3));const a=new gr({fog:!1,toneMapped:!1});this.lightPlane=new vi(r,a),this.add(this.lightPlane),r=new mt,r.setAttribute("position",new ut([0,0,0,0,0,1],3)),this.targetLine=new vi(r,a),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),this.parent?(this.parent.updateWorldMatrix(!0),this.matrix.copy(this.parent.matrixWorld).invert().multiply(this.light.matrixWorld)):this.matrix.copy(this.light.matrixWorld),Rw.setFromMatrixPosition(this.light.matrixWorld),v0.setFromMatrixPosition(this.light.target.matrixWorld),Iw.subVectors(v0,Rw),this.lightPlane.lookAt(v0),this.color!==void 0?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(v0),this.targetLine.scale.z=Iw.length()}}class $te extends Tt{constructor(e){super(),this.csm=e,this.displayFrustum=!0,this.displayPlanes=!0,this.displayShadowBounds=!0;const t=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),n=new Float32Array(24),r=new mt;r.setIndex(new $e(t,1)),r.setAttribute("position",new $e(n,3,!1));const a=new jo(r,new gr);this.add(a),this.frustumLines=a,this.cascadeLines=[],this.cascadePlanes=[],this.shadowLines=[]}updateVisibility(){const e=this.displayFrustum&&this.visible,t=this.displayPlanes&&this.visible,n=this.displayShadowBounds&&this.visible,r=this.frustumLines,a=this.cascadeLines,i=this.cascadePlanes,s=this.shadowLines;for(let c=0,u=a.length;c<u;c++){const h=a[c],f=i[c],m=s[c];h.visible=e,f.visible=e&&t,m.visible=n,m.traverse(g=>{g.visible=n})}r.visible=e}update(){const e=this.csm,t=e._sceneViewCamera;if(!t||e._needsUpdate)return;const n=e._cascades,r=n.length,a=e.mainFrustum,i=e._frustums,s=this.frustumLines.geometry.getAttribute("position"),c=this.cascadeLines,u=this.cascadePlanes,h=this.shadowLines;for(this.position.copy(t.position),this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.updateWorldMatrix(!1,!0);c.length>r;){this.remove(c.pop()),this.remove(u.pop());const g=h.pop();g.children[0].dispose(),this.remove(g)}for(;c.length<r;){const g=new L2(new mn,16777215),A=new hr({transparent:!0,opacity:.1,depthWrite:!1,side:2}),_=new Mt(new ps,A),x=new Da,C=new L2(new mn,16776960);x.add(C),this.add(g),this.add(_),this.add(x),c.push(g),u.push(_),h.push(x)}for(let g=0;g<r;g++){const A=i[g],_=n[g].camera,x=A.vertices.far,C=c[g],b=u[g],y=h[g],M=y.children[0];C.box.min.copy(x[2]),C.box.max.copy(x[0]),C.box.max.z+=1e-4,b.position.addVectors(x[0],x[2]),b.position.multiplyScalar(.5),b.scale.subVectors(x[0],x[2]),b.scale.z=1e-4,this.remove(y),y.position.copy(_.position),y.quaternion.copy(_.quaternion),y.scale.copy(_.scale),y.updateWorldMatrix(!1,!0),this.attach(y),M.box.min.set(_.bottom,_.left,-_.far),M.box.max.set(_.top,_.right,-_.near)}const f=a.vertices.near,m=a.vertices.far;s.setXYZ(0,m[0].x,m[0].y,m[0].z),s.setXYZ(1,m[3].x,m[3].y,m[3].z),s.setXYZ(2,m[2].x,m[2].y,m[2].z),s.setXYZ(3,m[1].x,m[1].y,m[1].z),s.setXYZ(4,f[0].x,f[0].y,f[0].z),s.setXYZ(5,f[3].x,f[3].y,f[3].z),s.setXYZ(6,f[2].x,f[2].y,f[2].z),s.setXYZ(7,f[1].x,f[1].y,f[1].z),s.needsUpdate=!0}dispose(){const e=this.frustumLines,t=this.cascadeLines,n=this.cascadePlanes,r=this.shadowLines;e.geometry.dispose(),e.material.dispose();const a=this.csm.cascades;for(let i=0;i<a;i++){const s=t[i],c=n[i],u=r[i].children[0];s.dispose(),c.geometry.dispose(),c.material.dispose(),u.dispose()}}}const _0=new B,Qn=new dp;class Jte extends jo{constructor(e){const t=new mt,n=new gr({color:16777215,vertexColors:!0,toneMapped:!1}),r=[],a=[],i={};function s(A,_){c(A),c(_)}function c(A){r.push(0,0,0),a.push(0,0,0),i[A]===void 0&&(i[A]=[]),i[A].push(r.length/3-1)}s("n1","n2"),s("n2","n4"),s("n4","n3"),s("n3","n1"),s("f1","f2"),s("f2","f4"),s("f4","f3"),s("f3","f1"),s("n1","f1"),s("n2","f2"),s("n3","f3"),s("n4","f4"),s("p","n1"),s("p","n2"),s("p","n3"),s("p","n4"),s("u1","u2"),s("u2","u3"),s("u3","u1"),s("c","t"),s("p","c"),s("cn1","cn2"),s("cn3","cn4"),s("cf1","cf2"),s("cf3","cf4"),t.setAttribute("position",new ut(r,3)),t.setAttribute("color",new ut(a,3)),super(t,n),this.type="CameraHelper",this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=i,this.update();const u=new Qe(16755200),h=new Qe(16711680),f=new Qe(43775),m=new Qe(16777215),g=new Qe(3355443);this.setColors(u,h,f,m,g)}setColors(e,t,n,r,a){const i=this.geometry.getAttribute("color");i.setXYZ(0,e.r,e.g,e.b),i.setXYZ(1,e.r,e.g,e.b),i.setXYZ(2,e.r,e.g,e.b),i.setXYZ(3,e.r,e.g,e.b),i.setXYZ(4,e.r,e.g,e.b),i.setXYZ(5,e.r,e.g,e.b),i.setXYZ(6,e.r,e.g,e.b),i.setXYZ(7,e.r,e.g,e.b),i.setXYZ(8,e.r,e.g,e.b),i.setXYZ(9,e.r,e.g,e.b),i.setXYZ(10,e.r,e.g,e.b),i.setXYZ(11,e.r,e.g,e.b),i.setXYZ(12,e.r,e.g,e.b),i.setXYZ(13,e.r,e.g,e.b),i.setXYZ(14,e.r,e.g,e.b),i.setXYZ(15,e.r,e.g,e.b),i.setXYZ(16,e.r,e.g,e.b),i.setXYZ(17,e.r,e.g,e.b),i.setXYZ(18,e.r,e.g,e.b),i.setXYZ(19,e.r,e.g,e.b),i.setXYZ(20,e.r,e.g,e.b),i.setXYZ(21,e.r,e.g,e.b),i.setXYZ(22,e.r,e.g,e.b),i.setXYZ(23,e.r,e.g,e.b),i.setXYZ(24,t.r,t.g,t.b),i.setXYZ(25,t.r,t.g,t.b),i.setXYZ(26,t.r,t.g,t.b),i.setXYZ(27,t.r,t.g,t.b),i.setXYZ(28,t.r,t.g,t.b),i.setXYZ(29,t.r,t.g,t.b),i.setXYZ(30,t.r,t.g,t.b),i.setXYZ(31,t.r,t.g,t.b),i.setXYZ(32,n.r,n.g,n.b),i.setXYZ(33,n.r,n.g,n.b),i.setXYZ(34,n.r,n.g,n.b),i.setXYZ(35,n.r,n.g,n.b),i.setXYZ(36,n.r,n.g,n.b),i.setXYZ(37,n.r,n.g,n.b),i.setXYZ(38,r.r,r.g,r.b),i.setXYZ(39,r.r,r.g,r.b),i.setXYZ(40,a.r,a.g,a.b),i.setXYZ(41,a.r,a.g,a.b),i.setXYZ(42,a.r,a.g,a.b),i.setXYZ(43,a.r,a.g,a.b),i.setXYZ(44,a.r,a.g,a.b),i.setXYZ(45,a.r,a.g,a.b),i.setXYZ(46,a.r,a.g,a.b),i.setXYZ(47,a.r,a.g,a.b),i.setXYZ(48,a.r,a.g,a.b),i.setXYZ(49,a.r,a.g,a.b),i.needsUpdate=!0}update(){const e=this.geometry,t=this.pointMap;Qn.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),Zn("c",t,e,Qn,0,0,-1),Zn("t",t,e,Qn,0,0,1),Zn("n1",t,e,Qn,-1,-1,-1),Zn("n2",t,e,Qn,1,-1,-1),Zn("n3",t,e,Qn,-1,1,-1),Zn("n4",t,e,Qn,1,1,-1),Zn("f1",t,e,Qn,-1,-1,1),Zn("f2",t,e,Qn,1,-1,1),Zn("f3",t,e,Qn,-1,1,1),Zn("f4",t,e,Qn,1,1,1),Zn("u1",t,e,Qn,.7,1.1,-1),Zn("u2",t,e,Qn,-.7,1.1,-1),Zn("u3",t,e,Qn,0,2,-1),Zn("cf1",t,e,Qn,-1,0,1),Zn("cf2",t,e,Qn,1,0,1),Zn("cf3",t,e,Qn,0,-1,1),Zn("cf4",t,e,Qn,0,1,1),Zn("cn1",t,e,Qn,-1,0,-1),Zn("cn2",t,e,Qn,1,0,-1),Zn("cn3",t,e,Qn,0,-1,-1),Zn("cn4",t,e,Qn,0,1,-1),e.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}}function Zn(o,e,t,n,r,a,i){_0.set(r,a,i).unproject(n);const s=e[o];if(s!==void 0){const c=t.getAttribute("position");for(let u=0,h=s.length;u<h;u++)c.setXYZ(s[u],_0.x,_0.y,_0.z)}}const A0=new mn;class ene extends jo{constructor(e,t=16776960){const n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),r=new Float32Array(24),a=new mt;a.setIndex(new $e(n,1)),a.setAttribute("position",new $e(r,3)),super(a,new gr({color:t,toneMapped:!1})),this.object=e,this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}update(e){if(e!==void 0&&console.warn("v3d.BoxHelper: .update() has no longer arguments."),this.object!==void 0&&A0.setFromObject(this.object),A0.isEmpty())return;const t=A0.min,n=A0.max,r=this.geometry.attributes.position,a=r.array;a[0]=n.x,a[1]=n.y,a[2]=n.z,a[3]=t.x,a[4]=n.y,a[5]=n.z,a[6]=t.x,a[7]=t.y,a[8]=n.z,a[9]=n.x,a[10]=t.y,a[11]=n.z,a[12]=n.x,a[13]=n.y,a[14]=t.z,a[15]=t.x,a[16]=n.y,a[17]=t.z,a[18]=t.x,a[19]=t.y,a[20]=t.z,a[21]=n.x,a[22]=t.y,a[23]=t.z,r.needsUpdate=!0,this.geometry.computeBoundingSphere()}setFromObject(e){return this.object=e,this.update(),this}copy(e,t){return super.copy(e,t),this.object=e.object,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class tne extends vi{constructor(e,t=1,n=16776960){const r=n,a=new mt;a.setAttribute("position",new ut([1,-1,0,-1,1,0,-1,-1,0,1,1,0,-1,1,0,-1,-1,0,1,-1,0,1,1,0],3)),a.computeBoundingSphere(),super(a,new gr({color:r,toneMapped:!1})),this.type="PlaneHelper",this.plane=e,this.size=t;const i=new mt;i.setAttribute("position",new ut([1,1,0,-1,1,0,-1,-1,0,1,1,0,-1,-1,0,1,-1,0],3)),i.computeBoundingSphere(),this.add(new Mt(i,new hr({color:r,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}updateMatrixWorld(e){this.position.set(0,0,0),this.scale.set(.5*this.size,.5*this.size,1),this.lookAt(this.plane.normal),this.translateZ(-this.plane.constant),super.updateMatrixWorld(e)}dispose(){this.geometry.dispose(),this.material.dispose(),this.children[0].geometry.dispose(),this.children[0].material.dispose()}}const Lw=new B;let x0,$A;class nne extends Tt{constructor(e=new B(0,0,1),t=new B(0,0,0),n=1,r=16776960,a=.2*n,i=.2*a){super(),this.type="ArrowHelper",x0===void 0&&(x0=new mt,x0.setAttribute("position",new ut([0,0,0,0,1,0],3)),$A=new Jy(0,.5,1,5,1),$A.translate(0,-.5,0)),this.position.copy(t),this.line=new vi(x0,new gr({color:r,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new Mt($A,new hr({color:r,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(e),this.setLength(n,a,i)}setDirection(e){if(e.y>.99999)this.quaternion.set(0,0,0,1);else if(e.y<-.99999)this.quaternion.set(1,0,0,0);else{Lw.set(e.z,0,-e.x).normalize();const t=Math.acos(e.y);this.quaternion.setFromAxisAngle(Lw,t)}}setLength(e,t=.2*e,n=.2*t){this.line.scale.set(1,Math.max(1e-4,e-t),1),this.line.updateMatrix(),this.cone.scale.set(n,t,n),this.cone.position.y=e,this.cone.updateMatrix()}setColor(e){this.line.material.color.set(e),this.cone.material.color.set(e)}copy(e){return super.copy(e,!1),this.line.copy(e.line),this.cone.copy(e.cone),this}dispose(){this.line.geometry.dispose(),this.line.material.dispose(),this.cone.geometry.dispose(),this.cone.material.dispose()}}class rne extends jo{constructor(e=1){const t=[0,0,0,e,0,0,0,0,0,0,e,0,0,0,0,0,0,e],n=new mt;n.setAttribute("position",new ut(t,3)),n.setAttribute("color",new ut([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3)),super(n,new gr({vertexColors:!0,toneMapped:!1})),this.type="AxesHelper"}setColors(e,t,n){const r=new Qe,a=this.geometry.attributes.color.array;return r.set(e),r.toArray(a,0),r.toArray(a,3),r.set(t),r.toArray(a,6),r.toArray(a,9),r.set(n),r.toArray(a,12),r.toArray(a,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class EB{constructor(){this.type="ShapePath",this.color=new Qe,this.subPaths=[],this.currentPath=null}moveTo(e,t){return this.currentPath=new Mv,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,t),this}lineTo(e,t){return this.currentPath.lineTo(e,t),this}quadraticCurveTo(e,t,n,r){return this.currentPath.quadraticCurveTo(e,t,n,r),this}bezierCurveTo(e,t,n,r,a,i){return this.currentPath.bezierCurveTo(e,t,n,r,a,i),this}splineThru(e){return this.currentPath.splineThru(e),this}toShapes(e){function t(x,C){const b=C.length;let y=!1;for(let M=b-1,R=0;R<b;M=R++){let T=C[M],w=C[R],D=w.x-T.x,z=w.y-T.y;if(Math.abs(z)>Number.EPSILON){if(z<0&&(T=C[R],D=-D,w=C[M],z=-z),x.y<T.y||x.y>w.y)continue;if(x.y===T.y){if(x.x===T.x)return!0}else{const F=z*(x.x-T.x)-D*(x.y-T.y);if(F===0)return!0;if(F<0)continue;y=!y}}else{if(x.y!==T.y)continue;if(w.x<=x.x&&x.x<=T.x||T.x<=x.x&&x.x<=w.x)return!0}}return y}const n=di.isClockWise,r=this.subPaths;if(r.length===0)return[];let a,i,s;const c=[];if(r.length===1)return i=r[0],s=new sd,s.curves=i.curves,c.push(s),c;let u=!n(r[0].getPoints());u=e?!u:u;const h=[],f=[];let m,g,A=[],_=0;f[_]=void 0,A[_]=[];for(let x=0,C=r.length;x<C;x++)i=r[x],m=i.getPoints(),a=n(m),a=e?!a:a,a?(!u&&f[_]&&_++,f[_]={s:new sd,p:m},f[_].s.curves=i.curves,u&&_++,A[_]=[]):A[_].push({h:i,p:m[0]});if(!f[0])return function(x){const C=[];for(let b=0,y=x.length;b<y;b++){const M=x[b],R=new sd;R.curves=M.curves,C.push(R)}return C}(r);if(f.length>1){let x=!1,C=0;for(let b=0,y=f.length;b<y;b++)h[b]=[];for(let b=0,y=f.length;b<y;b++){const M=A[b];for(let R=0;R<M.length;R++){const T=M[R];let w=!0;for(let D=0;D<f.length;D++)t(T.p,f[D].p)&&(b!==D&&C++,w?(w=!1,h[D].push(T)):x=!0);w&&h[b].push(T)}}C>0&&x===!1&&(A=h)}for(let x=0,C=f.length;x<C;x++){s=f[x].s,c.push(s),g=A[x];for(let b=0,y=g.length;b<y;b++)s.holes.push(g[b].h)}return c}}const as=one();function one(){const o=new ArrayBuffer(4),e=new Float32Array(o),t=new Uint32Array(o),n=new Uint32Array(512),r=new Uint32Array(512);for(let c=0;c<256;++c){const u=c-127;u<-27?(n[c]=0,n[256|c]=32768,r[c]=24,r[256|c]=24):u<-14?(n[c]=1024>>-u-14,n[256|c]=1024>>-u-14|32768,r[c]=-u-1,r[256|c]=-u-1):u<=15?(n[c]=u+15<<10,n[256|c]=u+15<<10|32768,r[c]=13,r[256|c]=13):u<128?(n[c]=31744,n[256|c]=64512,r[c]=24,r[256|c]=24):(n[c]=31744,n[256|c]=64512,r[c]=13,r[256|c]=13)}const a=new Uint32Array(2048),i=new Uint32Array(64),s=new Uint32Array(64);for(let c=1;c<1024;++c){let u=c<<13,h=0;for(;!(8388608&u);)u<<=1,h-=8388608;u&=-8388609,h+=947912704,a[c]=u|h}for(let c=1024;c<2048;++c)a[c]=939524096+(c-1024<<13);for(let c=1;c<31;++c)i[c]=c<<23;i[31]=1199570944,i[32]=2147483648;for(let c=33;c<63;++c)i[c]=2147483648+(c-32<<23);i[63]=3347054592;for(let c=1;c<64;++c)c!==32&&(s[c]=1024);return{floatView:e,uint32View:t,baseTable:n,shiftTable:r,mantissaTable:a,exponentTable:i,offsetTable:s}}function gc(o){Math.abs(o)>65504&&console.warn("v3d.DataUtils.toHalfFloat(): Value out of range."),o=Ft(o,-65504,65504),as.floatView[0]=o;const e=as.uint32View[0],t=e>>23&511;return as.baseTable[t]+((8388607&e)>>as.shiftTable[t])}function hg(o){const e=o>>10;return as.uint32View[0]=as.mantissaTable[as.offsetTable[e]+(1023&o)]+as.exponentTable[e],as.floatView[0]}var ane=Object.freeze({__proto__:null,fromHalfFloat:hg,toHalfFloat:gc});class MB extends pa{constructor(e,t,n){super(),this.damp=t,this.shader=xt.afterimage,this.uniforms=no.clone(this.shader.uniforms),this.uniforms.damp.value=this.damp,this.textureComp=new qt(e.x,e.y,n),this.textureComp.texture.name="AfterImage.comp",this.textureOld=new qt(e.x,e.y,n),this.textureOld.texture.name="AfterImage.old",this.shaderMaterial=new An({uniforms:this.uniforms,vertexShader:this.shader.vertexShader,fragmentShader:this.shader.fragmentShader}),this.compFsQuad=new Ga(this.shaderMaterial);const r=new hr;this.copyFsQuad=new Ga(r)}dispose(){this.textureComp.dispose(),this.textureOld.dispose()}render(e,t,n){this.uniforms.tOld.value=this.textureOld.texture,this.uniforms.tNew.value=n.texture,this.uniforms.damp.value=this.damp,e.setRenderTarget(this.textureComp),this.compFsQuad.render(e),this.copyFsQuad.material.map=this.textureComp.texture,this.renderToScreen?(e.setRenderTarget(null),this.copyFsQuad.render(e)):(e.setRenderTarget(t),this.clear&&e.clear(),this.copyFsQuad.render(e));const r=this.textureOld;this.textureOld=this.textureComp,this.textureComp=r}setSize(e,t){this.textureComp.setSize(e,t),this.textureOld.setSize(e,t)}}class pl extends pa{constructor(e,t,n,r,a){super(),this.strength=t!==void 0?t:1,this.radius=Ft(n),this.threshold=r,this.resolution=e!==void 0?new Ee(e.x,e.y):new Ee(256,256),a=a||{minFilter:1006,magFilter:1006,format:1023},this.clearColor=new Qe(0,0,0),this.renderTargetsHorizontal=[],this.renderTargetsVertical=[],this.nMips=5;let i=Math.round(this.resolution.x/2),s=Math.round(this.resolution.y/2);this.renderTargetBright=new qt(i,s,a),this.renderTargetBright.texture.name="BloomPass.bright",this.renderTargetBright.texture.generateMipmaps=!1;for(let f=0;f<this.nMips;f++){const m=new qt(i,s,a);m.texture.name="BloomPass.h"+f,m.texture.generateMipmaps=!1,this.renderTargetsHorizontal.push(m);const g=new qt(i,s,a);g.texture.name="BloomPass.v"+f,g.texture.generateMipmaps=!1,this.renderTargetsVertical.push(g),i=Math.round(i/2),s=Math.round(s/2)}const c=xt.bloomLumHighPass;this.highPassUniforms=no.clone(c.uniforms),this.highPassUniforms.luminosityThreshold.value=r,this.highPassUniforms.smoothWidth.value=.01,this.materialHighPassFilter=new An({type:"BloomHighPass",uniforms:this.highPassUniforms,vertexShader:c.vertexShader,fragmentShader:c.fragmentShader,defines:{}}),this.separableBlurMaterials=[];const u=[3,5,7,9,11];i=Math.round(this.resolution.x/2),s=Math.round(this.resolution.y/2);for(let f=0;f<this.nMips;f++)this.separableBlurMaterials.push(this.getSeparableBlurMaterial(u[f],u[f]/3)),this.separableBlurMaterials[f].uniforms.texSize.value=new Ee(i,s),i=Math.round(i/2),s=Math.round(s/2);this.compositeMaterial=this.getCompositeMaterial(this.nMips),this.compositeMaterial.uniforms.blurTexture1.value=this.renderTargetsVertical[0].texture,this.compositeMaterial.uniforms.blurTexture2.value=this.renderTargetsVertical[1].texture,this.compositeMaterial.uniforms.blurTexture3.value=this.renderTargetsVertical[2].texture,this.compositeMaterial.uniforms.blurTexture4.value=this.renderTargetsVertical[3].texture,this.compositeMaterial.uniforms.blurTexture5.value=this.renderTargetsVertical[4].texture,this.compositeMaterial.uniforms.bloomStrength.value=t,this.compositeMaterial.uniforms.bloomRadius.value=.1,this.compositeMaterial.needsUpdate=!0,this.compositeMaterial.uniforms.bloomFactors.value=[1,.8,.6,.4,.2],this.bloomTintColors=[new B(1,1,1),new B(1,1,1),new B(1,1,1),new B(1,1,1),new B(1,1,1)],this.compositeMaterial.uniforms.bloomTintColors.value=this.bloomTintColors;const h=xt.copy;this.copyUniforms=no.clone(h.uniforms),this.copyUniforms.opacity.value=1,this.materialCopy=new An({type:"BloomCopy",defines:Object.assign({},h.defines),uniforms:this.copyUniforms,vertexShader:h.vertexShader,fragmentShader:h.fragmentShader,blending:5,blendEquation:100,blendEquationAlpha:100,blendSrc:204,blendDst:201,blendSrcAlpha:200,blendDstAlpha:201,depthTest:!1,depthWrite:!1,transparent:!0}),this.enabled=!0,this.needsSwap=!1,this._oldClearColor=new Qe,this.oldClearAlpha=1,this.basic=new hr,this.fsQuad=new Ga(null)}dispose(){for(let e=0;e<this.renderTargetsHorizontal.length;e++)this.renderTargetsHorizontal[e].dispose();for(let e=0;e<this.renderTargetsVertical.length;e++)this.renderTargetsVertical[e].dispose();this.renderTargetBright.dispose()}setSize(e,t){let n=Math.round(e/2),r=Math.round(t/2);this.renderTargetBright.setSize(n,r);for(let a=0;a<this.nMips;a++)this.renderTargetsHorizontal[a].setSize(n,r),this.renderTargetsVertical[a].setSize(n,r),this.separableBlurMaterials[a].uniforms.texSize.value=new Ee(n,r),n=Math.round(n/2),r=Math.round(r/2)}render(e,t,n,r,a){e.getClearColor(this._oldClearColor),this.oldClearAlpha=e.getClearAlpha();const i=e.autoClear;e.autoClear=!1,e.setClearColor(this.clearColor,0),a&&e.state.buffers.stencil.setTest(!1),this.renderToScreen&&(this.fsQuad.material=this.basic,this.basic.map=n.texture,e.setRenderTarget(null),e.clear(),this.fsQuad.render(e)),this.highPassUniforms.tDiffuse.value=n.texture,this.highPassUniforms.luminosityThreshold.value=this.threshold,this.fsQuad.material=this.materialHighPassFilter,e.setRenderTarget(this.renderTargetBright),e.clear(),this.fsQuad.render(e);let s=this.renderTargetBright;for(let c=0;c<this.nMips;c++)this.fsQuad.material=this.separableBlurMaterials[c],this.separableBlurMaterials[c].uniforms.colorTexture.value=s.texture,this.separableBlurMaterials[c].uniforms.direction.value=pl.BlurDirectionX,e.setRenderTarget(this.renderTargetsHorizontal[c]),e.clear(),this.fsQuad.render(e),this.separableBlurMaterials[c].uniforms.colorTexture.value=this.renderTargetsHorizontal[c].texture,this.separableBlurMaterials[c].uniforms.direction.value=pl.BlurDirectionY,e.setRenderTarget(this.renderTargetsVertical[c]),e.clear(),this.fsQuad.render(e),s=this.renderTargetsVertical[c];this.fsQuad.material=this.compositeMaterial,this.compositeMaterial.uniforms.bloomStrength.value=this.strength,this.compositeMaterial.uniforms.bloomRadius.value=Ft(this.radius),this.compositeMaterial.uniforms.bloomTintColors.value=this.bloomTintColors,e.setRenderTarget(this.renderTargetsHorizontal[0]),e.clear(),this.fsQuad.render(e),this.fsQuad.material=this.materialCopy,this.copyUniforms.tDiffuse.value=this.renderTargetsHorizontal[0].texture,a&&e.state.buffers.stencil.setTest(!0),this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(n),this.fsQuad.render(e)),e.setClearColor(this._oldClearColor,this.oldClearAlpha),e.autoClear=i}getSeparableBlurMaterial(e,t){return new An({type:"BloomSeparableBlur",defines:{KERNEL_RADIUS:e,SIGMA:t},uniforms:{colorTexture:{value:null},texSize:{value:new Ee(.5,.5)},direction:{value:new Ee(.5,.5)}},vertexShader:Ye.pp_plane_vert,fragmentShader:Ye.pp_bloom_separable_blur_frag})}getCompositeMaterial(e){return new An({type:"BloomComposite",defines:{NUM_MIPS:e},uniforms:{blurTexture1:{value:null},blurTexture2:{value:null},blurTexture3:{value:null},blurTexture4:{value:null},blurTexture5:{value:null},dirtTexture:{value:null},bloomStrength:{value:1},bloomFactors:{value:null},bloomTintColors:{value:null},bloomRadius:{value:0}},vertexShader:Ye.pp_plane_vert,fragmentShader:Ye.pp_bloom_composite_frag})}}pl.BlurDirectionX=new Ee(1,0),pl.BlurDirectionY=new Ee(0,1);class cb extends pa{constructor(e,t,n){super(),this.scene=e,this.camera=t;const r=n.width||window.innerWidth||1,a=n.height||window.innerHeight||1,i=new qt(r,a,{minFilter:1006,magFilter:1006,format:1023});this.renderTargetDepth=i.clone(),this.renderTargetDepth.texture.name="BokehPass.depth",this.materialDepth=new Ad,this.materialDepth.depthPacking=3201,this.materialDepth.blending=0;const s=xt.bokeh,c=no.clone(s.uniforms);c.tDepth.value=this.renderTargetDepth.texture,c.focus.value=_e(n.focus)?n.focus:1,c.aperture.value=_e(n.aperture)?n.aperture:1,c.maxblur.value=_e(n.maxblur)?n.maxblur:1,c.depthLeakThreshold.value=_e(n.depthLeakThreshold)?n.depthLeakThreshold:.2,c.nearClip.value=t.near,c.farClip.value=t.far,c.aspect.value=t.aspect,Object.defineProperties(this,{focus:{get:function(){return this.uniforms.focus.value},set:function(u){this.uniforms.focus.value=u}},aperture:{get:function(){return this.uniforms.aperture.value},set:function(u){this.uniforms.aperture.value=u}},maxblur:{get:function(){return this.uniforms.maxblur.value},set:function(u){this.uniforms.maxblur.value=u}},depthLeakThreshold:{get:function(){return this.uniforms.depthLeakThreshold.value},set:function(u){this.uniforms.depthLeakThreshold.value=u}}}),this.materialBokeh=new An({type:"Bokeh",defines:Object.assign({},s.defines),uniforms:c,vertexShader:s.vertexShader,fragmentShader:s.fragmentShader}),this.uniforms=c,this.camera2=new yi(-1,1,1,-1,0,1),this.scene2=new Hr,this.quad2=new Mt(new ps(2,2),null),this.quad2.frustumCulled=!1,this.scene2.add(this.quad2),this.oldClearColor=new Qe,this.oldClearAlpha=1}render(e,t,n,r,a){this.quad2.material=this.materialBokeh,this.scene.overrideMaterial=this.materialDepth,e.getClearColor(this.oldClearColor),this.oldClearAlpha=e.getClearAlpha(),e.autoClear,e.autoClear=!1,e.setClearColor(16777215),e.setClearAlpha(1),e.setRenderTarget(this.renderTargetDepth),e.clear(),e.render(this.scene,this.camera),this.uniforms.tColor.value=n.texture,this.uniforms.nearClip.value=this.camera.near,this.uniforms.farClip.value=this.camera.far,this.uniforms.aspect.value=this.camera.aspect,this.renderToScreen?(e.setRenderTarget(null),e.render(this.scene2,this.camera2)):(e.setRenderTarget(t),e.clear(),e.render(this.scene2,this.camera2)),this.scene.overrideMaterial=null,e.setClearColor(this.oldClearColor),e.setClearAlpha(this.oldClearAlpha),e.autoClear=this.oldAutoClear}setCamera(e){this.camera=e}setSize(e,t){this.renderTargetDepth.setSize(e,t)}dispose(){this.renderTargetDepth.dispose()}}class ms extends pa{constructor(e,t){super(),this.textureID=t!==void 0?t:"tDiffuse",e instanceof An?(this.uniforms=e.uniforms,this.material=e):e&&(this.uniforms=no.clone(e.uniforms),this.material=new An({type:"ShaderPass",defines:Object.assign({},e.defines),uniforms:this.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader})),this.fsQuad=new Ga(this.material)}render(e,t,n){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=n.texture),this.fsQuad.material=this.material,this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(t),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),this.fsQuad.render(e))}dispose(){this.material.dispose()}}class ub extends ms{constructor(){super(xt.brightness_contrast),this.material.type="Grayscale"}get brightness(){return this.uniforms.brightness.value}set brightness(e){this.uniforms.brightness.value=e}get contrast(){return this.uniforms.contrast.value}set contrast(e){this.uniforms.contrast.value=e}}class Xg extends ms{constructor(e,t,n,r){super(xt.fxaa),this.material.type="FXAA",this.width=n!==void 0?n:512,this.height=r!==void 0?r:256,this.needsSwap=!1}setSize(e,t){this.width=e,this.height=t,this.uniforms.resolution.value.set(1/e,1/t)}}class db extends ms{constructor(){super(xt.grayscale),this.material.type="Grayscale"}}let Qf,JA,Nu,y0;function pg(o,e=1/0,t=null){JA||(JA=new ps(2,2,1,1)),Nu||(Nu=new An({uniforms:{blitTexture:new Pv(o)},vertexShader:`
            varying vec2 vUv;
            void main(){
                vUv = uv;
                gl_Position = vec4(position.xy * 1.0,0.,.999999);
            }`,fragmentShader:`
            uniform sampler2D blitTexture;
            varying vec2 vUv;

            void main(){
                gl_FragColor = vec4(vUv.xy, 0, 1);

                #ifdef IS_SRGB
                gl_FragColor = LinearTosRGB(texture2D(blitTexture, vUv));
                #else
                gl_FragColor = texture2D(blitTexture, vUv);
                #endif
            }`})),Nu.uniforms.blitTexture.value=o,Nu.defines.IS_SRGB=o.encoding==3001,Nu.needsUpdate=!0,y0||(y0=new Mt(JA,Nu),y0.frustumCulled=!1);const n=new ir,r=new Hr;r.add(y0),t===null&&(t=Qf=new Wy({antialias:!1}));const a=Math.min(o.image.width,e),i=Math.min(o.image.height,e);t.setSize(a,i),t.clear(),t.render(r,n);const s=document.createElement("canvas"),c=s.getContext("2d");s.width=a,s.height=i,c.drawImage(t.domElement,0,0,a,i);const u=new D5(s);return u.minFilter=o.minFilter,u.magFilter=o.magFilter,u.wrapS=o.wrapS,u.wrapT=o.wrapT,u.name=o.name,Qf&&(Qf.forceContextLoss(),Qf.dispose(),Qf=null),u}class Nv{constructor(){this.pluginCallbacks=[],this.register(function(e){return new une(e)})}register(e){return this.pluginCallbacks.indexOf(e)===-1&&this.pluginCallbacks.push(e),this}unregister(e){return this.pluginCallbacks.indexOf(e)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,n,r){const a=new cne,i=[];for(let s=0,c=this.pluginCallbacks.length;s<c;s++)i.push(this.pluginCallbacks[s](a));a.setPlugins(i),a.write(e,t,r).catch(n)}parseAsync(e,t){const n=this;return new Promise(function(r,a){n.parse(e,r,a,t)})}}const pn={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123,FLOAT:5126,UNSIGNED_INT:5125,ARRAY_BUFFER:34962,ELEMENT_ARRAY_BUFFER:34963,NEAREST:9728,LINEAR:9729,NEAREST_MIPMAP_NEAREST:9984,LINEAR_MIPMAP_NEAREST:9985,NEAREST_MIPMAP_LINEAR:9986,LINEAR_MIPMAP_LINEAR:9987,CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648,REPEAT:10497},Uo={};Uo[1003]=pn.NEAREST,Uo[1004]=pn.NEAREST_MIPMAP_NEAREST,Uo[1005]=pn.NEAREST_MIPMAP_LINEAR,Uo[1006]=pn.LINEAR,Uo[1007]=pn.LINEAR_MIPMAP_NEAREST,Uo[1008]=pn.LINEAR_MIPMAP_LINEAR,Uo[1001]=pn.CLAMP_TO_EDGE,Uo[1e3]=pn.REPEAT,Uo[1002]=pn.MIRRORED_REPEAT;const Bw={scale:"scale",position:"translation",quaternion:"rotation",morphTargetInfluences:"weights"};function uh(o,e){return o.length===e.length&&o.every(function(t,n){return t===e[n]})}function ine(o){return new TextEncoder().encode(o).buffer}function sne(o){return uh(o.elements,[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}function lne(o,e,t){const n={min:new Array(o.itemSize).fill(Number.POSITIVE_INFINITY),max:new Array(o.itemSize).fill(Number.NEGATIVE_INFINITY)};for(let r=e;r<e+t;r++)for(let a=0;a<o.itemSize;a++){let i;o.itemSize>4?i=o.array[r*o.itemSize+a]:(a===0?i=o.getX(r):a===1?i=o.getY(r):a===2?i=o.getZ(r):a===3&&(i=o.getW(r)),o.normalized===!0&&(i=cn(i,o.array))),n.min[a]=Math.min(n.min[a],i),n.max[a]=Math.max(n.max[a],i)}return n}function wB(o){return 4*Math.ceil(o/4)}function ex(o,e=0){const t=wB(o.byteLength);if(t!==o.byteLength){const n=new Uint8Array(t);if(n.set(new Uint8Array(o)),e!==0)for(let r=o.byteLength;r<t;r++)n[r]=e;return n.buffer}return o}function Pw(){return typeof document>"u"&&typeof OffscreenCanvas<"u"?new OffscreenCanvas(1,1):document.createElement("canvas")}function Nw(o,e){if(o.toBlob!==void 0)return new Promise(n=>o.toBlob(n,e));let t;return e==="image/jpeg"?t=.92:e==="image/webp"&&(t=.8),o.convertToBlob({type:e,quality:t})}class cne{constructor(){this.plugins=[],this.options={},this.pending=[],this.buffers=[],this.byteOffset=0,this.buffers=[],this.nodeMap=new Map,this.skins=[],this.extensionsUsed={},this.uids=new Map,this.uid=0,this.json={asset:{version:"2.0",generator:"Verge3D"}},this.cache={meshes:new Map,attributes:new Map,attributesNormalized:new Map,materials:new Map,textures:new Map,images:new Map}}setPlugins(e){this.plugins=e}async write(e,t,n={}){this.options=Object.assign({binary:!1,trs:!1,onlyVisible:!0,maxTextureSize:1/0,animations:[],includeCustomExtensions:!1},n),this.options.animations.length>0&&(this.options.trs=!0),this.processInput(e),await Promise.all(this.pending);const r=this,a=r.buffers,i=r.json;n=r.options;const s=r.extensionsUsed,c=new Blob(a,{type:"application/octet-stream"}),u=Object.keys(s);if(u.length>0&&(i.extensionsUsed=u),i.buffers&&i.buffers.length>0&&(i.buffers[0].byteLength=c.size),n.binary===!0){const h=new FileReader;h.readAsArrayBuffer(c),h.onloadend=function(){const f=ex(h.result),m=new DataView(new ArrayBuffer(8));m.setUint32(0,f.byteLength,!0),m.setUint32(4,5130562,!0);const g=ex(ine(JSON.stringify(i)),32),A=new DataView(new ArrayBuffer(8));A.setUint32(0,g.byteLength,!0),A.setUint32(4,1313821514,!0);const _=new ArrayBuffer(12),x=new DataView(_);x.setUint32(0,1179937895,!0),x.setUint32(4,2,!0);const C=12+A.byteLength+g.byteLength+m.byteLength+f.byteLength;x.setUint32(8,C,!0);const b=new Blob([_,A,g,m,f],{type:"application/octet-stream"}),y=new FileReader;y.readAsArrayBuffer(b),y.onloadend=function(){t(y.result)}}}else if(i.buffers&&i.buffers.length>0){const h=new FileReader;h.readAsDataURL(c),h.onloadend=function(){const f=h.result;i.buffers[0].uri=f,t(i)}}else t(i)}serializeUserData(e,t){if(Object.keys(e.userData).length===0)return;const n=this.options,r=this.extensionsUsed;try{const a=JSON.parse(JSON.stringify(e.userData));if(n.includeCustomExtensions&&a.gltfExtensions){t.extensions===void 0&&(t.extensions={});for(const i in a.gltfExtensions)t.extensions[i]=a.gltfExtensions[i],r[i]=!0;delete a.gltfExtensions}Object.keys(a).length>0&&(t.extras=a)}catch(a){console.warn("v3d.GLTFExporter: userData of '"+e.name+"' won't be serialized because of JSON.stringify error - "+a.message)}}getUID(e,t=!1){if(this.uids.has(e)===!1){const n=new Map;n.set(!0,this.uid++),n.set(!1,this.uid++),this.uids.set(e,n)}return this.uids.get(e).get(t)}isNormalizedNormalAttribute(e){if(this.cache.attributesNormalized.has(e))return!1;const t=new B;for(let n=0,r=e.count;n<r;n++)if(Math.abs(t.fromBufferAttribute(e,n).length()-1)>5e-4)return!1;return!0}createNormalizedNormalAttribute(e){const t=this.cache;if(t.attributesNormalized.has(e))return t.attributesNormalized.get(e);const n=e.clone(),r=new B;for(let a=0,i=n.count;a<i;a++)r.fromBufferAttribute(n,a),r.x===0&&r.y===0&&r.z===0?r.setX(1):r.normalize(),n.setXYZ(a,r.x,r.y,r.z);return t.attributesNormalized.set(e,n),n}buildMetalRoughTexture(e,t){if(e===t)return e;function n(m){return m.encoding===3001?function(g){return g<.04045?.0773993808*g:Math.pow(.9478672986*g+.0521327014,2.4)}:function(g){return g}}console.warn("v3d.GLTFExporter: Merged metalnessMap and roughnessMap textures."),e instanceof il&&(e=pg(e)),t instanceof il&&(t=pg(t));const r=e==null?void 0:e.image,a=t==null?void 0:t.image,i=Math.max((r==null?void 0:r.width)||0,(a==null?void 0:a.width)||0),s=Math.max((r==null?void 0:r.height)||0,(a==null?void 0:a.height)||0),c=Pw();c.width=i,c.height=s;const u=c.getContext("2d");u.fillStyle="#00ffff",u.fillRect(0,0,i,s);const h=u.getImageData(0,0,i,s);if(r){u.drawImage(r,0,0,i,s);const m=n(e),g=u.getImageData(0,0,i,s).data;for(let A=2;A<g.length;A+=4)h.data[A]=256*m(g[A]/256)}if(a){u.drawImage(a,0,0,i,s);const m=n(t),g=u.getImageData(0,0,i,s).data;for(let A=1;A<g.length;A+=4)h.data[A]=256*m(g[A]/256)}u.putImageData(h,0,0);const f=(e||t).clone();return f.source=new Av(c),f.encoding=3e3,f}processBuffer(e){const t=this.json,n=this.buffers;return t.buffers||(t.buffers=[{byteLength:0}]),n.push(e),0}processBufferView(e,t,n,r,a){const i=this.json;let s;i.bufferViews||(i.bufferViews=[]),s=t===pn.UNSIGNED_BYTE?1:t===pn.UNSIGNED_SHORT?2:4;const c=wB(r*e.itemSize*s),u=new DataView(new ArrayBuffer(c));let h=0;for(let m=n;m<n+r;m++)for(let g=0;g<e.itemSize;g++){let A;e.itemSize>4?A=e.array[m*e.itemSize+g]:(g===0?A=e.getX(m):g===1?A=e.getY(m):g===2?A=e.getZ(m):g===3&&(A=e.getW(m)),e.normalized===!0&&(A=cn(A,e.array))),t===pn.FLOAT?u.setFloat32(h,A,!0):t===pn.UNSIGNED_INT?u.setUint32(h,A,!0):t===pn.UNSIGNED_SHORT?u.setUint16(h,A,!0):t===pn.UNSIGNED_BYTE&&u.setUint8(h,A),h+=s}const f={buffer:this.processBuffer(u.buffer),byteOffset:this.byteOffset,byteLength:c};return a!==void 0&&(f.target=a),a===pn.ARRAY_BUFFER&&(f.byteStride=e.itemSize*s),this.byteOffset+=c,i.bufferViews.push(f),{id:i.bufferViews.length-1,byteLength:0}}processBufferViewImage(e){const t=this,n=t.json;return n.bufferViews||(n.bufferViews=[]),new Promise(function(r){const a=new FileReader;a.readAsArrayBuffer(e),a.onloadend=function(){const i=ex(a.result),s={buffer:t.processBuffer(i),byteOffset:t.byteOffset,byteLength:i.byteLength};t.byteOffset+=i.byteLength,r(n.bufferViews.push(s)-1)}})}processAccessor(e,t,n,r){const a=this.json;let i;if(e.array.constructor===Float32Array)i=pn.FLOAT;else if(e.array.constructor===Uint32Array)i=pn.UNSIGNED_INT;else if(e.array.constructor===Uint16Array)i=pn.UNSIGNED_SHORT;else{if(e.array.constructor!==Uint8Array)throw new Error("v3d.GLTFExporter: Unsupported bufferAttribute component type.");i=pn.UNSIGNED_BYTE}if(n===void 0&&(n=0),r===void 0&&(r=e.count),r===0)return null;const s=lne(e,n,r);let c;t!==void 0&&(c=e===t.index?pn.ELEMENT_ARRAY_BUFFER:pn.ARRAY_BUFFER);const u=this.processBufferView(e,i,n,r,c),h={bufferView:u.id,byteOffset:u.byteOffset,componentType:i,count:r,max:s.max,min:s.min,type:{1:"SCALAR",2:"VEC2",3:"VEC3",4:"VEC4",16:"MAT4"}[e.itemSize]};return e.normalized===!0&&(h.normalized=!0),a.accessors||(a.accessors=[]),a.accessors.push(h)-1}processImage(e,t,n,r="image/png"){if(e!==null){const a=this,i=a.cache,s=a.json,c=a.options,u=a.pending;i.images.has(e)||i.images.set(e,{});const h=i.images.get(e),f=r+":flipY/"+n.toString();if(h[f]!==void 0)return h[f];s.images||(s.images=[]);const m={mimeType:r},g=Pw();g.width=Math.min(e.width,c.maxTextureSize),g.height=Math.min(e.height,c.maxTextureSize);const A=g.getContext("2d");if(n===!0&&(A.translate(0,g.height),A.scale(1,-1)),e.data!==void 0){t!==1023&&console.error("GLTFExporter: Only RGBAFormat is supported."),(e.width>c.maxTextureSize||e.height>c.maxTextureSize)&&console.warn("GLTFExporter: Image size is bigger than maxTextureSize",e);const x=new Uint8ClampedArray(e.height*e.width*4);for(let C=0;C<x.length;C+=4)x[C+0]=e.data[C+0],x[C+1]=e.data[C+1],x[C+2]=e.data[C+2],x[C+3]=e.data[C+3];A.putImageData(new ImageData(x,e.width,e.height),0,0)}else A.drawImage(e,0,0,g.width,g.height);c.binary===!0?u.push(Nw(g,r).then(x=>a.processBufferViewImage(x)).then(x=>{m.bufferView=x})):g.toDataURL!==void 0?m.uri=g.toDataURL(r):u.push(Nw(g,r).then(x=>new FileReader().readAsDataURL(x)).then(x=>{m.uri=x}));const _=s.images.push(m)-1;return h[f]=_,_}throw new Error("v3d.GLTFExporter: No valid image data found. Unable to process texture.")}processSampler(e){const t=this.json;t.samplers||(t.samplers=[]);const n={magFilter:Uo[e.magFilter],minFilter:Uo[e.minFilter],wrapS:Uo[e.wrapS],wrapT:Uo[e.wrapT]};return t.samplers.push(n)-1}processTexture(e){const t=this.options,n=this.cache,r=this.json;if(n.textures.has(e))return n.textures.get(e);r.textures||(r.textures=[]),e instanceof il&&(e=pg(e,t.maxTextureSize));let a=e.userData.mimeType;a==="image/webp"&&(a="image/png");const i={sampler:this.processSampler(e),source:this.processImage(e.image,e.format,e.flipY,a)};e.name&&(i.name=e.name),this._invokeAll(function(c){c.writeTexture&&c.writeTexture(e,i)});const s=r.textures.push(i)-1;return n.textures.set(e,s),s}processMaterial(e){const t=this.cache,n=this.json;if(t.materials.has(e))return t.materials.get(e);if(e.isShaderMaterial)return console.warn("GLTFExporter: v3d.ShaderMaterial not supported."),null;n.materials||(n.materials=[]);const r={pbrMetallicRoughness:{}};e.isMeshNodeMaterial!==!0&&e.isMeshStandardMaterial!==!0&&e.isMeshBasicMaterial!==!0&&console.warn("GLTFExporter: Use MeshNodeMaterial, MeshStandardMaterial, or MeshBasicMaterial for best results.");const a=e.color.toArray().concat([e.opacity]);uh(a,[1,1,1,1])||(r.pbrMetallicRoughness.baseColorFactor=a),e.isMeshNodeMaterial?(r.pbrMetallicRoughness.metallicFactor=e.getStandardProp("metalness"),r.pbrMetallicRoughness.roughnessFactor=e.getStandardProp("roughness")):e.isMeshStandardMaterial?(r.pbrMetallicRoughness.metallicFactor=e.metalness,r.pbrMetallicRoughness.roughnessFactor=e.roughness):(r.pbrMetallicRoughness.metallicFactor=.5,r.pbrMetallicRoughness.roughnessFactor=.5);const i=e.isMeshNodeMaterial?e.getStandardProp("metalnessMap"):e.metalnessMap,s=e.isMeshNodeMaterial?e.getStandardProp("roughnessMap"):e.roughnessMap;if(i||s){const g=this.buildMetalRoughTexture(i,s),A={index:this.processTexture(g)};r.pbrMetallicRoughness.metallicRoughnessTexture=A}const c=e.isMeshNodeMaterial?e.getStandardProp("map"):e.map;if(c){const g={index:this.processTexture(c)};r.pbrMetallicRoughness.baseColorTexture=g}let u=e.isMeshNodeMaterial?e.getStandardProp("emissive"):e.emissive;if(u){const g=e.isMeshNodeMaterial?e.getStandardProp("emissiveIntensity"):e.emissiveIntensity;u=u.clone().multiplyScalar(g);const A=Math.max(u.r,u.g,u.b);A>1&&(u.multiplyScalar(1/A),console.warn("v3d.GLTFExporter: Some emissive components exceed 1; emissive has been limited")),A>0&&(r.emissiveFactor=u.toArray());const _=e.isMeshNodeMaterial?e.getStandardProp("emissiveMap"):e.emissiveMap;if(_){const x={index:this.processTexture(_)};r.emissiveTexture=x}}const h=e.isMeshNodeMaterial?e.getStandardProp("normalMap"):e.normalMap;if(h){const g={index:this.processTexture(h)},A=e.isMeshNodeMaterial?e.getStandardProp("normalScale"):e.normalScale;A&&A.x!==1&&(g.scale=A.x),r.normalTexture=g}const f=e.isMeshNodeMaterial?e.getStandardProp("aoMap"):e.aoMap;if(f){const g={index:this.processTexture(f),texCoord:1},A=e.isMeshNodeMaterial?e.getStandardProp("aoMapIntensity"):e.aoMapIntensity;A!==1&&(g.strength=A),r.occlusionTexture=g}e.transparent?r.alphaMode="BLEND":e.alphaTest>0&&(r.alphaMode="MASK",r.alphaCutoff=e.alphaTest),e.side===2&&(r.doubleSided=!0),e.name!==""&&(r.name=e.name),this.serializeUserData(e,r),this._invokeAll(function(g){g.writeMaterial&&g.writeMaterial(e,r)});const m=n.materials.push(r)-1;return t.materials.set(e,m),m}processMesh(e){const t=this.cache,n=this.json,r=[e.geometry.uuid];if(Array.isArray(e.material))for(let y=0,M=e.material.length;y<M;y++)r.push(e.material[y].uuid);else r.push(e.material.uuid);const a=r.join(":");if(t.meshes.has(a))return t.meshes.get(a);const i=e.geometry;let s;s=e.isLineSegments?pn.LINES:e.isLineLoop?pn.LINE_LOOP:e.isLine?pn.LINE_STRIP:e.isPoints?pn.POINTS:e.material.wireframe?pn.LINES:pn.TRIANGLES;const c={},u={},h=[],f=[],m={uv:"TEXCOORD_0",uv2:"TEXCOORD_1",color:"COLOR_0",skinWeight:"WEIGHTS_0",skinIndex:"JOINTS_0"},g=i.getAttribute("normal");g===void 0||this.isNormalizedNormalAttribute(g)||(console.warn("v3d.GLTFExporter: Creating normalized normal attribute from the non-normalized one."),i.setAttribute("normal",this.createNormalizedNormalAttribute(g)));let A=null;for(let y in i.attributes){if(y.slice(0,5)==="morph")continue;const M=i.attributes[y];if(y=m[y]||y.toUpperCase(),/^(POSITION|NORMAL|TANGENT|TEXCOORD_\d+|COLOR_\d+|JOINTS_\d+|WEIGHTS_\d+)$/.test(y)||(y="_"+y),t.attributes.has(this.getUID(M))){u[y]=t.attributes.get(this.getUID(M));continue}A=null;const R=M.array;y!=="JOINTS_0"||R instanceof Uint16Array||R instanceof Uint8Array||(console.warn('GLTFExporter: Attribute "skinIndex" converted to type UNSIGNED_SHORT.'),A=new $e(new Uint16Array(R),M.itemSize,M.normalized));const T=this.processAccessor(A||M,i);T!==null&&(u[y]=T,t.attributes.set(this.getUID(M),T))}if(g!==void 0&&i.setAttribute("normal",g),Object.keys(u).length===0)return null;if(e.morphTargetInfluences!==void 0&&e.morphTargetInfluences.length>0){const y=[],M=[],R={};if(e.morphTargetDictionary!==void 0)for(const T in e.morphTargetDictionary)R[e.morphTargetDictionary[T]]=T;for(let T=0;T<e.morphTargetInfluences.length;++T){const w={};let D=!1;for(const z in i.morphAttributes){if(z!=="position"&&z!=="normal"){D||(console.warn("GLTFExporter: Only POSITION and NORMAL morph are supported."),D=!0);continue}const F=i.morphAttributes[z][T],O=z.toUpperCase(),q=i.attributes[z];if(t.attributes.has(this.getUID(F,!0))){w[O]=t.attributes.get(this.getUID(F,!0));continue}const ne=F.clone();if(!i.morphTargetsRelative)for(let $=0,he=F.count;$<he;$++)for(let K=0;K<F.itemSize;K++)K===0&&ne.setX($,F.getX($)-q.getX($)),K===1&&ne.setY($,F.getY($)-q.getY($)),K===2&&ne.setZ($,F.getZ($)-q.getZ($)),K===3&&ne.setW($,F.getW($)-q.getW($));w[O]=this.processAccessor(ne,i),t.attributes.set(this.getUID(q,!0),w[O])}f.push(w),y.push(e.morphTargetInfluences[T]),e.morphTargetDictionary!==void 0&&M.push(R[T])}c.weights=y,M.length>0&&(c.extras={},c.extras.targetNames=M)}const _=Array.isArray(e.material);if(_&&i.groups.length===0)return null;const x=_?e.material:[e.material],C=_?i.groups:[{materialIndex:0,start:void 0,count:void 0}];for(let y=0,M=C.length;y<M;y++){const R={mode:s,attributes:u};if(this.serializeUserData(i,R),f.length>0&&(R.targets=f),i.index!==null){let w=this.getUID(i.index);C[y].start===void 0&&C[y].count===void 0||(w+=":"+C[y].start+":"+C[y].count),t.attributes.has(w)?R.indices=t.attributes.get(w):(R.indices=this.processAccessor(i.index,i,C[y].start,C[y].count),t.attributes.set(w,R.indices)),R.indices===null&&delete R.indices}const T=this.processMaterial(x[C[y].materialIndex]);T!==null&&(R.material=T),h.push(R)}c.primitives=h,n.meshes||(n.meshes=[]),this._invokeAll(function(y){y.writeMesh&&y.writeMesh(e,c)});const b=n.meshes.push(c)-1;return t.meshes.set(a,b),b}processCamera(e){const t=this.json;t.cameras||(t.cameras=[]);const n=e.isOrthographicCamera,r={type:n?"orthographic":"perspective"};return n?r.orthographic={xmag:2*e.right,ymag:2*e.top,zfar:e.far<=0?.001:e.far,znear:e.near<0?0:e.near}:r.perspective={aspectRatio:e.aspect,yfov:cp(e.fov),zfar:e.far<=0?.001:e.far,znear:e.near<0?0:e.near},e.name!==""&&(r.name=e.type),t.cameras.push(r)-1}processAnimation(e,t){const n=this.json,r=this.nodeMap;n.animations||(n.animations=[]);const a=(e=Nv.Utils.mergeMorphTargetTracks(e.clone(),t)).tracks,i=[],s=[];for(let c=0;c<a.length;++c){const u=a[c],h=Ht.parseTrackName(u.name);let f=Ht.findNode(t,h.nodeName);const m=Bw[h.propertyName];if(h.objectName==="bones"&&(f=f.isSkinnedMesh===!0?f.skeleton.getBoneByName(h.objectIndex):void 0),!f||!m)return console.warn('v3d.GLTFExporter: Could not export animation track "%s".',u.name),null;const g=1;let A,_=u.values.length/u.times.length;m===Bw.morphTargetInfluences&&(_/=f.morphTargetInfluences.length),u.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline===!0?(A="CUBICSPLINE",_/=3):A=u.getInterpolation()===2300?"STEP":"LINEAR",s.push({input:this.processAccessor(new $e(u.times,g)),output:this.processAccessor(new $e(u.values,_)),interpolation:A}),i.push({sampler:s.length-1,target:{node:r.get(f),path:m}})}return n.animations.push({name:e.name||"clip_"+n.animations.length,samplers:s,channels:i}),n.animations.length-1}processSkin(e){const t=this.json,n=this.nodeMap,r=t.nodes[n.get(e)],a=e.skeleton;if(a===void 0)return null;const i=e.skeleton.bones[0];if(i===void 0)return null;const s=[],c=new Float32Array(16*a.bones.length),u=new Ve;for(let h=0;h<a.bones.length;++h)s.push(n.get(a.bones[h])),u.copy(a.boneInverses[h]),u.multiply(e.bindMatrix).toArray(c,16*h);return t.skins===void 0&&(t.skins=[]),t.skins.push({inverseBindMatrices:this.processAccessor(new $e(c,16)),joints:s,skeleton:n.get(i)}),r.skin=t.skins.length-1}processNode(e){const t=this.json,n=this.options,r=this.nodeMap;if(e.isAuxClippingMesh)return null;let a=!1;if(n.onlyVisible&&!e.visible&&(e.traverse(function(c){c.visible&&(a=!0)}),!a))return null;t.nodes||(t.nodes=[]);const i={};if(n.trs){const c=e.quaternion.toArray(),u=e.position.toArray(),h=e.scale.toArray();uh(c,[0,0,0,1])||(i.rotation=c),uh(u,[0,0,0])||(i.translation=u),uh(h,[1,1,1])||(i.scale=h)}else e.matrixAutoUpdate&&e.updateMatrix(),sne(e.matrix)===!1&&(i.matrix=e.matrix.elements);if(e.name!==""&&(i.name=String(e.name)),this.serializeUserData(e,i),(e.isMesh||e.isLine||e.isPoints)&&!a){const c=this.processMesh(e);c!==null&&(i.mesh=c)}else e.isCamera&&!a&&(i.camera=this.processCamera(e));if(e.isSkinnedMesh&&!a&&this.skins.push(e),e.children.length>0){const c=[];for(let u=0,h=e.children.length;u<h;u++){const f=e.children[u],m=this.processNode(f);m!==null&&c.push(m)}c.length>0&&(i.children=c)}this._invokeAll(function(c){c.writeNode&&c.writeNode(e,i)});const s=t.nodes.push(i)-1;return r.set(e,s),s}processScene(e){const t=this.json,n=this.options;t.scenes||(t.scenes=[],t.scene=0);const r={};e.name!==""&&(r.name=e.name),t.scenes.push(r);const a=[];for(let i=0,s=e.children.length;i<s;i++){const c=e.children[i];if(c.visible||n.onlyVisible===!1){const u=this.processNode(c);u!==null&&a.push(u)}}a.length>0&&(r.nodes=a),this.serializeUserData(e,r)}processObjects(e){const t=new Hr;t.name="AuxScene";for(let n=0;n<e.length;n++)t.children.push(e[n]);this.processScene(t)}processInput(e){const t=this.options;e=e instanceof Array?e:[e],this._invokeAll(function(r){r.beforeParse&&r.beforeParse(e)});const n=[];for(let r=0;r<e.length;r++)e[r]instanceof Hr?this.processScene(e[r]):n.push(e[r]);n.length>0&&this.processObjects(n);for(let r=0;r<this.skins.length;++r)this.processSkin(this.skins[r]);for(let r=0;r<t.animations.length;++r)this.processAnimation(t.animations[r],e[0]);this._invokeAll(function(r){r.afterParse&&r.afterParse(e)})}_invokeAll(e){for(let t=0,n=this.plugins.length;t<n;t++)e(this.plugins[t])}}let une=class{constructor(o){this.writer=o,this.name="KHR_materials_unlit"}writeMaterial(o,e){if(!(o.isMeshBasicMaterial||o.isMeshNodeMaterial&&o.isUnlit()))return;const t=this.writer.extensionsUsed;e.extensions=e.extensions||{},e.extensions[this.name]={},t[this.name]=!0,e.pbrMetallicRoughness.metallicFactor=0,e.pbrMetallicRoughness.roughnessFactor=.9}};Nv.Utils={insertKeyframe:function(o,e){const n=o.getValueSize(),r=new o.TimeBufferType(o.times.length+1),a=new o.ValueBufferType(o.values.length+n),i=o.createInterpolant(new o.ValueBufferType(n));let s;if(o.times.length===0){r[0]=e;for(let c=0;c<n;c++)a[c]=0;s=0}else if(e<o.times[0]){if(Math.abs(o.times[0]-e)<.001)return 0;r[0]=e,r.set(o.times,1),a.set(i.evaluate(e),0),a.set(o.values,n),s=0}else if(e>o.times[o.times.length-1]){if(Math.abs(o.times[o.times.length-1]-e)<.001)return o.times.length-1;r[r.length-1]=e,r.set(o.times,0),a.set(o.values,0),a.set(i.evaluate(e),o.values.length),s=r.length-1}else for(let c=0;c<o.times.length;c++){if(Math.abs(o.times[c]-e)<.001)return c;if(o.times[c]<e&&o.times[c+1]>e){r.set(o.times.slice(0,c+1),0),r[c+1]=e,r.set(o.times.slice(c+1),c+2),a.set(o.values.slice(0,(c+1)*n),0),a.set(i.evaluate(e),(c+1)*n),a.set(o.values.slice((c+1)*n),(c+2)*n),s=c+1;break}}return o.times=r,o.values=a,s},mergeMorphTargetTracks:function(o,e){const t=[],n={},r=o.tracks;for(let a=0;a<r.length;++a){let i=r[a];const s=Ht.parseTrackName(i.name),c=Ht.findNode(e,s.nodeName);if(s.propertyName!=="morphTargetInfluences"||s.propertyIndex===void 0){t.push(i);continue}if(i.createInterpolant!==i.InterpolantFactoryMethodDiscrete&&i.createInterpolant!==i.InterpolantFactoryMethodLinear){if(i.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline)throw new Error("v3d.GLTFExporter: Cannot merge tracks with glTF CUBICSPLINE interpolation.");console.warn("v3d.GLTFExporter: Morph target interpolation mode not yet supported. Using LINEAR instead."),i=i.clone(),i.setInterpolation(2301)}const u=c.morphTargetInfluences.length,h=c.morphTargetDictionary[s.propertyIndex];if(h===void 0)throw new Error("v3d.GLTFExporter: Morph target name not found: "+s.propertyIndex);let f;if(n[c.uuid]===void 0){f=i.clone();const g=new f.ValueBufferType(u*f.times.length);for(let A=0;A<f.times.length;A++)g[A*u+h]=f.values[A];f.name=(s.nodeName||"")+".morphTargetInfluences",f.values=g,n[c.uuid]=f,t.push(f);continue}const m=i.createInterpolant(new i.ValueBufferType(1));f=n[c.uuid];for(let g=0;g<f.times.length;g++)f.values[g*u+h]=m.evaluate(f.times[g]);for(let g=0;g<i.times.length;g++){const A=this.insertKeyframe(f,i.times[g]);f.values[A*u+h]=i.values[g]}}return o.tracks=t,o}};class fb extends pa{constructor(e,t){super(),this.scene=e,this.camera=t,this.clear=!0,this.needsSwap=!1,this.inverse=!1}render(e,t,n){const r=e.getContext(),a=e.state;let i,s;a.buffers.color.setMask(!1),a.buffers.depth.setMask(!1),a.buffers.color.setLocked(!0),a.buffers.depth.setLocked(!0),this.inverse?(i=0,s=1):(i=1,s=0),a.buffers.stencil.setTest(!0),a.buffers.stencil.setOp(r.REPLACE,r.REPLACE,r.REPLACE),a.buffers.stencil.setFunc(r.ALWAYS,i,4294967295),a.buffers.stencil.setClear(s),a.buffers.stencil.setLocked(!0),e.setRenderTarget(n),this.clear&&e.clear(),e.render(this.scene,this.camera),e.setRenderTarget(t),this.clear&&e.clear(),e.render(this.scene,this.camera),a.buffers.color.setLocked(!1),a.buffers.depth.setLocked(!1),a.buffers.stencil.setLocked(!1),a.buffers.stencil.setFunc(r.EQUAL,1,4294967295),a.buffers.stencil.setOp(r.KEEP,r.KEEP,r.KEEP),a.buffers.stencil.setLocked(!0)}setCamera(e){this.camera=e}}class TB extends pa{constructor(){super(),this.needsSwap=!1}render(e){e.state.buffers.stencil.setLocked(!1),e.state.buffers.stencil.setTest(!1)}}function tx(o,e,t,n,r){if(o=o.subarray||o.slice?o:o.buffer,t=t.subarray||t.slice?t:t.buffer,o=e?o.subarray?o.subarray(e,r&&e+r):o.slice(e,r&&e+r):o,t.set)t.set(o,n);else for(let a=0;a<o.length;a++)t[a+n]=o[a];return t}class xd{constructor(){this.positions=[],this.previous=[],this.next=[],this.side=[],this.width=[],this.indices_array=[],this.uvs=[],this.counters=[],this.geometry=new mt,this.widthCallback=null}setGeometry(e,t){if(this.widthCallback=t,this.positions=[],this.counters=[],e instanceof Float32Array||e instanceof Array)for(let n=0;n<e.length;n+=3){const r=n/e.length;this.positions.push(e[n],e[n+1],e[n+2]),this.positions.push(e[n],e[n+1],e[n+2]),this.counters.push(r),this.counters.push(r)}this.process()}compareV3(e,t){const n=6*e,r=6*t;return this.positions[n]===this.positions[r]&&this.positions[n+1]===this.positions[r+1]&&this.positions[n+2]===this.positions[r+2]}copyV3(e){const t=6*e;return[this.positions[t],this.positions[t+1],this.positions[t+2]]}process(){const e=this.positions.length/6;this.previous=[],this.next=[],this.side=[],this.width=[],this.indices_array=[],this.uvs=[];for(let r=0;r<e;r++)this.side.push(1),this.side.push(-1);let t,n;for(let r=0;r<e;r++)t=this.widthCallback?this.widthCallback(r/(e-1)):1,this.width.push(t),this.width.push(t);for(let r=0;r<e;r++)this.uvs.push(r/(e-1),0),this.uvs.push(r/(e-1),1);n=this.compareV3(0,e-1)?this.copyV3(e-2):this.copyV3(0),this.previous.push(n[0],n[1],n[2]),this.previous.push(n[0],n[1],n[2]);for(let r=0;r<e-1;r++)n=this.copyV3(r),this.previous.push(n[0],n[1],n[2]),this.previous.push(n[0],n[1],n[2]);for(let r=1;r<e;r++)n=this.copyV3(r),this.next.push(n[0],n[1],n[2]),this.next.push(n[0],n[1],n[2]);n=this.compareV3(e-1,0)?this.copyV3(1):this.copyV3(e-1),this.next.push(n[0],n[1],n[2]),this.next.push(n[0],n[1],n[2]);for(let r=0;r<e-1;r++){const a=2*r;this.indices_array.push(a,a+1,a+2),this.indices_array.push(a+2,a+1,a+3)}this.attributes?(this.attributes.position.copyArray(new Float32Array(this.positions)),this.attributes.position.needsUpdate=!0,this.attributes.previous.copyArray(new Float32Array(this.previous)),this.attributes.previous.needsUpdate=!0,this.attributes.next.copyArray(new Float32Array(this.next)),this.attributes.next.needsUpdate=!0,this.attributes.side.copyArray(new Float32Array(this.side)),this.attributes.side.needsUpdate=!0,this.attributes.width.copyArray(new Float32Array(this.width)),this.attributes.width.needsUpdate=!0,this.attributes.uv.copyArray(new Float32Array(this.uvs)),this.attributes.uv.needsUpdate=!0,this.attributes.counters.copyArray(new Float32Array(this.counters)),this.attributes.counters.needsUpdate=!0,this.attributes.index.copyArray(new Uint16Array(this.indices_array)),this.attributes.index.needsUpdate=!0):this.attributes={position:new $e(new Float32Array(this.positions),3),previous:new $e(new Float32Array(this.previous),3),next:new $e(new Float32Array(this.next),3),side:new $e(new Float32Array(this.side),1),width:new $e(new Float32Array(this.width),1),uv:new $e(new Float32Array(this.uvs),2),counters:new $e(new Float32Array(this.counters),1),index:new $e(new Uint16Array(this.indices_array),1)},this.geometry.setAttribute("position",this.attributes.position),this.geometry.setAttribute("previous",this.attributes.previous),this.geometry.setAttribute("next",this.attributes.next),this.geometry.setAttribute("side",this.attributes.side),this.geometry.setAttribute("width",this.attributes.width),this.geometry.setAttribute("uv",this.attributes.uv),this.geometry.setAttribute("counters",this.attributes.counters),this.geometry.setIndex(this.attributes.index)}advance(e){const t=this.attributes.position.array,n=this.attributes.previous.array,r=this.attributes.next.array,a=t.length;tx(t,0,n,0,a),tx(t,6,t,0,a-6),t[a-6]=e.x,t[a-5]=e.y,t[a-4]=e.z,t[a-3]=e.x,t[a-2]=e.y,t[a-1]=e.z,tx(t,6,r,0,a-6),r[a-6]=e.x,r[a-5]=e.y,r[a-4]=e.z,r[a-3]=e.x,r[a-2]=e.y,r[a-1]=e.z,this.attributes.position.needsUpdate=!0,this.attributes.previous.needsUpdate=!0,this.attributes.next.needsUpdate=!0}static updateAttributes(e){const t=e.attributes.position.array;e.attributes.previous.array,e.attributes.next.array;const n=new xd;n.positions=t,n.process(),e.attributes.previous=n.attributes.previous,e.attributes.previous.needsUpdate=!0,e.attributes.next=n.attributes.next,e.attributes.next.needsUpdate=!0}}class dne{constructor(e){this.headEdge=this.tailEdge=e,this.headIndex=e.index0,this.tailIndex=e.index1,this.indexCount=2}mergeStrip(e){const t=this.headIndex,n=e.headIndex,r=this.tailIndex,a=e.tailIndex;t==n?(this.headEdge.linkToEdge(e.headEdge),e.headEdge.linkToEdge(this.headEdge),this.headEdge=e.tailEdge,this.headIndex=e.tailIndex,this.indexCount+=e.indexCount-1):t==a?(this.headEdge.linkToEdge(e.tailEdge),e.tailEdge.linkToEdge(this.headEdge),this.headEdge=e.headEdge,this.headIndex=e.headIndex,this.indexCount+=e.indexCount-1):r==n?(this.tailEdge.linkToEdge(e.headEdge),e.headEdge.linkToEdge(this.tailEdge),this.tailEdge=e.tailEdge,this.tailIndex=e.tailIndex,this.indexCount+=e.indexCount-1):r==a&&(this.tailEdge.linkToEdge(e.tailEdge),e.tailEdge.linkToEdge(this.tailEdge),this.tailEdge=e.headEdge,this.tailIndex=e.headIndex,this.indexCount+=e.indexCount-1)}getIndicesFlat(){const e=new Float32Array(this.indexCount);let t=0,n=null,r=this.headEdge,a=e[t++]=this.headIndex;for(;r!==null;){a=r.index0==a?r.index1:r.index0,e[t++]=a;let i=r.edge0;i!=n&&i!==null||(i=r.edge1),i==n&&(i=null),n=r,r=i}return e}}class fne{constructor(e,t){this.index0=e,this.index1=t,this.edge0=null,this.edge1=null}linkToEdge(e){this.edge0===null?this.edge0=e:this.edge1===null&&(this.edge1=e)}}function Dw(o,e,t){const n=o.headIndex,r=o.tailIndex;return e[n][0]||e[r][0]||t[n][0]||t[r][0]||null}function hne(o){const e=o.length%2?o.length-1:o.length,t={},n={};for(let s=0;s<e;s+=2){const c=new dne(new fne(o[s],o[s+1])),u=c.headIndex,h=c.tailIndex;t[u]=t[u]||[],t[h]=t[h]||[],n[u]=n[u]||[],n[h]=n[h]||[],t[u].push(c),n[h].push(c)}const r=new Wg;for(const s in t)t[s].length&&r.push(new K5(t[s]),s);const a=[];let i=r.first&&r.first.value[0];for(;i;){let s=i.headIndex;t[s].splice(t[s].indexOf(i),1);let c=i.tailIndex;n[c].splice(n[c].indexOf(i),1),t[s].length==0&&r.removeNodeByKey(s);let u=Dw(i,t,n);for(;u!==null;)s=u.headIndex,t[s].splice(t[s].indexOf(u),1),c=u.tailIndex,n[c].splice(n[c].indexOf(u),1),t[s].length==0&&r.removeNodeByKey(s),i.mergeStrip(u),u=Dw(i,t,n);a.push(i),i=r.first&&r.first.value[0]}return a}class RB{constructor(){this.geometry=new mt}fromBufferGeometry(e){const t=e.getAttribute("position"),n=e.getIndex();if(t===void 0)return;const r=[];if(n!==null)hne(n.array).forEach(function(_){const x=new xd,C=new Float32Array(3*_.indexCount);_.getIndicesFlat().forEach(function(b,y){C.set(t.array.subarray(3*b,3*b+3),3*y)}),x.setGeometry(C),r.push(x)});else{const _=new xd;_.setGeometry(t.array),r.push(_)}let a=[],i=[],s=[],c=[],u=[],h=[],f=[],m=[],g=0;r.forEach(function(_){a=a.concat(_.positions),i=i.concat(_.previous),s=s.concat(_.next),c=c.concat(_.side),u=u.concat(_.width),h=h.concat(_.uvs),f=f.concat(_.counters);const x=_.indices_array.map(function(C){return C+g});m=m.concat(x),g+=_.positions.length/3}),this.geometry.setAttribute("position",new $e(new Float32Array(a),3)),this.geometry.setAttribute("previous",new $e(new Float32Array(i),3)),this.geometry.setAttribute("next",new $e(new Float32Array(s),3)),this.geometry.setAttribute("side",new $e(new Float32Array(c),1)),this.geometry.setAttribute("width",new $e(new Float32Array(u),1)),this.geometry.setAttribute("uv",new $e(new Float32Array(h),2)),this.geometry.setAttribute("counters",new $e(new Float32Array(f),1));const A=d5(m)>65535?Uint32Array:Uint16Array;this.geometry.setIndex(new $e(new A(m),1))}}class ii extends pa{constructor(e,t,n,r){super(),this.renderScene=t,this.renderCamera=n,this.selectedObjects=r!==void 0?r:[],this.visibleEdgeColor=new ct(1,1,1,1),this.hiddenEdgeColor=new ct(.1,.04,.02,1),this.edgeGlow=0,this.usePatternTexture=!1,this.edgeThickness=1,this.edgeStrength=3,this.downSampleRatio=2,this.pulsePeriod=0,this.renderToScreen=!1,this.resolution=e!==void 0?new Ee(e.x,e.y):new Ee(256,256);const a=Math.round(this.resolution.x/this.downSampleRatio),i=Math.round(this.resolution.y/this.downSampleRatio);this.renderTargetMaskBuffer=new qt(this.resolution.x,this.resolution.y),this.renderTargetMaskBuffer.texture.name="OutlinePass.mask",this.renderTargetMaskBuffer.texture.generateMipmaps=!1,this.renderTargetDepthBuffer=new qt(this.resolution.x,this.resolution.y),this.renderTargetDepthBuffer.texture.name="OutlinePass.depth",this.renderTargetDepthBuffer.texture.generateMipmaps=!1,this.renderTargetMaskDownSampleBuffer=new qt(a,i),this.renderTargetMaskDownSampleBuffer.texture.name="OutlinePass.depthDownSample",this.renderTargetMaskDownSampleBuffer.texture.generateMipmaps=!1,this.renderTargetBlurBuffer1=new qt(a,i),this.renderTargetBlurBuffer1.texture.name="OutlinePass.blur1",this.renderTargetBlurBuffer1.texture.generateMipmaps=!1,this.renderTargetBlurBuffer2=new qt(Math.round(a/2),Math.round(i/2)),this.renderTargetBlurBuffer2.texture.name="OutlinePass.blur2",this.renderTargetBlurBuffer2.texture.generateMipmaps=!1,this.edgeDetectionMaterial=this.getEdgeDetectionMaterial(),this.renderTargetEdgeBuffer1=new qt(a,i),this.renderTargetEdgeBuffer1.texture.name="OutlinePass.edge1",this.renderTargetEdgeBuffer1.texture.generateMipmaps=!1,this.renderTargetEdgeBuffer2=new qt(Math.round(a/2),Math.round(i/2)),this.renderTargetEdgeBuffer2.texture.name="OutlinePass.edge2",this.renderTargetEdgeBuffer2.texture.generateMipmaps=!1,this.separableBlurMaterial1=this.getSeparableBlurMaterial(4),this.separableBlurMaterial1.uniforms.texSize.value=new Ee(a,i),this.separableBlurMaterial1.uniforms.kernelRadius.value=1,this.separableBlurMaterial2=this.getSeparableBlurMaterial(4),this.separableBlurMaterial2.uniforms.texSize.value=new Ee(Math.round(a/2),Math.round(i/2)),this.separableBlurMaterial2.uniforms.kernelRadius.value=4,this.overlayMaterial=this.getOverlayMaterial();const s=xt.copy;this.copyUniforms=no.clone(s.uniforms),this.copyUniforms.opacity.value=1,this.materialCopy=new An({defines:Object.assign({},s.defines),uniforms:this.copyUniforms,vertexShader:s.vertexShader,fragmentShader:s.fragmentShader,blending:0,depthTest:!1,depthWrite:!1,transparent:!0}),this.enabled=!0,this.needsSwap=!1,this.oldClearColor=new Qe,this.oldClearAlpha=1,this.basic=new hr({toneMapped:!1}),this.fsQuad=new Ga(null),this.camera=new yi(-1,1,1,-1,0,1),this.tempPulseColor1=new ct,this.tempPulseColor2=new ct,this.textureMatrix=new Ve,this.visibilityState=new WeakMap,this._depthMaterial=new Ad({blending:0,depthPacking:3201,side:2}),this._maskMaterial=new Z5({side:2})}dispose(){this.renderTargetMaskBuffer.dispose(),this.renderTargetDepthBuffer.dispose(),this.renderTargetMaskDownSampleBuffer.dispose(),this.renderTargetBlurBuffer1.dispose(),this.renderTargetBlurBuffer2.dispose(),this.renderTargetEdgeBuffer1.dispose(),this.renderTargetEdgeBuffer2.dispose()}setSize(e,t){this.renderTargetMaskBuffer.setSize(e,t);let n=Math.round(e/this.downSampleRatio),r=Math.round(t/this.downSampleRatio);this.renderTargetMaskDownSampleBuffer.setSize(n,r),this.renderTargetBlurBuffer1.setSize(n,r),this.renderTargetEdgeBuffer1.setSize(n,r),this.separableBlurMaterial1.uniforms.texSize.value=new Ee(n,r),n=Math.round(n/2),r=Math.round(r/2),this.renderTargetBlurBuffer2.setSize(n,r),this.renderTargetEdgeBuffer2.setSize(n,r),this.separableBlurMaterial2.uniforms.texSize.value=new Ee(n,r)}saveVisibilityState(){const e=this;e.renderScene.traverse(function(t){(t.isMesh||t.isSprite||t.isPoints||t.isLine)&&e.visibilityState.set(t,t.visible)})}restoreVisibilityState(){const e=this;e.renderScene.traverse(function(t){(t.isMesh||t.isSprite||t.isPoints||t.isLine)&&(t.visible=e.visibilityState.get(t))})}changeVisibilityOfSelectedObjects(e){const t=this;function n(r){(r.isMesh||r.isSprite||r.isPoints||r.isLine)&&t.visibilityState.get(r)&&(r.visible=e)}for(let r=0;r<t.selectedObjects.length;r++){const a=t.selectedObjects[r];n(a);const i=a.children;for(let s=0;s<i.length;s++){const c=i[s];c.isMesh&&c.isMaterialGeneratedMesh&&n(c)}}}changeVisibilityOfNonSelectedObjects(e){const t=this,n=[];function r(a){(a.isMesh||a.isSprite||a.isPoints||a.isLine)&&t.visibilityState.get(a)&&n.push(a)}for(let a=0;a<t.selectedObjects.length;a++){const i=t.selectedObjects[a];r(i);const s=i.children;for(let c=0;c<s.length;c++){const u=s[c];u.isMesh&&u.isMaterialGeneratedMesh&&r(u)}}t.renderScene.traverse(function(a){if((a.isMesh||a.isSprite||a.isPoints||a.isLine)&&t.visibilityState.get(a)){let i=!1;for(let s=0;s<n.length;s++)if(n[s].id===a.id){i=!0;break}i||(a.visible=e)}})}updateTextureMatrix(){this.textureMatrix.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),this.textureMatrix.multiply(this.renderCamera.projectionMatrix),this.textureMatrix.multiply(this.renderCamera.matrixWorldInverse)}render(e,t,n,r,a){if(this.renderToScreen&&(this.fsQuad.material=this.basic,this.basic.map=n.texture,e.setRenderTarget(null),e.clear(),this.fsQuad.render(e)),this.selectedObjects.length===0)return;e.getClearColor(this.oldClearColor),this.oldClearAlpha=e.getClearAlpha();const i=e.autoClear;e.autoClear=!1,a&&e.context.disable(e.context.STENCIL_TEST),e.setClearColor(16777215,1);const s=this.renderScene.background;if(this.renderScene.background=null,this.renderScene.traverse(function(c){c.isAnnotationControl&&(c._doUpdateSave=c.doUpdate,c.doUpdate=!1)}),this.saveVisibilityState(),e.setRenderTarget(this.renderTargetDepthBuffer),e.clear(),this.changeVisibilityOfSelectedObjects(!1),this.changeVisibilityOfNonSelectedObjects(!0),this.renderScene.overrideMaterial=this._depthMaterial,e.render(this.renderScene,this.renderCamera),this.updateTextureMatrix(),e.setRenderTarget(this.renderTargetMaskBuffer),e.clear(),this.changeVisibilityOfSelectedObjects(!0),this.changeVisibilityOfNonSelectedObjects(!1),this.renderScene.overrideMaterial=this._maskMaterial,this.renderScene.overrideMaterial.cameraNearFar=new Ee(this.renderCamera.near,this.renderCamera.far),this.renderScene.overrideMaterial.depthTexture=this.renderTargetDepthBuffer.texture,this.renderScene.overrideMaterial.textureMatrix=this.textureMatrix,e.render(this.renderScene,this.renderCamera),this.renderScene.overrideMaterial=null,this.restoreVisibilityState(),this.renderScene.background=s,this.fsQuad.material=this.materialCopy,this.copyUniforms.tDiffuse.value=this.renderTargetMaskBuffer.texture,e.setRenderTarget(this.renderTargetMaskDownSampleBuffer),e.clear(),this.fsQuad.render(e),this.tempPulseColor1.copy(this.visibleEdgeColor),this.tempPulseColor2.copy(this.hiddenEdgeColor),this.pulsePeriod>0){const c=.625+.75*Math.cos(.01*performance.now()/this.pulsePeriod)/2;this.tempPulseColor1.multiplyScalar(c),this.tempPulseColor2.multiplyScalar(c)}this.fsQuad.material=this.edgeDetectionMaterial,this.edgeDetectionMaterial.uniforms.maskTexture.value=this.renderTargetMaskDownSampleBuffer.texture,this.edgeDetectionMaterial.uniforms.texSize.value=new Ee(this.renderTargetMaskDownSampleBuffer.width,this.renderTargetMaskDownSampleBuffer.height),this.edgeDetectionMaterial.uniforms.visibleEdgeColor.value=this.tempPulseColor1,this.edgeDetectionMaterial.uniforms.hiddenEdgeColor.value=this.tempPulseColor2,e.setRenderTarget(this.renderTargetEdgeBuffer1),e.clear(),this.fsQuad.render(e),this.fsQuad.material=this.separableBlurMaterial1,this.separableBlurMaterial1.uniforms.colorTexture.value=this.renderTargetEdgeBuffer1.texture,this.separableBlurMaterial1.uniforms.direction.value=ii.BlurDirectionX,this.separableBlurMaterial1.uniforms.kernelRadius.value=this.edgeThickness,e.setRenderTarget(this.renderTargetBlurBuffer1),e.clear(),this.fsQuad.render(e),this.separableBlurMaterial1.uniforms.colorTexture.value=this.renderTargetBlurBuffer1.texture,this.separableBlurMaterial1.uniforms.direction.value=ii.BlurDirectionY,e.setRenderTarget(this.renderTargetEdgeBuffer1),e.clear(),this.fsQuad.render(e),this.fsQuad.material=this.separableBlurMaterial2,this.separableBlurMaterial2.uniforms.colorTexture.value=this.renderTargetEdgeBuffer1.texture,this.separableBlurMaterial2.uniforms.direction.value=ii.BlurDirectionX,e.setRenderTarget(this.renderTargetBlurBuffer2),e.clear(),this.fsQuad.render(e),this.separableBlurMaterial2.uniforms.colorTexture.value=this.renderTargetBlurBuffer2.texture,this.separableBlurMaterial2.uniforms.direction.value=ii.BlurDirectionY,e.setRenderTarget(this.renderTargetEdgeBuffer2),e.clear(),this.fsQuad.render(e),this.fsQuad.material=this.overlayMaterial,this.overlayMaterial.uniforms.maskTexture.value=this.renderTargetMaskBuffer.texture,this.overlayMaterial.uniforms.edgeTexture1.value=this.renderTargetEdgeBuffer1.texture,this.overlayMaterial.uniforms.edgeTexture2.value=this.renderTargetEdgeBuffer2.texture,this.overlayMaterial.uniforms.patternTexture.value=this.patternTexture,this.overlayMaterial.uniforms.edgeStrength.value=this.edgeStrength,this.overlayMaterial.uniforms.edgeGlow.value=this.edgeGlow,this.overlayMaterial.uniforms.usePatternTexture.value=this.usePatternTexture,a&&e.context.enable(e.context.STENCIL_TEST),this.renderToScreen?e.setRenderTarget(null):e.setRenderTarget(n),this.fsQuad.render(e),e.setClearColor(this.oldClearColor,this.oldClearAlpha),e.autoClear=i,this.renderScene.traverse(function(c){c.isAnnotationControl&&(c.doUpdate=c._doUpdateSave)})}getEdgeDetectionMaterial(){return new An({type:"OutlineEdgeDetection",defines:{HIDDEN_EDGE_ALPHA:1},uniforms:{maskTexture:{value:null},texSize:{value:new Ee(.5,.5)},visibleEdgeColor:{value:new ct(1,1,1,1)},hiddenEdgeColor:{value:new ct(1,1,1,1)}},vertexShader:Ye.pp_plane_vert,fragmentShader:Ye.pp_outline_edge_frag})}getSeparableBlurMaterial(e){return new An({type:"OutlineSeparableBlur",defines:{MAX_RADIUS:e},uniforms:{colorTexture:{value:null},texSize:{value:new Ee(.5,.5)},direction:{value:new Ee(.5,.5)},kernelRadius:{value:1}},vertexShader:Ye.pp_plane_vert,fragmentShader:Ye.pp_outline_blur_frag})}getOverlayMaterial(){return new An({type:"OutlineOverlay",uniforms:{maskTexture:{value:null},edgeTexture1:{value:null},edgeTexture2:{value:null},patternTexture:{value:null},edgeStrength:{value:1},edgeGlow:{value:1},usePatternTexture:{value:0}},vertexShader:Ye.pp_plane_vert,fragmentShader:Ye.pp_outline_overlay_frag,blending:5,blendEquation:100,blendEquationAlpha:100,blendSrc:204,blendDst:205,blendSrcAlpha:201,blendDstAlpha:201,depthTest:!1,depthWrite:!1,transparent:!0})}setCamera(e){this.renderCamera=e}}ii.BlurDirectionX=new Ee(1,0),ii.BlurDirectionY=new Ee(0,1);class qg extends pa{constructor(e,t,n,r,a){super(),this.scene=e,this.camera=t,this.overrideMaterial=n,this.clearColor=r,this.clearAlpha=a!==void 0?a:0,this.clear=!0,this.clearDepth=!1,this.needsSwap=!1,this._oldClearColor=new Qe}render(e,t,n){const r=e.autoClear;let a,i;e.autoClear=!1,this.overrideMaterial!==void 0&&(i=this.scene.overrideMaterial,this.scene.overrideMaterial=this.overrideMaterial),this.clearColor&&(e.getClearColor(this._oldClearColor),a=e.getClearAlpha(),e.setClearColor(this.clearColor,this.clearAlpha)),this.clearDepth&&e.clearDepth(),e.setRenderTarget(this.renderToScreen?null:n),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),e.render(this.scene,this.camera),this.clearColor&&e.setClearColor(this._oldClearColor,a),this.overrideMaterial!==void 0&&(this.scene.overrideMaterial=i),e.autoClear=r}setCamera(e){this.camera=e}}class b0{constructor(e,t,n,r,a){this._domElement=e,this._keyCodes=Array.isArray(t)?t:[t],this._callback=n,this._repeats=r,this._period=a,this._timer=0,this._counter=0,this._keydownCb=(function(i){this._keyCodes.includes(i.code)&&(this._timer||(this._timer=window.setTimeout((function(){this._counter=0,this._timer=null}).bind(this),1e3*a)),++this._counter>=r&&(this._timer&&(window.clearTimeout(this._timer),this._timer=null),this._counter=0,this._callback()))}).bind(this),this._domElement.addEventListener("keydown",this._keydownCb,!1)}dispose(){this._domElement.removeEventListener("keydown",this._keydownCb,!1),this._timer&&window.clearTimeout(this._timer)}}class Jh extends pa{constructor(e,t,n,r){super(),this.scene=e,this.camera=t,this.sampleLevel=4,this.unbiased=!0,this.clearColor=n!==void 0?n:0,this.clearAlpha=r!==void 0?r:0,this._oldClearColor=new Qe;const a=xt.copy;this.copyUniformsAccum=no.clone(a.uniforms),this.copyMaterialAccum=new An({type:"SSAACopyAccum",defines:Object.assign({},a.defines),uniforms:this.copyUniformsAccum,vertexShader:a.vertexShader,fragmentShader:a.fragmentShader,premultipliedAlpha:!0,transparent:!0,blending:2,depthTest:!1,depthWrite:!1}),this.fsQuadAccum=new Ga(this.copyMaterialAccum),this.copyUniformsFinal=no.clone(a.uniforms),this.copyMaterialFinal=new An({type:"SSAACopyFinal",defines:Object.assign({},a.defines),uniforms:this.copyUniformsFinal,vertexShader:a.vertexShader,fragmentShader:a.fragmentShader,premultipliedAlpha:!1,transparent:!1,blending:0,depthTest:!1,depthWrite:!1}),this.fsQuadFinal=new Ga(this.copyMaterialFinal),this.iterative=!1,this.iterativeFrame=0}_getJitterOffsets(){return pne[Math.max(0,Math.min(this.sampleLevel,5))]}_isLastIterativeFrame(){const e=this._getJitterOffsets();return this.iterativeFrame==e.length-1}dispose(){this.sampleRenderTarget&&(this.sampleRenderTarget.dispose(),this.sampleRenderTarget=null,this.accumRenderTarget.dispose(),this.accumRenderTarget=null)}setSize(e,t){this.sampleRenderTarget&&(this.sampleRenderTarget.setSize(e,t),this.accumRenderTarget.setSize(e,t))}render(e,t,n){this.sampleRenderTarget||(this.sampleRenderTarget=n.clone(),this.sampleRenderTarget.texture.name="SSAARenderPass.sample",this.accumRenderTarget=n.clone(),this.accumRenderTarget.texture.name="SSAARenderPass.accum");const r=this._getJitterOffsets(),a=e.autoClear;e.autoClear=!1,e.getClearColor(this._oldClearColor);const i=e.getClearAlpha(),s=1/r.length;this.copyUniformsAccum.tDiffuse.value=this.sampleRenderTarget.texture;const c=n.width,u=n.height,h=this.camera.view?this.camera.view.offsetX:0,f=this.camera.view?this.camera.view.offsetY:0;let m,g;this.iterative?(m=this.iterativeFrame,g=performance.now()):m=0;const A=r.length;for(let _=m;_<A;_++){this.dispatchEvent({type:"iteration",frame:_});const x=r[_];this.camera.setViewOffset&&this.camera.setViewOffset(c,u,h+.0625*x[0],f+.0625*x[1],c,u);let C=s;if(this.unbiased&&(C+=.03125*((_+.5)/r.length-.5)),this.copyUniformsAccum.opacity.value=C,e.setClearColor(this.clearColor,this.clearAlpha),e.setRenderTarget(this.sampleRenderTarget),e.clear(),e.render(this.scene,this.camera),this.iterative?e.setRenderTarget(this.accumRenderTarget):e.setRenderTarget(this.renderToScreen?null:t),_===0&&(e.setClearColor(0,0),e.clear()),this.fsQuadAccum.render(e),this.iterativeFrame=_,this.iterative&&performance.now()-g>4)break}this.iterative&&(this._isLastIterativeFrame()?(this.copyUniformsFinal.tDiffuse.value=this.accumRenderTarget.texture,e.setRenderTarget(this.renderToScreen?null:t),this.fsQuadFinal.render(e),this.iterativeFrame=0):this.iterativeFrame++),this.camera.setViewOffset&&this.camera.setViewOffset(c,u,h,f,c,u),e.autoClear=a,e.setClearColor(this._oldClearColor,i)}isLastIterativeFrame(){console.error("isLastIterativeFrame() deprectated, use pass event listener instead")}setCamera(e){this.camera=e}}const pne=[[[0,0]],[[4,4],[-4,-4]],[[-2,-6],[6,-2],[-6,2],[2,6]],[[1,-3],[-1,3],[5,1],[-3,-5],[-5,5],[-7,-1],[3,7],[7,-7]],[[1,1],[-1,-3],[-3,2],[4,-1],[-5,-2],[2,5],[5,3],[3,-5],[-2,6],[0,-7],[-4,-6],[-6,4],[-8,0],[7,-4],[6,7],[-7,-8]],[[-4,-7],[-7,-5],[-3,-5],[-5,-4],[-1,-4],[-2,-2],[-6,-1],[-4,0],[-7,1],[-1,2],[-6,3],[-3,3],[-7,6],[-3,6],[-5,7],[-1,7],[5,-7],[1,-6],[6,-5],[4,-4],[2,-3],[7,-2],[1,-1],[4,-1],[2,1],[6,2],[0,4],[4,4],[2,5],[7,5],[5,6],[3,7]]];class IB extends pa{constructor(e,t,n){super(),this.enabled=!0,this.needsSwap=!1,n=n||{},this.objects=n.objects||[],this.steps=_e(n.steps)||10,this.stride=_e(n.stride)||30,this.binarySearchSteps=_e(n.binarySearchSteps)||4,this.renderTargetScale=_e(n.renderTargetScale)||.5,this.thickness=_e(n.thickness)||.01,this.maxDistance=_e(n.maxDistance)||100,this.jitter=_e(n.jitter)||1,this.useRefract=_e(n.useRefract)||!1,this.renderAfter=_e(n.renderAfter)||[],this.simpleRefraction=_e(n.simpleRefraction)||!1,this.scene=e,this.camera=t,this._prevClearColor=new Qe,this._depthBuffer=new qt(256,256,{minFilter:1003,magFilter:1003,format:1023,type:1016}),this._depthBuffer.texture.name="SSRPass.Depth",this._depthBuffer.texture.generateMipmaps=!1,this._depthMaterial=new Ad,this._depthMaterial.depthPacking=3202,this._backfaceDepthBuffer=this._depthBuffer.clone(),this._backfaceDepthBuffer.texture.name="SSRPass.Depth",this._backfaceDepthMaterial=new Ad,this._backfaceDepthMaterial.depthPacking=3202,this._backfaceDepthMaterial.side=1,this.basic=new hr,this.fsQuad=new Ga(null)}_setLayer(e,t){e.layers.set(t),e.isMesh&&e.isMaterialGeneratedMesh&&e.parent.layers.enable(t)}dispose(){this._depthBuffer.dispose(),this._backfaceDepthBuffer.dispose();for(let e=0;e<this.objects.length;e++){const t=this.objects[e],n=t.material;n&&(this._setLayer(t,0),delete n.defines.USE_SSR,delete n.defines.USE_SSR_REFRACT,delete n.defines.SSR_SIMPLE_REFRACT,delete n.defines.MAX_STEPS,delete n.defines.BINARY_SEARCH_ITERATIONS,n.ssrParams=null,n.needsUpdate=!0)}this.objects.splice(0);for(let e=0;e<this.renderAfter.length;e++){const t=this.renderAfter[e];this._setLayer(t,0)}this.renderAfter.splice(0)}setCamera(e){this.camera=e}setSize(e,t){e*=this.renderTargetScale,t*=this.renderTargetScale,this._depthBuffer.setSize(e,t),this._backfaceDepthBuffer.setSize(e,t)}_assignMaterialParams(e,t){e.ssrParams=e.ssrParams||{};const n=e.ssrParams;n.invProjectionMatrix=n.invProjectionMatrix||new Ve,n.invProjectionMatrix.copy(this.camera.projectionMatrix).invert(),n.sourceBuffer=t,n.depthBuffer=this._depthBuffer,n.backfaceDepthBuffer=this._backfaceDepthBuffer,n.stride=this.stride,n.thickness=this.thickness,n.maxDistance=this.maxDistance,n.jitter=this.jitter}render(e,t,n,r,a){e.getClearColor(this._prevClearColor);const i=e.getClearAlpha(),s=e.autoClear;e.autoClear=!0,e.setClearColor(0,0);const c=this.scene.background;this.scene.background=null;const u=this.camera.layers.mask,h=this.camera.ignoreShadowLayers,f=this.scene.overrideMaterial;this.fsQuad.material=this.basic,this.basic.map=n.texture,e.setRenderTarget(t),e.clear(),this.fsQuad.render(e),this.useRefract||(this._depthMaterial.side=2),this.camera.layers.enable(this.useRefract?3:5),this.useRefract&&this.simpleRefraction||(this.scene.overrideMaterial=this._depthMaterial,e.setRenderTarget(this._depthBuffer),e.clear(),e.render(this.scene,this.camera)),this.useRefract||(this.scene.overrideMaterial=this._backfaceDepthMaterial,e.setRenderTarget(this._backfaceDepthBuffer),e.clear(),e.render(this.scene,this.camera)),this.scene.overrideMaterial=f,this.scene.traverse(m=>{m.isLight&&(m.userData.oldLayersMask=m.layers.mask,m.layers.enable(this.useRefract?5:3),this.renderAfter.length&&m.layers.enable(this.useRefract?6:4))});for(let m=0;m<this.objects.length;m++){const g=this.objects[m],A=g.material;A&&A.isMeshNodeMaterial&&(this._setLayer(g,this.useRefract?5:3),_e(A.defines.USE_SSR)||(A.defines.USE_SSR="",A.needsUpdate=!0),this.useRefract&&(_e(A.defines.USE_SSR_REFRACT)||(A.defines.USE_SSR_REFRACT="",A.needsUpdate=!0),this.simpleRefraction&&(_e(A.defines.SSR_SIMPLE_REFRACT)||(A.defines.SSR_SIMPLE_REFRACT="",A.needsUpdate=!0))),A.defines.MAX_STEPS!==this.steps&&(A.defines.MAX_STEPS=Math.floor(this.steps),A.needsUpdate=!0),A.defines.BINARY_SEARCH_ITERATIONS!==this.binarySearchSteps&&(A.defines.BINARY_SEARCH_ITERATIONS=Math.floor(this.binarySearchSteps),A.needsUpdate=!0),this._assignMaterialParams(A,t))}for(let m=0;m<this.renderAfter.length;m++){const g=this.renderAfter[m];this._setLayer(g,this.useRefract?6:4)}this.camera.layers.set(this.useRefract?5:3),this.camera.ignoreShadowLayers=!0,e.autoClear=!1,e.setRenderTarget(n),e.render(this.scene,this.camera),this.renderAfter.length&&(this.camera.layers.set(this.useRefract?6:4),e.render(this.scene,this.camera)),this.scene.background=c,this.camera.layers.mask=u,this.camera.ignoreShadowLayers=h,this.scene.traverse(m=>{m.isLight&&"oldLayersMask"in m.userData&&(m.layers.mask=m.userData.oldLayersMask,delete m.userData.oldLayersMask)}),this.renderToScreen&&(this.fsQuad.material=this.basic,this.basic.map=n.texture,e.setRenderTarget(null),e.clear(),this.fsQuad.render(e)),e.setClearColor(this._prevClearColor,i),e.autoClear=s}}class hb extends ms{constructor(){super(xt.tonemap),this.material.type="ToneMap"}}var Ow=function(o){return URL.createObjectURL(new Blob([o],{type:"text/javascript"}))};try{URL.revokeObjectURL(Ow(""))}catch{Ow=function(e){return"data:application/javascript;charset=UTF-8,"+encodeURI(e)}}var bo=Uint8Array,yo=Uint16Array,yd=Uint32Array,pb=new bo([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),mb=new bo([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),Fw=new bo([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),LB=function(o,e){for(var t=new yo(31),n=0;n<31;++n)t[n]=e+=1<<o[n-1];var r=new yd(t[30]);for(n=1;n<30;++n)for(var a=t[n];a<t[n+1];++a)r[a]=a-t[n]<<5|n;return[t,r]},BB=LB(pb,2),mne=BB[0],B2=BB[1];mne[28]=258,B2[258]=28;for(var gne=LB(mb,0),Uw=gne[1],PB=new yo(32768),Tn=0;Tn<32768;++Tn){var oc=(43690&Tn)>>>1|(21845&Tn)<<1;oc=(61680&(oc=(52428&oc)>>>2|(13107&oc)<<2))>>>4|(3855&oc)<<4,PB[Tn]=((65280&oc)>>>8|(255&oc)<<8)>>>1}var Sh=function(o,e,t){for(var n=o.length,r=0,a=new yo(e);r<n;++r)++a[o[r]-1];var i,s=new yo(e);for(r=0;r<e;++r)s[r]=s[r-1]+a[r-1]<<1;for(i=new yo(n),r=0;r<n;++r)o[r]&&(i[r]=PB[s[o[r]-1]++]>>>15-o[r]);return i},Pc=new bo(288);for(Tn=0;Tn<144;++Tn)Pc[Tn]=8;for(Tn=144;Tn<256;++Tn)Pc[Tn]=9;for(Tn=256;Tn<280;++Tn)Pc[Tn]=7;for(Tn=280;Tn<288;++Tn)Pc[Tn]=8;var Zg=new bo(32);for(Tn=0;Tn<32;++Tn)Zg[Tn]=5;var vne=Sh(Pc,9),_ne=Sh(Zg,5),NB=function(o){return(o/8|0)+(7&o&&1)},DB=function(o,e,t){(t==null||t>o.length)&&(t=o.length);var n=new(o instanceof yo?yo:o instanceof yd?yd:bo)(t-e);return n.set(o.subarray(e,t)),n},$i=function(o,e,t){t<<=7&e;var n=e/8|0;o[n]|=t,o[n+1]|=t>>>8},Hf=function(o,e,t){t<<=7&e;var n=e/8|0;o[n]|=t,o[n+1]|=t>>>8,o[n+2]|=t>>>16},nx=function(o,e){for(var t=[],n=0;n<o.length;++n)o[n]&&t.push({s:n,f:o[n]});var r=t.length,a=t.slice();if(!r)return[OB,0];if(r==1){var i=new bo(t[0].s+1);return i[t[0].s]=1,[i,1]}t.sort(function(R,T){return R.f-T.f}),t.push({s:-1,f:25001});var s=t[0],c=t[1],u=0,h=1,f=2;for(t[0]={s:-1,f:s.f+c.f,l:s,r:c};h!=r-1;)s=t[t[u].f<t[f].f?u++:f++],c=t[u!=h&&t[u].f<t[f].f?u++:f++],t[h++]={s:-1,f:s.f+c.f,l:s,r:c};var m=a[0].s;for(n=1;n<r;++n)a[n].s>m&&(m=a[n].s);var g=new yo(m+1),A=P2(t[h-1],g,0);if(A>e){n=0;var _=0,x=A-e,C=1<<x;for(a.sort(function(R,T){return g[T.s]-g[R.s]||R.f-T.f});n<r;++n){var b=a[n].s;if(!(g[b]>e))break;_+=C-(1<<A-g[b]),g[b]=e}for(_>>>=x;_>0;){var y=a[n].s;g[y]<e?_-=1<<e-g[y]++-1:++n}for(;n>=0&&_;--n){var M=a[n].s;g[M]==e&&(--g[M],++_)}A=e}return[new bo(g),A]},P2=function(o,e,t){return o.s==-1?Math.max(P2(o.l,e,t+1),P2(o.r,e,t+1)):e[o.s]=t},zw=function(o){for(var e=o.length;e&&!o[--e];);for(var t=new yo(++e),n=0,r=o[0],a=1,i=function(c){t[n++]=c},s=1;s<=e;++s)if(o[s]==r&&s!=e)++a;else{if(!r&&a>2){for(;a>138;a-=138)i(32754);a>2&&(i(a>10?a-11<<5|28690:a-3<<5|12305),a=0)}else if(a>3){for(i(r),--a;a>6;a-=6)i(8304);a>2&&(i(a-3<<5|8208),a=0)}for(;a--;)i(r);a=1,r=o[s]}return[t.subarray(0,n),e]},Wf=function(o,e){for(var t=0,n=0;n<e.length;++n)t+=o[n]*e[n];return t},N2=function(o,e,t){var n=t.length,r=NB(e+2);o[r]=255&n,o[r+1]=n>>>8,o[r+2]=255^o[r],o[r+3]=255^o[r+1];for(var a=0;a<n;++a)o[r+a+4]=t[a];return 8*(r+4+n)},Vw=function(o,e,t,n,r,a,i,s,c,u,h){$i(e,h++,t),++r[256];for(var f=nx(r,15),m=f[0],g=f[1],A=nx(a,15),_=A[0],x=A[1],C=zw(m),b=C[0],y=C[1],M=zw(_),R=M[0],T=M[1],w=new yo(19),D=0;D<b.length;++D)w[31&b[D]]++;for(D=0;D<R.length;++D)w[31&R[D]]++;for(var z=nx(w,7),F=z[0],O=z[1],q=19;q>4&&!F[Fw[q-1]];--q);var ne,$,he,K,oe=u+5<<3,ie=Wf(r,Pc)+Wf(a,Zg)+i,L=Wf(r,m)+Wf(a,_)+i+14+3*q+Wf(w,F)+(2*w[16]+3*w[17]+7*w[18]);if(oe<=ie&&oe<=L)return N2(e,h,o.subarray(c,c+u));if($i(e,h,1+(L<ie)),h+=2,L<ie){ne=Sh(m,g),$=m,he=Sh(_,x),K=_;var U=Sh(F,O);for($i(e,h,y-257),$i(e,h+5,T-1),$i(e,h+10,q-4),h+=14,D=0;D<q;++D)$i(e,h+3*D,F[Fw[D]]);h+=3*q;for(var k=[b,R],J=0;J<2;++J){var de=k[J];for(D=0;D<de.length;++D){var te=31&de[D];$i(e,h,U[te]),h+=F[te],te>15&&($i(e,h,de[D]>>>5&127),h+=de[D]>>>12)}}}else ne=vne,$=Pc,he=_ne,K=Zg;for(D=0;D<s;++D)if(n[D]>255){te=n[D]>>>18&31,Hf(e,h,ne[te+257]),h+=$[te+257],te>7&&($i(e,h,n[D]>>>23&31),h+=pb[te]);var le=31&n[D];Hf(e,h,he[le]),h+=K[le],le>3&&(Hf(e,h,n[D]>>>5&8191),h+=mb[le])}else Hf(e,h,ne[n[D]]),h+=$[n[D]];return Hf(e,h,ne[256]),h+$[256]},Ane=new yd([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),OB=new bo(0),xne=function(o,e,t,n,r,a){var i=o.length,s=new bo(n+i+5*(1+Math.ceil(i/7e3))+r),c=s.subarray(n,s.length-r),u=0;if(!e||i<8)for(var h=0;h<=i;h+=65535){var f=h+65535;f<i?u=N2(c,u,o.subarray(h,f)):(c[h]=a,u=N2(c,u,o.subarray(h,i)))}else{for(var m=Ane[e-1],g=m>>>13,A=8191&m,_=(1<<t)-1,x=new yo(32768),C=new yo(_+1),b=Math.ceil(t/3),y=2*b,M=function(P){return(o[P]^o[P+1]<<b^o[P+2]<<y)&_},R=new yd(25e3),T=new yo(288),w=new yo(32),D=0,z=0,F=(h=0,0),O=0,q=0;h<i;++h){var ne=M(h),$=32767&h,he=C[ne];if(x[$]=he,C[ne]=$,O<=h){var K=i-h;if((D>7e3||F>24576)&&K>423){u=Vw(o,c,0,R,T,w,z,F,q,h-q,u),F=D=z=0,q=h;for(var oe=0;oe<286;++oe)T[oe]=0;for(oe=0;oe<30;++oe)w[oe]=0}var ie=2,L=0,U=A,k=$-he&32767;if(K>2&&ne==M(h-k))for(var J=Math.min(g,K)-1,de=Math.min(32767,h),te=Math.min(258,K);k<=de&&--U&&$!=he;){if(o[h+ie]==o[h+ie-k]){for(var le=0;le<te&&o[h+le]==o[h+le-k];++le);if(le>ie){if(ie=le,L=k,le>J)break;var V=Math.min(k,le-2),G=0;for(oe=0;oe<V;++oe){var ee=h-k+oe+32768&32767,X=ee-x[ee]+32768&32767;X>G&&(G=X,he=ee)}}}k+=($=he)-(he=x[$])+32768&32767}if(L){R[F++]=268435456|B2[ie]<<18|Uw[L];var W=31&B2[ie],Y=31&Uw[L];z+=pb[W]+mb[Y],++T[257+W],++w[Y],O=h+ie,++D}else R[F++]=o[h],++T[o[h]]}}u=Vw(o,c,a,R,T,w,z,F,q,h-q,u)}return DB(s,0,n+NB(u)+r)},yne=function(){for(var o=new yd(256),e=0;e<256;++e){for(var t=e,n=9;--n;)t=(1&t&&3988292384)^t>>>1;o[e]=t}return o}(),bne=function(){var o=-1;return{p:function(e){for(var t=o,n=0;n<e.length;++n)t=yne[255&t^e[n]]^t>>>8;o=t},d:function(){return~o}}},Sne=function(o,e,t,n,r){return xne(o,e.level==null?6:e.level,e.mem==null?Math.ceil(1.5*Math.max(8,Math.min(13,Math.log(o.length)))):12+e.mem,t,n,!0)},FB=function(o,e){var t={};for(var n in o)t[n]=o[n];for(var n in e)t[n]=e[n];return t},Pr=function(o,e,t){for(;t;++e)o[e]=t,t>>>=8};function Cne(o,e){return Sne(o,e||{},0,0)}var UB=function(o,e,t,n){for(var r in o){var a=o[r],i=e+r;a instanceof bo?t[i]=[a,n]:Array.isArray(a)?t[i]=[a[0],FB(n,a[1])]:UB(a,i+"/",t,n)}},kw=typeof TextEncoder<"u"&&new TextEncoder,Ene=typeof TextDecoder<"u"&&new TextDecoder,Mne=0;try{Ene.decode(OB,{stream:!0}),Mne=1}catch{}function Kg(o,e){if(kw)return kw.encode(o);for(var t=o.length,n=new bo(o.length+(o.length>>1)),r=0,a=function(u){n[r++]=u},i=0;i<t;++i){if(r+5>n.length){var s=new bo(r+8+(t-i<<1));s.set(n),n=s}var c=o.charCodeAt(i);c<128||e?a(c):c<2048?(a(192|c>>6),a(128|63&c)):c>55295&&c<57344?(a(240|(c=65536+(1047552&c)|1023&o.charCodeAt(++i))>>18),a(128|c>>12&63),a(128|c>>6&63),a(128|63&c)):(a(224|c>>12),a(128|c>>6&63),a(128|63&c))}return DB(n,0,r)}var D2=function(o){var e=0;if(o)for(var t in o){var n=o[t].length;if(n>65535)throw"extra field too long";e+=n+4}return e},Gw=function(o,e,t,n,r,a,i,s){var c=n.length,u=t.extra,h=s&&s.length,f=D2(u);Pr(o,e,i!=null?33639248:67324752),e+=4,i!=null&&(o[e++]=20,o[e++]=t.os),o[e]=20,e+=2,o[e++]=t.flag<<1|(a==null&&8),o[e++]=r&&8,o[e++]=255&t.compression,o[e++]=t.compression>>8;var m=new Date(t.mtime==null?Date.now():t.mtime),g=m.getFullYear()-1980;if(g<0||g>119)throw"date not in range 1980-2099";if(Pr(o,e,g<<25|m.getMonth()+1<<21|m.getDate()<<16|m.getHours()<<11|m.getMinutes()<<5|m.getSeconds()>>>1),e+=4,a!=null&&(Pr(o,e,t.crc),Pr(o,e+4,a),Pr(o,e+8,t.size)),Pr(o,e+12,c),Pr(o,e+14,f),e+=16,i!=null&&(Pr(o,e,h),Pr(o,e+6,t.attrs),Pr(o,e+10,i),e+=14),o.set(n,e),e+=c,f)for(var A in u){var _=u[A],x=_.length;Pr(o,e,+A),Pr(o,e+2,x),o.set(_,e+4),e+=4+x}return h&&(o.set(s,e),e+=h),e},wne=function(o,e,t,n,r){Pr(o,e,101010256),Pr(o,e+8,t),Pr(o,e+10,t),Pr(o,e+12,n),Pr(o,e+16,r)};function Tne(o,e){e||(e={});var t={},n=[];UB(o,"",t,e);var r=0,a=0;for(var i in t){var s=t[i],c=s[0],u=s[1],h=u.level==0?0:8,f=(w=Kg(i)).length,m=u.comment,g=m&&Kg(m),A=g&&g.length,_=D2(u.extra);if(f>65535)throw"filename too long";var x=h?Cne(c,u):c,C=x.length,b=bne();b.p(c),n.push(FB(u,{size:c.length,crc:b.d(),c:x,f:w,m:g,u:f!=i.length||g&&m.length!=A,o:r,compression:h})),r+=30+f+_+C,a+=76+2*(f+_)+(A||0)+C}for(var y=new bo(a+22),M=r,R=a-r,T=0;T<n.length;++T){var w=n[T];Gw(y,w.o,w,w.f,w.u,w.c.length);var D=30+w.f.length+D2(w.extra);y.set(w.c,w.o+D),Gw(y,r,w,w.f,w.u,w.c.length,w.o,w.m),r+=16+D+(w.m?w.m.length:0)}return wne(y,r,n.length,R,M),y}class zB{async parse(e,t={}){t=Object.assign({ar:{anchoring:{type:"plane"},planeAnchoring:{alignment:"horizontal"}},quickLookCompatible:!0,maxTextureSize:1024},t);const n={},r="model.usda";n[r]=null;let a=VB();a+=Ine(t);const i={},s={};e.traverseVisible(u=>{if(u.isMesh){const h=u.geometry,f=u.material;if(f.isMeshNodeMaterial||f.isMeshStandardMaterial){const m="geometries/Geometry_"+h.id+".usda";if(!(m in n)){const g=Nne(h);n[m]=Bne(g)}f.uuid in i||(i[f.uuid]=f),a+=Pne(u,h,f)}else console.warn("v3d.USDZExporter: Unsupported material type (USDZ only supports MeshNodeMaterial and MeshStandardMaterial)",u)}else u.isCamera&&(a+=Qne(u))}),a+=Lne(),a+=Vne(i,s,t.quickLookCompatible),n[r]=Kg(a),a=null;for(const u in s){let h=s[u];h.isCompressedTexture===!0&&(h=pg(h));const f=Rne(h.image,h.flipY,t.maxTextureSize),m=await new Promise(g=>f.toBlob(g,"image/png",1));n[`textures/Texture_${u}.png`]=new Uint8Array(await m.arrayBuffer())}let c=0;for(const u in n){const h=n[u];c+=34+u.length;const f=63&c;if(f!==4){const m=new Uint8Array(64-f);n[u]=[h,{extra:{12345:m}}]}c=h.length}return Tne(n,{level:0})}}function Rne(o,e,t){if(typeof HTMLImageElement<"u"&&o instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&o instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&o instanceof OffscreenCanvas||typeof ImageBitmap<"u"&&o instanceof ImageBitmap){const n=t/Math.max(o.width,o.height),r=document.createElement("canvas");r.width=o.width*Math.min(1,n),r.height=o.height*Math.min(1,n);const a=r.getContext("2d");return e===!0&&(a.translate(0,r.height),a.scale(1,-1)),a.drawImage(o,0,0,r.width,r.height),r}throw new Error("v3d.USDZExporter: No valid image data found. Unable to process texture.")}const Gr=7;function VB(){return`#usda 1.0
(
    customLayerData = {
        string creator = "Verge3D"
    }
    defaultPrim = "Root"
    metersPerUnit = 1
    upAxis = "Y"
)

`}function Ine(o){return`def Xform "Root"
{
    def Scope "Scenes" (
        kind = "sceneLibrary"
    )
    {
        def Xform "Scene" (
            customData = {
                bool preliminary_collidesWithEnvironment = 0
                string sceneName = "Scene"
            }
            sceneName = "Scene"
        )
        {
        token preliminary:anchoring:type = "${o.ar.anchoring.type}"
        token preliminary:planeAnchoring:alignment = "${o.ar.planeAnchoring.alignment}"

`}function Lne(){return`
        }
    }
}

`}function Bne(o){let e=VB();return e+=o,Kg(e)}function Pne(o,e,t){const n="Object_"+o.id,r=kB(o.matrixWorld);return o.matrixWorld.determinant()<0&&console.warn("v3d.USDZExporter: USDZ does not support negative scales",o),`def Xform "${n}" (
    prepend references = @./geometries/Geometry_${e.id}.usda@</Geometry>
    prepend apiSchemas = ["MaterialBindingAPI"]
)
{
    matrix4d xformOp:transform = ${r}
    uniform token[] xformOpOrder = ["xformOp:transform"]

    rel material:binding = </Materials/Material_${t.id}>
}

`}function kB(o){const e=o.elements;return`(${S0(e,0)}, ${S0(e,4)}, ${S0(e,8)}, ${S0(e,12)})`}function S0(o,e){return`(${o[e+0]}, ${o[e+1]}, ${o[e+2]}, ${o[e+3]})`}function Nne(o){return`
def "Geometry"
{
${Dne(o)}
}
`}function Dne(o){const e=o.attributes,t=e.position.count;return`
    def Mesh "Geometry"
    {
        int[] faceVertexCounts = [${One(o)}]
        int[] faceVertexIndices = [${Fne(o)}]
        normal3f[] normals = [${O2(e.normal,t)}] (
            interpolation = "vertex"
        )
        point3f[] points = [${O2(e.position,t)}]
${zne(e)}
        uniform token subdivisionScheme = "none"
    }
`}function One(o){const e=o.index!==null?o.index.count:o.attributes.position.count;return Array(e/3).fill(3).join(", ")}function Fne(o){const e=o.index,t=[];if(e!==null)for(let n=0;n<e.count;n++)t.push(e.getX(n));else{const n=o.attributes.position.count;for(let r=0;r<n;r++)t.push(r)}return t.join(", ")}function O2(o,e){if(o===void 0)return console.warn("USDZExporter: Normals missing."),Array(e).fill("(0, 0, 0)").join(", ");const t=[];for(let n=0;n<o.count;n++){const r=o.getX(n),a=o.getY(n),i=o.getZ(n);t.push(`(${r.toPrecision(Gr)}, ${a.toPrecision(Gr)}, ${i.toPrecision(Gr)})`)}return t.join(", ")}function Une(o){const e=[];for(let t=0;t<o.count;t++){const n=o.getX(t),r=o.getY(t);e.push(`(${n.toPrecision(Gr)}, ${1-r.toPrecision(Gr)})`)}return e.join(", ")}function zne(o){let e="";for(let n=0;n<4;n++){const r=n>0?n:"",a=o["uv"+r];a!==void 0&&(e+=`
        texCoord2f[] primvars:st${r} = [${Une(a)}] (
            interpolation = "vertex"
        )`)}const t=o.color;return t!==void 0&&(e+=`
    color3f[] primvars:displayColor = [${O2(t,t.count)}] (
        interpolation = "vertex"
        )`),e}function Vne(o,e,t=!1){const n=[];for(const r in o){const a=o[r];n.push(kne(a,e,t))}return`def "Materials"
{
${n.join("")}
}

`}function kne(o,e,t=!1){const n="            ",r=[],a=[];function i(M,R,T){const w=M.source.id+(M.flipY?"_flipped":"");e[w]=M;const D={1e3:"repeat",1001:"clamp",1002:"mirror"},z=M.repeat.clone(),F=M.offset.clone(),O=M.rotation,q=Math.sin(O),ne=Math.cos(O);return F.y=1-F.y-z.y,t?(F.x=F.x/z.x,F.y=F.y/z.y,F.x+=q/z.x,F.y+=ne-1):(F.x+=q*z.x,F.y+=(1-ne)*z.y),`
        def Shader "PrimvarReader_${R}"
        {
            uniform token info:id = "UsdPrimvarReader_float2"
            float2 inputs:fallback = (0.0, 0.0)
            token inputs:varname = "st"
            float2 outputs:result
        }

        def Shader "Transform2d_${R}"
        {
            uniform token info:id = "UsdTransform2d"
            token inputs:in.connect = </Materials/Material_${o.id}/PrimvarReader_${R}.outputs:result>
            float inputs:rotation = ${(O*(180/Math.PI)).toFixed(Gr)}
            float2 inputs:scale = ${Hw(z)}
            float2 inputs:translation = ${Hw(F)}
            float2 outputs:result
        }

        def Shader "Texture_${M.id}_${R}"
        {
            uniform token info:id = "UsdUVTexture"
            asset inputs:file = @textures/Texture_${w}.png@
            float2 inputs:st.connect = </Materials/Material_${o.id}/Transform2d_${R}.outputs:result>
            ${T!==void 0?"float4 inputs:scale = "+Gne(T):""}
            token inputs:sourceColorSpace = "${M.encoding===3e3?"raw":"sRGB"}"
            token inputs:wrapS = "${D[M.wrapS]}"
            token inputs:wrapT = "${D[M.wrapT]}"
            float outputs:r
            float outputs:g
            float outputs:b
            float3 outputs:rgb
            ${o.transparent||o.alphaTest>0?"float outputs:a":""}
        }`}o.side===2&&console.warn("v3d.USDZExporter: USDZ does not support double sided materials",o);const s=o.isMeshNodeMaterial?o.getStandardProp("map"):o.map,c=o.isMeshNodeMaterial?o.getStandardProp("color"):o.color;s!==null?(r.push(`${n}color3f inputs:diffuseColor.connect = </Materials/Material_${o.id}/Texture_${s.id}_diffuse.outputs:rgb>`),o.transparent?r.push(`${n}float inputs:opacity.connect = </Materials/Material_${o.id}/Texture_${s.id}_diffuse.outputs:a>`):o.alphaTest>0&&(r.push(`${n}float inputs:opacity.connect = </Materials/Material_${o.id}/Texture_${s.id}_diffuse.outputs:a>`),r.push(`${n}float inputs:opacityThreshold = ${o.alphaTest}`)),a.push(i(s,"diffuse",c))):r.push(`${n}color3f inputs:diffuseColor = ${Qw(c)}`);const u=o.isMeshNodeMaterial?o.getStandardProp("emissiveMap"):o.emissiveMap,h=o.isMeshNodeMaterial?o.getStandardProp("emissiveIntensity"):o.emissiveIntensity;let f=o.isMeshNodeMaterial?o.getStandardProp("emissive"):o.emissive;f=f.clone().multiplyScalar(h),u!==null?(r.push(`${n}color3f inputs:emissiveColor.connect = </Materials/Material_${o.id}/Texture_${u.id}_emissive.outputs:rgb>`),a.push(i(u,"emissive"))):f.getHex()>0&&r.push(`${n}color3f inputs:emissiveColor = ${Qw(f)}`);const m=o.isMeshNodeMaterial?o.getStandardProp("normalMap"):o.normalMap;m!==null&&(r.push(`${n}normal3f inputs:normal.connect = </Materials/Material_${o.id}/Texture_${m.id}_normal.outputs:rgb>`),a.push(i(m,"normal")));const g=o.isMeshNodeMaterial?o.getStandardProp("aoMap"):o.aoMap;g!==null&&(r.push(`${n}float inputs:occlusion.connect = </Materials/Material_${o.id}/Texture_${g.id}_occlusion.outputs:r>`),a.push(i(g,"occlusion")));const A=o.isMeshNodeMaterial?o.getStandardProp("roughnessMap"):o.roughnessMap,_=o.isMeshNodeMaterial?o.getStandardProp("roughness"):o.roughness;A!==null&&_===1?(r.push(`${n}float inputs:roughness.connect = </Materials/Material_${o.id}/Texture_${A.id}_roughness.outputs:g>`),a.push(i(A,"roughness"))):r.push(`${n}float inputs:roughness = ${_}`);const x=o.isMeshNodeMaterial?o.getStandardProp("metalnessMap"):o.metalnessMap,C=o.isMeshNodeMaterial?o.getStandardProp("metalness"):o.metalness;x!==null&&C===1?(r.push(`${n}float inputs:metallic.connect = </Materials/Material_${o.id}/Texture_${x.id}_metallic.outputs:b>`),a.push(i(x,"metallic"))):r.push(`${n}float inputs:metallic = ${C}`);const b=o.isMeshNodeMaterial?o.getStandardProp("alphaMap"):o.alphaMap,y=o.isMeshNodeMaterial?o.getStandardProp("opacity"):o.opacity;return b!==null?(r.push(`${n}float inputs:opacity.connect = </Materials/Material_${o.id}/Texture_${b.id}_opacity.outputs:r>`),r.push(`${n}float inputs:opacityThreshold = 0.0001`),a.push(i(b,"opacity"))):r.push(`${n}float inputs:opacity = ${y}`),o.isMeshPhysicalMaterial&&(r.push(`${n}float inputs:clearcoat = ${o.clearcoat}`),r.push(`${n}float inputs:clearcoatRoughness = ${o.clearcoatRoughness}`),r.push(`${n}float inputs:ior = ${o.ior}`)),`
    def Material "Material_${o.id}"
    {
        def Shader "PreviewSurface"
        {
            uniform token info:id = "UsdPreviewSurface"
${r.join(`
`)}
            int inputs:useSpecularWorkflow = 0
            token outputs:surface
        }

        token outputs:surface.connect = </Materials/Material_${o.id}/PreviewSurface.outputs:surface>

${a.join(`
`)}

    }
`}function Qw(o){return`(${o.r}, ${o.g}, ${o.b})`}function Gne(o){return`(${o.r}, ${o.g}, ${o.b}, 1.0)`}function Hw(o){return`(${o.x}, ${o.y})`}function Qne(o){const e=o.name?o.name:"Camera_"+o.id,t=kB(o.matrixWorld);return o.matrixWorld.determinant()<0&&console.warn("v3d.USDZExporter: USDZ does not support negative scales",o),o.isOrthographicCamera?`def Camera "${e}"
        {
            matrix4d xformOp:transform = ${t}
            uniform token[] xformOpOrder = ["xformOp:transform"]

            float2 clippingRange = (${o.near.toPrecision(Gr)}, ${o.far.toPrecision(Gr)})
            float horizontalAperture = ${(10*(Math.abs(o.left)+Math.abs(o.right))).toPrecision(Gr)}
            float verticalAperture = ${(10*(Math.abs(o.top)+Math.abs(o.bottom))).toPrecision(Gr)}
            token projection = "orthographic"
        }

    `:`def Camera "${e}"
        {
            matrix4d xformOp:transform = ${t}
            uniform token[] xformOpOrder = ["xformOp:transform"]

            float2 clippingRange = (${o.near.toPrecision(Gr)}, ${o.far.toPrecision(Gr)})
            float focalLength = ${o.getFocalLength().toPrecision(Gr)}
            float focusDistance = ${o.focus.toPrecision(Gr)}
            float horizontalAperture = ${o.getFilmWidth().toPrecision(Gr)}
            token projection = "perspective"
            float verticalAperture = ${o.getFilmHeight().toPrecision(Gr)}
        }

    `}var Je={BACKSPACE:8,TAB:9,ENTER:13,SHIFT:16,CTRL:17,ALT:18,PAUSE_BREAK:19,CAPS_LOCK:20,ESCAPE:27,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT_ARROW:37,UP_ARROW:38,RIGHT_ARROW:39,DOWN_ARROW:40,INSERT:45,DELETE:46,0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,LEFT_WINDOW_KEY:91,RIGHT_WINDOW_KEY:92,SELECT_KEY:93,NUMPAD_0:96,NUMPAD_1:97,NUMPAD_2:98,NUMPAD_3:99,NUMPAD_4:100,NUMPAD_5:101,NUMPAD_6:102,NUMPAD_7:103,NUMPAD_8:104,NUMPAD_9:105,MULTIPLY:106,ADD:107,SUBTRACT:109,DECIMAL_POINT:110,DIVIDE:111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,NUM_LOCK:144,SCROLL_LOCK:145,SEMI_COLON:186,EQUAL_SIGN:187,COMMA:188,DASH:189,PERIOD:190,FORWARD_SLASH:191,GRAVE_ACCENT:192,OPEN_BRACKET:219,BACK_SLASH:220,CLOSE_BRAKET:221,SINGLE_QUOTE:222};class gb{constructor(e,t=null){this.isKeyDown={};for(const n in Je)this.isKeyDown[Je[n]]=!1;if(this.onKeyDown=null,this.onKeyUp=null,this._domElement=e,this._keydownCb=(function(n){this.isKeyDown[n.keyCode]=!0,this.onKeyDown&&this.onKeyDown(n)}).bind(this),this._keyupCb=(function(n){this.isKeyDown[n.keyCode]=!1,this.onKeyUp&&this.onKeyUp(n)}).bind(this),this._mobileControlTouchStartCb=(function(n){this._keydownCb({keyCode:Je.W})}).bind(this),this._mobileControlTouchEndCb=(function(n){this._keyupCb({keyCode:Je.W})}).bind(this),this._domElement.addEventListener("keydown",this._keydownCb,!1),this._domElement.addEventListener("keyup",this._keyupCb,!1),t&&Wn.isTouchDevice()){const n=document.createElement("div");n.className="v3d-mobile-forward",t.appendChild(n),n.addEventListener("touchstart",this._mobileControlTouchStartCb),n.addEventListener("touchend",this._mobileControlTouchEndCb),this._mobileForwardElement=n}}dispose(){this._domElement.removeEventListener("keydown",this._keydownCb,!1),this._domElement.removeEventListener("keyup",this._keyupCb,!1),this._mobileForwardElement&&(this._mobileForwardElement.removeEventListener("touchstart",this._mobileControlTouchStartCb),this._mobileForwardElement.removeEventListener("touchend",this._mobileControlTouchEndCb),this._mobileForwardElement.remove())}}const C0=new B,E0=new B,rx=new B;class Dv{constructor(){this.posFrom=new B,this.targetFrom=new B,this.posTo=new B,this.targetTo=new B,this.sphericalFrom=new _i,this.sphericalTo=new _i,this.finishCb=function(){},this.movementType=0,this.active=!1,this.duration=0,this.clock=new bi}setup({posFrom:e=new B,targetFrom:t=new B,posTo:n=new B,targetTo:r=new B,finishCb:a=function(){},movementType:i=0}){if(this.posFrom.copy(e),this.targetFrom.copy(t),this.posTo.copy(n),this.targetTo.copy(r),this.finishCb=a,this.movementType=i,this.movementType===1){C0.copy(this.posFrom).sub(this.targetFrom),this.sphericalFrom.setFromVector3(C0),C0.copy(this.posTo).sub(this.targetTo),this.sphericalTo.setFromVector3(C0);const s=Hh(this.sphericalFrom.theta);let c=Hh(this.sphericalTo.theta);const u=Math.abs(s-c);u>Math.PI&&(c=s+Math.sign(s-c)*(2*Math.PI-u)),this.sphericalFrom.theta=s,this.sphericalTo.theta=c}return this}start(e){this.active=!0,this.duration=e,this.clock.start()}update(e=function(t,n,r){}){let t=this.clock.getElapsedTime()/this.duration;if(t=Vy(t,0,1),rx.lerpVectors(this.targetFrom,this.targetTo,t),this.movementType===0)E0.lerpVectors(this.posFrom,this.posTo,t);else if(this.movementType===1){const n=ui(this.sphericalFrom.radius,this.sphericalTo.radius,t),r=ui(this.sphericalFrom.phi,this.sphericalTo.phi,t),a=ui(this.sphericalFrom.theta,this.sphericalTo.theta,t);E0.setFromSphericalCoords(n,r,a),E0.add(rx)}e(t,E0,rx),t>=1&&(this.active=!1,this.finishCb())}}const Ww=new B;class vb{constructor(){this.posFrom=new B,this.targetFrom=new B,this.posTo=new B,this.targetTo=new B,this.zoomFrom=0,this.zoomTo=0,this.finishCb=function(){},this.active=!1,this.duration=0,this.clock=new bi}setup({posFrom:e=new B,targetFrom:t=new B,posTo:n=new B,targetTo:r=new B,zoomFrom:a=0,zoomTo:i=0,finishCb:s=function(){}}){return this.posFrom.copy(e),this.targetFrom.copy(t),this.posTo.copy(n),this.targetTo.copy(r),this.zoomFrom=a,this.zoomTo=i,this.finishCb=s,this}start(e){this.active=!0,this.duration=e,this.clock.start()}update(e=function(t,n,r){}){let t=this.clock.getElapsedTime()/this.duration;t=Vy(t,0,1),Ww.lerpVectors(this.targetFrom,this.targetTo,t);let n=ui(this.zoomFrom,this.zoomTo,t);e(t,Ww,n),t>=1&&(this.active=!1,this.finishCb())}}const kt={minDistance:0,maxDistance:1/0,minZoom:0,maxZoom:1/0,minPolarAngle:0,maxPolarAngle:Math.PI,minAzimuthAngle:-1/0,maxAzimuthAngle:1/0,autoRotate:!1,autoRotateSpeed:2,enablePan:!0,panInertia:.05,panSpeed:1.3,panSpeedKey:15,screenSpacePanning:!0,enableRotate:!0,rotateInertia:.05,rotateInertiaTouch:.05,rotateSpeed:1.2,rotateSpeedTouch:.7,enableZoom:!0,enableCtrlZoom:!1,zoomInertia:.05,zoomInertiaTouch:.05,zoomSpeed:5,zoomSpeedTouch:1,enableDamping:!0,enableTurnover:!1,enableKeys:!0},Hne=new B(0,1,0),Wne=new Ct().setFromAxisAngle(new B(0,0,1),Math.PI),Kn={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_DOLLY_PAN:4},Yw=1e-6,Fo=new B,jw=new B,Yne=new Ct,jne=new Ct,Xw={type:"change"},ox={type:"start"},ax={type:"end"};class F2 extends oo{constructor(e,t){super(),t===void 0&&console.warn('v3d.OrbitControls: The second parameter "domElement" is now mandatory.'),t===document&&console.error('v3d.OrbitControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.'),this.object=e,this.domElement=t,this.domElement.style.touchAction="none",this.enabled=!0,this.targetObj=new Tt,this.minDistance=kt.minDistance,this.maxDistance=kt.maxDistance,this.minZoom=kt.minZoom,this.maxZoom=kt.maxZoom,this.minPolarAngle=kt.minPolarAngle,this.maxPolarAngle=kt.maxPolarAngle,this.minAzimuthAngle=kt.minAzimuthAngle,this.maxAzimuthAngle=kt.maxAzimuthAngle,this.enableDamping=kt.enableDamping,this.enableZoom=kt.enableZoom,this.enableCtrlZoom=kt.enableCtrlZoom,this.zoomSpeed=kt.zoomSpeed,this.zoomSpeedTouch=kt.zoomSpeedTouch,this.zoomInertia=kt.zoomInertia,this.zoomInertiaTouch=kt.zoomInertiaTouch,this.enableRotate=kt.enableRotate,this.rotateSpeed=kt.rotateSpeed,this.rotateSpeedTouch=kt.rotateSpeedTouch,this.rotateInertia=kt.rotateInertia,this.rotateInertiaTouch=kt.rotateInertiaTouch,this.enablePan=kt.enablePan,this.panSpeed=kt.panSpeed,this.screenSpacePanning=kt.screenSpacePanning,this.panSpeedKey=kt.panSpeedKey,this.panInertia=kt.panInertia,this.autoRotate=kt.autoRotate,this.autoRotateSpeed=kt.autoRotateSpeed,this.enableTurnover=kt.enableTurnover,this.enableKeys=kt.enableKeys,this.mouseButtons={ROTATE:xc.LEFT,ZOOM:xc.MIDDLE,PAN:xc.RIGHT},this.target0=this.targetObj.position.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,Object.defineProperty(this,"inTween",{get:()=>ne.active||$.active,set(Y){ne.active=Y}}),this.getPolarAngle=function(){return a.phi},this.getAzimuthalAngle=function(){return a.theta},this.getDistance=function(){return this.object.position.distanceTo(this.targetObj.position)},this.saveState=function(){n.targetObj.updateWorldMatrix(!0,!1),n.target0.setFromMatrixPosition(n.targetObj.matrixWorld),n.position0.copy(n.object.position),n.zoom0=n.object.zoom},this.forceMouseUp=function(){le()},this.reset=function(){n.targetObj.updateWorldMatrix(!0,!1);const Y=Fo.copy(n.target0);n.targetObj.worldToLocal(Y),n.targetObj.position.add(Y),n.object.position.copy(n.position0),n.object.zoom=n.zoom0,n.object.updateProjectionMatrix(),n.dispatchEvent(Xw),n.update(),r=Kn.NONE},this.update=function(){const Y=new B,P=new B,Q=new B,I=new Ct;let N=!1,se=!1;return function(){const ce=n.object.position;if(n.targetObj.updateWorldMatrix(!0,!1),ne.active)ne.update(function(fe,ve,xe){if(ce.copy(ve),Y.copy(xe),n.object.lookAt(Y),fe>=1){i.set(0,0,0),c.set(0,0,0),s=1,R.set(0,0);for(let Ie in h)h[Ie]=0;_.set(0,0),q.getDelta()}});else if($.active)$.update(function(fe,ve,xe){if(Y.copy(ve),n.object.lookAt(Y),n.object.zoom=xe,n.object.updateProjectionMatrix(),fe>=1){i.set(0,0,0),c.set(0,0,0),s=1,R.set(0,0);for(let Ie in h)h[Ie]=0;_.set(0,0),q.getDelta()}});else{Y.setFromMatrixPosition(n.targetObj.matrixWorld),P.copy(ce).sub(Y);const fe=Yne.setFromUnitVectors(n.object.up,Hne),ve=jne.copy(fe).invert();if(P.applyQuaternion(fe),a.setFromVector3(P),n.autoRotate&&r===Kn.NONE&&K(2*Math.PI/60/60*n.autoRotateSpeed),a.theta+=i.theta,a.phi+=i.phi,n.enableTurnover){N&&(a.phi-=2*i.phi),se!=N&&r==Kn.NONE&&(se=N),se&&(a.theta-=2*i.theta);const xe=a.phi;(xe<=0||xe>=Math.PI)&&(N=!N,a.theta+=Math.PI,a.phi=xe>0?2*Math.PI-xe:Math.abs(xe))}else isFinite(n.minAzimuthAngle)&&isFinite(n.maxAzimuthAngle)&&(a.theta=ky(a.theta,n.minAzimuthAngle,n.maxAzimuthAngle)),a.phi=Math.max(n.minPolarAngle,Math.min(n.maxPolarAngle,a.phi));a.makeSafe(),n.object.isPerspectiveCamera?(a.radius*=s,a.radius=Math.max(n.minDistance,Math.min(n.maxDistance,a.radius))):n.object.isOrthographicCamera&&(n.object.zoom/=s,n.object.zoom=Math.max(n.minZoom,Math.min(n.maxZoom,n.object.zoom)),n.object.updateProjectionMatrix()),Y.add(c),P.setFromSpherical(a),P.applyQuaternion(ve),ce.copy(Y).add(P),n.object.lookAt(Y),N&&(n.enableTurnover?n.object.quaternion.multiply(Wne):N=!1),i.set(0,0,0),c.set(0,0,0),function(){const xe=q.getDelta();let Ie,re;A.copy(_),_.x=n.enableDamping?fr(_.x,0,xe,C,.1):0,_.y=n.enableDamping?fr(_.y,0,xe,C,.1):0,A.sub(_),function(){const me=n.domElement===document?n.domElement.body:n.domElement,pe=me.clientWidth,Ce=me.clientHeight;if(!(!pe||!Ce)){K(2*Math.PI*A.x/pe*x),we=2*Math.PI*A.y/Ce*x,i.phi-=we;var we}}(),M.copy(R),R.x=n.enableDamping?fr(R.x,0,xe,n.panInertia,.1):0,R.y=n.enableDamping?fr(R.y,0,xe,n.panInertia,.1):0,M.sub(R),M.multiplyScalar(n.panSpeed);for(let me in h)f.isKeyDown[me]?Ie=h[me]=1:(re=h[me],h[me]=fr(h[me],0,xe,n.panInertia,.1),Ie=re-h[me]),n.enabled&&n.enableKeys&&n.enablePan&&(Ie*=60*xe*n.panSpeedKey,me==Je.A||me==Je.LEFT_ARROW?M.x+=Ie:me==Je.D||me==Je.RIGHT_ARROW?M.x-=Ie:me==Je.W||me==Je.UP_ARROW?M.y+=Ie:me!=Je.S&&me!=Je.DOWN_ARROW||(M.y-=Ie));(function(me,pe){const Ce=n.domElement===document?n.domElement.body:n.domElement,we=Ce.clientWidth,be=Ce.clientHeight;if(!(!we||!be))if(n.object.isPerspectiveCamera){n.targetObj.updateWorldMatrix(!0,!1);const Pe=Fo.setFromMatrixPosition(n.targetObj.matrixWorld),Ge=n.object.position;let tt=jw.copy(Ge).sub(Pe).length();tt*=Math.tan(n.object.fov/2*ls),ie(2*me*tt/be,n.object.matrix),L(2*pe*tt/be,n.object.matrix)}else n.object.isOrthographicCamera?(ie(me*(n.object.right-n.object.left)/n.object.zoom/we,n.object.matrix),L(pe*(n.object.top-n.object.bottom)/n.object.zoom/be,n.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),n.enablePan=!1)})(M.x,M.y),s=z,z=n.enableDamping?fr(z,1,xe,O,.001):1,s/=z}()}return n.targetObj.position.copy(Y),!!(u||Q.distanceToSquared(n.object.position)>Yw||8*(1-I.dot(n.object.quaternion))>Yw)&&(n.dispatchEvent(Xw),Q.copy(n.object.position),I.copy(n.object.quaternion),u=!1,!0)}}(),this.dispose=function(){n.domElement.removeEventListener("contextmenu",W),n.domElement.removeEventListener("mousedown",de),n.domElement.removeEventListener("wheel",V),n.domElement.removeEventListener("touchstart",G),n.domElement.removeEventListener("touchend",X),n.domElement.removeEventListener("touchmove",ee),document.removeEventListener("mousemove",te),document.removeEventListener("mouseup",le),document.removeEventListener("mouseleave",le),f.dispose()},this.tween=function(){return function(P,Q,I,N,se){n.targetObj.updateWorldMatrix(!0,!1);const ce=Fo.setFromMatrixPosition(n.targetObj.matrixWorld);n.object.parent&&(P=jw.copy(P),n.object.parent.worldToLocal(P)),P.manhattanDistanceTo(n.object.position)<1e-5&&Q.manhattanDistanceTo(ce)<1e-5?N!==void 0&&N():ne.setup({posFrom:n.object.position,targetFrom:ce,posTo:P,targetTo:Q,finishCb:N,movementType:se}).start(I)}}(),this.tweenZoomTo=function(Y,P,Q,I){if(!n.object.isOrthographicCamera)return void console.warn("v3d.OrbitControls: .tweenZoomTo() works only for orthographic camera");n.targetObj.updateWorldMatrix(!0,!1);const N=Fo.setFromMatrixPosition(n.targetObj.matrixWorld);$.setup({zoomFrom:n.object.zoom,targetFrom:N,zoomTo:P,targetTo:Y,finishCb:I}).start(Q)};const n=this;let r=Kn.NONE;const a=new _i,i=new _i;let s=1;const c=new B;let u=!1;const h={};h[Je.W]=h[Je.S]=h[Je.A]=h[Je.D]=h[Je.UP_ARROW]=h[Je.DOWN_ARROW]=h[Je.LEFT_ARROW]=h[Je.RIGHT_ARROW]=0;const f=new gb(window);f.onKeyDown=function(Y){n.enableKeys?Y.keyCode in h&&(h[Y.keyCode]=1):f.isKeyDown[Y.keyCode]=!1};const m=new Ee,g=new Ee,A=new Ee,_=new Ee;let x=1,C=1;const b=new Ee,y=new Ee,M=new Ee,R=new Ee,T=new Ee,w=new Ee,D=new Ee;let z=1,F=1,O=1;const q=new bi,ne=new Dv,$=new vb;function he(Y=1){return Math.pow(.95,F*Y)}function K(Y){i.theta-=Y}function oe(Y,P){g.set(Y,P),_.add(g).sub(m),m.copy(g)}function ie(Y,P){Fo.setFromMatrixColumn(P,0),Fo.multiplyScalar(-Y),c.add(Fo)}function L(Y,P){n.screenSpacePanning===!0?Fo.setFromMatrixColumn(P,1):(Fo.setFromMatrixColumn(P,0),Fo.crossVectors(n.object.up,Fo)),Fo.multiplyScalar(Y),c.add(Fo)}function U(Y){n.object.isPerspectiveCamera?z/=Y:n.object.isOrthographicCamera?(z/=Y,u=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),n.enableZoom=!1)}function k(Y){n.object.isPerspectiveCamera?z*=Y:n.object.isOrthographicCamera?(z*=Y,u=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),n.enableZoom=!1)}function J(Y){(function(P,Q){y.set(P,Q),R.add(y).sub(b),b.copy(y)})(Y.clientX,Y.clientY)}function de(Y){if(n.enabled!==!1){switch(Y.preventDefault(),Y.button){case n.mouseButtons.ROTATE:if(n.enableRotate===!1)return;(function(P){m.set(P.clientX,P.clientY)})(Y),r=Kn.ROTATE;break;case n.mouseButtons.ZOOM:case n.mouseButtons.PAN:if(n.enablePan===!1)return;(function(P){b.set(P.clientX,P.clientY)})(Y),r=Kn.PAN}r!==Kn.NONE&&(document.addEventListener("mousemove",te),document.addEventListener("mouseup",le),document.addEventListener("mouseleave",le),n.dispatchEvent(ox))}}function te(Y){if(n.enabled!==!1)switch(Y.preventDefault(),r){case Kn.ROTATE:if(n.enableRotate===!1)return;(function(P){oe(P.clientX,P.clientY),x=n.rotateSpeed,C=n.rotateInertia})(Y);break;case Kn.DOLLY:if(n.enableZoom===!1)return;(function(P){w.set(P.clientX,P.clientY),D.subVectors(w,T),D.y>0?U(he()):D.y<0&&k(he()),T.copy(w),n.update()})(Y);break;case Kn.PAN:if(n.enablePan===!1)return;J(Y)}}function le(Y){n.enabled!==!1&&(document.removeEventListener("mousemove",te),document.removeEventListener("mouseup",le),document.removeEventListener("mouseleave",le),n.dispatchEvent(ax),r=Kn.NONE)}function V(Y){n.enabled===!1||n.enableZoom===!1||r!==Kn.NONE&&r!==Kn.ROTATE||n.enableCtrlZoom&&!Y.ctrlKey||(Y.preventDefault(),Y.stopPropagation(),n.dispatchEvent(ox),function(P){F=n.zoomSpeed,O=n.zoomInertia,P.deltaY<0?k(he(Math.abs(P.deltaY)/100)):P.deltaY>0&&U(he(Math.abs(P.deltaY)/100)),n.update()}(Y),n.dispatchEvent(ax))}function G(Y){if(n.enabled!==!1){switch(Y.touches.length){case 1:if(n.enableRotate===!1)return;(function(P){m.set(P.touches[0].pageX,P.touches[0].pageY)})(Y),r=Kn.TOUCH_ROTATE;break;case 2:if(n.enableZoom===!1&&n.enablePan===!1)return;(function(P){if(n.enableZoom){F=n.zoomSpeedTouch,O=n.zoomInertiaTouch;let Q=P.touches[0].pageX-P.touches[1].pageX,I=P.touches[0].pageY-P.touches[1].pageY,N=Math.sqrt(Q*Q+I*I);T.set(0,N)}if(n.enablePan){let Q=.5*(P.touches[0].pageX+P.touches[1].pageX),I=.5*(P.touches[0].pageY+P.touches[1].pageY);b.set(Q,I)}n.update()})(Y),r=Kn.TOUCH_DOLLY_PAN;break;default:r=Kn.NONE}r!==Kn.NONE&&n.dispatchEvent(ox)}}function ee(Y){if(n.enabled!==!1)switch(Y.preventDefault(),Y.touches.length){case 1:if(n.enableRotate===!1||r!==Kn.TOUCH_ROTATE)return;(function(P){oe(P.touches[0].pageX,P.touches[0].pageY),x=n.rotateSpeedTouch,C=n.rotateInertiaTouch})(Y);break;case 2:if(n.enableZoom===!1&&n.enablePan===!1||r!==Kn.TOUCH_DOLLY_PAN)return;(function(P){let Q=P.touches[0].pageX-P.touches[1].pageX,I=P.touches[0].pageY-P.touches[1].pageY,N=Math.sqrt(Q*Q+I*I);w.set(0,N),D.subVectors(w,T),T.copy(w);let se=.5*(P.touches[0].pageX+P.touches[1].pageX),ce=.5*(P.touches[0].pageY+P.touches[1].pageY);y.set(se,ce),M.subVectors(y,b),b.copy(y),n.enableZoom&&Math.abs(D.length())>Math.abs(M.length())&&(D.y>0?k(he()):D.y<0&&U(he())),n.enablePan&&Math.abs(D.length())<Math.abs(M.length())&&R.add(M),n.update()})(Y);break;default:r=Kn.NONE}}function X(Y){n.enabled!==!1&&(n.dispatchEvent(ax),r=Kn.NONE)}function W(Y){n.enabled!==!1&&Y.preventDefault()}n.domElement.addEventListener("contextmenu",W),n.domElement.addEventListener("mousedown",de),n.domElement.addEventListener("wheel",V,{passive:!1}),n.domElement.addEventListener("touchstart",G,{passive:!0}),n.domElement.addEventListener("touchend",X),n.domElement.addEventListener("touchmove",ee,{passive:!1}),this.update()}}const Hn={enableCollisions:!0,gazeLevel:1.8,enablePan:!0,panInertia:.05,panSpeedKey:.15,enableRotate:!0,rotateInertia:.05,rotateInertiaTouch:.05,rotateSpeed:.9,rotateSpeedTouch:.75,storyHeight:3,enableZoom:!0,enableCtrlZoom:!1,zoomInertia:.05,zoomSpeed:30,zoomSpeedKey:.2,enableDamping:!0,enableKeys:!0},qw=new Ee,Zw=new B,ix=new B,Kw=new B;class U2 extends oo{constructor(t,n){super();ki(this,"_raycaster",new Cv(new B,new B(0,-1,0)));ki(this,"_onCollisionMesh",!1);ki(this,"_lastPosition",new B);ki(this,"_enableCollisions",Hn.enableCollisions);ki(this,"_nearestPoint",new B);ki(this,"_lastIntersection",new B);ki(this,"_toMeshSpaceMatrix",new Ve);ki(this,"_ppTarget",{point:new B,distance:0,faceIndex:0});const r=this;this.object=t,this.domElement=n!==void 0?n:document,this.enabled=!0,this.screen={left:0,top:0,width:0,height:0},this.enableDamping=Hn.enableDamping,this.enableRotate=Hn.enableRotate,this.rotateSpeed=Hn.rotateSpeed,this.rotateSpeedTouch=Hn.rotateSpeedTouch,this.rotateInertia=Hn.rotateInertia,this.rotateInertiaTouch=Hn.rotateInertiaTouch,this.enableZoom=Hn.enableZoom,this.enableCtrlZoom=Hn.enableCtrlZoom,this.zoomSpeed=Hn.zoomSpeed,this.zoomSpeedKey=Hn.zoomSpeedKey,this.zoomInertia=Hn.zoomInertia,this.enablePan=Hn.enablePan,this.panSpeedKey=Hn.panSpeedKey,this.panInertia=Hn.panInertia,this.enableKeys=Hn.enableKeys,this.gazeLevel=Hn.gazeLevel,this.storyHeight=Hn.storyHeight,this.collisionMeshes=[],this._raycaster.params.checkVisibility=!1;let a=!1;Object.defineProperty(this,"enablePointerLock",{get:()=>a,set(Q){a!==Q&&(a=Q,Y())}}),Object.defineProperty(this,"inTween",{get:()=>ne.active||$.active});const i=new bi,s=1e-6,c=new B,u=new B,h=new B,f=new Ct,m=new B,g={};let A;g[Je.W]=g[Je.S]=g[Je.A]=g[Je.D]=g[Je.UP_ARROW]=g[Je.DOWN_ARROW]=g[Je.LEFT_ARROW]=g[Je.RIGHT_ARROW]=0;let _=!1;const x=new _i,C=new _i,b=new Ee;let y=1,M=1;const R=new Ee,T=new Ee;let w=0,D=0,z=1,F=1;const O=new Ee,q=new Ee,ne=new Dv,$=new vb,he={type:"change"},K={type:"start"},oe={type:"end"};this.handleResize=function(){if(this.domElement===document)this.screen.left=0,this.screen.top=0,this.screen.width=window.innerWidth,this.screen.height=window.innerHeight;else{const Q=this.domElement.getBoundingClientRect(),I=this.domElement.ownerDocument.documentElement;this.screen.left=Q.left+window.pageXOffset-I.clientLeft,this.screen.top=Q.top+window.pageYOffset-I.clientTop,this.screen.width=Q.width,this.screen.height=Q.height}},this.handleEvent=function(Q){typeof this[Q.type]=="function"&&this[Q.type](Q)};const ie=function(Q,I){return qw.set((Q-.5*r.screen.width-r.screen.left)/(.5*r.screen.width),(r.screen.height+2*(r.screen.top-I))/r.screen.width)};function L(Q){r.enabled!==!1&&(Q.preventDefault(),r.enableRotate!==!1&&(T.copy(ie(Q.pageX,Q.pageY).negate()),R.copy(T),_=!0,document.addEventListener("mousemove",U),document.addEventListener("mouseup",k),document.addEventListener("mouseleave",k),r.dispatchEvent(K)))}function U(Q){if(r.enabled!==!1&&(Q.preventDefault(),_)){if(r.enableRotate===!1)return;T.copy(ie(Q.pageX,Q.pageY).negate()),b.add(T).sub(R),R.copy(T),y=r.rotateSpeed,M=r.rotateInertia}}function k(Q){r.enabled!==!1&&(Q.preventDefault(),_=!1,document.removeEventListener("mousemove",U),document.removeEventListener("mouseup",k),document.removeEventListener("mouseleave",k),r.dispatchEvent(oe))}function J(Q){if(r.enabled!==!1&&r.enableZoom!==!1&&(!r.enableCtrlZoom||Q.ctrlKey)){switch(Q.preventDefault(),Q.stopPropagation(),Q.deltaMode){case 2:D-=.025*Q.deltaY,z=r.zoomSpeed,F=r.zoomInertia;break;case 1:D-=.01*Q.deltaY,z=r.zoomSpeed,F=r.zoomInertia;break;default:D-=25e-5*Q.deltaY,z=r.zoomSpeed,F=r.zoomInertia}r.dispatchEvent(K),r.dispatchEvent(oe)}}function de(Q){if(r.enabled===!1)return;const I=Q.targetTouches[0];_=!0,T.copy(ie(I.pageX,I.pageY).negate()),R.copy(T),r.dispatchEvent(K)}function te(Q){if(r.enabled===!1)return;Q.preventDefault();const I=Q.targetTouches[0];r.enableRotate!==!1&&(T.copy(ie(I.pageX,I.pageY).negate()),b.add(T).sub(R),R.copy(T),y=r.rotateSpeedTouch,M=r.rotateInertiaTouch)}function le(Q){if(r.enabled!==!1){if(Q.targetTouches.length===0)_=!1;else{if(r.enableRotate===!1)return;_=!0,T.copy(ie(Q.targetTouches[0].pageX,Q.targetTouches[0].pageY).negate()),R.copy(T)}r.dispatchEvent(oe)}}function V(Q){r.enabled!==!1&&Q.preventDefault()}function G(Q){r.domElement.requestPointerLock()}function ee(Q){document.pointerLockElement===r.domElement?(r.dispatchEvent(K),document.addEventListener("mousemove",W)):(r.dispatchEvent(oe),document.removeEventListener("mousemove",W))}function X(Q){console.error("Pointer lock failed")}function W(Q){var I,N;Q.preventDefault(),r.enabled&&r.enableRotate&&(b.add((I=Q.movementX,N=Q.movementY,qw.set(I,-N).multiplyScalar(2/r.screen.width)).negate()),y=r.rotateSpeed,M=r.rotateInertia)}function Y(){P(),r.domElement.addEventListener("contextmenu",V),r.enablePointerLock?(r.domElement.addEventListener("click",G),document.addEventListener("pointerlockchange",ee),document.addEventListener("pointerlockerror",X)):r.domElement.addEventListener("mousedown",L),r.domElement.addEventListener("wheel",J,{passive:!1}),r.domElement.addEventListener("touchstart",de,{passive:!0}),r.domElement.addEventListener("touchend",le),r.domElement.addEventListener("touchmove",te,{passive:!1}),A=new gb(window,r.domElement.parentElement),A.onKeyDown=function(Q){r.enableKeys?Q.keyCode in g&&(g[Q.keyCode]=1):A.isKeyDown[Q.keyCode]=!1}}function P(){r.domElement.removeEventListener("contextmenu",V),r.domElement.removeEventListener("click",G),document.removeEventListener("pointerlockchange",ee),document.removeEventListener("pointerlockerror",X),document.removeEventListener("mousemove",W),r.domElement.removeEventListener("mousedown",L),r.domElement.removeEventListener("wheel",J),r.domElement.removeEventListener("touchstart",de),r.domElement.removeEventListener("touchend",le),r.domElement.removeEventListener("touchmove",te),document.removeEventListener("mousemove",U),document.removeEventListener("mouseup",k),document.removeEventListener("mouseleave",k),A&&A.dispose()}this.update=function(){ne.active?ne.update(function(I,N,se){if(r.object.position.copy(N),r.object.lookAt(se),I>=1){C.set(0,0,0),b.set(0,0),w=0,D=0,O.set(0,0),q.set(0,0);for(const ce in g)g[ce]=0;i.getDelta()}}):$.active?$.update(function(I,N,se){if(r.object.lookAt(N),r.object.zoom=se,r.object.updateProjectionMatrix(),I>=1){C.set(0,0,0),b.set(0,0),w=0,D=0,O.set(0,0),q.set(0,0);for(let ce in g)g[ce]=0;i.getDelta()}}):(r.object.matrixAutoUpdate&&r.object.updateMatrix(),r.object.getLocalDirection(m),x.setFromVector3(m),x.theta+=C.theta*y,x.phi+=C.phi*y,x.makeSafe(),m.setFromSpherical(x),c.copy(m).add(r.object.position),r.object.lookAtLocal(c),r.object.isPerspectiveCamera?r.object.position.addScaledVector(m,w):r.object.isOrthographicCamera&&(r.object.zoom*=1+.15*w,r.object.updateProjectionMatrix()),u.copy(m).cross(r.object.up).setLength(-O.x),u.add(h.copy(r.object.up).setLength(O.y)),r.object.position.add(u),function(){const I=i.getDelta();C.set(C.radius,b.y,b.x),b.x=r.enableDamping?fr(b.x,0,I,M,.001):0,b.y=r.enableDamping?fr(b.y,0,I,M,.001):0,C.set(C.radius,C.phi-b.y,C.theta-b.x),O.copy(q),q.x=r.enableDamping?fr(q.x,0,I,1,.001):0,q.y=r.enableDamping?fr(q.y,0,I,1,.001):0,O.sub(q),O.multiplyScalar(1),w=D,D=r.enableDamping?fr(D,0,I,F,.001):0,w-=D,w*=z;for(const N in g){const se=N==Je.A||N==Je.LEFT_ARROW||N==Je.D||N==Je.RIGHT_ARROW,ce=N==Je.W||N==Je.UP_ARROW||N==Je.S||N==Je.DOWN_ARROW,fe=se?r.panInertia:r.zoomInertia,ve=se?r.panSpeedKey:r.zoomSpeedKey,xe=.001;let Ie;if(A.isKeyDown[N])Ie=g[N]=1;else{const re=g[N];g[N]=fr(g[N],0,I,fe,xe),Ie=re-g[N]}r.enabled&&r.enableKeys&&(se&&!r.enablePan||ce&&!r.enableZoom||(Ie*=60*I*ve,N==Je.A||N==Je.LEFT_ARROW?O.x+=Ie:N==Je.D||N==Je.RIGHT_ARROW?O.x-=Ie:N==Je.W||N==Je.UP_ARROW?w+=Ie:N!=Je.S&&N!=Je.DOWN_ARROW||(w-=Ie)))}}()),this._handleCollisions();let Q=!1;this._lastPosition.distanceToSquared(r.object.position)>s&&(this._lastPosition.copy(r.object.position),Q=!0),f.dot(r.object.quaternion)<1-s&&(f.copy(r.object.quaternion),Q=!0),Q&&r.dispatchEvent(he)},this.forceMouseUp=function(){k({preventDefault:function(){}})},this.dispose=P,this.releaseFromCollision=function(){this._onCollisionMesh=!1},this.tween=function(Q,I,N,se,ce){r.object.parent&&(Q=Zw.copy(Q),r.object.parent.worldToLocal(Q));const fe=r.object.getWorldPosition(ix),ve=Kw.subVectors(I,fe).length(),xe=r.object.getWorldDirection(Kw).multiplyScalar(ve).add(fe),Ie=1e-5;Q.manhattanDistanceTo(r.object.position)<Ie&&I.manhattanDistanceTo(xe)<Ie?se!==void 0&&se():ne.setup({posFrom:r.object.position,targetFrom:xe,posTo:Q,targetTo:I,finishCb:se,movementType:ce}).start(N)},this.tweenZoomTo=function(Q,I,N,se){if(!r.object.isOrthographicCamera)return void console.warn("v3d.FirstPersonControls: .tweenZoomTo() works only for orthographic camera");const ce=r.object.getWorldPosition(Zw),fe=ix.subVectors(Q,ce).length(),ve=r.object.getWorldDirection(ix).multiplyScalar(fe).add(ce);$.setup({zoomFrom:r.object.zoom,targetFrom:ve,zoomTo:I,targetTo:Q,finishCb:se}).start(N)},Y(),this.handleResize(),this.update()}set enableCollisions(t){this._enableCollisions=t,t||this.releaseFromCollision()}get enableCollisions(){return this._enableCollisions}_handleCollisions(){if(!this._enableCollisions||this.collisionMeshes.length==0)return;this._raycaster.ray.origin.copy(this.object.position),this._raycaster.far=this.storyHeight;const t=this._raycaster.intersectObjects(this.collisionMeshes,!1);if(t.length>0){const n=t[0];this.object.position.y=n.point.y+this.gazeLevel,this._onCollisionMesh=!0}else if(this._onCollisionMesh){let n=1/0;for(const r of this.collisionMeshes){if(!r.geometry.boundsTree){console.warn("v3d.FirstPersonControls: no bounding tree found on "+r.name);continue}this._toMeshSpaceMatrix.copy(r.matrixWorld).invert(),this._lastIntersection.copy(this.object.position),this._lastIntersection.y-=this.gazeLevel,this._lastIntersection.applyMatrix4(this._toMeshSpaceMatrix);const a=this._ppTarget;r.geometry.boundsTree.closestPointToPoint(this._lastIntersection,a),a.distance<n&&(this._nearestPoint.copy(a.point),this._nearestPoint.applyMatrix4(r.matrixWorld),n=a.distance)}isFinite(n)?(this.object.position.copy(this._nearestPoint),this.object.position.y+=this.gazeLevel):this.object.position.copy(this._lastPosition)}}}const Mn={panInertia:.05,panInertiaTouch:.05,panSpeed:20,panSpeedKey:.4,panSpeedTouch:15,rotateInertia:.05,rotateInertiaTouch:.05,rotateSpeed:.9,rotateSpeedTouch:.75,zoomInertia:.05,zoomInertiaTouch:.05,zoomSpeed:150,zoomSpeedKey:.5,zoomSpeedTouch:20,enableDamping:!0,enableRotate:!0,enableZoom:!0,enableCtrlZoom:!1,enablePan:!0,enableKeys:!0,minAzimuthAngle:-1/0,maxAzimuthAngle:1/0,minPolarAngle:0,maxPolarAngle:Math.PI};class z2 extends oo{constructor(e,t){super();var n=this,r=-1,a=0,i=1,s=2,c=3,u=4;this.object=e,this.domElement=t!==void 0?t:document,this.enabled=!0,this.screen={left:0,top:0,width:0,height:0},this.enableDamping=Mn.enableDamping,this.enableRotate=Mn.enableRotate,this.rotateSpeed=Mn.rotateSpeed,this.rotateSpeedTouch=Mn.rotateSpeedTouch,this.rotateInertia=Mn.rotateInertia,this.rotateInertiaTouch=Mn.rotateInertiaTouch,this.enableZoom=Mn.enableZoom,this.enableCtrlZoom=Mn.enableCtrlZoom,this.zoomSpeed=Mn.zoomSpeed,this.zoomSpeedKey=Mn.zoomSpeedKey,this.zoomSpeedTouch=Mn.zoomSpeedTouch,this.zoomInertia=Mn.zoomInertia,this.zoomInertiaTouch=Mn.zoomInertiaTouch,this.enablePan=Mn.enablePan,this.panSpeed=Mn.panSpeed,this.panSpeedKey=Mn.panSpeedKey,this.panSpeedTouch=Mn.panSpeedTouch,this.panInertia=Mn.panInertia,this.panInertiaTouch=Mn.panInertiaTouch,this.enableKeys=Mn.enableKeys,this.minAzimuthAngle=Mn.minAzimuthAngle,this.maxAzimuthAngle=Mn.maxAzimuthAngle,this.minPolarAngle=Mn.minPolarAngle,this.maxPolarAngle=Mn.maxPolarAngle,this.mouseButtons={ROTATE:xc.LEFT,ZOOM:xc.MIDDLE,PAN:xc.RIGHT},Object.defineProperty(this,"inTween",{get:()=>le.active||V.active});var h=new bi,f=1e-6,m=new B,g=new B,A=new B,_=new Ee,x=new B,C=new Ct,b=r,y=new B,M={};M[Je.W]=M[Je.S]=M[Je.A]=M[Je.D]=M[Je.UP_ARROW]=M[Je.DOWN_ARROW]=M[Je.LEFT_ARROW]=M[Je.RIGHT_ARROW]=0;var R=new gb(window);R.onKeyDown=function(pe){n.enableKeys?pe.keyCode in M&&(M[pe.keyCode]=1):R.isKeyDown[pe.keyCode]=!1};var T=new _i,w=new _i,D=new Ee,z=1,F=1,O=new Ee,q=new Ee,ne=0,$=0,he=1,K=1,oe=0,ie=0,L=new Ee,U=new Ee,k=1,J=1,de=new Ee,te=new Ee,le=new Dv;const V=new vb;var G={type:"change"},ee={type:"start"},X={type:"end"};this.handleResize=function(){if(this.domElement===document)this.screen.left=0,this.screen.top=0,this.screen.width=window.innerWidth,this.screen.height=window.innerHeight;else{var pe=this.domElement.getBoundingClientRect(),Ce=this.domElement.ownerDocument.documentElement;this.screen.left=pe.left+window.pageXOffset-Ce.clientLeft,this.screen.top=pe.top+window.pageYOffset-Ce.clientTop,this.screen.width=pe.width,this.screen.height=pe.height}},this.handleEvent=function(pe){typeof this[pe.type]=="function"&&this[pe.type](pe)};var W,Y,P,Q,I=(W=new Ee,function(pe,Ce){return W.set((pe-n.screen.left)/n.screen.width,(Ce-n.screen.top)/n.screen.height),W}),N=function(){var pe=new Ee;return function(Ce,we){return pe.set((Ce-.5*n.screen.width-n.screen.left)/(.5*n.screen.width),(n.screen.height+2*(n.screen.top-we))/n.screen.width),pe}}();function se(pe){if(n.enabled!==!1){switch(pe.preventDefault(),pe.button){case n.mouseButtons.ROTATE:if(n.enableRotate===!1)return;q.copy(N(pe.pageX,pe.pageY).negate()),O.copy(q),b=a;break;case n.mouseButtons.ZOOM:case n.mouseButtons.PAN:if(n.enablePan===!1)return;de.copy(I(pe.pageX,pe.pageY)),te.copy(de),b=pe.button==n.mouseButtons.PAN?s:i}document.addEventListener("mousemove",ce),document.addEventListener("mouseup",fe),document.addEventListener("mouseleave",fe),n.dispatchEvent(ee)}}function ce(pe){if(n.enabled!==!1){if(pe.preventDefault(),b===a){if(n.enableRotate===!1)return;q.copy(N(pe.pageX,pe.pageY).negate()),D.add(q).sub(O),O.copy(q),z=n.rotateSpeed,F=n.rotateInertia}else if(b===s||b===i){if(n.enablePan===!1)return;te.copy(I(pe.pageX,pe.pageY)),U.add(te).sub(de),de.copy(te),k=n.panSpeed,J=n.panInertia}}}function fe(pe){n.enabled!==!1&&(pe.preventDefault(),b=r,document.removeEventListener("mousemove",ce),document.removeEventListener("mouseup",fe),document.removeEventListener("mouseleave",fe),n.dispatchEvent(X))}function ve(pe){if(n.enabled!==!1&&n.enableZoom!==!1&&(!n.enableCtrlZoom||pe.ctrlKey)){switch(pe.preventDefault(),pe.stopPropagation(),pe.deltaMode){case 2:$-=.025*pe.deltaY,he=n.zoomSpeed,K=n.zoomInertia;break;case 1:$-=.01*pe.deltaY,he=n.zoomSpeed,K=n.zoomInertia;break;default:$-=25e-5*pe.deltaY,he=n.zoomSpeed,K=n.zoomInertia}n.dispatchEvent(ee),n.dispatchEvent(X)}}function xe(pe){if(n.enabled!==!1){var Ce=pe.touches[0],we=pe.touches[1];if(pe.touches.length===1){if(n.enableRotate===!1)return;b=c,q.copy(N(Ce.pageX,Ce.pageY).negate()),O.copy(q)}else{if(n.enableZoom===!1&&n.enablePan===!1)return;if(b=u,n.enableZoom){var be=I(Ce.pageX-we.pageX,Ce.pageY-we.pageY);oe=ie=be.length()}if(n.enablePan){var Pe=I((Ce.pageX+we.pageX)/2,(Ce.pageY+we.pageY)/2);de.copy(Pe),te.copy(de)}}n.dispatchEvent(ee)}}function Ie(pe){if(n.enabled!==!1){pe.preventDefault();var Ce=pe.touches[0],we=pe.touches[1];if(pe.touches.length===1){if(n.enableRotate===!1)return;q.copy(N(Ce.pageX,Ce.pageY).negate()),D.add(q).sub(O),O.copy(q),z=n.rotateSpeedTouch,F=n.rotateInertiaTouch}else{if(n.enableZoom===!1&&n.enablePan===!1)return;var be=I(Ce.pageX-we.pageX,Ce.pageY-we.pageY),Pe=(ie=be.length())-oe;oe=ie;var Ge=I((Ce.pageX+we.pageX)/2,(Ce.pageY+we.pageY)/2);te.copy(Ge);var tt=_.subVectors(te,de),ot=tt.length();de.copy(te),n.enableZoom&&Math.abs(Pe)>Math.abs(ot)&&($+=Pe,he=n.zoomSpeedTouch,K=n.zoomInertiaTouch),n.enablePan&&Math.abs(Pe)<=Math.abs(ot)&&(U.add(tt),k=n.panSpeedTouch,J=n.panInertiaTouch)}}}function re(pe){if(n.enabled!==!1){switch(pe.touches.length){case 0:b=r;break;case 1:if(n.enableRotate===!1)return;b=c,q.copy(N(pe.touches[0].pageX,pe.touches[0].pageY).negate()),O.copy(q)}n.dispatchEvent(X)}}function me(pe){n.enabled!==!1&&pe.preventDefault()}this.update=(new B,function(){le.active?le.update(function(Ce,we,be){if(n.object.position.copy(we),n.object.lookAt(be),Ce>=1){for(var Pe in w.set(0,0,0),D.set(0,0),ne=0,$=0,L.set(0,0),U.set(0,0),M)M[Pe]=0;h.getDelta()}}):V.active?V.update(function(Ce,we,be){if(n.object.lookAt(we),n.object.zoom=be,n.object.updateProjectionMatrix(),Ce>=1){w.set(0,0,0),D.set(0,0),ne=0,$=0,L.set(0,0),U.set(0,0);for(let Pe in M)M[Pe]=0;h.getDelta()}}):(n.object.getLocalDirection(y),T.setFromVector3(y),T.theta+=w.theta*z,T.phi+=w.phi*z,T.theta=Math.max(n.minAzimuthAngle,Math.min(n.maxAzimuthAngle,T.theta)),T.phi=Math.max(n.minPolarAngle,Math.min(n.maxPolarAngle,T.phi)),T.makeSafe(),y.setFromSpherical(T),m.copy(y).add(n.object.position),n.object.lookAtLocal(m),n.object.isPerspectiveCamera?n.object.position.addScaledVector(y,ne):n.object.isOrthographicCamera&&(n.object.zoom*=1+.15*ne,n.object.updateProjectionMatrix()),g.copy(y).cross(n.object.up).setLength(-L.x),g.add(A.copy(n.object.up).setLength(L.y)),n.object.position.add(g),function(){var Ce=h.getDelta();for(var we in w.set(w.radius,D.y,D.x),D.x=n.enableDamping?fr(D.x,0,Ce,F,.001):0,D.y=n.enableDamping?fr(D.y,0,Ce,F,.001):0,w.set(w.radius,w.phi-D.y,w.theta-D.x),L.copy(U),U.x=n.enableDamping?fr(U.x,0,Ce,J,.001):0,U.y=n.enableDamping?fr(U.y,0,Ce,J,.001):0,L.sub(U),L.multiplyScalar(k),ne=$,$=n.enableDamping?fr($,0,Ce,K,.001):0,ne-=$,ne*=he,M){var be=we==Je.A||we==Je.LEFT_ARROW||we==Je.D||we==Je.RIGHT_ARROW,Pe=we==Je.W||we==Je.UP_ARROW||we==Je.S||we==Je.DOWN_ARROW,Ge=be?n.panInertia:n.zoomInertia,tt=be?n.panSpeedKey:n.zoomSpeedKey;if(R.isKeyDown[we])var ot=M[we]=1;else{var Pt=M[we];M[we]=fr(M[we],0,Ce,Ge,.001),ot=Pt-M[we]}n.enabled&&n.enableKeys&&(be&&!n.enablePan||Pe&&!n.enableZoom||(ot*=60*Ce*tt,we==Je.A||we==Je.LEFT_ARROW?L.x+=ot:we==Je.D||we==Je.RIGHT_ARROW?L.x-=ot:we==Je.W||we==Je.UP_ARROW?ne+=ot:we!=Je.S&&we!=Je.DOWN_ARROW||(ne-=ot)))}}());var pe=!1;x.distanceToSquared(n.object.position)>f&&(x.copy(n.object.position),pe=!0),C.dot(n.object.quaternion)<1-f&&(C.copy(n.object.quaternion),pe=!0),pe&&n.dispatchEvent(G)}),this.forceMouseUp=function(){fe({preventDefault:function(){}})},this.dispose=function(){this.domElement.removeEventListener("contextmenu",me),this.domElement.removeEventListener("mousedown",se),this.domElement.removeEventListener("wheel",ve),this.domElement.removeEventListener("touchstart",xe),this.domElement.removeEventListener("touchend",re),this.domElement.removeEventListener("touchmove",Ie),document.removeEventListener("mousemove",ce),document.removeEventListener("mouseup",fe),document.removeEventListener("mouseleave",fe),R.dispose()},this.tween=(Y=new B,P=new B,Q=new B,function(pe,Ce,we,be,Pe){n.object.parent&&(pe=Y.copy(pe),n.object.parent.worldToLocal(pe));var Ge=n.object.getWorldPosition(P),tt=Q.subVectors(Ce,Ge).length(),ot=n.object.getWorldDirection(Q).multiplyScalar(tt).add(Ge),Pt=1e-5;pe.manhattanDistanceTo(n.object.position)<Pt&&Ce.manhattanDistanceTo(ot)<Pt?be!==void 0&&be():le.setup({posFrom:n.object.position,targetFrom:ot,posTo:pe,targetTo:Ce,finishCb:be,movementType:Pe}).start(we)}),this.tweenZoomTo=function(){const pe=new B,Ce=new B;return function(we,be,Pe,Ge){if(!n.object.isOrthographicCamera)return void console.warn("v3d.FlyingControls: .tweenZoomTo() works only for orthographic camera");const tt=n.object.getWorldPosition(pe);let ot=Ce.subVectors(we,tt).length();const Pt=n.object.getWorldDirection(Ce).multiplyScalar(ot).add(tt);V.setup({zoomFrom:n.object.zoom,targetFrom:Pt,zoomTo:be,targetTo:we,finishCb:Ge}).start(Pe)}}(),this.domElement.addEventListener("contextmenu",me),this.domElement.addEventListener("mousedown",se),this.domElement.addEventListener("wheel",ve,{passive:!1}),this.domElement.addEventListener("touchstart",xe,{passive:!0}),this.domElement.addEventListener("touchend",re),this.domElement.addEventListener("touchmove",Ie,{passive:!1}),this.handleResize(),this.update()}}const Xne={ORBIT:kt,FIRST_PERSON:Hn,FLYING:Mn};class _b{constructor(e="ORBIT",t=!0,n=1,r=1){this.type=e,this.enablePan=t,this.enableZoom=!0,this.enableCtrlZoom=!1,this.enableKeys=!0,this.rotateSpeed=n,this.moveSpeed=r,this.orbitMinDistance=kt.minDistance,this.orbitMaxDistance=kt.maxDistance,this.orbitMinZoom=kt.minZoom,this.orbitMaxZoom=kt.maxZoom,this.orbitMinPolarAngle=kt.minPolarAngle,this.orbitMaxPolarAngle=kt.maxPolarAngle,this.orbitMinAzimuthAngle=kt.minAzimuthAngle,this.orbitMaxAzimuthAngle=kt.maxAzimuthAngle,this.orbitEnableTurnover=kt.enableTurnover,this.orbitTarget=new Tt,this.enableCollisions=Hn.enableCollisions,this.collisionMaterial=null,this.gazeLevel=Hn.gazeLevel,this.storyHeight=Hn.storyHeight,this.enablePointerLock=!1}copy(e){return this.type=e.type,this.enablePan=e.enablePan,this.enableZoom=e.enableZoom,this.enableCtrlZoom=e.enableCtrlZoom,this.enableKeys=e.enableKeys,this.rotateSpeed=e.rotateSpeed,this.moveSpeed=e.moveSpeed,this.orbitMinDistance=e.orbitMinDistance,this.orbitMaxDistance=e.orbitMaxDistance,this.orbitMinZoom=e.orbitMinZoom,this.orbitMaxZoom=e.orbitMaxZoom,this.orbitMinPolarAngle=e.orbitMinPolarAngle,this.orbitMaxPolarAngle=e.orbitMaxPolarAngle,this.orbitMinAzimuthAngle=e.orbitMinAzimuthAngle,this.orbitMaxAzimuthAngle=e.orbitMaxAzimuthAngle,this.orbitEnableTurnover=e.orbitEnableTurnover,this.orbitTarget=e.orbitTarget,this.enableCollisions=e.enableCollisions,this.collisionMaterial=e.collisionMaterial,this.gazeLevel=e.gazeLevel,this.storyHeight=e.storyHeight,this.enablePointerLock=e.enablePointerLock,this}clone(){return new this.constructor().copy(this)}assignToControls(e,t){const n=Xne[this.type];switch(this.type){case"ORBIT":e.targetObj=this.orbitTarget,e.minDistance=this.orbitMinDistance,e.maxDistance=this.orbitMaxDistance,e.minZoom=this.orbitMinZoom,e.maxZoom=this.orbitMaxZoom,e.minPolarAngle=this.orbitMinPolarAngle,e.maxPolarAngle=this.orbitMaxPolarAngle,e.minAzimuthAngle=this.orbitMinAzimuthAngle,e.maxAzimuthAngle=this.orbitMaxAzimuthAngle,e.enableTurnover=this.orbitEnableTurnover;break;case"FLYING":e.panSpeedTouch=n.panSpeedTouch*this.moveSpeed,e.zoomSpeedKey=n.zoomSpeedKey*this.moveSpeed;break;case"FIRST_PERSON":e.enableCollisions=this.enableCollisions,e.gazeLevel=this.gazeLevel,e.storyHeight=this.storyHeight,e.zoomSpeedKey=n.zoomSpeedKey*this.moveSpeed,e.enablePointerLock=this.enablePointerLock;const r=this;e.collisionMeshes=[],t.traverse(function(a){const i=a.material;i&&r.collisionMaterial&&i.name==r.collisionMaterial.name&&e.collisionMeshes.push(a)});break;default:return void console.error("ControlSettings: unsupported control type")}e.enablePan=this.enablePan,e.enableZoom=this.enableZoom,e.enableCtrlZoom=this.enableCtrlZoom,e.enableKeys=this.enableKeys,e.rotateSpeed=n.rotateSpeed*this.rotateSpeed,e.rotateSpeedTouch=n.rotateSpeedTouch*this.rotateSpeed,e.panSpeed=n.panSpeed*this.moveSpeed,e.panSpeedKey=n.panSpeedKey*this.moveSpeed,e.zoomSpeed=n.zoomSpeed*this.moveSpeed,e.zoomSpeedTouch=n.zoomSpeedTouch*this.moveSpeed}}function qne(){throw new Error("BufferGeometryUtils: computeTangents renamed to computeMikkTSpaceTangents.")}function Zne(o,e,t=!0){if(!e||!e.isReady)throw new Error("BufferGeometryUtils: Initialized MikkTSpace library required.");if(!o.hasAttribute("position")||!o.hasAttribute("normal")||!o.hasAttribute("uv"))throw new Error('BufferGeometryUtils: Tangents require "position", "normal", and "uv" attributes.');function n(i){if(i.normalized||i.isInterleavedBufferAttribute){const s=new Float32Array(i.getCount()*i.itemSize);for(let c=0,u=0;c<i.getCount();c++)s[u++]=i.getX(c),s[u++]=i.getY(c),i.itemSize>2&&(s[u++]=i.getZ(c));return s}return i.array instanceof Float32Array?i.array:new Float32Array(i.array)}const r=o.index?o.toNonIndexed():o,a=e.generateTangents(n(r.attributes.position),n(r.attributes.normal),n(r.attributes.uv));if(t)for(let i=3;i<a.length;i+=4)a[i]*=-1;return r.setAttribute("tangent",new $e(a,4)),o!==r&&o.copy(r),o}function Kne(o,e=!1){const t=o[0].index!==null,n=new Set(Object.keys(o[0].attributes)),r=new Set(Object.keys(o[0].morphAttributes)),a={},i={},s=o[0].morphTargetsRelative,c=new mt;let u=0;for(let h=0;h<o.length;++h){const f=o[h];let m=0;if(t!==(f.index!==null))return console.error("v3d.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+h+". All geometries must have compatible attributes; make sure index attribute exists among all geometries, or in none of them."),null;for(const g in f.attributes){if(!n.has(g))return console.error("v3d.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+h+'. All geometries must have compatible attributes; make sure "'+g+'" attribute exists among all geometries, or in none of them.'),null;a[g]===void 0&&(a[g]=[]),a[g].push(f.attributes[g]),m++}if(m!==n.size)return console.error("v3d.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+h+". Make sure all geometries have the same number of attributes."),null;if(s!==f.morphTargetsRelative)return console.error("v3d.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+h+". .morphTargetsRelative must be consistent throughout all geometries."),null;for(const g in f.morphAttributes){if(!r.has(g))return console.error("v3d.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+h+".  .morphAttributes must be consistent throughout all geometries."),null;i[g]===void 0&&(i[g]=[]),i[g].push(f.morphAttributes[g])}if(e){let g;if(t)g=f.index.count;else{if(f.attributes.position===void 0)return console.error("v3d.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+h+". The geometry must have either an index or a position attribute"),null;g=f.attributes.position.count}c.addGroup(u,g,h),u+=g}}if(t){let h=0;const f=[];for(let m=0;m<o.length;++m){const g=o[m].index;for(let A=0;A<g.count;++A)f.push(g.getX(A)+h);h+=o[m].attributes.position.count}c.setIndex(f)}for(const h in a){const f=V2(a[h]);if(!f)return console.error("v3d.BufferGeometryUtils: .mergeBufferGeometries() failed while trying to merge the "+h+" attribute."),null;c.setAttribute(h,f)}for(const h in i){const f=i[h][0].length;if(f===0)break;c.morphAttributes=c.morphAttributes||{},c.morphAttributes[h]=[];for(let m=0;m<f;++m){const g=[];for(let _=0;_<i[h].length;++_)g.push(i[h][_][m]);const A=V2(g);if(!A)return console.error("v3d.BufferGeometryUtils: .mergeBufferGeometries() failed while trying to merge the "+h+" morphAttribute."),null;c.morphAttributes[h].push(A)}}return c}function V2(o){let e,t,n,r=0;for(let s=0;s<o.length;++s){const c=o[s];if(c.isInterleavedBufferAttribute)return console.error("v3d.BufferGeometryUtils: .mergeBufferAttributes() failed. InterleavedBufferAttributes are not supported."),null;if(e===void 0&&(e=c.array.constructor),e!==c.array.constructor)return console.error("v3d.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.array must be of consistent array types across matching attributes."),null;if(t===void 0&&(t=c.itemSize),t!==c.itemSize)return console.error("v3d.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.itemSize must be consistent across matching attributes."),null;if(n===void 0&&(n=c.normalized),n!==c.normalized)return console.error("v3d.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.normalized must be consistent across matching attributes."),null;r+=c.array.length}const a=new e(r);let i=0;for(let s=0;s<o.length;++s)a.set(o[s].array,i),i+=o[s].array.length;return new $e(a,t,n)}function mg(o){return o.isInstancedInterleavedBufferAttribute||o.isInterleavedBufferAttribute?$g(o):o.isInstancedBufferAttribute?new InstancedBufferAttribute().copy(o):new $e().copy(o)}function $ne(o){let e,t=0,n=0;for(let u=0,h=o.length;u<h;++u){const f=o[u];if(e===void 0&&(e=f.array.constructor),e!==f.array.constructor)return console.error("AttributeBuffers of different types cannot be interleaved"),null;t+=f.array.length,n+=f.itemSize}const r=new mp(new e(t),n);let a=0;const i=[],s=["getX","getY","getZ","getW"],c=["setX","setY","setZ","setW"];for(let u=0,h=o.length;u<h;u++){const f=o[u],m=f.itemSize,g=f.count,A=new Lc(r,m,a,f.normalized);i.push(A),a+=m;for(let _=0;_<g;_++)for(let x=0;x<m;x++)A[c[x]](_,f[s[x]](_))}return i}function $g(o){const e=o.data.array.constructor,t=o.count,n=o.itemSize,r=o.normalized,a=new e(t*n);let i;i=o.isInstancedInterleavedBufferAttribute?new InstancedBufferAttribute(a,n,r,o.meshPerAttribute):new $e(a,n,r);for(let s=0;s<t;s++)i.setX(s,o.getX(s)),n>=2&&i.setY(s,o.getY(s)),n>=3&&i.setZ(s,o.getZ(s)),n>=4&&i.setW(s,o.getW(s));return i}function Jne(o){const e=o.attributes,t=o.morphTargets,n=new Map;for(const r in e){const a=e[r];a.isInterleavedBufferAttribute&&(n.has(a)||n.set(a,$g(a)),e[r]=n.get(a))}for(const r in t){const a=t[r];a.isInterleavedBufferAttribute&&(n.has(a)||n.set(a,$g(a)),t[r]=n.get(a))}}function ere(o){let e=0;for(const n in o.attributes){const r=o.getAttribute(n);e+=r.count*r.itemSize*r.array.BYTES_PER_ELEMENT}const t=o.getIndex();return e+=t?t.count*t.itemSize*t.array.BYTES_PER_ELEMENT:0,e}function tre(o,e=1e-4){e=Math.max(e,Number.EPSILON);const t={},n=o.getIndex(),r=o.getAttribute("position"),a=n?n.count:r.count;let i=0;const s=Object.keys(o.attributes),c={},u={},h=[],f=["getX","getY","getZ","getW"],m=["setX","setY","setZ","setW"];for(let x=0,C=s.length;x<C;x++){const b=s[x],y=o.attributes[b];c[b]=new $e(new y.array.constructor(y.count*y.itemSize),y.itemSize,y.normalized);const M=o.morphAttributes[b];M&&(u[b]=new $e(new M.array.constructor(M.count*M.itemSize),M.itemSize,M.normalized))}const g=Math.log10(1/e),A=Math.pow(10,g);for(let x=0;x<a;x++){const C=n?n.getX(x):x;let b="";for(let y=0,M=s.length;y<M;y++){const R=s[y],T=o.getAttribute(R),w=T.itemSize;for(let D=0;D<w;D++)b+=~~(T[f[D]](C)*A)+","}if(b in t)h.push(t[b]);else{for(let y=0,M=s.length;y<M;y++){const R=s[y],T=o.getAttribute(R),w=o.morphAttributes[R],D=T.itemSize,z=c[R],F=u[R];for(let O=0;O<D;O++){const q=f[O],ne=m[O];if(z[ne](i,T[q](C)),w)for(let $=0,he=w.length;$<he;$++)F[$][ne](i,w[$][q](C))}}t[b]=i,h.push(i),i++}}const _=o.clone();for(const x in o.attributes){const C=c[x];if(_.setAttribute(x,new $e(C.array.slice(0,i*C.itemSize),C.itemSize,C.normalized)),x in u)for(let b=0;b<u[x].length;b++){const y=u[x][b];_.morphAttributes[x][b]=new $e(y.array.slice(0,i*y.itemSize),y.itemSize,y.normalized)}}return _.setIndex(h),_}function nre(o,e){if(e===0)return console.warn("v3d.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),o;if(e===2||e===1){let t=o.getIndex();if(t===null){const i=[],s=o.getAttribute("position");if(s===void 0)return console.error("v3d.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),o;for(let c=0;c<s.count;c++)i.push(c);o.setIndex(i),t=o.getIndex()}const n=t.count-2,r=[];if(e===2)for(let i=1;i<=n;i++)r.push(t.getX(0)),r.push(t.getX(i)),r.push(t.getX(i+1));else for(let i=0;i<n;i++)i%2==0?(r.push(t.getX(i)),r.push(t.getX(i+1)),r.push(t.getX(i+2))):(r.push(t.getX(i+2)),r.push(t.getX(i+1)),r.push(t.getX(i)));r.length/3!==n&&console.error("v3d.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const a=o.clone();return a.setIndex(r),a.clearGroups(),a}return console.error("v3d.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",e),o}function rre(o){if(o.geometry.isBufferGeometry!==!0)return console.error("v3d.BufferGeometryUtils: Geometry is not of type BufferGeometry."),null;const e=new B,t=new B,n=new B,r=new B,a=new B,i=new B,s=new B,c=new B,u=new B;function h(oe,ie,L,U,k,J,de,te){e.fromBufferAttribute(ie,k),t.fromBufferAttribute(ie,J),n.fromBufferAttribute(ie,de);const le=oe.morphTargetInfluences;if(L&&le){s.set(0,0,0),c.set(0,0,0),u.set(0,0,0);for(let V=0,G=L.length;V<G;V++){const ee=le[V],X=L[V];ee!==0&&(r.fromBufferAttribute(X,k),a.fromBufferAttribute(X,J),i.fromBufferAttribute(X,de),U?(s.addScaledVector(r,ee),c.addScaledVector(a,ee),u.addScaledVector(i,ee)):(s.addScaledVector(r.sub(e),ee),c.addScaledVector(a.sub(t),ee),u.addScaledVector(i.sub(n),ee)))}e.add(s),t.add(c),n.add(u)}oe.isSkinnedMesh&&(oe.boneTransform(k,e),oe.boneTransform(J,t),oe.boneTransform(de,n)),te[3*k+0]=e.x,te[3*k+1]=e.y,te[3*k+2]=e.z,te[3*J+0]=t.x,te[3*J+1]=t.y,te[3*J+2]=t.z,te[3*de+0]=n.x,te[3*de+1]=n.y,te[3*de+2]=n.z}const f=o.geometry,m=o.material;let g,A,_;const x=f.index,C=f.attributes.position,b=f.morphAttributes.position,y=f.morphTargetsRelative,M=f.attributes.normal,R=f.morphAttributes.position,T=f.groups,w=f.drawRange;let D,z,F,O,q,ne,$;const he=new Float32Array(C.count*C.itemSize),K=new Float32Array(M.count*M.itemSize);if(x!==null)if(Array.isArray(m))for(D=0,F=T.length;D<F;D++)for(q=T[D],ne=Math.max(q.start,w.start),$=Math.min(q.start+q.count,w.start+w.count),z=ne,O=$;z<O;z+=3)g=x.getX(z),A=x.getX(z+1),_=x.getX(z+2),h(o,C,b,y,g,A,_,he),h(o,M,R,y,g,A,_,K);else for(ne=Math.max(0,w.start),$=Math.min(x.count,w.start+w.count),D=ne,F=$;D<F;D+=3)g=x.getX(D),A=x.getX(D+1),_=x.getX(D+2),h(o,C,b,y,g,A,_,he),h(o,M,R,y,g,A,_,K);else if(Array.isArray(m))for(D=0,F=T.length;D<F;D++)for(q=T[D],ne=Math.max(q.start,w.start),$=Math.min(q.start+q.count,w.start+w.count),z=ne,O=$;z<O;z+=3)g=z,A=z+1,_=z+2,h(o,C,b,y,g,A,_,he),h(o,M,R,y,g,A,_,K);else for(ne=Math.max(0,w.start),$=Math.min(C.count,w.start+w.count),D=ne,F=$;D<F;D+=3)g=D,A=D+1,_=D+2,h(o,C,b,y,g,A,_,he),h(o,M,R,y,g,A,_,K);return{positionAttribute:C,normalAttribute:M,morphedPositionAttribute:new ut(he,3),morphedNormalAttribute:new ut(K,3)}}function GB(o){if(o.groups.length===0)return console.warn("v3d.BufferGeometryUtils.mergeGroups(): No groups are defined. Nothing to merge."),o;let e=o.groups;if(e=e.sort((i,s)=>i.materialIndex!==s.materialIndex?i.materialIndex-s.materialIndex:i.start-s.start),o.getIndex()===null){const i=o.getAttribute("position"),s=[];for(let c=0;c<i.count;c+=3)s.push(c,c+1,c+2);o.setIndex(s)}const t=o.getIndex(),n=[];for(let i=0;i<e.length;i++){const s=e[i],c=s.start,u=c+s.count;for(let h=c;h<u;h++)n.push(t.getX(h))}o.dispose(),o.setIndex(n);let r=0;for(let i=0;i<e.length;i++){const s=e[i];s.start=r,r+=s.count}let a=e[0];o.groups=[a];for(let i=1;i<e.length;i++){const s=e[i];a.materialIndex===s.materialIndex?a.count+=s.count:(a=s,o.groups.push(a))}return o}function ore(o,e=Math.PI/3){const t=Math.cos(e),n=100*(1+1e-10),r=[new B,new B,new B],a=new B,i=new B,s=new B,c=new B;function u(_){return`${~~(_.x*n)},${~~(_.y*n)},${~~(_.z*n)}`}const h=o.toNonIndexed(),f=h.attributes.position,m={};for(let _=0,x=f.count/3;_<x;_++){const C=3*_,b=r[0].fromBufferAttribute(f,C+0),y=r[1].fromBufferAttribute(f,C+1),M=r[2].fromBufferAttribute(f,C+2);a.subVectors(M,y),i.subVectors(b,y);const R=new B().crossVectors(a,i).normalize();for(let T=0;T<3;T++){const w=u(r[T]);w in m||(m[w]=[]),m[w].push(R)}}const g=new Float32Array(3*f.count),A=new $e(g,3,!1);for(let _=0,x=f.count/3;_<x;_++){const C=3*_,b=r[0].fromBufferAttribute(f,C+0),y=r[1].fromBufferAttribute(f,C+1),M=r[2].fromBufferAttribute(f,C+2);a.subVectors(M,y),i.subVectors(b,y),s.crossVectors(a,i).normalize();for(let R=0;R<3;R++){const T=m[u(r[R])];c.set(0,0,0);for(let w=0,D=T.length;w<D;w++){const z=T[w];s.dot(z)>t&&c.add(z)}c.normalize(),A.setXYZ(C+R,c.x,c.y,c.z)}}return h.setAttribute("normal",A),h}function are(o,e){const t={};for(let n=0;n<o.length;n++){const r=o[n],a=r.geometry,i=r.material;let s=[];s.push(i.name),s.push(r.visible),s.push(r.disableChildRendering),s.push(r.castShadow),s.push(r.receiveShadow),s.push(r.renderOrder),s=s.concat(r.groupNames);const c=Object.keys(a.attributes);s=s.concat(c);const u=Object.keys(a.morphAttributes);s=s.concat(u),s=s.join(),t[s]=t[s]||[],t[s].indexOf(r)==-1&&t[s].push(r)}for(let n in t){const r=t[n];if(r.length<2)continue;const a=[];let i=!0;for(let f=0;f<r.length;f++){const m=r[f],g=m.geometry;m.updateWorldMatrix(!0,!1),a.push(g.clone().applyMatrix4(m.matrixWorld)),g.boundsTree||(i=!1)}const s=r[0],c=s.material,u=`${c.name}_x${r.length}_batch`,h=this.mergeBufferGeometries(a);if(h){const f=new Mt(h,c);f.name=u,f.visible=s.visible,f.disableChildRendering=s.disableChildRendering,f.castShadow=s.castShadow,f.receiveShadow=s.receiveShadow,f.renderOrder=s.renderOrder,f.groupNames=s.groupNames;for(let m=0;m<r.length;m++){const g=r[m];g.parent.remove(g)}i&&h.computeBoundsTree({verbose:!1}),console.log("Adding batch object:",u),e.add(f)}else console.warn("Failed to create batch object:",u)}}var ire=Object.freeze({__proto__:null,batchMeshes:are,computeMikkTSpaceTangents:Zne,computeMorphedAttributes:rre,computeTangents:qne,deepCloneAttribute:mg,deinterleaveAttribute:$g,deinterleaveGeometry:Jne,estimateBytesUsed:ere,interleaveAttributes:$ne,mergeBufferAttributes:V2,mergeBufferGeometries:Kne,mergeGroups:GB,mergeVertices:tre,toCreasedNormals:ore,toTrianglesDrawMode:nre});const QB=["alphaMap","aoMap","bumpMap","displacementMap","emissiveMap","envMap","lightMap","map","metalnessMap","normalMap","roughnessMap","specularMap"];function sre(o,e,t){switch(o.type){case"MeshNodeMaterial":o.traverseNodes(n=>{n.originData.texture===e&&(n.originData.texture=t)});for(const n in o.nodeTextures)o.nodeTextures[n]===e&&(o.nodeTextures[n]=t);break;case"MeshStandardMaterial":QB.forEach(n=>{o[n]===e&&(o[n]=t)});break;default:return void console.error("replaceTexture: Unsupported material type "+o.type)}t.encoding=e.encoding,t.wrapS=e.wrapS,t.wrapT=e.wrapT}function k2(o){if(QB.forEach(function(e){o[e]&&o[e].isTexture&&o[e].dispose()}),o.type=="MeshNodeMaterial")for(const e in o.nodeTextures)o.nodeTextures[e]&&o.nodeTextures[e].dispose()}function HB(o,e,t){const n=new bn,r={};if(n.addNode(Et("LIGHT_PATH_BL","Light Path")),n.addNode(Et("TEX_ENVIRONMENT_BL","Lighting Texture",{texture:e})),r[kr("TEX_ENVIRONMENT_BL",0)]=e,t instanceof Qe){const a=t.toArray([0,0,0,1]);n.addNode(Et("RGB_BL","Background Color",{outputs:[a]}))}else n.addNode(Et("TEX_ENVIRONMENT_BL","Background  Texture",{texture:t})),r[kr("TEX_ENVIRONMENT_BL",1)]=t;return n.addNode(Et("MIX_BL","Mix")),Ke(n,0,st.LIGHT_PATH_BL.isCameraRay,3,Ae.MIX_BL.fac),Ke(n,1,st.TEX_ENVIRONMENT_BL.color,3,Ae.MIX_BL.col1),Ke(n,2,st[sa(n.node(2))].color,3,Ae.MIX_BL.col2),n.addNode(Et("BACKGROUND_BL","Background")),Ke(n,3,st.MIX_BL.col,4,Ae.BACKGROUND_BL.color),n.addNode(Et("OUTPUT_WORLD_BL","Output")),Ke(n,4,st.BACKGROUND_BL.color,5,Ae.OUTPUT_WORLD_BL.surface),new Ba({name:o,nodeGraph:n,nodeTextures:r})}function Ab(o,e,t,n="blender"){let r=new bn;switch(n){case"blender":if(t<1){r.addNode(Et("BSDF_TRANSPARENT_BL","Transparent"));const s=Et("DIFFUSE_BSDF_BL","Diffuse");e.toArray(s.originData.inputs[Ae.DIFFUSE_BSDF_BL.color]),r.addNode(s);const c=Et("MIX_SHADER_BL","Mix");c.originData.inputs[Ae.MIX_SHADER_BL.fac]=t,r.addNode(c),Ke(r,0,st.BSDF_TRANSPARENT_BL.color,2,Ae.MIX_SHADER_BL.color1),Ke(r,1,st.DIFFUSE_BSDF_BL.color,2,Ae.MIX_SHADER_BL.color2)}else{const s=Et("DIFFUSE_BSDF_BL","Diffuse");e.toArray(s.originData.inputs[Ae.DIFFUSE_BSDF_BL.color]),r.addNode(s)}r.addNode(Et("OUTPUT_MATERIAL_BL","Output")),Ke(r,r.len()-2,st[sa(r.node(r.len()-2))].color,r.len()-1,Ae.OUTPUT_MATERIAL_BL.surface);break;case"max":const a=Et("LAMBERT_AR","Diffuse");a.originData.inputs[Ae.LAMBERT_AR.base]=1,e.toArray(a.originData.inputs[Ae.LAMBERT_AR.baseColor]),a.originData.inputs[Ae.LAMBERT_AR.opacity][0]=t,a.originData.inputs[Ae.LAMBERT_AR.opacity][1]=t,a.originData.inputs[Ae.LAMBERT_AR.opacity][2]=t,r.addNode(a),r.addNode(Et("OUTPUT_MX","Output")),Ke(r,0,st.LAMBERT_AR.color,1,Ae.OUTPUT_MX.color);break;case"maya":const i=Et("LAMBERT_MY","Diffuse");e.toArray(i.originData.inputs[Ae.LAMBERT_MY.color]),i.originData.inputs[Ae.LAMBERT_MY.diffuse]=1,i.originData.inputs[Ae.LAMBERT_MY.transparency][0]=1-t,i.originData.inputs[Ae.LAMBERT_MY.transparency][1]=1-t,i.originData.inputs[Ae.LAMBERT_MY.transparency][2]=1-t,r.addNode(i),r.addNode(Et("SHADING_ENGINE_MY","Output")),Ke(r,0,st.LAMBERT_MY.color,1,Ae.SHADING_ENGINE_MY.surface);break;default:console.error("createDiffuseMaterial: Incorrect material profile - "+n),r=null}return new Ba({name:o,nodeGraph:r,profile:n})}function lre(o="blender",e={}){let t=new bn,n=e.color??"white",r=e.emissive??"black";const a=e.opacity??1,i=e.metalness??0,s=e.roughness??1,c=e.emissiveIntensity??1;let u,h;switch(n instanceof Qe||(n=new Qe(n)),r instanceof Qe||(r=new Qe(r)),o){case"blender":u=Et("RGB_BL","color"),n.toArray(u.originData.outputs[st.RGB_BL.color]),t.addNode(u),h=Et("RGB_BL","emissive"),r.toArray(h.originData.outputs[st.RGB_BL.color]),t.addNode(h),t.addNode(Et("VALUE_BL","opacity",{outputs:[a]})),t.addNode(Et("VALUE_BL","metalness",{outputs:[i]})),t.addNode(Et("VALUE_BL","roughness",{outputs:[s]})),t.addNode(Et("VALUE_BL","emissiveIntensity",{outputs:[c]})),t.addNode(Et("BSDF_PRINCIPLED_BL","Shader")),Ke(t,0,st.RGB_BL.color,6,Ae.BSDF_PRINCIPLED_BL.baseColor),Ke(t,1,st.RGB_BL.color,6,Ae.BSDF_PRINCIPLED_BL.emission),Ke(t,2,st.VALUE_BL.value,6,Ae.BSDF_PRINCIPLED_BL.alpha),Ke(t,3,st.VALUE_BL.value,6,Ae.BSDF_PRINCIPLED_BL.metallic),Ke(t,4,st.VALUE_BL.value,6,Ae.BSDF_PRINCIPLED_BL.roughness),Ke(t,5,st.VALUE_BL.value,6,Ae.BSDF_PRINCIPLED_BL.emissionStrength),t.addNode(Et("OUTPUT_MATERIAL_BL","Output")),Ke(t,6,st.BSDF_PRINCIPLED_BL.color,7,Ae.OUTPUT_MATERIAL_BL.surface);break;case"max":u=Et("RGB_MX","color"),n.toArray(u.originData.outputs[st.RGB_MX.color]),t.addNode(u),h=Et("RGB_MX","emissive"),r.toArray(h.originData.outputs[st.RGB_BL.color]),t.addNode(h),t.addNode(Et("VALUE_MX","opacity",{outputs:[a]})),t.addNode(Et("VALUE_MX","metalness",{outputs:[i]})),t.addNode(Et("VALUE_MX","roughness",{outputs:[s]})),t.addNode(Et("VALUE_MX","emissiveIntensity",{outputs:[c]})),t.addNode(Et("PHYSICAL_MX","Shader")),Ke(t,0,st.RGB_MX.color,6,Ae.PHYSICAL_MX.baseColor),Ke(t,1,st.RGB_MX.color,6,Ae.PHYSICAL_MX.emitColor),Ke(t,2,st.VALUE_BL.value,6,Ae.PHYSICAL_MX.opacity),Ke(t,3,st.VALUE_MX.value,6,Ae.PHYSICAL_MX.metalness),Ke(t,4,st.VALUE_MX.value,6,Ae.PHYSICAL_MX.roughness),Ke(t,5,st.VALUE_MX.value,6,Ae.PHYSICAL_MX.emission),t.addNode(Et("OUTPUT_MX","Output")),Ke(t,6,st.PHYSICAL_MX.color,7,Ae.OUTPUT_MX.color);break;case"maya":u=Et("COLOR_CONSTANT_MY","color"),n.toArray(u.originData.inputs[Ae.COLOR_CONSTANT_MY.color]),n.toArray(u.originData.outputs[Ae.COLOR_CONSTANT_MY.color]),t.addNode(u),h=Et("COLOR_CONSTANT_MY","emissive"),r.toArray(h.originData.inputs[Ae.COLOR_CONSTANT_MY.color]),r.toArray(h.originData.outputs[Ae.COLOR_CONSTANT_MY.color]),t.addNode(h),t.addNode(Et("FLOAT_CONSTANT_MY","opacity",{outputs:[a]})),t.addNode(Et("FLOAT_CONSTANT_MY","metalness",{outputs:[i]})),t.addNode(Et("FLOAT_CONSTANT_MY","roughness",{outputs:[s]})),t.addNode(Et("FLOAT_CONSTANT_MY","emissiveIntensity",{outputs:[c]})),t.addNode(Et("STANDARD_SURFACE_AR","Shader")),Ke(t,0,st.COLOR_CONSTANT_MY.color,6,Ae.STANDARD_SURFACE_AR.baseColor),Ke(t,1,st.COLOR_CONSTANT_MY.color,6,Ae.STANDARD_SURFACE_AR.emissionColor),Ke(t,2,st.FLOAT_CONSTANT_MY.value,6,Ae.STANDARD_SURFACE_AR.opacity),Ke(t,3,st.FLOAT_CONSTANT_MY.value,6,Ae.STANDARD_SURFACE_AR.metalness),Ke(t,4,st.FLOAT_CONSTANT_MY.value,6,Ae.STANDARD_SURFACE_AR.specularRoughness),Ke(t,5,st.FLOAT_CONSTANT_MY.value,6,Ae.STANDARD_SURFACE_AR.emission),t.addNode(Et("SHADING_ENGINE_MY","Output")),Ke(t,6,st.STANDARD_SURFACE_AR.color,7,Ae.SHADING_ENGINE_MY.surface);break;default:console.error("createStandardPBRMaterial: Incorrect material profile - "+o),t=null}return new Ba({name:name??"",nodeGraph:t,profile:o})}var cre=Object.freeze({__proto__:null,createDiffuseMaterial:Ab,createEnvironmentMaterial:HB,createStandardPBRMaterial:lre,disposeTextures:k2,replaceTexture:sre});const $w=new Qe,Jw=new Ve;function ure(o){const e=new Da,t=o.count,n=o.geometry,r=o.material;for(let a=0;a<t;a++){const i=new Mt(n,r);o.getMatrixAt(a,i.matrix),i.matrix.decompose(i.position,i.quaternion,i.scale),e.add(i)}return e.copy(o),e.updateWorldMatrix(!1,!0),e}function dre(o){if(Array.isArray(o.material)===!1)return console.warn("v3d.SceneUtils.createMeshesFromMultiMaterialMesh(): The given mesh has no multiple materials."),o;const e=new Da;e.copy(o);const t=GB(o.geometry),n=t.index,r=t.groups,a=Object.keys(t.attributes);for(let i=0;i<r.length;i++){const s=r[i],c=s.start,u=c+s.count,h=new mt,f=o.material[s.materialIndex];for(let g=0;g<a.length;g++){const A=a[g],_=t.attributes[A],x=_.itemSize,C=s.count*x,b=new _.array.constructor(C),y=new $e(b,x);for(let M=c,R=0;M<u;M++,R++){const T=n.getX(M);x>=1&&y.setX(R,_.getX(T)),x>=2&&y.setY(R,_.getY(T)),x>=3&&y.setZ(R,_.getZ(T)),x>=4&&y.setW(R,_.getW(T))}h.setAttribute(A,y)}const m=new Mt(h,f);e.add(m)}return e}function fre(o,e){const t=new Da;for(let n=0,r=e.length;n<r;n++)t.add(new Mt(o,e[n]));return t}function hre(o,e,t){let n=t;const r=new B;return o.updateWorldMatrix(!0,!0),o.traverseVisible(a=>{const{geometry:i}=a;if(i!==void 0){const{position:s}=i.attributes;if(s!==void 0)for(let c=0,u=s.count;c<u;c++)a.isMesh?a.getVertexPosition(c,r):r.fromBufferAttribute(s,c),a.isSkinnedMesh||r.applyMatrix4(a.matrixWorld),n=e(n,r)}}),n}function pre(o,e){const t=mg(o.instanceMatrix),n=o.instanceColor?mg(o.instanceColor):null,r=new Map;for(const i in o.geometry.attributes){const s=o.geometry.attributes[i];s.isInstancedBufferAttribute&&r.set(s,mg(s))}const a=[];for(let i=0;i<o.count;i++)a.push(i);a.sort(e);for(let i=0;i<a.length;i++){const s=a[i];Jw.fromArray(t.array,s*o.instanceMatrix.itemSize),Jw.toArray(o.instanceMatrix.array,i*o.instanceMatrix.itemSize),o.instanceColor&&($w.fromArray(n.array,s*o.instanceColor.itemSize),$w.toArray(o.instanceColor.array,i*o.instanceColor.itemSize));for(const c in o.geometry.attributes){const u=o.geometry.attributes[c];if(u.isInstancedBufferAttribute){const h=r.get(u);u.setX(i,h.getX(s)),u.itemSize>1&&u.setY(i,h.getY(s)),u.itemSize>2&&u.setZ(i,h.getZ(s)),u.itemSize>3&&u.setW(i,h.getW(s))}}}}function mre(o,e){if(Uy(e))return xb(o,e);const t=this.getMaterialsByName(o,e);return t.length?t[0]:null}function gre(o,e){if(Uy(e)){const n=xb(o,e);return n?[n]:[]}const t=[];if(o.scene!==null){o.scene.traverse(function(r){r.material&&r.material.name===e&&t.indexOf(r.material)===-1&&t.push(r.material)});const n=o.scene.worldMaterial;n!==null&&n.name===e&&t.indexOf(n)===-1&&t.push(n)}return t}function xb(o,e){let t=null;if(o.scene!==null){o.scene.traverse(r=>{r.material&&r.material.uuid===e&&(t=r.material)});const n=o.scene.worldMaterial;n!==null&&n.uuid===e&&(t=n)}return t}function WB(o){const e=[];if(o.scene!==null){o.scene.traverse(n=>{n.material&&!e.includes(n.material)&&e.push(n.material)});const t=o.scene.worldMaterial;t===null||e.includes(t)||e.push(t)}return e}function vre(o,e){for(let t=0;t<o.actions.length;t++){const n=o.actions[t];if(n.getClip().name==e)return n}return null}function YB(o,e){return!!e._propertyBindings.find(function(t){const n=t.binding.node;return n&&n.findRoot()===o})}function gg(o){const e=new mn;return e.expandByObject(o),e}function jB(o,e){const t=new B,n=2*o.getSize(t).length(),r=new ir(45,e,n/1e4,n);return r.position.copy(o.max).multiplyScalar(2),r.lookAt(o.getCenter(t)),r}function XB(o,e){const t=new Tt;e.getCenter(t.position),o.controlSettings=new _b,o.controlSettings.orbitMinDistance=o.near,o.controlSettings.orbitMaxDistance=o.far,o.controlSettings.orbitTarget=t}var _re=Object.freeze({__proto__:null,assignDefaultControls:XB,calcSceneBox:gg,checkActionIsUsed:YB,createDefaultCamera:jB,createEnvironmentMaterial:HB,createMeshesFromInstancedMesh:ure,createMeshesFromMultiMaterialMesh:dre,createMultiMaterialObject:fre,getAllMaterials:WB,getAnimationActionByName:vre,getMaterialByName:mre,getMaterialByUUID:xb,getMaterialsByName:gre,reduceVertices:hre,sortInstancedMesh:pre});const Are="MADE WITH VERGE3D TRIAL",eT={Afterimage:MB,Bloom:pl,Bokeh:cb,"Brightness/Contrast":ub,FXAA:Xg,Grayscale:db,Mask:fb,Outline:ii,Render:qg,SSAA:Jh,SSR:IB,ToneMapping:hb,"Copy/Other":ms},xre={[$L]:"RGBA",[JL]:"DEPTH",[l5]:"RGBA_BPTC",[s5]:"RGBA_ASTC_4x4",[e5]:"RGB_S3TC_DXT1",[t5]:"RGBA_S3TC_DXT5",[n5]:"RGB_PVRTC_4BPPV1",[r5]:"RGBA_PVRTC_4BPPV1",[o5]:"RGB_ETC1",[a5]:"RGB_ETC2",[i5]:"RGB_ETC2_EAC"};class eo{static getPageParams(e){let t=(e=e||window).location.href.toString();const n={};if(t.indexOf("?")==-1)return n;const r=t.split("#")[0].split("?")[1].split("&");for(let a=0;a<r.length;a++){const i=r[a].split("="),s=decodeURIComponent(i[0]);i.length==1?n[s]="":n[s]=decodeURIComponent(i[1])}return n}static updatePageParam(e,t,n){let r,a,i=null,s="",c=e.split("?"),u=c[0],h=c[1],f="";if(h){r=h.split("#"),a=r[0],i=r[1],i&&(h=a),c=h.split("&");for(let m=0;m<c.length;m++)c[m].split("=")[0]!=t&&(s+=f+c[m],f="&")}else r=u.split("#"),a=r[0],i=r[1],a&&(u=a);return i&&(n+="#"+i),u+"?"+s+(f+""+t+"="+n)}static loadScript(e,t,n,r){function a(c){s.removeEventListener("load",a,!1),s.removeEventListener("error",i,!1),t.removeChild(s),n(c)}function i(c){s.removeEventListener("load",a,!1),s.removeEventListener("error",i,!1),t.removeChild(s),r(c)}const s=document.createElement("script");s.addEventListener("load",a,!1),s.addEventListener("error",i,!1),t.appendChild(s),s.src=e}static drawWatermark(e){setTimeout(function(){typeof __V3D_DEVTOOLS__<"u"&&__V3D_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:"4.9.0",v3dl:zg}}))},0);const t=e.container;if(vd(zg)!=3483952072)return;const n=["color: #fff;","opacity: 0.5;","font-size: 18px;","font-family: sans-serif;","text-align: center;","text-decoration: none;","position: absolute;","bottom: 1%;","right: 1%;","user-select: none;","z-index: 9999;","text-shadow: 1px 1px #000;"].join(`
`),r=document.createElement("div");r.innerHTML=`<a href="https://www.soft8soft.com/verge3d-trial/" target="_blank" style="${n}">${Are}</a>`,t.appendChild(r),setTimeout(function(){t.contains(r)&&vd(r.textContent)==890310108||e.dispose()},1e3)}static isXML(e){return e.match(/.*\.xml$/)!==null}static isJS(e){return e.match(/.*\.js$/)!==null}static addToAppList(e){const t=Yh();t.v3d&&(t.v3d.apps=t.v3d.apps||[],t.v3d.apps.indexOf(e)==-1&&t.v3d.apps.push(e))}static removeFromAppList(e){const t=Yh();if(t.v3d&&t.v3d.apps){const n=t.v3d.apps.indexOf(e);n>-1&&t.v3d.apps.splice(n,1)}}static printPerformanceInfo(e,t){t=t||1;const n=e.renderer.info;n.reset();const r=e.frame;for(let s=0;s<n.programs.length;s++)n.programs[s].profile.calcRenderTime=!0;let a;function i(s,c){a==s&&(s+=" "),a=s,c?console.log("%c"+s,"color:red"):console.log(s)}setTimeout(function(){if(i("--- Verge3D Performance Profile ("+t+"s) ---"),!e.scene)return void i("Scene not loaded");const s=e.frame-r,c=Math.round(e._loadingTime);i(`Scene Loading Time: ${c}ms`,c>1e4);const u=e._loadSceneURL.indexOf(".xz",e._loadSceneURL.length-3)!=-1;i("Asset Compression: "+(u?"yes":"no"),u==0);const h=Math.round(n.numShaderCompiles);i(`Shader Compilations: ${h}`,h>100);const f=s/t;i("FPS: "+f,f<30);const m=Math.round(n.render.calls/s);i("Render Calls: "+m,m>1e3);const g=Math.round(n.render.triangles/s);i("Triangles Rendered: "+g,g>1e6),i("Geometry Buffers: "+n.memory.geometries,n.memory.geometries>200),i("HDR Rendering: "+(e.useHDR?"yes":"no")),i("Order-Independent Transparency: "+(e.renderer.useOIT?"yes":"no"));const A=e.renderer.getDrawingBufferSize(new Ee);i("Viewport Resolution: "+A.x+"x"+A.y),i(`Pixel Ratio: ${e.renderer.getPixelRatio()} (current) / ${window.devicePixelRatio} (device)`);let _="N/A";switch(e._envIBLMode){case 0:_="PMREM",_+=` ${e._pmremMaxTileSize} px`;break;case 1:_="Light Probe",_+=` ${e._pmremMaxTileSize} px`}i(`Image-Based Lighting: ${_}`);let x=0,C=0,b=0,y=0,M=0,R=0;e.scene.traverse(function(O){O.isLight&&(x++,O.castShadow&&O.shadow&&(y++,M=O.shadow.mapSize.width,R=O.shadow.mapSize.height)),O.isCubeReflectionProbe&&C++,O.isPlaneReflectionProbe&&b++}),i("Lights: "+x,x>10),i(`Reflection Probes: ${C} (cube) / ${b} (plane) `,C>3||b>1);const T=[];e.postprocessing&&(e.postprocessing.gtaoGenerator&&T.push("GTAO"),e.postprocessing.composer.passes.forEach(function(O){for(let q in eT)if(O instanceof eT[q])return void T.push(q);T.push("Undefined")})),i(`Post-Processing: ${T.length?T.join(","):"N/A"}`);let w="N/A";if(y&&e.renderer.shadowMap&&e.renderer.shadowMap.enabled){switch(e.renderer.shadowMap.type){case 0:w="Basic";break;case 1:w="Bilinear";break;case 2:w="PCF";break;case 3:w="ESM";break;default:w="Unknown"}w+=` ${M}x${R}x${y}`}i("Shadow Map: "+w,y>4||M>2048||R>2048);const D=n.programs.slice(0);i("Materials and Shaders: "+D.length,D>100),D.sort(function(O,q){return q.profile.renderTime-O.profile.renderTime});let z=0;for(let O=0;O<D.length;O++){const q=D[O];q.profile.calcRenderTime=!1;const ne=q.profile.materials,$=q.profile.renderTime/s;let he;he=$>=.1?String(Math.round(10*$)/10)+"ms":$>0&&$<.1?String(Math.round(1e3*$)/1e3)+"ms":"N/R",i("    "+(ne.size==0?"System Material":Array.from(ne).join(","))+" - "+q.name+" - "+he,$>16),z+=$,q.profile.renderTime=0}i("Total Render Time: "+String(Math.round(10*z)/10)+"ms",z>16),i("Textures & Render Buffers: "+n.memory.textures,n.memory.textures>100);const F=Array.from(n.memory.textureSpecs.values());F.sort(function(O,q){return O.type<q.type?1:O.type>q.type?-1:O.width!=q.width?q.width-O.width:q.height-O.height});for(let O=0;O<F.length;O++){const q=F[O],ne=q.type=="Texture"?"- "+xre[q.format]:"",$=q.isCube?"x6":"";i(`    ${q.name||"N/A"} - ${q.type} - ${q.width}x${q.height}${$} ${ne}`,q.width>=4096||q.height>=4096)}if(n.render.customCounter){const O=n.render.customCounter/s;i(`Custom Counter: ${Math.round(10*O)/10} iter/frame`)}},1e3*t)}static printMaterialsStats(e){const t=WB(e).filter(i=>i.type=="MeshNodeMaterial"),n=new Map;t.forEach(i=>{i.traverseNodes(s=>{const c=s.originData.type;n.has(c)||n.set(c,0),n.set(c,n.get(c)+1)})});const r=Array.from(n);r.sort((i,s)=>s[1]-i[1]),console.log("Total Node Materials:",t.length);const a=e.renderer.info.programs.filter(i=>i.name=="MeshNodeMaterial");console.log("Total Node Shaders:",a.length),console.log("Node Stats:"),r.forEach(i=>{console.log(`    ${i[0]} - ${i[1]}`)})}static registerServiceKeys(e){eo.unregisterServiceKeys(e),e._serviceKeyListeners=e._serviceKeyListeners||[];const t=e._serviceKeyListeners;t.push(new b0(window,"KeyP",function(){eo.printPerformanceInfo(e,1)},3,1)),t.push(new b0(window,"KeyF",function(){e.stats?e.hideFPS():e.showFPS()},3,1)),t.push(new b0(window,"KeyH",function(){e.enableRender?e.disableRendering():e.enableRendering()},3,1)),t.push(new b0(window,["Backquote","IntlBackslash"],()=>{let n;eo.showServiceKeysHelp(e),e.controls&&(n=e.controls.enableKeys,e.controls.enableKeys=!1);const r=a=>{switch(a.code){case"KeyW":e.hasDebugMode("wireframes")?e.disableDebugMode("wireframes"):e.enableDebugMode("wireframes");break;case"KeyL":e.hasDebugMode("lights")?e.disableDebugMode("lights"):e.enableDebugMode("lights");break;case"KeyS":e.hasDebugMode("skeletons")?e.disableDebugMode("skeletons"):e.enableDebugMode("skeletons");break;case"KeyP":eo.printPerformanceInfo(e,1);break;case"KeyF":e.stats?e.hideFPS():e.showFPS();break;case"KeyH":e.enableRender?e.disableRendering():e.enableRendering();break;case"KeyN":e.hasDebugMode("normals")?e.disableDebugMode("normals"):e.enableDebugMode("normals");break;case"KeyG":{const i=new Nv,s={onlyVisible:!0,binary:!0,trs:!0,animations:[]};for(let c=0;c<e.actions.length;c++){const u=e.actions[c].getClip();s.animations.includes(u)||s.animations.push(u)}i.parse(e.scene,function(c){const u=URL.createObjectURL(new Blob([c],{type:"application/octet-stream"})),h=document.createElement("a");h.href=u,h.download="scene.glb",document.body.appendChild(h),h.click()},function(c){console.error("GLTFExporter: export failed: "+c)},s)}break;case"KeyU":new zB().parse(e.scene).then(function(i){const s=URL.createObjectURL(new Blob([i],{type:"application/octet-stream"})),c=document.createElement("a");c.href=s,c.download="scene.usdz",document.body.appendChild(c),c.click()},function(i){console.error("USDZExporter: export failed: "+i)});break;case"KeyM":eo.printMaterialsStats(e);break;case"KeyT":e.pause(e)}window.removeEventListener("keydown",r),eo.hideServiceKeysHelp(e),e.controls&&(e.controls.enableKeys=n)};window.addEventListener("keydown",r)},3,1))}static unregisterServiceKeys(e){Array.isArray(e._serviceKeyListeners)&&(e._serviceKeyListeners.forEach(t=>t.dispose()),e._serviceKeyListeners.length=0)}static showServiceKeysHelp(e){const t=e.container,n=["color: #fff;","font-size: 14px;","font-family: monospace;","text-decoration: none;","position: absolute;",`top: ${e.stats?60:10}px;`,"left: 10px;","user-select: none;","z-index: 9999;","text-shadow: 1px 1px #000;"].join(`
`),r=document.createElement("div");r.id="v3d-debug-info-help",r.style=n,r.innerHTML="Service Tools:<br>[F] FPS counter<br>[P] performance profile<br>[H] halt/resume render<br>[W] wireframes<br>[L] lights<br>[S] skeletons<br>[N] normals",r.innerHTML+="<br>[G] glTF export<br>[U] USDZ export<br>[M] materials stats<br>[T] terminate",t.appendChild(r)}static hideServiceKeysHelp(e){e.container.querySelector("#v3d-debug-info-help").remove()}}const qB={prepareRenderer:function(o){Wn.getGPUVendor(o),Wn.getGPUModel(o);const e=Wn.checkAndroid();o.compatSettings.gtaoDisableBkgFix=e}};function ep(o){this.sourceTexture=o,this.camera=new yi(-1,1,1,-1,0,1),this.shader=new An({type:"CubeCopy",uniforms:{faceIdx:{value:0},cubemap:{value:null}},vertexShader:`
        uniform int faceIdx;

        varying vec3 vCubeDirection;

        vec3 uvToCubeDirection(vec2 uv, int face) {
            vec3 dir;
            uv = 2.0 * uv - 1.0;

            if (face == 0) {
                dir = vec3(1.0, -uv.y, -uv.x);
            } else if (face == 1) {
                dir = vec3(-1.0, -uv.y, uv.x);
            } else if (face == 2) {
                dir = vec3(uv.x, 1.0, uv.y);
            } else if (face == 3) {
                dir = vec3(uv.x, -1.0, -uv.y);
            } else if (face == 4) {
                dir = vec3(uv.x, -uv.y, 1.0);
            } else if (face == 5) {
                dir = vec3(-uv.x, -uv.y, -1.0);
            }
            return dir;
        }

        void main() {
            vCubeDirection = uvToCubeDirection(uv, faceIdx);
            gl_Position = vec4(position, 1.0);
        }
        `,fragmentShader:`
        uniform samplerCube cubemap;

        varying vec3 vCubeDirection;

        void main() {
            gl_FragColor = textureCube(cubemap, vCubeDirection);

            #include <tonemapping_fragment>

            gl_FragColor = linearToOutputTexel(gl_FragColor);
        }
        `}),this.shader.map=o,this.shader.uniforms.cubemap.value=o,this.planeMesh=new Mt(new ps(2,2),this.shader),this.scene=new Hr,this.scene.add(this.camera),this.scene.add(this.planeMesh)}function yre(o){return!!Wn.checkHalfFloatTex(o,!0)&&(!/Firefox/.test(navigator.userAgent)||!/Android/.test(navigator.userAgent))}function yb(o,e,t,{camPos:n=new B,clipStart:r=.1,clipEnd:a=100}={}){yre(e)||(console.warn("v3d.RenderUtils: disabling half float cubemaps"),t.texture.type=1009);const i=new kg(r,a,t);i.position.copy(n);let s=o.worldMaterial;if(s!==null&&s.isMeshNodeMaterial){const c=new Mt(new up(1,1,1),s);c.material.side=1,c.material.defines.WORLD_NODES=1,new kg(.1,10,t).update(e,c),c.geometry.disposeBoundsTree&&c.geometry.disposeBoundsTree(),c.geometry.dispose();const u=o.background;o.background=null;const h=e.autoClearColor;e.autoClearColor=!1,i.update(e,o),e.autoClearColor=h,o.background=u}else i.update(e,o);return i.renderTarget}function ZB(o,e,t,n){e.isMeshNodeMaterial||console.error("v3d.RenderUtils.renderWorldNodeMatToCubemap(): material is not an instance of MeshNodeMaterial.");const r=new Hr;r.worldMaterial=e;const a=new fp(t,n);return a.texture.name="WorldNodesCubemap",yb(r,o,a)}function bre(o){const e=o.layers.mask;return o.layers.set(0),o.isArrayCamera&&(o.layers.enable(1),o.layers.enable(2)),o.layers.enable(3),o.layers.enable(4),o.layers.enable(5),o.layers.enable(6),o.layers.enable(7),e}ep.prototype={constructor:ep,render:function(o,e,t=1){var n=o.toneMapping,r=o.toneMappingExposure,a=o.getRenderTarget();o.toneMapping=1,o.toneMappingExposure=t;for(var i=0;i<6;i++)o.setRenderTarget(e,i),this.shader.uniforms.faceIdx.value=i,o.render(this.scene,this.camera);o.toneMapping=n,o.toneMappingExposure=r,o.setRenderTarget(a)},dispose:function(){this.planeMesh.geometry.dispose(),this.planeMesh.material.dispose()}};var Sre=Object.freeze({__proto__:null,assignAllLayersMask:bre,renderSceneToCubemap:yb,renderWorldNodeMatToCubemap:ZB});const M0=new mn,Yf=new Yo,Cre=new Ve,Ere=new B,Mre=new B;class bb extends Tt{constructor(e=256){super(),this.isCubeReflectionProbe=!0,this.type="CubeReflectionProbe",this.influenceType=1,this.influenceDistance=1,this.parallaxType=1,this.parallaxDistance=1,this.probeClipStart=.1,this.probeClipEnd=100,this.probeIntensity=1,this.visibilityGroup=null,this.visibilityGroupInv=!1,this.influenceGroup=null,this.influenceGroupInv=!1,this._renderTargetCube=new fp(e,{encoding:3001,format:1023,generateMipmaps:!0,minFilter:1008,type:1016}),this._renderTargetCube.texture.name="CubeReflectionProbe.ini",this._exposureRenderTargetCube=this._renderTargetCube.clone(),this._renderTargetCube.texture.name="CubeReflectionProbe.exp",this.renderTarget=null,this.matrixWorldInverse=new Ve}setSize(e){this._renderTargetCube.setSize(e,e),this._exposureRenderTargetCube.setSize(e,e)}setEncoding(e){this._renderTargetCube.texture.encoding=e,this._exposureRenderTargetCube.texture.encoding=e}intersectsMesh(e){let t=!1;const n=e.geometry,r=n.boundsTree,a=Cre;switch(a.copy(e.matrixWorld).invert(),a.multiply(this.matrixWorld),this.influenceType){case 0:t=!0;break;case 1:Yf.center.setScalar(0),Yf.radius=this.influenceDistance,Yf.applyMatrix4(a),r?t=r.intersectsSphere(Yf):(n.boundingBox===null&&n.computeBoundingBox(),t=n.boundingBox.intersectsSphere(Yf));break;case 2:const i=Ere.setScalar(0),s=Mre.setScalar(2*this.influenceDistance);M0.setFromCenterAndSize(i,s),r?t=r.intersectsBox(M0,a):(M0.applyMatrix4(a),n.boundingBox===null&&n.computeBoundingBox(),t=n.boundingBox.intersectsBox(M0))}return t}update(e,t){const n={};e.traverse(c=>{!c.isCubeReflectionProbe&&this._isVisible(c)||(n[c.id]=c.layers.mask,c.layers.disableAll())});const r=e.worldMaterial,a=r!==null&&r.isMeshNodeMaterial&&r.needsLightPathDir();let i;a&&(i=r.defines.LIGHT_PATH_IS_CAM_RAY,r.defines.LIGHT_PATH_IS_CAM_RAY=0),yb(e,t,this._renderTargetCube,{camPos:this.position,clipStart:this.probeClipStart,clipEnd:this.probeClipEnd}),this._exposureRenderTargetCube.texture.type=this._renderTargetCube.texture.type;const s=new ep(this._renderTargetCube.texture);s.render(t,this._exposureRenderTargetCube,this.probeIntensity),s.dispose(),this.renderTarget=this.onUpdate(this._exposureRenderTargetCube),a&&(r.defines.LIGHT_PATH_IS_CAM_RAY=i),e.traverse(c=>{!c.isCubeReflectionProbe&&this._isVisible(c)||(c.layers.mask=n[c.id])})}onUpdate(e){return e}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}copy(e){return super.copy(e),this.influenceType=e.influenceType,this.influenceDistance=e.influenceDistance,this.parallaxType=e.parallaxType,this.parallaxDistance=e.parallaxDistance,this.probeClipStart=e.probeClipStart,this.probeClipEnd=e.probeClipEnd,this.probeIntensity=e.probeIntensity,this.visibilityGroup=e.visibilityGroup,this.visibilityGroupInv=e.visibilityGroupInv,this.influenceGroup=e.influenceGroup,this.influenceGroupInv=e.influenceGroupInv,this.setSize(e._renderTargetCube.width),this.matrixWorldInverse.copy(e.matrixWorldInverse),this}dispose(){this._renderTargetCube!==null&&this._renderTargetCube.dispose(),this._exposureRenderTargetCube!==null&&this._exposureRenderTargetCube.dispose(),this.renderTarget!==null&&(this.renderTarget.dispose(),this.renderTarget=null),this.dispatchEvent({type:"dispose"})}_isVisible(e){return this.visibilityGroup===null||!e.isMesh?!0:e.groupNames.indexOf(this.visibilityGroup)!==-1^this.visibilityGroupInv}}class G2{constructor(e,t){if(this.renderer=e,t===void 0){const n=e.getSize(new Ee);this._pixelRatio=e.getPixelRatio(),this._width=n.width,this._height=n.height,(t=new qt(Math.floor(this._width*this._pixelRatio),Math.floor(this._height*this._pixelRatio))).texture.name="EffectComposer.rt1"}else this._pixelRatio=1,this._width=t.width,this._height=t.height;this.renderTarget1=t,this.renderTarget2=t.clone(),this.renderTarget2.texture.name="EffectComposer.rt2",this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.renderToScreen=!0,this.passes=[],this.copyPass=new ms(xt.copy),this.clock=new bi}swapBuffers(){const e=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=e}addPass(e){this.passes.push(e),e.setSize(Math.floor(this._width*this._pixelRatio),Math.floor(this._height*this._pixelRatio))}insertPass(e,t){this.passes.splice(t,0,e),e.setSize(Math.floor(this._width*this._pixelRatio),Math.floor(this._height*this._pixelRatio))}removePass(e){const t=this.passes.indexOf(e);t!==-1&&this.passes.splice(t,1)}isLastEnabledPass(e){for(let t=e+1;t<this.passes.length;t++)if(this.passes[t].enabled)return!1;return!0}render(e){e===void 0&&(e=this.clock.getDelta());const t=this.renderer.getRenderTarget();let n=!1;for(let r=0,a=this.passes.length;r<a;r++){const i=this.passes[r];if(i.enabled!==!1){if(i.renderToScreen=this.renderToScreen&&this.isLastEnabledPass(r),i.render(this.renderer,this.writeBuffer,this.readBuffer,e,n),i.needsSwap){if(n){const s=this.renderer.getContext(),c=this.renderer.state.buffers.stencil;c.setFunc(s.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,e),c.setFunc(s.EQUAL,1,4294967295)}this.swapBuffers()}i instanceof fb?n=!0:i instanceof TB&&(n=!1)}}this.renderer.setRenderTarget(t)}reset(e){if(e===void 0){const t=this.renderer.getSize(new Ee);this._pixelRatio=this.renderer.getPixelRatio(),this._width=t.width,this._height=t.height,(e=this.renderTarget1.clone()).setSize(Math.floor(this._width*this._pixelRatio),Math.floor(this._height*this._pixelRatio))}this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.renderTarget1=e,this.renderTarget2=e.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2}setSize(e,t){this._width=e,this._height=t;const n=Math.floor(this._width*this._pixelRatio),r=Math.floor(this._height*this._pixelRatio);this.renderTarget1.setSize(n,r),this.renderTarget2.setSize(n,r);for(let a=0;a<this.passes.length;a++)this.passes[a].setSize(n,r)}setPixelRatio(e){this._pixelRatio=e,this.setSize(this._width,this._height)}getPixelRatio(){return this._pixelRatio}dispose(){this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.copyPass.dispose()}getActiveSSAAPass(){return this.passes[0]instanceof Jh?this.passes[0]:null}insertPassAfter(e,t){let n=0;for(let r=0;r<this.passes.length;r++)t.indexOf(this.passes[r])>-1&&(n=r+1);this.insertPass(e,n)}enableAllPasses(){for(let e=0;e<this.passes.length;e++)this.passes[e].enabled=!0}disableAllPasses(){for(let e=0;e<this.passes.length;e++)this.passes[e].enabled=!1}setStencil(e){this.renderTarget1.stencilBuffer=e,this.renderTarget1.dispose(),this.renderTarget2.stencilBuffer=e,this.renderTarget2.dispose()}}var KB=(()=>{var o=import.meta.url;return function(e){e=(e=e||{})!==void 0?e:{};var t,n,r=Object.assign;e.ready=new Promise(function(fe,ve){t=fe,n=ve});var a,i,s,c,u,h,f=r({},e),m=typeof window=="object",g=typeof importScripts=="function",A=typeof process=="object"&&typeof process.versions=="object"&&typeof process.versions.node=="string",_="";A?(_=g?require("path").dirname(_)+"/":__dirname+"/",h=()=>{u||(c=require("fs"),u=require("path"))},a=function(fe,ve){var xe=W(fe);return xe?ve?xe:xe.toString():(h(),fe=u.normalize(fe),c.readFileSync(fe,ve?null:"utf8"))},s=fe=>{var ve=a(fe,!0);return ve.buffer||(ve=new Uint8Array(ve)),ve},i=(fe,ve,xe)=>{var Ie=W(fe);Ie&&ve(Ie),h(),fe=u.normalize(fe),c.readFile(fe,function(re,me){re?xe(re):ve(me.buffer)})},process.argv.length>1&&process.argv[1].replace(/\\/g,"/"),process.argv.slice(2),process.on("uncaughtException",function(fe){if(!(fe instanceof se))throw fe}),process.on("unhandledRejection",function(fe){throw fe}),e.inspect=function(){return"[Emscripten Module object]"}):(m||g)&&(g?_=self.location.href:typeof document<"u"&&document.currentScript&&(_=document.currentScript.src),o&&(_=o),_=_.indexOf("blob:")!==0?_.substr(0,_.replace(/[?#].*/,"").lastIndexOf("/")+1):"",a=fe=>{try{var ve=new XMLHttpRequest;return ve.open("GET",fe,!1),ve.send(null),ve.responseText}catch(Ie){var xe=W(fe);if(xe)return function(re){for(var me=[],pe=0;pe<re.length;pe++){var Ce=re[pe];Ce>255&&(Ce&=255),me.push(String.fromCharCode(Ce))}return me.join("")}(xe);throw Ie}},g&&(s=fe=>{try{var ve=new XMLHttpRequest;return ve.open("GET",fe,!1),ve.responseType="arraybuffer",ve.send(null),new Uint8Array(ve.response)}catch(Ie){var xe=W(fe);if(xe)return xe;throw Ie}}),i=(fe,ve,xe)=>{var Ie=new XMLHttpRequest;Ie.open("GET",fe,!0),Ie.responseType="arraybuffer",Ie.onload=()=>{if(Ie.status==200||Ie.status==0&&Ie.response)ve(Ie.response);else{var re=W(fe);re?ve(re.buffer):xe()}},Ie.onerror=xe,Ie.send(null)}),e.print||console.log.bind(console);var x,C,b=e.printErr||console.warn.bind(console);r(e,f),f=null,e.arguments&&e.arguments,e.thisProgram&&e.thisProgram,e.quit&&e.quit,e.wasmBinary&&(x=e.wasmBinary),e.noExitRuntime,typeof WebAssembly!="object"&&ie("no native wasm support detected");var y=!1;function M(fe){return e["_"+fe]}function R(fe,ve,xe,Ie,re){var me={string:function(ot){var Pt=0;if(ot!=null&&ot!==0){var $t=1+(ot.length<<2);(function(St,De,Un){(function(dn,Nt,rn,Bn){if(!(Bn>0))return 0;for(var io=rn,Mr=rn+Bn-1,Xn=0;Xn<dn.length;++Xn){var gn=dn.charCodeAt(Xn);if(gn>=55296&&gn<=57343&&(gn=65536+((1023&gn)<<10)|1023&dn.charCodeAt(++Xn)),gn<=127){if(rn>=Mr)break;Nt[rn++]=gn}else if(gn<=2047){if(rn+1>=Mr)break;Nt[rn++]=192|gn>>6,Nt[rn++]=128|63&gn}else if(gn<=65535){if(rn+2>=Mr)break;Nt[rn++]=224|gn>>12,Nt[rn++]=128|gn>>6&63,Nt[rn++]=128|63&gn}else{if(rn+3>=Mr)break;Nt[rn++]=240|gn>>18,Nt[rn++]=128|gn>>12&63,Nt[rn++]=128|gn>>6&63,Nt[rn++]=128|63&gn}}Nt[rn]=0})(St,D,De,Un)})(ot,Pt=N($t),$t)}return Pt},array:function(ot){var Pt=N(ot.length);return function($t,St){w.set($t,St)}(ot,Pt),Pt}};function pe(ot){return ve==="string"?(Pt=ot)?function(St,De,Un){for(var dn=De+Un,Nt=De;St[Nt]&&!(Nt>=dn);)++Nt;if(Nt-De>16&&St.subarray&&F)return F.decode(St.subarray(De,Nt));for(var rn="";De<Nt;){var Bn=St[De++];if(128&Bn){var io=63&St[De++];if((224&Bn)!=192){var Mr=63&St[De++];if((Bn=(240&Bn)==224?(15&Bn)<<12|io<<6|Mr:(7&Bn)<<18|io<<12|Mr<<6|63&St[De++])<65536)rn+=String.fromCharCode(Bn);else{var Xn=Bn-65536;rn+=String.fromCharCode(55296|Xn>>10,56320|1023&Xn)}}else rn+=String.fromCharCode((31&Bn)<<6|io)}else rn+=String.fromCharCode(Bn)}return rn}(D,Pt,$t):"":ve==="boolean"?!!ot:ot;var Pt,$t}var Ce=M(fe),we=[],be=0;if(Ie)for(var Pe=0;Pe<Ie.length;Pe++){var Ge=me[xe[Pe]];Ge?(be===0&&(be=Q()),we[Pe]=Ge(Ie[Pe])):we[Pe]=Ie[Pe]}var tt=Ce.apply(null,we);return tt=function(ot){return be!==0&&I(be),pe(ot)}(tt)}var T,w,D,z,F=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0;function O(fe,ve){return fe%ve>0&&(fe+=ve-fe%ve),fe}function q(fe){T=fe,e.HEAP8=w=new Int8Array(fe),e.HEAP16=new Int16Array(fe),e.HEAP32=new Int32Array(fe),e.HEAPU8=D=new Uint8Array(fe),e.HEAPU16=new Uint16Array(fe),e.HEAPU32=new Uint32Array(fe),e.HEAPF32=new Float32Array(fe),e.HEAPF64=new Float64Array(fe)}e.INITIAL_MEMORY;var ne=[],$=[],he=[],K=0,oe=null;function ie(fe){e.onAbort&&e.onAbort(fe),b(fe="Aborted("+fe+")"),y=!0,fe+=". Build with -s ASSERTIONS=1 for more info.";var ve=new WebAssembly.RuntimeError(fe);throw n(ve),ve}e.preloadedImages={},e.preloadedAudios={};var L,U,k="data:application/octet-stream;base64,";function J(fe){return fe.startsWith(k)}function de(fe){return fe.startsWith("file://")}function te(fe){try{if(fe==L&&x)return new Uint8Array(x);var ve=W(fe);if(ve)return ve;if(s)return s(fe);throw"both async and sync fetching of the wasm failed"}catch(xe){ie(xe)}}function le(fe){for(;fe.length>0;){var ve=fe.shift();if(typeof ve!="function"){var xe=ve.func;typeof xe=="number"?ve.arg===void 0?G(xe)():G(xe)(ve.arg):xe(ve.arg===void 0?null:ve.arg)}else ve(e)}}J(L="data:application/octet-stream;base64,AGFzbQEAAAABIwdgAX8AYAABf2ABfwF/YAN/f38Bf2ADf39/AGACf38AYAAAAg0CAWEBYQACAWEBYgADAxoZBAMCAAIFBgQCAAQDAQEBAQIAAQEBAAAAAAQFAXABAQEFBwEBgAKAgAIGCQF/AUHQpIADCwdBEAFjAgABZAAIAWUAEQFmABABZwAPAWgADgFpABoBagAZAWsAGAFsABcBbQAWAW4AFQFvAQABcAAUAXEAEwFyABIKl6QBGf0DAQJ/IAJBgARPBEAgACABIAIQARoPCyAAIAJqIQMCQCAAIAFzQQNxRQRAAkAgAEEDcUUEQCAAIQIMAQsgAkUEQCAAIQIMAQsgACECA0AgAiABLQAAOgAAIAFBAWohASACQQFqIgJBA3FFDQEgAiADSQ0ACwsCQCADQXxxIgBBwABJDQAgAiAAQUBqIgRLDQADQCACIAEoAgA2AgAgAiABKAIENgIEIAIgASgCCDYCCCACIAEoAgw2AgwgAiABKAIQNgIQIAIgASgCFDYCFCACIAEoAhg2AhggAiABKAIcNgIcIAIgASgCIDYCICACIAEoAiQ2AiQgAiABKAIoNgIoIAIgASgCLDYCLCACIAEoAjA2AjAgAiABKAI0NgI0IAIgASgCODYCOCACIAEoAjw2AjwgAUFAayEBIAJBQGsiAiAETQ0ACwsgACACTQ0BA0AgAiABKAIANgIAIAFBBGohASACQQRqIgIgAEkNAAsMAQsgA0EESQRAIAAhAgwBCyAAIANBBGsiBEsEQCAAIQIMAQsgACECA0AgAiABLQAAOgAAIAIgAS0AAToAASACIAEtAAI6AAIgAiABLQADOgADIAFBBGohASACQQRqIgIgBE0NAAsLIAIgA0kEQANAIAIgAS0AADoAACABQQFqIQEgAkEBaiICIANHDQALCwujAQEBfyACQX9zIQICQCABRQ0AIAFBAXEEfyAALQAAIAJB/wFxc0ECdEGwCGooAgAgAkEIdnMhAiAAQQFqIQAgAUEBawUgAQshAyABQQFGDQADQCAALQABIAAtAAAgAkH/AXFzQQJ0QbAIaigCACACQQh2cyIBQf8BcXNBAnRBsAhqKAIAIAFBCHZzIQIgAEECaiEAIANBAmsiAw0ACwsgAkF/cwtRAQJ/QaAIKAIAIgEgAEEDakF8cSICaiEAAkAgAkEAIAAgAU0bDQAgAD8AQRB0SwRAIAAQAEUNAQtBoAggADYCACABDwtB1KDAAEEwNgIAQX8L8QwBB38CQCAARQ0AIABBCGsiAyAAQQRrKAIAIgFBeHEiAGohBQJAIAFBAXENACABQQNxRQ0BIAMgAygCACIBayIDQeigwAAoAgBJDQEgACABaiEAIANB7KDAACgCAEcEQCABQf8BTQRAIAMoAggiAiABQQN2IgRBA3RBgKHAAGpGGiACIAMoAgwiAUYEQEHYoMAAQdigwAAoAgBBfiAEd3E2AgAMAwsgAiABNgIMIAEgAjYCCAwCCyADKAIYIQYCQCADIAMoAgwiAUcEQCADKAIIIgIgATYCDCABIAI2AggMAQsCQCADQRRqIgIoAgAiBA0AIANBEGoiAigCACIEDQBBACEBDAELA0AgAiEHIAQiAUEUaiICKAIAIgQNACABQRBqIQIgASgCECIEDQALIAdBADYCAAsgBkUNAQJAIAMgAygCHCICQQJ0QYijwABqIgQoAgBGBEAgBCABNgIAIAENAUHcoMAAQdygwAAoAgBBfiACd3E2AgAMAwsgBkEQQRQgBigCECADRhtqIAE2AgAgAUUNAgsgASAGNgIYIAMoAhAiAgRAIAEgAjYCECACIAE2AhgLIAMoAhQiAkUNASABIAI2AhQgAiABNgIYDAELIAUoAgQiAUEDcUEDRw0AQeCgwAAgADYCACAFIAFBfnE2AgQgAyAAQQFyNgIEIAAgA2ogADYCAA8LIAMgBU8NACAFKAIEIgFBAXFFDQACQCABQQJxRQRAIAVB8KDAACgCAEYEQEHwoMAAIAM2AgBB5KDAAEHkoMAAKAIAIABqIgA2AgAgAyAAQQFyNgIEIANB7KDAACgCAEcNA0HgoMAAQQA2AgBB7KDAAEEANgIADwsgBUHsoMAAKAIARgRAQeygwAAgAzYCAEHgoMAAQeCgwAAoAgAgAGoiADYCACADIABBAXI2AgQgACADaiAANgIADwsgAUF4cSAAaiEAAkAgAUH/AU0EQCAFKAIIIgIgAUEDdiIEQQN0QYChwABqRhogAiAFKAIMIgFGBEBB2KDAAEHYoMAAKAIAQX4gBHdxNgIADAILIAIgATYCDCABIAI2AggMAQsgBSgCGCEGAkAgBSAFKAIMIgFHBEAgBSgCCCICQeigwAAoAgBJGiACIAE2AgwgASACNgIIDAELAkAgBUEUaiICKAIAIgQNACAFQRBqIgIoAgAiBA0AQQAhAQwBCwNAIAIhByAEIgFBFGoiAigCACIEDQAgAUEQaiECIAEoAhAiBA0ACyAHQQA2AgALIAZFDQACQCAFIAUoAhwiAkECdEGIo8AAaiIEKAIARgRAIAQgATYCACABDQFB3KDAAEHcoMAAKAIAQX4gAndxNgIADAILIAZBEEEUIAYoAhAgBUYbaiABNgIAIAFFDQELIAEgBjYCGCAFKAIQIgIEQCABIAI2AhAgAiABNgIYCyAFKAIUIgJFDQAgASACNgIUIAIgATYCGAsgAyAAQQFyNgIEIAAgA2ogADYCACADQeygwAAoAgBHDQFB4KDAACAANgIADwsgBSABQX5xNgIEIAMgAEEBcjYCBCAAIANqIAA2AgALIABB/wFNBEAgAEEDdiIBQQN0QYChwABqIQACf0HYoMAAKAIAIgJBASABdCIBcUUEQEHYoMAAIAEgAnI2AgAgAAwBCyAAKAIICyECIAAgAzYCCCACIAM2AgwgAyAANgIMIAMgAjYCCA8LQR8hAiADQgA3AhAgAEH///8HTQRAIABBCHYiASABQYD+P2pBEHZBCHEiAXQiAiACQYDgH2pBEHZBBHEiAnQiBCAEQYCAD2pBEHZBAnEiBHRBD3YgASACciAEcmsiAUEBdCAAIAFBFWp2QQFxckEcaiECCyADIAI2AhwgAkECdEGIo8AAaiEBAkACQAJAQdygwAAoAgAiBEEBIAJ0IgdxRQRAQdygwAAgBCAHcjYCACABIAM2AgAgAyABNgIYDAELIABBAEEZIAJBAXZrIAJBH0YbdCECIAEoAgAhAQNAIAEiBCgCBEF4cSAARg0CIAJBHXYhASACQQF0IQIgBCABQQRxaiIHQRBqKAIAIgENAAsgByADNgIQIAMgBDYCGAsgAyADNgIMIAMgAzYCCAwBCyAEKAIIIgAgAzYCDCAEIAM2AgggA0EANgIYIAMgBDYCDCADIAA2AggLQfigwABB+KDAACgCAEEBayIAQX8gABs2AgALC5IvAQt/IwBBEGsiCyQAAkACQAJAAkACQAJAAkACQAJAAkACQCAAQfQBTQRAQdigwAAoAgAiBkEQIABBC2pBeHEgAEELSRsiB0EDdiICdiIBQQNxBEAgAUF/c0EBcSACaiIDQQN0IgFBiKHAAGooAgAiBEEIaiEAAkAgBCgCCCICIAFBgKHAAGoiAUYEQEHYoMAAIAZBfiADd3E2AgAMAQsgAiABNgIMIAEgAjYCCAsgBCADQQN0IgFBA3I2AgQgASAEaiIBIAEoAgRBAXI2AgQMDAsgB0HgoMAAKAIAIgpNDQEgAQRAAkBBAiACdCIAQQAgAGtyIAEgAnRxIgBBACAAa3FBAWsiACAAQQx2QRBxIgJ2IgFBBXZBCHEiACACciABIAB2IgFBAnZBBHEiAHIgASAAdiIBQQF2QQJxIgByIAEgAHYiAUEBdkEBcSIAciABIAB2aiIDQQN0IgBBiKHAAGooAgAiBCgCCCIBIABBgKHAAGoiAEYEQEHYoMAAIAZBfiADd3EiBjYCAAwBCyABIAA2AgwgACABNgIICyAEQQhqIQAgBCAHQQNyNgIEIAQgB2oiAiADQQN0IgEgB2siA0EBcjYCBCABIARqIAM2AgAgCgRAIApBA3YiAUEDdEGAocAAaiEFQeygwAAoAgAhBAJ/IAZBASABdCIBcUUEQEHYoMAAIAEgBnI2AgAgBQwBCyAFKAIICyEBIAUgBDYCCCABIAQ2AgwgBCAFNgIMIAQgATYCCAtB7KDAACACNgIAQeCgwAAgAzYCAAwMC0HcoMAAKAIAIglFDQEgCUEAIAlrcUEBayIAIABBDHZBEHEiAnYiAUEFdkEIcSIAIAJyIAEgAHYiAUECdkEEcSIAciABIAB2IgFBAXZBAnEiAHIgASAAdiIBQQF2QQFxIgByIAEgAHZqQQJ0QYijwABqKAIAIgEoAgRBeHEgB2shAyABIQIDQAJAIAIoAhAiAEUEQCACKAIUIgBFDQELIAAoAgRBeHEgB2siAiADIAIgA0kiAhshAyAAIAEgAhshASAAIQIMAQsLIAEoAhghCCABIAEoAgwiBEcEQCABKAIIIgBB6KDAACgCAEkaIAAgBDYCDCAEIAA2AggMCwsgAUEUaiICKAIAIgBFBEAgASgCECIARQ0DIAFBEGohAgsDQCACIQUgACIEQRRqIgIoAgAiAA0AIARBEGohAiAEKAIQIgANAAsgBUEANgIADAoLQX8hByAAQb9/Sw0AIABBC2oiAEF4cSEHQdygwAAoAgAiCUUNAEEAIAdrIQMCQAJAAkACf0EAIAdBgAJJDQAaQR8gB0H///8HSw0AGiAAQQh2IgAgAEGA/j9qQRB2QQhxIgJ0IgAgAEGA4B9qQRB2QQRxIgF0IgAgAEGAgA9qQRB2QQJxIgB0QQ92IAEgAnIgAHJrIgBBAXQgByAAQRVqdkEBcXJBHGoLIgZBAnRBiKPAAGooAgAiAkUEQEEAIQAMAQtBACEAIAdBAEEZIAZBAXZrIAZBH0YbdCEBA0ACQCACKAIEQXhxIAdrIgUgA08NACACIQQgBSIDDQBBACEDIAIhAAwDCyAAIAIoAhQiBSAFIAIgAUEddkEEcWooAhAiAkYbIAAgBRshACABQQF0IQEgAg0ACwsgACAEckUEQEEAIQRBAiAGdCIAQQAgAGtyIAlxIgBFDQMgAEEAIABrcUEBayIAIABBDHZBEHEiAnYiAUEFdkEIcSIAIAJyIAEgAHYiAUECdkEEcSIAciABIAB2IgFBAXZBAnEiAHIgASAAdiIBQQF2QQFxIgByIAEgAHZqQQJ0QYijwABqKAIAIQALIABFDQELA0AgACgCBEF4cSAHayIBIANJIQIgASADIAIbIQMgACAEIAIbIQQgACgCECIBBH8gAQUgACgCFAsiAA0ACwsgBEUNACADQeCgwAAoAgAgB2tPDQAgBCgCGCEGIAQgBCgCDCIBRwRAIAQoAggiAEHooMAAKAIASRogACABNgIMIAEgADYCCAwJCyAEQRRqIgIoAgAiAEUEQCAEKAIQIgBFDQMgBEEQaiECCwNAIAIhBSAAIgFBFGoiAigCACIADQAgAUEQaiECIAEoAhAiAA0ACyAFQQA2AgAMCAsgB0HgoMAAKAIAIgJNBEBB7KDAACgCACEDAkAgAiAHayIBQRBPBEBB4KDAACABNgIAQeygwAAgAyAHaiIANgIAIAAgAUEBcjYCBCACIANqIAE2AgAgAyAHQQNyNgIEDAELQeygwABBADYCAEHgoMAAQQA2AgAgAyACQQNyNgIEIAIgA2oiACAAKAIEQQFyNgIECyADQQhqIQAMCgsgB0HkoMAAKAIAIghJBEBB5KDAACAIIAdrIgE2AgBB8KDAAEHwoMAAKAIAIgIgB2oiADYCACAAIAFBAXI2AgQgAiAHQQNyNgIEIAJBCGohAAwKC0EAIQAgB0EvaiIJAn9BsKTAACgCAARAQbikwAAoAgAMAQtBvKTAAEJ/NwIAQbSkwABCgKCAgICABDcCAEGwpMAAIAtBDGpBcHFB2KrVqgVzNgIAQcSkwABBADYCAEGUpMAAQQA2AgBBgCALIgFqIgZBACABayIFcSICIAdNDQlBkKTAACgCACIEBEBBiKTAACgCACIDIAJqIgEgA00NCiABIARLDQoLQZSkwAAtAABBBHENBAJAAkBB8KDAACgCACIDBEBBmKTAACEAA0AgAyAAKAIAIgFPBEAgASAAKAIEaiADSw0DCyAAKAIIIgANAAsLQQAQBCIBQX9GDQUgAiEGQbSkwAAoAgAiA0EBayIAIAFxBEAgAiABayAAIAFqQQAgA2txaiEGCyAGIAdNDQUgBkH+////B0sNBUGQpMAAKAIAIgQEQEGIpMAAKAIAIgMgBmoiACADTQ0GIAAgBEsNBgsgBhAEIgAgAUcNAQwHCyAGIAhrIAVxIgZB/v///wdLDQQgBhAEIgEgACgCACAAKAIEakYNAyABIQALAkAgAEF/Rg0AIAdBMGogBk0NAEG4pMAAKAIAIgEgCSAGa2pBACABa3EiAUH+////B0sEQCAAIQEMBwsgARAEQX9HBEAgASAGaiEGIAAhAQwHC0EAIAZrEAQaDAQLIAAiAUF/Rw0FDAMLQQAhBAwHC0EAIQEMBQsgAUF/Rw0CC0GUpMAAQZSkwAAoAgBBBHI2AgALIAJB/v///wdLDQEgAhAEIQFBABAEIQAgAUF/Rg0BIABBf0YNASAAIAFNDQEgACABayIGIAdBKGpNDQELQYikwABBiKTAACgCACAGaiIANgIAQYykwAAoAgAgAEkEQEGMpMAAIAA2AgALAkACQAJAQfCgwAAoAgAiBQRAQZikwAAhAANAIAEgACgCACIDIAAoAgQiAmpGDQIgACgCCCIADQALDAILQeigwAAoAgAiAEEAIAAgAU0bRQRAQeigwAAgATYCAAtBACEAQZykwAAgBjYCAEGYpMAAIAE2AgBB+KDAAEF/NgIAQfygwABBsKTAACgCADYCAEGkpMAAQQA2AgADQCAAQQN0IgNBiKHAAGogA0GAocAAaiICNgIAIANBjKHAAGogAjYCACAAQQFqIgBBIEcNAAtB5KDAACAGQShrIgNBeCABa0EHcUEAIAFBCGpBB3EbIgBrIgI2AgBB8KDAACAAIAFqIgA2AgAgACACQQFyNgIEIAEgA2pBKDYCBEH0oMAAQcCkwAAoAgA2AgAMAgsgAC0ADEEIcQ0AIAMgBUsNACABIAVNDQAgACACIAZqNgIEQfCgwAAgBUF4IAVrQQdxQQAgBUEIakEHcRsiAGoiAjYCAEHkoMAAQeSgwAAoAgAgBmoiASAAayIANgIAIAIgAEEBcjYCBCABIAVqQSg2AgRB9KDAAEHApMAAKAIANgIADAELQeigwAAoAgAgAUsEQEHooMAAIAE2AgALIAEgBmohAkGYpMAAIQACQAJAAkACQAJAAkADQCACIAAoAgBHBEAgACgCCCIADQEMAgsLIAAtAAxBCHFFDQELQZikwAAhAANAIAUgACgCACICTwRAIAIgACgCBGoiBCAFSw0DCyAAKAIIIQAMAAsACyAAIAE2AgAgACAAKAIEIAZqNgIEIAFBeCABa0EHcUEAIAFBCGpBB3EbaiIJIAdBA3I2AgQgAkF4IAJrQQdxQQAgAkEIakEHcRtqIgYgByAJaiIIayECIAUgBkYEQEHwoMAAIAg2AgBB5KDAAEHkoMAAKAIAIAJqIgA2AgAgCCAAQQFyNgIEDAMLIAZB7KDAACgCAEYEQEHsoMAAIAg2AgBB4KDAAEHgoMAAKAIAIAJqIgA2AgAgCCAAQQFyNgIEIAAgCGogADYCAAwDCyAGKAIEIgBBA3FBAUYEQCAAQXhxIQUCQCAAQf8BTQRAIAYoAggiAyAAQQN2IgBBA3RBgKHAAGpGGiADIAYoAgwiAUYEQEHYoMAAQdigwAAoAgBBfiAAd3E2AgAMAgsgAyABNgIMIAEgAzYCCAwBCyAGKAIYIQcCQCAGIAYoAgwiAUcEQCAGKAIIIgAgATYCDCABIAA2AggMAQsCQCAGQRRqIgAoAgAiAw0AIAZBEGoiACgCACIDDQBBACEBDAELA0AgACEEIAMiAUEUaiIAKAIAIgMNACABQRBqIQAgASgCECIDDQALIARBADYCAAsgB0UNAAJAIAYgBigCHCIDQQJ0QYijwABqIgAoAgBGBEAgACABNgIAIAENAUHcoMAAQdygwAAoAgBBfiADd3E2AgAMAgsgB0EQQRQgBygCECAGRhtqIAE2AgAgAUUNAQsgASAHNgIYIAYoAhAiAARAIAEgADYCECAAIAE2AhgLIAYoAhQiAEUNACABIAA2AhQgACABNgIYCyAFIAZqIQYgAiAFaiECCyAGIAYoAgRBfnE2AgQgCCACQQFyNgIEIAIgCGogAjYCACACQf8BTQRAIAJBA3YiAEEDdEGAocAAaiECAn9B2KDAACgCACIBQQEgAHQiAHFFBEBB2KDAACAAIAFyNgIAIAIMAQsgAigCCAshACACIAg2AgggACAINgIMIAggAjYCDCAIIAA2AggMAwtBHyEAIAJB////B00EQCACQQh2IgAgAEGA/j9qQRB2QQhxIgN0IgAgAEGA4B9qQRB2QQRxIgF0IgAgAEGAgA9qQRB2QQJxIgB0QQ92IAEgA3IgAHJrIgBBAXQgAiAAQRVqdkEBcXJBHGohAAsgCCAANgIcIAhCADcCECAAQQJ0QYijwABqIQQCQEHcoMAAKAIAIgNBASAAdCIBcUUEQEHcoMAAIAEgA3I2AgAgBCAINgIAIAggBDYCGAwBCyACQQBBGSAAQQF2ayAAQR9GG3QhACAEKAIAIQEDQCABIgMoAgRBeHEgAkYNAyAAQR12IQEgAEEBdCEAIAMgAUEEcWoiBCgCECIBDQALIAQgCDYCECAIIAM2AhgLIAggCDYCDCAIIAg2AggMAgtB5KDAACAGQShrIgNBeCABa0EHcUEAIAFBCGpBB3EbIgBrIgI2AgBB8KDAACAAIAFqIgA2AgAgACACQQFyNgIEIAEgA2pBKDYCBEH0oMAAQcCkwAAoAgA2AgAgBSAEQScgBGtBB3FBACAEQSdrQQdxG2pBL2siACAAIAVBEGpJGyICQRs2AgQgAkGgpMAAKQIANwIQIAJBmKTAACkCADcCCEGgpMAAIAJBCGo2AgBBnKTAACAGNgIAQZikwAAgATYCAEGkpMAAQQA2AgAgAkEYaiEAA0AgAEEHNgIEIABBCGohASAAQQRqIQAgASAESQ0ACyACIAVGDQMgAiACKAIEQX5xNgIEIAUgAiAFayIEQQFyNgIEIAIgBDYCACAEQf8BTQRAIARBA3YiAEEDdEGAocAAaiECAn9B2KDAACgCACIBQQEgAHQiAHFFBEBB2KDAACAAIAFyNgIAIAIMAQsgAigCCAshACACIAU2AgggACAFNgIMIAUgAjYCDCAFIAA2AggMBAtBHyEAIAVCADcCECAEQf///wdNBEAgBEEIdiIAIABBgP4/akEQdkEIcSICdCIAIABBgOAfakEQdkEEcSIBdCIAIABBgIAPakEQdkECcSIAdEEPdiABIAJyIAByayIAQQF0IAQgAEEVanZBAXFyQRxqIQALIAUgADYCHCAAQQJ0QYijwABqIQMCQEHcoMAAKAIAIgJBASAAdCIBcUUEQEHcoMAAIAEgAnI2AgAgAyAFNgIAIAUgAzYCGAwBCyAEQQBBGSAAQQF2ayAAQR9GG3QhACADKAIAIQEDQCABIgIoAgRBeHEgBEYNBCAAQR12IQEgAEEBdCEAIAIgAUEEcWoiAygCECIBDQALIAMgBTYCECAFIAI2AhgLIAUgBTYCDCAFIAU2AggMAwsgAygCCCIAIAg2AgwgAyAINgIIIAhBADYCGCAIIAM2AgwgCCAANgIICyAJQQhqIQAMBQsgAigCCCIAIAU2AgwgAiAFNgIIIAVBADYCGCAFIAI2AgwgBSAANgIIC0HkoMAAKAIAIgAgB00NAEHkoMAAIAAgB2siATYCAEHwoMAAQfCgwAAoAgAiAiAHaiIANgIAIAAgAUEBcjYCBCACIAdBA3I2AgQgAkEIaiEADAMLQdSgwABBMDYCAEEAIQAMAgsCQCAGRQ0AAkAgBCgCHCICQQJ0QYijwABqIgAoAgAgBEYEQCAAIAE2AgAgAQ0BQdygwAAgCUF+IAJ3cSIJNgIADAILIAZBEEEUIAYoAhAgBEYbaiABNgIAIAFFDQELIAEgBjYCGCAEKAIQIgAEQCABIAA2AhAgACABNgIYCyAEKAIUIgBFDQAgASAANgIUIAAgATYCGAsCQCADQQ9NBEAgBCADIAdqIgBBA3I2AgQgACAEaiIAIAAoAgRBAXI2AgQMAQsgBCAHQQNyNgIEIAQgB2oiBSADQQFyNgIEIAMgBWogAzYCACADQf8BTQRAIANBA3YiAEEDdEGAocAAaiECAn9B2KDAACgCACIBQQEgAHQiAHFFBEBB2KDAACAAIAFyNgIAIAIMAQsgAigCCAshACACIAU2AgggACAFNgIMIAUgAjYCDCAFIAA2AggMAQtBHyEAIANB////B00EQCADQQh2IgAgAEGA/j9qQRB2QQhxIgJ0IgAgAEGA4B9qQRB2QQRxIgF0IgAgAEGAgA9qQRB2QQJxIgB0QQ92IAEgAnIgAHJrIgBBAXQgAyAAQRVqdkEBcXJBHGohAAsgBSAANgIcIAVCADcCECAAQQJ0QYijwABqIQECQAJAIAlBASAAdCICcUUEQEHcoMAAIAIgCXI2AgAgASAFNgIADAELIANBAEEZIABBAXZrIABBH0YbdCEAIAEoAgAhBwNAIAciASgCBEF4cSADRg0CIABBHXYhAiAAQQF0IQAgASACQQRxaiICKAIQIgcNAAsgAiAFNgIQCyAFIAE2AhggBSAFNgIMIAUgBTYCCAwBCyABKAIIIgAgBTYCDCABIAU2AgggBUEANgIYIAUgATYCDCAFIAA2AggLIARBCGohAAwBCwJAIAhFDQACQCABKAIcIgJBAnRBiKPAAGoiACgCACABRgRAIAAgBDYCACAEDQFB3KDAACAJQX4gAndxNgIADAILIAhBEEEUIAgoAhAgAUYbaiAENgIAIARFDQELIAQgCDYCGCABKAIQIgAEQCAEIAA2AhAgACAENgIYCyABKAIUIgBFDQAgBCAANgIUIAAgBDYCGAsCQCADQQ9NBEAgASADIAdqIgBBA3I2AgQgACABaiIAIAAoAgRBAXI2AgQMAQsgASAHQQNyNgIEIAEgB2oiAiADQQFyNgIEIAIgA2ogAzYCACAKBEAgCkEDdiIAQQN0QYChwABqIQVB7KDAACgCACEEAn9BASAAdCIAIAZxRQRAQdigwAAgACAGcjYCACAFDAELIAUoAggLIQAgBSAENgIIIAAgBDYCDCAEIAU2AgwgBCAANgIIC0HsoMAAIAI2AgBB4KDAACADNgIACyABQQhqIQALIAtBEGokACAAC9YCAQF/AkAgAUUNACAAQQA6AAAgACABaiICQQFrQQA6AAAgAUEDSQ0AIABBADoAAiAAQQA6AAEgAkEDa0EAOgAAIAJBAmtBADoAACABQQdJDQAgAEEAOgADIAJBBGtBADoAACABQQlJDQAgAEEAIABrQQNxIgJqIgBBADYCACAAIAEgAmtBfHEiAmoiAUEEa0EANgIAIAJBCUkNACAAQQA2AgggAEEANgIEIAFBCGtBADYCACABQQxrQQA2AgAgAkEZSQ0AIABBADYCGCAAQQA2AhQgAEEANgIQIABBADYCDCABQRBrQQA2AgAgAUEUa0EANgIAIAFBGGtBADYCACABQRxrQQA2AgAgAiAAQQRxQRhyIgJrIgFBIEkNACAAIAJqIQADQCAAQgA3AxggAEIANwMQIABCADcDCCAAQgA3AwAgAEEgaiEAIAFBIGsiAUEfSw0ACwsLAwABC7AEAQd/AkAgACgCACIGQYCAgAhPBEAgACgCBCEEDAELIAAgBkEIdCIGNgIAIAAgACgCECIDQQFqNgIQIAAgAyAAKAIMai0AACAAKAIEQQh0ciIENgIECwJ/IAEvAQAiBSAGQQt2bCIDIARLBEAgASAFQYAQIAVrQQV2ajsBACABIAJBBHRqQQRqIQhBAiEFQQgMAQsgACAEIANrIgQ2AgQgASAFIAVBBXZrOwEAIAYgA2siBkH///8HTQRAIAAgBkEIdCIGNgIAIAAgACgCECIDQQFqNgIQIAAgAyAAKAIMai0AACAEQQh0ciIENgIECyABLwECIgUgBkELdmwiAyAESwRAIAEgBUGAECAFa0EFdmo7AQIgASACQQR0akGEAmohCEEKIQVBCAwBCyAAIAQgA2siBDYCBCABIAUgBUEFdms7AQIgAUGEBGohCCAGIANrIQNBEiEFQYACCyEGIAAgBTYCaEEBIQEDQCAIIAFBAXQiAWohCQJAIANB////B0sEQCADIQIMAQsgACADQQh0IgI2AgAgACAAKAIQIgNBAWo2AhAgACADIAAoAgxqLQAAIARBCHRyIgQ2AgQLAkAgCS8BACIHIAJBC3ZsIgMgBE0EQCAAIAQgA2siBDYCBCAAIAIgA2siAzYCACAJIAcgB0EFdms7AQAgAUEBciEBDAELIAAgAzYCACAJIAdBgBAgB2tBBXZqOwEACyABIAZJDQALIAAgASAGayAFajYCaAvIHwEQfwJAIAAoAigiASAAKAIgIglNDQAgACgCaCICRQ0AIAAoAlQiAyAAKAIkTw0AIAAoAjAgA00NACAAIAIgASAJayIBIAIgASACSRsiBms2AmggCSADQX9zaiEEIAMgCU8EQCAAKAIsIARqIQQLIAAoAhgiAyAEai0AACEBIAAgCUEBajYCICADIAlqIAE6AAACQCAGQQFrIgdFDQAgB0EBcQRAIAAoAhgiAkEAIARBAWoiASABIAAoAixGGyIEai0AACEDIAAgACgCICIBQQFqNgIgIAEgAmogAzoAACAGQQJrIQcLIAZBAkYNAANAIAAoAhgiAkEAIARBAWoiASABIAAoAixGGyIGai0AACEDIAAgACgCICIBQQFqNgIgIAEgAmogAzoAACAAKAIYIgJBACAGQQFqIgEgASAAKAIsRhsiBGotAAAhAyAAIAAoAiAiAUEBajYCICABIAJqIAM6AAAgB0ECayIHDQALCyAAKAIgIgkgACgCJE0NACAAIAk2AiQLAkACQCAJIAAoAihPDQAgAEHcDWohDiAAQeAVaiEPIABB1ABqIRADQCAAKAIQIgMgACgCFEsNASAAIAAoAmQiCkEFdGogACgCdCAJcSIIQQF0aiIMIQYCQCAAKAIAIgVBgICACE8EQCAAKAIEIQQMAQsgACAFQQh0IgU2AgAgACADQQFqIgE2AhAgACAAKAIMIANqLQAAIAAoAgRBCHRyIgQ2AgQgASEDCwJAIAYvAXgiASAFQQt2bCICIARLBEAgACACNgIAIAYgAUGAECABa0EFdmo7AXggCUEBayEFIAlFBEAgACgCLCAFaiEFCyAAKAJwIAlxIAAoAmwiAXQgACgCJCIGBH8gACgCGCAFai0AAAVBAAtBCCABa3ZqIQ1BASEFAkAgCkEGTQRAA0AgBUEBdCIFIAAgDUGADGxqakHkHWohBgJAIAJB////B0sEQCACIQEMAQsgACACQQh0IgE2AgAgACADQQFqIgI2AhAgACAAKAIMIANqLQAAIARBCHRyIgQ2AgQgAiEDCwJAIAYvAQAiCCABQQt2bCICIARNBEAgACAEIAJrIgQ2AgQgACABIAJrIgI2AgAgBiAIIAhBBXZrOwEAIAVBAXIhBQwBCyAAIAI2AgAgBiAIQYAQIAhrQQV2ajsBAAsgBUGAAkkNAAwCCwALIAkgACgCVCIBQX9zaiEFIAEgCU8EQCAAKAIsIAVqIQULIAYEfyAAKAIYIAVqLQAABUEACyEGQQEhBUGAAiEHA0AgACANQYAMbGogBkEBdCIGIAdxIgwgB2ogBWpBAXRqQeQdaiELAkAgAkH///8HSwRAIAIhCAwBCyAAIAJBCHQiCDYCACAAIANBAWoiATYCECAAIAAoAgwgA2otAAAgBEEIdHIiBDYCBCABIQMLIAsCfyAEIAsvAQAiASAIQQt2bCICTyIKRQRAIAAgAjYCACABQYAQIAFrQQV2agwBCyAAIAQgAmsiBDYCBCAAIAggAmsiAjYCAEEAIQcgASABQQV2aws7AQAgByAMcyEHIAVBAXQgCnIiBUGAAkkNAAsLIAAgCUEBajYCICAAKAIYIAlqIAU6AAAgACgCICIJIAAoAiRLBEAgACAJNgIkC0EAIQIgACAAKAJkIgFBBE8EfyABQQlNBEAgACABQQNrNgJkDAMLIAFBBmsFQQALNgJkDAELIAAgBCACayIENgIEIAAgBSACayICNgIAIAYgASABQQV2azsBeCAAIApBAXRqIgshBgJAIAJB////B0sEQCADIQEMAQsgACACQQh0IgI2AgAgACADQQFqIgE2AhAgACAAKAIMIANqLQAAIARBCHRyIgQ2AgQLAkAgBi8B+AMiCiACQQt2bCIDIARNBEAgACAEIANrIgQ2AgQgACACIANrIgI2AgAgBiAKIApBBXZrOwH4AwJAIAJB////B0sEQCABIQYMAQsgACACQQh0IgI2AgAgACABQQFqIgY2AhAgACAAKAIMIAFqLQAAIARBCHRyIgQ2AgQLAkAgCy8BkAQiASACQQt2bCIFIARLBEAgCyABQYAQIAFrQQV2ajsBkAQgBUH///8HTQRAIAAgBUEIdCIFNgIAIAAgBkEBajYCECAAIAAoAgwgBmotAAAgBEEIdHIiBDYCBAsgDC8B2AQiAyAFQQt2bCIBIARNBEAgACAEIAFrNgIEIAAgBSABazYCACAMIAMgA0EFdms7AdgEDAILIAAgATYCACAMIANBgBAgA2tBBXZqOwHYBCAAQQE2AmggAEEJQQsgACgCZEEHSRs2AmQMAwsgACAEIAVrIgQ2AgQgCyABIAFBBXZrOwGQBAJAIAIgBWsiAkH///8HSwRAIAYhAQwBCyAAIAJBCHQiAjYCACAAIAZBAWoiATYCECAAIAAoAgwgBmotAAAgBEEIdHIiBDYCBAsCQCALLwGoBCIGIAJBC3ZsIgMgBEsEQCAAIAM2AgAgCyAGQYAQIAZrQQV2ajsBqAQgACgCWCECDAELIAAgBCADayIENgIEIAsgBiAGQQV2azsBqAQgAiADayICQf///wdNBEAgACACQQh0IgI2AgAgACABQQFqNgIQIAAgACgCDCABai0AACAEQQh0ciIENgIECwJAIAsvAcAEIgMgAkELdmwiASAESwRAIAAgATYCACALIANBgBAgA2tBBXZqOwHABCAAKAJcIQIMAQsgACAEIAFrNgIEIAAgAiABazYCACALIAMgA0EFdms7AcAEIAAoAmAhAiAAIAAoAlw2AmALIAAgACgCWDYCXAsgACAAKAJUNgJYIAAgAjYCVAsgAEEIQQsgACgCZEEHSRs2AmQgACAPIAgQCQwBCyAAIAM2AgAgBiAKQYAQIAprQQV2ajsB+AMgACAAKAJcNgJgIAAgACkCVDcCWCAAQQdBCiAAKAJkQQdJGzYCZCAAIA4gCBAJIAAoAmgiAUECa0EDIAFBBkkbIQMgACgCACECQQEhBANAIARBAXQiBCAAIANBB3RqaiEGAkAgAkGAgIAITwRAIAAoAgQhBQwBCyAAIAJBCHQiAjYCACAAIAAoAhAiAUEBajYCECAAIAEgACgCDGotAAAgACgCBEEIdHIiBTYCBAsCQCAGLwHYByIIIAJBC3ZsIgEgBU0EQCAAIAUgAWsiBTYCBCAAIAIgAWsiAjYCACAGIAggCEEFdms7AdgHIARBAXIhBAwBCyAAIAE2AgAgBiAIQYAQIAhrQQV2ajsB2AcgASECCyAEQcAASQ0ACyAEQUBqIgNBA00EQCAAIAM2AlQMAQsgACAEQQFxQQJyIgc2AlQgA0EBdiEBIANBDU0EQCAAIAcgAUEBayIKdCIINgJUQQEhByAQIAhBAXRqQQAgBGtBAXRqQYIMaiEGQQAhCwNAIAYgB0EBdCIHaiEMAkAgAkH///8HSwRAIAIhAQwBCyAAIAJBCHQiATYCACAAIAAoAhAiA0EBajYCECAAIAMgACgCDGotAAAgBUEIdHIiBTYCBAsCQCAMLwEAIgMgAUELdmwiAiAFTQRAIAAgBSACayIFNgIEIAAgASACayICNgIAIAwgAyADQQV2azsBACAAQQEgC3QgCGoiCDYCVCAHQQFyIQcMAQsgACACNgIAIAwgA0GAECADa0EFdmo7AQALIAtBAWoiCyAKRw0ACwwBCyABQQVrIQQDQAJAIAJB////B0sEQCACIQMMAQsgACACQQh0IgM2AgAgACAAKAIQIgFBAWo2AhAgASAAKAIMai0AACAFQQh0ciEFCyAAIANBAXYiAjYCACAAIAUgAmsiBkEfdSIBIAdBAXRqQQFqIgc2AlQgACABIAJxIAZqIgU2AgQgBEEBayIEDQALIAAgB0EEdCIHNgJUIANB////D00EQCAAIAJBCHQiAjYCACAAIAAoAhAiAUEBajYCECAAIAEgACgCDGotAAAgBUEIdHIiBTYCBAsgAAJ/IAAvAb4NIgEgAkELdmwiBCAFTQRAIAAgBSAEayIFNgIEIAAgB0EBciIHNgJUIAAgASABQQV2azsBvg0gAiAEayEEQQMMAQsgACABQYAQIAFrQQV2ajsBvg1BAgtBAXQiA2pBvA1qIQYgBEH///8HTQRAIAAgBEEIdCIENgIAIAAgACgCECIBQQFqNgIQIAAgASAAKAIMai0AACAFQQh0ciIFNgIECwJAIAYvAQAiASAEQQt2bCICIAVNBEAgACAFIAJrIgU2AgQgBiABIAFBBXZrOwEAIAAgB0ECaiIHNgJUIAQgAmshAiADQQFyIQMMAQsgBiABQYAQIAFrQQV2ajsBAAsgACADQQF0IgNqQbwNaiEGIAJB////B00EQCAAIAJBCHQiAjYCACAAIAAoAhAiAUEBajYCECAAIAEgACgCDGotAAAgBUEIdHIiBTYCBAsCQCAGLwEAIgEgAkELdmwiBCAFTQRAIAAgBSAEayIFNgIEIAYgASABQQV2azsBACAAIAdBBGoiBzYCVCACIARrIQQgA0EBciEDDAELIAYgAUGAECABa0EFdmo7AQALIARB////B00EQCAAIARBCHQiBDYCACAAIAAoAhAiAUEBajYCECAAIAEgACgCDGotAAAgBUEIdHIiBTYCBAsgACADQQF0akG8DWoiAS8BACICIARBC3ZsIgMgBU0EQCAAIAUgA2s2AgQgACAEIANrNgIAIAEgAiACQQV2azsBACAAIAdBCGo2AlQMAQsgACADNgIAIAEgAkGAECACa0EFdmo7AQALQQAhAiAAKAJUIgYgACgCJE8NAyAAKAIwIAZNDQMgACAAKAJoIgMgACgCKCAAKAIgIgprIgEgAyABIANJGyIIazYCaCAKIAZBf3NqIQIgBiAKTwRAIAAoAiwgAmohAgsgACgCGCIDIAJqLQAAIQEgACAKQQFqNgIgIAMgCmogAToAAAJAIAhBAWsiBUUNACAFQQFxBEAgACgCGCIGQQAgAkEBaiIBIAEgACgCLEYbIgJqLQAAIQMgACAAKAIgIgFBAWo2AiAgASAGaiADOgAAIAhBAmshBQsgCEECRg0AA0AgACgCGCIGQQAgAkEBaiIBIAEgACgCLEYbIgJqLQAAIQMgACAAKAIgIgFBAWo2AiAgASAGaiADOgAAIAAoAhgiBkEAIAJBAWoiASABIAAoAixGGyICai0AACEDIAAgACgCICIBQQFqNgIgIAEgBmogAzoAACAFQQJrIgUNAAsLIAAoAiAiCSAAKAIkTQ0AIAAgCTYCJAsgCSAAKAIoSQ0ACwtBASECIAAoAgAiAUH///8HSw0AIAAgAUEIdDYCACAAIAAoAhAiAUEBajYCECAAIAEgACgCDGotAAAgACgCBEEIdHI2AgQLIAILJgEBfyAABEAgACgCsAkiASgCPARAIAEoAhgQBQsgARAFIAAQBQsLMgEBfyAAIAApA4ABIAIgACgCECICayIDrXw3A4ABIAAgASACaiADIAAoAhgQA603AxgLgQEBAn8CQAJAIAJBBE8EQCAAIAFyQQNxDQEDQCAAKAIAIAEoAgBHDQIgAUEEaiEBIABBBGohACACQQRrIgJBA0sNAAsLIAJFDQELA0AgAC0AACIDIAEtAAAiBEYEQCABQQFqIQEgAEEBaiEAIAJBAWsiAg0BDAILCyADIARrDwtBAAsJAEG8oCAoAgALCQBBsKAgKAIAC9QzAhR/An4CQAJAAkACQAJAAkACQAJAAn8Cf0HQoMAAKAIAIgEoAiQEQCABKAIADAELIAFBADoAKCABQgA3AwAgAUIANwMYIAFByABqQeQAEAcgAUEMNgKsAUEACyEAQcCgICgCACENIAFBtKAgKAIAIg42AhAgAUHgAGohDyABQbYBaiEQIAFBsAFqIREgAUGoAWohCANAAkACQAJAAkACQAJAAkACQAJAAkAgCAJ/AkACQAJAIAAOCgECAAoLDAQFBgcOC0GwoCAoAgAhAyABKAKsASECQbSgICgCACEAQbigICgCACEGIAEoAqgBDAILIAggASgCqAEiAGpBCGpBtKAgKAIAIgJBsKAgKAIAakG4oCAoAgAgAmsiAiABKAKsASAAayIAIAAgAksbIgAQAkG0oCBBtKAgKAIAIABqNgIAQQAhAyABQQAgASgCqAEgAGoiACAAIAEoAqwBIgJGGzYCqAEgACACRw0LIAFBATYCACARQYAIQQYQDQRAQQUhAwwMCyAQQQJBABADIAEoALgBRwRAQQchAwwMC0EGIQMgEC0AAA0LIAEgAS0AtwEiADYCICAAQQ9LDQtBAiEDIABBBEsNC0EBIAB0QRNxRQ0LC0G0oCAoAgAiAEG4oCAoAgAiBkYEQEEAIQMMCwtBsKAgKAIAIgMgAGotAAAiAkUEQEG0oCAgAEEBajYCACABIAA2AhBBBiEAIAFBBjYCAAwMCyABQQA2AqgBIAFBAjYCACABIAJBAnRBBGoiAjYCrAEgASACNgJAQQALIgVqQQhqIAAgA2ogBiAAayIAIAIgBWsiAiAAIAJJGyIAEAJBtKAgIABBtKAgKAIAajYCAEEAIQMgAUEAIAEoAqgBIABqIgAgACABKAKsASICRhs2AqgBIAAgAkcNCSABIABBBGsiADYCrAEgESAAQQAQAyABIAEoAqwBIgVqKACwAUcEQEEHIQMMCgsgAUECNgKoASABLACxASIEQT9xBEBBBiEDDAoLQQIhAEJ/IRVCfyEUIARBwABxRQ0FIAEoAgQiAkUEQCABQgA3AwgLIAVBAiAFQQJLGyEGA0AgACAGRgRAQQchAwwLCyAAIAhqLQAIIQMgASAAQQFqIgA2AqgBIAEgASkDCCADQf8Aca0gAq2GhCIUNwMIIANBgAFxRQRAAkAgAw0AIAJFDQBBByEDDAwLIAFBADYCBAwHC0EHIQMgASACQQdqIgI2AgQgAkE/Rw0ACwwJCwJ/IAFBkAFqIQYDQEG4oCAoAgAhAkGwoCAoAgAhBCABKAIEIgVFBEAgAUIANwMIC0G0oCAoAgAiACACIAAgAksbIQICQANAAkAgACACRgRAQQAhAyACIQAMAQsgACAEai0AACEDQbSgICAAQQFqIgA2AgAgASABKQMIIANB/wBxrSAFrYaEIhQ3AwggA0GAAXFFBEAgAw0DIAVFDQNBByEDDAELQQchAyABIAVBB2oiBTYCBCAFQT9HDQELCyABIAEpA4ABIAAgASgCECIAayICrXw3A4ABIAEgACAEaiACIAEoAhgQA603AxggAwwCCyABQQA2AgQCQAJAAkACQAJAIAEoAngOAwACAQMLIAEgFDcDiAFBByABKQNYIBRSDQUaIAFBATYCeAwDCyABIAEpA5gBIBR8NwOYASABIAZBGCABKAKgARADNgKgASABQQE2AnggASABKQOIAUIBfSIUNwOIAQwCCyABQQI2AnggASABKQOQASAUfDcDkAELIAEpA4gBIRQLIBRCAFINAAtBAQsiA0EBRw0IIAFBBzYCAAsCQCABKQOAASIUQbSgICgCACIAIAEoAhAiBGutfEIDg1ANAEGwoCAoAgAhBkG4oCAoAgAgAEYEQCAAIQIMBAtBtKAgIABBAWoiAjYCAEEHIQMgACAGai0AAA0IAkAgFCACIARrrXxCA4NQDQBBsKAgKAIAIQYgAkG4oCAoAgBGDQRBtKAgIABBAmoiBTYCACACIAZqLQAADQkgFCAFIARrrXxCA4NQBEAgBSEADAILQbCgICgCACEGQbigICgCACAFRgRAIAUhAgwFC0G0oCAgAEEDaiICNgIAIAUgBmotAAANCSAUIAIgBGutfEIDg1ANAEG4oCAoAgAgAkYEQEGwoCAoAgAhBgwFC0G0oCAgAEEEajYCAAwJCyACIQALIAFBsKAgKAIAIAAQDEEHIQMgDyABQZABakEYEA0NByABQQg2AgALAn9BtKAgKAIAIQBBuKAgKAIAIQUDQEEAIAAgBUYNARogASkDGCEUIAEoAgQhA0G0oCAgAEEBaiICNgIAQQdBsKAgKAIAIABqLQAAIBQgA62Ip0H/AXFHDQEaIAEgA0EIaiIDNgIEIAIhACADQSBJDQALIAFBADYCBCABQgA3AxhBAQsiA0EBRw0GIAFBCTYCACABQQw2AqwBC0EAIQMgASABKAKoASIAakGwAWpBtKAgKAIAIgJBsKAgKAIAakG4oCAoAgAgAmsiAiABKAKsASAAayIAIAAgAksbIgAQAkG0oCBBtKAgKAIAIABqNgIAIAFBACABKAKoASAAaiIAIAAgASgCrAFGIgAbNgKoASAARQ0FQQchAAJAIAEvALoBQdm0AUcNACABQbQBakEGQQAQAyABKACwAUcNACABNQC0ASABKQOAAUICiFINACABLQC4AQ0AQQFBByABKAIgIAEtALkBRhshAAsgACEDDAULIAEgBiACEAxBACEDDAQLIAEgFDcDMCAEQQBIBEAgASgCBCICRQRAIAFCADcDCAsgACAFIAAgBUsbIQQDQCAAIARGBEBBByEDDAYLIAAgCGotAAghAyABIABBAWoiADYCqAEgASABKQMIIANB/wBxrSACrYaEIhU3AwgCQCADQYABcUUEQCADDQEgAkUNAUEHIQMMBwtBByEDIAEgAkEHaiICNgIEIAJBP0cNAQwGCwsgAUEANgIECyABIBU3AzggBSAAa0ECSQRAQQchAwwECyABIABBAWoiAjYCqAEgACAIai0ACEEhRwRAQQYhAwwECyABIABBAmoiBDYCqAEgAiAIai0ACEEBRwRAQQYhAwwEC0EHIQMgBCAFRg0DIAEgAEEDajYCqAEgASgCsAkhAEEGIQICQCAEIAhqLQAIIgNBJ0sNACAAIANBAXFBAnIgA0EBdkELanQiBTYCMAJ/AkAgACgCPCIDRQ0AQQQhAiAFIAAoAjRLDQIgACAFNgIsIANBAkcNACAFIABBOGoiAygCAE0NACAAKAIYEAUgACAAKAIwEAYiAjYCGCACDQBBAwwBCyAAQQA2AkAgAEEBOgBQIABBADYCaCAAQeTdAWohA0EACyECIANBADYCAAsgAiIDDQMgASgCqAEiACABKAKsASICIAAgAksbIQMCQANAIAAgA0YNASABIABBAWoiAjYCqAEgACAIaiEFIAIhACAFLQAIRQ0AC0EGIQMMBAsgAUEANgKoASABQgA3A1AgAUIANwNIIAFBAzYCAAsgAUG0oCAoAgA2AhAgAUHAoCAoAgA2AhQCfyABKAKwCSIEQejdAWohBSAEQfgAaiEKIARB5N0BaiELA38gBCgCQCEDAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAQbSgICgCACIAQbigICgCACICTwRAIANBB0YNAUEADBELIAMOCQECAwQFBgcACQ8LIAQoAkwhAwwHC0EBIQZBtKAgIABBAWo2AgBBsKAgKAIAIABqLQAAIgBFDQggAEEBRyAAQd8BTXFFBEAgBEGAAjsBUCAEKAI8RQRAIARBwKAgKAIAIgJBvKAgKAIAajYCGCAEQcSgICgCACACazYCLAsgBEIANwIcIARCADcCJAwLCyAELQBQRQ0KQQcMDgtBtKAgIABBAWo2AgBBsKAgKAIAIABqLQAAIQAgBEECNgJAIAQgBCgCSCAAQQh0ajYCSAwMC0G0oCAgAEEBajYCAEGwoCAoAgAgAGotAAAhACAEQQM2AkAgBCAAIAQoAkhqQQFqNgJIDAsLQbSgICAAQQFqNgIAQbCgICgCACAAai0AACEAIARBBDYCQCAEIABBCHQ2AkwMCgtBtKAgIABBAWo2AgBBsKAgKAIAIABqLQAAIQAgBCAEKAJENgJAIAQgACAEKAJMakEBajYCTAwJC0G0oCAgAEEBajYCAEEHIQZBsKAgKAIAIABqLQAAIgBB4AFLDQNBACEDIARBfyAAQS1JBH9BAAUgAEEtayIAIABB/wFxQS1uIgJBLWxrIQAgAkEBagt0QX9zNgJ0IABB/wFxQQlPBEAgAEEJayIAIABB/wFxQQluIgJBCWxrIQAgAkEBaiEDCyAEIAM2AnAgBCAAQf8BcSIANgJsIAAgA2pBBEsNAyAEQX8gA3RBf3M2AnBBACEAIARBADYCZCAEQgA3AlwgBEIANwJUA0AgCiAAQQF0IgJqQYAIOwEAIAogAkECcmpBgAg7AQAgAEECaiIAQbbuAEcNAAsgBEEGNgJAIARBBTYCCCAEQv////8PNwIAC0EHIAQoAkwiBkEFSQ0IGiAEKAIIIgMEQEG0oCAoAgAhAEG4oCAoAgAhBwNAQQAgACAHRg0KGiAEKAIEIQxBtKAgIABBAWoiAjYCAEGwoCAoAgAgAGotAAAhACAEIANBAWsiAzYCCCAEIAAgDEEIdHI2AgQgAiEAIAMNAAsLIARBBzYCQCAEIAZBBWsiAzYCTAsgBCAEKAIgIgBBxKAgKAIAQcCgICgCAGsiAiAEKAJIIgYgAiAGSRsiAmogBCgCLCIGIAYgAGsgAksbNgIoQbigICgCACIGQbSgICgCACICayEAAkACQCAEKALk3QEiB0UEQCADDQFBACEDCyAHIAtqQQRqQbCgICgCACACaiAAIAMgB2siAkEqIAdrIgMgAiADSRsiAiAAIAJJGyIAEAICfyAAIAQoAuTdASIDaiICIAQoAkxGBEAgAyALaiAAakEEakE/IAJrEAcgBCgC5N0BIABqDAELIAJBFE0EQCAEIAI2AuTdAUG0oCBBtKAgKAIAIABqNgIADAMLIAJBFWsLIQIgBEEANgIQIAQgBTYCDCAEIAI2AhRBByEGIAQQCkUNAyAEKAIQIgcgACAEKALk3QEiAmpLDQMgBCAEKAJMIAdrIgM2AkwgAiAHSwRAIAQgAiAHayIANgLk3QECQCAFIgIgByALakEEaiIDRg0AIAMgACACaiIHa0EAIABBAXRrTQRAIAIgAyAAEAIMAQsgAiADc0EDcSEGAkACQCACIANJBEAgBg0CIAJBA3FFDQEDQCAARQ0EIAIgAy0AADoAACADQQFqIQMgAEEBayEAIAJBAWoiAkEDcQ0ACwwBCwJAIAYNACAHQQNxBEADQCAARQ0FIAIgAEEBayIAaiIGIAAgA2otAAA6AAAgBkEDcQ0ACwsgAEEDTQ0AA0AgAiAAQQRrIgBqIAAgA2ooAgA2AgAgAEEDSw0ACwsgAEUNAgNAIAIgAEEBayIAaiAAIANqLQAAOgAAIAANAAsMAgsgAEEDTQ0AA0AgAiADKAIANgIAIANBBGohAyACQQRqIQIgAEEEayIAQQNLDQALCyAARQ0AA0AgAiADLQAAOgAAIAJBAWohAiADQQFqIQMgAEEBayIADQALCwwCC0G0oCBBtKAgKAIAIAcgAmtqIgI2AgAgBEEANgLk3QFBuKAgKAIAIgYgAmshAAsgAEEVTwRAQbCgICgCACEHIAQgAjYCECAEIAc2AgwgBCAGQRVrIAIgA2ogACADQRVqSRs2AhRBByEGIAQQCkUNAyAEKAJMIgAgBCgCECICQbSgICgCAGsiA0kNAyAEIAAgA2siAzYCTEG0oCAgAjYCAEG4oCAoAgAgAmsiAEEUSw0BCyAFQbCgICgCACACaiADIAAgACADSxsiABACIAQgADYC5N0BQbSgIEG0oCAoAgAgAGo2AgALIAQoAiAiAiAEKAIcIgNrIQAgBCAEKAI8BH8gBCgCLCACRgRAIARBADYCIAtBvKAgKAIAQcCgICgCAGogBCgCGCADaiAAEAIgBCgCIAUgAgs2AhxBwKAgQcCgICgCACAAaiICNgIAIAQgBCgCSCAAayIANgJIIABFBEBBByEGIAQoAkwNAiAEKAJoDQIgBCgCBA0CIARBADYCQAwFC0EAIQYgAkHEoCAoAgBGDQFBtKAgKAIAQbigICgCAEcNBiAEKALk3QEgBCgCTE8NBgwBCyAEKAJMIgNFDQFBACEGIAAgAk8NAANAQcSgICgCACIHQcCgICgCACIMTQ0BIAQgAyADIAQoAiwgBCgCICISayITIAIgAGsiAiAHIAxrIgcgAiAHSRsiAiACIBNLGyICIAIgA0sbIgJrNgJMIBIgBCgCGGpBsKAgKAIAIABqIAIQAiAEIAQoAiAgAmoiADYCICAAIAQoAiRLBEAgBCAANgIkCyAEIAQoAjwEfyAEKAIsIABGBEAgBEEANgIgC0G8oCAoAgBBwKAgKAIAakGwoCAoAgBBtKAgKAIAaiACEAIgBCgCIAUgAAs2AhxBwKAgQcCgICgCACACajYCAEG0oCBBtKAgKAIAIAJqIgA2AgAgBCgCTCIDRQ0CQbigICgCACICIABLDQALCyAGDAULIARBADYCQAwDCyAAQRh0QRh1QQBODQEgBEEBNgJAIAQgAEEQdEGAgPwAcTYCSCAAQcABTwRAIARBBTYCRCAEQQA6AFEMAwtBByAELQBRDQMaIARBBjYCRCAAQaABSQ0CIARCADcCVEEAIQAgBEEANgJkIARCADcCXANAIAogAEEBdCICakGACDsBACAKIAJBAnJqQYAIOwEAIABBAmoiAEG27gBHDQALCyAEQQU2AgggBEL/////DzcCAAwBCyAAQQJLBH9BBwUgBEKDgICAgAE3AkAMAQsLCyEDIAEgASkDSEG0oCAoAgAgASgCEGutfCIUNwNIIAEgASkDUEHAoCAoAgAgASgCFCICayIArXwiFTcDUCABKQMwIBRUBEBBByEDDAMLIAEpAzggFVQEQEEHIQMMAwsCQCABAn4CQAJAIAEoAiBBAWsOBAADAwEDC0G8oCAoAgAgAmogACABKAIYEAOtDAELQbygICgCACACaiEFIAEpAxhCf4UhFAJAIABFDQAgAEEBcQR/IAUxAAAgFEL/AYOFp0EDdEGwEGopAwAgFEIIiIUhFCAFQQFqIQUgAEEBawUgAAshAiAAQQFGDQADQCAFMQABIAUxAAAgFEL/AYOFp0EDdEGwEGopAwAgFEIIiIUiFEL/AYOFp0EDdEGwEGopAwAgFEIIiIUhFCAFQQJqIQUgAkECayICDQALCyAUQn+FCzcDGAsgA0EBRw0CAkAgASkDMCIUQn9RDQAgFCABKQNIUQ0AQQchAwwDCyABKQNQIRUCQCABKQM4IhRCf1EEQCAVIRQMAQtBByEDIBQgFVINAwsgASABKQNoIBR8NwNoIAEgASgCIEGQCGoxAAAgASkDYCABKQNIIAE1AkB8fHw3A2AgASAPQRggASgCcBADNgJwIAFBBDYCACABIAEpA1hCAXw3A1gLAkAgASkDSCIUQgODUA0AQQAhA0G0oCAoAgAiAEG4oCAoAgAiAkYNAkG0oCAgAEEBaiIFNgIAQbCgICgCACAAai0AAARAQQchAwwDCyABIBRCAXwiFTcDSCAVQgODUA0AIAIgBUYNAkG0oCAgAEECaiIENgIAQbCgICgCACAFai0AAARAQQchAwwDCyABIBRCAnwiFTcDSCAVQgODUA0AIAIgBEYNAkG0oCAgAEEDaiIFNgIAQbCgICgCACAEai0AAARAQQchAwwDCyABIBRCA3wiFTcDSCAVQgODUA0AIAIgBUYNAkG0oCAgAEEEajYCAEEHIQNBsKAgKAIAIAVqLQAADQIgASAUQgR8NwNICyABQQU2AgALAkACQAJAAkACQCABKAIgIgBBAWsOBAACAgECC0G0oCAoAgAhAEG4oCAoAgAhBQNAIAAgBUYEQEEAIQMMBgsgASkDGCEUIAEoAgQhA0G0oCAgAEEBaiICNgIAQbCgICgCACAAai0AACAUIAOtiKdB/wFxRwRAQQchAwwGCyABIANBCGoiAzYCBCACIQAgA0EgSQ0ACyABQgA3AxgMAgtBtKAgKAIAIQBBuKAgKAIAIQUDQCAAIAVGBEBBACEDDAULIAEpAxghFCABKAIEIQNBtKAgIABBAWoiAjYCAEGwoCAoAgAgAGotAAAgFCADrYinQf8BcUcEQEEHIQMMBQsgASADQQhqIgM2AgQgAiEAIANBwABJDQALIAFCADcDGAwBCyABKAIEIgIgAEGQCGotAAAiBU8NAEEAIQNBtKAgKAIAIgBBuKAgKAIAIgRGDQIDQAJAIABBAWohACACQQFqIgIgBUYNACAAIARHDQEMAwsLQbSgICAANgIACyABQQA2AgRBASEAIAFBATYCAAwCC0G0oCAgBDYCACABIAI2AgRBASEAIAIgBUkNACABQQE2AgAMAQsLAkAgASgCJEUEQAJAAkAgAw4CAAMBC0EHQQhBtKAgKAIAQbigICgCAEYbIQMLQcCgICANNgIAQbSgICAONgIAIAMMAgsCQCADDQAgDkG0oCAoAgBHDQAgDUHAoCAoAgBHDQAgAS0AKCEAIAFBAToAKCAAQQN0DAILIAFBADoAKAsgAwsOCQcGBwABAgMEBAULQQEhCQwFC0ECIQkMBAtBBCEJDAMLQQUhCQwCC0EGIQkMAQtBByEJC0HQoMAAKAIAEAsLIAkL9wQCA38DfkHAoCBCgICAgICAgAQ3AgBBvKAgQdCgIDYCAEG0oCBCADcCAEGwoCBBsCA2AgADQCAAQQJ0QbAIakEAQQBBAEEAIABBAXYiAUEBcWtBoIbi7X5xQQAgAEEBcWtBoIbi7X5xIAFzQQF2IgFzQQF2IgJBAXFrQaCG4u1+cUEAIAFBAXFrQaCG4u1+cSACc0EBdiIBc0EBdiICQQFxa0GghuLtfnFBACABQQFxa0GghuLtfnEgAnNBAXYiAXNBAXYiAkEBcWtBoIbi7X5xQQAgAUEBcWtBoIbi7X5xIAJzQQF2czYCACAAQQFqIgBBgAJHDQALA0AgBadBA3RBsBBqQgBCAEIAQgAgBUIBiCIDQgGDfULCnpy83fKVtkmDQgAgBUIBg31Cwp6cvN3ylbZJgyADhUIBiCIDhUIBiCIEQgGDfULCnpy83fKVtkmDQgAgA0IBg31Cwp6cvN3ylbZJgyAEhUIBiCIDhUIBiCIEQgGDfULCnpy83fKVtkmDQgAgA0IBg31Cwp6cvN3ylbZJgyAEhUIBiCIDhUIBiCIEQgGDfULCnpy83fKVtkmDQgAgA0IBg31Cwp6cvN3ylbZJgyAEhUIBiIU3AwAgBUIBfCIFQoACUg0AC0HQoMAAAn9BuAkQBiIABEAgAEECNgIkIABBqN4BEAYiAQR/IAFBgICABDYCNCABQQI2AjwgAUEANgIYIAFBADYCOCABBUEACyIBNgKwCSABBEAgAEEAOgAoIABCADcDACAAQgA3AxggAEHIAGpB5AAQByAAQQw2AqwBIAAMAgsgABAFC0EACyIANgIAIAAEf0EABUEAEAtBAQsLEAAjACAAa0FwcSIAJAAgAAsGACAAJAALBAAjAAsRAEG0oCAoAgBBuKAgKAIARgsJAEHAoCAoAgALFwBBxKAgIABBgIAgIABBgIAgSRs2AgALCwBBwKAgIAA2AgALFwBBuKAgIABBgIAgIABBgIAgSRs2AgALCwBBtKAgIAA2AgALCyoDAEGACAsF/Td6WFoAQZEICw8EBAQICAgQEBAgICBAQEAAQaAICwNQEmA=")||(U=L,L=e.locateFile?e.locateFile(U,_):_+U);var V=[];function G(fe){var ve=V[fe];return ve||(fe>=V.length&&(V.length=fe+1),V[fe]=ve=z.get(fe)),ve}function ee(fe){try{return C.grow(fe-T.byteLength+65535>>>16),q(C.buffer),1}catch{}}var X=typeof atob=="function"?atob:function(fe){var ve,xe,Ie,re,me,pe,Ce="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",we="",be=0;fe=fe.replace(/[^A-Za-z0-9\+\/\=]/g,"");do ve=Ce.indexOf(fe.charAt(be++))<<2|(re=Ce.indexOf(fe.charAt(be++)))>>4,xe=(15&re)<<4|(me=Ce.indexOf(fe.charAt(be++)))>>2,Ie=(3&me)<<6|(pe=Ce.indexOf(fe.charAt(be++))),we+=String.fromCharCode(ve),me!==64&&(we+=String.fromCharCode(xe)),pe!==64&&(we+=String.fromCharCode(Ie));while(be<fe.length);return we};function W(fe){if(J(fe))return function(ve){if(typeof A=="boolean"&&A){var xe=Buffer.from(ve,"base64");return new Uint8Array(xe.buffer,xe.byteOffset,xe.byteLength)}try{for(var Ie=X(ve),re=new Uint8Array(Ie.length),me=0;me<Ie.length;++me)re[me]=Ie.charCodeAt(me);return re}catch{throw new Error("Converting base64 string to bytes failed.")}}(fe.slice(k.length))}var Y={b:function(fe,ve,xe){D.copyWithin(fe,ve,ve+xe)},a:function(fe){var ve=D.length,xe=2147483648;if((fe>>>=0)>xe)return!1;for(var Ie=1;Ie<=4;Ie*=2){var re=ve*(1+.2/Ie);if(re=Math.min(re,fe+100663296),ee(Math.min(xe,O(Math.max(fe,re),65536))))return!0}return!1}};(function(){var fe={a:Y};function ve(re,me){var pe,Ce=re.exports;e.asm=Ce,q((C=e.asm.c).buffer),z=e.asm.o,pe=e.asm.d,$.unshift(pe),function(){if(K--,e.monitorRunDependencies&&e.monitorRunDependencies(K),K==0&&oe){var we=oe;oe=null,we()}}()}function xe(re){ve(re.instance)}function Ie(re){return function(){if(!x&&(m||g)){if(typeof fetch=="function"&&!de(L))return fetch(L,{credentials:"same-origin"}).then(function(me){if(!me.ok)throw"failed to load wasm binary file at '"+L+"'";return me.arrayBuffer()}).catch(function(){return te(L)});if(i)return new Promise(function(me,pe){i(L,function(Ce){me(new Uint8Array(Ce))},pe)})}return Promise.resolve().then(function(){return te(L)})}().then(function(me){return WebAssembly.instantiate(me,fe)}).then(function(me){return me}).then(re,function(me){b("failed to asynchronously prepare wasm: "+me),ie(me)})}if(K++,e.monitorRunDependencies&&e.monitorRunDependencies(K),e.instantiateWasm)try{return e.instantiateWasm(fe,ve)}catch(re){return b("Module.instantiateWasm callback failed with error: "+re),!1}(x||typeof WebAssembly.instantiateStreaming!="function"||J(L)||de(L)||typeof fetch!="function"?Ie(xe):fetch(L,{credentials:"same-origin"}).then(function(re){return WebAssembly.instantiateStreaming(re,fe).then(xe,function(me){return b("wasm streaming compile failed: "+me),b("falling back to ArrayBuffer instantiation"),Ie(xe)})})).catch(n)})(),e.___wasm_call_ctors=function(){return(e.___wasm_call_ctors=e.asm.d).apply(null,arguments)},e._init_decompressor=function(){return(e._init_decompressor=e.asm.e).apply(null,arguments)},e._decompress=function(){return(e._decompress=e.asm.f).apply(null,arguments)},e._get_in_buffer_ptr=function(){return(e._get_in_buffer_ptr=e.asm.g).apply(null,arguments)},e._get_out_buffer_ptr=function(){return(e._get_out_buffer_ptr=e.asm.h).apply(null,arguments)},e._in_buffer_set_pos=function(){return(e._in_buffer_set_pos=e.asm.i).apply(null,arguments)},e._in_buffer_set_size=function(){return(e._in_buffer_set_size=e.asm.j).apply(null,arguments)},e._out_buffer_set_pos=function(){return(e._out_buffer_set_pos=e.asm.k).apply(null,arguments)},e._out_buffer_set_size=function(){return(e._out_buffer_set_size=e.asm.l).apply(null,arguments)},e._get_curr_output_length=function(){return(e._get_curr_output_length=e.asm.m).apply(null,arguments)},e._is_input_end_reached=function(){return(e._is_input_end_reached=e.asm.n).apply(null,arguments)};var P,Q=e.stackSave=function(){return(Q=e.stackSave=e.asm.p).apply(null,arguments)},I=e.stackRestore=function(){return(I=e.stackRestore=e.asm.q).apply(null,arguments)},N=e.stackAlloc=function(){return(N=e.stackAlloc=e.asm.r).apply(null,arguments)};function se(fe){this.name="ExitStatus",this.message="Program terminated with exit("+fe+")",this.status=fe}function ce(fe){function ve(){P||(P=!0,e.calledRun=!0,y||(le($),t(e),e.onRuntimeInitialized&&e.onRuntimeInitialized(),function(){if(e.postRun)for(typeof e.postRun=="function"&&(e.postRun=[e.postRun]);e.postRun.length;)xe=e.postRun.shift(),he.unshift(xe);var xe;le(he)}()))}K>0||(function(){if(e.preRun)for(typeof e.preRun=="function"&&(e.preRun=[e.preRun]);e.preRun.length;)xe=e.preRun.shift(),ne.unshift(xe);var xe;le(ne)}(),K>0||(e.setStatus?(e.setStatus("Running..."),setTimeout(function(){setTimeout(function(){e.setStatus("")},1),ve()},1)):ve()))}if(e.cwrap=function(fe,ve,xe,Ie){var re=(xe=xe||[]).every(function(me){return me==="number"});return ve!=="string"&&re&&!Ie?M(fe):function(){return R(fe,ve,xe,arguments)}},oe=function fe(){P||ce(),P||(oe=fe)},e.run=ce,e.preInit)for(typeof e.preInit=="function"&&(e.preInit=[e.preInit]);e.preInit.length>0;)e.preInit.pop()();return ce(),e.ready}})();const tT=["","Memory allocation failed","Memory usage limit reached","Unsupported check; not verifying file integrity","Not an .xz file","Unsupported options in the .xz headers","File is corrupt","Unknown decompression bug"];class tp{constructor(e){this.manager=e!==void 0?e:rb,this.crossOrigin="Anonymous",this.xz=null}init(){return this.xz?Promise.resolve():KB().then(e=>{this._emInitDecompressor=e.cwrap("init_decompressor","number"),this._emDecompress=e.cwrap("decompress","number"),this._emGetInBufferPtr=e.cwrap("get_in_buffer_ptr","number"),this._emGetOutBufferPtr=e.cwrap("get_out_buffer_ptr","number"),this._emInBufferSetPos=e.cwrap("in_buffer_set_pos",null,["number"]),this._emInBufferSetSize=e.cwrap("in_buffer_set_size",null,["number"]),this._emOutBufferSetPos=e.cwrap("out_buffer_set_pos",null,["number"]),this._emOutBufferSetSize=e.cwrap("out_buffer_set_size",null,["number"]),this._emGetCurrOutputLength=e.cwrap("get_curr_output_length","number"),this._emIsInputEndReached=e.cwrap("is_input_end_reached","number"),this.xz=e})}load(e,t,n,r){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e);const a=this,i=Qa.get(e);if(i!==void 0)return a.manager.itemStart(e),setTimeout(function(){t&&t(i),a.manager.itemEnd(e)},0),i;const s=this.init(),c=new XMLHttpRequest;return c.open("GET",e,!0),c.addEventListener("load",function(u){const h=u.target.response;this.status===200||this.status===0?(this.status===0&&console.warn("v3d.XZLoader: HTTP Status 0 received."),s.then(()=>{a.decompressArrayBuffer(h,function(f){setTimeout(function(){t&&t(f),a.manager.itemEnd(e),Qa.add(e,f)},1)},function(f){n&&n((2+1*f)/3)},function(f){r&&r(f),a.manager.itemEnd(e),a.manager.itemError(e)})})):(r&&r(u),a.manager.itemEnd(e),a.manager.itemError(e))},!1),n&&c.addEventListener("progress",function(u){let h;h=u.lengthComputable?u.loaded/u.total:1,n(2*h/3)},!1),c.addEventListener("error",function(u){r&&r(u),a.manager.itemEnd(e),a.manager.itemError(e)},!1),c.responseType="arraybuffer",c.send(null),a.manager.itemStart(e),c}setCrossOrigin(e){return this.crossOrigin=e,this}setPath(e){return this.path=e,this}decompressArrayBuffer(e,t,n,r){const a=this;function i(_){const x=a._emGetInBufferPtr();a.xz.HEAPU8.set(_,x),a._emInBufferSetPos(0),a._emInBufferSetSize(_.length),s()}function s(){a._emOutBufferSetPos(0)}const c=a._emInitDecompressor();if(c!=0)return console.error("XZLoader._emInitDecompressor: error code "+c+" ("+tT[c]+")"),void(r&&r(c));const u=new Uint8Array(e),h=u.length,f=[];let m=0,g=Math.min(524288,h),A=0;i(u.subarray(m,g)),function _(){const x=a._emDecompress();if(x)console.error("XZLoader._emDecompress: error code "+x+" ("+tT[x]+")"),r&&r(x);else{const C=a._emGetCurrOutputLength();if(f.push(function(b){const y=a._emGetOutBufferPtr();return new Uint8Array(a.xz.HEAPU8.subarray(y,y+b))}(C)),s(),a._emIsInputEndReached()&&(m=g,g=Math.min(g+524288,h),i(u.subarray(m,g))),n&&n(m/h),m==g){const b=f.reduce(function(R,T,w,D){return R+T.length},0),y=new Uint8Array(b);let M=0;f.forEach(function(R){y.set(R,M),M+=R.length}),t&&t(y.buffer)}else A++,A%2==0?setTimeout(_,1):_()}}()}}class $B extends ma{constructor(e){super(e),this.reversed=!1}load(e,t,n,r){const a=this,i=new fa(this.manager);i.setPath(this.path),i.setResponseType("arraybuffer"),i.load(e,function(s){t(a.parse(s))},n,r)}parse(e){function t(n){var r,a=[];n.forEach(function(s){s.type.toLowerCase()==="m"?(r=[s],a.push(r)):s.type.toLowerCase()!=="z"&&r.push(s)});var i=[];return a.forEach(function(s){var c={type:"m",x:s[s.length-1].x,y:s[s.length-1].y};i.push(c);for(var u=s.length-1;u>0;u--){var h=s[u];c={type:h.type},h.x2!==void 0&&h.y2!==void 0?(c.x1=h.x2,c.y1=h.y2,c.x2=h.x1,c.y2=h.y1):h.x1!==void 0&&h.y1!==void 0&&(c.x1=h.x1,c.y1=h.y1),c.x=s[u-1].x,c.y=s[u-1].y,i.push(c)}}),i}return typeof opentype>"u"?(console.warn("v3d.TTFLoader: The loader requires opentype.js. Make sure it's included before using the loader."),null):function(n,r){for(var a=Math.round,i={},s=1e3/(n.unitsPerEm||2048),c=n.encoding.cmap.glyphIndexMap,u=Object.keys(c),h=0;h<u.length;h++){var f=u[h],m=n.glyphs.glyphs[c[f]];if(f!==void 0){var g={ha:a(m.advanceWidth*s),x_min:a(m.xMin*s),x_max:a(m.xMax*s),o:""};r&&(m.path.commands=t(m.path.commands)),m.path.commands.forEach(function(A){A.type.toLowerCase()==="c"&&(A.type="b"),g.o+=A.type.toLowerCase()+" ",A.x!==void 0&&A.y!==void 0&&(g.o+=a(A.x*s)+" "+a(A.y*s)+" "),A.x1!==void 0&&A.y1!==void 0&&(g.o+=a(A.x1*s)+" "+a(A.y1*s)+" "),A.x2!==void 0&&A.y2!==void 0&&(g.o+=a(A.x2*s)+" "+a(A.y2*s)+" ")}),i[String.fromCodePoint(m.unicode)]=g}}return{glyphs:i,familyName:n.getEnglishName("fullName"),ascender:a(n.tables.os2.sTypoAscender*s),descender:a(n.tables.os2.sTypoDescender*s),lineGap:n.tables.os2.sTypoLineGap*s,underlinePosition:n.tables.post.underlinePosition,underlineThickness:n.tables.post.underlineThickness,boundingBox:{xMin:n.tables.head.xMin*s,xMax:n.tables.head.xMax*s,yMin:n.tables.head.yMin*s,yMax:n.tables.head.yMax*s},resolution:1e3,original_font_information:n.tables.name}}(opentype.parse(e),this.reversed)}}class Q2 extends nB{constructor(e){super(e),this.type=1016,Wn.isSafariWithUint16Bug()&&(console.warn("Safari 11/12 detected. Applying workaround for half-float texture bug"),this.type=1015)}parse(e){const t=function(c,u){switch(c){case 1:console.error("v3d.RGBELoader Read Error: "+(u||""));break;case 2:console.error("v3d.RGBELoader Write Error: "+(u||""));break;case 3:console.error("v3d.RGBELoader Bad File Format: "+(u||""));break;default:console.error("v3d.RGBELoader: Error: "+(u||""))}return-1},n=function(c,u,h){u=u||1024;let f=c.pos,m=-1,g=0,A="",_=String.fromCharCode.apply(null,new Uint16Array(c.subarray(f,f+128)));for(;0>(m=_.indexOf(`
`))&&g<u&&f<c.byteLength;)A+=_,g+=_.length,f+=128,_+=String.fromCharCode.apply(null,new Uint16Array(c.subarray(f,f+128)));return-1<m&&(c.pos+=g+m+1,A+_.slice(0,m))},r=function(c,u,h,f){const m=c[u+3],g=Math.pow(2,m-128)/255;h[f+0]=c[u+0]*g,h[f+1]=c[u+1]*g,h[f+2]=c[u+2]*g,h[f+3]=1},a=function(c,u,h,f){const m=c[u+3],g=Math.pow(2,m-128)/255;h[f+0]=gc(Math.min(c[u+0]*g,65504)),h[f+1]=gc(Math.min(c[u+1]*g,65504)),h[f+2]=gc(Math.min(c[u+2]*g,65504)),h[f+3]=gc(1)},i=new Uint8Array(e);i.pos=0;const s=function(c){const u=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,h=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,f=/^\s*FORMAT=(\S+)\s*$/,m=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,g={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};let A,_;if(c.pos>=c.byteLength||!(A=n(c)))return t(1,"no header found");if(!(_=A.match(/^#\?(\S+)/)))return t(3,"bad initial token");for(g.valid|=1,g.programtype=_[1],g.string+=A+`
`;A=n(c),A!==!1;)if(g.string+=A+`
`,A.charAt(0)!=="#"){if((_=A.match(u))&&(g.gamma=parseFloat(_[1])),(_=A.match(h))&&(g.exposure=parseFloat(_[1])),(_=A.match(f))&&(g.valid|=2,g.format=_[1]),(_=A.match(m))&&(g.valid|=4,g.height=parseInt(_[1],10),g.width=parseInt(_[2],10)),2&g.valid&&4&g.valid)break}else g.comments+=A+`
`;return 2&g.valid?4&g.valid?g:t(3,"missing image size specifier"):t(3,"missing format specifier")}(i);if(s!==-1){const c=s.width,u=s.height,h=function(f,m,g){const A=m;if(A<8||A>32767||f[0]!==2||f[1]!==2||128&f[2])return new Uint8Array(f);if(A!==(f[2]<<8|f[3]))return t(3,"wrong scanline width");const _=new Uint8Array(4*m*g);if(!_.length)return t(4,"unable to allocate buffer space");let x=0,C=0;const b=4*A,y=new Uint8Array(4),M=new Uint8Array(b);let R=g;for(;R>0&&C<f.byteLength;){if(C+4>f.byteLength)return t(1);if(y[0]=f[C++],y[1]=f[C++],y[2]=f[C++],y[3]=f[C++],y[0]!=2||y[1]!=2||(y[2]<<8|y[3])!=A)return t(3,"bad rgbe scanline format");let T,w=0;for(;w<b&&C<f.byteLength;){T=f[C++];const z=T>128;if(z&&(T-=128),T===0||w+T>b)return t(3,"bad scanline data");if(z){const F=f[C++];for(let O=0;O<T;O++)M[w++]=F}else M.set(f.subarray(C,C+T),w),w+=T,C+=T}const D=A;for(let z=0;z<D;z++){let F=0;_[x]=M[z+F],F+=A,_[x+1]=M[z+F],F+=A,_[x+2]=M[z+F],F+=A,_[x+3]=M[z+F],x+=4}R--}return _}(i.subarray(i.pos),c,u);if(h!==-1){let f,m,g;switch(this.type){case 1015:g=h.length/4;const A=new Float32Array(4*g);for(let x=0;x<g;x++)r(h,4*x,A,4*x);f=A,m=1015;break;case 1016:g=h.length/4;const _=new Uint16Array(4*g);for(let x=0;x<g;x++)a(h,4*x,_,4*x);f=_,m=1016;break;default:console.error("v3d.RGBELoader: unsupported type: ",this.type)}return{width:c,height:u,data:f,header:s.string,gamma:s.gamma,exposure:s.exposure,type:m}}}return null}setDataType(e){return this.type=e,this}load(e,t,n,r){return super.load(e,function(a,i){switch(a.type){case 1015:case 1016:a.encoding=3e3,a.minFilter=1006,a.magFilter=1006,a.generateMipmaps=!1,a.flipY=!0}t&&t(a,i)},n,r)}}const nT=new mn,rT=new Ve,wre=new B,Tre=new B,jf=new ct,oT=new hp,sx=new Map;class Rre extends Tt{constructor(){super(),this.isPlaneReflectionProbe=!0,this.type="PlaneReflectionProbe",this.influenceDistance=1,this.falloff=.5,this.probeClipStart=.1,this.planeSize=new Ee(1,1),this.qualityFactor=.75,this.visibilityGroup=null,this.visibilityGroupInv=!1,this.boundingBox=new mn,this.normal=new B,this.textureMatrix=new Ve,this.virtualCamera=new ir,this.reflectorWorldPosition=new B,this.cameraWorldPosition=new B,this.rotationMatrix=new Ve,this.view=new B,this.lookAtPosition=new B(0,0,-1),this.reflectorPlane=new _o,this.clipPlane=new ct,this.target=new B;const e={minFilter:1006,magFilter:1006,format:1023,encoding:3001};this.renderTarget=new qt(1024,1024,e),this.renderTarget.texture.name="PlaneReflectionProbe",this.matrixWorldInverse=new Ve}_calcLocalBounding(){const e=wre.setScalar(0),t=Tre.set(2*this.planeSize.x,2*this.influenceDistance/this.scale.y,2*this.planeSize.y);this.boundingBox.setFromCenterAndSize(e,t)}_isOutOfFrustum(e){const t=rT.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse);oT.setFromProjectionMatrix(t);const n=nT.copy(this.boundingBox).applyMatrix4(this.matrixWorld);return!oT.intersectsBox(n)}_traverseDisableOther(e){!e.isPlaneReflectionProbe&&this._isVisible(e)||(sx.set(e,e.layers.mask),e.layers.disableAll());const t=e.children;for(let n=0;n<t.length;n++)this._traverseDisableOther(t[n])}makeMultisampleRenderTarget(e){this.renderTarget.samples=e}setSize(e,t){this.renderTarget.setSize(this.qualityFactor*e,this.qualityFactor*t)}setEncoding(e){this.renderTarget.texture.encoding=e}intersectsMesh(e){let t=!1;const n=e.geometry,r=rT;r.copy(e.matrixWorld).invert(),r.multiply(this.matrixWorld);const a=this.boundingBox,i=nT.copy(a).applyMatrix4(r);return n.boundingBox===null&&n.computeBoundingBox(),t=n.boundingBox.intersectsBox(i),t&&n.boundsTree&&(t=n.boundsTree.intersectsBox(a,r)),t}update(e,t,n){if(this._calcLocalBounding(),this._isOutOfFrustum(t))return;const r=this.reflectorWorldPosition;r.setFromMatrixPosition(this.matrixWorld);const a=this.cameraWorldPosition;a.setFromMatrixPosition(t.matrixWorld);const i=this.rotationMatrix;i.extractRotation(this.matrixWorld);const s=this.normal;s.set(0,1,0),s.applyMatrix4(i);const c=this.view;if(c.subVectors(r,a),c.dot(s)>0)return;this._traverseDisableOther(e),c.reflect(s).negate(),c.add(r),i.extractRotation(t.matrixWorld);const u=this.lookAtPosition;u.set(0,0,-1),u.applyMatrix4(i),u.add(a);const h=this.target;h.subVectors(r,u),h.reflect(s).negate(),h.add(r);const f=this.virtualCamera;f.position.copy(c),f.up.set(0,1,0),f.up.applyMatrix4(i),f.up.reflect(s),f.lookAt(h),f.far=t.far,f.updateMatrixWorld();const m=f.projectionMatrix;m.copy(t.projectionMatrix);const g=this.textureMatrix;g.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),g.multiply(m),g.multiply(f.matrixWorldInverse);const A=this.reflectorPlane;A.setFromNormalAndCoplanarPoint(s,r),A.applyMatrix4(f.matrixWorldInverse);const _=this.clipPlane;_.set(A.normal.x,A.normal.y,A.normal.z,A.constant),jf.x=(Math.sign(_.x)+m.elements[8])/m.elements[0],jf.y=(Math.sign(_.y)+m.elements[9])/m.elements[5],jf.z=-1,jf.w=(1+m.elements[10])/m.elements[14],_.multiplyScalar(2/_.dot(jf)),m.elements[2]=_.x,m.elements[6]=_.y,m.elements[10]=_.z+1-this.probeClipStart,m.elements[14]=_.w;const x=n.getRenderTarget(),C=n.xr.enabled,b=n.shadowMap.autoUpdate,y=n.useOIT;n.xr.enabled=!1,n.shadowMap.autoUpdate=!1,n.useOIT=!1,n.setRenderTarget(this.renderTarget),n.state.buffers.depth.setMask(!0),n.autoClear===!1&&n.clear(),n.render(e,f),n.xr.enabled=C,n.shadowMap.autoUpdate=b,n.useOIT=y,n.setRenderTarget(x);const M=t.viewport;M!==void 0&&n.state.viewport(M),sx.forEach((R,T)=>{T.layers.mask=R}),sx.clear()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}copy(e){return super.copy(e),this.influenceDistance=e.influenceDistance,this.probeClipStart=e.probeClipStart,this.visibilityGroup=e.visibilityGroup,this.visibilityGroupInv=e.visibilityGroupInv,this}dispose(){this.renderTarget!==null&&(this.renderTarget.dispose(),this.renderTarget=null),this.dispatchEvent({type:"dispose"})}_isVisible(e){return this.visibilityGroup===null||!e.isMesh?!0:e.groupNames.indexOf(this.visibilityGroup)!==-1^this.visibilityGroupInv}}class JB{static init(e,t){e!==void 0&&t!==void 0||console.error("RectAreaLightUniformsLib: Missing LTC data (required in Verge3D)");const n=new Float32Array(e),r=new Float32Array(t);Ze.LTC_FLOAT_1=new ss(n,64,64,1023,1015,300,1001,1001,1006,1003,1),Ze.LTC_FLOAT_2=new ss(r,64,64,1023,1015,300,1001,1001,1006,1003,1),Ze.LTC_FLOAT_1.name="RectArea.ltc1",Ze.LTC_FLOAT_2.name="RectArea.ltc2",Ze.LTC_FLOAT_1.needsUpdate=!0,Ze.LTC_FLOAT_2.needsUpdate=!0;const a=new Uint16Array(e.length);e.forEach(function(s,c){a[c]=gc(s)});const i=new Uint16Array(t.length);t.forEach(function(s,c){i[c]=gc(s)}),Ze.LTC_HALF_1=new ss(a,64,64,1023,1016,300,1001,1001,1006,1003,1),Ze.LTC_HALF_2=new ss(i,64,64,1023,1016,300,1001,1001,1006,1003,1),Ze.LTC_HALF_1.needsUpdate=!0,Ze.LTC_HALF_2.needsUpdate=!0}}class eP{constructor(e){this.isFont=!0,this.type="Font",this.data=e}generateShapes(e,t=100,n="left",r="topBaseline",a=-1,i=!1){const s=[],c=Ire(e,t,this.data,n,r,a,i);for(let u=0,h=c.length;u<h;u++)Array.prototype.push.apply(s,c[u].toShapes());return s}}function Ire(o,e,t,n,r,a,i){const s=String(o).split(`
`),c=[];for(let x=0;x<s.length;x++){let C=s[x];c[x]=Array.from(C)}let u=e/t.resolution;i&&(u*=(t.ascender-t.descender)/(t.boundingBox.yMax-t.boundingBox.yMin)),t.lineGap=t.lineGap||0,a===-1?a=(t.ascender-t.descender+t.lineGap)*u:a*=e;const h=[];let f=0,m=0;const g=c.length,A=a*g,_=a-a*Math.abs(t.descender)/t.ascender;switch(r){case"topBaseline":default:m=0;break;case"top":m=-_;break;case"center":m=g>1?.5*A-_:-t.ascender/2*u;break;case"bottom":m=A-a-t.descender*u;break;case"bottomBaseline":m=A-a}for(let x=0;x<c.length;x++){const C=c[x];switch(n){case"left":default:f=0;break;case"center":f=-aT(C,u,t)/2;break;case"right":f=-aT(C,u,t)}for(let b=0;b<C.length;b++){const y=Lre(C[b],u,f,m,t);f+=y.offsetX,h.push(y.path)}m-=a}return h}function Lre(o,e,t,n,r){const a=r.glyphs[o]||r.glyphs["?"];if(!a)return void console.error('v3d.Font: character "'+o+'" does not exists in font family '+r.familyName+".");const i=new EB;let s,c,u,h,f,m,g,A;if(a.o){const _=a._cachedOutline||(a._cachedOutline=a.o.split(" "));for(let x=0,C=_.length;x<C;)switch(_[x++]){case"m":s=_[x++]*e+t,c=_[x++]*e+n,i.moveTo(s,c);break;case"l":s=_[x++]*e+t,c=_[x++]*e+n,i.lineTo(s,c);break;case"q":u=_[x++]*e+t,h=_[x++]*e+n,f=_[x++]*e+t,m=_[x++]*e+n,i.quadraticCurveTo(f,m,u,h);break;case"b":u=_[x++]*e+t,h=_[x++]*e+n,f=_[x++]*e+t,m=_[x++]*e+n,g=_[x++]*e+t,A=_[x++]*e+n,i.bezierCurveTo(f,m,g,A,u,h)}}return{offsetX:a.ha*e,path:i}}function aT(o,e,t){let n=0;for(var r=0;r<o.length;r++){const a=o[r];n+=(t.glyphs[a]||t.glyphs["?"]).ha*e}return n}const iT=new B,sT=new B;class Bre extends Tt{constructor(){super(),this.isClippingPlaneObject=!0,this.type="ClippingPlaneObject",this.plane=new _o,this.clippingGroup=null,this.clipShadows=!1,this.negated=!1,this.clipIntersection=!1,this.crossSection=!1,this.crossSectionColor=new Qe(16711680),this.crossSectionOpacity=1,this.crossSectionRenderSide=0,this.crossSectionSize=100,this._crossMatProfile="blender"}updatePlane(){this.updateWorldMatrix(!0,!1),this.getWorldPosition(iT);const e=this.matrixWorld.elements;sT.set(e[4],e[5],e[6]).normalize(),this.plane.setFromNormalAndCoplanarPoint(sT,iT),this.negated&&this.plane.negate()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.updatePlane()}needsClippingPlane(e){return e.isMesh&&(e.groupNames.indexOf(this.clippingGroup)>=0||this.clippingGroup===null)&&!e.isAuxClippingMesh}assignToObject(e,t=0){const n=this.plane,r=e.material,a=e.geometry;if(r.clippingPlanes=r.clippingPlanes||[],r.clippingPlanes.indexOf(n)==-1&&r.clippingPlanes.push(n),r.clipShadows=this.clipShadows,r.clipIntersection=this.clipIntersection,this.crossSection){this.cleanupAuxMeshes(e);const i=new hr;i.depthWrite=!1,i.depthTest=!1,i.colorWrite=!1,i.stencilWrite=!0,i.stencilFunc=519,i.clipShadows=this.clipShadows,i.clipIntersection=this.clipIntersection;const s=!!e.isSkinnedMesh,c=e.morphTargetInfluences,u=_e(c)&&c.length>0,h=i.clone();let f;h.name="ClipCrossSectionStencilBack",h.side=1,h.clippingPlanes=[n],h.stencilFail=34055,h.stencilZFail=34055,h.stencilZPass=34055,s?(f=new Hg(a,h),f.skeleton=e.skeleton):f=new Mt(a,h),f.renderOrder=t,f.name="ClipCrossSectionStencilBack",f.isAuxClippingMesh=!0,u&&(f.morphTargetInfluences=c.slice(),f.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),e.add(f);const m=i.clone();let g;m.name="ClipCrossSectionStencilFront",m.side=0,m.clippingPlanes=[n],m.stencilFail=34056,m.stencilZFail=34056,m.stencilZPass=34056,s?(g=new Hg(a,m),g.skeleton=e.skeleton):g=new Mt(a,m),g.renderOrder=t+.1,g.name="ClipCrossSectionStencilFront",g.isAuxClippingMesh=!0,u&&(g.morphTargetInfluences=c.slice(),g.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),e.add(g),r.isMeshNodeMaterial&&(this._crossMatProfile=r.profile)}}createCrossSectionPlane(e,t){this.cleanupAuxMeshes();const n=new Ab("ClipCrossSectionColor",this.crossSectionColor,this.crossSectionOpacity,this._crossMatProfile);n.clippingPlanes=e.filter(i=>i!==this.plane),n.clipShadows=this.clipShadows,n.clipIntersection=this.clipIntersection,n.stencilWrite=!0,n.stencilRef=0,n.stencilFunc=517,n.stencilFail=7681,n.stencilZFail=7681,n.stencilZPass=7681,n.side=this.crossSectionRenderSide,this.crossSectionOpacity<1&&(n.transparent=!0,n.premultipliedAlpha=!0,n.blending=5,n.blendEquation=100,n.blendSrc=201,n.blendDst=205);const r=new ps(this.crossSectionSize,this.crossSectionSize);this.negated?r.rotateX(-Math.PI/2):r.rotateX(Math.PI/2);const a=new Mt(r,n);a.name="ClipCrossSectionColor",a.isAuxClippingMesh=!0,a.renderOrder=t,a.onAfterRender=function(i){i.clearStencil()},this.add(a)}cleanupAuxMeshes(e=null){if(e)for(let t=e.children.length-1;t>=0;t--){const n=e.children[t];n.isAuxClippingMesh&&n.material.clippingPlanes[0]==this.plane&&(n.geometry.dispose(),n.material.dispose(),e.remove(n))}else for(let t=this.children.length-1;t>=0;t--){const n=this.children[t];n.isAuxClippingMesh&&(n.geometry.dispose(),n.material.dispose(),this.remove(n))}}copy(e){return super.copy(e),this.plane=e.plane,this.clippingGroup=e.clippingGroup,this.clipShadows=e.clipShadows,this.negated=e.negated,this.clipIntersection=e.clipIntersection,this.crossSection=e.crossSection,this.crossSectionColor.copy(e.crossSectionColor),this.crossSectionOpacity=e.crossSectionOpacity,this.crossSectionRenderSide=e.crossSectionRenderSide,this.crossSectionSize=e.crossSectionSize,this._crossMatProfile=e._crossMatProfile,this}}class Bd{constuctor(){this.isConstraint=!0,this.name="",this.type="Constraint",this.mute=!1}_updateObjMatrixWorld(e){e.matrixAutoUpdate&&e.matrix.compose(e.position,e.quaternion,e.scale),e.parent==null?e.matrixWorld.copy(e.matrix):e.matrixWorld.multiplyMatrices(e.parent.matrixWorld,e.matrix)}update(e){this.mute}copy(e){return this.name=e.name,this.mute=e.mute,this}clone(){return new this.constructor().copy(this)}}class ao extends Bd{constructor(e){super(),this.isTargetConstraint=!0,this.type="TargetConstraint",this.target=e}copy(e){return super.copy(e),this.target=e.target,this}clone(){return new this.constructor(this.target).copy(this)}}const lT=new Ve,Pre=new Ct().setFromAxisAngle(new B(1,0,0),-Math.PI/2);class tP extends ao{constructor(e){super(e),this.isChildOfConstraint=!0,this.type="ChildOfConstraint",this.offsetMatrix=new Ve,this.fixCameraLightRotation=!1}copy(e){return super.copy(e),this.offsetMatrix.copy(e.offsetMatrix),this.fixCameraLightRotation=e.fixCameraLightRotation,this}update(e){super.update(e),this.mute||(lT.multiplyMatrices(this.target.matrixWorld,this.offsetMatrix),lT.decompose(e.position,e.quaternion,e.scale),this.fixCameraLightRotation&&(e.isCamera||e.isLight)&&e.quaternion.multiply(Pre))}}const Kr=new B,Nre=new Ct,Dre=new B;class nP extends ao{constructor(e){super(e),this.isCopyLocationConstraint=!0,this.type="CopyLocationConstraint",this.useX=!0,this.useY=!0,this.useZ=!0,this.invertX=!1,this.invertY=!1,this.invertZ=!1,this.useOffset=!1,this.influence=1,this._firstIteration=!0,this._objPosInit=new B,this._offset=new B}copy(e){return super.copy(e),this.useX=e.useX,this.useY=e.useY,this.useZ=e.useZ,this.invertX=e.invertX,this.invertY=e.invertY,this.invertZ=e.invertZ,this.useOffset=e.useOffset,this.influence=e.influence,this._firstIteration=!1,this}update(e){super.update(e),this.mute||(this.target.matrixWorld.decompose(Kr,Nre,Dre),this._firstIteration&&(this._updateObjMatrixWorld(e),e.getWorldPositionNU(this._objPosInit),this._offset.subVectors(Kr,this._objPosInit),this._firstIteration=!1),this.useX?(this.invertX&&(Kr.x=-Kr.x),this.useOffset&&(Kr.x-=this._offset.x)):Kr.x=this._objPosInit.x,this.useY?(this.invertY&&(Kr.y=-Kr.y),this.useOffset&&(Kr.y-=this._offset.y)):Kr.y=this._objPosInit.y,this.useZ?(this.invertZ&&(Kr.z=-Kr.z),this.useOffset&&(Kr.z-=this._offset.z)):Kr.z=this._objPosInit.z,e.position.lerpVectors(this._objPosInit,Kr,this.influence),e.parent&&e.parent.worldToLocal(e.position))}}const Ore=new Ct().setFromAxisAngle(new B(1,0,0),-Math.PI/2),lx=new B,Du=new Ct,cx=new B;class rP extends ao{constructor(e){super(e),this.isCopyRotationConstraint=!0,this.type="CopyRotationConstraint",this.useX=!0,this.useY=!0,this.useZ=!0,this.invertX=!1,this.invertY=!1,this.invertZ=!1,this.mixMode="REPLACE",this.influence=1,this.fixCameraLightRotation=!1,this._firstIteration=!0,this._objQuatInit=new Ct}copy(e){return super.copy(e),this.useX=e.useX,this.useY=e.useY,this.useZ=e.useZ,this.invertX=e.invertX,this.invertY=e.invertY,this.invertZ=e.invertZ,this.mixMode=e.mixMode,this.influence=e.influence,this.fixCameraLightRotation=e.fixCameraLightRotation,this._firstIteration=!1,this}update(e){super.update(e),this.mute||(this.target.matrixWorld.decompose(lx,Du,cx),this._firstIteration&&(this._updateObjMatrixWorld(e),e.matrixWorld.decompose(lx,this._objQuatInit,cx),this._firstIteration=!1),e.quaternion.copy(this._objQuatInit),(this.useX||this.useY||this.useZ)&&(this.mixMode=="REPLACE"||this.mixMode=="ADD"||(this.mixMode=="BEFORE"?Du.multiply(e.quaternion):this.mixMode=="AFTER"?Du.premultiply(e.quaternion):this.mixMode),e.quaternion.slerp(Du,this.influence)),e.parent&&(e.parent.matrixWorld.decompose(lx,Du,cx),e.quaternion.premultiply(Du.invert())),this.fixCameraLightRotation&&(e.isCamera||e.isLight)&&e.quaternion.multiply(Ore))}}const cT=new B,uT=new Ct,sn=new B;class oP extends ao{constructor(e){super(e),this.isCopyScaleConstraint=!0,this.type="CopyScaleConstraint",this.useX=!0,this.useY=!0,this.useZ=!0,this.power=1,this.useMakeUniform=!1,this.useOffset=!1,this.useAdd=!1,this.influence=1,this._objInitScale=new B,this._volumeScaleFactor=new B,this._firstIteration=!0}copy(e){return super.copy(e),this.useX=e.useX,this.useY=e.useY,this.useZ=e.useZ,this.power=e.power,this.useMakeUniform=e.useMakeUniform,this.useOffset=e.useOffset,this.useAdd=e.useAdd,this.influence=e.influence,this._firstIteration=!1,this}update(e){if(super.update(e),!this.mute){if(this.target.matrixWorld.decompose(cT,uT,sn),this._firstIteration&&(this._updateObjMatrixWorld(e),e.matrixWorld.decompose(cT,uT,this._objInitScale),this._volumeScaleFactor.set(Math.pow(sn.x-this._objInitScale.x,3),Math.pow(sn.y-this._objInitScale.y,3),Math.pow(sn.z-this._objInitScale.z,3)),this._firstIteration=!1),this.useMakeUniform){let t=1;this.useX&&(t*=sn.x),this.useY&&(t*=sn.y),this.useZ&&(t*=sn.z),t=Math.pow(Math.cbrt(t),this.power),sn.set(t,t,t),this.useOffset&&(this.useAdd?(sn.add(this._objInitScale),sn.addScalar(-1)):sn.multiply(this._objInitScale))}else sn.set(this.useX?Math.pow(sn.x,this.power):this._objInitScale.x,this.useY?Math.pow(sn.y,this.power):this._objInitScale.y,this.useZ?Math.pow(sn.z,this.power):this._objInitScale.z),this.useOffset&&(this.useAdd?sn.set(this.useX?sn.x+this._objInitScale.x-1:sn.x,this.useY?sn.y+this._objInitScale.y-1:sn.y,this.useZ?sn.z+this._objInitScale.z-1:sn.z):sn.set(this.useX?sn.x*this._objInitScale.x:sn.x,this.useY?sn.y*this._objInitScale.y:sn.y,this.useZ?sn.z*this._objInitScale.z:sn.z));e.scale.copy(this._objInitScale),e.scale.lerp(sn,this.influence)}}}const Fre=new Ct().setFromAxisAngle(new B(1,0,0),-Math.PI/2),w0=new Ve,dT=new B,fT=new Ct,hT=new B;class aP extends ao{constructor(e){super(e),this.isCopyTransformsConstraint=!0,this.type="CopyTransformsConstraint",this.mixMode="REPLACE",this.influence=1,this.fixCameraLightRotation=!1,this._firstIteration=!0,this._objMatrixWorldInit=new Ve}copy(e){return super.copy(e),this.mixMode=e.mixMode,this.influence=e.influence,this.fixCameraLightRotation=e.fixCameraLightRotation,this._firstIteration=!0,this}update(e){super.update(e),this.mute||(this._firstIteration&&(this._updateObjMatrixWorld(e),this._objMatrixWorldInit.copy(e.matrixWorld),this._firstIteration=!1),w0.copy(this.target.matrixWorld),this.mixMode=="REPLACE"||(this.mixMode=="BEFORE"?w0.multiply(this._objMatrixWorldInit):this.mixMode=="AFTER"&&w0.premultiply(this._objMatrixWorldInit)),w0.decompose(dT,fT,hT),this._objMatrixWorldInit.decompose(e.position,e.quaternion,e.scale),e.position.lerp(dT,this.influence),e.quaternion.slerp(fT,this.influence),e.scale.lerp(hT,this.influence),this.fixCameraLightRotation&&(e.isCamera||e.isLight)&&e.quaternion.multiply(Fre))}}const Ure=new Ct().setFromAxisAngle(new B(1,0,0),-Math.PI/2),ux=new B,ac=new Ct,dx=new B,pT=new B,Xs=new B,qs=new B,Ou=new B,fx={X:0,Y:1,Z:2,"-X":3,"-Y":4,"-Z":5},hx={0:new B(1,0,0),1:new B(0,1,0),2:new B(0,0,1),3:new B(-1,0,0),4:new B(0,-1,0),5:new B(0,0,-1)};class iP extends ao{constructor(e){super(e),this.isDampedTrackConstraint=!0,this.type="DampedTrackConstraint",this.trackAxis="X",this.influence=1,this.fixCameraLightRotation=!1,this._firstIteration=!0}copy(e){return super.copy(e),this.trackAxis=e.trackAxis,this.influence=e.influence,this.fixCameraLightRotation=e.fixCameraLightRotation,this._firstIteration=!1,this}update(e){if(super.update(e),!this.mute&&(this.target.matrixWorld.decompose(ux,ac,dx),this._firstIteration&&(this._updateObjMatrixWorld(e),this._firstIteration=!1),e.matrixWorld.decompose(pT,ac,dx),Xs.subVectors(ux,pT),Xs.length()!=0)){let t;if(Xs.normalize(),qs.copy(hx[fx[this.trackAxis]]),qs.applyQuaternion(ac),qs.length()==0&&qs.copy(hx[fx[this.trackAxis]]),qs.normalize(),Ou.crossVectors(qs,Xs),t=qs.angleTo(Xs),Ou.length()<Number.EPSILON&&(Math.abs(t)<Math.PI-.01||(t=Math.PI,Xs.copy(hx[(fx[this.trackAxis]+2)%6]),Xs.applyQuaternion(ac),Ou.crossVectors(qs,Xs),Ou.length()==0)))return;Ou.normalize(),e.quaternion.premultiply(ac.setFromAxisAngle(Ou,t)),e.parent&&(e.parent.matrixWorld.decompose(ux,ac,dx),e.quaternion.premultiply(ac.invert())),this.fixCameraLightRotation&&(e.isCamera||e.isLight)&&e.quaternion.multiply(Ure)}}}const zre={X:new B(1,0,0),Y:new B(0,1,0),Z:new B(0,0,1),"-X":new B(-1,0,0),"-Y":new B(0,-1,0),"-Z":new B(0,0,-1)},ar=new B,br=new B,Sr=new B,an=new B;class sP extends ao{constructor(e){super(e),this.isFloorConstraint=!0,this.type="FloorConstraint",this.floorLocation="Y",this.offset=0,this.useRotation=!1}copy(e){return super.copy(e),this.floorLocation=e.floorLocation,this.offset=e.offset,this.useRotation=e.useRotation,this}update(e){if(super.update(e),this.mute)return;const t=e.position;an.copy(this.target.position);const n=this.target.scale,r=this.offset;if(this.useRotation){let a;switch(ar.copy(zre[this.floorLocation]),ar.applyQuaternion(this.target.quaternion),this.floorLocation){case"X":an.x+=r*n.x,Sr.subVectors(t,an),a=ar.dot(Sr),ar.multiplyScalar(a),br.subVectors(Sr,ar).add(an),br.x>t.x?t.copy(br):t.x=Math.max(t.x,an.x);break;case"Y":an.y+=r*n.y,Sr.subVectors(t,an),a=ar.dot(Sr),ar.multiplyScalar(a),br.subVectors(Sr,ar).add(an),br.y>t.y?t.copy(br):t.y=Math.max(t.y,an.y);break;case"Z":an.z+=r*n.z,Sr.subVectors(t,an),a=ar.dot(Sr),ar.multiplyScalar(a),br.subVectors(Sr,ar).add(an),br.z>t.z?t.copy(br):t.z=Math.max(t.z,an.z);break;case"-X":an.x+=r*n.x,Sr.subVectors(t,an),a=ar.dot(Sr),ar.multiplyScalar(a),br.subVectors(Sr,ar).add(an),br.x<t.x?t.copy(br):t.x=Math.min(t.x,an.x);break;case"-Y":an.y+=r*n.y,Sr.subVectors(t,an),a=ar.dot(Sr),ar.multiplyScalar(a),br.subVectors(Sr,ar).add(an),br.y<t.y?t.copy(br):t.y=Math.min(t.y,an.y);break;case"-Z":an.z+=r*n.z,Sr.subVectors(t,an),a=ar.dot(Sr),ar.multiplyScalar(a),br.subVectors(Sr,ar).add(an),br.z<t.z?t.copy(br):t.z=Math.min(t.z,an.z)}}else switch(this.floorLocation){case"X":t.x=Math.max(t.x,an.x+r);break;case"Y":t.y=Math.max(t.y,an.y+r);break;case"Z":t.z=Math.max(t.z,an.z+r);break;case"-X":t.x=Math.min(t.x,an.x+r);break;case"-Y":t.y=Math.min(t.y,an.y+r);break;case"-Z":t.z=Math.min(t.z,an.z+r)}}}const px=new B,Vre=new Ct,kre=new B,mT=new B;class lP extends ao{constructor(e){super(e),this.isLimitDistanceConstraint=!0,this.type="LimitDistanceConstraint",this.distance=0,this.limitMode="LIMITDIST_ONSURFACE",this.useTransformLimit=!1,this.influence=1,this._objPosInit=new B,this._distInit=0,this._sfac=1,this._clampSurf=0}copy(e){return super.copy(e),this.distance=e.distance,this.limitMode=e.limitMode,this.useTransformLimit=e.useTransformLimit,this.influence=e.influence,this}update(e){super.update(e),this.mute||(this._sfac=1,this._clampSurf=0,this.target.matrixWorld.decompose(px,Vre,kre),this._updateObjMatrixWorld(e),e.getWorldPositionNU(this._objPosInit),mT.subVectors(this._objPosInit,px),this._distInit=mT.length(),this.limitMode=="LIMITDIST_INSIDE"?this._distInit>=this.distance&&(this._clampSurf=1,this._distInit!=0&&(this._sfac=this.distance/this._distInit)):this.limitMode=="LIMITDIST_OUTSIDE"?this._distInit<=this.distance&&(this._clampSurf=1,this._distInit!=0&&(this._sfac=this.distance/this._distInit)):this.limitMode=="LIMITDIST_ONSURFACE"&&this._distInit-this.distance!=0&&(this._clampSurf=1,this._distInit!=0&&(this._sfac=this.distance/this._distInit)),this._clampSurf&&(e.position.lerpVectors(this._objPosInit,px,(1-this._sfac)*this.influence),e.parent&&e.parent.worldToLocal(e.position)))}}const Zs=new B,T0=new B,Fu=new B,mx=new Ve;class cP extends ao{constructor(e=null){super(e),this.isLimitLocationConstraint=!0,this.type="LimitLocationConstraint",this.space=2,this.min=new B().setScalar(-1/0),this.max=new B().setScalar(1/0)}copy(e){return super.copy(e),this.min.copy(e.min),this.max.copy(e.max),this.space=e.space,this}update(e){if(super.update(e),!this.mute)switch(this.space){case 0:this._updateObjMatrixWorld(e),Zs.setFromMatrixPosition(e.matrixWorld),Zs.clamp(this.min,this.max),Fu.copy(Zs),e.parent!==null&&Fu.applyMatrix4(mx.copy(e.parent.matrixWorld).invert()),e.position.copy(Fu);break;case 1:this.target!==null&&(this._updateObjMatrixWorld(e),this._updateObjMatrixWorld(this.target),Zs.setFromMatrixPosition(e.matrixWorld),T0.copy(Zs),T0.applyMatrix4(mx.copy(this.target.matrixWorld).invert()),T0.clamp(this.min,this.max),Zs.copy(T0),Zs.applyMatrix4(this.target.matrixWorld),Fu.copy(Zs),e.parent!==null&&Fu.applyMatrix4(mx.copy(e.parent.matrixWorld).invert()),e.position.copy(Fu));break;default:e.position.clamp(this.min,this.max)}}}const Ja=new ka;class uP extends Bd{constructor(){super(),this.isLimitRotationConstraint=!0,this.type="LimitRotationConstraint",this.axis="Y",this.min=0,this.max=2*Math.PI}copy(e){return super.copy(e),this.axis=e.axis,this.min=e.min,this.max=e.max,this}update(e){super.update(e),this.mute||(this.axis=="X"?(Ja.setFromQuaternion(e.quaternion,"XYZ"),Ja.x=this._clampAngle(Ja.x,this.min,this.max)):this.axis=="Y"?(Ja.setFromQuaternion(e.quaternion,"YZX"),Ja.y=this._clampAngle(Ja.y,this.min,this.max)):this.axis=="Z"&&(Ja.setFromQuaternion(e.quaternion,"ZXY"),Ja.z=this._clampAngle(Ja.z,this.min,this.max)),e.quaternion.setFromEuler(Ja))}_clampAngle(e,t,n){return Math.abs(n-t)<2*Math.PI&&(e=ky(e,t,n)),e}}class dP extends Bd{constructor(){super(),this.isLimitScaleConstraint=!0,this.type="LimitScaleConstraint",this.min=new B().setScalar(-1/0),this.max=new B().setScalar(1/0)}copy(e){return super.copy(e),this.min.copy(e.min),this.max.copy(e.max),this}update(e){super.update(e),this.mute||e.scale.clamp(this.min,this.max)}}const Gre=new Ct().setFromAxisAngle(new B(1,0,0),-Math.PI/2),gx=new B,gT=new B,R0=new B,I0=new B,vx=new B,_x=new _o,Qre=new B,vT=new B,_T=new Ct;class fP extends ao{constructor(e){super(e),this.isLockedTrackConstraint=!0,this.type="LockedTrackConstraint",this.trackAxis="X",this.lockAxis="Y",this.fixCameraLightRotation=!1}copy(e){return super.copy(e),this.trackAxis=e.trackAxis,this.lockAxis=e.lockAxis,this.fixCameraLightRotation=e.fixCameraLightRotation,this}update(e){if(super.update(e),this.mute||(R0.set(this.trackAxis=="X"?1:this.trackAxis=="-X"?-1:0,this.trackAxis=="Y"?1:this.trackAxis=="-Y"?-1:0,this.trackAxis=="Z"?1:this.trackAxis=="-Z"?-1:0),I0.set(this.lockAxis=="X"?1:0,this.lockAxis=="Y"?1:0,this.lockAxis=="Z"?1:0),Math.abs(R0.dot(I0))==1))return;gx.setFromMatrixPosition(e.matrixWorld),gT.setFromMatrixPosition(this.target.matrixWorld),_x.setFromNormalAndCoplanarPoint(I0,gx),_x.projectPoint(gT,vx).sub(gx);const t=Qre.crossVectors(R0,vx).dot(I0)>0?1:-1;e.setRotationFromAxisAngle(_x.normal,t*R0.angleTo(vx)),e.parent&&(e.parent.matrixWorld.decompose(vT,_T,vT),e.quaternion.premultiply(_T.invert())),this.fixCameraLightRotation&&(e.isCamera||e.isLight)&&e.quaternion.multiply(Gre)}}const AT=new B(0,1,0),Hre=new Ct().setFromAxisAngle(new B(1,0,0),-Math.PI/2),xT=new _o,yT=new B,bT=new B,ei=new B,Uu=new B,Ax=new B,ST=new Ve,CT=new B,ET=new Ct;class hP extends ao{constructor(e){super(e),this.isTrackToConstraint=!0,this.type="TrackToConstraint",this.trackAxis="X",this.upAxis="Y",this.fixCameraLightRotation=!1}copy(e){return super.copy(e),this.trackAxis=e.trackAxis,this.upAxis=e.upAxis,this.fixCameraLightRotation=e.fixCameraLightRotation,this}update(e){if(super.update(e),this.mute)return;const t=this.trackAxis[this.trackAxis.length-1],n=this.upAxis[this.upAxis.length-1],r=this.trackAxis[0]=="-",a=this.upAxis[0]=="-";if(t==n)return;yT.setFromMatrixPosition(e.matrixWorld),bT.setFromMatrixPosition(this.target.matrixWorld),ei.subVectors(bT,yT),ei.lengthSq()?ei.normalize():ei.set(0,-1,0),xT.set(ei,0),Math.abs(ei.dot(AT))!=1?xT.projectPoint(AT,Uu).normalize():Uu.set(0,0,-1),r&&ei.negate(),a&&Uu.negate();let i=t=="X"?ei:n=="X"?Uu:null,s=t=="Y"?ei:n=="Y"?Uu:null,c=t=="Z"?ei:n=="Z"?Uu:null;i?s?c||(c=Ax.crossVectors(i,s)):s=Ax.crossVectors(c,i):i=Ax.crossVectors(s,c),ST.makeBasis(i,s,c),e.setRotationFromMatrix(ST),e.parent&&(e.parent.matrixWorld.decompose(CT,ET,CT),e.quaternion.premultiply(ET.invert())),this.fixCameraLightRotation&&(e.isCamera||e.isLight)&&e.quaternion.multiply(Hre)}}class pP extends ao{constructor(e){super(e),this.isFixOrthoZoomConstraint=!0,this._orthoZoom=1}copy(e){super.copy(e),this._orthoZoom=e._orthoZoom}update(e){if(super.update(e),this.mute)return;const t=this.target;if(e.parent!==t||!t.isOrthographicCamera)return void console.error("FixOrthoZoom: object should be a direct child of the orthographic camera");const n=this._orthoZoom/t.zoom;e.position.multiplyScalar(n),e.scale.multiplyScalar(n),this._orthoZoom=t.zoom}}const MT=new B,Wre=new B,L0=new Ct,zu=new mn,aa=new Yo;class mP extends ao{constructor(e){super(e),this.isCanvasFitConstraint=!0,this.type="CanvasFitConstraint",this.edgeH="NONE",this.edgeV="NONE",this.offset=0,this.fitShape="BOX",this.xr=null}copy(e){return super.copy(e),this.edgeH=e.edgeH,this.edgeV=e.edgeV,this.offset=e.offset,this.fitShape=e.fitShape,this.xr=e.xr,this}update(e){if(super.update(e),this.mute)return;if(e.parent!==this.target)return void console.error(`CanvasFitConstraint: object ${e.name} should be a direct child of the camera`);let t,n,r,a;t=this.xr&&this.xr.enabled&&this.xr.isPresenting?this.xr.getCamera():this.target;const i=this.edgeH=="LEFT"?-1:this.edgeH=="RIGHT"?1:0,s=this.edgeV=="BOTTOM"?-1:this.edgeV=="TOP"?1:0;t.isPerspectiveCamera&&(r=cp(t.fov/2),n=Math.atan(t.aspect*Math.tan(r)),this.edgeH=="LEFT"&&(n*=i),this.edgeV=="BOTTOM"&&(r*=s),a=Math.abs(e.position.z)),e.geometry;let c=0,u=0,h=0,f=0;if(e.matrix.compose(e.position,e.quaternion,e.scale),this.fitShape=="BOX")if(zu.makeEmpty(),e.resolveMultiMaterial().forEach(function(m){m.geometry&&(m.geometry.boundingBox==null&&m.geometry.computeBoundingBox(),zu.union(m.geometry.boundingBox))}),zu.isEmpty())c=-i*this.offset,u=-s*this.offset;else{zu.applyMatrix4(e.matrix);const m=zu.getCenter(MT).sub(e.position),g=zu.getSize(Wre).addScalar(2*this.offset);c=-(.5*g.x*i+m.x),u=-(.5*g.y*s+m.y),h=g.x,f=g.y}else if(this.fitShape=="SPHERE")if(aa.makeEmpty(),e.resolveMultiMaterial().forEach(function(m){m.geometry&&(m.geometry.boundingSphere===null&&m.geometry.computeBoundingSphere(),aa.isEmpty()?aa.copy(m.geometry.boundingSphere):aa.union(m.geometry.boundingSphere))}),aa.isEmpty())c=-i*this.offset,u=-s*this.offset;else{aa.applyMatrix4(e.matrix),aa.radius+=this.offset;const m=MT.copy(aa.center).sub(e.position);c=-(aa.radius*i+m.x),u=-(aa.radius*s+m.y),t.isPerspectiveCamera&&(c/=Math.cos(n),u/=Math.cos(r)),h=2*aa.radius,f=2*aa.radius}else c=-i*this.offset,u=-s*this.offset;this.edgeH=="STRETCH"?(e.position.x=c,h!==0&&(e.scale.applyQuaternion(L0.copy(e.quaternion)),t.isPerspectiveCamera?e.scale.x*=2*a*Math.tan(n)/h:e.scale.x*=(t.right-t.left)/t.zoom/h,e.scale.applyQuaternion(L0.copy(e.quaternion).invert()))):this.edgeH!=="NONE"&&(t.isPerspectiveCamera?e.position.x=a*Math.tan(n)+c:e.position.x=(i<0?t.left:t.right)/t.zoom+c),this.edgeV=="STRETCH"?(e.position.y=u,f!==0&&(e.scale.applyQuaternion(L0.copy(e.quaternion)),t.isPerspectiveCamera?e.scale.y*=2*a*Math.tan(r)/f:e.scale.y*=(t.top-t.bottom)/t.zoom/f,e.scale.applyQuaternion(L0.copy(e.quaternion).invert()))):this.edgeV!=="NONE"&&(t.isPerspectiveCamera?e.position.y=a*Math.tan(r)+u:e.position.y=(s<0?t.bottom:t.top)/t.zoom+u)}}class gP extends Bd{constructor(){super(),this.isCanvasBreakpointsConstraint=!0,this.type="CanvasBreakpointsConstraint",this.minWidth=0,this.maxWidth=1/0,this.minHeight=0,this.maxHeight=1/0,this.orientation="ALL",this.appInstance=null}copy(e){return super.copy(e),this.minWidth=e.minWidth,this.maxWidth=e.maxWidth,this.minHeight=e.minHeight,this.maxHeight=e.maxHeight,this.orientation=e.orientation,this.appInstance=e.appInstance,this}update(e){if(super.update(e),this.mute||!this.appInstance)return;const t=this.appInstance.getWidth(),n=this.appInstance.getHeight();let r;switch(this.orientation){case"ALL":r=!0;break;case"LANDSCAPE":r=t/n>=1;break;case"PORTRAIT":r=t/n<1}if(this.appInstance.getCamera()!==e||t>=this.minWidth&&t<=this.maxWidth&&n>=this.minHeight&&n<=this.maxHeight&&r)t>=this.minWidth&&t<=this.maxWidth&&n>=this.minHeight&&n<=this.maxHeight&&r?e.traverse(a=>{a.internVisible=!0}):e.traverse(a=>{a.internVisible=!1});else{let a=this.findAlternativeCamera(e,this.appInstance.scene,t,n);a&&this.appInstance.setCamera(a)}}findAlternativeCamera(e,t,n,r){let a,i,s=!1;return e&&t.traverse(function(c){if(!s&&c.isCamera&&c!=e)for(let u=0;u<c.constraints.length;u++){let h=c.constraints[u];if(h.isCanvasBreakpointsConstraint){switch(h.orientation){case"ALL":a=!0;break;case"LANDSCAPE":a=n/r>=1;break;case"PORTRAIT":a=n/r<1}n>=h.minWidth&&n<=h.maxWidth&&r>=h.minHeight&&r<=h.maxHeight&&a&&(i?(console.error("CanvasBreakpointsConstraint: two or more alternative cameras"),s=!0):i=c)}}}),i}}const vP=function(o){return!!o&&!!o.dtype&&new RegExp("function View[0-9]+d(:?"+o.dtype+")+").test(String(o.constructor))},Sb=function(o){return!!o&&o.data!==void 0&&Array.isArray(o.shape)&&o.offset!==void 0&&o.stride!==void 0};function Nr(o){return Array.isArray(o)||ArrayBuffer.isView(o)}function un(o){if(o){if(vP(o)||Sb(o))return o.dtype==="generic"?un.GENERIC_NDARRAY:un.NDARRAY;if(Nr(o))return un.ARRAY_OF_ARRAYS;throw new Error("Unhandled data type. Got type: "+typeof o)}}function Yre(o){return o[0].toUpperCase()+o.slice(1)}un.ARRAY_OF_ARRAYS="Arr",un.NDARRAY="Nd",un.GENERIC_NDARRAY="GenNd",un.PACKED="PackArr";const jre=function(o,e,t,n,r,a){var i,s=[],c=!1;for(i=0;i<o.splineDimension;i++){var u=Nr(o.knots)&&Nr(o.knots[i]);u&&(c=!0),s.push("Deg"+o.degree[i]+(u?"":"Uniform")+Yre(o.boundary[i]))}var h=[[c?"NU":"",o.weights?"RBS":"BS"].join("")+o.dimension+"D",s.join("_")];return n&&h.push(n+"Pts"),r&&h.push(r+"Wts"),a&&h.push(a+"Kts"),e&&h.push("debug"),t&&h.push("chk"),h.join("_")},vo=function(o,e){return function(t,n){t===void 0||Array.isArray(t)||(t=[t]);for(var r=[],a=0;a<t.length;a++)r.push(vo.sum(t[a]));if(n)for(t=0;t<r.length;t++)n[t]!==void 0&&(r[t]="("+r[t]+" + "+n[t]+") % "+n[t]);return o+r.join("_")}};function xx(o){return function(e,t){e===void 0||Array.isArray(e)||(e=[e]);for(var n=[],r=0;r<e.length;r++)n.push(vo.sum(e[r]));if(t)for(e=0;e<n.length;e++)t[e]!==void 0&&(n[e]="("+n[e]+" + "+t[e]+") % "+t[e]);return o(n)}}function yx(o,e){var t;if(e)switch(un(e)){case un.ARRAY_OF_ARRAYS:return xx(function(n){return o+"["+n.join("][")+"]"});case un.GENERIC_NDARRAY:return xx(function(n){return o+".get("+n.join(",")+")"});case un.NDARRAY:return xx(function(n){var r=[o+"Offset"];for(t=0;t<n.length;t++)r.push(o+"Stride"+t+" * ("+n[t]+")");return o+"["+r.join(" + ")+"]"});case un.PACKED:default:return}}vo.sum=function(o){return(o=(o=Array.isArray(o)?o:[o]).filter(function(e){return e!==void 0&&e!==0})).length===0&&o.push(0),o.join(" + ")};const Xre=function(o){var e,t={};return(e=yx("x",o.points))&&(t.point=e),(e=yx("w",o.weights))&&(t.weight=e),(e=yx("k",o.knots))&&(t.knot=e),t};var Ji=[],wT=[];const qre=function(o,e,t){if(e!==1)throw new Error("Numerical derivative not implemented for order n = "+e+".");var n,r=arguments[this.splineDimension+3]===void 0?1e-4:arguments[this.splineDimension+3];for(Ji.length=this.splineDimension,n=0;n<this.splineDimension;n++)Ji[n+1]=arguments[n+3];var a,i,s,c=this.domain,u=c[t][0],h=c[t][1],f=Ji[t+1],m=(h-u)*r;for(this.boundary[t]==="closed"?(a=u+(f-u-m+(s=h-u))%s,i=u+(f-u+m+s)%s,m*=2):(a=Math.min(h,Math.max(u,f-m)),m=(i=Math.min(h,Math.max(u,f+m)))-a),Ji[t+1]=a,Ji[0]=wT,this.evaluate.apply(null,Ji),Ji[t+1]=i,Ji[0]=o,this.evaluate.apply(null,Ji),n=0;n<this.dimension;n++)o[n]=(o[n]-wT[n])/m;return o},dh=function(o,e){for(var t=1,n=0,r=[];n<o.length;n++)t*=Array.isArray(o[n])?o[n][1]-o[n][0]:o[n],r[n]=Array.isArray(o[n])?o[n][0]:0;for(var a=0;a<t;a++)for(e(r.slice()),n=o.length-1;n>=0;n--){if(r[n]!==(Array.isArray(o[n])?o[n][1]:o[n])-1){r[n]++;break}r[n]=Array.isArray(o[n])?o[n][0]:0}},Ch=function(o,e,t,n){var r,a=[];switch(un(n)){case un.NDARRAY:for(a.push("  const "+e+" = "+t+".data;"),a.push("  const "+e+"Offset = "+t+".offset;"),r=0;r<n.dimension;r++)a.push("  const "+e+"Stride"+r+" = "+t+".stride["+r+"];");break;case un.ARRAY_OF_ARRAYS:a.push("  const "+e+" = "+t+";")}return a.join(`
`)},Cb=function(o,e,t){if(o){if(Sb(o))return e+".shape["+t+"]";for(var n=e,r=0;r<t;r++)n+="[0]";return n+".length"}return"this.size["+t+"]"};var TT={},RT={};const IT=function(o,e,t,n,r,a,i){var s,c,u,h,f,m,g=e.splineDimension,A=e.points,_=e.degree,x=e.weights,C=x!==void 0,b=e.knots,y=e.dimension,M=e.boundary;if(i!=null){Array.isArray(i)||(i=[i]);var R=0;for(s=0;s<g;s++)i[s]===void 0&&(i[s]=0),R+=i[s];if(C&&R>1)throw new Error("Analytical derivative not implemented for rational b-splines with order n = "+R+".")}a&&(o="Basis"+o),i&&(o="Der"+i.join("_")+"_"+o);var T=TT[o];if(n)var w=typeof n=="function"?n:console.log;if(T)return n&&w(RT[o]),T.bind(e);var D=[],z="evaluate"+o,F=t.point;a&&(F=function(Y,P){for(var Q=[],I=0;I<Y.length;I++){for(var N=Y[I],se=[],ce=0;ce<N.length;ce++)N[ce]!==0&&se.push(N[ce]);N=se.join(" + "),P[I]&&(N="("+N+" + "+P[I]+") % "+P[I]),Q.push(N+" === "+K(I))}return"(("+Q.join(" && ")+") ? 1 : 0)"});var O=t.weight,q=t.knot,ne=vo("k"),$=vo("x"),he=vo("w"),K=vo("i"),oe=vo("t"),ie=n?"domain":"d",L=vo(n?"size":"s"),U=vo(n?"knotIndex":"j"),k=!0;for(f=0;f<g;f++)Nr(b)&&Nr(b[f])&&(k=!1);function J(Y){D.push("  "+(Y||""))}function de(Y){n&&J(Y)}if(a)var te=[];var le=[];for(s=0;s<g;s++)a&&te.push(K([s])),le.push(oe([s]));for(D.push("function "+z+" ("+(a?"":"out, ")+le.join(", ")+(a?", "+te.join(", "):"")+") {"),J("let h, m, a, b;"),r&&(J("const "+ie+" = this.domain;"),J("for (let i = 0; i < this.splineDimension; i++) {"),J("  a = arguments[i + 1];"),J("  if (a < "+ie+"[i][0] || a > "+ie+"[i][1] || a === undefined || isNaN(a)) {"),J("    throw new Error('Invalid Spline parameter in dimension '+i+'. Valid domain is ['+"+ie+"[i][0]+', '+"+ie+"[i][1]+']. but got t'+i+' = '+arguments[i + 1]+'.');"),J("  }"),J("}")),f=0;f<g;f++)J("let "+L(f)+" = "+Cb(A,"this.points",f)+";");function V(Y,P,Q){return"("+Y+") ? ("+P+") : ("+Q+")"}D.push(Ch(0,"x","this.points",A)),C&&D.push(Ch(0,"w","this.weights",x)),k||D.push(Ch(0,"k","this.knots",b));var G=[];for(f=0;f<g;f++)switch(un(b)){case un.NDARRAY:G[f]=!0;break;case un.ARRAY_OF_ARRAYS:G[f]=Nr(b[f])}for(f=0;f<g;f++)if(G[f])for(de(`
  // Bisect to locate the knot interval in dimension `+f+`
`),J("let "+U(f)+" = 0;"),J("h = "+L(f)+";"),J("while(h > "+U(f)+" + 1) {"),J("  m = 0.5 * (h + "+U(f)+") | 0;"),J("  if ("+q([f,"m"])+" > "+oe(f)+") h = m;"),J("  else "+U(f)+" = m;"),J("}"),de(`
  // Fetch knots for dimension `+f+`
`),s=1-_[f];s<=_[f];s++)M[f]==="closed"?J(s<0?"let "+ne([f,s+_[f]-1])+" = "+V(U(f)+" < "+-s,q([f,0])+" + "+q([f,[L(f),U(f),s]])+" - "+q([f,[L(f)]]),q([f,[U(f),s]]))+";":s>0?"let "+ne([f,s+_[f]-1])+" = "+V(U(f)+" + "+s+" > "+L(f),q([f,L(f)])+" + "+q([f,s+" + "+U(f)+" - "+L(f)])+" - "+q([f,0]),q([f,[U(f),s]]))+";":"let "+ne([f,s+_[f]-1])+" = "+q([f,[U(f),s]])+";"):J("let "+ne([f,s+_[f]-1])+" = "+q([f,[U(f),s]])+";");else{for(de(`
  // Directly compute knot interval for dimension `+f+`
`),M[f]==="closed"?J(U(f)+" = ("+oe(f)+" | 0) % "+L(f)+";"):(J(U(f)+" = ("+oe(f)+" | 0);"),J("if ("+U(f)+" < "+_[f]+") "+U(f)+" = "+_[f]+";"),J("if ("+U(f)+" > "+L(f)+" - 1) "+U(f)+" = "+L(f)+" - 1;")),de(`
  // Compute and clamp knots for dimension `+f+`
`),s=1-_[f];s<=_[f];s++)J("let "+(m=ne([f,s+_[f]-1]))+" = "+U(f)+" + "+s+";");if(M[f]==="clamped")for(s=1-_[f];s<=_[f];s++)m=ne([f,s+_[f]-1]),s<0&&J("if ("+m+" < "+_[f]+") "+m+" = "+_[f]+";"),s>0&&J("if ("+m+" > "+L(f)+") "+m+" = "+L(f)+";");M[f]==="closed"&&(de(`
  // Wrap the B-Spline parameter for closed boundary`),J(oe(f)+" %= "+L(f)+";"))}for(f=0,u=[];f<g;f++)u[f]=_[f]+1;for(C&&(de(`
  // Fetch weights
`),dh(u,function(Y){for(var P=[],Q=[],I=0;I<g;I++)P[I]=[U(I),Y[I]-_[I]],M[I]==="closed"&&Y[I]-_[I]<0&&(Q[I]=L(I));J("let "+he(Y)+" = "+O(P,Q)+";")})),n&&J(C?`
  // Fetch points and project into homogeneous (weighted) coordinates
`:`
  // Fetch points
`),dh(u,function(Y){for(var P=[],Q=[],I=0;I<g;I++)P[I]=[U(I),Y[I]-_[I]],M[I]==="closed"&&Y[I]-_[I]<0&&(Q[I]=L(I));if(a)J(C?"let "+$(Y)+" = "+F(P,Q)+" * "+he(Y)+";":"let "+$(Y)+" = "+F(P,Q)+";");else for(I=0;I<y;I++){var N=Y.concat(I);P[g]=I,J(C?"let "+$(N)+" = "+F(P,Q)+" * "+he(Y)+";":"let "+$(N)+" = "+F(P,Q)+";")}}),de(`
`),de("// Perform De Boor's algorithm"),f=u.length-1;f>=0;f--)for(u[f]=[_[f],_[f]+1],s=0;s<_[f];s++)for(de(`
  // Degree `+_[f]+" evaluation in dimension "+f+", step "+(s+1)+`
`),c=_[f];c>s;c--){var ee=i&&_[f]-s-i[f]<=0;ee?(J("m = 1 / ("+ne([f,c-s+_[f]-1])+" - "+ne([f,c-1])+");"),C&&(J("a = ("+oe(f)+" - "+ne([f,c-1])+") * m;"),J("b = 1 - a;"))):(J("a = ("+oe(f)+" - "+ne([f,c-1])+") / ("+ne([f,c-s+_[f]-1])+" - "+ne([f,c-1])+");"),J("b = 1 - a;")),C&&dh(u,function(Y){var P=Y.slice(),Q=Y.slice();P[f]=c,Q[f]=c-1,ee&&C&&J("h = "+he(P)+";"),J(he(P)+" = b * "+he(Q)+" + a * "+he(P)+";")}),dh(u,function(Y){var P,Q,I,N=Y.slice(),se=Y.slice();if(N[f]=c,se[f]=c-1,ee){var ce=s+1;if(a)P=C?"h * "+he(se)+" / "+he(N)+" * ":"",Q=$(N)+(C?" / h":""),I=$(se)+(C?" / "+he(se):""),J($(N)+" = "+ce+" * "+P+"("+Q+" - "+I+") * m;");else{var fe=N.slice(),ve=se.slice();for(h=0;h<y;h++)fe[g]=ve[g]=h,P=C?"h * "+he(se)+" / "+he(N)+" * ":"",Q=$(fe)+(C?" / h":""),I=$(ve)+(C?" / "+he(se):""),J($(fe)+" = "+ce+" * "+P+"("+Q+" - "+I+") * m;")}}else if(a)J($(N)+" = b * "+$(se)+" + a * "+$(N)+";");else for(h=0;h<y;h++)N[g]=se[g]=h,J($(N)+" = b * "+$(se)+" + a * "+$(N)+";")}),de(`
`)}if(n&&J(C?`
  // Project back from homogeneous coordinates and return final output
`:`
  // Return final output
`),a)J(C?"return "+$(_)+" / "+he(_)+";":"return "+$(_)+";");else for(f=0;f<y;f++)J(C?"out["+f+"] = "+$(_.concat([f]))+" / "+he(_)+";":"out["+f+"] = "+$(_.concat([f]))+";");if(a||J("return out;"),D.push("}"),n){var X=D.join(`
`);w(X),RT[o]=X}const W=new Function([D.join(`
`),"; return ",z].join(""))();return TT[o]=W,W.bind(e)};var LT={};const Zre=function(o,e,t,n){var r,a,i,s,c,u,h,f,m=LT[o];if(m)return m.bind(e);var g=[],A="transform"+o;g.push("function "+A+"(m) {"),g.push("let i, w;"),g.push(Ch(0,"x","this.points",e.points));var _=vo(n?"size":"s");for(r=0;r<e.splineDimension;r++)g.push("let "+_(r)+" = "+Cb(e.points,"this.points",r)+";");for(s=[],r=0;r<e.splineDimension;r++)i="i"+r,s.push(i),g.push("for ("+i+" = "+_(r)+"- 1; "+i+" >= 0; "+i+"--) {");for(r=0;r<e.dimension;r++)g.push("x"+r+" = "+t.point(s.concat([r])));for(c=[],r=0;r<e.dimension;r++)c.push("m["+((e.dimension+1)*(r+1)-1)+"] * x"+r);for(c.push("m["+((e.dimension+1)*(e.dimension+1)-1)+"]"),g.push("const w = ("+c.join(" + ")+") || 1.0;"),r=0;r<e.dimension;r++){for(c=[],u=e.dimension,a=0;a<u;a++)c.push("m["+(a*(u+1)+r)+"] * x"+a);c.push("m["+(a*(u+1)+r)+"]"),f=t.point(s.concat([r])),h="("+c.join(" + ")+") / w",g.push(f+" = "+h+";")}for(r=e.splineDimension-1;r>=0;r--)g.push("}");g.push("return this;"),g.push("}");const x=new Function([g.join(`
`),"; return ",A].join(""))();return n&&console.log(g.join(`
`)),LT[o]=x,x.bind(e)};var BT={};const Kre=function(o,e,t,n,r){var a=BT[o];if(a)return a.bind(e);var i,s,c,u=e.degree,h=e.knots,f=e.splineDimension,m=e.boundary,g=[],A="support"+o,_=t.knot,x=vo("t"),C=n?"domain":"d",b=vo(n?"size":"s"),y=vo(n?"knotIndex":"i"),M=!0;for(c=0;c<f;c++)Nr(h)&&Nr(h[c])&&(M=!1);function R(O){g.push("  "+(O||""))}var T=[];for(i=0;i<f;i++)T.push(x([i]));g.push("function "+A+" (out, "+T.join(", ")+") {");var w=0;function D(O,q){R(q===void 0?"out["+w+++"] = "+O.join(" + ")+";":"out["+w+++"] = ("+O.join(" + ")+" + "+q+") % "+q+";")}for(R("let h, m;"),R("let c = 0;"),r&&(R("const "+C+" = this.domain;"),R("for (let i = 0; i < this.splineDimension; i++) {"),R("  a = arguments[i + 1];"),R("  if (a < "+C+"[i][0] || a > "+C+"[i][1] || a === undefined || isNaN(a)) {"),R("    throw new Error('Invalid Spline parameter in dimension '+i+'. Valid domain is ['+"+C+"[i][0]+', '+"+C+"[i][1]+']. but got t'+i+' = '+arguments[i + 1]+'.');"),R("  }"),R("}")),c=0;c<f;c++)R("let "+b(c)+" = "+Cb(e.points,"this.points",c)+";");M||g.push(Ch(0,"k","this.knots",h));var z=[];for(c=0;c<f;c++)switch(un(h)){case un.NDARRAY:z[c]=!0;break;case un.ARRAY_OF_ARRAYS:z[c]=Nr(h[c])}for(c=0;c<f;c++)z[c]?(R("let "+y(c)+" = 0;"),R("h = "+b(c)+";"),R("while(h > "+y(c)+" + 1) {"),R("  m = 0.5 * (h + "+y(c)+") | 0;"),R("  if ("+_([c,"m"])+" > "+x(c)+") h = m;"),R("  else "+y(c)+" = m;"),R("}")):m[c]==="closed"?R(y(c)+" = ("+x(c)+" | 0) % "+b(c)+";"):(R(y(c)+" = ("+x(c)+" | 0);"),R("if ("+y(c)+" < "+u[c]+") "+y(c)+" = "+u[c]+";"),R("if ("+y(c)+" > "+b(c)+" - 1) "+y(c)+" = "+b(c)+" - 1;"));for(c=0,s=[];c<f;c++)s[c]=u[c]+1;dh(s,function(O){for(var q=[],ne=[],$=0;$<f;$++)q[$]=[y($),O[$]-u[$]],m[$]==="closed"&&O[$]-u[$]<0&&(ne[$]=b($));for($=0;$<f;$++)D(q[$],ne[$])}),R("out.length = "+w+";"),R("return out;"),g.push("}"),n&&console.log(g.join(`
`));const F=new Function([g.join(`
`),"; return ",A].join(""))();return BT[o]=F,F.bind(e)};var B0={open:"open",closed:"closed",clamped:"clamped"};function P0(o){return o==null}function $re(o,e,t,n,r,a){var i,s;!o||Nr(o)||vP(o)?(a=a||{},this.weights=n,this.knots=t,this.degree=e,this.points=o,this.boundary=r,this.debug=a.debug,this.checkBounds=!!a.checkBounds,Object.defineProperty(this,"size",{value:a.size,writable:!0,configurable:!0})):(a=o,this.debug=o.debug,this.checkBounds=!!o.checkBounds,this.weights=o.weights,this.knots=o.knots,this.degree=o.degree,this.boundary=o.boundary,this.points=o.points,Object.defineProperty(this,"size",{value:a.size,writable:!0,configurable:!0}));var c=un(this.points),u=un(this.weights),h=un(this.knots);if(this.points)switch(c){case un.GENERIC_NDARRAY:case un.NDARRAY:Object.defineProperties(this,{splineDimension:{value:this.points.shape.length-1,writable:!1,configurable:!0},dimension:{value:this.points.shape[this.points.shape.length-1],writable:!1,configurable:!0},size:{get:function(){return this.points.shape.slice(0,this.points.shape.length-1)},set:function(){throw new Error("Cannot assign to read only property 'size'")},configurable:!0}});break;case un.ARRAY_OF_ARRAYS:var f=0,m=this.size||[];m.length=0;for(var g=this.points;Nr(g[0]);g=g[0])f++,m.push(g.length);if(f===0)throw new Error("Expected an array of points");Object.defineProperties(this,{splineDimension:{value:f,writable:!1,configurable:!0},dimension:{value:g.length,writable:!1,configurable:!0},size:{get:function(){var b=[];b.length=0;for(var y=0,M=this.points;y<this.splineDimension;y++,M=M[0])b[y]=M.length;return b},set:function(){throw new Error("Cannot assign to read only property 'size'")},configurable:!0}});break;case un.PACKED:default:throw new Error("Expected either a packed array, array of arrays, or ndarray of points")}else{if(this.size===void 0||this.size===null)throw new Error("Either points or a control hull size must be provided.");if(Nr(this.size)||Object.defineProperty(this,"size",{value:[this.size],writable:!0,configurable:!0}),this.size.length===0)throw new Error("`size` must be a number or an array of length at least one.");Object.defineProperties(this,{splineDimension:{value:this.size.length,writable:!1,configurable:!0},dimension:{value:0,writable:!1,configurable:!0}})}if(Nr(this.degree)){for(i=0;i<this.splineDimension;i++)if(P0(this.degree[i]))throw new Error("Missing degree in dimension "+(i+1))}else{var A=!P0(this.degree),_=P0(this.degree)?2:this.degree;for(this.degree=[],i=0;i<this.splineDimension;i++)if(this.size[i]<=_){if(A)throw new Error("Expected at least "+(_+1)+" points for degree "+_+" spline in dimension "+(i+1)+" but got only "+this.size[i]);this.degree[i]=this.size[i]-1}else this.degree[i]=_}if(s=typeof this.boundary!="string"?"open":this.boundary,!B0[s])throw new Error("Boundary type must be one of "+Object.keys(B0)+". Got "+s);for(this.boundary=Nr(this.boundary)?this.boundary:[],this.boundary.length=this.splineDimension,i=0;i<this.splineDimension;i++)if(this.boundary[i]=P0(this.boundary[i])?s:this.boundary[i],!B0[s])throw new Error("Boundary type must be one of "+Object.keys(B0)+". Got "+s+" for dimension "+(i+1));if(h===un.ARRAY_OF_ARRAYS)for(Nr(this.knots)&&this.knots.length>0&&!Nr(this.knots[0])&&(this.knots=[this.knots]),i=0;i<this.splineDimension;i++){if(this.size[i]<=this.degree[i])throw new Error("Expected at least "+(this.degree[i]+1)+" points in dimension "+(i+1)+" but got "+this.size[i]+".");if(Nr(this.knots[i])){if(this.boundary[i]!=="closed"&&this.knots[i].length!==this.degree[i]+this.size[i]+1)throw new Error("Expected "+(this.degree[i]+this.size[i]+1)+" knots in dimension "+(i+1)+" but got "+this.knots[i].length+".");if(this.boundary[i]==="closed"&&this.knots[i].length!==this.size[i]+1&&this.knots[i].length!==this.size[i]+this.degree[i]+1)throw new Error("Expected "+(this.size[i]+1)+" knots for closed spline in dimension "+(i+1)+" but got "+this.knots[i].length+".")}}var x=jre(this,this.debug,this.checkBounds,c,u,h);if(x!==this.__cacheKey){this.__cacheKey=x;var C=Xre(this);this.evaluate=IT(this.__cacheKey,this,C,this.debug,this.checkBounds,!1),this.transform=Zre(this.__cacheKey,this,C,this.debug),this.support=Kre(this.__cacheKey,this,C,this.debug,this.checkBounds),this.evaluator=function(b,y){return IT(this.__cacheKey,this,C,this.debug,this.checkBounds,y,b)}}return this.numericalDerivative=qre.bind(this),this}function Jre(){var o,e=[],t=this.points;t?Sb(t)&&(o=t.shape):o=this.size;for(var n=0;n<this.splineDimension;n++){var r=o?o[n]:t.length,a=this.degree[n],i=this.boundary[n]==="closed";if(this.knots&&this.knots[n]){var s=this.knots[n];e[n]=[s[i?0:a],s[r]]}else e[n]=[i?0:a,r];t&&(t=t[0])}return e}function N0(o,e,t,n,r,a){const i=function(c,u,h,f,m,g){return s(c,u,h,f,m,g),i},s=$re.bind(i);return Object.defineProperty(i,"domain",{get:Jre}),s(o,e,t,n,r,a),i}const eoe=new Ct().setFromAxisAngle(new B(1,0,0),-Math.PI/2),ic={X:new B(1,0,0),Y:new B(0,1,0),Z:new B(0,0,1),"-X":new B(-1,0,0),"-Y":new B(0,-1,0),"-Z":new B(0,0,-1)},toe=new B(0,1,0),PT=new B(0,0,1),bx={DEFAULT:0,MATRIX:1},D0={ONLY_CONSTRAINT:0,CONSTRAINT_FIRST:1},Xf=new B,ti=new Ct,NT=new B,O0=new B,DT=new B,noe=new B,Vu=new B,ku=new B,roe=new B,qf=new Ve,F0=new Ct,mo=[0,0,0];class _P extends Bd{constructor(){super(),this.isMotionPathConstraint=!0,this.type="MotionPathConstraint",this.curve=null,this.firstDerivativeEvaluator=null,this.secondDerivativeEvaluatorForNonUniformBSplines=null,this.derivativeEvaluatorForWeights0=null,this.derivativeEvaluatorForWeights1=null,this.derivativeEvaluatorForWeights2=null,this.degree=3,this.cvs=[],this.knots=[],this.weights=[],this.value=0,this.follow=!0,this.frontAxis="Z",this.upAxis="Y",this.worldUpVector=new B(0,1,0),this.useChordLength=!1,this.chordsNum=0,this.chordLengths=[],this.bank=!1,this.bankScale=1,this.bankLimit=1/0,this.useFixedLocation=!1,this.fixedValue=0,this.usePointsTilt=!1,this.pointsTilt=[],this.pointsTiltEvaluator=null,this.offsetValue=0,this.useClampValue=!1,this.useCyclic=!1,this.useObjOffset=!1,this.useRelative=!1,this.usePosOffset=!0,this.objOffsetMode=bx.DEFAULT,this.objOffsetRotMode=D0.ONLY_CONSTRAINT,this.influence=1,this.fixCameraLightRotation=!1,this._firstIteration=!0,this._objMatrixWorldInit=new Ve,this._objPosWorldInit=new B,this._objRotWorldInit=new Ct}copy(e){super.copy(e),this.degree=e.degree,this.cvs=[];for(let t=0;t<e.cvs.length;++t)this.cvs.push(e.cvs[t]);this.knots=[];for(let t=0;t<e.knots.length;++t)this.knots.push(e.knots[t]);this.weights=[];for(let t=0;t<e.weights.length;++t)this.weights.push(e.weights[t]);this.value=e.value,this.follow=e.follow,this.frontAxis=e.frontAxis,this.upAxis=e.upAxis,this.worldUpVector.copy(e.worldUpVector),this.useChordLength=e.useChordLength,this.chordsNum=e.chordsNum,this.bank=e.bank,this.bankScale=e.bankScale,this.bankLimit=e.bankLimit,this.useFixedLocation=e.useFixedLocation,this.fixedValue=e.fixedValue,this.usePointsTilt=e.usePointsTilt,this.pointsTilt=[];for(let t=0;t<e.pointsTilt.length;++t)this.pointsTilt.push(e.pointsTilt[t]);return this.offsetValue=e.offsetValue,this.useClampValue=e.useClampValue,this.useCyclic=e.useCyclic,this.useObjOffset=e.useObjOffset,this.useRelative=e.useRelative,this.usePosOffset=e.usePosOffset,this.objOffsetMode=e.objOffsetMode,this.objOffsetRotMode=e.objOffsetRotMode,this.influence=e.influence,this.fixCameraLightRotation=e.fixCameraLightRotation,this._firstIteration=!0,this}init(){const e=[],t=this.cvs;for(let i=0;i<t.length;i+=3)e.push([t[i],t[i+1],t[i+2]]);this.curve=N0({points:e,knots:this.knots,weights:this.weights,degree:this.degree}),this.firstDerivativeEvaluator=this.curve.evaluator(1);let n=N0({points:e,knots:this.knots,degree:this.degree});this.secondDerivativeEvaluatorForNonUniformBSplines=n.evaluator(2);const r=[];for(let i=0;i<this.weights.length;++i)r.push([this.weights[i]]);let a=N0({points:r,knots:this.knots,degree:this.degree});if(this.derivativeEvaluatorForWeights0=a.evaluator(0),this.derivativeEvaluatorForWeights1=a.evaluator(1),this.derivativeEvaluatorForWeights2=a.evaluator(2),this.usePointsTilt){const i=[];for(let c=0;c<this.pointsTilt.length;++c)i.push([this.pointsTilt[c]]);const s=N0({points:i,knots:this.knots,weights:this.weights,degree:this.degree});this.pointsTiltEvaluator=s.evaluator(0)}else this.pointsTiltEvaluator=null;if(this.useChordLength)if(this.chordLengths=[],this.chordsNum<=0){let i=this.degree==1?1:32;this._calcChordLengths(this.chordLengths,this.cvs.length/3*i)}else this._calcChordLengths(this.chordLengths,this.chordsNum)}update(e){if(super.update(e),this.mute)return;this._firstIteration&&(this._updateObjMatrixWorld(e),e.matrixWorld.decompose(this._objPosWorldInit,this._objRotWorldInit,NT),this._objMatrixWorldInit.copy(e.matrixWorld),this.useRelative&&(this._calcPosition(Xf,0),this._objPosWorldInit.sub(Xf),this._objMatrixWorldInit.setPosition(this._objPosWorldInit)),this.usePosOffset||(this._objPosWorldInit.set(0,0,0),this._objMatrixWorldInit.setPosition(this._objPosWorldInit)),this._firstIteration=!1);let t=this.useFixedLocation?this.fixedValue:this.value+this.offsetValue;this.useCyclic?t-=Math.floor(t):t=this.useClampValue?Ft(t,0,1):Math.max(0,t),this.useChordLength&&(t=this._convertParamToChordLength(t,this.chordLengths));const n=this.curve.domain,r=t*(n[0][1]-n[0][0])+n[0][0];if(this._calcPosition(e.position,r),!this.follow&&this.useObjOffset&&(O0.addVectors(e.position,this._objPosWorldInit),e.position.lerpVectors(this._objPosWorldInit,O0,this.influence)),this.follow&&Math.abs(ic[this.frontAxis].dot(ic[this.upAxis]))!=1){const a=this._calcTangent(O0,r),i=DT.copy(a).normalize();if(this._calcCurveRotMat(qf,i,this.worldUpVector),this._calcFrontAndUpVecsRotQuat(ti,ic[this.frontAxis],ic[this.upAxis]),e.quaternion.setFromRotationMatrix(qf).multiply(ti),this.bank){const s=this._calcSecondDerivative(DT,r,e.position,a),c=this._calcCurvature(a,s),u=noe.copy(ic[this.upAxis]).applyQuaternion(e.quaternion);let h=this._calcBankAngle(c,a,s,u);h=this._limitAngle(h*this.bankScale,this.bankLimit),ti.setFromAxisAngle(ic[this.frontAxis],h),e.quaternion.multiply(ti)}else if(this.usePointsTilt){this.pointsTiltEvaluator(mo,r);let s=mo[0];ti.setFromAxisAngle(ic[this.frontAxis],s),e.quaternion.multiply(ti)}if(this.useObjOffset){if(this.objOffsetMode==bx.MATRIX){const s=O0.setScalar(1);qf.compose(e.position,e.quaternion,s),this.objOffsetRotMode==D0.CONSTRAINT_FIRST&&qf.multiply(this._objMatrixWorldInit),qf.decompose(Xf,ti,NT)}else this.objOffsetMode==bx.DEFAULT&&(Xf.addVectors(e.position,this._objPosWorldInit),this.objOffsetRotMode==D0.ONLY_CONSTRAINT?ti.copy(e.quaternion):this.objOffsetRotMode==D0.CONSTRAINT_FIRST&&ti.multiplyQuaternions(e.quaternion,this._objRotWorldInit));e.position.lerpVectors(this._objPosWorldInit,Xf,this.influence),e.quaternion.slerpQuaternions(this._objRotWorldInit,ti,this.influence)}this.fixCameraLightRotation&&(e.isCamera||e.isLight)&&e.quaternion.multiply(eoe)}}_calcPosition(e,t){return this.curve.evaluate(mo,t),e.fromArray(mo)}_calcTangent(e,t){return this.firstDerivativeEvaluator(mo,t),e.fromArray(mo)}_calcCurveRotMat(e,t,n){const r=Vu.copy(n),a=ku.crossVectors(r,t).normalize();return r.crossVectors(t,a),e.makeBasis(a,r,t),e}_calcFrontAndUpVecsRotQuat(e,t,n){e.setFromUnitVectors(t,PT);const r=Vu.copy(toe),a=ku.copy(n).applyQuaternion(e),i=a.dot(r);if(Math.abs(i)!=1){const s=roe.crossVectors(a,r).dot(PT)>0?1:-1;F0.setFromAxisAngle(t,a.angleTo(r)*s),e.multiply(F0)}else i<0&&(F0.setFromAxisAngle(t,Math.PI),e.multiply(F0));return e}_calcBankAngle(e,t,n,r){const a=Vu.copy(t).add(n).normalize();return e*(ku.crossVectors(a,t).normalize().dot(r)>0?1:-1)}_calcCurvature(e,t){return Vu.crossVectors(e,t).length()/Math.pow(e.length(),3)}_calcSecondDerivative(e,t,n,r){this.secondDerivativeEvaluatorForNonUniformBSplines(mo,t);const a=Vu.fromArray(mo);this.derivativeEvaluatorForWeights1(mo,t);const i=mo[0];this.derivativeEvaluatorForWeights2(mo,t);const s=mo[0];this.derivativeEvaluatorForWeights0(mo,t);const c=mo[0];return e.copy(a).sub(ku.copy(r).multiplyScalar(2*i)),e.sub(ku.copy(n).multiplyScalar(s)),e.divideScalar(c),e}_limitAngle(e,t){return e>0?Math.min(e,t):Math.max(e,-t)}_calcChordLengths(e,t){let n=1/Math.max(1,t-1),r=0,a=0;const i=this.curve.domain;let s=i[0][0],c=i[0][1]-i[0][0];const u=Vu,h=ku;this._calcPosition(u,s);for(let f=0;f<t;++f)this._calcPosition(h,r*c+s),a+=u.subVectors(h,u).length(),e.push(a),u.copy(h),r+=n;return e}_convertParamToChordLength(e,t){if(e<=0)return 0;if(e>=1)return 1;let n=e*t[t.length-1],r=0,a=0,i=t.length-1;for(;r<i;)a=r+Math.floor((i-r)/2),n>t[a]?r=a+1:i=a-1;return n>t[i]?i+=(n-t[i])/(t[i+1]-t[i]):i-=1-(n-t[i-1])/(t[i]-t[i-1]),i/(t.length-1)}}const ooe=new Ct().setFromAxisAngle(new B(1,0,0),-Math.PI/2),OT=new B,aoe=new Ct,FT=new B,Sx=new ka,U0=new Ve,Cx=new Ve,UT={X:0,Y:1,Z:2,"-X":0,"-Y":1,"-Z":2},z0=["x","y","z"],ioe=new B,soe=new B,loe=new B,Ex=new ka;function H2(o,e,t,n=!1){if(e===t)return o;const r=o.y,a=o.z;return e==="Z_UP_RIGHT"&&t==="Y_UP_RIGHT"?(o.y=a,o.z=n?r:-r):e==="Y_UP_RIGHT"&&t==="Z_UP_RIGHT"?(o.y=n?a:-a,o.z=r):console.error("transformCoordsSpace: Unsupported coordinate space"),o}const zT=function(){const o=new ka,e=new ka,t=new B;return function(n,r){const a=o.copy(n).reorder("YZX"),i=e.copy(a).makeAlternative(),s=t.setFromEuler(a).lengthSq(),c=t.setFromEuler(i).lengthSq();return r.copy(s<c?a:i),H2(r,"Y_UP_RIGHT","Z_UP_RIGHT")}}();class AP extends ao{constructor(e){super(e),this.isTransformationConstraint=!0,this.type="TransformationConstraint",this.coordSystem="Y_UP_RIGHT",this.fromMin=new B,this.fromMax=new B,this.toMin=new B,this.toMax=new B,this.mapFrom="POSITION",this.mapTo="POSITION",this.mapToAxisFromAxis=["X","Y","Z"],this.mixMode="REPLACE",this.ownerSpaceObj=null,this.targetSpaceObj=null,this.ownerSpace=0,this.targetSpace=0,this.useMotionExtrapolate=!1,this.influence=1,this.fixCameraLightRotation=!1,this._firstIteration=!0,this._objMatrixWorldInit=new Ve,this._objMatrixInit=new Ve}copy(e){return super.copy(e),this.coordSystem=e.coordSystem,this.fromMin.copy(e.fromMin),this.fromMax.copy(e.fromMax),this.toMin.copy(e.toMin),this.toMax.copy(e.toMax),this.mapFrom=e.mapFrom,this.mapTo=e.mapTo,this.mapToAxisFromAxis=e.mapToAxisFromAxis,this.mixMode=e.mixMode,this.ownerSpaceObj=e.ownerSpaceObj,this.targetSpaceObj=e.targetSpaceObj,this.ownerSpace=e.ownerSpace,this.targetSpace=e.targetSpace,this.useMotionExtrapolate=e.useMotionExtrapolate,this.influence=e.influence,this.fixCameraLightRotation=e.fixCameraLightRotation,this._firstIteration=!0,this}update(e){if(super.update(e),this.mute)return;this._firstIteration&&(this._updateObjMatrixWorld(e),this._objMatrixWorldInit.copy(e.matrixWorld),this._objMatrixInit.copy(e.matrix),this._firstIteration=!1);const t=U0;if(this.targetSpace==0)t.copy(this.target.matrixWorld);else if(this.targetSpace==2)t.copy(this.target.matrix);else if(this.targetSpace==1){if(!this.targetSpaceObj)return;t.copy(this.targetSpaceObj.matrixWorld).invert(),t.multiply(this.target.matrixWorld)}if(t.decomposeE(OT,Sx,FT),this.ownerSpace==0&&e.parent)this._objMatrixWorldInit.decomposeE(e.position,e.rotation,e.scale);else if(this.ownerSpace==2)this._objMatrixInit.decomposeE(e.position,e.rotation,e.scale);else if(this.ownerSpace==1){if(!this.ownerSpaceObj)return;Cx.copy(this.ownerSpaceObj.matrixWorld).invert(),Cx.multiply(this._objMatrixWorldInit),Cx.decomposeE(e.position,e.rotation,e.scale)}const n=ioe;if(this.mapFrom=="POSITION")n.copy(OT);else if(this.mapFrom=="ROTATION")if(this.coordSystem=="Z_UP_RIGHT"){const f=zT(Sx,Ex);H2(f,this.coordSystem,"Y_UP_RIGHT"),n.copy(f)}else n.copy(Sx);else this.mapFrom=="SCALE"&&n.copy(FT);const r=soe.set(0,0,0),a=n,i=this.fromMin,s=this.fromMax;for(const f of z0)s[f]-i[f]!=0&&(this.useMotionExtrapolate||(a[f]=Math.min(Math.max(a[f],i[f]),s[f])),r[f]=(a[f]-i[f])/(s[f]-i[f]));const c=this.toMin,u=this.toMax,h=loe;for(let f=0;f<3;f++){const m=z0[f];this.mapToAxisFromAxis[f].indexOf("-")>-1?h[m]=c[m]+(1-r[z0[UT[this.mapToAxisFromAxis[f]]]])*(u[m]-c[m]):h[m]=c[m]+r[z0[UT[this.mapToAxisFromAxis[f]]]]*(u[m]-c[m])}if(this.mapTo=="POSITION")this.mixMode=="ADD"?h.add(e.position):this.mixMode,e.position.lerp(h,this.influence);else if(this.mapTo=="ROTATION"){const f=aoe;if(this.mixMode=="ADD"){const m=Ex.set(0,0,0,"XYZ");this.coordSystem=="Z_UP_RIGHT"?(zT(e.rotation,m),H2(m,this.coordSystem,"Y_UP_RIGHT"),m.x+=h.x,m.y+=h.y,m.z+=h.z,m.order="YZX"):m.set(e.rotation.x+h.x,e.rotation.y+h.y,e.rotation.z+h.z),f.setFromEuler(m)}else{const m=Ex.setFromVector3(h);this.coordSystem=="Z_UP_RIGHT"&&(m.order="YZX"),f.setFromEuler(m),this.mixMode=="AFTER"?f.premultiply(e.quaternion):this.mixMode=="BEFORE"?f.multiply(e.quaternion):this.mixMode}e.quaternion.slerp(f,this.influence)}else this.mapTo=="SCALE"&&(this.mixMode=="REPLACE"||this.mixMode=="MULTIPLY"&&h.multiply(e.scale),e.scale.lerp(h,this.influence));if(this.ownerSpace==0&&e.parent)e.matrixWorld.compose(e.position,e.quaternion,e.scale),e.matrix.multiplyMatrices(U0.copy(e.parent.matrixWorld).invert(),e.matrixWorld),e.matrix.decompose(e.position,e.quaternion,e.scale);else if(this.ownerSpace==1){if(!this.ownerSpaceObj)return;e.matrixWorld.compose(e.position,e.quaternion,e.scale),e.matrixWorld.premultiply(U0.copy(this.ownerSpaceObj.matrixWorld)),e.matrix.copy(e.matrixWorld),e.parent&&e.matrix.premultiply(U0.copy(e.parent.matrixWorld).invert()),e.matrix.decompose(e.position,e.quaternion,e.scale)}this.mapTo=="ROTATION"&&this.fixCameraLightRotation&&(e.isCamera||e.isLight)&&e.quaternion.multiply(ooe)}}const VT=["IMAGE_AR","SKYDOME_LIGHT_AR","TEXTURE_BL","TEX_IMAGE_BL","TEX_ENVIRONMENT_BL","BITMAP_MX","BITMAP_ENV_MX","REFLECT_REFRACT_MX","FILE_MY","AI_SKYDOME_LIGHT_MY","OSL_NODE"];class xP extends ma{constructor(e){super(e),this.ktx2Loader=null,this.pluginCallbacks=[],this.register(function(t){return new doe(t)}),this.register(function(t){return new foe(t)}),this.register(function(t){return new poe(t)}),this.register(function(t){return new moe(t)}),this.register(function(t){return new goe(t)}),this.register(function(t){return new voe(t)}),this.register(function(t){return new _oe(t)}),this.register(function(t){return new Aoe(t)}),this.register(function(t){return new xoe(t)}),this.register(function(t){return new yoe(t)}),this.register(function(t){return new boe(t)}),this.onProgress=null}load(e,t,n,r){const a=this;let i;a.onProgress=n||function(){},i=this.resourcePath!==""?this.resourcePath:this.path!==""?this.path:fi.extractUrlBase(e);const s=e.indexOf(".xz",e.length-3)!=-1;let c;s?c=new tp(a.manager):(c=new fa(a.manager),c.setResponseType("arraybuffer"));const u=function(f){a.onProgress&&a.onProgress(.3*f*100)};let h=u;c instanceof fa&&(h=function(f){const m=f.lengthComputable?f.loaded/f.total:1;u(m)}),c.load(e,function(f){try{a.parse(f,i,t,r,s)}catch(m){r!==void 0&&r(m.constructor===Error?m:new Error("v3d.GLTFLoader: Unable to parse model."))}},h,r)}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(){return console.error("v3d.GLTFLoader: Mesh optimization is not supported, please use LZMA compression."),this}setDRACOLoader(){return console.error("v3d.GLTFLoader: Draco compression is not supported, please use LZMA compression."),this}register(e){return this.pluginCallbacks.indexOf(e)===-1&&this.pluginCallbacks.push(e),this}unregister(e){return this.pluginCallbacks.indexOf(e)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,n,r,a){let i;const s={},c={};if(typeof e=="string")i=e;else if(fi.decodeText(new Uint8Array(e,0,4))===yP){try{s[wn.KHR_BINARY_GLTF]=new hoe(e)}catch(m){return void(r&&r(m))}i=s[wn.KHR_BINARY_GLTF].content}else i=fi.decodeText(new Uint8Array(e));const u=JSON.parse(i);if(u.asset===void 0||u.asset.version[0]<2)return void(r&&r(new Error("v3d.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported.")));const h=this,f=new Boe(u,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,loadBinXZ:a,onProgress:function(m){h.onProgress&&h.onProgress(m)}});for(let m=0;m<this.pluginCallbacks.length;m++){const g=this.pluginCallbacks[m](f);c[g.name]=g,s[g.name]=!0}if(u.extensionsUsed)for(let m=0;m<u.extensionsUsed.length;++m){const g=u.extensionsUsed[m],A=u.extensionsRequired||[];g===wn.KHR_MATERIALS_UNLIT?s[g]=new uoe:A.indexOf(g)>=0&&c[g]===void 0&&console.warn('v3d.GLTFLoader: Unknown extension "'+g+'".')}f.setExtensions(s),f.setPlugins(c),f.parse(function(m){h.onProgress&&h.onProgress(100),n(m)},r)}parseAsync(e,t){const n=this;return new Promise(function(r,a){n.parse(e,t,r,a)})}}function coe(){let o={};return{get:function(e){return o[e]},add:function(e,t){o[e]=t},remove:function(e){delete o[e]},removeAll:function(){o={}}}}const wn={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_TEXTURE_BASISU:"KHR_texture_basisu",EXT_TEXTURE_WEBP:"EXT_texture_webp",S8S_V3D_ANIMATION:"S8S_v3d_animation",S8S_V3D_CAMERA:"S8S_v3d_camera",S8S_V3D_MATERIALS:"S8S_v3d_materials",S8S_V3D_MESH:"S8S_v3d_mesh",S8S_V3D_NODE:"S8S_v3d_node",S8S_V3D_SCENE:"S8S_v3d_scene",S8S_V3D_TEXTURE:"S8S_v3d_texture",S8S_V3D_LIGHTS:"S8S_v3d_lights",S8S_V3D_LIGHT_PROBES:"S8S_v3d_light_probes",S8S_V3D_CURVES:"S8S_v3d_curves",S8S_V3D_CLIPPING_PLANES:"S8S_v3d_clipping_planes"};class uoe{constructor(){this.name=wn.KHR_MATERIALS_UNLIT}getMaterialType(){return hr}extendParams(e,t,n){const r=[];e.color=new Qe(1,1,1),e.opacity=1;const a=t.pbrMetallicRoughness;if(a){if(Array.isArray(a.baseColorFactor)){const i=a.baseColorFactor;e.color.fromArray(i),e.opacity=i[3]}a.baseColorTexture!==void 0&&r.push(n.assignTexture(e,"map",a.baseColorTexture,3001))}return Promise.all(r)}}class doe{constructor(e){this.parser=e,this.name=wn.KHR_TEXTURE_BASISU}loadTexture(e){const t=this.parser,n=t.json,r=n.textures[e];if(!r.extensions||!r.extensions[this.name])return null;const a=r.extensions[this.name],i=t.options.ktx2Loader;if(!i){if(n.extensionsRequired&&n.extensionsRequired.indexOf(this.name)>=0)throw new Error("v3d.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(e,a.source,i)}}class foe{constructor(e){this.parser=e,this.name=wn.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){const t=this.name,n=this.parser,r=n.json,a=r.textures[e];if(!a.extensions||!a.extensions[t])return null;const i=a.extensions[t],s=r.images[i.source];let c=n.textureLoader;if(s.uri){const u=n.options.manager.getHandler(s.uri);u!==null&&(c=u)}return this.detectSupport().then(function(u){if(u)return n.loadTextureImage(e,i.source,c);if(r.extensionsRequired&&r.extensionsRequired.indexOf(t)>=0)throw new Error("v3d.GLTFLoader: WebP required by asset but unsupported.");return n.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(t.height===1)}})),this.isSupported}}const yP="glTF",kT={JSON:1313821514,BIN:5130562};class hoe{constructor(e){this.name=wn.KHR_BINARY_GLTF,this.content=null,this.body=null;const t=new DataView(e,0,12);if(this.header={magic:fi.decodeText(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==yP)throw new Error("v3d.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("v3d.GLTFLoader: Legacy binary file detected.");const n=this.header.length-12,r=new DataView(e,12);let a=0;for(;a<n;){const i=r.getUint32(a,!0);a+=4;const s=r.getUint32(a,!0);if(a+=4,s===kT.JSON){const c=new Uint8Array(e,12+a,i);this.content=fi.decodeText(c)}else if(s===kT.BIN){const c=12+a;this.body=e.slice(c,c+i)}a+=i}if(this.content===null)throw new Error("v3d.GLTFLoader: JSON content not found.")}}class poe{constructor(e){this.parser=e,this.name=wn.S8S_V3D_LIGHTS,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,t=this.parser.json.nodes||[];for(let n=0,r=t.length;n<r;n++){const a=t[n];a.extensions&&a.extensions[this.name]&&a.extensions[this.name].light!==void 0&&e._addNodeRef(this.cache,a.extensions[this.name].light)}}_loadLight(e){const t=this.parser,n="light:"+e;let r=t.cache.get(n);if(r)return r;const a=t.json,i=((a.extensions&&a.extensions[this.name]||{}).lights||[])[e];let s;const c=new Qe().fromArray(i.color),u=i.intensity??1;switch(i.type){case"point":s=new iB(c,u);break;case"directional":s=new uB(c,u);break;case"spot":s=new oB(c,u);break;case"area":s=new sB(c,u,i.width,i.height);break;case"ambient":s=new dB(c,u);break;default:console.error("v3d.GLTFLoader: Invalid light type",i.type)}let h;return _e(i.distance)&&(s.distance=i.distance),_e(i.decay)&&(s.decay=i.decay,i.profile!="blender"||_e(i.power)||(s.userData.usePowerUnits=!0,s.power=u)),_e(i.power)&&(s.userData.usePowerUnits=!0,s.power=i.power),_e(i.angle)&&(s.angle=i.angle),_e(i.penumbra)&&(s.penumbra=i.penumbra),s.isRectAreaLight&&JB.init(i.ltcMat1,i.ltcMat2),_e(i.shadow)?(_e(i.shadow.enabled)||(i.shadow.enabled=!0),s.castShadow=i.shadow.enabled,s.shadow.bias=i.shadow.bias,_e(i.shadow.expBias)&&(s.shadow.expBias=i.shadow.expBias),_e(i.shadow.slopeScaledBias)&&(s.shadow.slopeScaledBias=i.shadow.slopeScaledBias),s.shadow.radius=i.shadow.radius,s.shadow.mapSize.width=i.shadow.mapSize,s.shadow.mapSize.height=i.shadow.mapSize,s.shadow.camera.near=i.shadow.cameraNear,s.shadow.camera.far=i.shadow.cameraFar,s.isSpotLight?(s.shadow.camera.fov=vv(i.shadow.cameraFov),s.shadow.useMinFov90=i.profile==="blender"):s.isDirectionalLight&&(_e(i.shadow.cameraOrthoLeft)&&_e(i.shadow.cameraOrthoRight)&&_e(i.shadow.cameraOrthoBottom)&&_e(i.shadow.cameraOrthoTop)&&(s.shadow.camera.left=i.shadow.cameraOrthoLeft,s.shadow.camera.right=i.shadow.cameraOrthoRight,s.shadow.camera.bottom=i.shadow.cameraOrthoBottom,s.shadow.camera.top=i.shadow.cameraOrthoTop),s.shadow.maxDistance=i.shadow.cameraFar,_e(i.shadow.csm)&&(_e(i.shadow.csm.count)&&(s.shadow.numCascades=i.shadow.csm.count),_e(i.shadow.csm.maxDistance)&&(s.shadow.maxDistance=i.shadow.csm.maxDistance),_e(i.shadow.csm.fade)&&(s.shadow.fade=i.shadow.csm.fade),_e(i.shadow.csm.exponent)&&(s.shadow.exponent=i.shadow.csm.exponent),_e(i.shadow.csm.lightMargin)&&(s.shadow.lightMargin=i.shadow.csm.lightMargin)),s.shadow.createCascades()),s.shadow.camera.updateProjectionMatrix()):s.castShadow=!1,s.name=i.name?t.createUniqueName(i.name):"",(s.isDirectionalLight||s.isSpotLight)&&_e(i.target)?(s.isFreeLight=!1,h=t.getDependency("node",i.target)):((s.isDirectionalLight||s.isSpotLight)&&(s.isFreeLight=!0),h=Promise.resolve()),h.then(f=>(f&&(s.target=f),r=Promise.resolve(s),t.cache.add(n,r),r))}createNodeAttachment(e){const t=this,n=this.parser,r=n.json.nodes[e],a=(r.extensions&&r.extensions[this.name]||{}).light;return a===void 0?null:this._loadLight(a).then(function(i){return n._getNodeRef(t.cache,a,i)})}}class moe{constructor(e){this.parser=e,this.name=wn.S8S_V3D_LIGHT_PROBES,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,t=this.parser.json.nodes||[];for(let n=0,r=t.length;n<r;n++){const a=t[n];a.extensions&&a.extensions[this.name]&&a.extensions[this.name].lightProbe!==void 0&&e._addNodeRef(this.cache,a.extensions[this.name].lightProbe)}}_loadLightProbe(e){const t=this.parser,n="lightProbe:"+e;let r=t.cache.get(n);if(r)return r;const a=t.json,i=((a.extensions&&a.extensions[this.name]||{}).lightProbes||[])[e];let s;const c=i.type||"CUBEMAP";if(c=="CUBEMAP"||c=="SPHERE"){switch(s=new bb,i.influenceType){case"ELIPSOID":s.influenceType=1;break;case"BOX":s.influenceType=2}switch(i.parallaxType){case"ELIPSOID":s.parallaxType=1;break;case"BOX":s.parallaxType=2}s.parallaxDistance=i.parallaxDistance,s.probeClipEnd=i.clipEnd,s.probeIntensity=i.intensity,_e(i.influenceGroup)&&(s.influenceGroup=i.influenceGroup),_e(i.influenceGroupInv)&&(s.influenceGroupInv=i.influenceGroupInv)}else s=new Rre,s.falloff=i.falloff,_e(i.planeSize)&&s.planeSize.set(i.planeSize[0],i.planeSize[1]);return s.influenceDistance=i.influenceDistance,s.probeClipStart=i.clipStart,s.visibilityGroup=i.visibilityGroup,s.visibilityGroupInv=i.visibilityGroupInv,s.name=t.createUniqueName(i.name||"lightProbe_"+e),r=Promise.resolve(s),t.cache.add(n,r),r}createNodeAttachment(e){const t=this,n=this.parser,r=n.json.nodes[e],a=(r.extensions&&r.extensions[this.name]||{}).lightProbe;return a===void 0?null:this._loadLightProbe(a).then(function(i){return n._getNodeRef(t.cache,a,i)})}}class goe{constructor(e){this.parser=e,this.name=wn.S8S_V3D_CURVES,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,t=this.parser.json.nodes||[];for(let n=0,r=t.length;n<r;n++){const a=t[n];a.extensions&&a.extensions[this.name]&&a.extensions[this.name].curve!==void 0&&e._addNodeRef(this.cache,a.extensions[this.name].curve)}}_loadOpenType(){return new Promise(function(e){g5("opentype.js",function(){e()},function(){console.error("GLTFLoader: opentype.js module not found, please copy it to your app directory"),e()})})}_loadFont(e){const t=this.parser,n="font:"+e;let r=t.cache.get(n);if(r)return r;const a=t.json,i=((a.extensions&&a.extensions[this.name]||{}).fonts||[])[e];let s=i.uri,c=!1;return i.bufferView!==void 0&&(s=t.getDependency("bufferView",i.bufferView).then(function(u){c=!0;const h=new Blob([u],{type:i.mimeType});return s=URL.createObjectURL(h),s})),Promise.all([this._loadOpenType(),s]).then(function(u){if(s=u[1],typeof opentype>"u")return null;const h=new $B;return h.setCrossOrigin(t.options.crossOrigin),new Promise(function(f,m){h.load(fi.resolveURL(s,t.options.path),f,void 0,m)}).then(function(f){return new eP(f)},function(f){return null})}).then(function(u){return c===!0&&URL.revokeObjectURL(s),r=Promise.resolve(u),t.cache.add(n,r),r})}_loadCurve(e){const t=this.parser,n="curve:"+e;let r=t.cache.get(n);if(r)return r;const a=t.json,i=((a.extensions&&a.extensions[this.name]||{}).curves||[])[e];let s,c=i.type;const u=[];return u.push(this._loadFont(i.font)),i.material!==void 0?u.push(t.getDependency("material",i.material)):u.push(CP(t.cache)),Promise.all(u).then(function(h){const f=h[0],m=h[1];if(f===null&&(c="empty"),c==="font"){const g=i.bevelSize>0||i.bevelThickness>0,A=new Tv(i.text,{font:f,size:i.size,height:i.height,curveSegments:i.curveSegments,bevelEnabled:g,bevelThickness:i.bevelThickness,bevelSize:i.bevelSize,bevelSegments:i.bevelSegments,alignX:i.alignX,alignY:i.alignY,lineHeight:i.lineHeight,scaledEmSize:i.scaledEmSize});s=new Mt(A,m)}else s=new Tt;return s.name=t.createUniqueName(i.name||"curve_"+e),r=Promise.resolve(s),t.cache.add(n,r),r})}createNodeAttachment(e){const t=this,n=this.parser,r=n.json.nodes[e],a=(r.extensions&&r.extensions[this.name]||{}).curve;return a===void 0?null:this._loadCurve(a).then(function(i){return n._getNodeRef(t.cache,a,i)})}}class voe{constructor(e){this.parser=e,this.name=wn.S8S_V3D_CLIPPING_PLANES,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,t=this.parser.json.nodes||[];for(let n=0,r=t.length;n<r;n++){const a=t[n];a.extensions&&a.extensions[this.name]&&a.extensions[this.name].clippingPlane!==void 0&&e._addNodeRef(this.cache,a.extensions[this.name].clippingPlane)}}_loadClippingPlane(e){const t=this.parser,n="clippingPlane:"+e;let r=t.cache.get(n);if(r)return r;const a=t.json,i=((a.extensions&&a.extensions[this.name]||{}).clippingPlanes||[])[e],s=new Bre;return s.clippingGroup=i.clippingGroup,s.clipShadows=i.clipShadows,s.negated=i.negated,s.clipIntersection=i.clipIntersection,s.crossSection=i.crossSection,s.crossSectionColor=new Qe().fromArray(i.color),s.crossSectionOpacity=i.opacity,s.crossSectionSize=i.size,_e(i.renderSide)&&(s.crossSectionRenderSide=SP[i.renderSide]),s.name=t.createUniqueName(i.name||"clippingPlane_"+e),r=Promise.resolve(s),t.cache.add(n,r),r}createNodeAttachment(e){const t=this,n=this.parser,r=n.json.nodes[e],a=(r.extensions&&r.extensions[this.name]||{}).clippingPlane;return a===void 0?null:this._loadClippingPlane(a).then(function(i){return n._getNodeRef(t.cache,a,i)})}}class _oe{constructor(e){this.name=wn.S8S_V3D_SCENE,this.parser=e}beforeRoot(){let e=this.parser.json.asset.generator||"";e.indexOf("Verge3D")>-1&&(e.match(/(\d+).(\d+).(\d+)/)||(e+=" v0.0.0"),m5(e,"4.9.0",2)<0&&console.warn("Loading glTF asset in older version of Verge3D runtime. Please update your application."))}afterRoot(e){const t=this.parser,n=t.json,r=n.scenes[n.scene||0],a=e.scene,i=_e(r.extensions)?r.extensions[wn.S8S_V3D_SCENE]:void 0,s=[],c=[],u=[];let h;return h=r&&i&&_e(i.worldMaterial)?t.getDependency("material",i.worldMaterial):Promise.resolve(),h.then(f=>{const m={};f&&(m.material=f),e.world=m}).then(()=>(t.assignedMaterials.forEach(function(f){f.isMeshNodeMaterial&&f.traverseNodes(function(m){m.originData.type==="TEX_COORD_BL"&&_e(m.originData.object)&&m.originData.object>-1&&(s.push(t.getDependency("node",m.originData.object)),c.push(m),u.push(f))})}),Promise.all(s))).then(f=>{for(let A=0;A<f.length;A++){const _=f[A],x=c[A],C=u[A],b=C.nodeTexCoordObjectMap[x.originData.name];C.nodeTexCoordObject[b]=_}const m=[];for(let A=0;A<e.cameras.length;A++){const _=e.cameras[A];let x=!1;_.traverseAncestors(function(C){C==a&&(x=!0)}),x&&m.push(_)}e.cameras=m;for(let A=0;A<e.animations.length;A++){const _=e.animations[A];_.clip&&_.clip.name!==void 0&&(_.clip.name=_.clip.name)}const g={};if(r){const A=_e(r.extensions)?r.extensions[wn.S8S_V3D_SCENE]:void 0;if(A){if(_e(A.shadowMap)){switch(g.shadowMap={enabled:!0},A.shadowMap.type){case"BASIC":g.shadowMap.type=0;break;case"BILINEAR":g.shadowMap.type=1;break;case"PCFSOFT":console.warn("v3d.GLTFLoader: PCF Bilinear shadows deprecated since Verge3D 4.7, using PCF (with poisson disk sampling) instead"),g.shadowMap.type=2;break;case"PCF":case"PCFPOISSON":g.shadowMap.type=2;break;case"ESM":g.shadowMap.type=3}let _;_=A.shadowMap.renderSingleSided?A.shadowMap.renderReverseSided?1:0:2,a.traverse(function(x){const C=x.material;C&&(C.shadowSide=_)}),g.esmDistanceScale=A.shadowMap.esmDistanceScale}if(_e(A.aaMethod)&&(g.aaMethod=A.aaMethod),_e(A.useHDR)&&(g.useHDR=A.useHDR),_e(A.useOIT)&&(g.useOIT=A.useOIT),_e(A.unitsScaleFactor)&&(g.unitsScaleFactor=A.unitsScaleFactor),_e(A.toneMapping)){switch(A.toneMapping.type){case"logarithmicMax":g.toneMapping=6,g.toneMappingBrightness=A.toneMapping.brightness,g.toneMappingContrast=A.toneMapping.contrast,g.toneMappingMidTones=A.toneMapping.midTones,g.toneMappingPhysicalScale=A.toneMapping.physicalScale,g.toneMappingChromaticAdaptation=A.toneMapping.chromaticAdaptation,g.toneMappingWhiteColor=new Qe().fromArray(A.toneMapping.whiteColor),g.toneMappingColorDifferentiation=A.toneMapping.colorDifferentiation,g.toneMappingExteriorDaylight=A.toneMapping.exteriorDaylight;break;case"physicalMax":g.toneMapping=7,g.toneMappingWhiteBalance=new Qe().fromArray(A.toneMapping.whiteBalance),g.toneMappingHighlights=A.toneMapping.highlights,g.toneMappingMidTones=A.toneMapping.midTones,g.toneMappingShadows=A.toneMapping.shadows,g.toneMappingSaturation=A.toneMapping.saturation,g.toneMappingPhysicalScale=A.toneMapping.physicalScale,g.toneMappingAperture=A.toneMapping.aperture,g.toneMappingShutter=A.toneMapping.shutter,g.toneMappingISO=A.toneMapping.iso,g.toneMappingVignetting=A.toneMapping.vignetting;break;case"filmicBlender":g.toneMapping=8;break;case"agxBlender":g.toneMapping=9;break;case"pbrNeutral":g.toneMapping=10}switch(A.toneMapping.look){case"NONE":g.toneMappingLook=0;break;case"AGX_PUNCHY":g.toneMappingLook=1;break;default:A.toneMapping.type==="agxBlender"&&console.warn(`v3d.GLTFLoader: ${A.toneMapping.look} look is not supported, fallback to None`),g.toneMappingLook=0}}if(_e(A.pmremMaxTileSize)&&(g.pmremMaxTileSize=A.pmremMaxTileSize),_e(A.iblEnvironmentMode))switch(A.iblEnvironmentMode){case"PMREM":default:g.iblEnvironmentMode=0;break;case"PROBE_CUBEMAP":console.warn("v3d.GLTFLoader: Cubemap probes deprecated since Verge3D 4.3, using PMREM instead"),g.iblEnvironmentMode=0;break;case"PROBE":g.iblEnvironmentMode=1;break;case"NONE":g.iblEnvironmentMode=2}_e(A.postprocessing)&&(a.postprocessing=A.postprocessing)}}e.renderer=g})}}class Aoe{constructor(e){this.name=wn.S8S_V3D_NODE,this.parser=e}extendNodeParams(e,t){const n=t.extensions&&t.extensions[this.name];if(!n)return e;if(n.hidden&&(e.visible=!1),e.isMesh&&(_e(n.useCastShadows)?e.castShadow=n.useCastShadows:_e(e.material.castShadow)&&(e.castShadow=e.material.castShadow),_e(n.useShadows)?e.receiveShadow=n.useShadows:_e(e.material.receiveShadow)&&(e.receiveShadow=e.material.receiveShadow)),_e(n.objectIndex)&&(e.objectIndex=n.objectIndex),_e(n.objectColor)&&(e.objectColor=new Qe().fromArray(n.objectColor),e.objectAlpha=_e(n.objectColor[3])?n.objectColor[3]:1),e.renderOrder=n.renderOrder,e.frustumCulled=n.frustumCulling,_e(n.groupNames)&&(e.groupNames=n.groupNames),_e(n.hidpiCompositing)&&(e.hidpiCompositing=n.hidpiCompositing),e.isMesh&&e.material.isMeshNodeMaterial){const r=e.material;(r.hasNode("MATTE_SHADOW_MX")||r.hasNode("SHADOW_MATTE_AR")||r.hasNode("AI_SHADOW_MATTE_MY"))&&(r.transparent=!1,r.premultipliedAlpha=!0,TP(r),e.renderOrder-=1e3,e.castShadow=!1,e.receiveShadow=!0)}return this.processConstraints(e,n.constraints)}processConstraints(e,t=[]){if(e.isMaterialGeneratedMesh)return e;const n=this.parser,r=[];for(let a=0;a<t.length;a++){const i=t[a];_e(i.target)?r.push(n.getDependency("node",i.target)):r.push(Promise.resolve(null))}return Promise.all(r).then(function(a){for(let i=0;i<t.length;i++){const s=t[i],c=a[i];let u;switch(s.type){case"copyLocation":u=new nP(c),u.useX=!_e(s.useX)||s.useX,u.useY=!_e(s.useY)||s.useY,u.useZ=!_e(s.useZ)||s.useZ,u.invertX=!!_e(s.invertX)&&s.invertX,u.invertY=!!_e(s.invertY)&&s.invertY,u.invertZ=!!_e(s.invertZ)&&s.invertZ,u.useOffset=!_e(s.useOffset)||s.useOffset,u.influence=_e(s.influence)?s.influence:1;break;case"copyRotation":u=new rP(c),u.useX=!_e(s.useX)||s.useX,u.useY=!_e(s.useY)||s.useY,u.useZ=!_e(s.useZ)||s.useZ,u.invertX=!!_e(s.invertX)&&s.invertX,u.invertY=!!_e(s.invertY)&&s.invertY,u.invertZ=!!_e(s.invertZ)&&s.invertZ,u.mixMode=_e(s.mixMode)?s.mixMode:"REPLACE",u.influence=_e(s.influence)?s.influence:1,u.fixCameraLightRotation=!!_e(s.fixCameraLightRotation)&&s.fixCameraLightRotation;break;case"copyScale":u=new oP(c),u.useX=!_e(s.useX)||s.useX,u.useY=!_e(s.useY)||s.useY,u.useZ=!_e(s.useZ)||s.useZ,u.power=_e(s.power)?s.power:1,u.useMakeUniform=!!_e(s.useMakeUniform)&&s.useMakeUniform,u.useOffset=!!_e(s.useOffset)&&s.useOffset,u.useAdd=!!_e(s.useAdd)&&s.useAdd,u.influence=_e(s.influence)?s.influence:1;break;case"copyTransforms":u=new aP(c),u.mixMode=_e(s.mixMode)?s.mixMode:"REPLACE",u.influence=_e(s.influence)?s.influence:1,u.fixCameraLightRotation=!!_e(s.fixCameraLightRotation)&&s.fixCameraLightRotation;break;case"dampedTrack":u=new iP(c),u.trackAxis=s.trackAxis,u.influence=_e(s.influence)?s.influence:1,u.fixCameraLightRotation=!!_e(s.fixCameraLightRotation)&&s.fixCameraLightRotation;break;case"limitDistance":u=new lP(c),u.distance=_e(s.distance)?s.distance:0,u.limitMode=_e(s.limitMode)?s.limitMode:"LIMITDIST_INSIDE",u.useTransformLimit=!!_e(s.useTransformLimit)&&s.useTransformLimit,u.influence=_e(s.influence)?s.influence:1;break;case"limitLocation":switch(u=new cP(c),s.space){case"CUSTOM":u.space=1;break;case"WORLD":u.space=0;break;default:u.space=2}u.min.set(Number(s.minX),Number(s.minY),Number(s.minZ)),u.max.set(Number(s.maxX),Number(s.maxY),Number(s.maxZ));break;case"limitRotation":u=new uP,u.axis=s.axis,u.min=s.min,u.max=s.max;break;case"limitScale":u=new dP,u.min.set(Number(s.minX),Number(s.minY),Number(s.minZ)),u.max.set(Number(s.maxX),Number(s.maxY),Number(s.maxZ));break;case"lockedTrack":u=new fP(c),u.trackAxis=s.trackAxis,u.lockAxis=s.lockAxis,u.fixCameraLightRotation=!!_e(s.fixCameraLightRotation)&&s.fixCameraLightRotation;break;case"trackTo":u=new hP(c),u.trackAxis=s.trackAxis,u.upAxis=s.upAxis,u.fixCameraLightRotation=!!_e(s.fixCameraLightRotation)&&s.fixCameraLightRotation;break;case"childOf":u=new tP(c),u.offsetMatrix=new Ve().fromArray(s.offsetMatrix),u.fixCameraLightRotation=!!_e(s.fixCameraLightRotation)&&s.fixCameraLightRotation;break;case"floor":u=new sP(c),u.floorLocation=s.floorLocation,u.offset=s.offset,u.useRotation=!!_e(s.useRotation)&&s.useRotation;break;case"fixOrthoZoom":u=new pP(c);break;case"canvasFit":u=new mP(c),u.edgeH=s.edgeH,u.edgeV=s.edgeV,u.fitShape=s.fitShape,u.offset=s.offset,s.fitShape=="SPHERE"&&e.resolveMultiMaterial().forEach(function(h){h.geometry&&h.geometry.computeBoundingSphere()});break;case"canvasBreakpoints":u=new gP,u.minWidth=Number(s.minWidth),u.maxWidth=Number(s.maxWidth),u.minHeight=Number(s.minHeight),u.maxHeight=Number(s.maxHeight),u.orientation=s.orientation;break;case"motionPath":u=new _P,u.degree=s.degree,u.cvs=[];for(let h=0;h<s.cvs.length;++h)u.cvs.push(Number(s.cvs[h]));u.knots=[];for(let h=0;h<s.knots.length;++h)u.knots.push(Number(s.knots[h]));u.weights=[];for(let h=0;h<s.weights.length;++h)u.weights.push(Number(s.weights[h]));if(u.value=_e(s.value)?s.value:0,u.follow=!!_e(s.follow)&&s.follow,u.frontAxis=_e(s.frontAxis)?s.frontAxis:"Z",u.upAxis=_e(s.upAxis)?s.upAxis:"Y",u.worldUpVector=_e(s.worldUpVector)?new B().fromArray(s.worldUpVector).normalize():new B(0,1,0),u.useChordLength=!!_e(s.useChordLength)&&s.useChordLength,u.bank=!!_e(s.bank)&&s.bank,u.bankScale=_e(s.bankScale)?s.bankScale:1,u.bankLimit=_e(s.bankLimit)?s.bankLimit:1/0,u.useFixedLocation=!!_e(s.useFixedLocation)&&s.useFixedLocation,u.fixedValue=_e(s.fixedValue)?s.fixedValue:0,u.usePointsTilt=!!_e(s.usePointsTilt)&&s.usePointsTilt,u.pointsTilt=[],_e(s.pointsTilt))for(let h=0;h<s.pointsTilt.length;++h)u.pointsTilt.push(Number(s.pointsTilt[h]));u.offsetValue=_e(s.offsetValue)?s.offsetValue:0,u.useClampValue=!!_e(s.useClampValue)&&s.useClampValue,u.useCyclic=!!_e(s.useCyclic)&&s.useCyclic,u.useObjOffset=!!_e(s.useObjOffset)&&s.useObjOffset,u.useRelative=!!_e(s.useRelative)&&s.useRelative,u.usePosOffset=!_e(s.usePosOffset)||s.usePosOffset,u.objOffsetMode=_e(s.objOffsetMode)?s.objOffsetMode:0,u.objOffsetRotMode=_e(s.objOffsetRotMode)?s.objOffsetRotMode:0,u.influence=_e(s.influence)?s.influence:1,u.fixCameraLightRotation=!!_e(s.fixCameraLightRotation)&&s.fixCameraLightRotation,u.init();break;case"transformation":switch(u=new AP(c),u.fromMin.set(Number(s.fromMin[0]),Number(s.fromMin[1]),Number(s.fromMin[2])),u.fromMax.set(Number(s.fromMax[0]),Number(s.fromMax[1]),Number(s.fromMax[2])),u.toMin.set(Number(s.toMin[0]),Number(s.toMin[1]),Number(s.toMin[2])),u.toMax.set(Number(s.toMax[0]),Number(s.toMax[1]),Number(s.toMax[2])),u.mapToAxisFromAxis=s.mapToAxisFromAxis,u.mapFrom=s.mapFrom,u.mapTo=s.mapTo,s.ownerSpace){case"CUSTOM":u.ownerSpace=1;break;case"LOCAL":u.ownerSpace=2;break;default:u.ownerSpace=0}switch(s.targetSpace){case"CUSTOM":u.targetSpace=1;break;case"LOCAL":u.targetSpace=2;break;default:u.targetSpace=0}_e(s.ownerSpaceObj)&&n.getDependency("node",s.ownerSpaceObj).then(h=>{u.ownerSpaceObj=h}),_e(s.targetSpaceObj)&&n.getDependency("node",s.targetSpaceObj).then(h=>{u.targetSpaceObj=h}),u.useMotionExtrapolate=s.useMotionExtrapolate,u.mixMode=s.mixMode,u.influence=s.influence,u.fixCameraLightRotation=!!_e(s.fixCameraLightRotation)&&s.fixCameraLightRotation}u&&(u.name=s.name,u.mute=s.mute,e.constraints.push(u))}return e})}}class xoe{constructor(e){this.name=wn.S8S_V3D_CAMERA,this.parser=e}extendCameraParams(e,t){const n=this.parser,r=t.extensions&&t.extensions[this.name];if(!r)return Promise.resolve(e);if(e.controlSettings=new _b(r.controls,r.enablePan,r.rotateSpeed,r.moveSpeed),e.viewportFit.type=3,_e(r.viewportFitType))switch(r.viewportFitType){case"VERTICAL":e.viewportFit.type=1;break;case"HORIZONTAL":e.viewportFit.type=2;break;case"AUTO":e.viewportFit.type=3;break;case"FILL":e.viewportFit.type=4;break;case"OVERSCAN":e.viewportFit.type=5}_e(r.viewportFitInitialAspect)&&(e.viewportFit.initialAspect=r.viewportFitInitialAspect),_e(r.orbitMinDistance)&&(e.controlSettings.orbitMinDistance=r.orbitMinDistance),_e(r.orbitMaxDistance)&&(e.controlSettings.orbitMaxDistance=r.orbitMaxDistance),_e(r.orbitMinZoom)&&(e.controlSettings.orbitMinZoom=r.orbitMinZoom),_e(r.orbitMaxZoom)&&(e.controlSettings.orbitMaxZoom=r.orbitMaxZoom),_e(r.orbitMinPolarAngle)&&(e.controlSettings.orbitMinPolarAngle=r.orbitMinPolarAngle),_e(r.orbitMaxPolarAngle)&&(e.controlSettings.orbitMaxPolarAngle=r.orbitMaxPolarAngle),_e(r.orbitMinAzimuthAngle)&&(e.controlSettings.orbitMinAzimuthAngle=r.orbitMinAzimuthAngle),_e(r.orbitMaxAzimuthAngle)&&(e.controlSettings.orbitMaxAzimuthAngle=r.orbitMaxAzimuthAngle);const a=[];if(_e(r.orbitTarget))if(r.orbitTarget instanceof Array){const i=new Tt;i.position.fromArray(r.orbitTarget),a.push(Promise.resolve(i))}else a.push(n.getDependency("node",r.orbitTarget));else a.push(Promise.resolve());return _e(r.fpsCollisionMaterial)?a.push(n.getDependency("material",r.fpsCollisionMaterial)):a.push(Promise.resolve()),_e(r.fpsGazeLevel)&&(e.controlSettings.gazeLevel=r.fpsGazeLevel),_e(r.fpsStoryHeight)&&(e.controlSettings.storyHeight=r.fpsStoryHeight),_e(r.enablePointerLock)&&(e.controlSettings.enablePointerLock=r.enablePointerLock),Promise.all(a).then(i=>(i[0]&&(e.controlSettings.orbitTarget=i[0]),i[1]&&(e.controlSettings.collisionMaterial=i[1]),e))}}class yoe{constructor(e){this.name=wn.S8S_V3D_MATERIALS,this.parser=e}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?Ba:null}extendMaterialParams(e,t){const n=this.parser.json,r=n.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const a=r.extensions[this.name],i=[];if(_e(a.nodeGraph)){const s=Ba.nodeGraphFromExtGraph(a.nodeGraph);t.nodeGraph=s,Ba.nodeGraphTraverse(s,u=>{const h=u.originData;VT.indexOf(h.type)>-1&&_e(h.texture)?i.push(this.assignTextureNode(h)):h.type=="RAMP_MY"&&(h.wrapS=Jg[h.wrapS]||1e3,h.wrapT=Jg[h.wrapT]||1e3)});const c=n.extensions&&n.extensions[this.name]||{};if(c&&c.nodeGraphs){t.additionalNodeGraphs={};for(let u in c.nodeGraphs){const h=Ba.nodeGraphFromExtGraph(c.nodeGraphs[u]);t.additionalNodeGraphs[u]=h,Ba.nodeGraphTraverse(h,f=>{const m=f.originData;VT.indexOf(m.type)>-1&&i.push(this.assignTextureNode(m))})}}}return _e(a.profile)&&(t.profile=a.profile),_e(a.renderSide)&&(t.side=SP[a.renderSide]),_e(a.useShadows)&&(t.receiveShadow=a.useShadows),_e(a.useCastShadows)&&(t.castShadow=a.useCastShadows),_e(a.depthWrite)&&(t.depthWrite=a.depthWrite),_e(a.depthPrepass)&&(t.depthPrepass=a.depthPrepass),_e(a.depthTest)&&(t.depthTest=a.depthTest),_e(a.dithering)&&(t.dithering=a.dithering),_e(a.materialIndex)&&(t.materialIndex=a.materialIndex),a.alphaToCoverage===!0&&(t.alphaToCoverage=!0),_e(a.gtaoVisible)&&(t.gtaoVisible=a.gtaoVisible),delete t.metalness,delete t.roughness,Promise.all(i)}assignTextureNode(e){return this.parser.getDependency("texture",e.texture).then(function(t){e.texture=t})}assignTransparency(e,t,n){const r=t.extensions[this.name]||{};if(e.premultipliedAlpha=n==Mh.BLEND,n==Mh.BLEND)if(_e(r.blendMode)){const a=r.blendMode;e.blending=5,_e(a.blendEquation)&&(e.blendEquation=QT[a.blendEquation]),_e(a.blendEquationAlpha)&&(e.blendEquationAlpha=QT[a.blendEquationAlpha]),_e(a.srcRGB)&&(e.blendSrc=V0[a.srcRGB]),_e(a.dstRGB)&&(e.blendDst=V0[a.dstRGB]),_e(a.srcAlpha)&&(e.blendSrcAlpha=V0[a.srcAlpha]),_e(a.dstAlpha)&&(e.blendDstAlpha=V0[a.dstAlpha])}else e.useAddTransparency()?e.blending=2:TP(e)}}class boe{constructor(e){this.parser=e,this.name=wn.S8S_V3D_TEXTURE,this.textureLoaderRGBE=new Q2,this.textureLoaderRGBE.setCrossOrigin(this.parser.options.crossOrigin),this.textureLoaderRGBE.setRequestHeader(this.parser.options.requestHeader)}loadTexture(e){const t=this.name,n=this.parser,r=n.json,a=r.textures[e];if(!a.extensions||!a.extensions[t])return null;const i=a.extensions[t];if(!_e(i.source))return null;const s=r.images[i.source];let c=n.textureLoader;if((s.uri||"").split(".").pop()=="hdr"||s.mimeType=="image/vnd.radiance"?c=this.textureLoaderRGBE:(s.uri||"").split(".").pop()!="xz"&&s.mimeType!="application/x-xz"||(c=new tp),s.uri){const u=n.options.manager.getHandler(s.uri);u!==null&&(c=u)}return n.loadTextureImage(e,i.source,c)}extendTextureParams(e,t,n){const r=this.name;if(!t.extensions||!t.extensions[r])return null;const a=t.extensions[r],i=a.colorSpace.startsWith("linear")||a.colorSpace=="non-color"?3e3:3001;e.encoding=i,(n instanceof Q2||n instanceof tp)&&(e.minFilter=1006),_e(a.anisotropy)&&(e.anisotropy=a.anisotropy),_e(a.uvTransform)&&(e.matrix=new Qr().fromArray(a.uvTransform),e.matrixAutoUpdate=!1)}}class bP extends Ld{constructor(e,t,n,r){super(e,t,n,r)}copySampleValue_(e){const t=this.resultBuffer,n=this.sampleValues,r=this.valueSize,a=e*r*3+r;for(let i=0;i!==r;i++)t[i]=n[a+i];return t}interpolate_(e,t,n,r){const a=this.resultBuffer,i=this.sampleValues,s=this.valueSize,c=2*s,u=3*s,h=r-t,f=(n-t)/h,m=f*f,g=m*f,A=e*u,_=A-u,x=-2*g+3*m,C=g-m,b=1-x,y=C-m+f;for(let M=0;M!==s;M++){const R=i[_+M+s],T=i[_+M+c]*h,w=i[A+M+s],D=i[A+M]*h;a[M]=b*R+y*T+x*w+C*D}return a}}const Soe=new Ct;class Coe extends bP{interpolate_(e,t,n,r){const a=super.interpolate_(e,t,n,r);return Soe.fromArray(a).normalize().toArray(a),a}}const es={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6},Eh={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},GT={9728:1003,9729:1006,9984:1004,9985:1007,9986:1005,9987:1008},Jg={33071:1001,33648:1002,10497:1e3},QT={32774:100,32778:101,32779:102},V0={0:200,1:201,768:202,769:203,770:204,771:205,772:206,773:207,774:208,775:209,776:210},Mx={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Eoe={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},ts={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences",intensity:"intensity",power:"power"},Moe={CUBICSPLINE:void 0,LINEAR:2301,STEP:2300},Mh={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"},SP={FRONT:0,BACK:1,DOUBLE:2,TWO_PASS_DOUBLE:3};function CP(o){return o.DefaultMaterial===void 0&&(o.DefaultMaterial=new Rv({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:0,receiveShadow:!0,castShadow:!0})),o.DefaultMaterial}function Zf(o,e,t){for(const n in t.extensions)o[n]===void 0&&(e.userData.gltfExtensions=e.userData.gltfExtensions||{},e.userData.gltfExtensions[n]=t.extensions[n])}function dc(o,e){e.extras!==void 0&&(typeof e.extras=="object"?Object.assign(o.userData,e.extras):console.warn("v3d.GLTFLoader: Ignoring primitive type .extras, "+e.extras))}function woe(o,e,t){let n=!1,r=!1,a=!1;for(let u=0,h=e.length;u<h;u++){const f=e[u];if(f.POSITION!==void 0&&(n=!0),f.NORMAL!==void 0&&(r=!0),f.COLOR_0!==void 0&&(a=!0),n&&r&&a)break}if(!n&&!r&&!a)return Promise.resolve(o);const i=[],s=[],c=[];for(let u=0,h=e.length;u<h;u++){const f=e[u];if(n){const m=f.POSITION!==void 0?t.getDependency("accessor",f.POSITION):o.attributes.position;i.push(m)}if(r){const m=f.NORMAL!==void 0?t.getDependency("accessor",f.NORMAL):o.attributes.normal;s.push(m)}if(a){const m=f.COLOR_0!==void 0?t.getDependency("accessor",f.COLOR_0):o.attributes.color;c.push(m)}}return Promise.all([Promise.all(i),Promise.all(s),Promise.all(c)]).then(function(u){const h=u[0],f=u[1],m=u[2];return n&&(o.morphAttributes.position=h),r&&(o.morphAttributes.normal=f),a&&(o.morphAttributes.color=m),o.morphTargetsRelative=!0,o})}function Toe(o,e){if(o.updateMorphTargets(),e.weights!==void 0)for(let t=0,n=e.weights.length;t<n;t++)o.morphTargetInfluences[t]=e.weights[t];if(e.extras&&Array.isArray(e.extras.targetNames)){const t=e.extras.targetNames;if(o.morphTargetInfluences.length===t.length){o.morphTargetDictionary={};for(let n=0,r=t.length;n<r;n++)o.morphTargetDictionary[t[n]]=n}else console.warn("v3d.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function Roe(o){return o.indices+":"+Ioe(o.attributes)+":"+o.mode}function Ioe(o){let e="";const t=Object.keys(o).sort();for(let n=0,r=t.length;n<r;n++)e+=t[n]+":"+o[t[n]]+";";return e}function W2(o){switch(o){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("v3d.GLTFLoader: Unsupported normalized accessor component type.")}}function Loe(o){return o.search(/\.jpe?g($|\?)/i)>0||o.search(/^data\:image\/jpeg/)===0?"image/jpeg":o.search(/\.webp($|\?)/i)>0||o.search(/^data\:image\/webp/)===0?"image/webp":"image/png"}new Ve;class Boe{constructor(e={},t={}){this.json=e,this.extensions={},this.plugins={},this.options=t,this.onProgress=t.onProgress||function(){},this.cache=new coe,this.associations=new Map,this.primitiveCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let n=!1,r=!1,a=-1;typeof navigator<"u"&&(n=/^((?!chrome|android).)*safari/i.test(navigator.userAgent)===!0,r=navigator.userAgent.indexOf("Firefox")>-1,a=r?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1),typeof createImageBitmap>"u"||n||r&&a<98?this.textureLoader=new ab(this.options.manager):this.textureLoader=new rB(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new fa(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0),this.assignedMaterials=[]}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,t){const n=this,r=this.json,a=this.extensions;this.cache.removeAll(),this._invokeAll(function(i){return i._markDefs&&i._markDefs()}),Promise.all(this._invokeAll(function(i){return i.beforeRoot&&i.beforeRoot()})).then(function(){return Promise.all([n.getDependencies("scene"),n.getDependencies("animation"),n.getDependencies("camera")])}).then(function(i){const s={scene:i[0][r.scene||0],scenes:i[0],animations:i[1],cameras:i[2],asset:r.asset,parser:n,userData:{}};Zf(a,s,r),dc(s,r),Promise.all(n._invokeAll(function(c){return c.afterRoot&&c.afterRoot(s)})).then(function(){e(s)})}).catch(t)}_markDefs(){const e=this.json.nodes||[],t=this.json.skins||[],n=this.json.meshes||[];for(let r=0,a=t.length;r<a;r++){const i=t[r].joints;for(let s=0,c=i.length;s<c;s++)e[i[s]].isBone=!0}for(let r=0,a=e.length;r<a;r++){const i=e[r];i.mesh!==void 0&&(this._addNodeRef(this.meshCache,i.mesh),i.skin!==void 0&&(n[i.mesh].isSkinnedMesh=!0)),i.camera!==void 0&&this._addNodeRef(this.cameraCache,i.camera)}}_addNodeRef(e,t){t!==void 0&&(e.refs[t]===void 0&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}_getNodeRef(e,t,n){if(e.refs[t]<=1)return n;const r=n.clone(),a=(i,s)=>{const c=this.associations.get(i);c!=null&&this.associations.set(s,c);for(const[u,h]of i.children.entries())a(h,s.children[u])};return a(n,r),r.name+="_instance_"+e.uses[t]++,r}_invokeOne(e){const t=Object.values(this.plugins);t.push(this);for(let n=0;n<t.length;n++){const r=e(t[n]);if(r)return r}return null}_invokeAll(e){const t=Object.values(this.plugins);t.unshift(this);const n=[];for(let r=0;r<t.length;r++){const a=e(t[r]);a&&n.push(a)}return n}getDependency(e,t){const n=e+":"+t;let r=this.cache.get(n);if(!r){switch(e){case"scene":r=this.loadScene(t);break;case"node":r=this.loadNode(t);break;case"mesh":r=this._invokeOne(function(a){return a.loadMesh&&a.loadMesh(t)});break;case"accessor":r=this.loadAccessor(t);break;case"bufferView":r=this._invokeOne(function(a){return a.loadBufferView&&a.loadBufferView(t)});break;case"buffer":r=this.loadBuffer(t);break;case"material":r=this._invokeOne(function(a){return a.loadMaterial&&a.loadMaterial(t)});break;case"texture":r=this._invokeOne(function(a){return a.loadTexture&&a.loadTexture(t)});break;case"skin":r=this.loadSkin(t);break;case"animation":r=this.loadAnimation(t);break;case"camera":r=this.loadCamera(t);break;default:throw new Error("Unknown type: "+e)}this.cache.add(n,r)}return r}getDependencies(e){let t=this.cache.get(e);if(!t){const n=this,r=this.json[e+(e==="mesh"?"es":"s")]||[];t=Promise.all(r.map(function(a,i){return n.getDependency(e,i)})),this.cache.add(e,t)}return t}loadBuffer(e){const t=this,n=this.json.buffers[e];if(n.type&&n.type!=="arraybuffer")throw new Error("v3d.GLTFLoader: "+n.type+" buffer type is not supported.");if(n.uri===void 0&&e===0)return Promise.resolve(this.extensions[wn.KHR_BINARY_GLTF].body);const r=this.options;return new Promise(function(a){let i,s;r.loadBinXZ?(i=fi.resolveURL(n.uri,r.path)+".xz",s=new tp):(i=fi.resolveURL(n.uri,r.path),s=t.fileLoader);const c=function(h){if(t.onProgress){const f=100*(.3+.7*h);t.onProgress(f)}};let u=c;s instanceof fa&&(u=function(h){const f=h.lengthComputable?h.loaded/h.total:1;c(f)}),s.load(i,a,u)})}loadBufferView(e){const t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then(function(n){const r=t.byteLength||0,a=t.byteOffset||0;return n.slice(a,a+r)})}loadAccessor(e){const t=this,n=this.json,r=this.json.accessors[e];if(r.bufferView===void 0&&r.sparse===void 0){const i=Mx[r.type],s=Eh[r.componentType],c=r.normalized===!0,u=new s(r.count*i);return Promise.resolve(new $e(u,i,c))}const a=[];return r.bufferView!==void 0?a.push(this.getDependency("bufferView",r.bufferView)):a.push(null),r.sparse!==void 0&&(a.push(this.getDependency("bufferView",r.sparse.indices.bufferView)),a.push(this.getDependency("bufferView",r.sparse.values.bufferView))),Promise.all(a).then(function(i){const s=i[0],c=Mx[r.type],u=Eh[r.componentType],h=u.BYTES_PER_ELEMENT,f=h*c,m=r.byteOffset||0,g=r.bufferView!==void 0?n.bufferViews[r.bufferView].byteStride:void 0,A=r.normalized===!0;let _,x;if(g&&g!==f){const C=Math.floor(m/g),b="InterleavedBuffer:"+r.bufferView+":"+r.componentType+":"+C+":"+r.count;let y=t.cache.get(b);y||(_=new u(s,C*g,r.count*g/h),y=new mp(_,g/h),t.cache.add(b,y)),x=new Lc(y,c,m%g/h,A)}else _=s===null?new u(r.count*c):new u(s,m,r.count*c),x=new $e(_,c,A);if(r.sparse!==void 0){const C=Mx.SCALAR,b=Eh[r.sparse.indices.componentType],y=r.sparse.indices.byteOffset||0,M=r.sparse.values.byteOffset||0,R=new b(i[1],y,r.sparse.count*C),T=new u(i[2],M,r.sparse.count*c);s!==null&&(x=new $e(x.array.slice(),x.itemSize,x.normalized));for(let w=0,D=R.length;w<D;w++){const z=R[w];if(x.setX(z,T[w*c]),c>=2&&x.setY(z,T[w*c+1]),c>=3&&x.setZ(z,T[w*c+2]),c>=4&&x.setW(z,T[w*c+3]),c>=5)throw new Error("v3d.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return x})}loadTexture(e){const t=this.json,n=this.options,r=t.textures[e].source,a=t.images[r];let i=this.textureLoader;if(a.uri){const s=n.manager.getHandler(a.uri);s!==null&&(i=s)}return this.loadTextureImage(e,r,i)}loadTextureImage(e,t,n){const r=this,a=this.json,i=a.textures[e],s=a.images[t],c=(s.uri||s.bufferView)+":"+i.sampler;if(this.textureCache[c])return this.textureCache[c];const u=this.loadImageSource(t,n).then(function(h){h.flipY=!1,h.name=i.name||s.name||"";const f=(a.samplers||{})[i.sampler]||{};return h.magFilter=GT[f.magFilter]||1006,h.minFilter=GT[f.minFilter]||1008,h.wrapS=Jg[f.wrapS]||1e3,h.wrapT=Jg[f.wrapT]||1e3,r._invokeAll(function(m){return m.extendTextureParams&&m.extendTextureParams(h,i,n)}),r.associations.set(h,{textures:e}),h}).catch(function(){return null});return this.textureCache[c]=u,u}loadImageSource(e,t){const n=this,r=this.json,a=this.options;if(this.sourceCache[e]!==void 0)return this.sourceCache[e].then(f=>f.clone());const i=r.images[e],s=self.URL||self.webkitURL;let c=i.uri||"",u=!1;if(i.bufferView!==void 0)c=n.getDependency("bufferView",i.bufferView).then(function(f){u=!0;const m=new Blob([f],{type:i.mimeType});return c=s.createObjectURL(m),c});else if(i.uri===void 0)throw new Error("v3d.GLTFLoader: Image "+e+" is missing URI and bufferView");const h=Promise.resolve(c).then(function(f){return new Promise(function(m,g){let A=m;t.isImageBitmapLoader===!0&&(A=function(_){const x=new In(_);x.needsUpdate=!0,m(x)}),t.load(fi.resolveURL(f,a.path),A,void 0,g)})}).then(function(f){return f instanceof ArrayBuffer?n.plugins[wn.S8S_V3D_TEXTURE].textureLoaderRGBE.loadAsync(s.createObjectURL(new Blob([f],{type:"image/vnd.radiance"}))):Promise.resolve(f)}).then(function(f){return u===!0&&s.revokeObjectURL(c),f.userData.mimeType=i.mimeType||Loe(i.uri),f}).catch(function(f){return console.error("v3d.GLTFLoader: Couldn't load texture",c),new In});return this.sourceCache[e]=h,h}assignTexture(e,t,n,r){return this.getDependency("texture",n.index).then(function(a){return a?(n.texCoord===void 0||n.texCoord==0||t==="aoMap"&&n.texCoord==1||console.warn("v3d.GLTFLoader: Custom UV set "+n.texCoord+" for texture "+t+" not yet supported."),r!==void 0&&(a.encoding=r),e[t]=a,a):null})}assignFinalMaterial(e,t,n){const r=e.geometry;let a=e.material;const i=r.attributes.tangent===void 0,s=r.attributes.color!==void 0&&!a.isMeshNodeMaterial,c=r.attributes.normal===void 0,u=a.isMeshNodeMaterial&&(a.nodeValue.length||a.nodeRGB.length),h=a.isMeshNodeMaterial&&a.hasNode("TEX_COORD_BL"),f=a.isMeshNodeMaterial&&Object.getOwnPropertyNames(t).length>0&&a.hasNode("UVMAP_BL"),m=a.isMeshNodeMaterial&&Object.getOwnPropertyNames(n).length>0&&(a.hasNode("ATTRIBUTE_BL")||a.hasNode("VERTEX_COLOR_BL"));if(e.isPoints){const g="PointsMaterial:"+a.uuid;let A=this.cache.get(g);A||(A=new qy,Er.prototype.copy.call(A,a),A.color.copy(a.color),A.map=a.map,A.sizeAttenuation=!1,this.cache.add(g,A)),a=A}else if(e.isLine){const g="LineBasicMaterial:"+a.uuid;let A=this.cache.get(g);A||(A=new gr,Er.prototype.copy.call(A,a),A.color.copy(a.color),this.cache.add(g,A)),a=A}if(i||s||c||u||h||f||m){let g="ClonedMaterial:"+a.uuid+":";i&&(g+="derivative-tangents:"),s&&(g+="vertex-colors:"),c&&(g+="flat-shading:");const A=Wo();u&&(g=A),h&&(g=A),f&&(g=A),m&&(g=A);let _=this.cache.get(g);_||(_=a.clone(),s&&(_.vertexColors=!0),c&&(_.flatShading=!0),i&&(_.normalScale&&(_.normalScale.y*=-1),_.clearcoatNormalScale&&(_.clearcoatNormalScale.y*=-1)),_.isMeshNodeMaterial&&(Object.assign(_.nodeUVAliases,t),Object.assign(_.nodeVCAliases,n),_.updateNodeGraph()),this.cache.add(g,_),this.associations.set(_,this.associations.get(a))),a=_}a.aoMap&&r.attributes.uv2===void 0&&r.attributes.uv!==void 0&&r.setAttribute("uv2",r.attributes.uv),e.material=a,this.assignedMaterials.includes(a)||this.assignedMaterials.push(a)}getMaterialType(){return Rv}loadMaterial(e){const t=this,n=this.json,r=this.extensions,a=n.materials[e];let i;const s={},c=a.extensions||{},u=[];if(a.doubleSided===!0&&(s.side=2),c[wn.KHR_MATERIALS_UNLIT]){const f=r[wn.KHR_MATERIALS_UNLIT];i=f.getMaterialType(),u.push(f.extendParams(s,a,t))}else{const f=a.pbrMetallicRoughness||{};if(s.color=new Qe(1,1,1),s.opacity=1,Array.isArray(f.baseColorFactor)){const m=f.baseColorFactor;s.color.fromArray(m),s.opacity=m[3]}f.baseColorTexture!==void 0&&u.push(t.assignTexture(s,"map",f.baseColorTexture,3001)),s.metalness=f.metallicFactor!==void 0?f.metallicFactor:1,s.roughness=f.roughnessFactor!==void 0?f.roughnessFactor:1,f.metallicRoughnessTexture!==void 0&&(u.push(t.assignTexture(s,"metalnessMap",f.metallicRoughnessTexture)),u.push(t.assignTexture(s,"roughnessMap",f.metallicRoughnessTexture))),i=this._invokeOne(function(m){return m.getMaterialType&&m.getMaterialType(e)}),u.push(Promise.all(this._invokeAll(function(m){return m.extendMaterialParams&&m.extendMaterialParams(e,s)})))}const h=a.alphaMode||Mh.OPAQUE;if(h===Mh.BLEND?(s.transparent=!0,i!==Ba&&(s.depthWrite=!1)):(s.transparent=!1,h===Mh.MASK&&(s.alphaTest=a.alphaCutoff!==void 0?a.alphaCutoff:.5)),a.normalTexture!==void 0&&i!==hr&&(u.push(t.assignTexture(s,"normalMap",a.normalTexture)),s.normalScale=new Ee(1,1),a.normalTexture.scale!==void 0)){const f=a.normalTexture.scale;s.normalScale.set(f,f)}return a.occlusionTexture!==void 0&&i!==hr&&(u.push(t.assignTexture(s,"aoMap",a.occlusionTexture)),a.occlusionTexture.strength!==void 0&&(s.aoMapIntensity=a.occlusionTexture.strength)),a.emissiveFactor!==void 0&&i!==hr&&(s.emissive=new Qe().fromArray(a.emissiveFactor)),a.emissiveTexture!==void 0&&i!==hr&&u.push(t.assignTexture(s,"emissiveMap",a.emissiveTexture,3001)),Promise.all(u).then(function(){const f=new i(s);a.name&&(f.name=a.name),f.map&&(f.map.encoding=3001),f.emissiveMap&&(f.emissiveMap.encoding=3001);const m=t.plugins[wn.S8S_V3D_MATERIALS];return f.isMeshNodeMaterial&&m.assignTransparency(f,a,h),f.isMeshStandardMaterial&&f.normalScale&&m&&_e(m.profile)&&m.profile=="max"&&(f.normalScale.y=-f.normalScale.y),dc(f,a),t.associations.set(f,{materials:e}),a.extensions&&Zf(r,f,a),f})}createUniqueName(e){const t=e;let n=t;for(let r=1;this.nodeNamesUsed[n];++r)n=t+"_"+r;return this.nodeNamesUsed[n]=!0,n}loadGeometries(e){const t=this;this.extensions;const n=this.primitiveCache,r=[];for(let a=0,i=e.length;a<i;a++){const s=e[a],c=Roe(s),u=n[c];if(u)r.push(u.promise);else{let h=Noe(new mt,s,t);n[c]={primitive:s,promise:h},r.push(h)}}return Promise.all(r)}loadMesh(e){const t=this,n=this.json,r=this.extensions,a=n.meshes[e],i=a.primitives,s=[],c=_e(a.extensions)?a.extensions[wn.S8S_V3D_MESH]:void 0;for(let u=0,h=i.length;u<h;u++){const f=i[u].material===void 0?CP(this.cache):this.getDependency("material",i[u].material);s.push(f)}return s.push(t.loadGeometries(i)),Promise.all(s).then(function(u){const h=u.slice(0,u.length-1),f=u[u.length-1],m=[];for(let A=0,_=f.length;A<_;A++){const x=f[A],C=i[A];let b;const y=h[A];if(C.mode===es.TRIANGLES||C.mode===es.TRIANGLE_STRIP||C.mode===es.TRIANGLE_FAN||C.mode===void 0)b=a.isSkinnedMesh===!0?new Hg(x,y):new Mt(x,y),b.isSkinnedMesh!==!0||b.geometry.attributes.skinWeight.normalized||b.normalizeSkinWeights(),C.mode===es.TRIANGLE_STRIP?b.geometry=HT(b.geometry,1):C.mode===es.TRIANGLE_FAN&&(b.geometry=HT(b.geometry,2));else if(C.mode===es.LINES)if(c){const T=new RB;T.fromBufferGeometry(x);const w=new tb({color:_e(c.lineColor)?new Qe().fromArray(c.lineColor):new Qe(1,1,1),lineWidth:_e(c.lineWidth)?c.lineWidth:1,sizeAttenuation:0});b=new Mt(T.geometry,w),b.userData.originalLineGeom=x}else b=new jo(x,y);else if(C.mode===es.LINE_STRIP)b=new vi(x,y);else if(C.mode===es.LINE_LOOP)b=new P5(x,y);else{if(C.mode!==es.POINTS)throw new Error("v3d.GLTFLoader: Primitive mode unsupported: "+C.mode);b=new N5(x,y)}Object.keys(b.geometry.morphAttributes).length>0&&Toe(b,a),b.name=t.createUniqueName(a.name||"mesh_"+e),dc(b,a),C.extensions&&Zf(r,b,C);const M={},R={};if(b.material.isMeshNodeMaterial&&c){if(c.uvLayers)for(let T in c.uvLayers)M[T]=MP(c.uvLayers[T]);if(c.colorLayers)for(let T in c.colorLayers)R[T]=wP(c.colorLayers[T])}t.assignFinalMaterial(b,M,R),m.push(b)}for(let A=0,_=m.length;A<_;A++)t.associations.set(m[A],{meshes:e,primitives:A});if(m.length===1)return m[0];const g=new Da;t.associations.set(g,{meshes:e});for(let A=0,_=m.length;A<_;A++)m[A].name+="_"+A,m[A].isMaterialGeneratedMesh=!0,g.add(m[A]);return g})}loadCamera(e){let t;const n=this.json.cameras[e],r=n[n.type];if(r)return n.type==="perspective"?t=new ir(vv(r.yfov),r.aspectRatio||1,r.znear||1,r.zfar||2e6):n.type==="orthographic"&&(t=new yi(-r.xmag,r.xmag,r.ymag,-r.ymag,r.znear,r.zfar)),n.name&&(t.name=n.name),dc(t,n),this._invokeOne(function(a){return a.extendCameraParams&&a.extendCameraParams(t,n)});console.warn("v3d.GLTFLoader: Missing camera parameters.")}loadSkin(e){const t=this.json.skins[e],n=[];for(let r=0,a=t.joints.length;r<a;r++)n.push(this.getDependency("node",t.joints[r]));return t.inverseBindMatrices!==void 0?n.push(this.getDependency("accessor",t.inverseBindMatrices)):n.push(null),Promise.all(n).then(function(r){const a=r.pop(),i=r,s=[],c=[];for(let u=0,h=i.length;u<h;u++){const f=i[u];if(f){s.push(f);const m=new Ve;a!==null&&m.fromArray(a.array,16*u),c.push(m)}else console.warn('v3d.GLTFLoader: Joint "%s" could not be found.',t.joints[u])}return new Ev(s,c)})}loadAnimation(e){const t=this.json.animations[e],n=[],r=[],a=[],i=[],s=[];for(let c=0,u=t.channels.length;c<u;c++){const h=t.channels[c],f=t.samplers[h.sampler],m=h.target,g=m.node,A=t.parameters!==void 0?t.parameters[f.input]:f.input,_=t.parameters!==void 0?t.parameters[f.output]:f.output;n.push(this.getDependency("node",g)),r.push(this.getDependency("accessor",A)),a.push(this.getDependency("accessor",_)),i.push(f),s.push(m)}return Promise.all([Promise.all(n),Promise.all(r),Promise.all(a),Promise.all(i),Promise.all(s),this.getDependencies("material")]).then(function(c){const u=c[0],h=c[1],f=c[2],m=c[3],g=c[4],A=[];for(let b=0,y=u.length;b<y;b++){const M=u[b],R=h[b],T=f[b],w=m[b],D=g[b];if(M===void 0)continue;let z;M.updateMatrix();let F="";switch(ts[D.path]){case ts.weights:z=Sc;break;case ts.rotation:z=bc;break;case ts.translation:case ts.scale:z=$h;break;case ts.intensity:z=Sc;break;default:if(D.path.indexOf("constraint")>-1)z=Sc,F="constraints["+D.path.match(/".*"/g)[0]+"]."+D.path.match(/[^\\.]*$/g)[0];else{let he;z=$h,D.path.indexOf("nodeValue")>-1?(he=D.path.match(/".*"/g)[0],F="material.nodeValue["+he+"]"):D.path.indexOf("nodeRGB")>-1&&(he=D.path.match(/".*"/g)[0],F="material.nodeRGB["+he+"]")}}const O=M.name?M.name:M.uuid,q=w.interpolation!==void 0?Moe[w.interpolation]:2301,ne=[];if(ts[D.path]===ts.weights)M.traverse(function(he){he.morphTargetInfluences&&ne.push(he.name?he.name:he.uuid)});else if(D.path.indexOf("material")>-1){const he=c[5];M.traverse(function(K){if(!K.isMesh||!K.material.isMeshNodeMaterial)return;let oe=!1;if(D.extras){oe=he[D.extras.material].name===K.material.name;const ie=D.path.match(/\["(.*)"\]/);oe=oe&&ie!==null&&K.material.findNodeByName(ie[1])!==null}else oe=!0;oe&&ne.push(K.name?K.name:K.uuid)})}else ne.push(O);let $=T.array;if(T.normalized){const he=W2($.constructor),K=new Float32Array($.length);for(let oe=0,ie=$.length;oe<ie;oe++)K[oe]=$[oe]*he;$=K}for(let he=0,K=ne.length;he<K;he++){const oe=new z(ne[he]+"."+(F!==""?F:ts[D.path]),R.array,$,q);w.interpolation==="CUBICSPLINE"&&(oe.createInterpolant=function(ie){return new(this instanceof bc?Coe:bP)(this.times,this.values,this.getValueSize()/3,ie)},oe.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),A.push(oe)}}const _=t.name?t.name:"animation_"+e,x={clip:new jg(_,void 0,A),nodeId:u[0].id,auto:!0,loop:2201,repetitions:1/0,startAt:0},C=_e(t.extensions)?t.extensions[wn.S8S_V3D_ANIMATION]:void 0;if(C){x.auto=C.auto;const b=C.repeatInfinite?1/0:C.repeatCount;switch(C.loop){case"ONCE":x.loop=2200;break;case"REPEAT":x.loop=2201,x.repetitions=b;break;case"PING_PONG":x.loop=2202,x.repetitions=b}x.startAt=C.offset}return x})}createNodeMesh(e){const t=this.json,n=this,r=t.nodes[e];return r.mesh===void 0?null:n.getDependency("mesh",r.mesh).then(function(a){const i=n._getNodeRef(n.meshCache,r.mesh,a);return r.weights!==void 0&&i.traverse(function(s){if(s.isMesh)for(let c=0,u=r.weights.length;c<u;c++)s.morphTargetInfluences[c]=r.weights[c]}),i})}loadNode(e){const t=this.json,n=this.extensions,r=this,a=t.nodes[e],i=a.name?r.createUniqueName(a.name):"";return function(){const s=[],c=r._invokeOne(function(u){return u.createNodeMesh&&u.createNodeMesh(e)});return c&&s.push(c),a.camera!==void 0&&s.push(r.getDependency("camera",a.camera).then(function(u){return r._getNodeRef(r.cameraCache,a.camera,u)})),r._invokeAll(function(u){return u.createNodeAttachment&&u.createNodeAttachment(e)}).forEach(function(u){s.push(u)}),Promise.all(s)}().then(function(s){let c;if(c=a.isBone===!0?new B5:s.length>1?new Da:s.length===1?s[0]:new Tt,c!==s[0])for(let u=0,h=s.length;u<h;u++)c.add(s[u]);if(a.name&&(c.userData.name=a.name,c.name=i),dc(c,a),a.extensions&&Zf(n,c,a),a.matrix!==void 0){const u=new Ve;u.fromArray(a.matrix),c.applyMatrix4(u)}else a.translation!==void 0&&c.position.fromArray(a.translation),a.rotation!==void 0&&c.quaternion.fromArray(a.rotation),a.scale!==void 0&&c.scale.fromArray(a.scale);return r.associations.has(c)||r.associations.set(c,{}),r.associations.get(c).nodes=e,c}).then(function(s){return s.resolveMultiMaterial().forEach(c=>{r._invokeOne(function(u){if(c!==s)return u.extendNodeParams&&u.extendNodeParams(c,a)})}),r._invokeOne(function(c){return c.extendNodeParams&&c.extendNodeParams(s,a)})})}loadScene(e){const t=this.json,n=this.extensions,r=this.json.scenes[e],a=this,i=new Hr;r.name&&(i.name=a.createUniqueName(r.name)),dc(i,r),r.extensions&&Zf(n,i,r);const s=r.nodes||[],c=[];for(let u=0,h=s.length;u<h;u++)c.push(EP(s[u],i,t,a));return Promise.all(c).then(function(){return a.associations=(u=>{const h=new Map;for(const[f,m]of a.associations)(f instanceof Er||f instanceof In)&&h.set(f,m);return u.traverse(f=>{const m=a.associations.get(f);m!=null&&h.set(f,m)}),h})(i),i})}}function EP(o,e,t,n){const r=t.nodes[o];return n.getDependency("node",o).then(function(a){return r.skin===void 0?a:n.getDependency("skin",r.skin).then(function(i){return a.traverse(function(s){s.isSkinnedMesh&&s.bind(i,s.matrixWorld)}),a})}).then(function(a){e.add(a),(a.isDirectionalLight||a.isSpotLight)&&a.isFreeLight&&e.add(a.target);const i=[];if(r.children){const s=r.children;for(let c=0,u=s.length;c<u;c++){const h=s[c];i.push(EP(h,a,t,n))}}return Promise.all(i)})}function Poe(o,e,t){const n=e.attributes,r=new mn;if(n.POSITION===void 0)return;{const s=t.json.accessors[n.POSITION],c=s.min,u=s.max;if(c===void 0||u===void 0)return void console.warn("v3d.GLTFLoader: Missing min/max properties for accessor POSITION.");if(r.set(new B(c[0],c[1],c[2]),new B(u[0],u[1],u[2])),s.normalized){const h=W2(Eh[s.componentType]);r.min.multiplyScalar(h),r.max.multiplyScalar(h)}}const a=e.targets;if(a!==void 0){const s=new B,c=new B;for(let u=0,h=a.length;u<h;u++){const f=a[u];if(f.POSITION!==void 0){const m=t.json.accessors[f.POSITION],g=m.min,A=m.max;if(g!==void 0&&A!==void 0){if(c.setX(Math.max(Math.abs(g[0]),Math.abs(A[0]))),c.setY(Math.max(Math.abs(g[1]),Math.abs(A[1]))),c.setZ(Math.max(Math.abs(g[2]),Math.abs(A[2]))),m.normalized){const _=W2(Eh[m.componentType]);c.multiplyScalar(_)}s.max(c)}else console.warn("v3d.GLTFLoader: Missing min/max properties for accessor POSITION.")}}r.expandByVector(s)}o.boundingBox=r;const i=new Yo;r.getCenter(i.center),i.radius=r.min.distanceTo(r.max)/2,o.boundingSphere=i}function Noe(o,e,t){const n=e.attributes,r=[];function a(i,s){return t.getDependency("accessor",i).then(function(c){o.setAttribute(s,c)})}for(const i in n){const s=Eoe[i]||Doe(i)||i.toLowerCase();s in o.attributes||r.push(a(n[i],s))}if(e.indices!==void 0&&!o.index){const i=t.getDependency("accessor",e.indices).then(function(s){o.setIndex(s)});r.push(i)}return dc(o,e),Poe(o,e,t),Promise.all(r).then(function(){return e.targets!==void 0?woe(o,e.targets,t):o})}function HT(o,e){let t=o.getIndex();if(t===null){const i=[],s=o.getAttribute("position");if(s===void 0)return console.error("v3d.GLTFLoader.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),o;for(let c=0;c<s.count;c++)i.push(c);o.setIndex(i),t=o.getIndex()}const n=t.count-2,r=[];if(e===2)for(let i=1;i<=n;i++)r.push(t.getX(0)),r.push(t.getX(i)),r.push(t.getX(i+1));else for(let i=0;i<n;i++)i%2==0?(r.push(t.getX(i)),r.push(t.getX(i+1)),r.push(t.getX(i+2))):(r.push(t.getX(i+2)),r.push(t.getX(i+1)),r.push(t.getX(i)));r.length/3!==n&&console.error("v3d.GLTFLoader.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const a=o.clone();return a.setIndex(r),a}function Doe(o){return o.indexOf("TEXCOORD_")>-1?MP(o):o.indexOf("COLOR_")>-1?wP(o):""}function MP(o){return o=="TEXCOORD_0"?"uv":"uv"+String(Number(o.split("TEXCOORD_")[1])+1)}function wP(o){return o=="COLOR_0"?"color":"color"+String(Number(o.split("COLOR_")[1])+1)}function TP(o){o.blending=5,o.blendEquation=100,o.blendSrc=201,o.blendDst=205}const WT=new Qe;class RP extends oo{constructor(e,t,n=512,r=512){super(),this.scene=e,this.camera=t,this.width=n,this.height=r,this.distance=.1,this.factor=1,this.precision=1,this.bentNormals=!1,this.noiseTexture=this.createNoiseTexture(),this.fsQuad=new Ga(null);const a=new Hy;a.type=1014,this.renderTargetNormalDepth=new qt(this.width,this.height,{format:1023,depthTexture:a,depthBuffer:!0}),this.renderTargetNormalDepth.texture.name="GTAO.normal",this.renderTargetNormalDepth.depthTexture.name="GTAO.depth",this.renderTargetGTAO=new qt(this.width,this.height),this.renderTargetGTAO.texture.name="GTAO.gtao",this.renderTargetBlurX=new qt(this.width,this.height),this.renderTargetBlurX.texture.name="GTAO.blur",this.renderTarget=new qt(this.width,this.height),this.renderTarget.texture.name="GTAO.rt",this.materialNormal=new q5({}),this.materialGTAO=new An({type:"GTAO",defines:{ORTHO_CAMERA:0,CALC_BENT_NORMALS:0},extensions:{derivatives:!0},uniforms:{tNormal:{value:null},tDepth:{value:null},tNoise:{value:null},occlDistance:{value:.1},factor:{value:1},occlPrecision:{value:1},mainCameraProjMat:{value:new Ve},resolution:{value:new Ee}},vertexShader:Ye.pp_plane_vert,fragmentShader:Ye.pp_gtao_frag}),this.materialBlur=new An({type:"GTAOBlur",defines:{},uniforms:{tDiffuse:{value:null},tNormal:{value:null},direction:{value:new Ee},resolution:{value:new Ee}},customPrepTokens:{BLUR_RADIUS_PX:2},vertexShader:Ye.pp_plane_vert,fragmentShader:Ye.pp_gtao_blur_frag}),this._layerMasks={}}setCamera(e){this.camera=e}setSize(e,t){this.width=e,this.height=t,this.renderTargetNormalDepth.setSize(e,t),this.renderTargetGTAO.setSize(e,t),this.renderTargetBlurX.setSize(e,t),this.renderTarget.setSize(e,t),this.materialGTAO.uniforms.mainCameraProjMat.value.copy(this.camera.projectionMatrix),this.materialGTAO.uniforms.resolution.value.set(this.renderTargetGTAO.width,this.renderTargetGTAO.height),this.materialBlur.uniforms.resolution.value.set(this.renderTargetGTAO.width,this.renderTargetGTAO.height)}dispose(){this.dispatchEvent({type:"dispose"}),this.renderTargetNormalDepth.dispose(),this.renderTargetGTAO.dispose(),this.renderTargetBlurX.dispose(),this.renderTarget.dispose(),this.materialNormal.dispose(),this.materialGTAO.dispose(),this.materialBlur.dispose(),this.noiseTexture.dispose()}_saveLayers(){this.scene.traverse(e=>this._layerMasks[e.id]=e.layers.mask)}_setupLayers(){this.scene.traverse(e=>{e.layers.disableAll();const t=e instanceof Mt&&e.material&&!e.material.gtaoVisible,n=e instanceof Mt&&e.material&&e.material.isMeshNodeMaterial&&(e.material.alphaTest>0||e.material.alphaToCoverage);t?e.layers.enable(0):n?e.layers.enable(1):e.layers.enable(2)})}_restoreLayers(){this.scene.traverse(e=>e.layers.mask=this._layerMasks[e.id])}_setupNodeAlphaClipHashMaterials(){this.scene.traverse(e=>{e instanceof Mt&&e.material&&e.material.isMeshNodeMaterial&&(e.material.defines.NORMAL_OUTPUT=Number(e.material.alphaTest>0||e.material.alphaToCoverage),e.material.needsUpdate=!0)})}_restoreNodeAlphaClipHashMaterials(){this.scene.traverse(e=>{e instanceof Mt&&e.material&&e.material.isMeshNodeMaterial&&(e.material.defines.NORMAL_OUTPUT=0,e.material.needsUpdate=!0)})}render(e){this._saveLayers(),this._setupLayers(),this.camera.layers.disableAll(),this.camera.layers.enable(1),this._setupNodeAlphaClipHashMaterials(),this._renderOverride(e,null,this.renderTargetNormalDepth,8355839,1,!0),this._restoreNodeAlphaClipHashMaterials(),this.camera.layers.disableAll(),this.camera.layers.enable(2),this._renderOverride(e,this.materialNormal,this.renderTargetNormalDepth,null,null,!0),this._restoreLayers(),this.materialGTAO.defines.ORTHO_CAMERA=this.camera.isOrthographicCamera?1:0,this.materialGTAO.defines.CALC_BENT_NORMALS=this.bentNormals?1:0,this.materialGTAO.needsUpdate=!0,this.materialGTAO.uniforms.tNormal.value=this.renderTargetNormalDepth.texture,this.materialGTAO.uniforms.tDepth.value=this.renderTargetNormalDepth.depthTexture,this.materialGTAO.uniforms.tNoise.value=this.noiseTexture,this.materialGTAO.uniforms.occlDistance.value=this.distance,this.materialGTAO.uniforms.factor.value=this.factor,this.materialGTAO.uniforms.occlPrecision.value=this.precision,this.materialGTAO.uniforms.mainCameraProjMat.value.copy(this.camera.projectionMatrix),this.materialGTAO.uniforms.resolution.value.set(this.renderTargetGTAO.width,this.renderTargetGTAO.height),this._renderPass(e,this.materialGTAO,this.renderTargetGTAO),this.materialBlur.uniforms.tDiffuse.value=this.renderTargetGTAO.texture,this.materialBlur.map=this.renderTargetGTAO.texture,this.materialBlur.uniforms.tNormal.value=this.renderTargetNormalDepth.texture,this.materialBlur.uniforms.direction.value.set(1,0),this.materialBlur.uniforms.resolution.value.set(this.renderTargetGTAO.width,this.renderTargetGTAO.height),this._renderPass(e,this.materialBlur,this.renderTargetBlurX),this.materialBlur.uniforms.tDiffuse.value=this.renderTargetBlurX.texture,this.materialBlur.map=this.renderTargetBlurX.texture,this.materialBlur.uniforms.direction.value.set(0,1),this.materialBlur.uniforms.resolution.value.set(this.renderTargetBlurX.width,this.renderTargetBlurX.height),this._renderPass(e,this.materialBlur,this.renderTarget)}_renderOverride(e,t,n,r,a,i){const s=e.getRenderTarget(),c=e.getClearColor(WT),u=e.getClearAlpha(),h=e.autoClear,f=this.scene.background;e.setRenderTarget(n),r!=null&&(e.setClearColor(r),e.setClearAlpha(a??0),e.clear()),e.autoClear=!1,i&&(this.scene.background=null),t&&(this.scene.overrideMaterial=t),e.render(this.scene,this.camera),this.scene.overrideMaterial=null,e.setRenderTarget(s),e.setClearColor(c),e.setClearAlpha(u),e.autoClear=h,this.scene.background=f}_renderPass(e,t,n,r,a){const i=e.getRenderTarget(),s=e.getClearColor(WT),c=e.getClearAlpha(),u=e.autoClear;e.setRenderTarget(n),r!=null&&(e.setClearColor(r),e.setClearAlpha(a??0),e.clear()),e.autoClear=!1,this.fsQuad.material=t,this.fsQuad.render(e),e.setRenderTarget(i),e.setClearColor(s),e.setClearAlpha(c),e.autoClear=u}createNoiseTexture(){const e=new Uint8Array([101,192,145,80,53,136,86,207,229,131,240,6,58,41,171,13,199,63,175,128,113,55,246,66,115,213,157,59,243,114,68,169,255,60,216,5,200,37,250,65,170,48,153,108,125,211,137,29,120,82,38,213,25,198,15,150,33,131,173,16,140,180,9,206,134,20,117,176,99,222,124,190,95,33,198,221,86,68,241,157,227,142,253,96,72,135,169,102,204,253,89,195,50,233,94,38,185,86,235,72,149,163,25,2,146,75,254,14,164,189,0,100,49,187,162,8,181,222,240,52,7,73,41,109,210,123,76,150,226,161,44,11,242,51,107,232,212,116,177,54,141,37,207,77,115,19,59,235,110,42,83,122,160,184,224,148,2,164,248,24,203,109,129,192,208,138,83,182,61,132,28,229,96,121,224,173,248,197,88,127,147,29,193,210,139,96,237,30,63,191,102,54,69,178,32,93,63,170,36,247,17,201,80,155,245,18,60,133,151,32,219,206,165,67,230,20,57,12,171,128,84,221,139,13,236,146,220,252,20,120,222,150,99,166,43,108,196,183,89,45,9,107,74,49,4,100,175,117,246,71,198,113,241,39,174,119,46,82,1,157,105,195,72,9,127,239,217,6,69,145,211,166,230,181,240,136,190,251,87,155,35,219,143,50,22,159,213,92,191,127,212,41,135,237,50,206,88,58,176,118,36,234,27,114,64,93,157,119,21,214,45,129,187,105,92,208,182,66,6,249,27,167,62,185,78,172,29,160,188,25,139,249,161,84,130,254,203,14,37,226,59,143,77,238,0,166,18,254,79,133,103,153,205,113,94,246,12,216,100,116,227,76,209,48,97,186,1,53,144,192,82,169,108,179,28,198,65,228,42,151,122,197,233,53,74,222,24,146,123,56,141,255,3,151,106,20,200,220,73,174,104,216,131,248,7,209,156,86,112,136,177,58,223,11,36,140,241,8,195,178,232,85,200,43,65,180,240,133,61,149,120,231,22,46,71,30,92,230,121,52,242,215,97,26,110,186,89,172,158,102,50,70,34,156,15,189,126,91,34,168,10,245,39,91,163,243,152,202,140,42,188,17,163,8,203,77,156,237,63,118,32,130,251,165,112,208,98,235,161,213,228,81,110,194,178,14,125,185,111,61,173,103,253,71,144,39,125,250,45,207,15,217,177,202,88,1,226,132,75,26,56,12,119,203,46,137,66,209,77,220,3,238,19,80,129,218,179,90,193,168,132,98,146,81,19,235,142,59,183,44,250,174,104,144,69,155,251,97,230,145,33,99,49,159,212,196,31,56,110,225,22,62,2,183,245,55,123,40,106,215,17,150,116,218,194,238,31,186,0,23,55,162,241,194,135,87,118,147,236,4,158,244,75,117,228,35,109,194,67,155,78,168,199,91,64,8,135,47,88,169,212,129,181,111,11,65,170,227,40,68,176,95,201,46,142,209,154,90,165,218,255,188,232,27,121,244,35,163,79,206,124,242,103,72,223,83,204,123,25,247,10,191,111,136,26,85,187,18,236,51,134,7,144,13,99,48,138,227,190,101,223,24,153,60,41,149,30,255,45,152,184,103,78,162,51,252,217,128,171,104,70,197,30,84,114,57,176,205,70,4,148,54,253,181,113,6,231,191,134,172,95,220,56,211,141,233,205,16,66,40,224,5,122,243,179,211,226,127,247,158,85,111,174,126,15,73,202,167,87,215,17,116,3,71,130,19,35,90,124,154,182,98,248,148,57,156,96,43,73,196,34,16,218,237,42,208,94,143,38,247,122,67,52,201,234,164,249,177,199,61,1,108,76,167,31,204,80,231,22,170,0,147,93,120,183,64,28,161,239,57,185,105,28,159,139,184,106,40,81,114,145,242,219,190,239,53,138,112,11,187,133,107,204,239,168,54,141,102,193,81,221,134,9,216,78,229,244,90,23,153,225,10,95,160,43,132,23,214,195,89,47,215,252,62,38,82,228,21,214,251,2,151,109,21,175,197,149,44,5,173,64,210,52,196,69,29,172,83,118,13,154,236,175,119,26,159,137,112,189,44,131,75,171,121,49,232,92,126,62,101,205,130,117,250,138,180,125,207,254,58,225,97,67,37,142,74,98,182,210,7,68,152,202,94,34,243,200,70,39,252,166,16,224,188,32,84,21,100,231,12,106,148,199,178,249,164,5,229,55,245,87,165,234,105,14,225,60,184,140,158,214,27,115,143,74,51,162,147,238,47,76,167,36,137,3,48,126,104,201,189,128,18,47,124,31,244,180,160,115,23,10,101,79,179,193,233,93,246,107,217,4,192,154,221,91,186,234,79,24,219,85,33,152,223]),t=new Uint8Array([7,87,145,233,57,15,124,219,7,163,132,35,222,160,41,99,10,23,228,253,53,207,65,214,94,146,248,134,214,15,97,230,201,181,41,105,189,206,171,100,146,78,188,106,177,87,141,232,198,122,70,178,149,26,124,174,16,55,115,35,70,179,158,111,74,241,122,159,29,90,47,242,23,229,213,16,245,72,26,183,58,136,205,43,86,239,139,226,77,188,203,86,224,144,50,30,135,62,11,218,255,68,156,185,59,121,91,49,199,152,219,109,243,162,14,221,113,192,3,100,42,152,233,168,22,123,251,210,153,191,99,173,139,114,2,133,201,32,169,135,64,118,1,47,89,31,102,76,154,35,63,164,255,127,9,62,106,187,4,91,44,222,17,80,39,209,237,82,107,251,148,11,231,174,208,130,194,171,234,184,248,121,216,199,110,28,212,137,240,77,164,232,25,128,247,150,57,193,20,160,44,211,75,191,96,37,81,254,147,66,8,140,54,21,177,89,74,51,175,93,39,199,55,115,84,202,104,179,230,124,97,222,64,177,27,111,239,158,17,57,105,219,42,209,95,132,231,13,144,244,194,157,226,18,143,180,66,166,48,5,74,32,169,142,7,241,128,52,216,137,185,228,26,124,84,166,189,71,38,158,221,115,1,65,123,102,250,216,34,242,140,113,212,188,249,85,118,197,156,89,5,70,116,167,202,153,240,114,4,246,203,100,46,185,84,31,209,173,6,130,196,22,225,91,155,61,16,49,103,229,36,206,173,249,46,92,12,73,33,223,142,60,172,126,22,234,135,246,151,75,52,97,161,79,182,12,235,132,207,150,184,20,78,143,101,28,196,235,134,178,53,195,24,108,82,215,150,55,168,110,43,189,233,144,207,59,125,44,168,108,34,220,69,166,244,58,225,125,149,63,213,104,253,93,155,184,11,250,73,96,201,8,218,88,14,117,223,105,247,193,71,88,254,122,3,132,191,113,10,181,40,83,0,162,127,41,210,235,122,36,195,18,228,65,131,176,253,38,19,165,0,146,27,203,178,54,96,234,43,159,90,218,245,112,191,229,18,79,66,137,51,160,180,141,118,164,30,101,154,71,137,94,217,56,238,134,17,153,200,80,29,204,67,23,155,52,172,33,145,198,175,7,223,103,87,244,41,79,236,204,51,186,81,199,176,112,77,224,40,110,170,223,144,251,174,131,98,205,73,121,247,97,238,116,29,204,62,2,213,183,145,24,125,241,228,45,31,129,160,92,188,246,62,6,102,50,116,15,240,140,10,218,59,45,151,83,167,255,130,157,107,55,92,219,110,5,61,147,252,8,212,51,12,140,75,126,183,215,83,194,43,226,88,165,109,187,21,215,68,39,192,20,239,198,12,68,174,159,99,121,192,70,231,177,119,209,237,19,154,33,232,163,65,180,29,200,129,4,231,135,182,98,147,76,118,165,136,248,40,211,14,85,169,107,25,151,100,36,164,197,92,58,136,2,123,106,148,252,75,210,162,53,120,9,233,217,46,28,226,83,128,195,245,224,38,141,205,61,249,86,48,227,114,255,186,207,77,236,16,56,39,102,85,30,247,203,60,87,179,103,186,56,152,22,180,131,53,236,81,15,190,134,175,8,72,147,24,99,48,215,192,172,139,240,196,149,108,168,17,127,157,252,1,206,114,74,161,98,3,186,156,120,221,27,108,211,129,40,170,242,158,131,91,115,225,20,178,71,45,222,142,197,36,66,145,93,234,34,198,67,217,109,243,45,67,161,237,54,195,224,85,112,6,32,69,155,9,64,123,212,3,94,242,76,113,214,25,170,49,220,119,148,28,170,90,10,200,143,80,95,153,18,64,202,175,220,250,42,208,96,163,254,133,185,21,52,230,190,126,244,138,13,86,254,58,138,211,125,179,251,34,2,183,248,126,143,54,187,78,136,235,193,50,32,82,117,173,161,98,9,82,63,105,187,19,205,37,230,76,21,104,60,167,119,214,106,37,227,13,101,120,167,25,109,146,227,201,60,238,38,148,206,181,42,163,236,176,128,107,154,184,50,225,208,133,232,49,73,165,90,239,152,204,0,89,182,72,11,156,101,217,14,130,252,111,227,5,72,95,47,196,0,245,94,149,13,84,27,150,193,19,181,68,30,48,243,61,221,127,246,24,138,190,69,88,57,26,141,210,151,220,249,67,117,166,35,194,112,176,202,95,237,139,208,111,129,216,190,142,37,171,197,81,47,119,229,159,200,171,79,120,33,133,169,23,213,80,138,238,69,44,253,63,117,4,56,250,172,78,157,93,116,6,104,162,241,31,182,1,103,46,243,189,59]),n=new Uint8Array(4096);for(let a=0;a<1024;a++)n[4*a]=e[a],n[4*a+1]=t[a],n[4*a+2]=0,n[4*a+3]=0;const r=new ss(n,32,32,1023,1009);return r.name="GTAO.noise",r.wrapS=1e3,r.wrapT=1e3,r.needsUpdate=!0,r}}class Ooe{constructor(e=4){this.pool=e,this.queue=[],this.workers=[],this.workersResolve=[],this.workerStatus=0}_initWorker(e){if(!this.workers[e]){const t=this.workerCreator();t.addEventListener("message",this._onMessage.bind(this,e)),this.workers[e]=t}}_getIdleWorker(){for(let e=0;e<this.pool;e++)if(!(this.workerStatus&1<<e))return e;return-1}_onMessage(e,t){const n=this.workersResolve[e];if(n&&n(t),this.queue.length){const{resolve:r,msg:a,transfer:i}=this.queue.shift();this.workersResolve[e]=r,this.workers[e].postMessage(a,i)}else this.workerStatus^=1<<e}setWorkerCreator(e){this.workerCreator=e}setWorkerLimit(e){this.pool=e}postMessage(e,t){return new Promise(n=>{const r=this._getIdleWorker();r!==-1?(this._initWorker(r),this.workerStatus|=1<<r,this.workersResolve[r]=n,this.workers[r].postMessage(e,t)):this.queue.push({resolve:n,msg:e,transfer:t})})}dispose(){this.workers.forEach(e=>e.terminate()),this.workersResolve.length=0,this.workers.length=0,this.queue.length=0,this.workerStatus=0}}const wx=new WeakMap;let Tx=0;class si extends ma{constructor(e){super(e),this.transcoderPath="",this.transcoderBinary=null,this.transcoderPending=null,this.workerPool=new Ooe,this.workerSourceURL="",this.workerConfig=null,typeof MSC_TRANSCODER<"u"&&console.warn('v3d.KTX2Loader: Please update to latest "basis_transcoder". "msc_basis_transcoder" is no longer supported in three.js r125+.')}setTranscoderPath(e){return this.transcoderPath=e,this}setWorkerLimit(e){return this.workerPool.setWorkerLimit(e),this}detectSupport(e){return this.workerConfig={astcSupported:e.extensions.has("WEBGL_compressed_texture_astc"),etc1Supported:e.extensions.has("WEBGL_compressed_texture_etc1"),etc2Supported:e.extensions.has("WEBGL_compressed_texture_etc"),dxtSupported:e.extensions.has("WEBGL_compressed_texture_s3tc")&&e.extensions.has("WEBGL_compressed_texture_s3tc_srgb"),bptcSupported:e.extensions.has("EXT_texture_compression_bptc"),pvrtcSupported:e.extensions.has("WEBGL_compressed_texture_pvrtc")||e.extensions.has("WEBKIT_WEBGL_compressed_texture_pvrtc")},e.capabilities.isWebGL2&&(this.workerConfig.etc1Supported=!1),this}dispose(){return this.workerPool.dispose(),this.workerSourceURL&&URL.revokeObjectURL(this.workerSourceURL),this}init(){if(!this.transcoderPending){const e=new fa(this.manager);e.setPath(this.transcoderPath),e.setWithCredentials(this.withCredentials);const t=e.loadAsync("basis_transcoder.js"),n=new fa(this.manager);n.setPath(this.transcoderPath),n.setResponseType("arraybuffer"),n.setWithCredentials(this.withCredentials);const r=n.loadAsync("basis_transcoder.wasm");this.transcoderPending=Promise.all([t,r]).then(([a,i])=>{const s=si.BasisWorker.toString(),c=["/* constants */","let _EngineFormat = "+JSON.stringify(si.EngineFormat),"let _TranscoderFormat = "+JSON.stringify(si.TranscoderFormat),"let _BasisFormat = "+JSON.stringify(si.BasisFormat),"/* basis_transcoder.js */",a,"/* worker */",s.substring(s.indexOf("{")+1,s.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([c])),this.transcoderBinary=i,this.workerPool.setWorkerCreator(()=>{const u=new Worker(this.workerSourceURL),h=this.transcoderBinary.slice(0);return u.postMessage({type:"init",config:this.workerConfig,transcoderBinary:h},[h]),u})}),Tx>0&&console.warn("v3d.KTX2Loader: Multiple active KTX2 loaders may cause performance issues. Use a single KTX2Loader instance, or call .dispose() on old instances."),Tx++}return this.transcoderPending}load(e,t,n,r){if(this.workerConfig===null)throw new Error("v3d.KTX2Loader: Missing initialization with `.detectSupport(renderer)`.");const a=new fa(this.manager);a.setResponseType("arraybuffer"),a.setWithCredentials(this.withCredentials);const i=new il;return a.load(e,s=>{if(wx.has(s))return wx.get(s).promise.then(t).catch(r);this._createTexture([s]).then(function(c){i.copy(c),i.needsUpdate=!0,t&&t(i)}).catch(r)},n,r),i}_createTextureFrom(e){const{mipmaps:t,width:n,height:r,format:a,type:i,error:s,dfdTransferFn:c,dfdFlags:u}=e;if(i==="error")return Promise.reject(s);const h=new il(t,n,r,a,1009);return h.minFilter=t.length===1?1006:1008,h.magFilter=1006,h.generateMipmaps=!1,h.needsUpdate=!0,h.encoding=c===2?3001:3e3,h.premultiplyAlpha=!!(1&u),h}_createTexture(e,t={}){const n=t,r=this.init().then(()=>this.workerPool.postMessage({type:"transcode",buffers:e,taskConfig:n},e)).then(a=>this._createTextureFrom(a.data));return wx.set(e[0],{promise:r}),r}dispose(){return URL.revokeObjectURL(this.workerSourceURL),this.workerPool.dispose(),Tx--,this}}si.BasisFormat={ETC1S:0,UASTC_4x4:1},si.TranscoderFormat={ETC1:0,ETC2:1,BC1:2,BC3:3,BC4:4,BC5:5,BC7_M6_OPAQUE_ONLY:6,BC7_M5:7,PVRTC1_4_RGB:8,PVRTC1_4_RGBA:9,ASTC_4x4:10,ATC_RGB:11,ATC_RGBA_INTERPOLATED_ALPHA:12,RGBA32:13,RGB565:14,BGR565:15,RGBA4444:16},si.EngineFormat={RGBAFormat:1023,RGBA_ASTC_4x4_Format:37808,RGBA_BPTC_Format:36492,RGBA_ETC2_EAC_Format:37496,RGBA_PVRTC_4BPPV1_Format:35842,RGBA_S3TC_DXT5_Format:33779,RGB_ETC1_Format:36196,RGB_ETC2_Format:37492,RGB_PVRTC_4BPPV1_Format:35840,RGB_S3TC_DXT1_Format:33776},si.BasisWorker=function(){let o,e,t;const n=_EngineFormat,r=_TranscoderFormat,a=_BasisFormat;self.addEventListener("message",function(h){const f=h.data;switch(f.type){case"init":o=f.config,m=f.transcoderBinary,e=new Promise(g=>{t={wasmBinary:m,onRuntimeInitialized:g},BASIS(t)}).then(()=>{t.initializeBasis(),t.KTX2File===void 0&&console.warn("v3d.KTX2Loader: Please update Basis Universal transcoder.")});break;case"transcode":e.then(()=>{try{const{width:g,height:A,hasAlpha:_,mipmaps:x,format:C,dfdTransferFn:b,dfdFlags:y}=function(R){const T=new t.KTX2File(new Uint8Array(R));function w(){T.close(),T.delete()}if(!T.isValid())throw w(),new Error("v3d.KTX2Loader:    Invalid or unsupported .ktx2 file");const D=T.isUASTC()?a.UASTC_4x4:a.ETC1S,z=T.getWidth(),F=T.getHeight(),O=T.getLevels(),q=T.getHasAlpha(),ne=T.getDFDTransferFunc(),$=T.getDFDFlags(),{transcoderFormat:he,engineFormat:K}=function(ie,L,U,k){let J,de;const te=ie===a.ETC1S?s:c;for(let le=0;le<te.length;le++){const V=te[le];if(o[V.if]&&V.basisFormat.includes(ie)&&!(k&&V.transcoderFormat.length<2)&&(!V.needsPowerOfTwo||u(L)&&u(U)))return J=V.transcoderFormat[k?1:0],de=V.engineFormat[k?1:0],{transcoderFormat:J,engineFormat:de}}return console.warn("v3d.KTX2Loader: No suitable compressed texture format found. Decoding to RGBA32."),J=r.RGBA32,de=n.RGBAFormat,{transcoderFormat:J,engineFormat:de}}(D,z,F,q);if(!z||!F||!O)throw w(),new Error("v3d.KTX2Loader:    Invalid texture");if(!T.startTranscoding())throw w(),new Error("v3d.KTX2Loader: .startTranscoding failed");const oe=[];for(let ie=0;ie<O;ie++){const L=T.getImageLevelInfo(ie,0,0),U=L.origWidth,k=L.origHeight,J=new Uint8Array(T.getImageTranscodedSizeInBytes(ie,0,0,he));if(!T.transcodeImage(J,ie,0,0,he,0,-1,-1))throw w(),new Error("v3d.KTX2Loader: .transcodeImage failed.");oe.push({data:J,width:U,height:k})}return w(),{width:z,height:F,hasAlpha:q,mipmaps:oe,format:K,dfdTransferFn:ne,dfdFlags:$}}(f.buffers[0]),M=[];for(let R=0;R<x.length;++R)M.push(x[R].data.buffer);self.postMessage({type:"transcode",id:f.id,width:g,height:A,hasAlpha:_,mipmaps:x,format:C,dfdTransferFn:b,dfdFlags:y},M)}catch(g){console.error(g),self.postMessage({type:"error",id:f.id,error:g.message})}})}var m});const i=[{if:"astcSupported",basisFormat:[a.UASTC_4x4],transcoderFormat:[r.ASTC_4x4,r.ASTC_4x4],engineFormat:[n.RGBA_ASTC_4x4_Format,n.RGBA_ASTC_4x4_Format],priorityETC1S:1/0,priorityUASTC:1,needsPowerOfTwo:!1},{if:"bptcSupported",basisFormat:[a.ETC1S,a.UASTC_4x4],transcoderFormat:[r.BC7_M5,r.BC7_M5],engineFormat:[n.RGBA_BPTC_Format,n.RGBA_BPTC_Format],priorityETC1S:3,priorityUASTC:2,needsPowerOfTwo:!1},{if:"dxtSupported",basisFormat:[a.ETC1S,a.UASTC_4x4],transcoderFormat:[r.BC1,r.BC3],engineFormat:[n.RGB_S3TC_DXT1_Format,n.RGBA_S3TC_DXT5_Format],priorityETC1S:4,priorityUASTC:5,needsPowerOfTwo:!1},{if:"etc2Supported",basisFormat:[a.ETC1S,a.UASTC_4x4],transcoderFormat:[r.ETC1,r.ETC2],engineFormat:[n.RGB_ETC2_Format,n.RGBA_ETC2_EAC_Format],priorityETC1S:1,priorityUASTC:3,needsPowerOfTwo:!1},{if:"etc1Supported",basisFormat:[a.ETC1S,a.UASTC_4x4],transcoderFormat:[r.ETC1],engineFormat:[n.RGB_ETC1_Format],priorityETC1S:2,priorityUASTC:4,needsPowerOfTwo:!1},{if:"pvrtcSupported",basisFormat:[a.ETC1S,a.UASTC_4x4],transcoderFormat:[r.PVRTC1_4_RGB,r.PVRTC1_4_RGBA],engineFormat:[n.RGB_PVRTC_4BPPV1_Format,n.RGBA_PVRTC_4BPPV1_Format],priorityETC1S:5,priorityUASTC:6,needsPowerOfTwo:!0}],s=i.sort(function(h,f){return h.priorityETC1S-f.priorityETC1S}),c=i.sort(function(h,f){return h.priorityUASTC-f.priorityUASTC});function u(h){return h<=2||!(h&h-1)&&h!==0}};class IP{static fromCubeTexture(e){let t=0;const n=new B,r=new B,a=new Qe,i=[0,0,0,0,0,0,0,0,0],s=new Ju,c=s.coefficients;for(let h=0;h<6;h++){const f=e.image[h],m=f.width,g=f.height,A=document.createElement("canvas");A.width=m,A.height=g;const _=A.getContext("2d");_.drawImage(f,0,0,m,g);const x=_.getImageData(0,0,m,g),C=x.data,b=x.width,y=2/b;for(let M=0,R=C.length;M<R;M+=4){a.setRGB(C[M]/255,C[M+1]/255,C[M+2]/255),YT(a,e.encoding);const T=M/4,w=(T%b+.5)*y-1,D=1-(Math.floor(T/b)+.5)*y;switch(h){case 0:n.set(-1,D,-w);break;case 1:n.set(1,D,w);break;case 2:n.set(-w,1,-D);break;case 3:n.set(-w,-1,D);break;case 4:n.set(-w,D,1);break;case 5:n.set(w,D,-1)}const z=n.lengthSq(),F=4/(Math.sqrt(z)*z);t+=F,r.copy(n).normalize(),Ju.getBasisAt(r,i);for(let O=0;O<9;O++)c[O].x+=i[O]*a.r*F,c[O].y+=i[O]*a.g*F,c[O].z+=i[O]*a.b*F}}const u=4*Math.PI/t;for(let h=0;h<9;h++)c[h].x*=u,c[h].y*=u,c[h].z*=u;return new Kh(s)}static fromCubeRenderTarget(e,t){let n=0;const r=new B,a=new B,i=new Qe,s=[0,0,0,0,0,0,0,0,0],c=new Ju,u=c.coefficients,h=t.texture.type;for(let m=0;m<6;m++){const g=t.width,A=new(h===1016?Uint16Array:h===1015?Float32Array:Uint8Array)(g*g*4);e.readRenderTargetPixels(t,0,0,g,g,A,m);const _=2/g;for(let x=0,C=A.length;x<C;x+=4){h===1016?i.setRGB(hg(A[x]),hg(A[x+1]),hg(A[x+2])):h===1015?i.setRGB(A[x],A[x+1],A[x+2]):i.setRGB(A[x]/255,A[x+1]/255,A[x+2]/255),YT(i,t.texture.encoding);const b=x/4,y=(b%g+.5)*_-1,M=1-(Math.floor(b/g)+.5)*_;switch(m){case 0:r.set(1,M,-y);break;case 1:r.set(-1,M,y);break;case 2:r.set(y,1,-M);break;case 3:r.set(y,-1,M);break;case 4:r.set(y,M,1);break;case 5:r.set(-y,M,-1)}const R=r.lengthSq(),T=4/(Math.sqrt(R)*R);n+=T,a.copy(r).normalize(),Ju.getBasisAt(a,s);for(let w=0;w<9;w++)u[w].x+=s[w]*i.r*T,u[w].y+=s[w]*i.g*T,u[w].z+=s[w]*i.b*T}}const f=4*Math.PI/n;for(let m=0;m<9;m++)u[m].x*=f,u[m].y*=f,u[m].z*=f;return new Kh(c)}}function YT(o,e){switch(e){case 3001:o.convertSRGBToLinear();break;case 3e3:break;default:console.warn("WARNING: LightProbeGenerator convertColorToLinear() encountered an unsupported encoding.")}return o}class Foe extends vi{constructor(e,t){const n=new mt;n.setAttribute("position",new ut([1,1,0,-1,1,0,-1,-1,0,1,-1,0,1,1,0],3)),n.computeBoundingSphere(),super(n,new gr({fog:!1})),this.light=e,this.color=t,this.type="RectAreaLightHelper";const r=new mt;r.setAttribute("position",new ut([1,1,0,-1,1,0,-1,-1,0,1,1,0,-1,-1,0,1,-1,0],3)),r.computeBoundingSphere(),this.add(new Mt(r,new hr({side:1,fog:!1})))}updateMatrixWorld(){if(this.scale.set(.5*this.light.width,.5*this.light.height,1),this.color!==void 0)this.material.color.set(this.color),this.children[0].material.color.set(this.color);else{this.material.color.copy(this.light.color).multiplyScalar(this.light.intensity);const e=this.material.color,t=Math.max(e.r,e.g,e.b);t>1&&e.multiplyScalar(1/t),this.children[0].material.color.copy(this.material.color)}this.matrixWorld.extractRotation(this.light.matrixWorld).scale(this.scale).copyPosition(this.light.matrixWorld),this.children[0].matrixWorld.copy(this.matrixWorld)}dispose(){this.geometry.dispose(),this.material.dispose(),this.children[0].geometry.dispose(),this.children[0].material.dispose()}}var ld=function(){var o=0,e=document.createElement("div");function t(h){return e.appendChild(h.dom),h}function n(h){for(var f=0;f<e.children.length;f++)e.children[f].style.display=f===h?"block":"none";o=h}e.style.cssText="position:absolute;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",e.addEventListener("click",function(h){h.preventDefault(),n(++o%e.children.length)},!1);var r=(performance||Date).now(),a=r,i=0,s=t(new ld.Panel("FPS","#0ff","#002")),c=t(new ld.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var u=t(new ld.Panel("MB","#f08","#201"));return n(0),{REVISION:16,dom:e,addPanel:t,showPanel:n,begin:function(){r=(performance||Date).now()},end:function(){i++;var h=(performance||Date).now();if(c.update(h-r,200),h>=a+1e3&&(s.update(1e3*i/(h-a),100),a=h,i=0,u)){var f=performance.memory;u.update(f.usedJSHeapSize/1048576,f.jsHeapSizeLimit/1048576)}return h},update:function(){r=this.end()},domElement:e,setMode:n}};ld.Panel=function(o,e,t){var n=1/0,r=0,a=Math.round,i=a(window.devicePixelRatio||1),s=80*i,c=48*i,u=3*i,h=2*i,f=3*i,m=15*i,g=74*i,A=30*i,_=document.createElement("canvas");_.width=s,_.height=c,_.style.cssText="width:80px;height:48px";var x=_.getContext("2d");return x.font="bold "+9*i+"px Helvetica,Arial,sans-serif",x.textBaseline="top",x.fillStyle=t,x.fillRect(0,0,s,c),x.fillStyle=e,x.fillText(o,u,h),x.fillRect(f,m,g,A),x.fillStyle=t,x.globalAlpha=.9,x.fillRect(f,m,g,A),{dom:_,update:function(C,b){n=Math.min(n,C),r=Math.max(r,C),x.fillStyle=t,x.globalAlpha=1,x.fillRect(0,0,s,m),x.fillStyle=e,x.fillText(a(C)+" "+o+" ("+a(n)+"-"+a(r)+")",u,h),x.drawImage(_,f+i,m,g-i,A,f,m,g-i,A),x.fillRect(f+g-i,m,i,A),x.fillStyle=t,x.globalAlpha=.9,x.fillRect(f+g-i,m,i,a((1-C/b)*A))}}};const Kf=new B,$f=new B;class Uoe extends jo{constructor(e,t=1,n=16711680){var i;const r=new mt;if((i=e.geometry)==null?void 0:i.attributes.normal){const s=e.geometry.attributes.normal.count,c=new ut(2*s*3,3);r.setAttribute("position",c)}super(r,new gr({color:n,toneMapped:!1})),this.object=e,this.size=t,this.type="VertexNormalsHelper",this.matrixAutoUpdate=!1,this.update()}update(){var r,a;const e=this.geometry.attributes.position,t=(r=this.object.geometry)==null?void 0:r.attributes.position,n=(a=this.object.geometry)==null?void 0:a.attributes.normal;if(e&&t&&n){let i=0;for(let s=0,c=t.count;s<c;s++)Kf.fromBufferAttribute(t,s),$f.fromBufferAttribute(n,s),$f.normalize().multiplyScalar(this.size).add(Kf),e.setXYZ(i,Kf.x,Kf.y,Kf.z),i+=1,e.setXYZ(i,$f.x,$f.y,$f.z),i+=1;e.needsUpdate=!0}}dispose(){this.geometry.dispose(),this.material.dispose()}}class zoe extends jo{constructor(e,t="white"){super(new X5(e.geometry),new gr({color:t})),this.type="WireframeHelper",this.matrixAutoUpdate=!1}dispose(){this.geometry.dispose(),this.material.dispose()}}const Voe="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAIQXpUWHRSYXcgcHJvZmlsZSB0eXBlIGV4aWYAAHja7ZhZltw2DEX/uYosQSQ4LofjOdlBlp8LSqquHt12nD+X3JIKYpEg3sMDZDP/+XuZv/iIOGd8SDmWGA8+vvjiKjf5OD91n+3h93l//PWI76/s5vHAYRKucn7N8bJP7I7x7rL3a56KPTxNVOb1oL1+UK+JXL4WuOz3QmLPBY5rYlOvicRdK18utnNbRyw5PW+hX+PX9XyHgT+jJy/JxRBt8py9O1KKhfvsDp+I21BHV3dFfxfaNdGb7+Ye6vDJTbFycM7qoeC+FKmi93rGaSzCvUjY53J6ClrOHIn7csf1689Xnpvb9QvyV5A+7uwn9iekzQ7o/UDeIBQf1w/tNrzYzTOkG7enlWN8rPzKnufRXu35Rk3/1hp5rXnurvrIluO1qXsr+45xTaO1fxU5En/hyBpsPQpHJiU6PBqQrHF0W6wDxmW9HbbaZee+dttx0bvpElfnuhPbDcYMGMX1DbfXwy6XAH5IBvgOHQSre/hi97JlL9dtZuFhs4E9lsksP/lPh/nOoLU0oaw98iNW+OU00/BCkbPWHJZhIGLXFdSwA3wfbz+Kq4Bg2GHObLAeTWcA/hbsC7lkAy0MDFzPBLZpXBMQIjwIOGMFBI5oJdhoj4SwJWsJZAagiutOvGvAYkNwAyedF4mAQxawNr9Jdg91wZ1mhBAggkQjCWxITcDyPsCf5DMcqkGCDyHEkEIOJdQoUTMsxhRVUWuS5FNIMaWUU0nVZMk+hxxzyjmXXIsrguKGQj6WXEqplUUrM1d+XRlQa3NNmm+hxZZabqXV7kyX7nvosaeee+l1uCGDPB5xpJFHGXXaCZWmn2HGmWaeZdYF1ZYsv8KKK628iln1gdoF67vjJ1CzF2puI6UD0wM1rCndU1iVk6CYgZjzFsCTImDFOKeYHdl67xQ5xewoTkXQ4WRQcIZVxEDQT+vCsg/sXpALRuLvwc0AhPsdyBmF7hvIvcftI9RG3YVONkKahhrUQ8i+VdbM1eWqlfLLq/nRgO9e/0z0Z6LfNtEKlJIcBGEJdi4Y3YtQv/vMn9hbb2uO2qngQp1HkExeIqtF6sbqOjSLnimwjeScNfUo89iTZO/b7GHNot9iXc1v+ypRmpg4x9DZbZ/owSyht5CoP3X52YZQTUprFa0ItmIdx22xPvAvogdcVPyXdoNjrZpJ4+lZTtdDaj62hxnWigOhXduzQx+mQvaPZrNbk99ZfVDsDIMlgtBQLro75kMVI3Xb63P8HRXr6s2O0hI7YuI8TZLWlq8z1NZmxkfWRLdoCMcQIVAj5kCbeFkOhcg11PO8o7M6r+Z4Y/iJq4KdFVJt3w261qI9nXagWtvw6cKp96g4ZMIw/NZERidb2NYSDUzpabXiF3EzpaKqdZNqZSuTXqnN0CtBntdNmZYJStprx7kgxZCka/XWsc9qwzRVdkRnFEWjy8mRQDknXhkExoYgj6QNm96PWsKsM8EoejmdKOblTRMIQOt3ucsgJUigEUldCH5vJRCMcd1I1wWdMmKMNfyqcepalKOCefgzY9iGzOJ/Jd3Mhw9aLbrhTCyntQ44IOYBgdocpAPBbbGP1siF1bRxHYNyFKjJcD0EaAQs0EU0zcCEBBDNiuQn3CFPANTv3epZWd+CRs2zU7Og7coEZKcArFQGA8BOU5faUL/I3J0OuVAw2xqHzAHbywZiudFiNEM9XIMa3edcw7USP5WUzT5RLsA6JZ9SD/K07JoZAFUiPmdQak0CPlGYa/MptVDJT20yYguxkIT0DXQKexSrkjpz8QhlimYmdYF13enoS7Lj9CkCxcXzCa7Esl8AQBq6rDabFASNxDfMWcgaRzTRgIFeBRmje5n4GAJmnGIHE2qUtOBqhOpzOhnrHtCJiJnTPoAA9FmVwgzCETw7yqmHPwbBfIbCOxC6jSogCHVjYzWhLEk1KTQonoYhUIEbIQd4p42Wliu5ngJtT8Le6LXS6CdV5xIA+p3l6GY+dKCrHMp8mK0bSBPGK/WJ/d4U1PdiM3WhDiU9dQCRH6o4sxerpKcUyJGASZrjLVvTQ/XiJ0sAAj9ayPYW+8IbpLzW/3KkLUIvEnQKEG6FLW3OF3aksFMFtoZp+I0+giNUtd4xUutm3LTnZxLXmFQ5el3WkFEIPtPMorRGG2sfslIJ8NIaqxnbBKp7ckpOgDThLLn1kBGbnmRkvcgIlH+WkbLIoOC1LCAksc5RuviYqfE0yZeFd/2vomk+DSfceh1PLZ5k35uI3vXUvC+oKlTrUVBJ56eSyhJ5flhTzS8U1Q+v5ptF9aXK7ZuWNaXDJshY1S4xofutu27qtutxVSPSrffPqhGj39Ujan+5K9IXxXq+FPp3UhsAdw3TwQG5G3aWmEBohrt4qthpkCbBz4ntlcQXXreum5R1sbAXHs2QldBo9LOroE+gIaj52mBwabjzC2+lX17NjwbodeuhtFsPof1Q0UMOyTI0EO45g2lqG8k2i809EsB4quEkUrK1cKgW8mZb+UkcIAdcUXKyI9scHR1MY6I3jzUIZ2ODum6EgoaiEIrp9/YJmYP0QbMBnHLaCW2meqzsfm6AyYtX7S+id3W/vKle3e/OPRojdI/oDyOdRFVlrAORRx/igFKtQDte/oV654VGuvIKzMM2eCFuVB4SbD3CppXcXFE7i8guPY8i0l5XcpVqGsNjp1bjzGyCNLRgySyT5TY9R2fu2joo2cRhR6bsdCYa8P8MEJnzEqJpHiH6KEA6wXcCRHzMrwRovzykVEY/b/U/r81981+vfyb6M9H/MBF5RKaafwEjmLcIrlR0mgAAAAZiS0dEAP8A/wD/oL2nkwAAAAlwSFlzAAAuIwAALiMBeKU/dgAAAAd0SU1FB+MCAwojJyJFeN4AAAAZdEVYdENvbW1lbnQAQ3JlYXRlZCB3aXRoIEdJTVBXgQ4XAAAAd0lEQVR42u3YUQqAIBAFwLUDdf9zdCH7lwwEI2VnPkWQfWCvigAAAAAAgDTK1wecNWq7dpX+uaP7lw7gaZi3oUb3z3BkvwICEIAW+KcFRte3DWBGO7gCAhCAAHZ9FY6IpC3QG963gGeAAASgBRb6IwQAAAAAQCY34QUtIL9dJTwAAAAASUVORK5CYII=",koe=0,Goe=1,Qoe=2,Hoe=Math.pow(2,-24),Rx=Symbol("SKIP_GENERATION");function Woe(o){return o.index?o.index.count:o.attributes.position.count}function Pd(o){return Woe(o)/3}function Yoe(o,e=ArrayBuffer){return o>65535?new Uint32Array(new e(4*o)):new Uint16Array(new e(2*o))}function joe(o,e){if(!o.index){const t=o.attributes.position.count,n=Yoe(t,e.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer);o.setIndex(new $e(n,1));for(let r=0;r<t;r++)n[r]=r}}function LP(o,e){const t=Pd(o),n=e||o.drawRange,r=n.start/3,a=(n.start+n.count)/3,i=Math.max(0,r),s=Math.min(t,a)-i;return[{offset:Math.floor(i),count:Math.floor(s)}]}function BP(o,e){if(!o.groups||!o.groups.length)return LP(o,e);const t=[],n=new Set,r=e||o.drawRange,a=r.start/3,i=(r.start+r.count)/3;for(const c of o.groups){const u=c.start/3,h=(c.start+c.count)/3;n.add(Math.max(a,u)),n.add(Math.min(i,h))}const s=Array.from(n.values()).sort((c,u)=>c-u);for(let c=0;c<s.length-1;c++){const u=s[c],h=s[c+1];t.push({offset:Math.floor(u),count:Math.floor(h-u)})}return t}function Xoe(o,e){const t=Pd(o),n=BP(o,e).sort((i,s)=>i.offset-s.offset),r=n[n.length-1];r.count=Math.min(t-r.offset,r.count);let a=0;return n.forEach(({count:i})=>a+=i),t!==a}function Ix(o,e,t,n,r){let a=1/0,i=1/0,s=1/0,c=-1/0,u=-1/0,h=-1/0,f=1/0,m=1/0,g=1/0,A=-1/0,_=-1/0,x=-1/0;for(let C=6*e,b=6*(e+t);C<b;C+=6){const y=o[C+0],M=o[C+1],R=y-M,T=y+M;R<a&&(a=R),T>c&&(c=T),y<f&&(f=y),y>A&&(A=y);const w=o[C+2],D=o[C+3],z=w-D,F=w+D;z<i&&(i=z),F>u&&(u=F),w<m&&(m=w),w>_&&(_=w);const O=o[C+4],q=o[C+5],ne=O-q,$=O+q;ne<s&&(s=ne),$>h&&(h=$),O<g&&(g=O),O>x&&(x=O)}n[0]=a,n[1]=i,n[2]=s,n[3]=c,n[4]=u,n[5]=h,r[0]=f,r[1]=m,r[2]=g,r[3]=A,r[4]=_,r[5]=x}function qoe(o,e=null,t=null,n=null){const r=o.attributes.position,a=o.index?o.index.array:null,i=Pd(o),s=r.normalized;let c;e===null?(c=new Float32Array(6*i),t=0,n=i):(c=e,t=t||0,n=n||i);const u=r.array,h=r.offset||0;let f=3;r.isInterleavedBufferAttribute&&(f=r.data.stride);const m=["getX","getY","getZ"];for(let g=t;g<t+n;g++){const A=3*g,_=6*g;let x=A+0,C=A+1,b=A+2;a&&(x=a[x],C=a[C],b=a[b]),s||(x=x*f+h,C=C*f+h,b=b*f+h);for(let y=0;y<3;y++){let M,R,T;s?(M=r[m[y]](x),R=r[m[y]](C),T=r[m[y]](b)):(M=u[x+y],R=u[C+y],T=u[b+y]);let w=M;R<w&&(w=R),T<w&&(w=T);let D=M;R>D&&(D=R),T>D&&(D=T);const z=(D-w)/2,F=2*y;c[_+F+0]=w+z,c[_+F+1]=z+(Math.abs(w)+z)*Hoe}}return c}function Yn(o,e,t){return t.min.x=e[o],t.min.y=e[o+1],t.min.z=e[o+2],t.max.x=e[o+3],t.max.y=e[o+4],t.max.z=e[o+5],t}function jT(o){let e=-1,t=-1/0;for(let n=0;n<3;n++){const r=o[n+3]-o[n];r>t&&(t=r,e=n)}return e}function XT(o,e){e.set(o)}function qT(o,e,t){let n,r;for(let a=0;a<3;a++){const i=a+3;n=o[a],r=e[a],t[a]=n<r?n:r,n=o[i],r=e[i],t[i]=n>r?n:r}}function k0(o,e,t){for(let n=0;n<3;n++){const r=e[o+2*n],a=e[o+2*n+1],i=r-a,s=r+a;i<t[n]&&(t[n]=i),s>t[n+3]&&(t[n+3]=s)}}function Jf(o){const e=o[3]-o[0],t=o[4]-o[1],n=o[5]-o[2];return 2*(e*t+t*n+n*e)}const Zoe=(o,e)=>o.candidate-e.candidate,Ks=new Array(32).fill().map(()=>({count:0,bounds:new Float32Array(6),rightCacheBounds:new Float32Array(6),leftCacheBounds:new Float32Array(6),candidate:0})),G0=new Float32Array(6);function Koe(o,e,t,n,r,a){let i=-1,s=0;if(a===0)i=jT(e),i!==-1&&(s=(e[i]+e[i+3])/2);else if(a===1)i=jT(o),i!==-1&&(s=$oe(t,n,r,i));else if(a===2){const c=Jf(o);let u=1.25*r;const h=6*n,f=6*(n+r);for(let m=0;m<3;m++){const g=e[m],A=(e[m+3]-g)/32;if(r<8){const _=[...Ks];_.length=r;let x=0;for(let b=h;b<f;b+=6,x++){const y=_[x];y.candidate=t[b+2*m],y.count=0;const{bounds:M,leftCacheBounds:R,rightCacheBounds:T}=y;for(let w=0;w<3;w++)T[w]=1/0,T[w+3]=-1/0,R[w]=1/0,R[w+3]=-1/0,M[w]=1/0,M[w+3]=-1/0;k0(b,t,M)}_.sort(Zoe);let C=r;for(let b=0;b<C;b++){const y=_[b];for(;b+1<C&&_[b+1].candidate===y.candidate;)_.splice(b+1,1),C--}for(let b=h;b<f;b+=6){const y=t[b+2*m];for(let M=0;M<C;M++){const R=_[M];y>=R.candidate?k0(b,t,R.rightCacheBounds):(k0(b,t,R.leftCacheBounds),R.count++)}}for(let b=0;b<C;b++){const y=_[b],M=y.count,R=r-y.count,T=y.leftCacheBounds,w=y.rightCacheBounds;let D=0;M!==0&&(D=Jf(T)/c);let z=0;R!==0&&(z=Jf(w)/c);const F=1+1.25*(D*M+z*R);F<u&&(i=m,u=F,s=y.candidate)}}else{for(let C=0;C<32;C++){const b=Ks[C];b.count=0,b.candidate=g+A+C*A;const y=b.bounds;for(let M=0;M<3;M++)y[M]=1/0,y[M+3]=-1/0}for(let C=h;C<f;C+=6){let b=~~((t[C+2*m]-g)/A);b>=32&&(b=31);const y=Ks[b];y.count++,k0(C,t,y.bounds)}const _=Ks[31];XT(_.bounds,_.rightCacheBounds);for(let C=30;C>=0;C--){const b=Ks[C],y=Ks[C+1];qT(b.bounds,y.rightCacheBounds,b.rightCacheBounds)}let x=0;for(let C=0;C<31;C++){const b=Ks[C],y=b.count,M=b.bounds,R=Ks[C+1].rightCacheBounds;y!==0&&(x===0?XT(M,G0):qT(M,G0,G0)),x+=y;let T=0,w=0;x!==0&&(T=Jf(G0)/c);const D=r-x;D!==0&&(w=Jf(R)/c);const z=1+1.25*(T*x+w*D);z<u&&(i=m,u=z,s=b.candidate)}}}}else console.warn(`MeshBVH: Invalid build strategy value ${a} used.`);return{axis:i,pos:s}}function $oe(o,e,t,n){let r=0;for(let a=e,i=e+t;a<i;a++)r+=o[6*a+2*n];return r/t}class Lx{constructor(){this.boundingData=new Float32Array(6)}}function Joe(o,e,t,n,r,a){let i=n,s=n+r-1;const c=a.pos,u=2*a.axis;for(;;){for(;i<=s&&t[6*i+u]<c;)i++;for(;i<=s&&t[6*s+u]>=c;)s--;if(!(i<s))return i;for(let h=0;h<3;h++){let f=e[3*i+h];e[3*i+h]=e[3*s+h],e[3*s+h]=f}for(let h=0;h<6;h++){let f=t[6*i+h];t[6*i+h]=t[6*s+h],t[6*s+h]=f}i++,s--}}function eae(o,e,t,n,r,a){let i=n,s=n+r-1;const c=a.pos,u=2*a.axis;for(;;){for(;i<=s&&t[6*i+u]<c;)i++;for(;i<=s&&t[6*s+u]>=c;)s--;if(!(i<s))return i;{let h=o[i];o[i]=o[s],o[s]=h;for(let f=0;f<6;f++){let m=t[6*i+f];t[6*i+f]=t[6*s+f],t[6*s+f]=m}i++,s--}}}function xo(o,e){return e[o+15]===65535}function Go(o,e){return e[o+6]}function la(o,e){return e[o+14]}function ca(o){return o+8}function ua(o,e){return e[o+6]}function PP(o,e){return e[o+7]}let NP,fh,vg,DP;const tae=Math.pow(2,32);function Y2(o){return"count"in o?1:1+Y2(o.left)+Y2(o.right)}function nae(o,e,t){return NP=new Float32Array(t),fh=new Uint32Array(t),vg=new Uint16Array(t),DP=new Uint8Array(t),j2(o,e)}function j2(o,e){const t=o/4,n=o/2,r="count"in e,a=e.boundingData;for(let i=0;i<6;i++)NP[t+i]=a[i];if(r){if(e.buffer){const i=e.buffer;DP.set(new Uint8Array(i),o);for(let s=o,c=o+i.byteLength;s<c;s+=32)xo(s/2,vg)||(fh[s/4+6]+=t);return o+i.byteLength}{const i=e.offset,s=e.count;return fh[t+6]=i,vg[n+14]=s,vg[n+15]=65535,o+32}}{const i=e.left,s=e.right,c=e.splitAxis;let u;if(u=j2(o+32,i),u/4>tae)throw new Error("MeshBVH: Cannot store child pointer greater than 32 bits.");return fh[t+6]=u/4,u=j2(u,s),fh[t+7]=c,u}}function rae(o,e){const t=(o.index?o.index.count:o.attributes.position.count)/3,n=t>65536,r=n?4:2,a=e?new SharedArrayBuffer(t*r):new ArrayBuffer(t*r),i=n?new Uint32Array(a):new Uint16Array(a);for(let s=0,c=i.length;s<c;s++)i[s]=s;return i}function oae(o,e,t,n,r){const{maxDepth:a,verbose:i,maxLeafTris:s,strategy:c,onProgress:u,indirect:h}=r,f=o._indirectBuffer,m=o.geometry,g=m.index?m.index.array:null,A=h?eae:Joe,_=Pd(m),x=new Float32Array(6);let C=!1;const b=new Lx;return Ix(e,t,n,b.boundingData,x),function M(R,T,w,D=null,z=0){if(!C&&z>=a&&(C=!0,i&&(console.warn(`MeshBVH: Max depth of ${a} reached when generating BVH. Consider increasing maxDepth.`),console.warn(m))),w<=s||z>=a)return y(T+w),R.offset=T,R.count=w,R;const F=Koe(R.boundingData,D,e,T,w,c);if(F.axis===-1)return y(T+w),R.offset=T,R.count=w,R;const O=A(f,g,e,T,w,F);if(O===T||O===T+w)y(T+w),R.offset=T,R.count=w;else{R.splitAxis=F.axis;const q=new Lx,ne=T,$=O-T;R.left=q,Ix(e,ne,$,q.boundingData,x),M(q,ne,$,x,z+1);const he=new Lx,K=O,oe=w-$;R.right=he,Ix(e,K,oe,he.boundingData,x),M(he,K,oe,x,z+1)}return R}(b,t,n,x),b;function y(M){u&&u(M/_)}}function aae(o,e){const t=o.geometry;e.indirect&&(o._indirectBuffer=rae(t,e.useSharedArrayBuffer),Xoe(t,e.range)&&!e.verbose&&console.warn('MeshBVH: Provided geometry contains groups or a range that do not fully span the vertex contents while using the "indirect" option. BVH may incorrectly report intersections on unrendered portions of the geometry.')),o._indirectBuffer||joe(t,e);const n=e.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer,r=qoe(t),a=e.indirect?LP(t,e.range):BP(t,e.range);o._roots=a.map(i=>{const s=oae(o,r,i.offset,i.count,e),c=Y2(s),u=new n(32*c);return nae(0,s,u),u})}class cs{constructor(){this.min=1/0,this.max=-1/0}setFromPointsField(e,t){let n=1/0,r=-1/0;for(let a=0,i=e.length;a<i;a++){const s=e[a][t];n=s<n?s:n,r=s>r?s:r}this.min=n,this.max=r}setFromPoints(e,t){let n=1/0,r=-1/0;for(let a=0,i=t.length;a<i;a++){const s=t[a],c=e.dot(s);n=c<n?c:n,r=c>r?c:r}this.min=n,this.max=r}isSeparated(e){return this.min>e.max||e.min>this.max}}cs.prototype.setFromBox=function(){const o=new B;return function(e,t){const n=t.min,r=t.max;let a=1/0,i=-1/0;for(let s=0;s<=1;s++)for(let c=0;c<=1;c++)for(let u=0;u<=1;u++){o.x=n.x*s+r.x*(1-s),o.y=n.y*c+r.y*(1-c),o.z=n.z*u+r.z*(1-u);const h=e.dot(o);a=Math.min(h,a),i=Math.max(h,i)}this.min=a,this.max=i}}();const iae=function(){const o=new B,e=new B,t=new B;return function(n,r,a){const i=n.start,s=o,c=r.start,u=e;t.subVectors(i,c),o.subVectors(n.end,n.start),e.subVectors(r.end,r.start);const h=t.dot(u),f=u.dot(s),m=u.dot(u),g=t.dot(s),A=s.dot(s)*m-f*f;let _,x;_=A!==0?(h*f-g*m)/A:0,x=(h+_*f)/m,a.x=_,a.y=x}}(),X2=function(){const o=new Ee,e=new B,t=new B;return function(n,r,a,i){iae(n,r,o);let s=o.x,c=o.y;if(s>=0&&s<=1&&c>=0&&c<=1)return n.at(s,a),void r.at(c,i);if(s>=0&&s<=1)return c<0?r.at(0,i):r.at(1,i),void n.closestPointToPoint(i,!0,a);if(c>=0&&c<=1)return s<0?n.at(0,a):n.at(1,a),void r.closestPointToPoint(a,!0,i);{let u,h;u=s<0?n.start:n.end,h=c<0?r.start:r.end;const f=e,m=t;return n.closestPointToPoint(h,!0,e),r.closestPointToPoint(u,!0,t),f.distanceToSquared(h)<=m.distanceToSquared(u)?(a.copy(f),void i.copy(h)):(a.copy(u),void i.copy(m))}}}(),sae=function(){const o=new B,e=new B,t=new _o,n=new ri;return function(r,a){const{radius:i,center:s}=r,{a:c,b:u,c:h}=a;if(n.start=c,n.end=u,n.closestPointToPoint(s,!0,o).distanceTo(s)<=i||(n.start=c,n.end=h,n.closestPointToPoint(s,!0,o).distanceTo(s)<=i)||(n.start=u,n.end=h,n.closestPointToPoint(s,!0,o).distanceTo(s)<=i))return!0;const f=a.getPlane(t);if(Math.abs(f.distanceToPoint(s))<=i){const m=f.projectPoint(s,e);if(a.containsPoint(m))return!0}return!1}}();function Bx(o){return Math.abs(o)<1e-15}class Pa extends Cr{constructor(...e){super(...e),this.isExtendedTriangle=!0,this.satAxes=new Array(4).fill().map(()=>new B),this.satBounds=new Array(4).fill().map(()=>new cs),this.points=[this.a,this.b,this.c],this.sphere=new Yo,this.plane=new _o,this.needsUpdate=!0}intersectsSphere(e){return sae(e,this)}update(){const e=this.a,t=this.b,n=this.c,r=this.points,a=this.satAxes,i=this.satBounds,s=a[0],c=i[0];this.getNormal(s),c.setFromPoints(s,r);const u=a[1],h=i[1];u.subVectors(e,t),h.setFromPoints(u,r);const f=a[2],m=i[2];f.subVectors(t,n),m.setFromPoints(f,r);const g=a[3],A=i[3];g.subVectors(n,e),A.setFromPoints(g,r),this.sphere.setFromPoints(this.points),this.plane.setFromNormalAndCoplanarPoint(s,e),this.needsUpdate=!1}}Pa.prototype.closestPointToSegment=function(){const o=new B,e=new B,t=new ri;return function(n,r=null,a=null){const{start:i,end:s}=n,c=this.points;let u,h=1/0;for(let f=0;f<3;f++){const m=(f+1)%3;t.start.copy(c[f]),t.end.copy(c[m]),X2(t,n,o,e),u=o.distanceToSquared(e),u<h&&(h=u,r&&r.copy(o),a&&a.copy(e))}return this.closestPointToPoint(i,o),u=i.distanceToSquared(o),u<h&&(h=u,r&&r.copy(o),a&&a.copy(i)),this.closestPointToPoint(s,o),u=s.distanceToSquared(o),u<h&&(h=u,r&&r.copy(o),a&&a.copy(s)),Math.sqrt(h)}}(),Pa.prototype.intersectsTriangle=function(){const o=new Pa,e=new Array(3),t=new Array(3),n=new cs,r=new cs,a=new B,i=new B,s=new B,c=new B,u=new B,h=new ri,f=new ri,m=new ri,g=new B;function A(_,x,C){const b=_.points;let y=0,M=-1;for(let R=0;R<3;R++){const{start:T,end:w}=h;T.copy(b[R]),w.copy(b[(R+1)%3]),h.delta(i);const D=Bx(x.distanceToPoint(T));if(Bx(x.normal.dot(i))&&D){C.copy(h),y=2;break}const z=x.intersectLine(h,g);if(!z&&D&&g.copy(T),(z||D)&&!Bx(g.distanceTo(w))){if(y<=1)(y===1?C.start:C.end).copy(g),D&&(M=y);else if(y>=2){(M===1?C.start:C.end).copy(g),y=2;break}if(y++,y===2&&M===-1)break}}return y}return function(_,x=null,C=!1){this.needsUpdate&&this.update(),_.isExtendedTriangle?_.needsUpdate&&_.update():(o.copy(_),o.update(),_=o);const b=this.plane,y=_.plane;if(Math.abs(b.normal.dot(y.normal))>1-1e-10){const M=this.satBounds,R=this.satAxes;t[0]=_.a,t[1]=_.b,t[2]=_.c;for(let D=0;D<4;D++){const z=M[D],F=R[D];if(n.setFromPoints(F,t),z.isSeparated(n))return!1}const T=_.satBounds,w=_.satAxes;e[0]=this.a,e[1]=this.b,e[2]=this.c;for(let D=0;D<4;D++){const z=T[D],F=w[D];if(n.setFromPoints(F,e),z.isSeparated(n))return!1}for(let D=0;D<4;D++){const z=R[D];for(let F=0;F<4;F++){const O=w[F];if(a.crossVectors(z,O),n.setFromPoints(a,e),r.setFromPoints(a,t),n.isSeparated(r))return!1}}return x&&(C||console.warn("ExtendedTriangle.intersectsTriangle: Triangles are coplanar which does not support an output edge. Setting edge to 0, 0, 0."),x.start.set(0,0,0),x.end.set(0,0,0)),!0}{const M=A(this,y,f);if(M===1&&_.containsPoint(f.end))return x&&(x.start.copy(f.end),x.end.copy(f.end)),!0;if(M!==2)return!1;const R=A(_,b,m);if(R===1&&this.containsPoint(m.end))return x&&(x.start.copy(m.end),x.end.copy(m.end)),!0;if(R!==2)return!1;if(f.delta(s),m.delta(c),s.dot(c)<0){let F=m.start;m.start=m.end,m.end=F}const T=f.start.dot(s),w=f.end.dot(s),D=m.start.dot(s),z=m.end.dot(s);return(T===z||D===w||w<D!=T<z)&&(x&&(u.subVectors(f.start,m.start),u.dot(s)>0?x.start.copy(f.start):x.start.copy(m.start),u.subVectors(f.end,m.end),u.dot(s)<0?x.end.copy(f.end):x.end.copy(m.end)),!0)}}}(),Pa.prototype.distanceToPoint=function(){const o=new B;return function(e){return this.closestPointToPoint(e,o),e.distanceTo(o)}}(),Pa.prototype.distanceToTriangle=function(){const o=new B,e=new B,t=["a","b","c"],n=new ri,r=new ri;return function(a,i=null,s=null){const c=i||s?n:null;if(this.intersectsTriangle(a,c))return(i||s)&&(i&&c.getCenter(i),s&&c.getCenter(s)),0;let u=1/0;for(let h=0;h<3;h++){let f;const m=t[h],g=a[m];this.closestPointToPoint(g,o),f=g.distanceToSquared(o),f<u&&(u=f,i&&i.copy(o),s&&s.copy(g));const A=this[m];a.closestPointToPoint(A,o),f=A.distanceToSquared(o),f<u&&(u=f,i&&i.copy(A),s&&s.copy(o))}for(let h=0;h<3;h++){const f=t[h],m=t[(h+1)%3];n.set(this[f],this[m]);for(let g=0;g<3;g++){const A=t[g],_=t[(g+1)%3];r.set(a[A],a[_]),X2(n,r,o,e);const x=o.distanceToSquared(e);x<u&&(u=x,i&&i.copy(o),s&&s.copy(e))}}return Math.sqrt(u)}}();class to{constructor(e,t,n){this.isOrientedBox=!0,this.min=new B,this.max=new B,this.matrix=new Ve,this.invMatrix=new Ve,this.points=new Array(8).fill().map(()=>new B),this.satAxes=new Array(3).fill().map(()=>new B),this.satBounds=new Array(3).fill().map(()=>new cs),this.alignedSatBounds=new Array(3).fill().map(()=>new cs),this.needsUpdate=!1,e&&this.min.copy(e),t&&this.max.copy(t),n&&this.matrix.copy(n)}set(e,t,n){this.min.copy(e),this.max.copy(t),this.matrix.copy(n),this.needsUpdate=!0}copy(e){this.min.copy(e.min),this.max.copy(e.max),this.matrix.copy(e.matrix),this.needsUpdate=!0}}to.prototype.update=function(){const o=this.matrix,e=this.min,t=this.max,n=this.points;for(let c=0;c<=1;c++)for(let u=0;u<=1;u++)for(let h=0;h<=1;h++){const f=n[1*c|2*u|4*h];f.x=c?t.x:e.x,f.y=u?t.y:e.y,f.z=h?t.z:e.z,f.applyMatrix4(o)}const r=this.satBounds,a=this.satAxes,i=n[0];for(let c=0;c<3;c++){const u=a[c],h=r[c],f=n[1<<c];u.subVectors(i,f),h.setFromPoints(u,n)}const s=this.alignedSatBounds;s[0].setFromPointsField(n,"x"),s[1].setFromPointsField(n,"y"),s[2].setFromPointsField(n,"z"),this.invMatrix.copy(this.matrix).invert(),this.needsUpdate=!1},to.prototype.intersectsBox=function(){const o=new cs;return function(e){this.needsUpdate&&this.update();const t=e.min,n=e.max,r=this.satBounds,a=this.satAxes,i=this.alignedSatBounds;if(o.min=t.x,o.max=n.x,i[0].isSeparated(o)||(o.min=t.y,o.max=n.y,i[1].isSeparated(o))||(o.min=t.z,o.max=n.z,i[2].isSeparated(o)))return!1;for(let s=0;s<3;s++){const c=a[s],u=r[s];if(o.setFromBox(c,e),u.isSeparated(o))return!1}return!0}}(),to.prototype.intersectsTriangle=function(){const o=new Pa,e=new Array(3),t=new cs,n=new cs,r=new B;return function(a){this.needsUpdate&&this.update(),a.isExtendedTriangle?a.needsUpdate&&a.update():(o.copy(a),o.update(),a=o);const i=this.satBounds,s=this.satAxes;e[0]=a.a,e[1]=a.b,e[2]=a.c;for(let f=0;f<3;f++){const m=i[f],g=s[f];if(t.setFromPoints(g,e),m.isSeparated(t))return!1}const c=a.satBounds,u=a.satAxes,h=this.points;for(let f=0;f<3;f++){const m=c[f],g=u[f];if(t.setFromPoints(g,h),m.isSeparated(t))return!1}for(let f=0;f<3;f++){const m=s[f];for(let g=0;g<4;g++){const A=u[g];if(r.crossVectors(m,A),t.setFromPoints(r,e),n.setFromPoints(r,h),t.isSeparated(n))return!1}}return!0}}(),to.prototype.closestPointToPoint=function(o,e){return this.needsUpdate&&this.update(),e.copy(o).applyMatrix4(this.invMatrix).clamp(this.min,this.max).applyMatrix4(this.matrix),e},to.prototype.distanceToPoint=function(){const o=new B;return function(e){return this.closestPointToPoint(e,o),e.distanceTo(o)}}(),to.prototype.distanceToBox=function(){const o=["x","y","z"],e=new Array(12).fill().map(()=>new ri),t=new Array(12).fill().map(()=>new ri),n=new B,r=new B;return function(a,i=0,s=null,c=null){if(this.needsUpdate&&this.update(),this.intersectsBox(a))return(s||c)&&(a.getCenter(r),this.closestPointToPoint(r,n),a.closestPointToPoint(n,r),s&&s.copy(n),c&&c.copy(r)),0;const u=i*i,h=a.min,f=a.max,m=this.points;let g=1/0;for(let _=0;_<8;_++){const x=m[_];r.copy(x).clamp(h,f);const C=x.distanceToSquared(r);if(C<g&&(g=C,s&&s.copy(x),c&&c.copy(r),C<u))return Math.sqrt(C)}let A=0;for(let _=0;_<3;_++)for(let x=0;x<=1;x++)for(let C=0;C<=1;C++){const b=(_+1)%3,y=(_+2)%3,M=1<<_|x<<b|C<<y,R=m[x<<b|C<<y],T=m[M];e[A].set(R,T);const w=o[_],D=o[b],z=o[y],F=t[A],O=F.start,q=F.end;O[w]=h[w],O[D]=x?h[D]:f[D],O[z]=C?h[z]:f[D],q[w]=f[w],q[D]=x?h[D]:f[D],q[z]=C?h[z]:f[D],A++}for(let _=0;_<=1;_++)for(let x=0;x<=1;x++)for(let C=0;C<=1;C++){r.x=_?f.x:h.x,r.y=x?f.y:h.y,r.z=C?f.z:h.z,this.closestPointToPoint(r,n);const b=r.distanceToSquared(n);if(b<g&&(g=b,s&&s.copy(n),c&&c.copy(r),b<u))return Math.sqrt(b)}for(let _=0;_<12;_++){const x=e[_];for(let C=0;C<12;C++){const b=t[C];X2(x,b,n,r);const y=n.distanceToSquared(r);if(y<g&&(g=y,s&&s.copy(n),c&&c.copy(r),y<u))return Math.sqrt(y)}}return Math.sqrt(g)}}();class Eb{constructor(e){this._getNewPrimitive=e,this._primitives=[]}getPrimitive(){const e=this._primitives;return e.length===0?this._getNewPrimitive():e.pop()}releasePrimitive(e){this._primitives.push(e)}}class lae extends Eb{constructor(){super(()=>new Pa)}}const da=new lae;class cae{constructor(){this.float32Array=null,this.uint16Array=null,this.uint32Array=null;const e=[];let t=null;this.setBuffer=n=>{t&&e.push(t),t=n,this.float32Array=new Float32Array(n),this.uint16Array=new Uint16Array(n),this.uint32Array=new Uint32Array(n)},this.clearBuffer=()=>{t=null,this.float32Array=null,this.uint16Array=null,this.uint32Array=null,e.length!==0&&this.setBuffer(e.pop())}}}const Rn=new cae;let ol,ed;const Gu=[],Q0=new Eb(()=>new mn);function uae(o,e,t,n,r,a){ol=Q0.getPrimitive(),ed=Q0.getPrimitive(),Gu.push(ol,ed),Rn.setBuffer(o._roots[e]);const i=q2(0,o.geometry,t,n,r,a);Rn.clearBuffer(),Q0.releasePrimitive(ol),Q0.releasePrimitive(ed),Gu.pop(),Gu.pop();const s=Gu.length;return s>0&&(ed=Gu[s-1],ol=Gu[s-2]),i}function q2(o,e,t,n,r=null,a=0,i=0){const{float32Array:s,uint16Array:c,uint32Array:u}=Rn;let h=2*o;if(xo(h,c)){const f=Go(o,u),m=la(h,c);return Yn(o,s,ol),n(f,m,!1,i,a+o,ol)}{let w=function(z){const{uint16Array:F,uint32Array:O}=Rn;let q=2*z;for(;!xo(q,F);)q=2*(z=ca(z));return Go(z,O)},D=function(z){const{uint16Array:F,uint32Array:O}=Rn;let q=2*z;for(;!xo(q,F);)q=2*(z=ua(z,O));return Go(z,O)+la(q,F)};const f=ca(o),m=ua(o,u);let g,A,_,x,C=f,b=m;if(r&&(_=ol,x=ed,Yn(C,s,_),Yn(b,s,x),g=r(_),A=r(x),A<g)){C=m,b=f;const z=g;g=A,A=z,_=x}_||(_=ol,Yn(C,s,_));const y=t(_,xo(2*C,c),g,i+1,a+C);let M;if(y===2){const z=w(C);M=n(z,D(C)-z,!0,i+1,a+C,_)}else M=y&&q2(C,e,t,n,r,a,i+1);if(M)return!0;x=ed,Yn(b,s,x);const R=t(x,xo(2*b,c),A,i+1,a+b);let T;if(R===2){const z=w(b);T=n(z,D(b)-z,!0,i+1,a+b,x)}else T=R&&q2(b,e,t,n,r,a,i+1);return!!T}}const eh=new B,Px=new B;function dae(o,e,t={},n=0,r=1/0){const a=n*n,i=r*r;let s=1/0,c=null;if(o.shapecast({boundsTraverseOrder:h=>(eh.copy(e).clamp(h.min,h.max),eh.distanceToSquared(e)),intersectsBounds:(h,f,m)=>m<s&&m<i,intersectsTriangle:(h,f)=>{h.closestPointToPoint(e,eh);const m=e.distanceToSquared(eh);return m<s&&(Px.copy(eh),s=m,c=f),m<a}}),s===1/0)return null;const u=Math.sqrt(s);return t.point?t.point.copy(Px):t.point=Px.clone(),t.distance=u,t.faceIndex=c,t}const fae=parseInt("4.9.0")>=169,sc=new B,lc=new B,cc=new B,H0=new Ee,W0=new Ee,Y0=new Ee,ZT=new B,KT=new B,$T=new B,th=new B;function hae(o,e,t,n,r,a,i,s){let c;if(c=a===1?o.intersectTriangle(n,t,e,!0,r):o.intersectTriangle(e,t,n,a!==2,r),c===null)return null;const u=o.origin.distanceTo(r);return u<i||u>s?null:{distance:u,point:r.clone()}}function pae(o,e,t,n,r,a,i,s,c,u,h){sc.fromBufferAttribute(e,a),lc.fromBufferAttribute(e,i),cc.fromBufferAttribute(e,s);const f=hae(o,sc,lc,cc,th,c,u,h);if(f){const m=new B;Cr.getBarycoord(th,sc,lc,cc,m),n&&(H0.fromBufferAttribute(n,a),W0.fromBufferAttribute(n,i),Y0.fromBufferAttribute(n,s),f.uv=Cr.getInterpolation(th,sc,lc,cc,H0,W0,Y0,new Ee)),r&&(H0.fromBufferAttribute(r,a),W0.fromBufferAttribute(r,i),Y0.fromBufferAttribute(r,s),f.uv1=Cr.getInterpolation(th,sc,lc,cc,H0,W0,Y0,new Ee)),t&&(ZT.fromBufferAttribute(t,a),KT.fromBufferAttribute(t,i),$T.fromBufferAttribute(t,s),f.normal=Cr.getInterpolation(th,sc,lc,cc,ZT,KT,$T,new B),f.normal.dot(o.direction)>0&&f.normal.multiplyScalar(-1));const g={a,b:i,c:s,normal:new B,materialIndex:0};Cr.getNormal(sc,lc,cc,g.normal),f.face=g,f.faceIndex=a,fae&&(f.barycoord=m)}return f}function Ov(o,e,t,n,r,a,i){const s=3*n;let c=s+0,u=s+1,h=s+2;const f=o.index;o.index&&(c=f.getX(c),u=f.getX(u),h=f.getX(h));const{position:m,normal:g,uv:A,uv1:_}=o.attributes,x=pae(t,m,g,A,_,c,u,h,e,a,i);return x?(x.faceIndex=n,r&&r.push(x),x):null}function sr(o,e,t,n){const r=o.a,a=o.b,i=o.c;let s=e,c=e+1,u=e+2;t&&(s=t.getX(s),c=t.getX(c),u=t.getX(u)),r.x=n.getX(s),r.y=n.getY(s),r.z=n.getZ(s),a.x=n.getX(c),a.y=n.getY(c),a.z=n.getZ(c),i.x=n.getX(u),i.y=n.getY(u),i.z=n.getZ(u)}function mae(o,e,t,n,r,a,i,s){const{geometry:c,_indirectBuffer:u}=o;for(let h=n,f=n+r;h<f;h++)Ov(c,e,t,h,a,i,s)}function gae(o,e,t,n,r,a,i){const{geometry:s,_indirectBuffer:c}=o;let u=1/0,h=null;for(let f=n,m=n+r;f<m;f++){let g;g=Ov(s,e,t,f,null,a,i),g&&g.distance<u&&(h=g,u=g.distance)}return h}function vae(o,e,t,n,r,a,i){const{geometry:s}=t,{index:c}=s,u=s.attributes.position;for(let h=o,f=e+o;h<f;h++){let m;if(m=h,sr(i,3*m,c,u),i.needsUpdate=!0,n(i,m,r,a))return!0}return!1}function _ae(o,e=null){e&&Array.isArray(e)&&(e=new Set(e));const t=o.geometry,n=t.index?t.index.array:null,r=t.attributes.position;let a,i,s,c,u=0;const h=o._roots;for(let m=0,g=h.length;m<g;m++)a=h[m],i=new Uint32Array(a),s=new Uint16Array(a),c=new Float32Array(a),f(0,u),u+=a.byteLength;function f(m,g,A=!1){const _=2*m;if(s[_+15]===65535){const x=i[m+6];let C=1/0,b=1/0,y=1/0,M=-1/0,R=-1/0,T=-1/0;for(let w=3*x,D=3*(x+s[_+14]);w<D;w++){let z=n[w];const F=r.getX(z),O=r.getY(z),q=r.getZ(z);F<C&&(C=F),F>M&&(M=F),O<b&&(b=O),O>R&&(R=O),q<y&&(y=q),q>T&&(T=q)}return(c[m+0]!==C||c[m+1]!==b||c[m+2]!==y||c[m+3]!==M||c[m+4]!==R||c[m+5]!==T)&&(c[m+0]=C,c[m+1]=b,c[m+2]=y,c[m+3]=M,c[m+4]=R,c[m+5]=T,!0)}{const x=m+8,C=i[m+6],b=x+g,y=C+g;let M=A,R=!1,T=!1;e?M||(R=e.has(b),T=e.has(y),M=!R&&!T):(R=!0,T=!0);const w=M||T;let D=!1;(M||R)&&(D=f(x,g,M));let z=!1;w&&(z=f(C,g,M));const F=D||z;if(F)for(let O=0;O<3;O++){const q=x+O,ne=C+O,$=c[q],he=c[q+3],K=c[ne],oe=c[ne+3];c[m+O]=$<K?$:K,c[m+O+3]=he>oe?he:oe}return F}}}function ml(o,e,t,n,r){let a,i,s,c,u,h;const f=1/t.direction.x,m=1/t.direction.y,g=1/t.direction.z,A=t.origin.x,_=t.origin.y,x=t.origin.z;let C=e[o],b=e[o+3],y=e[o+1],M=e[o+3+1],R=e[o+2],T=e[o+3+2];return f>=0?(a=(C-A)*f,i=(b-A)*f):(a=(b-A)*f,i=(C-A)*f),m>=0?(s=(y-_)*m,c=(M-_)*m):(s=(M-_)*m,c=(y-_)*m),!(a>c||s>i)&&((s>a||isNaN(a))&&(a=s),(c<i||isNaN(i))&&(i=c),g>=0?(u=(R-x)*g,h=(T-x)*g):(u=(T-x)*g,h=(R-x)*g),!(a>h||u>i)&&((u>a||a!=a)&&(a=u),(h<i||i!=i)&&(i=h),a<=r&&i>=n))}function Aae(o,e,t,n,r,a,i,s){const{geometry:c,_indirectBuffer:u}=o;for(let h=n,f=n+r;h<f;h++)Ov(c,e,t,u?u[h]:h,a,i,s)}function xae(o,e,t,n,r,a,i){const{geometry:s,_indirectBuffer:c}=o;let u=1/0,h=null;for(let f=n,m=n+r;f<m;f++){let g;g=Ov(s,e,t,c?c[f]:f,null,a,i),g&&g.distance<u&&(h=g,u=g.distance)}return h}function yae(o,e,t,n,r,a,i){const{geometry:s}=t,{index:c}=s,u=s.attributes.position;for(let h=o,f=e+o;h<f;h++){let m;if(m=t.resolveTriangleIndex(h),sr(i,3*m,c,u),i.needsUpdate=!0,n(i,m,r,a))return!0}return!1}function bae(o,e,t,n,r,a,i){Rn.setBuffer(o._roots[e]),Z2(0,o,t,n,r,a,i),Rn.clearBuffer()}function Z2(o,e,t,n,r,a,i){const{float32Array:s,uint16Array:c,uint32Array:u}=Rn,h=2*o;if(xo(h,c))mae(e,t,n,Go(o,u),la(h,c),r,a,i);else{const f=ca(o);ml(f,s,n,a,i)&&Z2(f,e,t,n,r,a,i);const m=ua(o,u);ml(m,s,n,a,i)&&Z2(m,e,t,n,r,a,i)}}const Sae=["x","y","z"];function Cae(o,e,t,n,r,a){Rn.setBuffer(o._roots[e]);const i=K2(0,o,t,n,r,a);return Rn.clearBuffer(),i}function K2(o,e,t,n,r,a){const{float32Array:i,uint16Array:s,uint32Array:c}=Rn;let u=2*o;if(xo(u,s))return gae(e,t,n,Go(o,c),la(u,s),r,a);{const h=PP(o,c),f=Sae[h],m=n.direction[f]>=0;let g,A;m?(g=ca(o),A=ua(o,c)):(g=ua(o,c),A=ca(o));const _=ml(g,i,n,r,a)?K2(g,e,t,n,r,a):null;if(_){const C=_.point[f];if(m?C<=i[A+h]:C>=i[A+h+3])return _}const x=ml(A,i,n,r,a)?K2(A,e,t,n,r,a):null;return _&&x?_.distance<=x.distance?_:x:_||x||null}}const j0=new mn,Qu=new Pa,Hu=new Pa,nh=new Ve,JT=new to,X0=new to;function Eae(o,e,t,n){Rn.setBuffer(o._roots[e]);const r=$2(0,o,t,n);return Rn.clearBuffer(),r}function $2(o,e,t,n,r=null){const{float32Array:a,uint16Array:i,uint32Array:s}=Rn;let c=2*o;if(r===null&&(t.boundingBox||t.computeBoundingBox(),JT.set(t.boundingBox.min,t.boundingBox.max,n),r=JT),!xo(c,i)){const u=o+8,h=s[o+6];return Yn(u,a,j0),r.intersectsBox(j0)&&$2(u,e,t,n,r)?!0:(Yn(h,a,j0),!!(r.intersectsBox(j0)&&$2(h,e,t,n,r)))}{const u=e.geometry,h=u.index,f=u.attributes.position,m=t.index,g=t.attributes.position,A=Go(o,s),_=la(c,i);if(nh.copy(n).invert(),t.boundsTree)return Yn(o,a,X0),X0.matrix.copy(nh),X0.needsUpdate=!0,t.boundsTree.shapecast({intersectsBounds:C=>X0.intersectsBox(C),intersectsTriangle:C=>{C.a.applyMatrix4(n),C.b.applyMatrix4(n),C.c.applyMatrix4(n),C.needsUpdate=!0;for(let b=3*A,y=3*(_+A);b<y;b+=3)if(sr(Hu,b,h,f),Hu.needsUpdate=!0,C.intersectsTriangle(Hu))return!0;return!1}});for(let x=3*A,C=3*(_+A);x<C;x+=3){sr(Qu,x,h,f),Qu.a.applyMatrix4(nh),Qu.b.applyMatrix4(nh),Qu.c.applyMatrix4(nh),Qu.needsUpdate=!0;for(let b=0,y=m.count;b<y;b+=3)if(sr(Hu,b,m,g),Hu.needsUpdate=!0,Qu.intersectsTriangle(Hu))return!0}}}const q0=new Ve,Nx=new to,rh=new to,Mae=new B,wae=new B,Tae=new B,Rae=new B;function Iae(o,e,t,n={},r={},a=0,i=1/0){e.boundingBox||e.computeBoundingBox(),Nx.set(e.boundingBox.min,e.boundingBox.max,t),Nx.needsUpdate=!0;const s=o.geometry,c=s.attributes.position,u=s.index,h=e.attributes.position,f=e.index,m=da.getPrimitive(),g=da.getPrimitive();let A=Mae,_=wae,x=null,C=null;r&&(x=Tae,C=Rae);let b=1/0,y=null,M=null;return q0.copy(t).invert(),rh.matrix.copy(q0),o.shapecast({boundsTraverseOrder:R=>Nx.distanceToBox(R),intersectsBounds:(R,T,w)=>w<b&&w<i&&(T&&(rh.min.copy(R.min),rh.max.copy(R.max),rh.needsUpdate=!0),!0),intersectsRange:(R,T)=>{if(e.boundsTree)return e.boundsTree.shapecast({boundsTraverseOrder:w=>rh.distanceToBox(w),intersectsBounds:(w,D,z)=>z<b&&z<i,intersectsRange:(w,D)=>{for(let z=w,F=w+D;z<F;z++){sr(g,3*z,f,h),g.a.applyMatrix4(t),g.b.applyMatrix4(t),g.c.applyMatrix4(t),g.needsUpdate=!0;for(let O=R,q=R+T;O<q;O++){sr(m,3*O,u,c),m.needsUpdate=!0;const ne=m.distanceToTriangle(g,A,x);if(ne<b&&(_.copy(A),C&&C.copy(x),b=ne,y=O,M=z),ne<a)return!0}}}});for(let w=0,D=Pd(e);w<D;w++){sr(g,3*w,f,h),g.a.applyMatrix4(t),g.b.applyMatrix4(t),g.c.applyMatrix4(t),g.needsUpdate=!0;for(let z=R,F=R+T;z<F;z++){sr(m,3*z,u,c),m.needsUpdate=!0;const O=m.distanceToTriangle(g,A,x);if(O<b&&(_.copy(A),C&&C.copy(x),b=O,y=z,M=w),O<a)return!0}}}}),da.releasePrimitive(m),da.releasePrimitive(g),b===1/0?null:(n.point?n.point.copy(_):n.point=_.clone(),n.distance=b,n.faceIndex=y,r&&(r.point?r.point.copy(C):r.point=C.clone(),r.point.applyMatrix4(q0),_.applyMatrix4(q0),r.distance=_.sub(r.point).length(),r.faceIndex=M),n)}function Lae(o,e=null){e&&Array.isArray(e)&&(e=new Set(e));const t=o.geometry,n=t.index?t.index.array:null,r=t.attributes.position;let a,i,s,c,u=0;const h=o._roots;for(let m=0,g=h.length;m<g;m++)a=h[m],i=new Uint32Array(a),s=new Uint16Array(a),c=new Float32Array(a),f(0,u),u+=a.byteLength;function f(m,g,A=!1){const _=2*m;if(s[_+15]===65535){const x=i[m+6];let C=1/0,b=1/0,y=1/0,M=-1/0,R=-1/0,T=-1/0;for(let w=x,D=x+s[_+14];w<D;w++){const z=3*o.resolveTriangleIndex(w);for(let F=0;F<3;F++){let O=z+F;O=n?n[O]:O;const q=r.getX(O),ne=r.getY(O),$=r.getZ(O);q<C&&(C=q),q>M&&(M=q),ne<b&&(b=ne),ne>R&&(R=ne),$<y&&(y=$),$>T&&(T=$)}}return(c[m+0]!==C||c[m+1]!==b||c[m+2]!==y||c[m+3]!==M||c[m+4]!==R||c[m+5]!==T)&&(c[m+0]=C,c[m+1]=b,c[m+2]=y,c[m+3]=M,c[m+4]=R,c[m+5]=T,!0)}{const x=m+8,C=i[m+6],b=x+g,y=C+g;let M=A,R=!1,T=!1;e?M||(R=e.has(b),T=e.has(y),M=!R&&!T):(R=!0,T=!0);const w=M||T;let D=!1;(M||R)&&(D=f(x,g,M));let z=!1;w&&(z=f(C,g,M));const F=D||z;if(F)for(let O=0;O<3;O++){const q=x+O,ne=C+O,$=c[q],he=c[q+3],K=c[ne],oe=c[ne+3];c[m+O]=$<K?$:K,c[m+O+3]=he>oe?he:oe}return F}}}function Bae(o,e,t,n,r,a,i){Rn.setBuffer(o._roots[e]),J2(0,o,t,n,r,a,i),Rn.clearBuffer()}function J2(o,e,t,n,r,a,i){const{float32Array:s,uint16Array:c,uint32Array:u}=Rn,h=2*o;if(xo(h,c))Aae(e,t,n,Go(o,u),la(h,c),r,a,i);else{const f=ca(o);ml(f,s,n,a,i)&&J2(f,e,t,n,r,a,i);const m=ua(o,u);ml(m,s,n,a,i)&&J2(m,e,t,n,r,a,i)}}const Pae=["x","y","z"];function Nae(o,e,t,n,r,a){Rn.setBuffer(o._roots[e]);const i=ey(0,o,t,n,r,a);return Rn.clearBuffer(),i}function ey(o,e,t,n,r,a){const{float32Array:i,uint16Array:s,uint32Array:c}=Rn;let u=2*o;if(xo(u,s))return xae(e,t,n,Go(o,c),la(u,s),r,a);{const h=PP(o,c),f=Pae[h],m=n.direction[f]>=0;let g,A;m?(g=ca(o),A=ua(o,c)):(g=ua(o,c),A=ca(o));const _=ml(g,i,n,r,a)?ey(g,e,t,n,r,a):null;if(_){const C=_.point[f];if(m?C<=i[A+h]:C>=i[A+h+3])return _}const x=ml(A,i,n,r,a)?ey(A,e,t,n,r,a):null;return _&&x?_.distance<=x.distance?_:x:_||x||null}}const Z0=new mn,Wu=new Pa,Yu=new Pa,oh=new Ve,eR=new to,K0=new to;function Dae(o,e,t,n){Rn.setBuffer(o._roots[e]);const r=ty(0,o,t,n);return Rn.clearBuffer(),r}function ty(o,e,t,n,r=null){const{float32Array:a,uint16Array:i,uint32Array:s}=Rn;let c=2*o;if(r===null&&(t.boundingBox||t.computeBoundingBox(),eR.set(t.boundingBox.min,t.boundingBox.max,n),r=eR),!xo(c,i)){const u=o+8,h=s[o+6];return Yn(u,a,Z0),r.intersectsBox(Z0)&&ty(u,e,t,n,r)?!0:(Yn(h,a,Z0),!!(r.intersectsBox(Z0)&&ty(h,e,t,n,r)))}{const u=e.geometry,h=u.index,f=u.attributes.position,m=t.index,g=t.attributes.position,A=Go(o,s),_=la(c,i);if(oh.copy(n).invert(),t.boundsTree)return Yn(o,a,K0),K0.matrix.copy(oh),K0.needsUpdate=!0,t.boundsTree.shapecast({intersectsBounds:C=>K0.intersectsBox(C),intersectsTriangle:C=>{C.a.applyMatrix4(n),C.b.applyMatrix4(n),C.c.applyMatrix4(n),C.needsUpdate=!0;for(let b=A,y=_+A;b<y;b++)if(sr(Yu,3*e.resolveTriangleIndex(b),h,f),Yu.needsUpdate=!0,C.intersectsTriangle(Yu))return!0;return!1}});for(let x=A,C=_+A;x<C;x++){const b=e.resolveTriangleIndex(x);sr(Wu,3*b,h,f),Wu.a.applyMatrix4(oh),Wu.b.applyMatrix4(oh),Wu.c.applyMatrix4(oh),Wu.needsUpdate=!0;for(let y=0,M=m.count;y<M;y+=3)if(sr(Yu,y,m,g),Yu.needsUpdate=!0,Wu.intersectsTriangle(Yu))return!0}}}const $0=new Ve,Dx=new to,ah=new to,Oae=new B,Fae=new B,Uae=new B,zae=new B;function Vae(o,e,t,n={},r={},a=0,i=1/0){e.boundingBox||e.computeBoundingBox(),Dx.set(e.boundingBox.min,e.boundingBox.max,t),Dx.needsUpdate=!0;const s=o.geometry,c=s.attributes.position,u=s.index,h=e.attributes.position,f=e.index,m=da.getPrimitive(),g=da.getPrimitive();let A=Oae,_=Fae,x=null,C=null;r&&(x=Uae,C=zae);let b=1/0,y=null,M=null;return $0.copy(t).invert(),ah.matrix.copy($0),o.shapecast({boundsTraverseOrder:R=>Dx.distanceToBox(R),intersectsBounds:(R,T,w)=>w<b&&w<i&&(T&&(ah.min.copy(R.min),ah.max.copy(R.max),ah.needsUpdate=!0),!0),intersectsRange:(R,T)=>{if(e.boundsTree){const w=e.boundsTree;return w.shapecast({boundsTraverseOrder:D=>ah.distanceToBox(D),intersectsBounds:(D,z,F)=>F<b&&F<i,intersectsRange:(D,z)=>{for(let F=D,O=D+z;F<O;F++){const q=w.resolveTriangleIndex(F);sr(g,3*q,f,h),g.a.applyMatrix4(t),g.b.applyMatrix4(t),g.c.applyMatrix4(t),g.needsUpdate=!0;for(let ne=R,$=R+T;ne<$;ne++){const he=o.resolveTriangleIndex(ne);sr(m,3*he,u,c),m.needsUpdate=!0;const K=m.distanceToTriangle(g,A,x);if(K<b&&(_.copy(A),C&&C.copy(x),b=K,y=ne,M=F),K<a)return!0}}}})}for(let w=0,D=Pd(e);w<D;w++){sr(g,3*w,f,h),g.a.applyMatrix4(t),g.b.applyMatrix4(t),g.c.applyMatrix4(t),g.needsUpdate=!0;for(let z=R,F=R+T;z<F;z++){const O=o.resolveTriangleIndex(z);sr(m,3*O,u,c),m.needsUpdate=!0;const q=m.distanceToTriangle(g,A,x);if(q<b&&(_.copy(A),C&&C.copy(x),b=q,y=z,M=w),q<a)return!0}}}}),da.releasePrimitive(m),da.releasePrimitive(g),b===1/0?null:(n.point?n.point.copy(_):n.point=_.clone(),n.distance=b,n.faceIndex=y,r&&(r.point?r.point.copy(C):r.point=C.clone(),r.point.applyMatrix4($0),_.applyMatrix4($0),r.distance=_.sub(r.point).length(),r.faceIndex=M),n)}function kae(){return typeof SharedArrayBuffer<"u"}const wh=new Rn.constructor,ev=new Rn.constructor,tl=new Eb(()=>new mn),ju=new mn,Xu=new mn,Ox=new mn,Fx=new mn;let Ux=!1;function Gae(o,e,t,n){if(Ux)throw new Error("MeshBVH: Recursive calls to bvhcast not supported.");Ux=!0;const r=o._roots,a=e._roots;let i,s=0,c=0;const u=new Ve().copy(t).invert();for(let h=0,f=r.length;h<f;h++){wh.setBuffer(r[h]),c=0;const m=tl.getPrimitive();Yn(0,wh.float32Array,m),m.applyMatrix4(u);for(let g=0,A=a.length;g<A&&(ev.setBuffer(a[g]),i=wa(0,0,t,u,n,s,c,0,0,m),ev.clearBuffer(),c+=a[g].length,!i);g++);if(tl.releasePrimitive(m),wh.clearBuffer(),s+=r[h].length,i)break}return Ux=!1,i}function wa(o,e,t,n,r,a=0,i=0,s=0,c=0,u=null,h=!1){let f,m;h?(f=ev,m=wh):(f=wh,m=ev);const g=f.float32Array,A=f.uint32Array,_=f.uint16Array,x=m.float32Array,C=m.uint32Array,b=m.uint16Array,y=2*e,M=xo(2*o,_),R=xo(y,b);let T=!1;if(R&&M)T=h?r(Go(e,C),la(2*e,b),Go(o,A),la(2*o,_),c,i+e,s,a+o):r(Go(o,A),la(2*o,_),Go(e,C),la(2*e,b),s,a+o,c,i+e);else if(R){const w=tl.getPrimitive();Yn(e,x,w),w.applyMatrix4(t);const D=ca(o),z=ua(o,A);Yn(D,g,ju),Yn(z,g,Xu);const F=w.intersectsBox(ju),O=w.intersectsBox(Xu);T=F&&wa(e,D,n,t,r,i,a,c,s+1,w,!h)||O&&wa(e,z,n,t,r,i,a,c,s+1,w,!h),tl.releasePrimitive(w)}else{const w=ca(e),D=ua(e,C);Yn(w,x,Ox),Yn(D,x,Fx);const z=u.intersectsBox(Ox),F=u.intersectsBox(Fx);if(z&&F)T=wa(o,w,t,n,r,a,i,s,c+1,u,h)||wa(o,D,t,n,r,a,i,s,c+1,u,h);else if(z)if(M)T=wa(o,w,t,n,r,a,i,s,c+1,u,h);else{const O=tl.getPrimitive();O.copy(Ox).applyMatrix4(t);const q=ca(o),ne=ua(o,A);Yn(q,g,ju),Yn(ne,g,Xu);const $=O.intersectsBox(ju),he=O.intersectsBox(Xu);T=$&&wa(w,q,n,t,r,i,a,c,s+1,O,!h)||he&&wa(w,ne,n,t,r,i,a,c,s+1,O,!h),tl.releasePrimitive(O)}else if(F)if(M)T=wa(o,D,t,n,r,a,i,s,c+1,u,h);else{const O=tl.getPrimitive();O.copy(Fx).applyMatrix4(t);const q=ca(o),ne=ua(o,A);Yn(q,g,ju),Yn(ne,g,Xu);const $=O.intersectsBox(ju),he=O.intersectsBox(Xu);T=$&&wa(D,q,n,t,r,i,a,c,s+1,O,!h)||he&&wa(D,ne,n,t,r,i,a,c,s+1,O,!h),tl.releasePrimitive(O)}}return T}const J0=new to,tR=new mn,Qae={strategy:0,maxDepth:40,maxLeafTris:10,useSharedArrayBuffer:!1,setBoundingBox:!0,onProgress:null,indirect:!1,verbose:!0,range:null};class Fv{static serialize(e,t={}){t={cloneBuffers:!0,...t};const n=e.geometry,r=e._roots,a=e._indirectBuffer,i=n.getIndex();let s;return s=t.cloneBuffers?{roots:r.map(c=>c.slice()),index:i?i.array.slice():null,indirectBuffer:a?a.slice():null}:{roots:r,index:i?i.array:null,indirectBuffer:a},s}static deserialize(e,t,n={}){n={setIndex:!0,indirect:!!e.indirectBuffer,...n};const{index:r,roots:a,indirectBuffer:i}=e,s=new Fv(t,{...n,[Rx]:!0});if(s._roots=a,s._indirectBuffer=i||null,n.setIndex){const c=t.getIndex();if(c===null){const u=new $e(e.index,1,!1);t.setIndex(u)}else c.array!==r&&(c.array.set(r),c.needsUpdate=!0)}return s}get indirect(){return!!this._indirectBuffer}constructor(e,t={}){if(!e.isBufferGeometry)throw new Error("MeshBVH: Only BufferGeometries are supported.");if(e.index&&e.index.isInterleavedBufferAttribute)throw new Error("MeshBVH: InterleavedBufferAttribute is not supported for the index attribute.");if((t=Object.assign({...Qae,[Rx]:!1},t)).useSharedArrayBuffer&&!kae())throw new Error("MeshBVH: SharedArrayBuffer is not available.");this.geometry=e,this._roots=null,this._indirectBuffer=null,t[Rx]||(aae(this,t),!e.boundingBox&&t.setBoundingBox&&(e.boundingBox=this.getBoundingBox(new mn))),this.resolveTriangleIndex=t.indirect?n=>this._indirectBuffer[n]:n=>n}refit(e=null){return(this.indirect?Lae:_ae)(this,e)}traverse(e,t=0){const n=this._roots[t],r=new Uint32Array(n),a=new Uint16Array(n);(function i(s,c=0){const u=2*s,h=a[u+15]===65535;if(h){const f=r[s+6],m=a[u+14];e(c,h,new Float32Array(n,4*s,6),f,m)}else{const f=s+8,m=r[s+6],g=r[s+7];e(c,h,new Float32Array(n,4*s,6),g)||(i(f,c+1),i(m,c+1))}})(0)}raycast(e,t=0,n=0,r=1/0){const a=this._roots,i=this.geometry,s=[],c=t.isMaterial,u=Array.isArray(t),h=i.groups,f=c?t.side:t,m=this.indirect?Bae:bae;for(let g=0,A=a.length;g<A;g++){const _=u?t[h[g].materialIndex].side:f,x=s.length;if(m(this,g,_,e,s,n,r),u){const C=h[g].materialIndex;for(let b=x,y=s.length;b<y;b++)s[b].face.materialIndex=C}}return s}raycastFirst(e,t=0,n=0,r=1/0){const a=this._roots,i=this.geometry,s=t.isMaterial,c=Array.isArray(t);let u=null;const h=i.groups,f=s?t.side:t,m=this.indirect?Nae:Cae;for(let g=0,A=a.length;g<A;g++){const _=m(this,g,c?t[h[g].materialIndex].side:f,e,n,r);_!=null&&(u==null||_.distance<u.distance)&&(u=_,c&&(_.face.materialIndex=h[g].materialIndex))}return u}intersectsGeometry(e,t){let n=!1;const r=this._roots,a=this.indirect?Dae:Eae;for(let i=0,s=r.length;i<s&&(n=a(this,i,e,t),!n);i++);return n}shapecast(e){const t=da.getPrimitive(),n=this.indirect?yae:vae;let{boundsTraverseOrder:r,intersectsBounds:a,intersectsRange:i,intersectsTriangle:s}=e;if(i&&s){const f=i;i=(m,g,A,_,x)=>!!f(m,g,A,_,x)||n(m,g,this,s,A,_,t)}else i||(i=s?(f,m,g,A)=>n(f,m,this,s,g,A,t):(f,m,g)=>g);let c=!1,u=0;const h=this._roots;for(let f=0,m=h.length;f<m;f++){const g=h[f];if(c=uae(this,f,a,i,r,u),c)break;u+=g.byteLength}return da.releasePrimitive(t),c}bvhcast(e,t,n){let{intersectsRanges:r,intersectsTriangles:a}=n;const i=da.getPrimitive(),s=this.geometry.index,c=this.geometry.attributes.position,u=this.indirect?A=>{const _=this.resolveTriangleIndex(A);sr(i,3*_,s,c)}:A=>{sr(i,3*A,s,c)},h=da.getPrimitive(),f=e.geometry.index,m=e.geometry.attributes.position,g=e.indirect?A=>{const _=e.resolveTriangleIndex(A);sr(h,3*_,f,m)}:A=>{sr(h,3*A,f,m)};if(a){const A=(_,x,C,b,y,M,R,T)=>{for(let w=C,D=C+b;w<D;w++){g(w),h.a.applyMatrix4(t),h.b.applyMatrix4(t),h.c.applyMatrix4(t),h.needsUpdate=!0;for(let z=_,F=_+x;z<F;z++)if(u(z),i.needsUpdate=!0,a(i,h,z,w,y,M,R,T))return!0}return!1};if(r){const _=r;r=function(x,C,b,y,M,R,T,w){return!!_(x,C,b,y,M,R,T,w)||A(x,C,b,y,M,R,T,w)}}else r=A}return Gae(this,e,t,r)}intersectsBox(e,t){return J0.set(e.min,e.max,t),J0.needsUpdate=!0,this.shapecast({intersectsBounds:n=>J0.intersectsBox(n),intersectsTriangle:n=>J0.intersectsTriangle(n)})}intersectsSphere(e){return this.shapecast({intersectsBounds:t=>e.intersectsBox(t),intersectsTriangle:t=>t.intersectsSphere(e)})}closestPointToGeometry(e,t,n={},r={},a=0,i=1/0){return(this.indirect?Vae:Iae)(this,e,t,n,r,a,i)}closestPointToPoint(e,t={},n=0,r=1/0){return dae(this,e,t,n,r)}getBoundingBox(e){return e.makeEmpty(),this._roots.forEach(t=>{Yn(0,new Float32Array(t),tR),e.union(tR)}),e}}class Hae extends Mt{}function nR(o,e,t){return o===null?null:(o.point.applyMatrix4(e.matrixWorld),o.distance=o.point.distanceTo(t.ray.origin),o.object=e,o)}const eg=new Td,rR=new B,oR=new Ve,Wae=Mt.prototype.raycast,Yae=Hae.prototype.raycast,aR=new B,Ir=new Mt,tg=[];function OP(o,e){this.isBatchedMesh?jae.call(this,o,e):Xae.call(this,o,e)}function jae(o,e){if(this.boundsTrees){const t=this.boundsTrees,n=this._drawInfo||this._instanceInfo,r=this._drawRanges||this._geometryInfo,a=this.matrixWorld;Ir.material=this.material,Ir.geometry=this.geometry;const i=Ir.geometry.boundsTree,s=Ir.geometry.drawRange;Ir.geometry.boundingSphere===null&&(Ir.geometry.boundingSphere=new Yo);for(let c=0,u=n.length;c<u;c++){if(!this.getVisibleAt(c))continue;const h=n[c].geometryIndex;if(Ir.geometry.boundsTree=t[h],this.getMatrixAt(c,Ir.matrixWorld).premultiply(a),!Ir.geometry.boundsTree){this.getBoundingBoxAt(h,Ir.geometry.boundingBox),this.getBoundingSphereAt(h,Ir.geometry.boundingSphere);const f=r[h];Ir.geometry.setDrawRange(f.start,f.count)}Ir.raycast(o,tg);for(let f=0,m=tg.length;f<m;f++){const g=tg[f];g.object=this,g.batchId=c,e.push(g)}tg.length=0}Ir.geometry.boundsTree=i,Ir.geometry.drawRange=s,Ir.material=null,Ir.geometry=null}else Yae.call(this,o,e)}function Xae(o,e){if(this.geometry.boundsTree){if(this.isAuxClippingMesh||this.material===void 0)return;try{oR.copy(this.matrixWorld).invert()}catch{return}eg.copy(o.ray).applyMatrix4(oR),aR.setFromMatrixScale(this.matrixWorld),rR.copy(eg.direction).multiply(aR);const t=rR.length(),n=o.near/t,r=o.far/t,a=this.geometry.boundsTree;if(o.firstHitOnly===!0){const i=nR(a.raycastFirst(eg,this.material,n,r),this,o);i&&e.push(i)}else{const i=a.raycast(eg,this.material,n,r);for(let s=0,c=i.length;s<c;s++){const u=nR(i[s],this,o);u&&e.push(u)}}}else Wae.call(this,o,e)}function FP(o={}){return this.boundsTree=new Fv(this,o),this.boundsTree}function UP(){this.boundsTree=null}const iR=["toneMapping","toneMappingLook","toneMappingMidTones","toneMappingPhysicalScale","toneMappingBrightness","toneMappingContrast","toneMappingChromaticAdaptation","toneMappingWhiteColor","toneMappingColorDifferentiation","toneMappingExteriorDaylight","toneMappingWhiteBalance","toneMappingHighlights","toneMappingShadows","toneMappingSaturation","toneMappingAperture","toneMappingShutter","toneMappingISO","toneMappingVignetting"],qae={type:"afterFirstRender"},Zae={type:"afterRender"},Kae={type:"beforeRender"},$ae={type:"dispose"},Jae={type:"pause"},eie={type:"resume"},tie={type:"sceneLoad"};function ni(o,e,t){return 2*gd*Math.atan(Math.tan(ls*o/2)*e/t)}let zP=class extends oo{constructor(e,t={},n=null){if(super(),this.container=e instanceof HTMLElement?e:document.getElementById(e),this.scene=null,this.camera=null,this.clock=new bi,this.mixer=null,this.renderCallbacks=[],this.compileCallbacks=[],this.elapsed=0,this.frame=0,this.preloader=n,this.worldCubemapRes=1024,this._pmremMaxTileSize=256,this._lightProbeCubemapRes=64,this._debugHelpers=[],this._debugModes=new Set,this.xrSession=null,this.xrCameraParent=null,this.xrControllers=[],t=t||{},!Wn.checkWebGL()){const i=t.webglErrorMsg||'Ouch! Your device does not support WebGL.<br>Find out how to fix this <a href="https://www.soft8soft.com/webgl-supported-browsers-and-troubleshooting/" target="_top" class="v3d-webgl-error-link">here</a>.';return void Wn.showWebGLErrorMessage(this.container,i)}Br.legacyMode=!1;const r={};r.alpha=!!_e(t.alpha)&&t.alpha,r.depth=!_e(t.depth)||t.depth,r.stencil=!_e(t.stencil)||t.stencil,r.antialias=!_e(t.antialias)||t.antialias,r.premultipliedAlpha=!_e(t.premultipliedAlpha)||t.premultipliedAlpha,r.preserveDrawingBuffer=!!_e(t.preserveDrawingBuffer)&&t.preserveDrawingBuffer,Wn.isSafariWithMultisamplingBug()&&(console.warn("v3d.App: disabling buggy context AA on Safari 15.4"),r.antialias=!1),this.renderer=new Wy(r),qB.prepareRenderer(this.renderer),this.clearBkgOnLoad=!1,this.registerServiceKeys=!0,this.frameRateDivider=1,this.enableRender=!0,this.disableRenderTrigger=0,this.ssaaOnPause=!1,this.renderer.setSize(this.container.offsetWidth,this.container.offsetHeight),this.renderer.outputEncoding=3001,this.container.appendChild(this.renderer.domElement),this.container.classList.add("v3d-container"),this.renderer.domElement.classList.add("v3d-canvas"),this.container.setAttribute("translate","no"),this._onContextRestoreCb=()=>{this._onContextRestore()},this.renderer.domElement.addEventListener("webglcontextrestored",this._onContextRestoreCb),this.loader=new xP;const a=new si().setTranscoderPath(_v()).detectSupport(this.renderer);this.loader.setKTX2Loader(a),mt.prototype.computeBoundsTree=FP,mt.prototype.disposeBoundsTree=UP,Mt.prototype.raycast=OP,this.actions=[],this._envIBLMode=0,this._envLightProbe=null,this._resizeCb=null,this._loadSceneURL="",this._loadingTime=0,this._webxrSave={background:null,postprocessing:null,useOIT:!1},this.stats=null,eo.drawWatermark(this),eo.addToAppList(this),this.worldMaterial=null}_updateRendererFromGLTF(e){const t=this,n=Wn.checkHalfFloatTex(this.renderer,!0);if(e.renderer.shadowMap&&(this.renderer.shadowMap.enabled=e.renderer.shadowMap.enabled,this.renderer.shadowMap.type=e.renderer.shadowMap.type,n||this.renderer.shadowMap.type!==3||(this.renderer.shadowMap.type=2,e.scene.traverse(function(r){r.isLight&&r.castShadow&&r.shadow&&(r.shadow.bias/=100)}))),this.aaMethod=e.renderer.aaMethod||"AUTO",this.useHDR=!!(e.renderer.useHDR&&n),this.renderer.useOIT=e.renderer.useOIT??!1,this.renderer.unitsScaleFactor=e.renderer.unitsScaleFactor??1,e.renderer.toneMapping)for(let r=0;r<iR.length;r++){const a=iR[r];_e(e.renderer[a])&&(this.renderer[a]=e.renderer[a])}e.renderer.pmremMaxTileSize!==void 0&&(this._pmremMaxTileSize=e.renderer.pmremMaxTileSize),e.renderer.iblEnvironmentMode!==void 0&&(this._envIBLMode=e.renderer.iblEnvironmentMode),e.renderer.esmDistanceScale!==void 0&&(this.renderer.shadowMap.esmDistanceScale=e.renderer.esmDistanceScale),e.scene.traverse(function(r){r.hidpiCompositing&&(r.traverse(a=>{r.isMesh&&(a.layers.set(7),a.isMaterialGeneratedMesh&&r.parent.layers.set(7))}),t.useHiDPIRenderPass=!0,t.renderer.setPixelRatio(window.devicePixelRatio))}),t.useHiDPIRenderPass&&e.scene.traverse(function(r){r.isLight&&r.layers.enable(7)})}_updateMeshesRaycastFromGLTF(e){e.scene&&e.scene.traverse(function(t){const n=t.geometry;t.isMesh&&(!n.computeBoundsTree||Object.keys(n.morphAttributes).length!==0||n.attributes.position.isInterleavedBufferAttribute||n.index&&n.index.isInterleavedBufferAttribute||n.computeBoundsTree({verbose:!1}))})}_prepareReflProbesFromGLTF(e){e.scene&&e.scene.traverse(t=>{if(t.isCubeReflectionProbe)this._prepareEnvMapProbe(t);else if(t.isPlaneReflectionProbe){let n=this._checkMSAA(this.renderer,4);n>0&&t.makeMultisampleRenderTarget(n)}})}_prepareEnvMapProbe(e){switch(e.setSize(this._pmremMaxTileSize),this._envIBLMode){case 0:e.onUpdate=t=>this.generateRTargetPMREM(t);break;case 1:case 2:e.onUpdate=()=>null}}_prepareReflProbesEncoding(e,t){e.traverse(n=>{(n.isCubeReflectionProbe||n.isPlaneReflectionProbe)&&n.setEncoding(t)})}_prepareEnvMapProbeWorld(){if(this._envIBLMode==2)return;const e=new Hr;e.worldMaterial=this.scene.worldMaterial,this.scene.worldEnvMapProbe===null&&(this.scene.worldEnvMapProbe=new bb(this._pmremMaxTileSize),this.scene.worldEnvMapProbe.influenceType=0,this.scene.worldEnvMapProbe.parallaxType=0);const t=this.scene.worldEnvMapProbe;switch(this._envIBLMode){case 0:t.onUpdate=n=>this.generateRTargetPMREM(n);break;case 1:t.onUpdate=n=>{const r=n.clone();r.setSize(this._lightProbeCubemapRes,this._lightProbeCubemapRes),Wn.checkHalfFloatReadPixels(this.renderer)?r.texture.type=1016:Wn.checkFloatReadPixels(this.renderer)?r.texture.type=1015:(console.warn("v3d.App: Target platform does not support reading pixels in float format, expect quality loss."),r.texture.type=1009),r.texture.format=1023,r.texture.encoding=3e3;const a=new ep(n.texture);return a.render(this.renderer,r),a.dispose(),this._disposeEnvLightProbe(),this._envLightProbe=IP.fromCubeRenderTarget(this.renderer,r),this.scene.add(this._envLightProbe),r.dispose(),null}}t.update(e,this.renderer)}_updateMaterialsFromGLTF(e){const t=this;e.scene&&e.scene.traverse(function(n){const r=n.material;r&&t.useHDR&&(r.toneMapped=!1,r.useFloatTex=Wn.checkFloatTex(t.renderer,!0),r.isMeshNodeMaterial&&r.updateNodeGraph(!0))})}_updateAnimationsFromGLTF(e,t){const n=this;!n.mixer&&e.animations&&e.animations.length&&(n.mixer=new AB(n.scene)),(e.animations||[]).forEach(function(r){const a=t.getObjectById(r.nodeId);if(a){let i;i=a.id==t.id||a.name!==""&&a.name!=="root"&&a.name!=="."&&a.name!==t.name&&a.name!==t.uuid?n.mixer.clipAction(r.clip,t):n.mixer.clipAction(r.clip,a),i.setLoop(r.loop,r.repetitions),i.startAt(r.startAt+n.mixer.time),i.clampWhenFinished=!0,r.auto?i.play():(i.stop(),i.paused=!0),n.actions.push(i)}})}_traverseSceneForTexUniforms(e,t){e.traverse(function(n){n.material&&(Array.isArray(n.material)?n.material:[n.material]).forEach(function(r){r.program!==void 0&&t(n,r,r.program.getTexUniformCount())})})}_checkMSAA(e,t){return Math.min(t,e.capabilities.maxSamples)}_precompileSceneAsync(e,t,n,r){const a=this,i=a.compileCallbacks;for(let c=0;c<i.length;c++)i[c](a);const s=a.renderer.getRenderTarget();a.renderer.setRenderTarget(n),a.renderer.compileAsync(e,t,function(c){c>=1&&a.renderer.setRenderTarget(s),r&&r(100*c)})}_handleAlphaToCoverage(e){this.scene.traverse(function(t){const n=t.material;n&&n.alphaToCoverage&&(e>0?(n.transparent=!1,n.premultipliedAlpha=!1,n.blending=0):n.alphaToCoverage=!1)})}_onContextRestore(e){this.scene&&this.scene.worldMaterial&&(this.updateEnvironment(this.scene.worldMaterial),this.updateReflectionProbes(this.scene))}assignClippingPlanes(e){const t=this;let n=[],r=[],a=[],i=-1e3;e.traverse(function(s){s.isClippingPlaneObject&&(n.push(s),r.push(s.plane),e.traverse(function(c){s.needsClippingPlane(c)&&s.assignToObject(c,i++)}),a.push(i++))});for(let s=0;s<n.length;s++){const c=n[s];c.crossSection&&c.createCrossSectionPlane(r,a[s])}n.length&&(t.renderer.localClippingEnabled=!0,t.postprocessing&&t.postprocessing.composer.setStencil(!0))}updateConstraints(e){const t=this;e.traverse(function(n){for(let r=0;r<n.constraints.length;r++){const a=n.constraints[r];a.isCanvasBreakpointsConstraint&&(a.appInstance=t),a.isCanvasFitConstraint&&(a.xr=t.renderer.xr),e.userData&&e.userData.coordSystem&&a.coordSystem&&(a.coordSystem=e.userData.coordSystem)}})}loadScene(e,t,n,r){const a=this;a.renderer?(a._loadSceneURL=e,a._loadingTime=performance.now(),a.preloader&&a.preloader.onUpdate(0),this.loader.load(e,function(i){a.scene=i.scene||new Hr;let s=null;i.cameras&&i.cameras.length?a.camera=i.cameras[0]:(s=gg(a.scene),a.camera=jB(s,a.container.offsetWidth/a.container.offsetHeight),a.scene.add(a.camera)),a.camera.controlSettings||(s=s||gg(a.scene),XB(a.camera,gg(a.scene)),a.camera.viewportFit.type=1),a._updateRendererFromGLTF(i),a._prepareReflProbesFromGLTF(i),a._updateMaterialsFromGLTF(i),a._updateAnimationsFromGLTF(i,a.scene);const c=i.world.material;c&&(a.scene.background=new Qe,a.scene.worldMaterial=c,a.updateEnvironment(c),a.worldMaterial=c),a.initPostprocessing(),a.assignClippingPlanes(a.scene),a.updateConstraints(a.scene),a.onResize&&a.onResize(),a.scene.updateWorldMatrix(!1,!0),a.scene.matrixWorldAutoUpdate=!1,a.scene.visible=!1,a.scene.disableChildRendering=!0;const u=function(){a.scene&&a._traverseSceneForTexUniforms(a.scene,function(f,m,g){g>8&&console.warn(`v3d.App: Material "${m.name}" on object "${f.name}" exceeds iOS limit of 8 textures (has ${g}).`)}),a.removeEventListener("afterFirstRender",u)},h=a.postprocessing?a.postprocessing.composer.renderTarget1:null;a._precompileSceneAsync(a.scene,a.camera,h,function(f){const m=(60+.4*f)/1;n&&n(m),a.preloader&&a.preloader.onUpdate(m),m>=100&&(a._updateMeshesRaycastFromGLTF(i),a.addEventListener("afterFirstRender",u),t&&setTimeout(function(){a.scene.visible=!0,a.scene.disableChildRendering=!1,a.updateReflectionProbes(a.scene),a._loadingTime=performance.now()-a._loadingTime,a.dispatchEvent({...tie}),t(a.scene)},16),i=null)}),a.clearBkgOnLoad&&(a.scene.background=null),a.registerServiceKeys&&eo.registerServiceKeys(a)},function(i){const s=.6*i/1;n&&n(s),a.preloader&&a.preloader.onUpdate(s)},function(i){console.error(i),r&&r(i)}),window.removeEventListener("resize",this._resizeCb,!1),this._resizeCb=function(){a.onResize&&a.onResize()},window.addEventListener("resize",this._resizeCb,!1)):r&&r("WebGL not found")}appendScene(e,t,n,r,a,i){const s=this;s.renderer?(a===void 0&&(a=!0),i===void 0&&(i=!0),s.preloader&&s.preloader.onUpdate(0),this.loader.load(e,function(c){const u=c.scene||new Hr,h=[];u.traverse(function(g){(g.isCamera&&!a||g.isLight&&!i)&&h.push(g)}),h.forEach(function(g){s.unload(g)}),s.scene&&(s.scene.add(u),s._prepareReflProbesFromGLTF(c),s._updateMaterialsFromGLTF(c),s._updateAnimationsFromGLTF(c,u),s.scene.updateWorldMatrix(!1,!0));const f=s.postprocessing?s.postprocessing.composer.renderTarget1:null,m=s.scene||u;s.assignClippingPlanes(m),s.updateConstraints(m),u.visible=!1,u.disableChildRendering=!0,s._precompileSceneAsync(m,s.camera||new dp,f,function(g){const A=(60+.4*g)/1;n&&n(A),s.preloader&&s.preloader.onUpdate(A),A>=100&&(s._updateMeshesRaycastFromGLTF(c),s._traverseSceneForTexUniforms(u,function(_,x,C){C>8&&console.warn(`v3d.App: Material "${x.name}" on object "${_.name}" exceeds iOS limit of 8 textures (has ${C}).`)}),t&&setTimeout(function(){u.visible=!0,u.disableChildRendering=!1,s.updateReflectionProbes(s.scene),t(u)},16),c=null)})},function(c){const u=.6*c/1;n&&n(u),s.preloader&&s.preloader.onUpdate(u)},function(c){console.error(c),r&&r(c)})):r&&r("WebGL not found")}unload(e){const t=this;function n(r){if(r.isAnnotation)r.dispose();else if(r.isLight&&r.shadow&&r.shadow.isLightShadow)r.shadow.dispose();else if(r.isCamera&&r.controlSettings&&r.controlSettings.orbitTarget)n(r.controlSettings.orbitTarget);else if(r.isScene){const a=r.worldMaterial;a!==null&&(k2(a),a.dispose()),r.worldEnvMapProbe!==null&&(r.worldEnvMapProbe.dispose(),r.worldEnvMapProbe=null)}else if(r.isMesh){r.geometry.dispose(),r.geometry.disposeBoundsTree&&r.geometry.disposeBoundsTree();const a=r.material;k2(a),a.dispose()}}if(e||(e=t.scene),e===t.scene){if(t.scene&&(t.scene.traverse(n),t.disposeEnvironment(),t.worldMaterial=null),t.scene=null,t.disableControls(),t.camera=null,t.mixer&&(t.mixer.stopAllAction(),t.actions.forEach(function(r){t.mixer.uncacheAction(r.getClip(),r.getRoot())})),t.mixer=null,t.actions=[],t.postprocessing){if(t.postprocessing.composer)for(let r in t.postprocessing){const a=t.postprocessing[r];(a instanceof pa||a instanceof G2)&&a.dispose()}t.disablePostprocessing()}t.postprocessing=null,Ga.dispose(),t.renderer&&t.renderer.disposeInternalCaches(),eo.unregisterServiceKeys(t),t.useHiDPIRenderPass=!1,t.renderer.setPixelRatio(1)}else if(t.scene&&(e.traverse(n),e.parent&&e.parent.remove(e)),t.mixer)for(let r=t.actions.length-1;r>=0;r--){const a=t.actions[r];YB(t.scene,a)||(a.stop(),t.mixer.uncacheAction(a.getClip(),a.getRoot()),t.actions.splice(r,1))}}dispose(){this.scene&&this.unload(),this.renderer&&(this.renderer.forceContextLoss(),this.renderer.dispose(),this.renderer.domElement.removeEventListener("webglcontextrestored",this._onContextRestoreCb),this._onContextRestoreCb=null,this.renderer.domElement.parentElement===this.container&&this.container.removeChild(this.renderer.domElement)),this.renderer=null,this.loader=null,window.removeEventListener("resize",this._resizeCb,!1),this._resizeCb=null,this.renderCallbacks.length=0,this.compileCallbacks.length=0,eo.removeFromAppList(this),Qa.clear(),this.dispatchEvent({...$ae}),delete this._listeners}getWidth(){return this.container.offsetWidth}getHeight(){return this.container.offsetHeight}onResize(){if(!this.renderer)return;this.enableRender&&!this.ssaaOnPause||(this.enableRendering(),this.disableRendering(1));const e=this.getWidth(),t=this.getHeight();if(this.renderer.setSize(e,t),this.postprocessing&&(this.postprocessing.gtaoGenerator&&this.postprocessing.gtaoGenerator.setSize(e,t),this.postprocessing.composer.setSize(e,t)),this.scene){this.scene.traverse(a=>{a.isPlaneReflectionProbe&&a.setSize(e,t)});const n=e/t,r=this.camera;if(r.isPerspectiveCamera){const a=r.aspect<r.viewportFit.initialAspect,i=n<r.viewportFit.initialAspect;switch(r.viewportFit.type){case 1:r.aspect=n;break;case 2:r.fov=ni(r.fov,r.aspect,n),r.aspect=n;break;case 3:a&&i?r.fov=ni(r.fov,r.aspect,n):a&&!i?r.fov=ni(r.fov,r.aspect,r.viewportFit.initialAspect):!a&&i&&(r.fov=ni(r.fov,r.viewportFit.initialAspect,n)),r.aspect=n;break;case 5:a&&i?r.fov=ni(r.fov,r.aspect,n):a&&!i?r.fov=ni(r.fov,r.viewportFit.initialAspect,n):!a&&i&&(r.fov=ni(r.fov,r.aspect,n)),r.aspect=n;break;case 4:a||i?a&&!i?r.fov=ni(r.fov,r.viewportFit.initialAspect,n):!a&&i&&(r.fov=ni(r.fov,r.aspect,r.viewportFit.initialAspect)):r.fov=ni(r.fov,r.aspect,n),r.aspect=n}}else if(r.isOrthographicCamera){let a,i;switch(r.viewportFit.type){case 1:case 5:a=r.top*n,r.left=-a,r.right=a;break;case 2:case 4:i=r.right/n,r.bottom=-i,r.top=i;break;case 3:const s=(r.right-r.left)/(r.top-r.bottom)<r.viewportFit.initialAspect,c=n<r.viewportFit.initialAspect;a=s&&c?r.right:s&&!c?r.right*n/r.viewportFit.initialAspect:!s&&c?r.top*r.viewportFit.initialAspect:r.top*n,r.left=-a,r.right=a,r.bottom=-a/n,r.top=a/n}}r.updateProjectionMatrix()}}run(){this.preloader&&(this.preloader.onFinish(),this.preloader=null),this.animate()}animate(){const e=this;e.renderer.setAnimationLoop(function(){e.stats&&e.stats.begin();const t=e.clock.getDelta();e.elapsed=t,e.mixer&&e.mixer.update(t),e.controls&&!e.xrSession&&e.controls.update(t);const n=e.renderCallbacks;for(let r=0;r<n.length;r++)n[r](t,e.clock.elapsedTime);e.frame%e.frameRateDivider==0&&e.enableRender&&(e.render(),e.frame===0&&e.dispatchEvent({...qae})),e.frame++,e.disableRenderTrigger&&--e.disableRenderTrigger==0&&(e.enableRender=!1),e.stats&&e.stats.end()})}enableRendering(){this.disableRenderTrigger=0,this.enableRender=!0,this.ssaaOnPause&&this.enableSSAA(0,!0)}disableRendering(e){this.xrSession||(((e=e||0)||this.ssaaOnPause)&&this.enableRender&&this.disableRenderTrigger==0?(this.disableRenderTrigger=this.ssaaOnPause?32:e,this.ssaaOnPause&&this.enableSSAA(4,!0)):e==0&&(this.enableRender=!1))}pause(){this.renderer.setAnimationLoop(null),this.clock.stop(),this.dispatchEvent({...Jae})}resume(){this.animate(),this.clock.start(),this.dispatchEvent({...eie})}setFrameRateDivider(e){this.frameRateDivider=e}render(){this.dispatchEvent({...Kae});const e=!!this.scene&&!!this.camera;if(e&&(this.scene.updateMatrixWorld(),this.scene.traverse(t=>{t.isPlaneReflectionProbe&&t.update(this.scene,this.camera,this.renderer)})),this.renderer.gtaoMapEnabled=!0,this.postprocessing){const t=this.postprocessing.gtaoGenerator;t&&t.render(this.renderer),this.postprocessing.composer.render(this.elapsed)}else e&&this.renderer.render(this.scene,this.camera);if(e&&this.useHiDPIRenderPass){const t=this.camera.layers.mask,n=this.scene.background,r=this.renderer.autoClear,a=this.renderer.useOIT;this.camera.layers.set(7),this.scene.background=null,this.renderer.autoClear=!1,this.renderer.useOIT=!1,this.renderer.clearDepth(),this.renderer.render(this.scene,this.camera),this.camera.layers.mask=t,this.scene.background=n,this.renderer.autoClear=r,this.renderer.useOIT=a}this.renderer.gtaoMapEnabled=!1,this.dispatchEvent({...Zae})}enableControls(e){const t=this.camera;if(!t.controlSettings)return;const n=t.controlSettings.type;if(!(this.controls&&t===this.controls.object&&(this.controls instanceof F2&&n==="ORBIT"||this.controls instanceof z2&&n==="FLYING"||this.controls instanceof U2&&n==="FIRST_PERSON")))switch(this.disableControls(),n){case"ORBIT":this.controls=new F2(t,e||this.renderer.domElement);break;case"FLYING":this.controls=new z2(t,this.renderer.domElement);break;case"FIRST_PERSON":this.controls=new U2(t,this.renderer.domElement);break;default:this.controls=null}this.controls&&(t.controlSettings.assignToControls(this.controls,this.scene),this.controls.update())}disableControls(){this.controls&&(this.controls.dispose(),this.controls=null)}setCamera(e){let t=[];if(this.camera)for(let n=this.camera.children.length-1;n>=0;n--){const r=this.camera.children[n];r instanceof fB&&(t.push(r),r.removeFromParent())}if(this.camera=e,this.postprocessing){const n=this.postprocessing.composer.passes;for(let r=0;r<n.length;r++)n[r].setCamera(e);this.postprocessing.renderPass&&this.postprocessing.renderPass.setCamera(e),this.postprocessing.ssaaRenderPass&&this.postprocessing.ssaaRenderPass.setCamera(e),this.postprocessing.gtaoGenerator&&this.postprocessing.gtaoGenerator.setCamera(e)}e.controlSettings?this.enableControls():this.disableControls();for(let n=0;n<t.length;n++)e.add(t[n]);this.onResize()}getCamera(e=!1){return e&&this.camera&&this.renderer&&this.renderer.xr.enabled&&this.renderer.xr.isPresenting?this.renderer.xr.getCamera():this.camera}initPostprocessing(){(this.scene.postprocessing&&this.scene.postprocessing.length||this.useHDR||this.useHiDPIRenderPass||this.aaMethod!="AUTO"||this.renderer.useOIT)&&this.enablePostprocessing(this.scene.postprocessing||[]),this.renderer.useOIT&&(this.useHiDPIRenderPass?console.warn("v3d.App: Order-Independent Transparency is not compatible with HiDPI Compositing, disabling OIT"):this.renderer.setOIT(1,this.postprocessing.composer.writeBuffer.samples)),this.postprocessing||this._handleAlphaToCoverage(this.renderer.getContextAttributes().antialias?4:0)}enablePostprocessing(e){if(this.xrSession)return;const t={format:1023,stencilBuffer:!1};let n;if(this.useHDR?(t.type=1016,t.encoding=3e3):(t.type=1009,t.encoding=3001),this._prepareReflProbesEncoding(this.scene,t.encoding),this.postprocessing)n=this.postprocessing.composer;else{this.postprocessing={};const r=new qg(this.scene,this.camera);this.postprocessing.renderPass=r;let a=0;switch(this.aaMethod){case"AUTO":case"MSAA4":a=this._checkMSAA(this.renderer,4);break;case"MSAA8":a=this._checkMSAA(this.renderer,8);break;case"MSAA16":a=this._checkMSAA(this.renderer,16)}Wn.checkSwiftShader(this.renderer)&&(console.warn("v3d.App: disabling buggy multisampling on SwiftShader renderer"),a=0),Wn.isSafariWithMultisamplingBug()&&(console.warn("v3d.App: disabling buggy multisampling on Safari 15.4"),a=0);const i=new qt(this.getWidth(),this.getHeight(),t);i.texture.name="EffectComposer.rt1",i.samples=a,n=new G2(this.renderer,i),n.addPass(r),this.postprocessing.composer=n;const s=this.renderer.getContextAttributes().alpha,c=a==0&&this.aaMethod!="NONE",u=new hb;if(c&&!s&&(u.material.defines.ALPHA_AS_LUMA=1),this.useHDR||(u.material.toneMapped=!1),n.addPass(u),this.postprocessing.toneMapPass=u,c){const h=new Xg(this.scene,this.camera);this.useHDR&&!s&&(h.material.defines.FXAA_GREEN_AS_LUMA=0),n.addPass(h),this.postprocessing.fxaaPass=h}this._handleAlphaToCoverage(a)}e.length&&this.postprocessing.copyPass&&(n.passes.splice(n.passes.indexOf(this.postprocessing.copyPass),1),this.postprocessing.copyPass=null);for(let r=0;r<e.length;r++){const a=e[r];let i=n.passes.length-1;switch(n.passes[i]instanceof Xg&&i--,a.type){case"afterimage":const s=a.damp;let c;this.postprocessing.afterimagePass?(c=this.postprocessing.afterimagePass,c.damp=s):(c=new MB(new Ee(this.getWidth(),this.getHeight()),s,t),n.insertPass(c,i),this.postprocessing.afterimagePass=c);break;case"bloom":const u=a.strength,h=a.radius,f=a.threshold;let m;this.postprocessing.bloomPass?(m=this.postprocessing.bloomPass,m.strength=u,m.radius=h,m.threshold=f):(m=new pl(new Ee(this.getWidth(),this.getHeight()),u,h,f,t),n.insertPass(m,i),this.postprocessing.bloomPass=m);break;case"brightnessContrast":let g;this.postprocessing.brightnessContrastPass?g=this.postprocessing.brightnessContrastPass:(g=new ub,n.insertPass(g,i),this.postprocessing.brightnessContrastPass=g),g.brightness=a.brightness,g.contrast=a.contrast;break;case"dof":let A;this.postprocessing.bokehPass?A=this.postprocessing.bokehPass:(A=new cb(this.scene,this.camera,{width:this.getWidth(),height:this.getHeight()}),n.insertPass(A,i),this.postprocessing.bokehPass=A),A.focus=a.focus,A.aperture=a.aperture,A.maxblur=a.maxblur,A.depthLeakThreshold=a.depthLeakThreshold;break;case"grayscale":if(!this.postprocessing.grayscalePass){const M=new db;n.insertPass(M,i),this.postprocessing.grayscalePass=M}break;case"gtao":if(!Wn.checkDepthTex(this.renderer)){console.warn("v3d.App: disabling GTAO since your hardware does not support depth textures");break}if(Wn.getGPUVendor(this.renderer)==="ARM"&&Wn.getGPUModel(this.renderer).startsWith("Mali-")){console.warn("v3d.App: disabling buggy GTAO on Mali devices");break}let _=this.postprocessing.gtaoGenerator;if(!_){_=this.postprocessing.gtaoGenerator=new RP(this.scene,this.camera,this.getWidth(),this.getHeight());const M=R=>{_.removeEventListener("dispose",M),this.renderer.disposeGTAO()};_.addEventListener("dispose",M),this.renderer.gtaoMap=_.renderTarget.texture}_.distance=a.distance,_.factor=a.factor,_.precision=a.precision,_.bentNormals=a.bentNormals??!1;break;case"outline":let x;this.postprocessing.outlinePass?x=this.postprocessing.outlinePass:(x=new ii(new Ee(this.getWidth(),this.getHeight()),this.scene,this.camera),n.insertPass(x,i),this.postprocessing.outlinePass=x),x.edgeStrength=a.edgeStrength,x.edgeGlow=a.edgeGlow,x.edgeThickness=a.edgeThickness,x.pulsePeriod=a.pulsePeriod,x.visibleEdgeColor.fromArray(a.visibleEdgeColor),x.hiddenEdgeColor.fromArray(a.hiddenEdgeColor),x.hiddenEdgeColor.setW(Number(a.renderHiddenEdge));break;case"ssr":if(!Wn.checkHalfFloatTex(this.renderer,!1)){console.warn("v3d.App: disabling SSR since your hardware does not support half float textures");break}const C=_e(a.useRefract)&&a.useRefract,b=_e(a.simpleRefraction)&&a.simpleRefraction;let y;y=C&&!b?this.postprocessing.ssrPassRefract:C&&b?this.postprocessing.ssrPassSimpleRefract:this.postprocessing.ssrPassReflect,y||(y=new IB(this.scene,this.camera),n.insertPassAfter(y,[this.postprocessing.renderPass,this.postprocessing.ssrPassRefract,this.postprocessing.ssrPassReflect,this.postprocessing.ssrPassSimpleRefract]),C&&!b?this.postprocessing.ssrPassRefract=y:C&&b?this.postprocessing.ssrPassSimpleRefract=y:this.postprocessing.ssrPassReflect=y),y.useRefract=C,y.simpleRefraction=b,_e(a.objects)&&(y.objects=a.objects),_e(a.intensity)&&(y.intensity=a.intensity),_e(a.steps)&&(y.steps=a.steps),_e(a.stride)&&(y.stride=a.stride),_e(a.binarySearchSteps)&&(y.binarySearchSteps=a.binarySearchSteps),_e(a.renderTargetScale)&&(y.renderTargetScale=a.renderTargetScale),_e(a.thickness)&&(y.thickness=a.thickness),_e(a.maxDistance)&&(y.maxDistance=a.maxDistance),_e(a.jitter)&&(y.jitter=a.jitter),_e(a.renderAfter)&&(y.renderAfter=a.renderAfter),this.onResize&&this.onResize();break;default:console.error(`v3d.App: wrong postprocessing effect "${a.type}"`)}}if(n.passes.length==1){const r=new ms(xt.copy);n.passes.push(r),this.postprocessing.copyPass=r}}disablePostprocessing(e,t){if(!this.postprocessing)return;const n=this.postprocessing.gtaoGenerator;!t&&n&&(n.dispose(),this.postprocessing.gtaoGenerator=null);const r=["afterimagePass","bloomPass","brightnessContrastPass","bokehPass","grayscalePass","ssrPassReflect","ssrPassRefract","ssrPassSimpleRefract"];e||r.push("outlinePass");const a=this.postprocessing.composer;for(let i=0;i<r.length;i++){const s=r[i];this.postprocessing[s]&&(a.passes.splice(a.passes.indexOf(this.postprocessing[s]),1),this.postprocessing[s].dispose(),this.postprocessing[s]=null)}if(this.aaMethod!="AUTO"||a.passes.length!=1||this.postprocessing.gtaoGenerator){if(a.passes.length==1){const i=new ms(xt.copy);a.passes.push(i),this.postprocessing.copyPass=i}}else this.postprocessing.renderPass.dispose(),this.postprocessing.composer.dispose(),this.postprocessing=null}enableSSAA(e,t){if(this.postprocessing||this.enablePostprocessing([]),!this.postprocessing||e>0&&(this.postprocessing.ssrPassRefract||this.postprocessing.ssrPassReflect))return;const n=this;this.scene.traverse(function(a){a.isAnnotationControl&&(a.update(n.camera),a.doUpdate=!e)});const r=this.postprocessing.composer;if(e>0&&r.passes[0]instanceof qg){let a;this.postprocessing.ssaaRenderPass?a=this.postprocessing.ssaaRenderPass:(a=new Jh(this.scene,this.camera),this.postprocessing.ssaaRenderPass=a,t&&a.addEventListener("iteration",function(i){i.frame==e*e-1&&(r.enableAllPasses(),r.renderToScreen=!0,r.passes[r.passes.length-1].renderToScreen=!0,n.disableRenderTrigger=1)})),a.sampleLevel=e||4,r.passes[0]=a,this.postprocessing.fxaaPass&&r.passes.splice(r.passes.length-1,1),t&&(a.iterative=!0,a.iterativeFrame=0,r.disableAllPasses(),r.renderToScreen=!1,a.enabled=!0)}else e>0?(r.passes[0].sampleLevel=e||4,t&&(ssaaRenderPass.iterative=!0,ssaaRenderPass.iterativeFrame=0,r.disableAllPasses(),r.renderToScreen=!1,ssaaRenderPass.enabled=!0)):e==0&&r.passes[0]instanceof Jh&&(r.passes[0]=this.postprocessing.renderPass,this.postprocessing.fxaaPass&&r.passes.push(this.postprocessing.fxaaPass),r.enableAllPasses(),r.renderToScreen=!0)}updateEnvironment(e){const t=this.renderer.xr.enabled;if(this.renderer.xr.enabled=!1,this.disposeEnvironment(),e.toneMapped=!1,this.scene.background!==null){const n=this.renderer.toneMapping===0?e.worldMaterialColor():null;n!==null?this.scene.background=n:(this.scene.background=ZB(this.renderer,e,this.worldCubemapRes,{encoding:3001,format:1023,generateMipmaps:!0,minFilter:1008,type:1016}).texture,this.scene.backgroundToneMapped=!this.useHDR)}this._envIBLMode===0&&new jh(this.renderer,this._pmremMaxTileSize,!0).compileCubemapShader(),this._prepareEnvMapProbeWorld(),this.renderer.xr.enabled=t}disposeEnvironment(){this._disposeEnvLightProbe();let e=this.scene.background;e&&e&&(e.isTexture||e.isCubeTexture)&&e.dispose()}_disposeEnvLightProbe(){this._envLightProbe!==null&&(this.scene.remove(this._envLightProbe),this._envLightProbe=null)}updateReflectionProbes(e){e.traverse(t=>{t.isCubeReflectionProbe&&t.update(this.scene,this.renderer)})}generateRTargetPMREM(e){if(!e.isWebGLCubeRenderTarget)return null;const t=new jh(this.renderer,this._pmremMaxTileSize,!0),n=t.fromCubemap(e.texture);return t.dispose(),n}initWebXR(e,t,n,r,a,i){n=n||function(){},r=r||function(){},a=a||function(){},i=i||{};const s=this;function c(m){s.xrSession.removeEventListener("end",c),a();for(let g=0;g<s.xrControllers.length;g++){const A=s.xrControllers[g];A.removeEventListener("connected",u),s.scene.remove(A)}if(s.xrControllers=[],s.xrCameraParent){const g=s.camera;g.removeFromParent(),s.scene.add(g),s.scene.remove(s.xrCameraParent),s.xrCameraParent=null}if(s.xrSession=null,s._webxrSave.background&&(s.scene.background=s._webxrSave.background,s._webxrSave.background=null),s.postprocessing=s._webxrSave.postprocessing,s._webxrSave.postprocessing=null,s.postprocessing){const g=s.postprocessing.gtaoGenerator;g&&(s.renderer.gtaoMap=g.renderTarget.texture)}s.renderer.useOIT=s._webxrSave.useOIT,s._webxrSave.useOIT=!1,s.onResize()}function u(m){const g=m.data,A=m.target;if(g.targetRayMode=="tracked-pointer"){const _=new mt().setFromPoints([new B(0,0,0),new B(0,0,-1)]),x=new vi(_);x.name=A.name+"_RAY",x.scale.z=5,A.add(x)}else if(g.targetRayMode=="gaze"){const _=new ab().load(Voe),x=new Xy({map:_,sizeAttenuation:!1}),C=new L5(x);C.name=A.name+"_RETICLE",C.scale.multiplyScalar(.1),C.position.z=-5,A.add(C)}A.userData.inputSource=g}function h(m){const g=m.target;s.xrSession||g.removeEventListener("disconnected",h);for(let A=g.children.length-1;A>=0;A--){const _=g.children[A];_.name.indexOf(g.name)>-1&&(_.geometry.dispose(),_.material.dispose(),g.remove(_))}}const f={optionalFeatures:[t]};e=="immersive-ar"&&(f.optionalFeatures.push("hit-test"),i.domOverlay&&(f.optionalFeatures.push("dom-overlay"),f.domOverlay={root:s.container})),navigator.xr.requestSession(e,f).then(function(m){s._webxrSave.postprocessing=s.postprocessing,s.postprocessing=null,s._webxrSave.useOIT=s.renderer.useOIT,s.renderer.useOIT=!1,s.renderer.xr.setReferenceSpaceType(t),s.xrSession=m,m.addEventListener("end",c);const g=e=="immersive-vr"?2:1;for(let A=0;A<g;A++){const _=s.renderer.xr.getController(A);s.scene.add(_),s.xrControllers.push(_),_.addEventListener("connected",u),_.addEventListener("disconnected",h)}if(e=="immersive-vr"){const A=s.camera;A.parent&&A.parent.isScene&&(s.xrCameraParent=new Tt,s.xrCameraParent.name="XR_CAMERA_CONTROL_OBJECT",s.scene.add(s.xrCameraParent),A.removeFromParent(),s.xrCameraParent.add(A))}else s._webxrSave.background=s.scene.background,s.scene.background=null;s.renderer.xr.enabled=!0,s.renderer.xr.setSession(m),i.domOverlay&&s.renderer.xr.addEventListener("sessionstart",function(){setTimeout(function(){s.renderer.domElement.style.width=s.getWidth()+"px",s.renderer.domElement.style.height=s.getHeight()+"px"},300)}),n()}).catch(r)}endWebXR(){this.xrSession&&this.xrSession.end()}printPerformanceInfo(e){eo.printPerformanceInfo(this,e)}showFPS(){if(this.container){this.hideFPS();const e=new ld;e.showPanel(0),this.container.appendChild(e.dom),this.stats=e}}hideFPS(){this.container&&this.stats&&(this.container.removeChild(this.stats.dom),this.stats=null)}enableDebugMode(e){this.hasDebugMode(e)&&this.disableDebugMode(e),this.scene.traverse(t=>{let n=null,r=!1;if(!this._debugHelpers.includes(t)&&!this._debugHelpers.includes(t.parent)){if(e=="wireframes"&&t.isMesh)n=new zoe(t,"white");else if(e=="lights")t.isDirectionalLight?(n=new CB(t,.5,"yellow"),r=!0):t.isSpotLight?(n=new xB(t,"yellow"),r=!0):t.isPointLight?(n=new SB(t,.1,"yellow"),r=!0):t.isRectAreaLight&&(n=new Foe(t,"yellow"));else if(e=="skeletons"&&t.isBone){let a=!1;t.traverseAncestors(i=>{i.isBone&&(a=!0)}),a||(n=new yB(t))}else e=="normals"&&t.isMesh&&(n=new Uoe(t,.1));n!==null&&(n.name=t.name+"Helper",n.visible=t.visible,t.add(n),r&&n.update(),this._debugHelpers.push(n),this._debugModes.add(e))}})}disableDebugMode(e){const t={wireframes:["WireframeHelper"],lights:["DirectionalLightHelper","SpotLightHelper","PointLightHelper","RectAreaLightHelper"],skeletons:["SkeletonHelper"],normals:["VertexNormalsHelper"]};for(let n=this._debugHelpers.length-1;n>=0;n--){const r=this._debugHelpers[n];t[e].includes(r.type)&&(r.removeFromParent(),this._debugHelpers.splice(n,1))}this._debugModes.delete(e)}hasDebugMode(e){return this._debugModes.has(e)}};function nie(){console.error("v3d.SSAOPass has been removed, use v3d.GTAOMapGenerator instead")}function rie(){console.error("v3d.BlenderTextGeometry has been removed, use v3d.TextGeometry instead.")}function oie(){console.error("v3d.BlenderTextBufferGeometry has been removed, use v3d.TextGeometry instead.")}function aie(){console.error("v3d.AnimationLoader has been removed, use glTF format for asset loading.")}function iie(){console.error("v3d.BufferGeometryLoader has been removed, use glTF format for asset loading.")}function sie(){console.error("v3d.MaterialLoader has been removed, use glTF format for asset loading.")}function lie(){console.error("v3d.ObjectLoader has been removed, use glTF format for asset loading.")}class cie extends Iv{constructor(e){console.error("v3d.MeshPhongMaterial has been removed, use node-based or standard material instead."),super(e)}}class uie extends Iv{constructor(e){console.error("v3d.MeshToonMaterial has been removed, use node-based material instead."),super(e)}}class die extends Iv{constructor(e){console.error("v3d.MeshMatcapMaterial has been removed, use node-based material instead."),super(e)}}mt.prototype.toJSON=function(){return console.error("v3d.BufferGeometry.toJSON() has been removed, use glTF format for export."),{}},Tt.prototype.toJSON=function(){return console.error("v3d.Object3D.toJSON() has been removed, use glTF format for export."),{}},Er.prototype.toJSON=function(){return console.error("v3d.Material.toJSON() has been removed, use glTF format for export."),{}},Object.defineProperty(w2.prototype,"iridescence",{get:()=>(console.warn("v3d.MeshPhysicalMaterial: iridescence has been removed, use node-based material instead."),0),set(o){console.warn("v3d.MeshPhysicalMaterial: iridescence has been renamed, use node-based material instead.")}}),Object.defineProperty(w2.prototype,"sheen",{get:()=>(console.warn("v3d.MeshPhysicalMaterial: sheen has been removed, use node-based material instead."),0),set(o){console.warn("v3d.MeshPhysicalMaterial: sheen has been renamed, use node-based material instead.")}}),Ba.nodeGraphDiffuse=function(o,e,t){return console.error("v3d.MeshNodeMaterial.nodeGraphDiffuse has been deprecated. Use v3d.MaterialUtils.createDiffuseMaterial instead."),Ab("",o,e,t).nodeGraph};const fie=2,hie=2;var VP={calcCameraZoomToObjectsParams:function(){var o=new mn,e=new Yo;return function(t,n,r,a,i){var s=o.makeEmpty();n.forEach(function(u){s.expandByObject(u)});var c=s.getBoundingSphere(e);VP.calcCameraZoomToSphereParams(t,c,r,a,i)}}(),calcCameraZoomToSphereParams:function(){const o=new B;return function(e,t,n,r,a){if(e.isOrthographicCamera){let i=Math.min(e.top,e.right);a[0]=i/t.radius,n.setFromMatrixPosition(e.matrixWorld),r.copy(t.center)}else{let i=cp(e.fov/2);e.aspect<1&&(i=Math.atan(e.aspect*Math.tan(i)));let s=t.radius/Math.sin(i);const c=e.getWorldDirection(o);n.copy(t.center).addScaledVector(c,-s),r.copy(t.center)}}}()},_g={normalizeDialectOptions:function(o){var e={delimiter:",",doublequote:!0,lineterminator:`
`,quotechar:'"',skipinitialspace:!0,skipinitialrows:0};for(var t in o)e[t.toLowerCase()]=o[t];return e},parse:function(o,e){(!e||e&&!e.lineterminator)&&(o=_g.normalizeLineTerminator(o,e));var t=_g.normalizeDialectOptions(e);o=_g.chomp(o,t.lineterminator);var n,r,a="",i=!1,s=!1,c="",u=[],h=[];for(r=function(f){var m=String.prototype.trim?function(g){return g.trim()}:function(g){return g.replace(/^\s*/,"").replace(/\s*$/,"")};return s!==!0&&(f===""?f=null:t.skipinitialspace===!0&&(f=m(f)),/^\d+$/.test(f)?f=parseInt(f,10):/^\d*\.\d+$|^\d+\.\d*$/.test(f)&&(f=parseFloat(f,10))),f},n=0;n<o.length;n+=1)a=o.charAt(n),i!==!1||a!==t.delimiter&&a!==t.lineterminator?a!==t.quotechar?c+=a:i?o.charAt(n+1)===t.quotechar?(c+=t.quotechar,n+=1):i=!1:(i=!0,s=!0):(c=r(c),u.push(c),a===t.lineterminator&&(h.push(u),u=[]),c="",s=!1);return c=r(c),u.push(c),h.push(u),t.skipinitialrows&&(h=h.slice(t.skipinitialrows)),h},normalizeLineTerminator:function(o,e){return(e=e||{}).lineterminator?o:o.replace(/(\r\n|\n|\r)/gm,`
`)},chomp:function(o,e){return o.charAt(o.length-e.length)!==e?o:o.substring(0,o.length-e.length)}};const ng=new B(1,0,0),pie=new B,mie=new B,gie=new Ct;class vie extends Mt{constructor(e,t){e=e!==void 0?e:new Qe(1,0,0),t=t!==void 0?t:2;const n=new xd;n.setGeometry([0,0,0,ng.x,ng.y,ng.z]);const r=new tb({color:e,lineWidth:t,sizeAttenuation:0});super(n.geometry,r),this.isLineHTML=!0,this.elemHTML=null,this.offset=5}onBeforeRender(e,t,n,r,a,i){if(super.onBeforeRender(),!this.elemHTML)return;const s=e.domElement.offsetWidth,c=e.domElement.offsetHeight,u=this.elemHTML.getBoundingClientRect(),h=e.domElement.getBoundingClientRect(),f=u.left-h.left,m=u.right-h.left,g=u.top-h.top,A=u.bottom-h.top,_=(f+m)/2,x=(g+A)/2,C=this.getWorldPosition(pie).project(n),b=(C.x+1)/2*s,y=(1-C.y)/2*c,M=(x-y)/(_-b),R=(u.height+2*this.offset)/(u.width+2*this.offset);let T,w;Math.abs(M)>R?(w=y>x?Math.min(A+this.offset,y):Math.max(g-this.offset,y),T=(w-y)/M+b):(T=b<_?Math.max(f-this.offset,b):Math.min(m+this.offset,b),w=(T-b)*M+y);const D=2*T/s-1,z=1-2*w/c,F=mie.set(D,z,-1);F.unproject(n),this.parent&&this.parent.worldToLocal(F);const O=F.length();this.scale.setScalar(O),F.normalize();const q=gie.setFromUnitVectors(ng,F);this.setRotationFromQuaternion(q),this.updateMatrixWorld()}}function vc(){}Object.assign(vc.prototype,{onUpdate:function(o){},onFinish:function(){}});class kP extends vc{constructor(e){super();for(let t in e){const n=e[t];t==="container"&&(n===void 0?this.container=document.body:n instanceof HTMLElement?this.container=n:this.container=document.getElementById(n))}this.bar=document.createElement("div"),this.bar.setAttribute("class","v3d-simple-preloader-bar"),this.logo=document.createElement("div"),this.logo.setAttribute("class","v3d-simple-preloader-logo"),this.logoCont=document.createElement("div"),this.logoCont.setAttribute("id","v3d_preloader_container"),this.logoCont.setAttribute("class","v3d-simple-preloader-container"),this.background=document.createElement("div"),this.background.setAttribute("class","v3d-simple-preloader-background"),this.background.appendChild(this.logoCont),this.logoCont.appendChild(this.logo),this.logoCont.appendChild(this.bar),this.container.appendChild(this.background),this.clock=new bi}onUpdate(e){super.onUpdate(e),e=Math.round(e),this.bar.style.width=e+"%"}onFinish(){super.onFinish(),this.container.removeChild(this.background)}}const _ie="puzzles.min.js";class Aie{_logicFileLoadError(e){const t=new Error(e);return t.name="LogicFileLoadError",t}_editorLoadError(e){const t=new Error(e);return t.name="EditorLoadError",t}async _getLogicPromise(e){var r,a,i;const t=Yh(),n=new URL(e,document.baseURI).href;try{const s=(a=(r=await import(n)).createPL)==null?void 0:a.call(r);return await((i=s==null?void 0:s.loadPhysics)==null?void 0:i.call(s)),s??t.v3d.PL??null}catch{throw this._logicFileLoadError(`Unable to load the logic file: '${n}'.`)}}_getEditorPromise(e,t){const n=this;return new Promise(function(r,a){eo.loadScript(e,document.body,function(){r()},function(){a(n._editorLoadError("Unable to load the Puzzles Editor: '"+e+"'."))})})}async _getLogicViaEditorPromise(e,t){const n=Yh();if(!n.v3d||!n.v3d.PE)throw this._editorLoadError("Unable to load Puzzles' logic. The Puzzles Editor isn't loaded.");const r=t.split(".");r[r.length-1]="xml";const a=r.join("."),{PL:i,logicXMLLoaded:s}=await n.v3d.PE.init(e,a);if(!s)throw this._logicFileLoadError(`Unable to load the Puzzles Editor's XML logic file: '${a}'.`);return i}_getAmmoJSPromise(){const e=document.getElementsByTagName("script");let t=!1;for(let n=e.length-1;n>=0;--n)if(e[n].src.search(/ammo.wasm.js/)>-1){t=!0;break}return new Promise(function(n,r){t&&window.Ammo?(console.warn("You have ammo.wasm.js assigned in app html, please remove it"),n()):t&&!window.Ammo?(console.warn("You have ammo.wasm.js assigned in app html, please remove it and resave Puzzles"),import(_v("ammo.wasm.js")).then(i=>{let s=i.default;s?new s().then(c=>{window.Ammo=c,n()}):r(new Error("Failed to load physics module"))})):n()})}async loadLogic(e,t,n){try{const r=await this._getLogicPromise(e);return await this._getAmmoJSPromise(),t&&t(),r}catch(r){console.error(r),n&&n(r)}}async loadEditorWithLogic(e,t,n,r){try{let a=null;await this._getEditorPromise(e+_ie);try{a=await this._getLogicViaEditorPromise(e,t)}catch(i){if(i.name!=="LogicFileLoadError")throw i}return await this._getAmmoJSPromise(),n&&n(),a}catch(a){console.error(a),r&&r(a)}}}function Ag(o){Mt.call(this),this.type="CubeTextureHelper",this.geometry=new up(2,2,2,1,1,1),this.geometry.computeBoundingSphere(),this.material=new hr,this.material.envMap=o}Ag.prototype=Object.create(Mt.prototype),Ag.prototype.constructor=Ag;class GP extends Tt{constructor(e){super(),this.isAnnotationControl=!0,this.doUpdate=!0,this.projected=new B,this.container=e,this.updatedCallback=null}clone(){return new this.constructor(this.container).copy(this)}update(e){if(this.doUpdate){var t=this.projected;this.getWorldPosition(t).project(e);var n=this.container.offsetWidth,r=this.container.offsetHeight,a=(.5+t.x/2)*n,i=(.5-t.y/2)*r;t.x=a,t.y=i;var s=t.z<=1&&a>=0&&a<=n&&i>=0&&i<=r;this.visible=s,this.updatedCallback&&this.updatedCallback(t.x,t.y,s)}}}var zx=new Cv,rg=new B,Vx=new B,sR=new B;class xie extends GP{constructor(e,t,n){super(e),this.isAnnotation=!0,this.type="Annotation",this.character=t,this.dialogContents=n,this.annotation=document.createElement("div"),this.annotation.innerHTML=t,this.annotation.className="v3d-annotation",this.container.appendChild(this.annotation),this.annotationDialogVisible=!1,this.annotationDialog=document.createElement("div"),this.annotationDialog.innerHTML=n,this.annotationDialog.className="v3d-annotation-dialog",this.annotation.appendChild(this.annotationDialog),this.fadeObscured=!0,this.obscured=!1;var r=!1,a=this;function i(s){s.target==a.annotation?a.annotationDialog.innerHTML.length==0||a.obscured||(a.annotationDialogVisible=!a.annotationDialogVisible,a.annotationDialog.style.visibility=a.annotationDialogVisible?"visible":"hidden",a.annotationDialogVisible?a.annotation.style.zIndex="2":a.annotation.style.zIndex="1"):s.target.className.indexOf("v3d-annotation")>-1&&(a.annotationDialogVisible=!1,a.annotationDialog.style.visibility="hidden",a.annotation.style.zIndex=a.obscured?"auto":"1")}this._touchstartCb=function(s){i(s),r=!0},document.body.addEventListener("touchstart",this._touchstartCb,!1),this._mousedownCb=function(s){r||i(s),r=!1},document.body.addEventListener("mousedown",this._mousedownCb,!1)}raycast(){}clone(){return new this.constructor(this.container,this.character,this.dialogContents).copy(this)}update(e){if(super.update(e),this.doUpdate){var t=this.projected,n=this.annotation;if(n.style.transform="translate("+t.x+"px, "+t.y+"px)",n.style.visibility=this.visible?"visible":"hidden",this.annotationDialog.style.visibility=this.visible&&this.annotationDialogVisible?"visible":"hidden",this.fadeObscured){e.getWorldPositionNU(rg),this.getWorldPositionNU(Vx),sR.copy(Vx).sub(rg).normalize(),zx.set(rg,sR),zx.far=rg.distanceTo(Vx);var r=zx.intersectObject(this.findRoot(),!0);r.length>1||r.length==1&&r[0].object!=this.parent?(n.classList.add("v3d-annotation-transparent"),this.obscured=!0,n.style.zIndex="auto",this.annotationDialog.style.visibility="hidden"):(n.classList.remove("v3d-annotation-transparent"),n.style.zIndex=this.annotationDialog.style.visibility=="visible"?"2":"1",this.obscured=!1)}}}setDialogVisibility(e){e?(this.annotationDialogVisible=!0,this.annotationDialog.style.visibility="visible",this.annotation.style.zIndex="2"):(this.annotationDialogVisible=!1,this.annotationDialog.style.visibility="hidden",this.annotation.style.zIndex="1")}dispose(){var e=this.annotation.parentElement;e&&e.removeChild(this.annotation),document.body.removeEventListener("touchstart",this._touchstartCb,!1),document.body.removeEventListener("mousedown",this._mousedownCb,!1)}}const lR=new B,og=new Ct,yie=new Ct;function bie(o,e,t){const n=o.parent;n&&!n.isScene&&(lR.copy(e).applyQuaternion(o.quaternion).applyQuaternion(n.quaternion),n.position.add(lR.multiplyScalar(t)))}function Sie(o,e,t){const n=o.parent;n&&!n.isScene&&(og.setFromAxisAngle(e,t),og.premultiply(o.quaternion),og.premultiply(n.quaternion),n.quaternion.multiplyQuaternions(og,yie.copy(o.quaternion).invert()))}var Cie=Object.freeze({__proto__:null,rotateVRCamera:Sie,translateVRCamera:bie}),Eie=`.v3d-container {
    
    overflow: hidden;
    z-index: 0;
}
.v3d-canvas {
    
    position: absolute;
    top: 0;
    bottom: 0;
    left: 0;
    right: 0;
    
    z-index: -1;
}
.v3d-simple-preloader-background {
    background-color: #fff;
    position: absolute;
    top: 0;
    bottom: 0;
    left: 0;
    right: 0;
    z-index: 1;
    height: 100%;
    width: 100%;
}
.v3d-simple-preloader-container {
    --v3d-preloader-img-width: 120px;
    --v3d-preloader-img-height: 120px;
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: calc(var(--v3d-preloader-img-width) + 60px);
    height: calc(var(--v3d-preloader-img-height) + 60px);
}
.v3d-simple-preloader-bar {
    background: linear-gradient(90deg, #1458ae, #4388e0);
    width: 0%;
    height: 3px;
    margin: 15px -1px;
    border: 1px solid;
    border-radius: 50px;
    border-color: #2b70c7;
}
.v3d-simple-preloader-logo {
    width: var(--v3d-preloader-img-width);
    height: var(--v3d-preloader-img-height);
    background-image: url('data:image/svg+xml,%3C%3Fxml version="1.0" encoding="UTF-8" standalone="no"%3F%3E%3Csvg width="120" height="120" viewBox="0 0 31.75 31.75" version="1.1" id="svg5409" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns="http://www.w3.org/2000/svg" xmlns:svg="http://www.w3.org/2000/svg" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns%23" xmlns:cc="http://creativecommons.org/ns%23" xmlns:dc="http://purl.org/dc/elements/1.1/"%3E%3Cdefs id="defs5403"%3E%3ClinearGradient xlink:href="%23linearGradient3077" id="linearGradient4375" gradientUnits="userSpaceOnUse" x1="172.91336" y1="78.689407" x2="193.7847" y2="53.806618" gradientTransform="matrix(1.1562901,0,0,1.1583991,-194.29093,208.80811)" /%3E%3ClinearGradient id="linearGradient3077"%3E%3Cstop style="stop-color:%230048a5;stop-opacity:1" offset="0" id="stop3073" /%3E%3Cstop style="stop-color:%234b86d1;stop-opacity:1" offset="1" id="stop3075" /%3E%3C/linearGradient%3E%3C/defs%3E%3Cmetadata id="metadata5406"%3E%3Crdf:RDF%3E%3Ccc:Work rdf:about=""%3E%3Cdc:format%3Eimage/svg+xml%3C/dc:format%3E%3Cdc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage" /%3E%3C/cc:Work%3E%3C/rdf:RDF%3E%3C/metadata%3E%3Cg id="layer1" transform="translate(0,-270.54167)"%3E%3Cpath style="display:inline;fill:url(%23linearGradient4375);fill-opacity:1;stroke:none;stroke-width:0.9171;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" d="m 15.945207,270.5417 c -1.669933,-0.007 -3.344811,1.1051 -7.2273169,3.32785 -7.76503612,4.4455 -7.2281318,3.52338 -7.2677439,12.48309 -0.03948,8.95973 -0.56829626,8.03286 7.1571159,12.5471 7.7254249,4.51422 6.6598479,4.50948 14.4248479,0.064 7.765036,-4.4455 7.228132,-3.52338 7.267744,-12.48309 0.03948,-8.95973 0.568296,-8.03287 -7.157116,-12.5471 -3.862718,-2.25711 -5.527635,-3.38445 -7.197531,-3.39185 z m -0.0132,2.85167 c 1.6836,0.007 3.363685,0.8128 6.115359,2.4207 5.503323,3.21577 6.107199,4.27438 6.078963,10.65695 -0.02832,6.3826 -0.641388,7.43578 -6.172923,10.60259 -5.531523,3.16682 -6.748576,3.16139 -12.2518993,-0.0544 -5.503299,-3.21578 -6.1071633,-4.27439 -6.0789633,-10.65697 0.02844,-6.38259 0.6413884,-7.43577 6.1729353,-10.6026 2.7657613,-1.5834 4.4529153,-2.37377 6.1365283,-2.3663 z m -0.154249,1.6177 c -2.694169,0.0343 -5.683359,3.07006 -7.236352,6.07548 -1.5776528,3.05311 -2.4803533,5.94456 -2.1086051,9.65753 0.1618801,1.61652 1.6983849,3.67982 3.5378539,4.71425 -0.3909602,-3.2062 -0.1707481,-6.34306 0.5400002,-8.94693 0.71076,-2.60387 2.83223,-6.82883 5.337159,-6.82316 2.504954,0.006 4.626375,4.22704 5.337123,6.83091 0.710725,2.60386 0.930961,5.74073 0.539989,8.94693 1.839481,-1.03442 3.375985,-3.09779 3.537853,-4.71432 0.371749,-3.71296 -0.53082,-6.60428 -2.108485,-9.6574 -1.547604,-2.99499 -4.52153,-6.01988 -7.24846,-6.08267 -0.0426,-9.5e-4 -0.08532,-10e-4 -0.128028,-6.2e-4 z m 0.131713,8.9184 a 2.4731483,2.4776591 0 0 0 -1.188637,0.29153 2.4731483,2.4776591 0 0 0 -1.017889,3.35228 2.4731483,2.4776591 0 0 0 3.34619,1.01974 2.4731483,2.4776591 0 0 0 1.017877,-3.35231 2.4731483,2.4776591 0 0 0 -2.157541,-1.31124 z" id="path4130" /%3E%3C/g%3E%3C/svg%3E');
    background-size: 100% 100%;
    background-repeat: no-repeat;
    margin: 20px auto;
}
.v3d-annotation {
    position: absolute;
    top: -0.7em;
    left: -0.5em;
    width: auto;
    min-width: 1em;
    height: 1.4em;
    padding: 0.3em 0.5em;
    border: 1px solid #fff;
    border-radius: 2em;
    font-size: 16px;
    font-family: sans-serif;
    line-height: 1.4em;
    color: #fff;
    text-align: center;
    user-select: none;
    background: rgba(0, 0, 0, 0.8);
}
.v3d-annotation-transparent {
    opacity: 0.5;
}
.v3d-annotation-dialog {
    position: absolute;
    top: 85%;
    left: 85%;
    font-family: sans-serif;
    user-select: none;
    padding: 1em;
    min-width: 200px;
    color: #fff;
    background: rgba(0, 0, 0, 0.8);
    border-radius: 1em;
    font-size: 12px;
    line-height: 1.2;
    transition: opacity .5s;
    visibility: hidden;
}
.v3d-mobile-forward {
    position: absolute;
    width: 62px;
    height: 62px;
    bottom: 31px;
    left: 50%;
    margin-left: -31px;
    background-image: url('data:image/svg+xml,%3C%3Fxml version="1.0" encoding="UTF-8" standalone="no"%3F%3E%3Csvg width="62" height="62" viewBox="0 0 16.404167 16.404167" version="1.1" id="svg2719" sodipodi:docname="move_forward.svg" inkscape:version="1.1.2 (b8e25be833, 2022-02-05)" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape" xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns="http://www.w3.org/2000/svg" xmlns:svg="http://www.w3.org/2000/svg" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns%23" xmlns:cc="http://creativecommons.org/ns%23" xmlns:dc="http://purl.org/dc/elements/1.1/"%3E%3Csodipodi:namedview id="namedview7548" pagecolor="%23505050" bordercolor="%23eeeeee" borderopacity="1" inkscape:pageshadow="0" inkscape:pageopacity="0" inkscape:pagecheckerboard="0" showgrid="false" inkscape:snap-global="false" inkscape:zoom="7.1451613" inkscape:cx="42.266366" inkscape:cy="15.814898" inkscape:window-width="1920" inkscape:window-height="1137" inkscape:window-x="-8" inkscape:window-y="-8" inkscape:window-maximized="1" inkscape:current-layer="svg2719" /%3E%3Cdefs id="defs2713"%3E%3ClinearGradient gradientTransform="translate(-524.2581,-935.78503)" xlink:href="%23linearGradient2768" id="linearGradient2673" x1="501.88306" y1="942.95502" x2="508.08038" y2="935.61182" gradientUnits="userSpaceOnUse" /%3E%3ClinearGradient id="linearGradient2768"%3E%3Cstop style="stop-color:%23414141;stop-opacity:1" offset="0" id="stop2764" /%3E%3Cstop style="stop-color:%23767676;stop-opacity:1" offset="1" id="stop2766" /%3E%3C/linearGradient%3E%3ClinearGradient gradientTransform="translate(-521.96226,-941.8579)" xlink:href="%23linearGradient2648" id="linearGradient2665" x1="495.62714" y1="948.00964" x2="508.85629" y2="934.78046" gradientUnits="userSpaceOnUse" /%3E%3ClinearGradient id="linearGradient2648"%3E%3Cstop style="stop-color:%23ebebeb;stop-opacity:1" offset="0" id="stop2644" /%3E%3Cstop style="stop-color:%23ffffff;stop-opacity:1" offset="1" id="stop2646" /%3E%3C/linearGradient%3E%3Cfilter style="color-interpolation-filters:sRGB" id="filter2688" x="-0.12" width="1.24" y="-0.12" height="1.24"%3E%3CfeGaussianBlur stdDeviation="0.66145835" id="feGaussianBlur2690" /%3E%3C/filter%3E%3ClinearGradient inkscape:collect="always" xlink:href="%23linearGradient2768" id="linearGradient7749" x1="6.0107598" y1="11.942085" x2="11.430239" y2="4.0917845" gradientUnits="userSpaceOnUse" /%3E%3ClinearGradient inkscape:collect="always" xlink:href="%23linearGradient2648" id="linearGradient8251" x1="4.2536402" y1="13.238126" x2="12.150527" y2="2.9068334" gradientUnits="userSpaceOnUse" /%3E%3Cfilter inkscape:collect="always" style="color-interpolation-filters:sRGB" id="filter8772" x="-0.10840111" y="-0.10840111" width="1.2168022" height="1.2168022"%3E%3CfeGaussianBlur inkscape:collect="always" stdDeviation="0.59752352" id="feGaussianBlur8774" /%3E%3C/filter%3E%3C/defs%3E%3Cmetadata id="metadata2716"%3E%3Crdf:RDF%3E%3Ccc:Work rdf:about=""%3E%3Cdc:format%3Eimage/svg+xml%3C/dc:format%3E%3Cdc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage" /%3E%3C/cc:Work%3E%3C/rdf:RDF%3E%3C/metadata%3E%3Ccircle style="fill:%23000000;stroke-width:0.230841;stroke-linecap:round;stroke-linejoin:round;fill-opacity:0.5;filter:url(%23filter8772)" id="circle8626" cx="8.2020836" cy="8.2020836" r="6.6145835" /%3E%3Ccircle style="fill:url(%23linearGradient8251);stroke-width:0.230841;stroke-linecap:round;stroke-linejoin:round;fill-opacity:1" id="path7652" cx="8.2020836" cy="8.2020836" r="6.6145835" /%3E%3Cpath d="m 4.2333333,6.7138018 c 0,0.9875367 0.4960933,2.4804692 0.4960933,2.4804692 h 1.984375 c 0,-0.7441408 0.2480473,-1.1782225 0.496094,-1.612305 0.2480467,-0.4340817 0.4960942,-0.8681642 0.4960942,-1.6123037 0,-0.8743657 -0.2480475,-2.7285166 -1.4882817,-2.7285166 -1.240234,0 -1.9843749,1.9843749 -1.9843748,3.4726561 z m 1.4882816,4.4648442 c 0.5472533,0 0.9921867,-0.444934 0.9921867,-0.992188 V 9.6903643 h -1.984375 v 0.4960937 c 0,0.547254 0.4449341,0.992188 0.9921883,0.992188 z M 12.170834,8.6981768 c 0,-1.4882808 -0.744141,-3.4726553 -1.984376,-3.4726553 -1.240234,0 -1.4882807,1.8541503 -1.4882807,2.7285153 0,0.74414 0.2480467,1.1782226 0.4960933,1.6123041 0.2480467,0.4340821 0.4960934,0.8681641 0.4960934,1.6123051 h 1.984376 c 0,0 0.496094,-1.4929325 0.496094,-2.4804692 z m -1.488281,4.4648442 c 0.547253,0 0.992187,-0.444935 0.992187,-0.992188 V 11.674739 H 9.690364 v 0.496094 c 0,0.547253 0.444935,0.992188 0.992189,0.992188 z" id="path7734" style="stroke-width:0.0155029;fill-opacity:1;fill:url(%23linearGradient7749)" /%3E%3C/svg%3E');
    touch-action: none;
    -webkit-user-select: none;
    user-select: none;
}
.v3d-webgl-error-container {
    position: absolute;
    top: 50%;
    left: 50%;
    margin-top: -80px;
    margin-left: -200px;
    width: 400px;
    height: 160px;
    text-align: center;
    z-index: 10;
}
.v3d-webgl-error-image {
    width: 160px;
    height: 160px;
    background-repeat: no-repeat;
    margin: 0px auto;
    background-image: url('data:image/svg+xml,%3C%3Fxml version="1.0" encoding="UTF-8" standalone="no"%3F%3E%3Csvg width="160" height="160" viewBox="0 0 42.333332 42.333333" version="1.1" id="svg1" inkscape:version="1.3 (0e150ed6c4, 2023-07-21)" sodipodi:docname="webgl-error.svg" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape" xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns="http://www.w3.org/2000/svg" xmlns:svg="http://www.w3.org/2000/svg"%3E%3Csodipodi:namedview id="namedview1" pagecolor="%23ffffff" bordercolor="%23eeeeee" borderopacity="1" inkscape:showpageshadow="false" inkscape:pageopacity="0" inkscape:pagecheckerboard="false" inkscape:deskcolor="%23d1d1d1" inkscape:document-units="px" labelstyle="default" shape-rendering="auto" inkscape:clip-to-page="false" inkscape:zoom="1.6017536" inkscape:cx="-5.3066837" inkscape:cy="78.97594" inkscape:window-width="1920" inkscape:window-height="1137" inkscape:window-x="-8" inkscape:window-y="-8" inkscape:window-maximized="1" inkscape:current-layer="layer1" /%3E%3Cdefs id="defs1"%3E%3Cfilter inkscape:collect="always" style="color-interpolation-filters:sRGB" id="filter1" x="-0.18167429" y="-0.16562716" width="1.3633486" height="1.3312543"%3E%3CfeGaussianBlur inkscape:collect="always" stdDeviation="2.1910722" id="feGaussianBlur1" /%3E%3C/filter%3E%3ClinearGradient inkscape:collect="always" xlink:href="%23linearGradient3259" id="linearGradient10" x1="863.9444" y1="1424.3892" x2="892.88947" y2="1424.3892" gradientUnits="userSpaceOnUse" /%3E%3ClinearGradient inkscape:collect="always" id="linearGradient3259"%3E%3Cstop style="stop-color:%23c90000;stop-opacity:1" offset="0" id="stop3255" /%3E%3Cstop style="stop-color:%23ff0a0a;stop-opacity:1" offset="1" id="stop3257" /%3E%3C/linearGradient%3E%3C/defs%3E%3Cg inkscape:label="Layer 1" inkscape:groupmode="layer" id="layer1"%3E%3Cg id="g2" style="display:inline" transform="translate(-857.25025,-1403.2226)"%3E%3Cpath id="path10" style="fill:%23e40505;fill-opacity:0.4;stroke-width:0.0581876;filter:url(%23filter1)" d="m 878.41691,1413.9426 c 1.49459,-0.033 2.34009,1.1428 2.29362,2.1957 l -0.39169,8.8754 c -0.0465,1.0529 -0.84799,1.9018 -1.90193,1.9018 -1.05394,0 -1.8516,-0.8491 -1.90193,-1.9018 l -0.42433,-8.8754 c -0.0503,-1.0527 0.83167,-2.163 2.32626,-2.1957 z m -0.18948,15.5145 c 1.4715,-0.1102 2.72596,1.0544 2.72522,2.53 0.0257,3.4066 -5.09721,3.4066 -5.07148,0 -6.7e-4,-1.3275 1.02252,-2.4308 2.34626,-2.53 z m 0.26002,-20.9425 c -1.67293,-0.01 -3.35083,1.1046 -7.24038,3.3274 -7.77912,4.4454 -7.24153,3.5234 -7.28121,12.483 -0.0397,8.9596 -0.56935,8.0329 7.17011,12.547 7.73941,4.5142 6.67221,4.5096 14.45131,0.064 7.77911,-4.4455 7.241,-3.5233 7.28069,-12.483 0.0397,-8.9596 0.56933,-8.0328 -7.1701,-12.547 -3.86972,-2.257 -5.53749,-3.384 -7.21042,-3.3915 z m -0.0134,2.8509 v 6e-4 c 1.68666,0.01 3.37009,0.8126 6.12676,2.4205 5.51329,3.2157 6.11834,4.2746 6.09006,10.6572 -0.0283,6.3825 -0.64255,7.4357 -6.18411,10.6025 -5.54155,3.1668 -6.76089,3.161 -12.27419,-0.055 -5.51329,-3.2158 -6.11831,-4.2742 -6.09007,-10.6567 0.0284,-6.3825 0.64255,-7.4357 6.18412,-10.6025 2.77079,-1.5834 4.46077,-2.3737 6.14743,-2.3663 z" sodipodi:nodetypes="zssssszsccssssssssssccsssssssc" /%3E%3Cpath id="path3" style="fill:url(%23linearGradient10);stroke-width:0.0581876" d="m 878.41691,1413.9426 c 1.49459,-0.033 2.34009,1.1428 2.29362,2.1957 l -0.39169,8.8754 c -0.0465,1.0529 -0.84799,1.9018 -1.90193,1.9018 -1.05394,0 -1.8516,-0.8491 -1.90193,-1.9018 l -0.42433,-8.8754 c -0.0503,-1.0527 0.83167,-2.163 2.32626,-2.1957 z m -0.18948,15.5145 c 1.4715,-0.1102 2.72596,1.0544 2.72522,2.53 0.0257,3.4066 -5.09721,3.4066 -5.07148,0 -6.7e-4,-1.3275 1.02252,-2.4308 2.34626,-2.53 z m 0.26002,-20.9425 c -1.67293,-0.01 -3.35083,1.1046 -7.24038,3.3274 -7.77912,4.4454 -7.24153,3.5234 -7.28121,12.483 -0.0397,8.9596 -0.56935,8.0329 7.17011,12.547 7.73941,4.5142 6.67221,4.5096 14.45131,0.064 7.77911,-4.4455 7.241,-3.5233 7.28069,-12.483 0.0397,-8.9596 0.56933,-8.0328 -7.1701,-12.547 -3.86972,-2.257 -5.53749,-3.384 -7.21042,-3.3915 z m -0.0134,2.8509 v 6e-4 c 1.68666,0.01 3.37009,0.8126 6.12676,2.4205 5.51329,3.2157 6.11834,4.2746 6.09006,10.6572 -0.0283,6.3825 -0.64255,7.4357 -6.18411,10.6025 -5.54155,3.1668 -6.76089,3.161 -12.27419,-0.055 -5.51329,-3.2158 -6.11831,-4.2742 -6.09007,-10.6567 0.0284,-6.3825 0.64255,-7.4357 6.18412,-10.6025 2.77079,-1.5834 4.46077,-2.3737 6.14743,-2.3663 z" sodipodi:nodetypes="zssssszsccssssssssssccsssssssc" /%3E%3C/g%3E%3C/g%3E%3C/svg%3E');
    background-size: 100% 100%;
}
.v3d-webgl-error {
    font-family: Arial;
    font-size: 16px;
}
.v3d-webgl-error-link {
    font-style: italic;
    font-weight: bolder;
}
.v3d-webgl-error-link {
    color: #015fb1;
}
.v3d-device-motion-permissions-dialog {
    z-index: 1;
    position: absolute;
    width: 100%;
    background-color: #f00;
    color: #000;
    text-align: center;
    padding: 10px;
}
`;if(typeof __V3D_DEVTOOLS__<"u"&&__V3D_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:"4.9.0"}})),typeof window<"u"&&(window.__V3D__?console.warn("WARNING: Multiple instances of Verge3D being imported."):window.__V3D__="4.9.0"),typeof document<"u"){const o=document.createElement("style");o.appendChild(document.createTextNode(Eie)),document.head.insertBefore(o,document.head.firstChild)}const Mie=Object.freeze(Object.defineProperty({__proto__:null,ACESFilmicToneMapping:YV,AVERAGE:Goe,AddEquation:RL,AddOperation:kV,AdditiveAnimationBlendMode:oG,AdditiveBlending:EV,AgXBlenderToneMapping:KV,AlphaFormat:bk,AlwaysDepth:BV,AlwaysStencilFunc:PG,AmbientLight:dB,AmbientLightProbe:Ate,AnimationClip:jg,AnimationLoader:aie,AnimationMixer:AB,AnimationObjectGroup:Ote,AnimationUtils:wte,Annotation:xie,AnnotationControl:GP,App:zP,AppUtils:eo,ArcCurve:ZJ,ArrayCamera:R5,ArrowHelper:nne,Audio:hB,AudioAnalyser:Cte,AudioContext:ib,AudioListener:fB,AudioLoader:dte,AxesHelper:rne,BackSide:xV,BasicDepthPacking:uG,BasicShadowMap:mV,BilinearShadowMap:gV,BlenderTextBufferGeometry:oie,BlenderTextGeometry:rie,BloomPass:pl,BokehPass:cb,Bone:B5,BooleanKeyframeTrack:hc,Box2:jte,Box3:mn,Box3Helper:L2,BoxGeometry:up,BoxHelper:ene,BrightnessContrastPass:ub,BufferAttribute:$e,BufferGeometry:mt,BufferGeometryLoader:iie,BufferGeometryUtils:ire,ByteType:fk,CENTER:koe,CSVParser:_g,Cache:Qa,Camera:dp,CameraHelper:Jte,CameraUtils:VP,CanvasBreakpointsConstraint:gP,CanvasFitConstraint:mP,CanvasTexture:D5,CapsuleGeometry:see,CatmullRomCurve3:KJ,ChildOfConstraint:tP,CineonToneMapping:WV,CircleGeometry:lee,ClampToEdgeWrapping:HL,ClearMaskPass:TB,Clock:bi,Color:Qe,ColorKeyframeTrack:sb,ColorManagement:Br,Compat:qB,CompressedArrayTexture:qJ,CompressedTexture:il,CompressedTextureLoader:cte,ConeGeometry:cee,Constraint:Bd,ConstraintSpaceCustom:cQ,ConstraintSpaceLocal:uQ,ConstraintSpaceWorld:lQ,ControlSettings:_b,CopyLocationConstraint:nP,CopyRotationConstraint:rP,CopyScaleConstraint:oP,CopyTransformsConstraint:aP,CubeCamera:kg,CubeCopy:ep,CubeReflectionMapping:nk,CubeReflectionProbe:bb,CubeRefractionMapping:rk,CubeTexture:yv,CubeTextureHelper:Ag,CubeTextureLoader:ute,CubeUVReflectionMapping:ik,CubicBezierCurve:O5,CubicBezierCurve3:aee,CubicInterpolant:pB,CullFaceBack:fV,CullFaceFront:hV,CullFaceFrontBack:pV,CullFaceNone:dV,Curve:Ha,CurvePath:V5,CustomBlending:TV,CustomToneMapping:jV,CylinderGeometry:Jy,Cylindrical:Yte,DampedTrackConstraint:iP,Data3DTexture:Gy,DataArrayTexture:xv,DataTexture:ss,DataTextureLoader:nB,DataUtils:ane,DecrementStencilOp:bG,DecrementWrapStencilOp:CG,DefaultLoadingManager:rb,DepthFormat:JL,DepthStencilFormat:Ek,DepthTexture:Hy,Detector:Wn,DirectionalLight:uB,DirectionalLightCSMHelper:$te,DirectionalLightHelper:CB,DiscreteInterpolant:nb,DodecahedronGeometry:uee,DoubleSide:yV,DstAlphaFactor:UL,DstColorFactor:VL,DynamicCopyUsage:kG,DynamicDrawUsage:DG,DynamicReadUsage:UG,ESMDistancePacking:pG,ESMShadowMap:_V,EdgesGeometry:dee,EffectComposer:G2,EllipseCurve:Zy,EqualDepth:DV,EqualStencilFunc:TG,EquirectangularReflectionMapping:ok,EquirectangularRefractionMapping:ak,Euler:ka,EventDispatcher:oo,ExtrudeGeometry:W5,FXAAPass:Xg,FileLoader:fa,FilmicBlenderToneMapping:ZV,FirstPersonControls:U2,FixOrthoZoomConstraint:pP,Float16BufferAttribute:GQ,Float32BufferAttribute:ut,Float64BufferAttribute:QQ,FloatType:vk,FloorConstraint:sP,FlyingControls:z2,Fog:jy,FogExp2:Yy,Font:eP,FramebufferTexture:XJ,FrontSide:AV,Frustum:hp,GLBufferAttribute:Wte,GLSL1:QG,GLSL3:v2,GLTFExporter:Nv,GLTFLoader:xP,GTAOMapGenerator:RP,GraphUtils:zee,GrayscalePass:db,GreaterDepth:FV,GreaterEqualDepth:OV,GreaterEqualStencilFunc:BG,GreaterStencilFunc:IG,GridHelper:Zte,Group:Da,HalfFloatType:_k,HemisphereLight:hte,HemisphereLightHelper:qte,HemisphereLightProbe:pte,IBLEnvironmentNone:eQ,IBLEnvironmentPMREM:$G,IBLEnvironmentProbe:JG,IcosahedronGeometry:Iee,ImageBitmapLoader:rB,ImageLoader:ob,ImageUtils:_5,IncrementStencilOp:yG,IncrementWrapStencilOp:SG,InstancedBufferAttribute:S2,InstancedBufferGeometry:Qte,InstancedInterleavedBuffer:Hte,InstancedMesh:YJ,Int16BufferAttribute:VQ,Int32BufferAttribute:kQ,Int8BufferAttribute:FQ,IntType:mk,InterleavedBuffer:mp,InterleavedBufferAttribute:Lc,Interpolant:Ld,InterpolateDiscrete:Kk,InterpolateLinear:$k,InterpolateSmooth:Jk,InvertStencilOp:EG,KeepStencilOp:AG,KeyframeTrack:hi,Keys:Je,LOD:GJ,LatheGeometry:k5,Layers:Rd,LessDepth:PV,LessEqualDepth:NV,LessEqualStencilFunc:RG,LessStencilFunc:wG,Light:Al,LightProbe:Kh,LightProbeGenerator:IP,LimitDistanceConstraint:lP,LimitLocationConstraint:cP,LimitRotationConstraint:uP,LimitScaleConstraint:dP,Line:vi,Line3:ri,LineBasicMaterial:gr,LineCurve:$y,LineCurve3:iee,LineDashedMaterial:Uee,LineHTML:vie,LineLoop:P5,LineSegments:jo,LinearDepthPacking:fG,LinearEncoding:lG,LinearFilter:qL,LinearInterpolant:Lv,LinearMipMapLinearFilter:uk,LinearMipMapNearestFilter:ck,LinearMipmapLinearFilter:KL,LinearMipmapNearestFilter:ZL,LinearSRGBColorSpace:g2,LinearToneMapping:QV,Loader:ma,LoaderUtils:fi,LoadingManager:tB,LockedTrackConstraint:fP,LogarithmicMaxToneMapping:XV,LoopOnce:Xk,LoopPingPong:Zk,LoopRepeat:qk,LuminanceAlphaFormat:Ck,LuminanceFormat:Sk,MOD_SUITE:WG,MOUSE:xc,MaskPass:fb,Material:Er,MaterialLoader:sie,MaterialUtils:cre,MathUtils:bQ,Matrix3:Qr,Matrix4:Ve,MaxEquation:IV,Mesh:Mt,MeshBVH:Fv,MeshBasicMaterial:hr,MeshDepthMaterial:Ad,MeshDistanceMaterial:w5,MeshLambertMaterial:Iv,MeshLine:xd,MeshLineIndexed:RB,MeshLineMaterial:tb,MeshMaskMaterial:Z5,MeshMatcapMaterial:die,MeshNodeMaterial:Ba,MeshNormalMaterial:q5,MeshPhongMaterial:cie,MeshPhysicalMaterial:w2,MeshStandardMaterial:Rv,MeshToonMaterial:uie,MinEquation:RV,MirroredRepeatWrapping:WL,MixOperation:VV,MotionPathConstraint:_P,MultiplyBlending:wV,MultiplyOperation:zV,NearestFilter:YL,NearestMipMapLinearFilter:lk,NearestMipMapNearestFilter:sk,NearestMipmapLinearFilter:XL,NearestMipmapNearestFilter:jL,NeverDepth:LV,NeverStencilFunc:MG,NoBlending:SV,NoColorSpace:vG,NoOIT:iQ,NoToneMapping:GV,NormalAnimationBlendMode:rG,NormalBlending:CV,NotEqualDepth:UV,NotEqualStencilFunc:LG,NumberKeyframeTrack:Sc,OITWeighted:sQ,Object3D:Tt,ObjectLoader:lie,ObjectSpaceNormalMap:gG,OctahedronGeometry:Y5,OneFactor:PL,OneMinusDstAlphaFactor:zL,OneMinusDstColorFactor:kL,OneMinusSrcAlphaFactor:FL,OneMinusSrcColorFactor:DL,OrbitControls:F2,OrthographicCamera:yi,OutlinePass:ii,PCFShadowMap:vV,PCFShadowMapPoissonDisk:hie,PCFSoftShadowMap:fie,PMREMGenerator:jh,Pass:pa,Path:Mv,PbrNeutralToneMapping:$V,PerspectiveCamera:ir,PhysicalMaxToneMapping:qV,Plane:_o,PlaneGeometry:ps,PlaneHelper:tne,PointLight:iB,PointLightHelper:SB,Points:N5,PointsMaterial:qy,PolarGridHelper:Kte,PolyhedronGeometry:gp,PositionalAudio:Ste,Preloader:vc,PropertyBinding:Ht,PropertyMixer:_B,PuzzlesLoader:Aie,QuadraticBezierCurve:F5,QuadraticBezierCurve3:U5,Quaternion:Ct,QuaternionKeyframeTrack:bc,QuaternionLinearInterpolant:vB,REVISION:cV,RGBADepthPacking:dG,RGBADistancePacking:hG,RGBAFormat:$L,RGBAIntegerFormat:Ik,RGBA_ASTC_10x10_Format:Wk,RGBA_ASTC_10x5_Format:Gk,RGBA_ASTC_10x6_Format:Qk,RGBA_ASTC_10x8_Format:Hk,RGBA_ASTC_12x10_Format:Yk,RGBA_ASTC_12x12_Format:jk,RGBA_ASTC_4x4_Format:s5,RGBA_ASTC_5x4_Format:Dk,RGBA_ASTC_5x5_Format:Ok,RGBA_ASTC_6x5_Format:Fk,RGBA_ASTC_6x6_Format:Uk,RGBA_ASTC_8x5_Format:zk,RGBA_ASTC_8x6_Format:Vk,RGBA_ASTC_8x8_Format:kk,RGBA_BPTC_Format:l5,RGBA_ETC2_EAC_Format:i5,RGBA_PVRTC_2BPPV1_Format:Nk,RGBA_PVRTC_4BPPV1_Format:r5,RGBA_S3TC_DXT1_Format:Lk,RGBA_S3TC_DXT3_Format:Bk,RGBA_S3TC_DXT5_Format:t5,RGBELoader:Q2,RGB_ETC1_Format:o5,RGB_ETC2_Format:a5,RGB_PVRTC_2BPPV1_Format:Pk,RGB_PVRTC_4BPPV1_Format:n5,RGB_S3TC_DXT1_Format:e5,RGFormat:Tk,RGIntegerFormat:Rk,RawShaderMaterial:pp,Ray:Td,Raycaster:Cv,RectAreaLight:sB,RectAreaLightUniformsLib:JB,RedFormat:Mk,RedIntegerFormat:wk,ReflectionProbeTypeBox:aQ,ReflectionProbeTypeInfinite:rQ,ReflectionProbeTypeSphere:oQ,ReinhardToneMapping:HV,RenderPass:qg,RenderUtils:Sre,RepeatWrapping:QL,ReplaceStencilOp:xG,ReverseSubtractEquation:LL,RingGeometry:Lee,SAH:Qoe,SRGBColorSpace:m2,SSAARenderPass:Jh,SSAOPass:nie,Scene:Hr,SceneBackground:Qe,SceneUtils:_re,ShaderChunk:Ye,ShaderLib:xt,ShaderMaterial:An,ShaderPass:ms,ShadowMaterial:Fee,Shape:sd,ShapeGeometry:Bee,ShapePath:EB,ShapeUtils:di,ShortType:hk,SimplePreloader:kP,Skeleton:Ev,SkeletonHelper:yB,SkinnedMesh:Hg,Source:Av,Sphere:Yo,SphereGeometry:j5,Spherical:_i,SphericalHarmonics3:Ju,SplineCurve:z5,SpotLight:oB,SpotLightHelper:xB,Sprite:L5,SpriteMaterial:Xy,SrcAlphaFactor:OL,SrcAlphaSaturateFactor:GL,SrcColorFactor:NL,StaticCopyUsage:VG,StaticDrawUsage:NG,StaticReadUsage:FG,Stats:ld,StereoCamera:xte,StreamCopyUsage:GG,StreamDrawUsage:OG,StreamReadUsage:zG,StringKeyframeTrack:fc,SubtractEquation:IL,SubtractiveBlending:MV,TOUCH:uV,TTFLoader:$B,TangentSpaceNormalMap:mG,TargetConstraint:ao,TeapotGeometry:Oee,TetrahedronGeometry:Pee,TextGeometry:Tv,Texture:In,TextureLoader:ab,ToneMapPass:hb,ToneMappingLookAgXPunchy:ek,ToneMappingLookNone:JV,TorusGeometry:Nee,TorusKnotGeometry:eb,TrackToConstraint:hP,TransformationConstraint:AP,Triangle:Cr,TriangleFanDrawMode:sG,TriangleStripDrawMode:iG,TrianglesDrawMode:aG,TubeGeometry:Dee,TweenCameraController:Dv,TweenLinear:tQ,TweenSpherical:nQ,TwoPassDoubleSide:bV,USDZExporter:zB,UVMapping:tk,Uint16BufferAttribute:A5,Uint32BufferAttribute:x5,Uint8BufferAttribute:UQ,Uint8ClampedBufferAttribute:zQ,Uniform:Pv,UniformsGroup:Gte,UniformsLib:Ze,UniformsUtils:no,UnsignedByteType:dk,UnsignedInt248Type:yk,UnsignedIntType:gk,UnsignedShort4444Type:Ak,UnsignedShort5551Type:xk,UnsignedShortType:pk,V3DL:zg,Vector2:Ee,Vector3:B,Vector4:ct,VectorKeyframeTrack:$h,VideoTexture:jJ,ViewportFitAuto:qG,ViewportFitFill:ZG,ViewportFitHorizontal:XG,ViewportFitNone:YG,ViewportFitOverscan:KG,ViewportFitVertical:jG,WebGL3DRenderTarget:RQ,WebGLArrayRenderTarget:TQ,WebGLCubeRenderTarget:fp,WebGLMultipleRenderTargets:A2,WebGLRenderTarget:qt,WebGLRenderer:Wy,WebGLUtils:T5,WebXRUtils:Cie,WireframeGeometry:X5,WrapAroundEnding:nG,XZ:KB,XZLoader:tp,ZeroCurvatureEnding:eG,ZeroFactor:BL,ZeroSlopeEnding:tG,ZeroStencilOp:_G,_SRGBAFormat:HG,acceleratedRaycast:OP,arrayMax:d5,arrayMin:SQ,clampArray:h5,computeBoundsTree:FP,disposeBoundsTree:UP,engineVersionCmp:m5,findModulePath:_v,getGlobalScope:Yh,isDef:_e,loadModule:g5,sRGBEncoding:cG,shaderFloatStr:al},Symbol.toStringTag,{value:"Module"}));function wie(o=window.v3d){const e={output:{initOptions:{fadeAnnotations:!0,useBkgTransp:!1,preserveDrawBuf:!1,useCompAssets:!1,useFullscreen:!0,useCustomPreloader:!1,preloaderStartCb:function(){},preloaderProgressCb:function(){},preloaderEndCb:function(){}}}};var t={};t.objCache={},t.fadeAnnotations=!0,t.pickedObject="",t.hoveredObject="",t.mediaElements={},t.loadedFile="",t.states=[],t.percentage=0,t.openedFile="",t.openedFileMeta={},t.xrSessionAcquired=!1,t.xrSessionCallbacks=[],t.screenCoords=new o.Vector2,t.intervalTimers={},t.customEvents=new o.EventDispatcher,t.eventListeners=[],t.htmlElements=new Set,t.materialsCache=new Map,t.AXIS_X=new o.Vector3(1,0,0),t.AXIS_Y=new o.Vector3(0,1,0),t.AXIS_Z=new o.Vector3(0,0,1),t.MIN_DRAG_SCALE=.001,t.SET_OBJ_ROT_EPS=1e-8,t.vec2Tmp=new o.Vector2,t.vec2Tmp2=new o.Vector2,t.vec3Tmp=new o.Vector3,t.vec3Tmp2=new o.Vector3,t.vec3Tmp3=new o.Vector3,t.vec3Tmp4=new o.Vector3,t.eulerTmp=new o.Euler,t.eulerTmp2=new o.Euler,t.quatTmp=new o.Quaternion,t.quatTmp2=new o.Quaternion,t.colorTmp=new o.Color,t.mat4Tmp=new o.Matrix4,t.planeTmp=new o.Plane,t.raycasterTmp=new o.Raycaster;const n=({v3d:a=null,appInstance:i=null})=>{function s(T,w=!1){let D;if(Array.isArray(T)&&T[0]==="CONTAINER"){if(i!==null)D=i.container;else if(typeof e<"u"){const z=e.container;D=w?parent.document.getElementById(z):document.getElementById(z)}}else Array.isArray(T)&&T[0]==="WINDOW"?D=w?parent:window:Array.isArray(T)&&T[0]==="DOCUMENT"?D=w?parent.document:document:Array.isArray(T)&&T[0]==="BODY"?D=w?parent.document.body:document.body:Array.isArray(T)&&T[0]==="QUERYSELECTOR"?D=w?parent.document.querySelector(T):document.querySelector(T):D=w?parent.document.getElementById(T):document.getElementById(T);return D}function c(T,w,D,z,F,O,q,ne){const $=!!(z instanceof Object?z.capture:z),he=!!(ne instanceof Object?ne.capture:ne);return T===F&&w===O&&D===q&&$===he}function u(T,w,D,z){t.eventListeners.some(O=>c(O.target,O.type,O.listener,O.optionsOrUseCapture,T,w,D,z))||(T.addEventListener(w,D,z),t.eventListeners.push({target:T,type:w,listener:D,optionsOrUseCapture:z}))}function h(T){return T&&"animFrameRate"in T.userData?T.userData.animFrameRate:24}function f(T){const w=T.getRoot();let D=w.type==="Scene"?w:null;return w.traverseAncestors(z=>{z.type==="Scene"&&(D=z)}),D}function m(T){return T.isMesh&&T.isMaterialGeneratedMesh&&T.parent?T.parent.name:T.name}function g(T,w,D=!1,z=null){const F=i.renderer.domElement;if(u(F,w,q),w==="mousedown")u(F,D?"touchstart":"touchend",q);else if(w==="dblclick"){let $=function(K){const ie=new Date().getTime()-ne;if(ie<600&&ie>0){q(K),ne=0;return}ne=new Date().getTime()},ne=0;u(F,D?"touchstart":"touchend",$)}const O=new a.Raycaster;function q(ne){if(!i.getCamera())return;ne.preventDefault();let $=0,he=0;if(ne instanceof MouseEvent){if(z!==null&&z.indexOf(ne.button)===-1)return;$=ne.offsetX/F.clientWidth,he=ne.offsetY/F.clientHeight}else if(ne instanceof TouchEvent){const ie=F.getBoundingClientRect();$=(ne.changedTouches[0].clientX-ie.left)/ie.width,he=(ne.changedTouches[0].clientY-ie.top)/ie.height}t.screenCoords.x=$*2-1,t.screenCoords.y=-he*2+1,O.setFromCamera(t.screenCoords,i.getCamera(!0));const K=[];i.scene.traverse(ie=>K.push(ie));const oe=O.intersectObjects(K,!1);T(oe,ne)}}function A(T){return T.type!=="AmbientLight"&&T.name!==""&&!(T.isMesh&&T.isMaterialGeneratedMesh)&&!T.isAuxClippingMesh}function _(T){let w=null;const D=t!==void 0;return D&&T in t.objCache&&(w=t.objCache[T]||null),w&&w.name===T||i.scene&&i.scene.traverse(z=>{!w&&A(z)&&z.name===T&&(w=z,D&&(t.objCache[T]=w))}),w}function x(T,w){if(!T)return!1;for(let D=0;D<w.length;D++){if(T===w[D])return!0;{const z=_(w[D]);if(z&&z.type==="Group"){for(let F=0;F<z.children.length;F++)if(T===z.children[F].name)return!0}}}return!1}function C(T){const w=[];return i.scene.traverse(D=>{if(A(D)){const z=D.groupNames;if(!z)return;for(let F=0;F<z.length;F++)z[F]===T&&w.push(D.name)}}),w}function b(){const T=[];return i.scene.traverse(w=>{A(w)&&T.push(w.name)}),T}function y(T,w){if(typeof T=="string")w.push(T);else if(Array.isArray(T)&&T[0]==="GROUP"){const D=C(T[1]);for(let z=0;z<D.length;z++)w.push(D[z])}else if(Array.isArray(T)&&T[0]==="ALL_OBJECTS"){const D=b();for(let z=0;z<D.length;z++)w.push(D[z])}else if(Array.isArray(T))for(let D=0;D<T.length;D++)y(T[D],w)}function M(T){const w=[];return y(T,w),w.filter(D=>D!=="")}function R(T){const w=a.SceneUtils.getMaterialByName(i,T);return w?w.isMeshNodeMaterial?Object.keys(w.nodeRGBMap):w.isMeshStandardMaterial?["color","emissive"]:[]:[]}return{getElement:s,bindListener:u,getSceneAnimFrameRate:h,getSceneByAction:f,getObjectName:m,initObjectPicking:g,isObjectAmongObjects:x,retrieveObjectNames:M,getMaterialEditableColors:R}};var r={};return o[Symbol.toStringTag]!=="Module"&&(o.PL=o.puzzles=r),r.procedures=r.procedures||{},r.execInitPuzzles=function(a){return e.container=a!==void 0&&"container"in a?a.container:"",e.output},r.init=function(a,i){const s=n({v3d:o,appInstance:a});i=i||{},"fadeAnnotations"in i&&(t.fadeAnnotations=i.fadeAnnotations),this.procedures.colors=C;var c;function u(b,y,M){var R=s.getElement(y,M);return R?R[b]:""}t.animMixerCallbacks=[];var h=function(){function b(y){for(var M=t.animMixerCallbacks,R=[],T=0;T<M.length;T++)M[T][0]==y.action&&(M[T][0]=null,R.push(M[T][1]));for(var T=0;T<R.length;T++)R[T]()}return function(){a.mixer&&!a.mixer.hasEventListener("finished",b)&&s.bindListener(a.mixer,"finished",b)}}();function f(b,y,M,R,T,w,D,z){if(!y)return;typeof y=="string"&&(y=[y]);function F(ne){var $=o.SceneUtils.getAnimationActionByName(a,ne);if($)switch(b){case"PLAY":if(!$.isRunning()){$.reset(),T&&T!="AUTO"&&($.loop=o[T]);var ie=s.getSceneByAction($),L=s.getSceneAnimFrameRate(ie);$.repetitions=1/0;var U=Math.abs(parseFloat(w));$.timeScale=U,$.timeStart=M!==null?M/L:0,$.getClip().resetDuration(),$.time=U>=0?$.timeStart:$.getClip().duration,$.paused=!1,$.play();for(var oe=t.animMixerCallbacks,he=!1,K=0;K<oe.length;K++)oe[K][0]==$&&oe[K][1]==D&&(he=!0);he||t.animMixerCallbacks.push([$,D])}break;case"STOP":$.stop();for(var oe=t.animMixerCallbacks,K=0;K<oe.length;K++)oe[K][0]==$&&(oe.splice(K,1),K--);break;case"PAUSE":$.paused=!0;break;case"RESUME":$.paused=!1;break;case"SET_FRAME":var ie=s.getSceneByAction($),L=s.getSceneAnimFrameRate(ie);$.time=M?M/L:0,$.play(),$.paused=!0;break;case"SET_SPEED":var U=parseFloat(w);$.timeScale=U;break}}for(var O=0;O<y.length;O++){var q=y[O];q&&F(q)}h()}function m(b,y,M,R,T,w){t.objClickInfo=t.objClickInfo||[],t.objClickInfo.push({objSelector:b,callbacks:[T,w]}),s.initObjectPicking(function(D,z){for(var F=!1,O=Math.min(1,D.length),q=0;q<O;q++){var ne=D[q].object,$=s.getObjectName(ne),he=s.retrieveObjectNames(b);s.isObjectAmongObjects($,he)&&(t.pickedObject=$,F=!0,T(z))}F||(t.pickedObject="",w(z))},"mousedown",!1,R)}function g(b,y,M,R,T,w){var D=s.getMaterialEditableColors(b);if(!(D.indexOf(y)<0)){if(w){var z=new o.Color(w);M=z.r,R=z.g,T=z.b}for(var F=o.SceneUtils.getMaterialsByName(a,b),O=0;O<F.length;O++){var q=F[O];if(q.isMeshNodeMaterial){var ne=q.nodeRGBMap[y];q.nodeRGB[ne].x=M,q.nodeRGB[ne].y=R,q.nodeRGB[ne].z=T}else q[y].r=M,q[y].g=R,q[y].b=T;q.needsUpdate=!0,a.scene!==null&&q===a.scene.worldMaterial&&a.updateEnvironment(q)}}}function A(b,y){if(y){const M=function(R){y(...R.params)};M.innerCallback=y,s.bindListener(t.customEvents,b,M)}else console.warn("add event listener puzzle: invalid input params")}function _(b,y){t.customEvents.dispatchEvent({type:b,params:y})}function x(b){typeof b=="function"&&(a.renderCallbacks.push(b),r.editorRenderCallbacks&&r.editorRenderCallbacks.push([a,b]))}function C(){c=u("value","backlight-changer",!1),g("tab_color","RGB.001",0,0,0,c),g("caps_color","RGB.001",0,0,0,c),g("-_color","RGB.001",0,0,0,c),g("num_enter_color","RGB.001",0,0,0,c),g("/_color","RGB.001",0,0,0,c),g("L_color","RGB.001",0,0,0,c),g("M_color","RGB.001",0,0,0,c),g("num2_color","RGB.001",0,0,0,c),g("left_win_color","RGB.001",0,0,0,c),g("num5_color","RGB.001",0,0,0,c),g("left_ctrl_color","RGB.001",0,0,0,c),g("num6_color","RGB.001",0,0,0,c),g("num_slash_color","RGB.001",0,0,0,c),g("W_color","RGB.001",0,0,0,c),g("S_color","RGB.001",0,0,0,c),g("U_color","RGB.001",0,0,0,c),g("right_arrow_color","RGB.001",0,0,0,c),g("pgup_color","RGB.001",0,0,0,c),g("print_screen_color","RGB.001",0,0,0,c),g("scroll_lock_color","RGB.001",0,0,0,c),g("T_color","RGB.001",0,0,0,c),g("O_color","RGB.001",0,0,0,c),g("up_arrow_color","RGB.001",0,0,0,c),g("tab_color","RGB.001",0,0,0,c),g("right_shift_color","RGB.001",0,0,0,c),g("num_zero_color","RGB.001",0,0,0,c),g("R_color","RGB.001",0,0,0,c),g("pause_break_color","RGB.001",0,0,0,c),g("num_plus_color","RGB.001",0,0,0,c),g("Z_color","RGB.001",0,0,0,c),g("options_color","RGB.001",0,0,0,c),g("pdgn_color","RGB.001",0,0,0,c),g("X_color","RGB.001",0,0,0,c),g("right_ctrl_color","RGB.001",0,0,0,c),g("Y_color","RGB.001",0,0,0,c),g("V_color","RGB.001",0,0,0,c),g("N_color","RGB.001",0,0,0,c),g("~_color","RGB.001",0,0,0,c),g("{_color","RGB.001",0,0,0,c),g("Q_color","RGB.001",0,0,0,c),g("P_inside_color","RGB.001",0,0,0,c),g("}_color","RGB.001",0,0,0,c),g("num1_color","RGB.001",0,0,0,c),g("num8_color","RGB.001",0,0,0,c),g("num9_color","RGB.001",0,0,0,c),g("left_shift_color","RGB.001",0,0,0,c),g("num3_color","RGB.001",0,0,0,c),g("num_multiply_color","RGB.001",0,0,0,c),g("num_minus_color","RGB.001",0,0,0,c),g("num7_color","RGB.001",0,0,0,c),g("num_dot_color","RGB.001",0,0,0,c),g("num_lock_color","RGB.001",0,0,0,c),g("num4_color","RGB.001",0,0,0,c),g("7_color","RGB.001",0,0,0,c),g("F5_color","RGB.001",0,0,0,c),g("del_color","RGB.001",0,0,0,c),g("<_color","RGB.001",0,0,0,c),g("backspace_color","RGB.001",0,0,0,c),g("backslash_color","RGB.001",0,0,0,c),g("caps_color","RGB.001",0,0,0,c),g("3_color","RGB.001",0,0,0,c),g(">_color","RGB.001",0,0,0,c),g("F10_color","RGB.001",0,0,0,c),g("F4_color","RGB.001",0,0,0,c),g("6_color","RGB.001",0,0,0,c),g("end_color","RGB.001",0,0,0,c),g("F3_color","RGB.001",0,0,0,c),g("A_color","RGB.001",0,0,0,c),g("8_color","RGB.001",0,0,0,c),g("=_color","RGB.001",0,0,0,c),g("F6_color","RGB.001",0,0,0,c),g("enter_color","RGB.001",0,0,0,c),g("F9_color","RGB.001",0,0,0,c),g("9_color","RGB.001",0,0,0,c),g("F2_color","RGB.001",0,0,0,c),g("F7_color","RGB.001",0,0,0,c),g("C_color","RGB.001",0,0,0,c),g("B_color","RGB.001",0,0,0,c),g("F8_color","RGB.001",0,0,0,c),g("F12_color","RGB.001",0,0,0,c),g("G_color","RGB.001",0,0,0,c),g("ins_color","RGB.001",0,0,0,c),g("4_color","RGB.001",0,0,0,c),g("D_color","RGB.001",0,0,0,c),g("H_color","RGB.001",0,0,0,c),g("home_color","RGB.001",0,0,0,c),g("5_color","RGB.001",0,0,0,c),g("down_arrow_color","RGB.001",0,0,0,c),g("E_color","RGB.001",0,0,0,c),g("esc_color","RGB.001",0,0,0,c),g("F_color","RGB.001",0,0,0,c),g("I_color","RGB.001",0,0,0,c),g("F11_color","RGB.001",0,0,0,c),g("apostrof_color","RGB.001",0,0,0,c),g(";_color","RGB.001",0,0,0,c),g("0_color","RGB.001",0,0,0,c),g("1_color","RGB.001",0,0,0,c),g("2_color","RGB.001",0,0,0,c),g("K_color","RGB.001",0,0,0,c),g("FN_color","RGB.001",0,0,0,c),g("left_arrow_color","RGB.001",0,0,0,c),g("left_alt_color","RGB.001",0,0,0,c),g("F1_color","RGB.001",0,0,0,c),g("J_color","RGB.001",0,0,0,c)}m("num_slash_material",!1,!1,[0,1,2],function(){f("PLAY","num_slash_material",null,null,"LoopOnce",1,function(){})},function(){}),m("num_multiply_material",!1,!1,[0,1,2],function(){f("PLAY","num_multiply_material",null,null,"LoopOnce",1,function(){})},function(){}),m("num_plus_material",!1,!1,[0,1,2],function(){f("PLAY","num_plus_material",null,null,"LoopOnce",1,function(){})},function(){}),m("tab_material",!1,!1,[0,1,2],function(){f("PLAY","tab_material",null,null,"LoopOnce",1,function(){})},function(){}),m("S_material",!1,!1,[0,1,2],function(){f("PLAY","S_material",null,null,"LoopOnce",1,function(){})},function(){}),m("right_shift_material",!1,!1,[0,1,2],function(){f("PLAY","right_shift_material",null,null,"LoopOnce",1,function(){})},function(){}),m("right_arrow_material",!1,!1,[0,1,2],function(){f("PLAY","right_arrow_material",null,null,"LoopOnce",1,function(){})},function(){}),m("space_material",!1,!1,[0,1,2],function(){console.log("Clicked SPACE"),f("PLAY","space_material",null,null,"LoopOnce",1,function(){})},function(){}),m("scroll_lock_material",!1,!1,[0,1,2],function(){f("PLAY","scroll_lock_material",null,null,"LoopOnce",1,function(){})},function(){}),m("right_alt_material",!1,!1,[0,1,2],function(){f("PLAY","right_alt_material",null,null,"LoopOnce",1,function(){})},function(){}),m("R_material",!1,!1,[0,1,2],function(){f("PLAY","R_material",null,null,"LoopOnce",1,function(){})},function(){}),m("right_ctrl_material",!1,!1,[0,1,2],function(){f("PLAY","right_ctrl_material",null,null,"LoopOnce",1,function(){})},function(){}),m("~_material",!1,!1,[0,1,2],function(){f("PLAY","~_material",null,null,"LoopOnce",1,function(){})},function(){}),m("}_material",!1,!1,[0,1,2],function(){f("PLAY","}_material",null,null,"LoopOnce",1,function(){})},function(){}),m("{_material",!1,!1,[0,1,2],function(){f("PLAY","{_material",null,null,"LoopOnce",1,function(){})},function(){}),m("Z_material",!1,!1,[0,1,2],function(){f("PLAY","Z_material",null,null,"LoopOnce",1,function(){})},function(){}),m("Y_material",!1,!1,[0,1,2],function(){f("PLAY","Y_material",null,null,"LoopOnce",1,function(){})},function(){}),m("up_arrow_material",!1,!1,[0,1,2],function(){f("PLAY","up_arrow_material",null,null,"LoopOnce",1,function(){})},function(){}),m("W_material",!1,!1,[0,1,2],function(){f("PLAY","W_material",null,null,"LoopOnce",1,function(){})},function(){}),m("X_material",!1,!1,[0,1,2],function(){f("PLAY","X_material",null,null,"LoopOnce",1,function(){})},function(){}),m("T_material",!1,!1,[0,1,2],function(){f("PLAY","T_material",null,null,"LoopOnce",1,function(){})},function(){}),m("C_material",!1,!1,[0,1,2],function(){f("PLAY","C_material",null,null,"LoopOnce",1,function(){})},function(){}),m("left_ctrl_material",!1,!1,[0,1,2],function(){f("PLAY","left_ctrl_material",null,null,"LoopOnce",1,function(){})},function(){}),m("=_material",!1,!1,[0,1,2],function(){f("PLAY","=_material",null,null,"LoopOnce",1,function(){})},function(){}),m("left_alt_material",!1,!1,[0,1,2],function(){f("PLAY","left_alt_material",null,null,"LoopOnce",1,function(){})},function(){}),m("num_minus_material",!1,!1,[0,1,2],function(){f("PLAY","num_minus_material",null,null,"LoopOnce",1,function(){})},function(){}),m("num_lock_material",!1,!1,[0,1,2],function(){f("PLAY","num_lock_material",null,null,"LoopOnce",1,function(){})},function(){}),m("num_enter_material",!1,!1,[0,1,2],function(){f("PLAY","num_enter_material",null,null,"LoopOnce",1,function(){})},function(){}),m("num7_material",!1,!1,[0,1,2],function(){f("PLAY","num7_material",null,null,"LoopOnce",1,function(){})},function(){}),m("num_dot_material",!1,!1,[0,1,2],function(){f("PLAY","num_dot_material",null,null,"LoopOnce",1,function(){})},function(){}),m("num8_material",!1,!1,[0,1,2],function(){f("PLAY","num8_material",null,null,"LoopOnce",1,function(){})},function(){}),m("num9_material",!1,!1,[0,1,2],function(){f("PLAY","num9_material",null,null,"LoopOnce",1,function(){})},function(){}),m("O_material",!1,!1,[0,1,2],function(){f("PLAY","O_material",null,null,"LoopOnce",1,function(){})},function(){}),m("Q_material",!1,!1,[0,1,2],function(){f("PLAY","Q_material",null,null,"LoopOnce",1,function(){})},function(){}),m("P_button_material",!1,!1,[0,1,2],function(){f("PLAY","P_button_inside_material",null,null,"LoopOnce",1,function(){})},function(){}),m("pgup_material",!1,!1,[0,1,2],function(){f("PLAY","pgup_material",null,null,"LoopOnce",1,function(){})},function(){}),m("pause_break_material",!1,!1,[0,1,2],function(){f("PLAY","pause_break_material",null,null,"LoopOnce",1,function(){})},function(){}),m("pgdn_material",!1,!1,[0,1,2],function(){f("PLAY","pgdn_material",null,null,"LoopOnce",1,function(){})},function(){}),m("print_screen_material",!1,!1,[0,1,2],function(){f("PLAY","print_screen_material",null,null,"LoopOnce",1,function(){})},function(){}),m("N_material",!1,!1,[0,1,2],function(){f("PLAY","N_material",null,null,"LoopOnce",1,function(){})},function(){}),m("num_zero_material",!1,!1,[0,1,2],function(){f("PLAY","num_zero_material",null,null,"LoopOnce",1,function(){})},function(){}),m("options_material",!1,!1,[0,1,2],function(){f("PLAY","options_material",null,null,"LoopOnce",1,function(){})},function(){}),m("-_material",!1,!1,[0,1,2],function(){f("PLAY","-_material",null,null,"LoopOnce",1,function(){})},function(){}),m("/_material",!1,!1,[0,1,2],function(){f("PLAY","/_material",null,null,"LoopOnce",1,function(){})},function(){}),m("0_material",!1,!1,[0,1,2],function(){f("PLAY","0_material",null,null,"LoopOnce",1,function(){})},function(){}),m("1_material",!1,!1,[0,1,2],function(){f("PLAY","1_material",null,null,"LoopOnce",1,function(){})},function(){}),m("2_material",!1,!1,[0,1,2],function(){f("PLAY","2_material",null,null,"LoopOnce",1,function(){})},function(){}),m("3_material",!1,!1,[0,1,2],function(){f("PLAY","3_material",null,null,"LoopOnce",1,function(){})},function(){}),m("4_material",!1,!1,[0,1,2],function(){f("PLAY","4_material",null,null,"LoopOnce",1,function(){})},function(){}),m("5_material",!1,!1,[0,1,2],function(){f("PLAY","5_material",null,null,"LoopOnce",1,function(){})},function(){}),m("6_material",!1,!1,[0,1,2],function(){f("PLAY","6_material",null,null,"LoopOnce",1,function(){})},function(){}),m("<_material",!1,!1,[0,1,2],function(){f("PLAY","<_material",null,null,"LoopOnce",1,function(){})},function(){}),m(";_material",!1,!1,[0,1,2],function(){f("PLAY",";_material",null,null,"LoopOnce",1,function(){})},function(){}),m("L_material",!1,!1,[0,1,2],function(){f("PLAY","L_material",null,null,"LoopOnce",1,function(){})},function(){}),m("num1_material",!1,!1,[0,1,2],function(){f("PLAY","num1_material",null,null,"LoopOnce",1,function(){})},function(){}),m("num3_material",!1,!1,[0,1,2],function(){f("PLAY","num3_material",null,null,"LoopOnce",1,function(){})},function(){}),m("num4_material",!1,!1,[0,1,2],function(){f("PLAY","num4_material",null,null,"LoopOnce",1,function(){})},function(){}),m("num2_material",!1,!1,[0,1,2],function(){f("PLAY","num2_material",null,null,"LoopOnce",1,function(){})},function(){}),m("num5_material",!1,!1,[0,1,2],function(){f("PLAY","num5_material",null,null,"LoopOnce",1,function(){})},function(){}),m("num6_material",!1,!1,[0,1,2],function(){f("PLAY","num6_material",null,null,"LoopOnce",1,function(){})},function(){}),m("M_material",!1,!1,[0,1,2],function(){f("PLAY","M_material",null,null,"LoopOnce",1,function(){})},function(){}),m("E_material",!1,!1,[0,1,2],function(){f("PLAY","E_material",null,null,"LoopOnce",1,function(){})},function(){}),m("V_material",!1,!1,[0,1,2],function(){f("PLAY","V_material",null,null,"LoopOnce",1,function(){})},function(){}),m("G_material",!1,!1,[0,1,2],function(){f("PLAY","G_material",null,null,"LoopOnce",1,function(){})},function(){}),m("A_material",!1,!1,[0,1,2],function(){f("PLAY","A_material",null,null,"LoopOnce",1,function(){})},function(){}),m("enter_material",!1,!1,[0,1,2],function(){f("PLAY","enter_material",null,null,"LoopOnce",1,function(){})},function(){}),m("FN_material",!1,!1,[0,1,2],function(){f("PLAY","FN_material",null,null,"LoopOnce",1,function(){})},function(){}),m("end_material",!1,!1,[0,1,2],function(){f("PLAY","end_material",null,null,"LoopOnce",1,function(){})},function(){}),m("F7_material",!1,!1,[0,1,2],function(){f("PLAY","F7_material",null,null,"LoopOnce",1,function(){})},function(){}),m("F3_material",!1,!1,[0,1,2],function(){f("PLAY","F3_material",null,null,"LoopOnce",1,function(){})},function(){}),m("F12_material",!1,!1,[0,1,2],function(){f("PLAY","F12_material",null,null,"LoopOnce",1,function(){})},function(){}),m("F10_material",!1,!1,[0,1,2],function(){f("PLAY","F10_material",null,null,"LoopOnce",1,function(){})},function(){}),m("down_arrow_material",!1,!1,[0,1,2],function(){f("PLAY","down_arrow_material",null,null,"LoopOnce",1,function(){})},function(){}),m("del_material",!1,!1,[0,1,2],function(){f("PLAY","del_material",null,null,"LoopOnce",1,function(){})},function(){}),m("caps_material",!1,!1,[0,1,2],function(){f("PLAY","caps_material",null,null,"LoopOnce",1,function(){})},function(){}),m("B_material",!1,!1,[0,1,2],function(){f("PLAY","B_material",null,null,"LoopOnce",1,function(){})},function(){}),m("backspace_material",!1,!1,[0,1,2],function(){f("PLAY","backspace_material",null,null,"LoopOnce",1,function(){})},function(){}),m("backslash_material",!1,!1,[0,1,2],function(){f("PLAY","backslash_material",null,null,"LoopOnce",1,function(){})},function(){}),m("8_material",!1,!1,[0,1,2],function(){f("PLAY","8_material",null,null,"LoopOnce",1,function(){})},function(){}),m("apostrof_material",!1,!1,[0,1,2],function(){f("PLAY","apostrof_material",null,null,"LoopOnce",1,function(){})},function(){}),m("7_material",!1,!1,[0,1,2],function(){f("PLAY","7_material",null,null,"LoopOnce",1,function(){})},function(){}),m(">_material",!1,!1,[0,1,2],function(){f("PLAY",">_material",null,null,"LoopOnce",1,function(){})},function(){}),m("9_material",!1,!1,[0,1,2],function(){f("PLAY","9_material",null,null,"LoopOnce",1,function(){})},function(){}),m("left_win_material",!1,!1,[0,1,2],function(){f("PLAY","left_win_material",null,null,"LoopOnce",1,function(){})},function(){}),m("H_material",!1,!1,[0,1,2],function(){f("PLAY","H_material",null,null,"LoopOnce",1,function(){})},function(){}),m("F9_material",!1,!1,[0,1,2],function(){f("PLAY","F9_material",null,null,"LoopOnce",1,function(){})},function(){}),m("F6_material",!1,!1,[0,1,2],function(){f("PLAY","F6_material",null,null,"LoopOnce",1,function(){})},function(){}),m("ins_material",!1,!1,[0,1,2],function(){f("PLAY","ins_material",null,null,"LoopOnce",1,function(){})},function(){}),m("F_material",!1,!1,[0,1,2],function(){f("PLAY","F_material",null,null,"LoopOnce",1,function(){})},function(){}),m("D_material",!1,!1,[0,1,2],function(){f("PLAY","D_material",null,null,"LoopOnce",1,function(){})},function(){}),m("J_material",!1,!1,[0,1,2],function(){f("PLAY","J_material",null,null,"LoopOnce",1,function(){})},function(){}),m("left_shift_material",!1,!1,[0,1,2],function(){f("PLAY","left_shift_material",null,null,"LoopOnce",1,function(){})},function(){}),m("K_material",!1,!1,[0,1,2],function(){f("PLAY","K_material",null,null,"LoopOnce",1,function(){})},function(){}),m("F8_material",!1,!1,[0,1,2],function(){f("PLAY","F8_material",null,null,"LoopOnce",1,function(){})},function(){}),m("I_material",!1,!1,[0,1,2],function(){f("PLAY","I_material",null,null,"LoopOnce",1,function(){})},function(){}),m("F5_material",!1,!1,[0,1,2],function(){f("PLAY","F5_material",null,null,"LoopOnce",1,function(){})},function(){}),m("F4_material",!1,!1,[0,1,2],function(){f("PLAY","F4_material",null,null,"LoopOnce",1,function(){})},function(){}),m("left_arrow_material",!1,!1,[0,1,2],function(){f("PLAY","left_arrow_material",null,null,"LoopOnce",1,function(){})},function(){}),m("F2_material",!1,!1,[0,1,2],function(){f("PLAY","F2_material",null,null,"LoopOnce",1,function(){})},function(){}),m("home_material",!1,!1,[0,1,2],function(){f("PLAY","home_material",null,null,"LoopOnce",1,function(){})},function(){}),m("F1_material",!1,!1,[0,1,2],function(){f("PLAY","F1_material",null,null,"LoopOnce",1,function(){})},function(){}),m("F11_material",!1,!1,[0,1,2],function(){f("PLAY","F11_material",null,null,"LoopOnce",1,function(){})},function(){}),m("esc_material",!1,!1,[0,1,2],function(){f("PLAY","esc_material",null,null,"LoopOnce",1,function(){})},function(){}),m("U_material",!1,!1,[0,1,2],function(){f("PLAY","U_material",null,null,"LoopOnce",1,function(){})},function(){}),m("left_ctrl_material",!1,!1,[0,1,2],function(){c=u("value","color-changer",!1),g("left_ctrl_color","RGB",0,0,0,c)},function(){}),m("left_win_material",!1,!1,[0,1,2],function(){c=u("value","color-changer",!1),g("left_win_color","RGB",0,0,0,c)},function(){}),m("left_alt_material",!1,!1,[0,1,2],function(){c=u("value","color-changer",!1),g("left_alt_color","RGB",0,0,0,c)},function(){}),m("space_material",!1,!1,[0,1,2],function(){console.log("Space clicked"),c=u("value","color-changer",!1),g("space_color","RGB",0,0,0,c)},function(){}),m("right_alt_material",!1,!1,[0,1,2],function(){c=u("value","color-changer",!1),g("right_alt_color","RGB",0,0,0,c)},function(){}),m("FN_material",!1,!1,[0,1,2],function(){c=u("value","color-changer",!1),g("FN_color","RGB",0,0,0,c)},function(){}),m("options_material",!1,!1,[0,1,2],function(){c=u("value","color-changer",!1),g("options_color","RGB",0,0,0,c)},function(){}),m("right_ctrl_material",!1,!1,[0,1,2],function(){c=u("value","color-changer",!1),g("right_ctrl_color","RGB",0,0,0,c)},function(){}),m("left_arrow_material",!1,!1,[0,1,2],function(){c=u("value","color-changer",!1),g("left_arrow_color","RGB",0,0,0,c)},function(){}),m("up_arrow_material",!1,!1,[0,1,2],function(){c=u("value","color-changer",!1),g("up_arrow_color","RGB",0,0,0,c)},function(){}),m("right_arrow_material",!1,!1,[0,1,2],function(){c=u("value","color-changer",!1),g("right_arrow_color","RGB",0,0,0,c)},function(){}),m("down_arrow_material",!1,!1,[0,1,2],function(){c=u("value","color-changer",!1),g("down_arrow_color","RGB",0,0,0,c)},function(){}),m("num_lock_material",!1,!1,[0,1,2],function(){c=u("value","color-changer",!1),g("num_lock_color","RGB",0,0,0,c)},function(){}),m("num_slash_material",!1,!1,[0,1,2],function(){c=u("value","color-changer",!1),g("num_slash_color","RGB",0,0,0,c)},function(){}),m("num_multiply_material",!1,!1,[0,1,2],function(){c=u("value","color-changer",!1),g("num_multiply_color","RGB",0,0,0,c)},function(){}),m("num_minus_material",!1,!1,[0,1,2],function(){c=u("value","color-changer",!1),g("num_minus_color","RGB",0,0,0,c)},function(){}),m("num_plus_material",!1,!1,[0,1,2],function(){c=u("value","color-changer",!1),g("num_plus_color","RGB",0,0,0,c)},function(){}),m("num_enter_material",!1,!1,[0,1,2],function(){c=u("value","color-changer",!1),g("num_enter_color","RGB",0,0,0,c)},function(){}),m("num_dot_material",!1,!1,[0,1,2],function(){c=u("value","color-changer",!1),g("num_dot_color","RGB",0,0,0,c)},function(){}),m("num_zero_material",!1,!1,[0,1,2],function(){c=u("value","color-changer",!1),g("num_zero_color","RGB",0,0,0,c)},function(){}),m("num1_material",!1,!1,[0,1,2],function(){c=u("value","color-changer",!1),g("num1_color","RGB",0,0,0,c)},function(){}),m("num2_material",!1,!1,[0,1,2],function(){c=u("value","color-changer",!1),g("num2_color","RGB",0,0,0,c)},function(){}),m("num3_material",!1,!1,[0,1,2],function(){c=u("value","color-changer",!1),g("num3_color","RGB",0,0,0,c)},function(){}),m("num4_material",!1,!1,[0,1,2],function(){c=u("value","color-changer",!1),g("num4_color","RGB",0,0,0,c)},function(){}),m("num5_material",!1,!1,[0,1,2],function(){c=u("value","color-changer",!1),g("num5_color","RGB",0,0,0,c)},function(){}),m("num6_material",!1,!1,[0,1,2],function(){c=u("value","color-changer",!1),g("num6_color","RGB",0,0,0,c)},function(){}),m("num7_material",!1,!1,[0,1,2],function(){c=u("value","color-changer",!1),g("num7_color","RGB",0,0,0,c)},function(){}),m("num8_material",!1,!1,[0,1,2],function(){c=u("value","color-changer",!1),g("num8_color","RGB",0,0,0,c)},function(){}),m("num9_material",!1,!1,[0,1,2],function(){c=u("value","color-changer",!1),g("num9_color","RGB",0,0,0,c)},function(){}),m("left_shift_material",!1,!1,[0,1,2],function(){c=u("value","color-changer",!1),g("left_shift_color","RGB",0,0,0,c)},function(){}),m("Z_material",!1,!1,[0,1,2],function(){c=u("value","color-changer",!1),g("Z_color","RGB",0,0,0,c)},function(){}),m("X_material",!1,!1,[0,1,2],function(){c=u("value","color-changer",!1),g("X_color","RGB",0,0,0,c)},function(){}),m("C_material",!1,!1,[0,1,2],function(){c=u("value","color-changer",!1),g("C_color","RGB",0,0,0,c)},function(){}),m("V_material",!1,!1,[0,1,2],function(){c=u("value","color-changer",!1),g("V_color","RGB",0,0,0,c)},function(){}),m("B_material",!1,!1,[0,1,2],function(){c=u("value","color-changer",!1),g("B_color","RGB",0,0,0,c)},function(){}),m("N_material",!1,!1,[0,1,2],function(){c=u("value","color-changer",!1),g("N_color","RGB",0,0,0,c)},function(){}),m("M_material",!1,!1,[0,1,2],function(){c=u("value","color-changer",!1),g("M_color","RGB",0,0,0,c)},function(){}),m("<_material",!1,!1,[0,1,2],function(){c=u("value","color-changer",!1),g("<_color","RGB",0,0,0,c)},function(){}),m(">_material",!1,!1,[0,1,2],function(){c=u("value","color-changer",!1),g(">_color","RGB",0,0,0,c)},function(){}),m("right_shift_material",!1,!1,[0,1,2],function(){c=u("value","color-changer",!1),g("right_shift_color","RGB",0,0,0,c)},function(){}),m("caps_material",!1,!1,[0,1,2],function(){c=u("value","color-changer",!1),g("caps_color","RGB",0,0,0,c)},function(){}),m("A_material",!1,!1,[0,1,2],function(){c=u("value","color-changer",!1),g("A_color","RGB",0,0,0,c)},function(){}),m("S_material",!1,!1,[0,1,2],function(){c=u("value","color-changer",!1),g("S_color","RGB",0,0,0,c)},function(){}),m("D_material",!1,!1,[0,1,2],function(){c=u("value","color-changer",!1),g("D_color","RGB",0,0,0,c)},function(){}),m("F_material",!1,!1,[0,1,2],function(){c=u("value","color-changer",!1),g("F_color","RGB",0,0,0,c)},function(){}),m("G_material",!1,!1,[0,1,2],function(){c=u("value","color-changer",!1),g("G_color","RGB",0,0,0,c)},function(){}),m("H_material",!1,!1,[0,1,2],function(){c=u("value","color-changer",!1),g("H_color","RGB",0,0,0,c)},function(){}),m("J_material",!1,!1,[0,1,2],function(){c=u("value","color-changer",!1),g("J_color","RGB",0,0,0,c)},function(){}),m("K_material",!1,!1,[0,1,2],function(){c=u("value","color-changer",!1),g("K_color","RGB",0,0,0,c)},function(){}),m("L_material",!1,!1,[0,1,2],function(){c=u("value","color-changer",!1),g("L_color","RGB",0,0,0,c)},function(){}),m(";_material",!1,!1,[0,1,2],function(){c=u("value","color-changer",!1),g(";_color","RGB",0,0,0,c)},function(){}),m("body_material",!1,!1,[0,1,2],function(){c=u("value","color-changer",!1),g("body_material","RGB",0,0,0,c)},function(){}),m("backspace_material",!1,!1,[0,1,2],function(){c=u("value","color-changer",!1),g("backspace_color","RGB",0,0,0,c)},function(){}),m("esc_material",!1,!1,[0,1,2],function(){c=u("value","color-changer",!1),g("esc_color","RGB",0,0,0,c)},function(){}),m("F1_material",!1,!1,[0,1,2],function(){c=u("value","color-changer",!1),g("F1_color","RGB",0,0,0,c)},function(){}),m("F2_material",!1,!1,[0,1,2],function(){c=u("value","color-changer",!1),g("F2_color","RGB",0,0,0,c)},function(){}),m("F3_material",!1,!1,[0,1,2],function(){c=u("value","color-changer",!1),g("F3_color","RGB",0,0,0,c)},function(){}),m("F4_material",!1,!1,[0,1,2],function(){c=u("value","color-changer",!1),g("F4_color","RGB",0,0,0,c)},function(){}),m("F5_material",!1,!1,[0,1,2],function(){c=u("value","color-changer",!1),g("F5_color","RGB",0,0,0,c)},function(){}),m("F6_material",!1,!1,[0,1,2],function(){c=u("value","color-changer",!1),g("F6_color","RGB",0,0,0,c)},function(){}),m("F7_material",!1,!1,[0,1,2],function(){c=u("value","color-changer",!1),g("F7_color","RGB",0,0,0,c)},function(){}),m("F8_material",!1,!1,[0,1,2],function(){c=u("value","color-changer",!1),g("F8_color","RGB",0,0,0,c)},function(){}),m("F9_material",!1,!1,[0,1,2],function(){c=u("value","color-changer",!1),g("F9_color","RGB",0,0,0,c)},function(){}),m("F10_material",!1,!1,[0,1,2],function(){c=u("value","color-changer",!1),g("F10_color","RGB",0,0,0,c)},function(){}),m("F11_material",!1,!1,[0,1,2],function(){c=u("value","color-changer",!1),g("F11_color","RGB",0,0,0,c)},function(){}),m("F12_material",!1,!1,[0,1,2],function(){c=u("value","color-changer",!1),g("F12_color","RGB",0,0,0,c)},function(){}),m("print_screen_material",!1,!1,[0,1,2],function(){c=u("value","color-changer",!1),g("print_screen_color","RGB",0,0,0,c)},function(){}),m("scroll_lock_material",!1,!1,[0,1,2],function(){c=u("value","color-changer",!1),g("scroll_lock_color","RGB",0,0,0,c)},function(){}),m("pause_break_material",!1,!1,[0,1,2],function(){c=u("value","color-changer",!1),g("pause_break_color","RGB",0,0,0,c)},function(){}),m("/_material",!1,!1,[0,1,2],function(){c=u("value","color-changer",!1),g("/_color","RGB",0,0,0,c)},function(){}),m("-_material",!1,!1,[0,1,2],function(){c=u("value","color-changer",!1),g("-_color","RGB",0,0,0,c)},function(){}),m("apostrof_material",!1,!1,[0,1,2],function(){c=u("value","color-changer",!1),g("apostrof_color","RGB",0,0,0,c)},function(){}),m("0_material",!1,!1,[0,1,2],function(){c=u("value","color-changer",!1),g("0_color","RGB",0,0,0,c)},function(){}),m("1_material",!1,!1,[0,1,2],function(){c=u("value","color-changer",!1),g("1_color","RGB",0,0,0,c)},function(){}),m("2_material",!1,!1,[0,1,2],function(){c=u("value","color-changer",!1),g("2_color","RGB",0,0,0,c)},function(){}),m("3_material",!1,!1,[0,1,2],function(){c=u("value","color-changer",!1),g("3_color","RGB",0,0,0,c)},function(){}),m("4_material",!1,!1,[0,1,2],function(){c=u("value","color-changer",!1),g("4_color","RGB",0,0,0,c)},function(){}),m("5_material",!1,!1,[0,1,2],function(){c=u("value","color-changer",!1),g("5_color","RGB",0,0,0,c)},function(){}),m("6_material",!1,!1,[0,1,2],function(){c=u("value","color-changer",!1),g("6_color","RGB",0,0,0,c)},function(){}),m("7_material",!1,!1,[0,1,2],function(){c=u("value","color-changer",!1),g("7_color","RGB",0,0,0,c)},function(){}),m("8_material",!1,!1,[0,1,2],function(){c=u("value","color-changer",!1),g("8_color","RGB",0,0,0,c)},function(){}),m("9_material",!1,!1,[0,1,2],function(){c=u("value","color-changer",!1),g("9_color","RGB",0,0,0,c)},function(){}),m("0_material",!1,!1,[0,1,2],function(){c=u("value","color-changer",!1),g("0_color","RGB",0,0,0,c)},function(){}),m("~_material",!1,!1,[0,1,2],function(){c=u("value","color-changer",!1),g("~_color","RGB",0,0,0,c)},function(){}),m("=_material",!1,!1,[0,1,2],function(){c=u("value","color-changer",!1),g("=_color","RGB",0,0,0,c)},function(){}),m("ins_material",!1,!1,[0,1,2],function(){c=u("value","color-changer",!1),g("ins_color","RGB",0,0,0,c)},function(){}),m("home_material",!1,!1,[0,1,2],function(){c=u("value","color-changer",!1),g("home_color","RGB",0,0,0,c)},function(){}),m("pgup_material",!1,!1,[0,1,2],function(){c=u("value","color-changer",!1),g("pgup_color","RGB",0,0,0,c)},function(){}),m("Q_material",!1,!1,[0,1,2],function(){c=u("value","color-changer",!1),g("Q_color","RGB",0,0,0,c)},function(){}),m("W_material",!1,!1,[0,1,2],function(){c=u("value","color-changer",!1),g("W_color","RGB",0,0,0,c)},function(){}),m("E_material",!1,!1,[0,1,2],function(){c=u("value","color-changer",!1),g("E_color","RGB",0,0,0,c)},function(){}),m("R_material",!1,!1,[0,1,2],function(){c=u("value","color-changer",!1),g("R_color","RGB",0,0,0,c)},function(){}),m("T_material",!1,!1,[0,1,2],function(){c=u("value","color-changer",!1),g("T_color","RGB",0,0,0,c)},function(){}),m("Y_material",!1,!1,[0,1,2],function(){c=u("value","color-changer",!1),g("Y_color","RGB",0,0,0,c)},function(){}),m("U_material",!1,!1,[0,1,2],function(){c=u("value","color-changer",!1),g("U_color","RGB",0,0,0,c)},function(){}),m("I_material",!1,!1,[0,1,2],function(){c=u("value","color-changer",!1),g("I_color","RGB",0,0,0,c)},function(){}),m("O_material",!1,!1,[0,1,2],function(){c=u("value","color-changer",!1),g("O_color","RGB",0,0,0,c)},function(){}),m("P_button_inside_material",!1,!1,[0,1,2],function(){c=u("value","color-changer",!1),g("P_inside_color","RGB",0,0,0,c)},function(){}),m("{_material",!1,!1,[0,1,2],function(){c=u("value","color-changer",!1),g("{_color","RGB",0,0,0,c)},function(){}),m("}_material",!1,!1,[0,1,2],function(){c=u("value","color-changer",!1),g("}_color","RGB",0,0,0,c)},function(){}),m("enter_material",!1,!1,[0,1,2],function(){c=u("value","color-changer",!1),g("enter_color","RGB",0,0,0,c)},function(){}),m("backslash_material",!1,!1,[0,1,2],function(){c=u("value","color-changer",!1),g("backslash_color","RGB",0,0,0,c)},function(){}),m("del_material",!1,!1,[0,1,2],function(){c=u("value","color-changer",!1),g("del_color","RGB",0,0,0,c)},function(){}),m("end_material",!1,!1,[0,1,2],function(){c=u("value","color-changer",!1),g("end_color","RGB",0,0,0,c)},function(){}),m("pgdn_material",!1,!1,[0,1,2],function(){c=u("value","color-changer",!1),g("pdgn_color","RGB",0,0,0,c)},function(){}),m("tab_material",!1,!1,[0,1,2],function(){c=u("value","color-changer",!1),g("tab_color","RGB",0,0,0,c)},function(){}),A("myEvent",C),x(function(){_("myEvent",[])}),f("SET_FRAME","~_material",0,null,"AUTO",1,function(){}),f("SET_FRAME","}_material",0,null,"AUTO",1,function(){}),f("SET_FRAME","backspace_material",0,null,"AUTO",1,function(){}),f("SET_FRAME","del_material",0,null,"AUTO",1,function(){}),f("SET_FRAME","end_material",0,null,"AUTO",1,function(){}),f("SET_FRAME","FN_material",0,null,"AUTO",1,function(){}),f("SET_FRAME","{_material",0,null,"AUTO",1,function(){}),f("SET_FRAME","left_arrow_material",0,null,"AUTO",1,function(){}),f("SET_FRAME","Y_material",0,null,"AUTO",1,function(){}),f("SET_FRAME","Z_material",0,null,"AUTO",1,function(){}),f("SET_FRAME","X_material",0,null,"AUTO",1,function(){}),f("SET_FRAME","W_material",0,null,"AUTO",1,function(){}),f("SET_FRAME","V_material",0,null,"AUTO",1,function(){}),f("SET_FRAME","E_material",0,null,"AUTO",1,function(){}),f("SET_FRAME","B_material",0,null,"AUTO",1,function(){}),f("SET_FRAME","num9_material",0,null,"AUTO",1,function(){}),f("SET_FRAME","options_material",0,null,"AUTO",1,function(){}),f("SET_FRAME","caps_material",0,null,"AUTO",1,function(){}),f("SET_FRAME","backslash_material",0,null,"AUTO",1,function(){}),f("SET_FRAME","=_material",0,null,"AUTO",1,function(){}),f("SET_FRAME",";_material",0,null,"AUTO",1,function(){}),f("SET_FRAME","<_material",0,null,"AUTO",1,function(){}),f("SET_FRAME","A_material",0,null,"AUTO",1,function(){}),f("SET_FRAME","E_material",0,null,"AUTO",1,function(){}),f("SET_FRAME","F10_material",0,null,"AUTO",1,function(){}),f("SET_FRAME",">_material",0,null,"AUTO",1,function(){}),f("SET_FRAME","apostrof_material",0,null,"AUTO",1,function(){}),f("SET_FRAME","9_material",0,null,"AUTO",1,function(){}),f("SET_FRAME","5_material",0,null,"AUTO",1,function(){}),f("SET_FRAME","6_material",0,null,"AUTO",1,function(){}),f("SET_FRAME","8_material",0,null,"AUTO",1,function(){}),f("SET_FRAME","7_material",0,null,"AUTO",1,function(){}),f("SET_FRAME","4_material",0,null,"AUTO",1,function(){}),f("SET_FRAME","U_material",0,null,"AUTO",1,function(){}),f("SET_FRAME","up_arrow_material",0,null,"AUTO",1,function(){}),f("SET_FRAME","T_material",0,null,"AUTO",1,function(){}),f("SET_FRAME","tab_material",0,null,"AUTO",1,function(){}),f("SET_FRAME","num1_material",0,null,"AUTO",1,function(){}),f("SET_FRAME","S_material",0,null,"AUTO",1,function(){}),f("SET_FRAME","space_material",0,null,"AUTO",1,function(){}),f("SET_FRAME","R_material",0,null,"AUTO",1,function(){}),f("SET_FRAME","scroll_lock_material",0,null,"AUTO",1,function(){}),f("SET_FRAME","right_shift_material",0,null,"AUTO",1,function(){}),f("SET_FRAME","M_material",0,null,"AUTO",1,function(){}),f("SET_FRAME","right_ctrl_material",0,null,"AUTO",1,function(){}),f("SET_FRAME","G_material",0,null,"AUTO",1,function(){}),f("SET_FRAME","right_arrow_material",0,null,"AUTO",1,function(){}),f("SET_FRAME","F_material",0,null,"AUTO",1,function(){}),f("SET_FRAME","F4_material",0,null,"AUTO",1,function(){}),f("SET_FRAME","F1_material",0,null,"AUTO",1,function(){}),f("SET_FRAME","num6_material",0,null,"AUTO",1,function(){}),f("SET_FRAME","num5_material",0,null,"AUTO",1,function(){}),f("SET_FRAME","L_material",0,null,"AUTO",1,function(){}),f("SET_FRAME","num4_material",0,null,"AUTO",1,function(){}),f("SET_FRAME","num3_material",0,null,"AUTO",1,function(){}),f("SET_FRAME","left_win_material",0,null,"AUTO",1,function(){}),f("SET_FRAME","num2_material",0,null,"AUTO",1,function(){}),f("SET_FRAME","C_material",0,null,"AUTO",1,function(){}),f("SET_FRAME","left_shift_material",0,null,"AUTO",1,function(){}),f("SET_FRAME","home_material",0,null,"AUTO",1,function(){}),f("SET_FRAME","I_material",0,null,"AUTO",1,function(){}),f("SET_FRAME","enter_material",0,null,"AUTO",1,function(){}),f("SET_FRAME","F11_material",0,null,"AUTO",1,function(){}),f("SET_FRAME","F12_material",0,null,"AUTO",1,function(){}),f("SET_FRAME","F9_material",0,null,"AUTO",1,function(){}),f("SET_FRAME","ins_material",0,null,"AUTO",1,function(){}),f("SET_FRAME","down_arrow_material",0,null,"AUTO",1,function(){}),f("SET_FRAME","H_material",0,null,"AUTO",1,function(){}),f("SET_FRAME","F6_material",0,null,"AUTO",1,function(){}),f("SET_FRAME","F5_material",0,null,"AUTO",1,function(){}),f("SET_FRAME","D_material",0,null,"AUTO",1,function(){}),f("SET_FRAME","F8_material",0,null,"AUTO",1,function(){}),f("SET_FRAME","F7_material",0,null,"AUTO",1,function(){}),f("SET_FRAME","F2_material",0,null,"AUTO",1,function(){}),f("SET_FRAME","Q_material",0,null,"AUTO",1,function(){}),f("SET_FRAME","print_screen_material",0,null,"AUTO",1,function(){}),f("SET_FRAME","right_alt_material",0,null,"AUTO",1,function(){}),f("SET_FRAME","P_button_inside_material",0,null,"AUTO",1,function(){}),f("SET_FRAME","K_material",0,null,"AUTO",1,function(){}),f("SET_FRAME","num_enter_material",0,null,"AUTO",1,function(){}),f("SET_FRAME","pgup_material",0,null,"AUTO",1,function(){}),f("SET_FRAME","pgdn_material",0,null,"AUTO",1,function(){}),f("SET_FRAME","O_material",0,null,"AUTO",1,function(){}),f("SET_FRAME","num_slash_material",0,null,"AUTO",1,function(){}),f("SET_FRAME","J_material",0,null,"AUTO",1,function(){}),f("SET_FRAME","pause_break_material",0,null,"AUTO",1,function(){}),f("SET_FRAME","left_alt_material",0,null,"AUTO",1,function(){}),f("SET_FRAME","N_material",0,null,"AUTO",1,function(){}),f("SET_FRAME","num_zero_material",0,null,"AUTO",1,function(){}),f("SET_FRAME","num_plus_material",0,null,"AUTO",1,function(){}),f("SET_FRAME","num_dot_material",0,null,"AUTO",1,function(){}),f("SET_FRAME","num_multiply_material",0,null,"AUTO",1,function(){}),f("SET_FRAME","num_minus_material",0,null,"AUTO",1,function(){}),f("SET_FRAME","left_ctrl_material",0,null,"AUTO",1,function(){}),f("SET_FRAME","num_lock_material",0,null,"AUTO",1,function(){}),f("SET_FRAME","num8_material",0,null,"AUTO",1,function(){}),f("SET_FRAME","num7_material",0,null,"AUTO",1,function(){}),f("SET_FRAME","F3_material",0,null,"AUTO",1,function(){}),f("SET_FRAME","esc_material",0,null,"AUTO",1,function(){}),f("SET_FRAME","1_material",0,null,"AUTO",1,function(){}),f("SET_FRAME","2_material",0,null,"AUTO",1,function(){}),f("SET_FRAME","3_material",0,null,"AUTO",1,function(){})},r.disposeListeners=function(){t&&(t.eventListeners.forEach(({target:a,type:i,listener:s,optionsOrUseCapture:c})=>{a.removeEventListener(i,s,c)}),t.eventListeners.length=0)},r.disposeHTMLElements=function(){t&&(t.htmlElements.forEach(a=>{a.remove()}),t.htmlElements.clear())},r.disposeMaterialsCache=function(){if(t){for(const a of t.materialsCache.values())a.dispose();t.materialsCache.clear()}},r.dispose=function(){r.disposeListeners(),r.disposeHTMLElements(),r.disposeMaterialsCache(),t=null,o[Symbol.toStringTag]!=="Module"&&(delete o.PL,delete o.puzzles)},r}async function Tie({containerId:o,fsButtonId:e=null,sceneURL:t}){var c;Qa.enabled=!0;let n=null;n=wie(Mie),await((c=n==null?void 0:n.loadPhysics)==null?void 0:c.call(n));let r={useFullscreen:!0};n&&(r=n.execInitPuzzles({container:o}).initOptions),t=r.useCompAssets?`${t}.xz`:t;const a=Bie(o,e,r.useFullscreen),i=Rie(o,r),s=Lie(o,r,i);return s.addEventListener("dispose",()=>a==null?void 0:a()),r.preloaderStartCb&&r.preloaderStartCb(),s.loadScene(t,()=>{s.enableControls(),s.run(),n&&n.init(s,r),Pie(s)},null,()=>{console.log(`Can't load the scene ${t}`)}),{app:s,PL:n}}function Rie(o,e,t){return e.useCustomPreloader?Iie(e.preloaderProgressCb,e.preloaderEndCb):new kP({container:o})}function Iie(o,e){function t(){vc.call(this)}return t.prototype=Object.assign(Object.create(vc.prototype),{onUpdate:function(n){vc.prototype.onUpdate.call(this,n),o&&o(n)},onFinish:function(){vc.prototype.onFinish.call(this),e&&e()}}),new t}function Lie(o,e,t,n){const r={};e.useBkgTransp&&(r.alpha=!0),e.preserveDrawBuf&&(r.preserveDrawingBuffer=!0);const a=new zP(o,r,t);return e.useBkgTransp&&(a.clearBkgOnLoad=!0,a.renderer&&a.renderer.setClearColor(0,0)),a.ExternalInterface={},a}function Bie(o,e,t){const n=document.getElementById(o),r=document.getElementById(e);if(!r)return null;if(!t)return r&&(r.style.display="none"),null;const a=()=>document.fullscreenEnabled||document.webkitFullscreenEnabled||document.mozFullScreenEnabled||document.msFullscreenEnabled,i=()=>document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement,s=m=>(m.requestFullscreen||m.mozRequestFullScreen||m.webkitRequestFullscreen||m.msRequestFullscreen).call(m),c=()=>(document.exitFullscreen||document.mozCancelFullScreen||document.webkitExitFullscreen||document.msExitFullscreen).call(document),u=()=>{const m=i();r.classList.add(m?"fullscreen-close":"fullscreen-open"),r.classList.remove(m?"fullscreen-open":"fullscreen-close")};function h(m){m.stopPropagation(),i()?c():s(n)}return a()&&(r.style.display="inline"),r.addEventListener("click",h),document.addEventListener("webkitfullscreenchange",u),document.addEventListener("mozfullscreenchange",u),document.addEventListener("msfullscreenchange",u),document.addEventListener("fullscreenchange",u),()=>{r.removeEventListener("click",h),document.removeEventListener("webkitfullscreenchange",u),document.removeEventListener("mozfullscreenchange",u),document.removeEventListener("msfullscreenchange",u),document.removeEventListener("fullscreenchange",u)}}function Pie(o,e){o.camera.far=1e4,o.camera.updateProjectionMatrix()}const Nie=o=>{if(!o)throw new Error("KeyboardModel cannot be undefined");switch(o){case Ac.hyperX:{console.log("KeyboardModel set to hyperX");const e="v3dApp/hyperx/hyperx_tkl.gltf",t="#000000,#111111,#222222".split(",");return{sceneUrl:e,defaultColorPallet:t}}case Ac.logitech:{console.log("KeyboardModel set to logitech");const e="v3dApp/repaired/hyperx.gltf",t="#123123,#abcdef,#456789".split(",");return{sceneUrl:e,defaultColorPallet:t}}case Ac.aliExpress:{console.log("KeyboardModel set to aliExpress");const e="v3dApp/hyperx5/hyperx_repaired.gltf",t="#ff00ff,#00ffff,#ffff00".split(",");return{sceneUrl:e,defaultColorPallet:t}}}},Die=()=>{var m;const{color:o,backlightColor:e}=q4(),{keyboardModel:t}=mL(),[n,r]=j.useState(()=>crypto.randomUUID());j.useEffect(()=>{r(crypto.randomUUID())},[t]);const a=`v3d-container-${n}`,i=`fullscreen-button-${n}`,s=(m=Nie(t))==null?void 0:m.sceneUrl,c=j.useRef(null),u=j.useRef(null),h=async()=>{try{const{app:g,PL:A}=await Tie({containerId:a,fsButtonId:i,sceneURL:s});c.current=g,u.current=A,console.log("App created")}catch(g){console.error(g)}},f=()=>{var g,A,_,x;(A=(g=c.current)==null?void 0:g.dispose)==null||A.call(g),(x=(_=u.current)==null?void 0:_.dispose)==null||x.call(_),c.current=null,u.current=null};return j.useEffect(()=>{if(s)return h(),()=>{f()}},[n]),j.useEffect(()=>{console.log(`Color has changed to: ${o}`)},[o]),ue.jsxs("div",{id:a,children:[ue.jsx("div",{id:i,className:"fullscreen-button fullscreen-open",title:"Toggle fullscreen mode"}),ue.jsx("input",{type:"color",id:"color-changer",hidden:!0,value:o,readOnly:!0}),ue.jsx("input",{type:"color",id:"backlight-changer",hidden:!0,value:e,readOnly:!0})]})},Oie=()=>ue.jsx("div",{className:"flex flex-col w-full h-full p-6 bg-stone-900",children:ue.jsx("div",{className:"flex justify-center items-center flex-grow p-4",children:ue.jsx(Die,{})})}),Fie=()=>ue.jsxs("div",{className:"flex flex-row w-full h-screen",children:[ue.jsx(lV,{}),ue.jsx(Oie,{})]});function Uie(){return ue.jsx(l7,{children:ue.jsx(Bz,{children:ue.jsx("div",{className:"flex flex-col items-center justify-center min-h-svh",children:ue.jsx(Fie,{})})})})}eO.createRoot(document.getElementById("root")).render(ue.jsx(j.StrictMode,{children:ue.jsx(Uie,{})}));
